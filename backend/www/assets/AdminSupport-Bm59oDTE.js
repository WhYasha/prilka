import{d as D,E as I,c as l,a as t,e as v,Q as M,F as g,z as y,v as S,r as u,I as _,o as a,t as n,s as c,f as w}from"./index-B_oY_tdN.js";import{d as T,e as N,f as x,s as U}from"./admin-BAlEPRNs.js";const V={class:"admin-support-form"},B=["value"],z={key:0,class:"admin-table-wrap"},E={class:"admin-table"},F={key:1},L={key:2,class:"admin-table-wrap"},A={class:"admin-table"},O={class:"msg-content"},P={key:3},q=D({__name:"AdminSupport",setup(Q){const{showToast:b}=_(),h=u([]),p=u([]),m=u([]),d=u(""),i=u(""),r=u("");async function f(){const[o,e,s]=await Promise.all([T(),N(),x()]);h.value=o.users||[],p.value=e.chats||[],m.value=s.messages||[]}async function C(){if(!r.value.trim())return;const o={content:r.value.trim()};if(d.value)o.target_user_id=parseInt(d.value);else if(i.value.trim())o.chat_id=parseInt(i.value.trim());else{b("Select a target user or enter a chat ID.");return}await U(o),r.value="",b("Support message sent."),await f()}function k(o){if(!o)return"-";const e=new Date(o);return isNaN(e.getTime())?o:e.toLocaleString()}return I(f),(o,e)=>(a(),l("div",null,[e[11]||(e[11]=t("h1",{class:"admin-page-title"},"Support",-1)),t("div",V,[e[4]||(e[4]=t("h2",null,"Send Support Message",-1)),e[5]||(e[5]=t("label",null,"Target User",-1)),v(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s)},[e[3]||(e[3]=t("option",{value:""},"-- Select user --",-1)),(a(!0),l(g,null,y(h.value,s=>(a(),l("option",{key:s.id,value:s.id},n(s.username)+" ("+n(s.display_name)+") ",9,B))),128))],512),[[M,d.value]]),e[6]||(e[6]=t("label",null,"Or Chat ID (direct)",-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),type:"text",placeholder:"Chat ID"},null,512),[[S,i.value]]),e[7]||(e[7]=t("label",null,"Message",-1)),v(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>r.value=s),placeholder:"Type support message..."},null,512),[[S,r.value]]),e[8]||(e[8]=t("br",null,null,-1)),t("button",{class:"btn btn-primary",onClick:C},"Send as bh_support")]),e[12]||(e[12]=t("h3",{class:"section-title"},"Support Chats",-1)),p.value.length?(a(),l("div",z,[t("table",E,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Chat ID"),t("th",null,"Type"),t("th",null,"Name"),t("th",null,"Members")])],-1)),t("tbody",null,[(a(!0),l(g,null,y(p.value,s=>(a(),l("tr",{key:s.id},[t("td",null,n(s.id),1),t("td",null,[t("span",{class:c(["badge","badge-"+s.type])},n(s.type),3)]),t("td",null,n(s.name||s.title||"-"),1),t("td",null,n(s.member_count),1)]))),128))])])])):(a(),l("p",F,"No support chats yet.")),e[13]||(e[13]=t("h3",{class:"section-title"},"Recent Support Messages",-1)),m.value.length?(a(),l("div",L,[t("table",A,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Chat"),t("th",null,"Content"),t("th",null,"Sent")])],-1)),t("tbody",null,[(a(!0),l(g,null,y(m.value,s=>(a(),l("tr",{key:s.id},[t("td",null,n(s.id),1),t("td",null,[w(n(s.chat_name||s.chat_id)+" ",1),t("span",{class:c(["badge","badge-"+s.chat_type])},n(s.chat_type),3)]),t("td",O,n(s.content),1),t("td",null,n(k(s.created_at)),1)]))),128))])])])):(a(),l("p",P,"No support messages yet."))]))}});export{q as default};
