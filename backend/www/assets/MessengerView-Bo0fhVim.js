import{k as K,l as Ge,r as b,m as B,n as He,u as Ee,p as cn,d as Z,o as v,c as y,a as t,t as D,w as ae,q as ct,s as ve,g as j,x,b as F,f as _e,e as te,v as de,F as se,y as fe,z as Y,A as pt,B as De,C as Ze,D as Ws,E as ge,G as un,H as ke,T as Zn,I as Me,h as bn,J as es,K as ts,L as ns,M as Un,N as yt,O as bt,j as ss,P as en,Q as qs,R as Gs,S as Ks}from"./index-C3h_KhGU.js";import{_ as ye,l as Js,c as Qs,r as Ys,p as Xs,j as Zs}from"./invites-BaasFUq0.js";async function ea(){const{data:e}=await K.get("/chats");return e}async function as(e){const{data:a}=await K.get(`/chats/${e}`);return a}async function ta(e){const{data:a}=await K.get(`/chats/by-name/${encodeURIComponent(e)}`);return a}async function et(e){const{data:a}=await K.post("/chats",e);return a}async function na(e){await K.post(`/chats/${e}/favorite`)}async function sa(e){await K.delete(`/chats/${e}/favorite`)}async function aa(e,a){await K.post(`/chats/${e}/mute`,{})}async function oa(e){await K.delete(`/chats/${e}/mute`)}async function ia(e){await K.delete(`/chats/${e}/leave`)}async function la(e){await K.post(`/chats/${e}/read`)}async function ra(e){await K.post(`/chats/${e}/pin`)}async function ca(e){await K.delete(`/chats/${e}/pin`)}async function ua(e){await K.post(`/chats/${e}/archive`)}async function da(e){await K.delete(`/chats/${e}/archive`)}async function va(e){const{data:a}=await K.get(`/chats/${e}`);return a.members??[]}async function os(e){await K.delete(`/chats/${e}`)}async function ma(e,a){const{data:n}=await K.patch(`/chats/${e}`,a);return n}const Se=Ge("chats",()=>{const e=b([]),a=b(null),n=b({}),o=b(new Set),s=b({}),i=B(()=>e.value.find(I=>I.id===a.value)??null),l=B(()=>[...e.value].sort((I,u)=>{if(I.is_pinned&&!u.is_pinned)return-1;if(!I.is_pinned&&u.is_pinned)return 1;if(I.is_favorite&&!u.is_favorite)return-1;if(!I.is_favorite&&u.is_favorite)return 1;const g=I.last_at||I.updated_at||"";return(u.last_at||u.updated_at||"").localeCompare(g)}));async function r(){try{e.value=await ea()}catch(I){console.error("Failed to load chats",I)}}function m(I){if(a.value=I,I!==null){const u=e.value.find(g=>g.id===I);u&&u.unread_count>0&&(u.unread_count=0,la(I).catch(()=>{}))}}async function w(I){const u=e.value.find(g=>g.id===I);if(u)try{u.is_favorite?await sa(I):await na(I),u.is_favorite=!u.is_favorite}catch(g){throw console.error("Failed to toggle favorite",g),g}}async function p(I){const u=e.value.find(g=>g.id===I);if(u)try{u.is_muted?await oa(I):await aa(I),u.is_muted=!u.is_muted}catch(g){throw console.error("Failed to toggle mute",g),g}}async function f(I){const u=e.value.find(g=>g.id===I);if(u)try{u.is_pinned?await ca(I):await ra(I),u.is_pinned=!u.is_pinned}catch(g){throw console.error("Failed to toggle pin",g),g}}async function c(I){const u=e.value.find(g=>g.id===I);if(u)try{u.is_archived?await da(I):await ua(I),u.is_archived=!u.is_archived}catch(g){throw console.error("Failed to toggle archive",g),g}}async function h(I){await ia(I),e.value=e.value.filter(u=>u.id!==I),a.value===I&&(a.value=null)}async function d(I){await os(I),e.value=e.value.filter(u=>u.id!==I),a.value===I&&(a.value=null)}function k(I,u,g){const A=e.value.find(T=>T.id===I);A&&(A.last_message=u,A.last_at=g)}function O(I){const u=e.value.find(g=>g.id===I);u&&(u.unread_count=(u.unread_count||0)+1)}function S(I,u,g){n.value[I]||(n.value[I]={});const A=n.value[I][u];A&&clearTimeout(A.timer);const T=setTimeout(()=>{_(I,u)},3e3);n.value[I][u]={username:g,timer:T}}function _(I,u){if(n.value[I]){const g=n.value[I][u];g&&(clearTimeout(g.timer),delete n.value[I][u])}}function L(I){const u=n.value[I];return u?Object.values(u).map(g=>g.username):[]}function H(I){o.value=new Set([...o.value,I]),s.value={...s.value,[I]:{isOnline:!0}}}function $(I,u,g){const A=new Set(o.value);A.delete(I),o.value=A,s.value={...s.value,[I]:{isOnline:!1,lastSeenAt:u,lastSeenBucket:g}}}function R(I,u){if(u.isOnline)o.value=new Set([...o.value,I]);else{const g=new Set(o.value);g.delete(I),o.value=g}s.value={...s.value,[I]:u}}function q(I){return s.value[I]}function X(I){return o.value.has(I)}return{chats:e,activeChatId:a,activeChat:i,sortedChats:l,typingUsers:n,loadChats:r,setActiveChat:m,toggleFavorite:w,toggleMute:p,togglePin:f,toggleArchive:c,leave:h,deleteChat:d,updateChatLastMessage:k,incrementUnread:O,setTyping:S,clearTyping:_,getTypingUsernames:L,onlineUsers:o,userPresenceDetails:s,setUserOnline:H,setUserOffline:$,setUserPresence:R,getUserPresence:q,isUserOnline:X}});async function fa(){const{data:e}=await K.get("/settings");return e}async function pa(e){await K.put("/settings",e)}const Gt=Ge("settings",()=>{const e=b(localStorage.getItem("theme")||"light"),a=b(!0),n=b("en"),o=b("everyone");function s(r){e.value=r,document.body.setAttribute("data-theme",r),localStorage.setItem("theme",r)}async function i(){try{const r=await fa();s(r.theme||"light"),a.value=r.notifications_enabled,n.value=r.language||"en",o.value=r.last_seen_visibility||"everyone"}catch(r){console.error("Failed to load settings",r)}}async function l(r){await pa(r),r.theme&&s(r.theme),r.notifications_enabled!==void 0&&(a.value=r.notifications_enabled),r.language&&(n.value=r.language),r.last_seen_visibility&&(o.value=r.last_seen_visibility)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:a,language:n,lastSeenVisibility:o,applyTheme:s,loadSettings:i,saveSettings:l}}),Kt=Ge("selection",()=>{const e=b(new Set),a=b(!1),n=b(null),o=B(()=>e.value.size);function s(w,p){a.value=!0,n.value=w,e.value=new Set(p!=null?[p]:[])}function i(){a.value=!1,n.value=null,e.value=new Set}function l(w){const p=new Set(e.value);p.has(w)?p.delete(w):p.add(w),e.value=p,p.size===0&&i()}function r(){e.value=new Set}function m(w){return e.value.has(w)}return{selectedMessageIds:e,selectionMode:a,currentChatId:n,selectedCount:o,enterSelectionMode:s,exitSelectionMode:i,toggleMessage:l,clearSelection:r,isSelected:m}});async function ht(e,a){const{data:n}=await K.get(`/chats/${e}/messages`,{params:a});return n}async function ha(e,a){const{data:n}=await K.post(`/chats/${e}/messages`,a);return n}async function ga(e,a){await K.delete(`/chats/${e}/messages/${a}`)}async function ya(e,a,n){const{data:o}=await K.put(`/chats/${e}/messages/${a}`,{content:n});return o}async function ba(e,a){const{data:n}=await K.post(`/chats/${e}/messages/forward`,a);return n}async function ka(e,a){const{data:n}=await K.post(`/chats/${e}/messages/${a}/pin`);return n}async function wa(e,a){await K.delete(`/chats/${e}/messages/${a}/pin`)}async function _a(e){const{data:a}=await K.get(`/chats/${e}/pinned-message`);return a}async function Fn(e,a,n){const{data:o}=await K.get(`/chats/${e}/messages/search`,{params:{q:a,...n}});return o}async function Ca(e,a,n){const{data:o}=await K.post(`/chats/${e}/messages/${a}/reactions`,{emoji:n});return o}async function $a(e,a){if(!a.length)return{};const{data:n}=await K.get(`/chats/${e}/reactions`,{params:{message_ids:a.join(",")}});return n}const Jt=Ge("messages",()=>{const e=b({}),a=b({}),n=b(null),o=b({}),s=b(new Set);async function i(u){const g=e.value[u];if(!g||g.length===0)return;const A=g.map(T=>T.id);try{const T=await $a(u,A);for(const M of g)M.reactions=T[String(M.id)]||void 0}catch(T){console.error("Failed to load reactions",T)}}async function l(u){n.value=u;try{const g=await ht(u,{limit:50});e.value[u]=g,g.length>0&&(a.value[u]=Math.max(...g.map(A=>A.id))),await i(u)}catch(g){throw console.error("Failed to load messages",g),g}finally{n.value=null}}async function r(u){const g=a.value[u]||0;if(g===0)return[];try{const A=await ht(u,{after_id:g,limit:50});if(A.length>0){e.value[u]||(e.value[u]=[]);const T=new Set(e.value[u].map(U=>U.id)),M=A.filter(U=>!T.has(U.id));e.value[u].push(...M),a.value[u]=Math.max(...A.map(U=>U.id)),await i(u)}return A}catch(A){return console.error("Failed to load newer messages",A),[]}}async function m(u){const g=e.value[u];if(!g||g.length===0)return[];const A=g[0];if(!A)return[];try{const T=await ht(u,{before:A.created_at,limit:50});if(T.length>0){const M=new Set(g.map(J=>J.id)),U=T.filter(J=>!M.has(J.id));e.value[u]=[...U,...g],await i(u)}return T}catch(T){return console.error("Failed to load older messages",T),[]}}async function w(u,g,A){try{const T=await Ca(u,g,A);p(u,g,T.action,A,!0)}catch(T){console.error("Failed to toggle reaction",T)}}function p(u,g,A,T,M){const U=e.value[u];if(!U)return;const J=U.find(be=>be.id===g);if(!J)return;J.reactions||(J.reactions=[]);const re=J.reactions.find(be=>be.emoji===T);A==="added"?re?(re.count++,M&&(re.me=!0)):J.reactions.push({emoji:T,count:1,me:M}):re&&(re.count--,M&&(re.me=!1),re.count<=0&&(J.reactions=J.reactions.filter(be=>be.emoji!==T))),J.reactions.length===0&&(J.reactions=void 0)}async function f(u,g,A="text",T){const M=await ha(u,{content:g,type:A,...T});e.value[u]||(e.value[u]=[]),c(u,M);const U=e.value[u].findIndex(J=>J.id===M.id);return U!==-1?e.value[u][U]=M:e.value[u].push(M),a.value[u]=Math.max(a.value[u]||0,M.id),M}function c(u,g){if(!g.reply_to_message_id||g.reply_to_sender_username||g.reply_to_sender_name)return;const A=e.value[u];if(!A)return;const T=A.find(M=>M.id===g.reply_to_message_id);T&&(g.reply_to_sender_username=T.sender_username,g.reply_to_sender_name=T.sender_display_name||T.sender_username,!g.reply_to_content&&T.content&&(g.reply_to_content=T.content),!g.reply_to_type&&T.message_type&&(g.reply_to_type=T.message_type))}function h(u,g){e.value[u]||(e.value[u]=[]),e.value[u].find(T=>T.id===g.id)||(c(u,g),e.value[u].push(g),a.value[u]=Math.max(a.value[u]||0,g.id))}async function d(u,g){try{await ga(u,g),k(u,g)}catch(A){throw console.error("Failed to delete message",A),A}}function k(u,g){const A=e.value[u];A&&(e.value[u]=A.filter(T=>T.id!==g))}async function O(u,g,A){try{const T=await ya(u,g,A);S(u,g,T.content,T.updated_at)}catch(T){throw console.error("Failed to edit message",T),T}}function S(u,g,A,T){const M=e.value[u];if(!M)return;const U=M.find(J=>J.id===g);U&&(U.content=A,U.is_edited=!0,T&&(U.updated_at=T))}async function _(u,g,A){try{const T=await ba(u,{from_chat_id:g,message_ids:A});for(const M of T)h(u,M);return T}catch(T){throw console.error("Failed to forward messages",T),T}}async function L(u){try{const g=await _a(u);g&&g.message?o.value[u]={message:g.message,pinnedAt:g.pinned_at,pinnedBy:g.pinned_by}:o.value[u]=null}catch(g){console.error("Failed to load pinned message",g),o.value[u]=null}}async function H(u,g){try{const A=await ka(u,g);o.value[u]={message:A.message,pinnedAt:A.pinned_at,pinnedBy:A.pinned_by},s.value.delete(u)}catch(A){throw console.error("Failed to pin message",A),A}}async function $(u,g){try{await wa(u,g),o.value[u]=null}catch(A){throw console.error("Failed to unpin message",A),A}}function R(u,g,A,T){o.value[u]={message:T,pinnedAt:new Date().toISOString(),pinnedBy:A},s.value.delete(u)}function q(u){o.value[u]=null}function X(u){s.value.add(u)}function I(u){return e.value[u]||[]}return{messagesByChat:e,lastMsgId:a,loadingChat:n,loadMessages:l,loadNewer:r,loadOlder:m,sendMessage:f,pushMessage:h,getMessages:I,toggleReaction:w,applyReactionUpdate:p,deleteMessage:d,removeMessage:k,editMessage:O,applyMessageUpdate:S,forwardMessages:_,pinnedByChat:o,pinnedDismissed:s,loadPinnedMessage:L,pinMsg:H,unpinMsg:$,applyMessagePinned:R,applyMessageUnpinned:q,dismissPin:X}});function Sa(e,a,n){if(!document.hidden||e.sender_id===n.user?.id||!Gt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||a.chats.find(m=>m.id===e.chat_id)?.is_muted)return;const i=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(i,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),a.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function Ma(){const e=b(!1);let a=null,n=null,o=null,s=1e3,i=!1,l=null,r=!document.hidden&&document.hasFocus(),m=!1;function w(R){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"presence_update",status:R}))}function p(){const R=!document.hidden&&document.hasFocus();R&&!r?(l&&(clearTimeout(l),l=null),r=!0,w("active")):!R&&r&&(l||(l=setTimeout(()=>{l=null,r=!1,w("away")},3e3)))}function f(){m||(m=!0,document.addEventListener("visibilitychange",p),window.addEventListener("focus",p),window.addEventListener("blur",p))}function c(){m&&(m=!1,document.removeEventListener("visibilitychange",p),window.removeEventListener("focus",p),window.removeEventListener("blur",p),l&&(clearTimeout(l),l=null))}function h(){const R=localStorage.getItem("access_token");return R?`wss://ws.behappy.rest/ws?token=${encodeURIComponent(R)}`:null}function d(){if(a&&(a.readyState===WebSocket.OPEN||a.readyState===WebSocket.CONNECTING))return;const R=h();R&&(i=!1,a=new WebSocket(R),a.onopen=()=>{e.value=!0,s=1e3,r=!document.hidden&&document.hasFocus();const q=localStorage.getItem("access_token");q&&a.send(JSON.stringify({type:"auth",token:q,active:r}));const X=Se();for(const I of X.chats)a.send(JSON.stringify({type:"subscribe",chat_id:I.id}));O(),f()},a.onmessage=q=>{try{const X=JSON.parse(q.data);k(X)}catch{}},a.onclose=()=>{e.value=!1,S(),i||_()},a.onerror=()=>{})}function k(R){const q=Jt(),X=Se(),I=Ee();switch(R.type){case"message":{const u=R;q.pushMessage(u.chat_id,u),X.updateChatLastMessage(u.chat_id,u.content||(u.message_type==="sticker"?"Sticker":"Attachment"),u.created_at),u.chat_id!==X.activeChatId&&u.sender_id!==I.user?.id&&X.incrementUnread(u.chat_id),X.clearTyping(u.chat_id,u.sender_id),Sa(u,X,I);break}case"typing":{const u=R.chat_id,g=R.user_id;if(g!==I.user?.id){const A=R.username||"Someone";X.setTyping(u,g,A)}break}case"pong":break;case"presence":{const u=R.user_id,g=R.status,A=R.last_seen_at,T=R.last_seen_bucket;if(g==="online")X.setUserOnline(u);else if(g==="offline"){const M=A||new Date().toISOString();X.setUserOffline(u,M,T)}break}case"message_deleted":{const u=R.chat_id,g=R.message_id;q.removeMessage(u,g);break}case"message_updated":{const u=R.chat_id,g=R.message_id,A=R.content,T=R.updated_at;q.applyMessageUpdate(u,g,A,T);break}case"message_pinned":{const u=R.chat_id,g=R.message_id,A=R.pinned_by,T=R.message;q.applyMessagePinned(u,g,A,T);break}case"message_unpinned":{const u=R.chat_id;q.applyMessageUnpinned(u);break}case"reaction":{const u=R.chat_id,g=R.message_id,A=R.user_id,T=R.emoji,M=R.action;q.applyReactionUpdate(u,g,M,T,A===I.user?.id);break}}}function O(){S(),o=setInterval(()=>{a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"ping"}))},25e3)}function S(){o&&(clearInterval(o),o=null)}function _(){n||(n=setTimeout(()=>{n=null,d(),s=Math.min(s*2,3e4)},s))}function L(R){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"subscribe",chat_id:R}))}function H(R){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"typing",chat_id:R}))}function $(){i=!0,S(),c(),n&&(clearTimeout(n),n=null),a&&(a.close(),a=null),e.value=!1}return He(()=>{$()}),{connected:e,connect:d,disconnect:$,subscribeToChat:L,sendTyping:H}}async function is(e){const{data:a}=await K.get(`/users/${e}`);return a}async function ls(e){const{data:a}=await K.get(`/users/by-username/${encodeURIComponent(e)}`);return a}async function Bn(e){const{data:a}=await K.get("/users/search",{params:{q:e}});return a}async function xa(e,a){const{data:n}=await K.put(`/users/${e}`,a);return n}async function Ta(e){const{data:a}=await K.put("/users/me/avatar",{file_id:e});return a}async function Ea(){const{data:e}=await K.get("/stickers");return e}const La=e=>{for(const a in e)if(a.startsWith("aria-")||a==="role"||a==="title")return!0;return!1};const Hn=e=>e==="";const Ia=(...e)=>e.filter((a,n,o)=>!!a&&a.trim()!==""&&o.indexOf(a)===n).join(" ").trim();const jn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const Aa=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,n,o)=>o?o.toUpperCase():n.toLowerCase());const Da=e=>{const a=Aa(e);return a.charAt(0).toUpperCase()+a.slice(1)};var Qe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Ra=({name:e,iconNode:a,absoluteStrokeWidth:n,"absolute-stroke-width":o,strokeWidth:s,"stroke-width":i,size:l=Qe.width,color:r=Qe.stroke,...m},{slots:w})=>cn("svg",{...Qe,...m,width:l,height:l,stroke:r,"stroke-width":Hn(n)||Hn(o)||n===!0||o===!0?Number(s||i||Qe["stroke-width"])*24/Number(l):s||i||Qe["stroke-width"],class:Ia("lucide",m.class,...e?[`lucide-${jn(Da(e))}-icon`,`lucide-${jn(e)}`]:["lucide-icon"]),...!w.default&&!La(m)&&{"aria-hidden":"true"}},[...a.map(p=>cn(...p)),...w.default?[w.default()]:[]]);const oe=(e,a)=>(n,{slots:o,attrs:s})=>cn(Ra,{...s,...n,iconNode:a,name:e},o);const Ve=oe("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Oa=oe("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const Pa=oe("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const rs=oe("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Na=oe("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const Ua=oe("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Fa=oe("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Ba=oe("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const Ha=oe("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const ja=oe("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const kn=oe("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const cs=oe("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const za=oe("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const Va=oe("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const Wa=oe("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const qa=oe("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Ga=oe("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Ka=oe("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Ja=oe("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const Qa=oe("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const us=oe("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const ds=oe("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const wn=oe("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const je=oe("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ya={class:"swipe-actions swipe-actions-left"},Xa={class:"chat-item-info"},Za={class:"chat-item-top"},eo={class:"chat-item-name"},to={key:0,class:"pin-icon",title:"Pinned"},no={key:1,class:"ci-channel"},so={key:2,class:"ci-group"},ao={key:3,class:"mute-icon",title:"Muted"},oo={class:"chat-item-time"},io={class:"chat-item-bottom"},lo={class:"chat-item-preview"},ro=["title"],co={class:"swipe-actions swipe-actions-right"},zn=70,uo=Z({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:a}){const n=e,o=Se(),s=Ee(),i=B(()=>n.chat.type==="direct"&&!n.chat.other_user_id),l=B(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:o.isUserOnline(n.chat.other_user_id)||null),r=B(()=>(n.chat.unread_count??0)>0),m=a,w=B(()=>{const S=n.chat;return i.value?"Saved Messages":S.type==="channel"||S.type==="group"?S.title||S.name||"Untitled":S.other_display_name||S.other_username||S.title||S.name||"Chat"});function p(S){if(!S)return"";const _=new Date(S.endsWith("Z")?S:S+"Z"),L=new Date;return _.toDateString()===L.toDateString()?_.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):_.toLocaleDateString([],{month:"short",day:"numeric"})}const f=b(0);let c=0,h=!1;function d(S){c=S.touches[0].clientX,h=!0}function k(S){if(!h)return;const _=S.touches[0].clientX-c;f.value=Math.max(-zn,Math.min(zn,_))}function O(){h=!1,f.value=0}return(S,_)=>(v(),y("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:d,onTouchmove:k,onTouchend:O},[t("div",Ya,[t("button",{class:"swipe-action swipe-pin",onClick:_[0]||(_[0]=L=>m("togglePin"))},D(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:ve(["chat-item",{active:e.active,"chat-item-unread":r.value}]),style:ct({transform:`translateX(${f.value}px)`}),onClick:_[2]||(_[2]=L=>m("select")),onContextmenu:_[3]||(_[3]=ae(L=>m("contextmenu",L),["prevent"]))},[j(ye,{name:w.value,url:i.value?x(s).user?.avatar_url||null:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"sm",online:l.value},null,8,["name","url","online"]),t("div",Xa,[t("div",Za,[t("span",eo,[e.chat.is_pinned?(v(),y("span",to,"ğŸ“Œ")):F("",!0),e.chat.type==="channel"?(v(),y("span",no)):e.chat.type==="group"?(v(),y("span",so)):F("",!0),_e(" "+D(w.value)+" ",1),e.chat.is_muted?(v(),y("span",ao,"ğŸ””")):F("",!0)]),t("span",oo,D(p(e.chat.last_at||e.chat.updated_at)),1)]),t("div",io,[t("span",lo,D(e.chat.last_message||""),1),e.chat.unread_count>0?(v(),y("span",{key:0,class:ve(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},D(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):F("",!0)])]),t("button",{class:ve(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:_[1]||(_[1]=ae(L=>m("toggleFavorite"),["stop"]))},"â˜…",10,ro)],38),t("div",co,[t("button",{class:"swipe-action swipe-mute",onClick:_[4]||(_[4]=L=>m("toggleMute"))},D(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),me=(e,a)=>{const n=e.__vccOpts||e;for(const[o,s]of a)n[o]=s;return n},tn=me(uo,[["__scopeId","data-v-c5aa49d4"]]),vo={class:"sidebar"},mo={class:"sidebar-header"},fo={class:"search-wrap"},po={class:"chat-list"},ho={key:0,class:"empty-state-small"},go={key:0,class:"chat-section-label"},yo={key:1,class:"chat-section-label"},bo={key:2,class:"chat-section-label"},ko=Z({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:a}){const n=a,o=Se(),s=b(""),i=B(()=>{const c=s.value.toLowerCase(),h=o.sortedChats.filter(d=>!d.is_archived);return c?h.filter(d=>{const k=w(d).toLowerCase(),O=(d.other_username||"").toLowerCase();return k.includes(c)||O.includes(c)}):h}),l=B(()=>i.value.filter(c=>c.is_pinned&&!c.is_favorite)),r=B(()=>i.value.filter(c=>c.is_favorite&&!c.is_pinned)),m=B(()=>i.value.filter(c=>!c.is_favorite&&!c.is_pinned));function w(c){return c.type==="channel"||c.type==="group"?c.title||c.name||"Untitled":c.type==="direct"&&!c.other_user_id?"Saved Messages":c.other_display_name||c.other_username||c.title||c.name||"Chat"}const p=b(null);pt("contextChatId",p);function f(c,h){c.preventDefault(),p.value=h,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:c.clientX,y:c.clientY,chatId:h}}))}return(c,h)=>(v(),y("aside",vo,[t("header",mo,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:h[0]||(h[0]=d=>n("openDrawer"))},[j(x(za),{size:20})]),t("div",fo,[te(t("input",{"onUpdate:modelValue":h[1]||(h[1]=d=>s.value=d),class:"search-input",type:"search",placeholder:"Search chats..."},null,512),[[de,s.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:h[2]||(h[2]=d=>n("openNewChat"))},[j(x(Ja),{size:20})])]),t("div",po,[i.value.length===0?(v(),y("div",ho,[...h[3]||(h[3]=[_e(" No conversations yet.",-1),t("br",null,null,-1),_e("Click the pencil icon to start one. ",-1)])])):(v(),y(se,{key:1},[l.value.length>0?(v(),y("div",go,"Pinned")):F("",!0),(v(!0),y(se,null,fe(l.value,d=>(v(),Y(tn,{key:d.id,chat:d,active:d.id===x(o).activeChatId,onSelect:k=>n("selectChat",d.id),onToggleFavorite:k=>x(o).toggleFavorite(d.id),onTogglePin:k=>x(o).togglePin(d.id),onToggleMute:k=>x(o).toggleMute(d.id),onToggleArchive:k=>x(o).toggleArchive(d.id),onContextmenu:k=>f(k,d.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(v(),y("div",yo,"Starred")):F("",!0),(v(!0),y(se,null,fe(r.value,d=>(v(),Y(tn,{key:d.id,chat:d,active:d.id===x(o).activeChatId,onSelect:k=>n("selectChat",d.id),onToggleFavorite:k=>x(o).toggleFavorite(d.id),onTogglePin:k=>x(o).togglePin(d.id),onToggleMute:k=>x(o).toggleMute(d.id),onToggleArchive:k=>x(o).toggleArchive(d.id),onContextmenu:k=>f(k,d.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&m.value.length>0?(v(),y("div",bo," All chats ")):F("",!0),(v(!0),y(se,null,fe(m.value,d=>(v(),Y(tn,{key:d.id,chat:d,active:d.id===x(o).activeChatId,onSelect:k=>n("selectChat",d.id),onToggleFavorite:k=>x(o).toggleFavorite(d.id),onTogglePin:k=>x(o).togglePin(d.id),onToggleMute:k=>x(o).toggleMute(d.id),onToggleArchive:k=>x(o).toggleArchive(d.id),onContextmenu:k=>f(k,d.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function wo(){const e=b(!1),a=b(0);let n=null,o=[],s=null;async function i(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const p=await navigator.mediaDevices.getUserMedia({audio:!0});o=[],a.value=0,n=new MediaRecorder(p),n.ondataavailable=f=>{f.data.size&&o.push(f.data)},n.start(),e.value=!0,s=setInterval(()=>{a.value++},1e3)}function l(){return new Promise((p,f)=>{if(!n||n.state!=="recording"){f(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(O=>O.stop()),m(),e.value=!1;const c=n?.mimeType||"audio/webm",h=c.includes("ogg")?"ogg":"webm",d=new Blob(o,{type:c}),k=new File([d],`voice.${h}`,{type:c});p(k)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(p=>p.stop())},n.stop()),m(),e.value=!1,a.value=0}function m(){s&&(clearInterval(s),s=null)}function w(p){const f=Math.floor(p/60),c=p%60;return`${f}:${String(c).padStart(2,"0")}`}return{isRecording:e,seconds:a,startRecording:i,stopRecording:l,cancelRecording:r,formatTime:w}}async function _n(e){const a=new FormData;a.append("file",e);const{data:n}=await K.post("/files",a);return n}const _o={class:"pin-bar-content"},Co={class:"pin-bar-sender"},$o={class:"pin-bar-text"},So=Z({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const a=e,n=B(()=>a.message.sender_display_name||a.message.sender_username||"Unknown"),o=B(()=>{const s=a.message;switch(s.message_type){case"sticker":return s.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return s.content||""}});return(s,i)=>(v(),y("div",{class:"pin-bar",onClick:i[1]||(i[1]=l=>s.$emit("click"))},[i[2]||(i[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",_o,[t("span",Co,D(n.value),1),t("span",$o,D(o.value),1)]),t("button",{class:"pin-bar-close",onClick:i[0]||(i[0]=ae(l=>s.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}});function vs(e){const a=new Date(e),o=new Date().getTime()-a.getTime(),s=Math.floor(o/1e3),i=Math.floor(s/60),l=Math.floor(i/60),r=Math.floor(l/24);if(i<1)return"last seen just now";if(i<60)return`last seen ${i} minute${i!==1?"s":""} ago`;if(l<24)return`last seen ${l} hour${l!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const m=a.toLocaleString("en",{month:"short"}),w=a.getDate();return`last seen ${m} ${w}`}const Mo={class:"chat-header"},xo={class:"chat-header-name"},To=Z({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:a}){const n=a,o=Se(),s=Ee(),i=B(()=>o.activeChat),l=B(()=>{const d=i.value;return d?.type==="direct"&&!d.other_user_id}),r=B(()=>{const d=i.value;return d?l.value?"Saved Messages":d.type==="channel"||d.type==="group"?d.title||d.name||"Untitled":d.other_display_name||d.other_username||d.title||d.name||"Chat":"---"}),m=B(()=>{const d=i.value;if(d)return l.value?s.user?.avatar_url:d.type==="direct"?d.other_avatar_url:d.avatar_url}),w=B(()=>i.value?o.getTypingUsernames(i.value.id):[]),p=B(()=>w.value.length>0),f=B(()=>{const d=i.value;return!d||d.type!=="direct"||!d.other_user_id?!1:o.isUserOnline(d.other_user_id)}),c=B(()=>{if(w.value.length===1)return`${w.value[0]} is typing...`;if(w.value.length>1)return`${w.value.length} people typing...`;const d=i.value;if(!d)return"";if(l.value)return"personal storage";if(d.type==="channel"){const k=d.member_count??0;return`${k} subscriber${k!==1?"s":""}`}if(d.type==="group"){const k=d.member_count??0;return`${k} member${k!==1?"s":""}`}if(f.value)return"online";if(d.type==="direct"&&d.other_user_id){const k=o.getUserPresence(d.other_user_id);if(k){if(k.lastSeenAt)return vs(k.lastSeenAt);if(k.lastSeenBucket)return`last seen ${k.lastSeenBucket}`}}return d.other_username?"@"+d.other_username:""});De(()=>i.value?.id,()=>{const d=i.value;if(!d||d.type!=="direct"||!d.other_user_id)return;const k=d.other_user_id;o.getUserPresence(k)||is(k).then(O=>{O.last_activity&&o.setUserPresence(k,{isOnline:o.isUserOnline(k),lastSeenAt:O.last_activity})}).catch(()=>{})},{immediate:!0});function h(){const d=i.value;d&&(d.type==="channel"||d.type==="group"?n("openChannelInfo"):d.type==="direct"&&d.other_username&&n("openUserProfile",d.other_username))}return(d,k)=>(v(),y("header",Mo,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:k[0]||(k[0]=O=>n("back"))},"â†"),j(ye,{class:"chat-header-avatar",name:r.value,url:m.value,online:f.value,size:"sm",onClick:h},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:h},[t("div",xo,D(r.value),1),c.value?(v(),y("div",{key:0,class:ve(["chat-header-sub",{"typing-text":p.value,"online-text":f.value&&!p.value}])},D(c.value),3)):F("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:k[1]||(k[1]=O=>n("openSearch"))},"ğŸ”")]))}}),Eo="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Lo="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",dn="numeric",vn="ascii",mn="alpha",tt="asciinumeric",Xe="alphanumeric",fn="domain",ms="emoji",Io="scheme",Ao="slashscheme",nn="whitespace";function Do(e,a){return e in a||(a[e]=[]),a[e]}function ze(e,a,n){a[dn]&&(a[tt]=!0,a[Xe]=!0),a[vn]&&(a[tt]=!0,a[mn]=!0),a[tt]&&(a[Xe]=!0),a[mn]&&(a[Xe]=!0),a[Xe]&&(a[fn]=!0),a[ms]&&(a[fn]=!0);for(const o in a){const s=Do(o,n);s.indexOf(e)<0&&s.push(e)}}function Ro(e,a){const n={};for(const o in a)a[o].indexOf(e)>=0&&(n[o]=!0);return n}function we(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}we.groups={};we.prototype={accepts(){return!!this.t},go(e){const a=this,n=a.j[e];if(n)return n;for(let o=0;o<a.jr.length;o++){const s=a.jr[o][0],i=a.jr[o][1];if(i&&s.test(e))return i}return a.jd},has(e,a=!1){return a?e in this.j:!!this.go(e)},ta(e,a,n,o){for(let s=0;s<e.length;s++)this.tt(e[s],a,n,o)},tr(e,a,n,o){o=o||we.groups;let s;return a&&a.j?s=a:(s=new we(a),n&&o&&ze(a,n,o)),this.jr.push([e,s]),s},ts(e,a,n,o){let s=this;const i=e.length;if(!i)return s;for(let l=0;l<i-1;l++)s=s.tt(e[l]);return s.tt(e[i-1],a,n,o)},tt(e,a,n,o){o=o||we.groups;const s=this;if(a&&a.j)return s.j[e]=a,a;const i=a;let l,r=s.go(e);if(r?(l=new we,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new we,i){if(o)if(l.t&&typeof l.t=="string"){const m=Object.assign(Ro(l.t,o),n);ze(i,m,o)}else n&&ze(i,n,o);l.t=i}return s.j[e]=l,l}};const G=(e,a,n,o,s)=>e.ta(a,n,o,s),le=(e,a,n,o,s)=>e.tr(a,n,o,s),Vn=(e,a,n,o,s)=>e.ts(a,n,o,s),E=(e,a,n,o,s)=>e.tt(a,n,o,s),Pe="WORD",pn="UWORD",fs="ASCIINUMERICAL",ps="ALPHANUMERICAL",lt="LOCALHOST",hn="TLD",gn="UTLD",gt="SCHEME",qe="SLASH_SCHEME",Cn="NUM",yn="WS",$n="NL",nt="OPENBRACE",st="CLOSEBRACE",kt="OPENBRACKET",wt="CLOSEBRACKET",_t="OPENPAREN",Ct="CLOSEPAREN",$t="OPENANGLEBRACKET",St="CLOSEANGLEBRACKET",Mt="FULLWIDTHLEFTPAREN",xt="FULLWIDTHRIGHTPAREN",Tt="LEFTCORNERBRACKET",Et="RIGHTCORNERBRACKET",Lt="LEFTWHITECORNERBRACKET",It="RIGHTWHITECORNERBRACKET",At="FULLWIDTHLESSTHAN",Dt="FULLWIDTHGREATERTHAN",Rt="AMPERSAND",Ot="APOSTROPHE",Pt="ASTERISK",Fe="AT",Nt="BACKSLASH",Ut="BACKTICK",Ft="CARET",Be="COLON",Sn="COMMA",Bt="DOLLAR",Ie="DOT",Ht="EQUALS",Mn="EXCLAMATION",$e="HYPHEN",at="PERCENT",jt="PIPE",zt="PLUS",Vt="POUND",ot="QUERY",xn="QUOTE",hs="FULLWIDTHMIDDLEDOT",Tn="SEMI",Ae="SLASH",it="TILDE",Wt="UNDERSCORE",gs="EMOJI",qt="SYM";var ys=Object.freeze({__proto__:null,ALPHANUMERICAL:ps,AMPERSAND:Rt,APOSTROPHE:Ot,ASCIINUMERICAL:fs,ASTERISK:Pt,AT:Fe,BACKSLASH:Nt,BACKTICK:Ut,CARET:Ft,CLOSEANGLEBRACKET:St,CLOSEBRACE:st,CLOSEBRACKET:wt,CLOSEPAREN:Ct,COLON:Be,COMMA:Sn,DOLLAR:Bt,DOT:Ie,EMOJI:gs,EQUALS:Ht,EXCLAMATION:Mn,FULLWIDTHGREATERTHAN:Dt,FULLWIDTHLEFTPAREN:Mt,FULLWIDTHLESSTHAN:At,FULLWIDTHMIDDLEDOT:hs,FULLWIDTHRIGHTPAREN:xt,HYPHEN:$e,LEFTCORNERBRACKET:Tt,LEFTWHITECORNERBRACKET:Lt,LOCALHOST:lt,NL:$n,NUM:Cn,OPENANGLEBRACKET:$t,OPENBRACE:nt,OPENBRACKET:kt,OPENPAREN:_t,PERCENT:at,PIPE:jt,PLUS:zt,POUND:Vt,QUERY:ot,QUOTE:xn,RIGHTCORNERBRACKET:Et,RIGHTWHITECORNERBRACKET:It,SCHEME:gt,SEMI:Tn,SLASH:Ae,SLASH_SCHEME:qe,SYM:qt,TILDE:it,TLD:hn,UNDERSCORE:Wt,UTLD:gn,UWORD:pn,WORD:Pe,WS:yn});const Re=/[a-z]/,Ye=new RegExp("\\p{L}","u"),sn=new RegExp("\\p{Emoji}","u"),Oe=/\d/,an=/\s/,Wn="\r",on=`
`,Oo="ï¸",Po="â€",ln="ï¿¼";let vt=null,mt=null;function No(e=[]){const a={};we.groups=a;const n=new we;vt==null&&(vt=qn(Eo)),mt==null&&(mt=qn(Lo)),E(n,"'",Ot),E(n,"{",nt),E(n,"}",st),E(n,"[",kt),E(n,"]",wt),E(n,"(",_t),E(n,")",Ct),E(n,"<",$t),E(n,">",St),E(n,"ï¼ˆ",Mt),E(n,"ï¼‰",xt),E(n,"ã€Œ",Tt),E(n,"ã€",Et),E(n,"ã€",Lt),E(n,"ã€",It),E(n,"ï¼œ",At),E(n,"ï¼",Dt),E(n,"&",Rt),E(n,"*",Pt),E(n,"@",Fe),E(n,"`",Ut),E(n,"^",Ft),E(n,":",Be),E(n,",",Sn),E(n,"$",Bt),E(n,".",Ie),E(n,"=",Ht),E(n,"!",Mn),E(n,"-",$e),E(n,"%",at),E(n,"|",jt),E(n,"+",zt),E(n,"#",Vt),E(n,"?",ot),E(n,'"',xn),E(n,"/",Ae),E(n,";",Tn),E(n,"~",it),E(n,"_",Wt),E(n,"\\",Nt),E(n,"ãƒ»",hs);const o=le(n,Oe,Cn,{[dn]:!0});le(o,Oe,o);const s=le(o,Re,fs,{[tt]:!0}),i=le(o,Ye,ps,{[Xe]:!0}),l=le(n,Re,Pe,{[vn]:!0});le(l,Oe,s),le(l,Re,l),le(s,Oe,s),le(s,Re,s);const r=le(n,Ye,pn,{[mn]:!0});le(r,Re),le(r,Oe,i),le(r,Ye,r),le(i,Oe,i),le(i,Re),le(i,Ye,i);const m=E(n,on,$n,{[nn]:!0}),w=E(n,Wn,yn,{[nn]:!0}),p=le(n,an,yn,{[nn]:!0});E(n,ln,p),E(w,on,m),E(w,ln,p),le(w,an,p),E(p,Wn),E(p,on),le(p,an,p),E(p,ln,p);const f=le(n,sn,gs,{[ms]:!0});E(f,"#"),le(f,sn,f),E(f,Oo,f);const c=E(f,Po);E(c,"#"),le(c,sn,f);const h=[[Re,l],[Oe,s]],d=[[Re,null],[Ye,r],[Oe,i]];for(let k=0;k<vt.length;k++)Ue(n,vt[k],hn,Pe,h);for(let k=0;k<mt.length;k++)Ue(n,mt[k],gn,pn,d);ze(hn,{tld:!0,ascii:!0},a),ze(gn,{utld:!0,alpha:!0},a),Ue(n,"file",gt,Pe,h),Ue(n,"mailto",gt,Pe,h),Ue(n,"http",qe,Pe,h),Ue(n,"https",qe,Pe,h),Ue(n,"ftp",qe,Pe,h),Ue(n,"ftps",qe,Pe,h),ze(gt,{scheme:!0,ascii:!0},a),ze(qe,{slashscheme:!0,ascii:!0},a),e=e.sort((k,O)=>k[0]>O[0]?1:-1);for(let k=0;k<e.length;k++){const O=e[k][0],_=e[k][1]?{[Io]:!0}:{[Ao]:!0};O.indexOf("-")>=0?_[fn]=!0:Re.test(O)?Oe.test(O)?_[tt]=!0:_[vn]=!0:_[dn]=!0,Vn(n,O,O,_)}return Vn(n,"localhost",lt,{ascii:!0}),n.jd=new we(qt),{start:n,tokens:Object.assign({groups:a},ys)}}function bs(e,a){const n=Uo(a.replace(/[A-Z]/g,r=>r.toLowerCase())),o=n.length,s=[];let i=0,l=0;for(;l<o;){let r=e,m=null,w=0,p=null,f=-1,c=-1;for(;l<o&&(m=r.go(n[l]));)r=m,r.accepts()?(f=0,c=0,p=r):f>=0&&(f+=n[l].length,c++),w+=n[l].length,i+=n[l].length,l++;i-=f,l-=c,w-=f,s.push({t:p.t,v:a.slice(i-w,i),s:i-w,e:i})}return s}function Uo(e){const a=[],n=e.length;let o=0;for(;o<n;){let s=e.charCodeAt(o),i,l=s<55296||s>56319||o+1===n||(i=e.charCodeAt(o+1))<56320||i>57343?e[o]:e.slice(o,o+2);a.push(l),o+=l.length}return a}function Ue(e,a,n,o,s){let i;const l=a.length;for(let r=0;r<l-1;r++){const m=a[r];e.j[m]?i=e.j[m]:(i=new we(o),i.jr=s.slice(),e.j[m]=i),e=i}return i=new we(n),i.jr=s.slice(),e.j[a[l-1]]=i,i}function qn(e){const a=[],n=[];let o=0,s="0123456789";for(;o<e.length;){let i=0;for(;s.indexOf(e[o+i])>=0;)i++;if(i>0){a.push(n.join(""));for(let l=parseInt(e.substring(o,o+i),10);l>0;l--)n.pop();o+=i}else n.push(e[o]),o++}return a}const rt={defaultProtocol:"http",events:null,format:Gn,formatHref:Gn,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function En(e,a=null){let n=Object.assign({},rt);e&&(n=Object.assign(n,e instanceof En?e.o:e));const o=n.ignoreTags,s=[];for(let i=0;i<o.length;i++)s.push(o[i].toUpperCase());this.o=n,a&&(this.defaultRender=a),this.ignoreTags=s}En.prototype={o:rt,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,a,n){const o=a!=null;let s=this.o[e];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:rt[e],typeof s=="function"&&o&&(s=s(a,n))):typeof s=="function"&&o&&(s=s(a,n.t,n)),s)},getObj(e,a,n){let o=this.o[e];return typeof o=="function"&&a!=null&&(o=o(a,n.t,n)),o},render(e){const a=e.render(this);return(this.get("render",null,e)||this.defaultRender)(a,e.t,e)}};function Gn(e){return e}function ks(e,a){this.t="token",this.v=e,this.tk=a}ks.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const a=this.toString(),n=e.get("truncate",a,this),o=e.get("format",a,this);return n&&o.length>n?o.substring(0,n)+"â€¦":o},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=rt.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const a=this,n=this.toHref(e.get("defaultProtocol")),o=e.get("formatHref",n,this),s=e.get("tagName",n,a),i=this.toFormattedString(e),l={},r=e.get("className",n,a),m=e.get("target",n,a),w=e.get("rel",n,a),p=e.getObj("attributes",n,a),f=e.getObj("events",n,a);return l.href=o,r&&(l.class=r),m&&(l.target=m),w&&(l.rel=w),p&&Object.assign(l,p),{tagName:s,attributes:l,content:i,eventListeners:f}}};function Qt(e,a){class n extends ks{constructor(s,i){super(s,i),this.t=e}}for(const o in a)n.prototype[o]=a[o];return n.t=e,n}const Kn=Qt("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Jn=Qt("text"),Fo=Qt("nl"),ft=Qt("url",{isLink:!0,toHref(e=rt.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==lt&&e[1].t===Be}}),Ce=e=>new we(e);function Bo({groups:e}){const a=e.domain.concat([Rt,Pt,Fe,Nt,Ut,Ft,Bt,Ht,$e,Cn,at,jt,zt,Vt,Ae,qt,it,Wt]),n=[Ot,Be,Sn,Ie,Mn,at,ot,xn,Tn,$t,St,nt,st,wt,kt,_t,Ct,Mt,xt,Tt,Et,Lt,It,At,Dt],o=[Rt,Ot,Pt,Nt,Ut,Ft,Bt,Ht,$e,nt,st,at,jt,zt,Vt,ot,Ae,qt,it,Wt],s=Ce(),i=E(s,it);G(i,o,i),G(i,e.domain,i);const l=Ce(),r=Ce(),m=Ce();G(s,e.domain,l),G(s,e.scheme,r),G(s,e.slashscheme,m),G(l,o,i),G(l,e.domain,l);const w=E(l,Fe);E(i,Fe,w),E(r,Fe,w),E(m,Fe,w);const p=E(i,Ie);G(p,o,i),G(p,e.domain,i);const f=Ce();G(w,e.domain,f),G(f,e.domain,f);const c=E(f,Ie);G(c,e.domain,f);const h=Ce(Kn);G(c,e.tld,h),G(c,e.utld,h),E(w,lt,h);const d=E(f,$e);E(d,$e,d),G(d,e.domain,f),G(h,e.domain,f),E(h,Ie,c),E(h,$e,d);const k=E(h,Be);G(k,e.numeric,Kn);const O=E(l,$e),S=E(l,Ie);E(O,$e,O),G(O,e.domain,l),G(S,o,i),G(S,e.domain,l);const _=Ce(ft);G(S,e.tld,_),G(S,e.utld,_),G(_,e.domain,l),G(_,o,i),E(_,Ie,S),E(_,$e,O),E(_,Fe,w);const L=E(_,Be),H=Ce(ft);G(L,e.numeric,H);const $=Ce(ft),R=Ce();G($,a,$),G($,n,R),G(R,a,$),G(R,n,R),E(_,Ae,$),E(H,Ae,$);const q=E(r,Be),X=E(m,Be),I=E(X,Ae),u=E(I,Ae);G(r,e.domain,l),E(r,Ie,S),E(r,$e,O),G(m,e.domain,l),E(m,Ie,S),E(m,$e,O),G(q,e.domain,$),E(q,Ae,$),E(q,ot,$),G(u,e.domain,$),G(u,a,$),E(u,Ae,$);const g=[[nt,st],[kt,wt],[_t,Ct],[$t,St],[Mt,xt],[Tt,Et],[Lt,It],[At,Dt]];for(let A=0;A<g.length;A++){const[T,M]=g[A],U=E($,T);E(R,T,U),E(U,M,$);const J=Ce(ft);G(U,a,J);const re=Ce();G(U,n),G(J,a,J),G(J,n,re),G(re,a,J),G(re,n,re),E(J,M,$),E(re,M,$)}return E(s,lt,_),E(s,$n,Fo),{start:s,tokens:ys}}function Ho(e,a,n){let o=n.length,s=0,i=[],l=[];for(;s<o;){let r=e,m=null,w=null,p=0,f=null,c=-1;for(;s<o&&!(m=r.go(n[s].t));)l.push(n[s++]);for(;s<o&&(w=m||r.go(n[s].t));)m=null,r=w,r.accepts()?(c=0,f=r):c>=0&&c++,s++,p++;if(c<0)s-=p,s<o&&(l.push(n[s]),s++);else{l.length>0&&(i.push(rn(Jn,a,l)),l=[]),s-=c,p-=c;const h=f.t,d=n.slice(s-p,s);i.push(rn(h,a,d))}}return l.length>0&&i.push(rn(Jn,a,l)),i}function rn(e,a,n){const o=n[0].s,s=n[n.length-1].e,i=a.slice(o,s);return new e(i,n)}const he={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function jo(){he.scanner=No(he.customSchemes);for(let e=0;e<he.tokenQueue.length;e++)he.tokenQueue[e][1]({scanner:he.scanner});he.parser=Bo(he.scanner.tokens);for(let e=0;e<he.pluginQueue.length;e++)he.pluginQueue[e][1]({scanner:he.scanner,parser:he.parser});return he.initialized=!0,he}function ws(e){return he.initialized||jo(),Ho(he.parser.start,e,bs(he.scanner.start,e))}ws.scan=bs;function _s(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function zo(e){return e.replace(/"/g,"&quot;")}function Vo(e){const a=[];for(const n in e){let o=e[n]+"";a.push(`${n}="${zo(o)}"`)}return a.join(" ")}function Wo({tagName:e,attributes:a,content:n}){return`<${e} ${Vo(a)}>${_s(n)}</${e}>`}function Cs(e,a={}){a=new En(a,Wo);const n=ws(e),o=[];for(let s=0;s<n.length;s++){const i=n[s];i.t==="nl"&&a.get("nl2br")?o.push(`<br>
`):!i.isLink||!a.check(i)?o.push(_s(i.toString())):o.push(a.render(i))}return o.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(a){return Cs(this,a)}});const qo={},Go={class:"admin-badge",title:"Admin"};function Ko(e,a){return v(),y("span",Go,"âœ“")}const $s=me(qo,[["render",Ko]]);function Jo(e){const{delay:a=500,scrollThreshold:n=5,onLongPress:o,onCancel:s}=e,i=b(!1);let l=null,r=0,m=0,w=!1;function p(){l&&(clearTimeout(l),l=null)}function f(k){r=k.clientX,m=k.clientY,w=!1,i.value=!0,p(),l=setTimeout(()=>{w=!0,o(k)},a)}function c(k){if(!l)return;const O=k.clientX-r,S=k.clientY-m;(Math.abs(O)>n||Math.abs(S)>n)&&d()}function h(){p(),i.value=!1}function d(){p(),i.value=!1,w||s?.()}return{isPressed:i,onPointerDown:f,onPointerUp:h,onPointerMove:c}}const Qo=["data-message-id"],Yo={key:0,class:"selection-checkbox"},Xo=["checked"],Zo={key:1,class:"msg-sender-name"},ei={class:"msg-content-wrap"},ti={key:0,class:"msg-forwarded-label"},ni={class:"msg-reply-quote-name"},si={class:"msg-reply-quote-text"},ai={key:2,class:"msg-bubble sticker-bubble"},oi=["src","alt"],ii={key:3,class:"msg-bubble"},li={class:"voice-player"},ri={class:"voice-dur"},ci=["innerHTML"],ui={key:5,class:"reaction-chips"},di=["onClick"],vi={class:"reaction-emoji"},mi={class:"reaction-count"},fi={class:"msg-time"},pi={key:0,class:"msg-edited-label"},hi=Z({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:a}){const n=e,o=a,s=Kt(),i=Se(),l=B(()=>s.isSelected(n.message.id)),{onPointerDown:r,onPointerUp:m,onPointerMove:w}=Jo({delay:500,onLongPress(V){c(V.clientX,V.clientY)}}),p={onPointerdown:r,onPointerup:m,onPointermove:w};function f(V){if(s.selectionMode){s.toggleMessage(n.message.id);return}c(V.clientX,V.clientY)}function c(V,Q){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:i.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:V,y:Q}}))}function h(){s.selectionMode&&s.toggleMessage(n.message.id)}const d=Ee(),k=B(()=>{if(!n.message.forwarded_from_chat_id)return null;const V=n.message.forwarded_from_user_id;if(V&&V===d.user?.id)return null;const Q=n.message.forwarded_from_display_name;return Q?`Forwarded from ${Q}`:"Forwarded"}),O=Ze("stickers",b([])),S=B(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const V=O.value.find(Q=>Q.id===n.message.sticker_id);if(V)return V.url}return""}),_=B(()=>n.message.attachment_url||""),L=b(!1),H=b(0),$=b(0),R=b(n.message.duration_seconds||0);let q=null,X=null;function I(){return q||(q=new Audio(_.value),q.addEventListener("loadedmetadata",()=>{q&&isFinite(q.duration)&&(R.value=q.duration)}),q.addEventListener("ended",()=>{L.value=!1,H.value=0,$.value=0,g()})),q}function u(){if(q&&L.value){$.value=q.currentTime;const V=q.duration;H.value=V&&isFinite(V)?q.currentTime/V*100:0,X=requestAnimationFrame(u)}}function g(){X!==null&&(cancelAnimationFrame(X),X=null)}function A(){const V=I();L.value?(V.pause(),L.value=!1,g()):(V.play(),L.value=!0,X=requestAnimationFrame(u))}function T(V){const Q=I(),pe=V.currentTarget.getBoundingClientRect(),xe=Math.max(0,Math.min(1,(V.clientX-pe.left)/pe.width)),W=Q.duration;W&&isFinite(W)&&(Q.currentTime=xe*W,$.value=Q.currentTime,H.value=xe*100)}const M=B(()=>{const V=R.value;return L.value||$.value>0?be(Math.floor($.value))+" / "+be(Math.floor(V)):be(Math.floor(V))});De(_,()=>{q&&(q.pause(),L.value=!1,g(),q=null,H.value=0,$.value=0)}),He(()=>{q&&(q.pause(),q=null),g()});const U=B(()=>{const V=n.message.reply_to_type;if(V==="sticker")return"ğŸ¨ Sticker";if(V==="voice")return"ğŸ¤ Voice message";if(V==="file")return"ğŸ“ File";const Q=n.message.reply_to_content||"";return Q.length>80?Q.slice(0,80)+"...":Q}),J=B(()=>Cs(n.message.content||"",{defaultProtocol:"https",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(Q,ie,pe)=>ie||`<span class="mention" data-u="${pe}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${pe}'}))">@${pe}</span>`));function re(V){if(!V)return"";const Q=new Date(V.endsWith("Z")?V:V+"Z"),ie=new Date;return Q.toDateString()===ie.toDateString()?Q.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):Q.toLocaleDateString([],{month:"short",day:"numeric"})}function be(V){const Q=Math.floor(V/60),ie=V%60;return`${Q}:${String(ie).padStart(2,"0")}`}function We(V){const Q=V.target.getBoundingClientRect();o("openEmojiPicker",n.message.id,Q.left,Q.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(V=>{o("mentionClick",V.detail)})),(V,Q)=>(v(),y("div",Ws({class:["msg-row",[e.isMine?"mine":"theirs",{selected:l.value}]],"data-message-id":e.message.id,onContextmenu:ae(f,["prevent"])},p,{onClick:h}),[x(s).selectionMode?(v(),y("div",Yo,[t("input",{type:"checkbox",checked:l.value,tabindex:"-1"},null,8,Xo)])):F("",!0),!e.isMine&&e.message.message_type!=="sticker"?(v(),y("div",Zo,[_e(D(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(v(),Y($s,{key:0})):F("",!0)])):F("",!0),t("div",ei,[k.value?(v(),y("div",ti,D(k.value),1)):F("",!0),e.message.reply_to_message_id?(v(),y("div",{key:1,class:"msg-reply-quote",onClick:Q[0]||(Q[0]=ae(ie=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[Q[1]||(Q[1]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",ni,D(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",si,D(U.value),1)])])):F("",!0),e.message.message_type==="sticker"?(v(),y("div",ai,[t("img",{class:"sticker-img",src:S.value,alt:e.message.sticker_label||"sticker"},null,8,oi)])):e.message.message_type==="voice"?(v(),y("div",ii,[t("div",li,[t("button",{class:"voice-play-btn",onClick:ae(A,["stop"])},D(L.value?"â¸":"â–¶"),1),t("div",{class:"voice-track",onClick:ae(T,["stop"])},[t("div",{class:"voice-progress",style:ct({width:H.value+"%"})},null,4)]),t("span",ri,D(M.value),1)])])):(v(),y("div",{key:4,class:"msg-bubble",innerHTML:J.value},null,8,ci)),t("button",{class:"reaction-add-btn",onClick:ae(We,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(v(),y("div",ui,[(v(!0),y(se,null,fe(e.message.reactions,ie=>(v(),y("button",{key:ie.emoji,class:ve(["reaction-chip",{"reaction-mine":ie.me}]),onClick:ae(pe=>o("toggleReaction",e.message.id,ie.emoji),["stop"])},[t("span",vi,D(ie.emoji),1),t("span",mi,D(ie.count),1)],10,di))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:ae(We,["stop"])},"+")])):F("",!0)]),t("div",fi,[e.message.is_edited?(v(),y("span",pi,"(edited)")):F("",!0),_e(" "+D(re(e.message.created_at)),1)])],16,Qo))}}),gi={class:"composer-wrapper"},yi={key:0,class:"reply-preview"},bi={class:"reply-preview-content"},ki={class:"reply-preview-sender"},wi={class:"reply-preview-text"},_i={key:1,class:"reply-preview edit-preview"},Ci={class:"reply-preview-content"},$i={class:"reply-preview-text"},Si={class:"composer"},Mi=["onKeydown"],xi=Z({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(e,{expose:a,emit:n}){const o=e,s=n,i=b(""),l=b(null),r=b(null),m=b(null);let w=0;function p(){const _=i.value.trim();_&&(m.value?(s("editMessage",m.value.messageId,_),m.value=null):r.value?(s("send",_,{...r.value}),r.value=null):s("send",_),i.value="",S())}function f(){r.value=null,l.value?.focus()}function c(){m.value=null,i.value="",S(),l.value?.focus()}function h(){r.value?f():m.value&&c()}function d(_){const L=_.detail;L&&(m.value=null,r.value={messageId:L.messageId,senderName:L.senderName||"Unknown",snippet:(L.text||"").slice(0,100)},ke(()=>l.value?.focus()))}function k(_){const L=_.detail;L&&(r.value=null,m.value={messageId:L.messageId,snippet:(L.text||"").slice(0,100),fullText:L.text||""},i.value=m.value.fullText,ke(()=>{S(),l.value?.focus()}))}function O(){S();const _=Date.now();_-w>2e3&&i.value.trim().length>0&&(w=_,s("typing"))}function S(){const _=l.value;_&&(_.style.height="auto",_.style.height=Math.min(_.scrollHeight,120)+"px")}return ge(()=>{l.value?.focus(),window.addEventListener("reply-to-message",d),window.addEventListener("edit-message",k)}),He(()=>{window.removeEventListener("reply-to-message",d),window.removeEventListener("edit-message",k)}),De(()=>o.replyTo,_=>{_&&l.value?.focus()}),a({focus:()=>l.value?.focus()}),(_,L)=>(v(),y("div",gi,[r.value?(v(),y("div",yi,[L[3]||(L[3]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",bi,[t("span",ki,D(r.value.senderName),1),t("span",wi,D(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:f},"âœ•")])):F("",!0),m.value?(v(),y("div",_i,[L[5]||(L[5]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",Ci,[L[4]||(L[4]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",$i,D(m.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:c},"âœ•")])):F("",!0),t("div",Si,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:L[0]||(L[0]=H=>s("toggleStickers"))},"ğŸŒ"),te(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":L[1]||(L[1]=H=>i.value=H),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[un(ae(p,["exact","prevent"]),["enter"]),un(h,["escape"])],onInput:O},null,40,Mi),[[de,i.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:L[2]||(L[2]=H=>s("startRecording"))},"ğŸ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:p},"â¤")])]))}}),Ti=me(xi,[["__scopeId","data-v-df4ad9ba"]]),Ei={class:"sticker-grid"},Li=["title","onClick"],Ii=["src","alt"],Ai={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Di=Z({__name:"StickerPicker",emits:["select"],setup(e,{emit:a}){const n=a,o=Ze("stickers",b([])),s=B(()=>o.value);return(i,l)=>(v(),y("div",Ei,[(v(!0),y(se,null,fe(s.value,r=>(v(),y("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:m=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,Ii)],8,Li))),128)),s.value.length===0?(v(),y("div",Ai," No stickers available ")):F("",!0)]))}}),Ri={},Oi={class:"msgs-loading"};function Pi(e,a){return v(),y("div",Oi,"Loading...")}const Qn=me(Ri,[["render",Pi]]),Ni=["onClick"],Ui=Z({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:a}){const n=a,o=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(s,i)=>e.visible?(v(),y("div",{key:0,class:"emoji-picker",style:ct({left:e.x+"px",top:e.y+"px"}),onClick:i[0]||(i[0]=ae(()=>{},["stop"]))},[(v(),y(se,null,fe(o,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},D(l),9,Ni)),64))],4)):F("",!0)}}),Fi=Z({__name:"MessageContextMenu",setup(e){const{showToast:a}=Me(),n=Ee(),o=Jt(),s=b(!1),i=b(0),l=b(0),r=b(null),m=b(null),w=b(""),p=b(""),f=b(""),c=b(null),h=B(()=>!c.value||!n.user?!1:c.value===n.user.id),d=B(()=>!m.value||!r.value?null:`${window.location.origin}/c/${m.value}/${r.value}`),k=B(()=>!m.value||!r.value?!1:o.pinnedByChat[m.value]?.message?.id===r.value);function O(g){r.value=g.detail.messageId,m.value=g.detail.chatId,w.value=g.detail.text||"",p.value=g.detail.messageType||"text",f.value=g.detail.senderName||"",c.value=g.detail.senderId??null,i.value=g.detail.x,l.value=g.detail.y,s.value=!0,requestAnimationFrame(()=>{const A=document.querySelector(".msg-context-menu");if(!A)return;const T=A.getBoundingClientRect();T.right>window.innerWidth&&(i.value=window.innerWidth-T.width-8),T.bottom>window.innerHeight&&(l.value=window.innerHeight-T.height-8)})}function S(){s.value&&(s.value=!1,r.value=null,m.value=null,w.value="",p.value="",f.value="",c.value=null)}ge(()=>{window.addEventListener("show-message-context-menu",O),document.addEventListener("click",S)}),He(()=>{window.removeEventListener("show-message-context-menu",O),document.removeEventListener("click",S)});function _(){s.value=!1}function L(){_(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:r.value,chatId:m.value,senderName:f.value,text:w.value}}))}function H(){_(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:r.value,chatId:m.value,text:w.value}}))}async function $(){_();try{await navigator.clipboard.writeText(w.value),a("Copied to clipboard")}catch{a("Failed to copy text")}}async function R(){if(_(),!!d.value)try{await navigator.clipboard.writeText(d.value),a("Link copied")}catch{a("Failed to copy link")}}function q(){_(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[r.value],chatId:m.value}}))}function X(){_(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:r.value,chatId:m.value}}))}function I(){if(_(),!r.value||!m.value)return;const g=k.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(g,{detail:{messageId:r.value,chatId:m.value}}))}function u(){_(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:r.value,chatId:m.value}}))}return(g,A)=>(v(),Y(Zn,{to:"body"},[s.value?(v(),y("div",{key:0,class:"msg-context-menu",style:ct({left:i.value+"px",top:l.value+"px"}),onClick:A[0]||(A[0]=ae(()=>{},["stop"])),onContextmenu:A[1]||(A[1]=ae(()=>{},["prevent"]))},[t("button",{class:"ctx-item",onClick:L}," Reply "),h.value&&p.value==="text"?(v(),y("button",{key:0,class:"ctx-item",onClick:H}," Edit ")):F("",!0),t("button",{class:"ctx-item",onClick:I},D(k.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:$}," Copy text "),d.value?(v(),y("button",{key:1,class:"ctx-item",onClick:R}," Copy link ")):F("",!0),t("button",{class:"ctx-item",onClick:q}," Forward "),t("button",{class:"ctx-item",onClick:X}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:u}," Delete ")],36)):F("",!0)]))}}),Bi=me(Fi,[["__scopeId","data-v-d52d68d5"]]),Hi={key:0,class:"selection-bar"},ji={class:"selection-bar-count"},zi={class:"selection-bar-actions"},Vi=["disabled"],Wi=["disabled"],qi=Z({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:a}){const n=a,o=Kt();return(s,i)=>(v(),Y(es,{name:"slide-down"},{default:bn(()=>[x(o).selectionMode?(v(),y("div",Hi,[t("button",{class:"selection-bar-btn cancel-btn",onClick:i[0]||(i[0]=l=>x(o).exitSelectionMode())}," Cancel "),t("span",ji,D(x(o).selectedCount)+" selected",1),t("div",zi,[t("button",{class:"selection-bar-btn forward-btn",disabled:x(o).selectedCount===0,onClick:i[1]||(i[1]=l=>n("forward"))}," Forward ("+D(x(o).selectedCount)+") ",9,Vi),t("button",{class:"selection-bar-btn delete-btn",disabled:x(o).selectedCount===0,onClick:i[2]||(i[2]=l=>n("delete"))}," Delete ("+D(x(o).selectedCount)+") ",9,Wi)])])):F("",!0)]),_:1}))}}),Gi=me(qi,[["__scopeId","data-v-9ba988f2"]]),Ki=Z({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:a}){const n=a;function o(){n("close")}return(s,i)=>(v(),Y(Zn,{to:"body"},[j(es,{name:"bottom-sheet"},{default:bn(()=>[e.visible?(v(),y("div",{key:0,class:"bottom-sheet-backdrop",onClick:ae(o,["self"])},[t("div",{class:"bottom-sheet",onClick:i[0]||(i[0]=ae(()=>{},["stop"]))},[i[1]||(i[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),ts(s.$slots,"default",{},void 0,!0)])])):F("",!0)]),_:3})]))}}),Ji=me(Ki,[["__scopeId","data-v-2c2a0a15"]]),Qi={class:"modal"},Yi={class:"modal-header"},Xi={class:"modal-body"},Zi={class:"forward-chat-list"},el={key:0,class:"empty-state-small"},tl=["onClick"],nl={class:"forward-chat-info"},sl={class:"forward-chat-name"},al={class:"forward-chat-type"},ol={key:0,class:"forward-check"},il={class:"modal-actions"},ll=["disabled"],rl=Z({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:a}){const n=e,o=a,s=Se(),i=Jt(),{showToast:l}=Me(),r=b(""),m=b(null),w=b(!1),p=B(()=>{const k=r.value.toLowerCase().trim(),O=s.sortedChats;return k?O.filter(S=>f(S).toLowerCase().includes(k)):O});function f(k){return k.type==="direct"?k.other_user_id?k.other_display_name||k.other_username||k.title||"Direct Chat":"Saved Messages":k.title||k.name||"Unnamed Chat"}function c(k){if(k.type==="direct")return k.other_avatar_url??void 0}function h(){}async function d(){if(m.value!==null){w.value=!0;try{await i.forwardMessages(m.value,n.fromChatId,n.messageIds),l("Message forwarded!"),o("forwarded",m.value)}catch{l("Failed to forward message")}finally{w.value=!1}}}return(k,O)=>(v(),y("div",{class:"modal-backdrop",onClick:O[2]||(O[2]=ae(S=>o("close"),["self"]))},[t("div",Qi,[t("div",Yi,[O[3]||(O[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:O[0]||(O[0]=S=>o("close"))},"âœ•")]),t("div",Xi,[te(t("input",{"onUpdate:modelValue":O[1]||(O[1]=S=>r.value=S),class:"search-input",type:"search",placeholder:"Search chats...",onInput:h},null,544),[[de,r.value]]),t("div",Zi,[p.value.length===0?(v(),y("div",el,"No chats found.")):F("",!0),(v(!0),y(se,null,fe(p.value,S=>(v(),y("div",{key:S.id,class:ve(["forward-chat-item",{selected:m.value===S.id}]),onClick:_=>m.value=S.id},[j(ye,{name:f(S),url:c(S),size:"sm"},null,8,["name","url"]),t("div",nl,[t("div",sl,D(f(S)),1),t("div",al,D(S.type),1)]),m.value===S.id?(v(),y("span",ol,"âœ“")):F("",!0)],10,tl))),128))]),t("div",il,[t("button",{class:"btn btn-primary",disabled:m.value===null||w.value,onClick:d},D(w.value?"Forwarding...":"Forward"),9,ll)])])])]))}}),cl=me(rl,[["__scopeId","data-v-4e477e89"]]),ul={class:"modal modal-sm"},dl={class:"modal-header"},vl={class:"modal-body"},ml={class:"delete-confirm-text"},fl={key:0,class:"delete-checkbox-label"},pl={class:"modal-actions"},hl=Z({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:a}){const n=a,o=b(!1);function s(){n("confirm",o.value)}return(i,l)=>(v(),y("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=ae(r=>n("close"),["self"]))},[t("div",ul,[t("div",dl,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",vl,[t("p",ml," Are you sure you want to delete "+D(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(v(),y("label",fl,[te(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>o.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[ns,o.value]]),l[5]||(l[5]=_e(" Delete for everyone ",-1))])):F("",!0)]),t("div",pl,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:s},"Delete")])])]))}}),gl=me(hl,[["__scopeId","data-v-388dbae2"]]),ut=Ge("channel",()=>{const e=b(null),a=b([]),n=b(!1),o=B(()=>a.value.length),s=B(()=>a.value.filter(f=>f.role==="admin"||f.role==="owner").length),i=B(()=>{const f=Ee();return f.user?a.value.find(h=>h.id===f.user.id)?.role??null:null}),l=B(()=>i.value==="owner"),r=B(()=>i.value==="admin"||i.value==="owner");async function m(f){n.value=!0;try{e.value=await as(f)}catch(c){console.error("Failed to load channel detail",c)}finally{n.value=!1}}async function w(f){try{a.value=await va(f)}catch(c){console.error("Failed to load channel members",c)}}async function p(f,c){try{e.value=await ma(f,c)}catch(h){throw console.error("Failed to update channel",h),h}}return{detail:e,members:a,loading:n,memberCount:o,adminCount:s,myRole:i,isOwner:l,isAdmin:r,loadDetail:m,loadMembers:w,updateChannel:p}}),yl=Ge("invites",()=>{const e=b([]),a=b(!1);async function n(i){a.value=!0;try{e.value=await Js(i)}catch(l){console.error("Failed to load invites",l)}finally{a.value=!1}}async function o(i){try{const l=await Qs(i);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function s(i){const l=[...e.value];e.value=e.value.filter(r=>r.token!==i);try{await Ys(i)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:a,loadInvites:n,createInvite:o,revokeInvite:s}}),bl={class:"invite-links-view"},kl={class:"view-header"},wl={style:{padding:"0 1rem .5rem"}},_l=["disabled"],Cl={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},$l={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},Sl={key:2,class:"invite-list",style:{padding:"0 1rem"}},Ml={class:"invite-item-info"},xl={class:"invite-token"},Tl={class:"invite-date"},El={class:"invite-item-actions"},Ll=["onClick"],Il=["onClick"],Al=Z({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=e,o=a,s=yl(),{showToast:i}=Me(),l=b(!1);function r(f){return new Date(f).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function m(f){const c=`${window.location.origin}/join/${f}`;navigator.clipboard&&navigator.clipboard.writeText(c).then(()=>i("Link copied!"))}async function w(){l.value=!0;try{await s.createInvite(n.chatId),i("Invite link created")}catch{i("Failed to create invite")}finally{l.value=!1}}async function p(f){try{await s.revokeInvite(f),i("Invite revoked")}catch{i("Failed to revoke invite")}}return ge(()=>s.loadInvites(n.chatId)),(f,c)=>(v(),y("div",bl,[t("div",kl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=h=>o("back"))},[j(x(Ve),{size:20,"stroke-width":2})]),c[1]||(c[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",wl,[t("button",{class:"btn btn-sm btn-outline",onClick:w,disabled:l.value},D(l.value?"Creating...":"Create Invite Link"),9,_l)]),x(s).loading?(v(),y("div",Cl," Loading... ")):x(s).invites.length===0?(v(),y("div",$l," No active invite links ")):(v(),y("div",Sl,[(v(!0),y(se,null,fe(x(s).invites,h=>(v(),y("div",{key:h.id,class:"invite-item"},[t("div",Ml,[t("code",xl,D(h.token),1),t("span",Tl,D(r(h.created_at)),1)]),t("div",El,[t("button",{class:"icon-btn",title:"Copy link",onClick:d=>m(h.token)},[j(x(Fa),{size:16,"stroke-width":2})],8,Ll),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:d=>p(h.token)}," Revoke ",8,Il)])]))),128))]))]))}}),Dl=me(Al,[["__scopeId","data-v-97b82dd0"]]);async function Rl(e,a){await K.post(`/chats/${e}/avatar`,{file_id:a})}async function Ol(e,a){return(await K.post(`/chats/${e}/members/${a}/promote`)).data}async function Pl(e,a){return(await K.post(`/chats/${e}/members/${a}/demote`)).data}const Nl={class:"admins-view"},Ul={class:"view-header"},Fl={class:"search-bar"},Bl={key:0,class:"member-empty"},Hl={key:1,class:"member-list"},jl=["onClick"],zl={class:"member-info"},Vl={class:"member-name"},Wl={class:"role-badge"},ql={class:"view-footer"},Gl={key:0,class:"member-empty"},Kl={key:1,class:"member-list"},Jl={class:"member-info"},Ql={class:"member-name"},Yl=["onClick"],Xl={key:2,class:"view-footer"},Zl=Z({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=e,o=a,s=ut(),i=b(!1),l=b(""),r=B(()=>s.members.filter(c=>c.role==="admin"||c.role==="owner")),m=B(()=>s.members.filter(c=>c.role==="member")),w=B(()=>{const c=l.value.toLowerCase().trim();return c?m.value.filter(h=>h.username.toLowerCase().includes(c)||h.display_name&&h.display_name.toLowerCase().includes(c)):m.value});async function p(c){try{await Ol(n.chatId,c);const h=s.members.find(d=>d.id===c);h&&(h.role="admin"),i.value=!1,l.value=""}catch{}}async function f(c){try{await Pl(n.chatId,c);const h=s.members.find(d=>d.id===c);h&&(h.role="member")}catch{}}return(c,h)=>(v(),y("div",Nl,[t("div",Ul,[t("button",{class:"icon-btn","aria-label":"Back",onClick:h[0]||(h[0]=d=>o("back"))},[j(x(Ve),{size:20,"stroke-width":2})]),h[4]||(h[4]=t("span",{class:"view-title"},"Administrators",-1))]),i.value?(v(),y(se,{key:0},[t("div",Fl,[te(t("input",{"onUpdate:modelValue":h[1]||(h[1]=d=>l.value=d),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[de,l.value]])]),w.value.length===0?(v(),y("div",Bl,D(l.value?"No members found":"No members to promote"),1)):(v(),y("div",Hl,[(v(!0),y(se,null,fe(w.value,d=>(v(),y("div",{key:d.id,class:"member-item member-item--selectable",onClick:k=>p(d.id)},[j(ye,{name:d.display_name||d.username,url:d.avatar_url,size:"md"},null,8,["name","url"]),t("div",zl,[t("span",Vl,D(d.display_name||d.username),1),t("span",Wl,D(d.role),1)])],8,jl))),128))])),t("div",ql,[t("button",{class:"btn btn--secondary",onClick:h[2]||(h[2]=d=>i.value=!1)},"Cancel")])],64)):(v(),y(se,{key:1},[r.value.length===0?(v(),y("div",Gl," No administrators found ")):(v(),y("div",Kl,[(v(!0),y(se,null,fe(r.value,d=>(v(),y("div",{key:d.id,class:"member-item"},[j(ye,{name:d.display_name||d.username,url:d.avatar_url,size:"md"},null,8,["name","url"]),t("div",Jl,[t("span",Ql,D(d.display_name||d.username),1),t("span",{class:ve(["role-badge",`role-badge--${d.role}`])},D(d.role),3)]),x(s).isOwner&&d.role==="admin"?(v(),y("button",{key:0,class:"btn btn--small btn--danger",onClick:k=>f(d.id)}," Demote ",8,Yl)):F("",!0)]))),128))])),x(s).isOwner?(v(),y("div",Xl,[t("button",{class:"btn btn--primary",onClick:h[3]||(h[3]=d=>i.value=!0)},"Add Admin")])):F("",!0)],64))]))}}),er=me(Zl,[["__scopeId","data-v-2bd7c861"]]),tr={class:"subscribers-view"},nr={class:"view-header"},sr={class:"search-bar"},ar={key:0,class:"member-empty"},or={key:1,class:"member-list"},ir={class:"member-info"},lr={class:"member-name"},rr=Z({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=a,o=ut(),s=b(""),i=B(()=>{const l=s.value.toLowerCase().trim();return l?o.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):o.members});return(l,r)=>(v(),y("div",tr,[t("div",nr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=m=>n("back"))},[j(x(Ve),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",sr,[te(t("input",{"onUpdate:modelValue":r[1]||(r[1]=m=>s.value=m),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[de,s.value]])]),i.value.length===0?(v(),y("div",ar,D(s.value?"No members found":"No subscribers"),1)):(v(),y("div",or,[(v(!0),y(se,null,fe(i.value,m=>(v(),y("div",{key:m.id,class:"member-item"},[j(ye,{name:m.display_name||m.username,url:m.avatar_url,size:"md"},null,8,["name","url"]),t("div",ir,[t("span",lr,D(m.display_name||m.username),1),t("span",{class:ve(["role-badge",`role-badge--${m.role}`])},D(m.role),3)])]))),128))]))]))}}),cr=me(rr,[["__scopeId","data-v-f99a8a5f"]]),ur={class:"modal profile-modal"},dr={class:"profile-modal-body profile-modal-body--scrollable"},vr={class:"profile-avatar-section profile-avatar-upload-section"},mr={class:"profile-avatar-overlay"},fr={class:"profile-info-list"},pr={class:"form-group"},hr={class:"form-label"},gr=["placeholder"],yr={class:"form-group"},br=["placeholder"],kr={key:0,class:"form-group"},wr={class:"form-label"},_r={class:"type-selector"},Cr={class:"type-option"},$r={class:"type-option"},Sr={class:"profile-edit-actions"},Mr=["disabled"],xr=Z({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:a}){const n=e,o=a,s=ut(),{showToast:i}=Me(),l=b(""),r=b(""),m=b(void 0),w=b("public"),p=b(!1),f=b(null),c=B(()=>s.detail?.type==="group"),h=B(()=>c.value?"Group":"Channel");ge(()=>{s.detail&&(l.value=s.detail.title||"",r.value=s.detail.description||"",m.value=s.detail.avatar_url??void 0,w.value=s.detail.public_name?"public":"private")});async function d(){const O=f.value?.files?.[0];if(O){try{const S=await _n(O);await Rl(n.chatId,S.id),m.value=URL.createObjectURL(O),i("Avatar updated!")}catch{i("Avatar upload failed")}f.value&&(f.value.value="")}}async function k(){if(!l.value.trim()){i(`${h.value} name is required`);return}p.value=!0;try{await s.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),i(`${h.value} updated!`),o("saved"),o("close")}catch{i(`Failed to update ${h.value.toLowerCase()}`)}finally{p.value=!1}}return(O,S)=>(v(),y("div",{class:"modal-backdrop profile-backdrop",onClick:S[7]||(S[7]=ae(_=>o("close"),["self"]))},[t("div",ur,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:S[0]||(S[0]=_=>o("close"))},[j(x(je),{size:20,"stroke-width":2})]),t("div",dr,[t("div",vr,[t("div",{class:"profile-avatar-upload-wrap",onClick:S[1]||(S[1]=_=>f.value?.click())},[j(ye,{name:l.value||h.value,url:m.value,size:"xxl"},null,8,["name","url"]),t("div",mr,[j(x(rs),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",class:"hidden",onChange:d},null,544)]),t("div",fr,[t("div",pr,[t("label",hr,D(h.value)+" name",1),te(t("input",{"onUpdate:modelValue":S[2]||(S[2]=_=>l.value=_),class:"form-input",type:"text",maxlength:"128",placeholder:`${h.value} name`},null,8,gr),[[de,l.value]])]),t("div",yr,[S[8]||(S[8]=t("label",{class:"form-label"},"Description",-1)),te(t("textarea",{"onUpdate:modelValue":S[3]||(S[3]=_=>r.value=_),class:"form-input",maxlength:"500",rows:"4",placeholder:`${h.value} description...`},null,8,br),[[de,r.value]])]),x(s).isOwner?(v(),y("div",kr,[t("label",wr,D(h.value)+" type",1),t("div",_r,[t("label",Cr,[te(t("input",{"onUpdate:modelValue":S[4]||(S[4]=_=>w.value=_),type:"radio",value:"public",name:"chatType"},null,512),[[Un,w.value]]),S[9]||(S[9]=t("span",{class:"type-option-label"},"Public",-1)),S[10]||(S[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",$r,[te(t("input",{"onUpdate:modelValue":S[5]||(S[5]=_=>w.value=_),type:"radio",value:"private",name:"chatType"},null,512),[[Un,w.value]]),S[11]||(S[11]=t("span",{class:"type-option-label"},"Private",-1)),S[12]||(S[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):F("",!0)]),t("div",Sr,[t("button",{class:"btn btn-primary",disabled:p.value,onClick:k},D(p.value?"Saving...":"Save"),9,Mr),t("button",{class:"btn btn-ghost",onClick:S[6]||(S[6]=_=>o("close"))},"Cancel")])])])]))}}),Tr=me(xr,[["__scopeId","data-v-6ec12915"]]),Er={class:"danger-zone"},Lr={class:"view-header"},Ir={class:"danger-zone-body"},Ar={class:"modal modal-sm"},Dr={class:"modal-header"},Rr={class:"modal-actions"},Or=["disabled"],Pr=Z({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:a}){const n=e,o=a,s=Se(),i=ut(),{showToast:l}=Me(),r=b(!1),m=b(!1);async function w(){try{await s.leave(n.chatId),o("left")}catch{l("Failed to leave channel")}}async function p(){m.value=!0;try{await os(n.chatId),s.chats=s.chats.filter(f=>f.id!==n.chatId),s.activeChatId===n.chatId&&s.setActiveChat(null),r.value=!1,o("deleted")}catch{l("Failed to delete channel")}finally{m.value=!1}}return(f,c)=>(v(),y("div",Er,[t("div",Lr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=h=>o("back"))},[j(x(Ve),{size:20,"stroke-width":2})]),c[5]||(c[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",Ir,[t("button",{class:"btn btn-danger-outline",onClick:w},[j(x(kn),{size:18,"stroke-width":1.8}),c[6]||(c[6]=_e(" Leave Channel ",-1))]),x(i).isOwner?(v(),y("button",{key:0,class:"btn btn-danger",onClick:c[1]||(c[1]=h=>r.value=!0)},[j(x(us),{size:18,"stroke-width":1.8}),c[7]||(c[7]=_e(" Delete Channel ",-1))])):F("",!0)]),r.value?(v(),y("div",{key:0,class:"modal-backdrop",onClick:c[4]||(c[4]=ae(h=>r.value=!1,["self"]))},[t("div",Ar,[t("div",Dr,[c[8]||(c[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[2]||(c[2]=h=>r.value=!1)},[j(x(je),{size:20,"stroke-width":2})])]),c[9]||(c[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",Rr,[t("button",{class:"btn btn-ghost",onClick:c[3]||(c[3]=h=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:m.value,onClick:p},D(m.value?"Deleting...":"Delete"),9,Or)])])])):F("",!0)]))}}),Nr=me(Pr,[["__scopeId","data-v-997b5e56"]]),Ur={class:"modal profile-modal"},Fr={class:"profile-modal-body"},Br={key:5,class:"profile-loading"},Hr={class:"profile-avatar-section"},jr={class:"profile-name"},zr={class:"profile-status"},Vr={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},Wr={class:"profile-info-item"},qr={class:"profile-info-value"},Gr={class:"channel-info-menu"},Kr={class:"channel-info-menu-count"},Jr={class:"channel-info-menu-count"},Qr={key:7,class:"profile-loading"},Yr=Z({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:a}){const n=e,o=a,s=ut(),i=b("main"),l=B(()=>Number(n.chatId)),r=B(()=>s.detail?.type==="group");function m(){i.value="main",s.loadDetail(l.value)}return ge(async()=>{await Promise.all([s.loadDetail(l.value),s.loadMembers(l.value)])}),(w,p)=>(v(),y("div",{class:"modal-backdrop profile-backdrop",onClick:p[14]||(p[14]=ae(f=>o("close"),["self"]))},[t("div",Ur,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:p[0]||(p[0]=f=>o("close"))},[j(x(je),{size:20,"stroke-width":2})]),t("div",Fr,[i.value==="invites"?(v(),Y(Dl,{key:0,"chat-id":l.value,onBack:p[1]||(p[1]=f=>i.value="main")},null,8,["chat-id"])):i.value==="admins"?(v(),Y(er,{key:1,"chat-id":l.value,onBack:p[2]||(p[2]=f=>i.value="main")},null,8,["chat-id"])):i.value==="subscribers"?(v(),Y(cr,{key:2,"chat-id":l.value,onBack:p[3]||(p[3]=f=>i.value="main")},null,8,["chat-id"])):i.value==="edit"?(v(),Y(Tr,{key:3,"chat-id":l.value,onClose:p[4]||(p[4]=f=>i.value="main"),onSaved:m},null,8,["chat-id"])):i.value==="danger"?(v(),Y(Nr,{key:4,"chat-id":l.value,onBack:p[5]||(p[5]=f=>i.value="main"),onLeft:p[6]||(p[6]=f=>o("close")),onDeleted:p[7]||(p[7]=f=>o("close"))},null,8,["chat-id"])):x(s).loading?(v(),y("div",Br,[...p[15]||(p[15]=[t("p",null,"Loading...",-1)])])):x(s).detail?(v(),y(se,{key:6},[t("div",Hr,[j(ye,{name:x(s).detail.title||"Channel",url:x(s).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",jr,D(x(s).detail.title),1),t("div",zr,D(x(s).memberCount)+" "+D(r.value?x(s).memberCount===1?"member":"members":x(s).memberCount===1?"subscriber":"subscribers"),1),x(s).detail.description?(v(),y("div",Vr,[t("div",Wr,[p[16]||(p[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",qr,D(x(s).detail.description),1)])])):F("",!0),p[19]||(p[19]=t("div",{class:"profile-divider"},null,-1)),t("div",Gr,[t("button",{class:"channel-info-menu-item",onClick:p[8]||(p[8]=f=>i.value="invites")},[j(x(ja),{size:20,"stroke-width":1.8}),p[17]||(p[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:p[9]||(p[9]=f=>i.value="admins")},[j(x(Ka),{size:20,"stroke-width":1.8}),p[18]||(p[18]=t("span",null,"Administrators",-1)),t("span",Kr,D(x(s).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:p[10]||(p[10]=f=>i.value="subscribers")},[j(x(wn),{size:20,"stroke-width":1.8}),t("span",null,D(r.value?"Members":"Subscribers"),1),t("span",Jr,D(x(s).memberCount),1)]),x(s).isOwner||x(s).isAdmin?(v(),y("button",{key:0,class:"channel-info-menu-item",onClick:p[11]||(p[11]=f=>i.value="edit")},[j(x(qa),{size:20,"stroke-width":1.8}),t("span",null,D(r.value?"Edit Group":"Edit Channel"),1)])):F("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[12]||(p[12]=f=>i.value="danger")},[j(x(kn),{size:20,"stroke-width":1.8}),t("span",null,D(r.value?"Leave Group":"Leave Channel"),1)]),x(s).isOwner?(v(),y("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[13]||(p[13]=f=>i.value="danger")},[j(x(us),{size:20,"stroke-width":1.8}),t("span",null,D(r.value?"Delete Group":"Delete Channel"),1)])):F("",!0)])],64)):(v(),y("div",Qr,[...p[20]||(p[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),Xr=me(Yr,[["__scopeId","data-v-d1526322"]]),Zr={class:"search-bar"},ec={class:"search-bar-header"},tc={key:0,class:"search-loading"},nc={key:1,class:"search-empty"},sc=["onClick"],ac={class:"search-result-sender"},oc=["innerHTML"],ic={class:"search-result-date"},lc={key:0,class:"search-loading"},rc=Z({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:a}){const n=e,o=a,s=b(null),i=b(null),l=b(""),r=b([]),m=b(!1),w=b(!1),p=b(!0);let f=null;ge(()=>{ke(()=>s.value?.focus())}),De(l,_=>{if(f&&clearTimeout(f),!_.trim()){r.value=[],w.value=!1,p.value=!0;return}f=setTimeout(()=>c(_.trim()),300)});async function c(_){m.value=!0,w.value=!0,p.value=!0;try{const L=await Fn(n.chatId,_,{limit:20});r.value=L,L.length<20&&(p.value=!1)}catch{r.value=[]}finally{m.value=!1}}async function h(){if(m.value||!p.value||r.value.length===0)return;const _=Math.min(...r.value.map(L=>L.id));m.value=!0;try{const L=await Fn(n.chatId,l.value.trim(),{limit:20,before_id:_});L.length<20&&(p.value=!1),r.value=[...r.value,...L]}catch{}finally{m.value=!1}}function d(){if(!i.value)return;const _=i.value;_.scrollTop+_.clientHeight>=_.scrollHeight-40&&h()}function k(_,L){if(!L)return O(_);const H=O(_),$=O(L),R=new RegExp($.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return H.replace(R,"<mark>$&</mark>")}function O(_){return _.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function S(_){if(!_)return"";const L=new Date(_.endsWith("Z")?_:_+"Z"),H=new Date;return L.toDateString()===H.toDateString()?L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):L.toLocaleDateString([],{month:"short",day:"numeric"})+" "+L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return(_,L)=>(v(),y("div",Zr,[t("div",ec,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:L[0]||(L[0]=H=>o("close"))},"â†"),te(t("input",{ref_key:"inputRef",ref:s,"onUpdate:modelValue":L[1]||(L[1]=H=>l.value=H),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:L[2]||(L[2]=un(H=>o("close"),["escape"]))},null,544),[[de,l.value]]),l.value?(v(),y("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:L[3]||(L[3]=H=>l.value="")},"âœ•")):F("",!0)]),m.value&&r.value.length===0?(v(),y("div",tc,"Searching...")):w.value&&r.value.length===0&&!m.value?(v(),y("div",nc,"No messages found")):r.value.length>0?(v(),y("div",{key:2,ref_key:"resultsRef",ref:i,class:"search-results",onScroll:d},[(v(!0),y(se,null,fe(r.value,H=>(v(),y("div",{key:H.id,class:"search-result-item",onClick:$=>o("jumpToMessage",H.id)},[t("div",ac,D(H.sender_display_name||H.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:k(H.content||"",l.value)},null,8,oc),t("div",ic,D(S(H.created_at)),1)],8,sc))),128)),m.value?(v(),y("div",lc,"Loading more...")):F("",!0)],544)):F("",!0)]))}}),cc={class:"chat-panel"},uc={key:0,class:"empty-chat"},dc={key:1,class:"chat-view"},vc={key:2,class:"channel-readonly-bar"},mc={key:0,class:"date-sep"},fc={key:4,class:"sticker-picker"},pc={key:6,class:"recording-bar"},hc={class:"rec-time"},gc=Z({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:a}){const n=a,o=Ee(),s=Se(),i=Jt(),{showToast:l}=Me(),r=wo(),m=Ze("stickers",b([])),w=Ze("sendTyping",()=>{}),p=Ze("pendingScrollMessageId",b(null)),f=b(null),c=b(null),h=b(!1);let d=null;const k=b(!1),O=b(!1),S=b("member"),_=b(!1),L=b(!1),H=b(!0),$=b(0);let R=null;function q(){if(!f.value)return!0;const N=f.value;return N.scrollTop+N.clientHeight>=N.scrollHeight-100}function X(){R||(R=setTimeout(()=>{R=null,H.value=q(),H.value&&($.value=0)},100))}function I(){Ke(),$.value=0,H.value=!0}const u=b(!1),g=b(0),A=b(0),T=b(null),M=Kt(),U=b(!1),J=b(null),re=b(""),be=B(()=>!J.value||!o.user?!1:Te.value.find(C=>C.id===J.value)?.sender_id===o.user.id),We=B(()=>be.value?Te.value.find(C=>C.id===J.value)?.message_type==="text":!1),V=B(()=>!J.value||!s.activeChatId?!1:i.pinnedByChat[s.activeChatId]?.message?.id===J.value),Q=B(()=>!s.activeChatId||i.pinnedDismissed.has(s.activeChatId)?null:i.pinnedByChat[s.activeChatId]||null),ie=b(!1),pe=b([]),xe=b(!1),W=b([]),z=b(!1),ne=b(null);let ce=null;const ue=B(()=>s.activeChat?.type==="channel"&&S.value==="member"),Te=B(()=>s.activeChatId?i.getMessages(s.activeChatId):[]),Yt=B(()=>{const N=[];let C="";for(const P of Te.value){const ee=Ss(P.created_at);ee!==C&&(N.push({type:"date",label:ee}),C=ee),N.push({type:"msg",msg:P})}return N});function Ss(N){if(!N)return"";const C=new Date(N.endsWith("Z")?N:N+"Z"),P=new Date;if(C.toDateString()===P.toDateString())return"Today";const ee=new Date(P);return ee.setDate(P.getDate()-1),C.toDateString()===ee.toDateString()?"Yesterday":C.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Ms(){Xt(),!(!c.value||!f.value)&&(d=new IntersectionObserver(async N=>{if(!N[0]?.isIntersecting)return;const P=s.activeChatId;if(!P||h.value||i.loadingChat===P)return;h.value=!0;const ee=f.value,Le=ee?ee.scrollHeight:0;try{if((await i.loadOlder(P)).length>0&&ee){await ke();const Je=ee.scrollHeight;ee.scrollTop+=Je-Le}}finally{h.value=!1}},{root:f.value,threshold:0}),d.observe(c.value))}function Xt(){d&&(d.disconnect(),d=null)}De(()=>s.activeChatId,async N=>{if(k.value=!1,S.value="member",$.value=0,H.value=!0,Xt(),ce&&(clearInterval(ce),ce=null),!N)return;await Promise.all([i.loadMessages(N),i.loadPinnedMessage(N)]),await ke(),Ke(),await ke(),Ms();const C=s.activeChat;if(C&&(C.type==="channel"||C.type==="group"))try{const P=await as(N);S.value=P.my_role||"member"}catch{}ce=setInterval(()=>{s.activeChatId===N&&i.loadNewer(N).then(P=>{P.length>0&&xs(P.length)})},2500)});function Ke(){f.value&&(f.value.scrollTop=f.value.scrollHeight)}function xs(N=1){if(!f.value)return;const C=f.value;C.scrollHeight-C.scrollTop-C.clientHeight<100?ke(()=>{C.scrollTop=C.scrollHeight}):$.value+=N}function Ts(){s.activeChatId&&w(s.activeChatId)}async function Es(N,C){if(!(!s.activeChatId||!N.trim())){ne.value=null;try{const P=C?{reply_to_message_id:C.messageId}:void 0,ee=await i.sendMessage(s.activeChatId,N.trim(),"text",P);o.user&&(ee.sender_id=o.user.id,ee.sender_username=o.user.username,ee.sender_display_name=o.user.display_name),await ke(),Ke(),s.loadChats()}catch{l("Failed to send message")}}}async function Ls(N,C){if(!(!s.activeChatId||!C.trim()))try{await i.editMessage(s.activeChatId,N,C.trim())}catch{l("Failed to edit message")}}async function Is(N){if(s.activeChatId){k.value=!1;try{const C=await i.sendMessage(s.activeChatId,"","sticker",{sticker_id:N}),P=m.value.find(ee=>ee.id===N);P&&(C.sticker_url=P.url,C.sticker_label=P.label),await ke(),Ke(),s.loadChats()}catch{l("Failed to send sticker")}}}function As(N,C,P){T.value=N,g.value=C,A.value=P,u.value=!0}function Ds(N){T.value&&s.activeChatId&&i.toggleReaction(s.activeChatId,T.value,N),u.value=!1,T.value=null}function Rs(N,C){s.activeChatId&&i.toggleReaction(s.activeChatId,N,C)}function Os(){u.value=!1,T.value=null}async function Ps(){try{await r.startRecording(),O.value=!0}catch{O.value=!1,l("Microphone access denied")}}async function Ns(){try{const N=await r.stopRecording();O.value=!1,await zs(N)}catch{O.value=!1}}function Us(){r.cancelRecording(),O.value=!1}function Ln(N){const{messageIds:C}=N.detail;pe.value=C,ie.value=!0}function In(N){const{messageId:C,chatId:P}=N.detail;P&&M.enterSelectionMode(P,C)}async function An(N,C){try{await i.pinMsg(N,C)}catch{l("Failed to pin message")}}async function Dn(N,C){try{await i.unpinMsg(N,C)}catch{l("Failed to unpin message")}}function Rn(N){const{messageId:C,chatId:P}=N.detail;C&&P&&An(P,C)}function On(N){const{messageId:C,chatId:P}=N.detail;C&&P&&Dn(P,C)}function Zt(N){const{messageId:C,chatId:P}=N.detail;if(!C||!P)return;W.value=[C];const ee=Te.value.find(Le=>Le.id===C);z.value=!!(ee&&ee.sender_id===o.user?.id),xe.value=!0}function Fs(){pe.value=[...M.selectedMessageIds],ie.value=!0}function Bs(){W.value=[...M.selectedMessageIds],z.value=W.value.every(N=>{const C=Te.value.find(P=>P.id===N);return C&&C.sender_id===o.user?.id}),xe.value=!0}function Pn(){ie.value=!1,pe.value=[],M.exitSelectionMode()}async function Hs(N){xe.value=!1;const C=s.activeChatId;if(C){for(const P of W.value)try{await i.deleteMessage(C,P)}catch{l("Failed to delete message")}W.value=[],M.exitSelectionMode()}}function Ne(N){U.value=!1;const C=J.value,P=s.activeChatId;if(!(!C||!P))switch(N){case"reply":{const ee=Te.value.find(Le=>Le.id===C);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:C,senderName:ee?.sender_display_name||ee?.sender_username||"Unknown",text:ee?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:C,chatId:P,text:re.value}}));break}case"copy":navigator.clipboard.writeText(re.value).then(()=>l("Copied to clipboard"),()=>l("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${P}/${C}`).then(()=>l("Link copied"),()=>l("Failed to copy link"));break;case"forward":pe.value=[C],ie.value=!0;break;case"select":M.enterSelectionMode(P,C);break;case"delete":Zt(new CustomEvent("",{detail:{messageId:C,chatId:P}}));break;case"pin":An(P,C);break;case"unpin":Dn(P,C);break}}async function dt(N){if(!f.value)return;const C=s.activeChatId;if(!C)return;let P=f.value.querySelector(`[data-message-id="${N}"]`);if(!P)try{const ee=Math.max(0,N-25),Le=await ht(C,{after_id:ee,limit:50});if(!Le.find(Je=>Je.id===N)){l("Message not found");return}i.messagesByChat[C]=Le,Le.length>0&&(i.lastMsgId[C]=Math.max(...Le.map(Je=>Je.id))),await ke(),P=f.value?.querySelector(`[data-message-id="${N}"]`)}catch{l("Message not found");return}P&&(P.scrollIntoView({behavior:"smooth",block:"center"}),P.classList.add("highlight-message"),setTimeout(()=>P.classList.remove("highlight-message"),2e3))}function js(N){L.value=!1,dt(N)}function Nn(N){if(N.key==="Escape"){if(L.value){L.value=!1,N.stopPropagation();return}_.value&&(_.value=!1,N.stopPropagation())}}ge(()=>{window.addEventListener("forward-messages",Ln),window.addEventListener("select-message",In),window.addEventListener("delete-message",Zt),window.addEventListener("pin-message",Rn),window.addEventListener("unpin-message",On),document.addEventListener("keydown",Nn)}),He(()=>{Xt(),window.removeEventListener("forward-messages",Ln),window.removeEventListener("select-message",In),window.removeEventListener("delete-message",Zt),window.removeEventListener("pin-message",Rn),window.removeEventListener("unpin-message",On),document.removeEventListener("keydown",Nn)}),De(()=>p.value,async N=>{N&&(await ke(),setTimeout(()=>{dt(N),p.value=null},300))}),De(()=>s.activeChatId,()=>{M.exitSelectionMode(),ne.value=null,L.value=!1});async function zs(N){if(s.activeChatId)try{const C=await _n(N);await i.sendMessage(s.activeChatId,"","voice",{file_id:C.id,duration_seconds:r.seconds.value}),await i.loadMessages(s.activeChatId),await ke(),Ke(),s.loadChats()}catch{l("Failed to upload voice message")}}return(N,C)=>(v(),y("main",cc,[x(s).activeChatId?(v(),y("div",dc,[j(Gi,{onForward:Fs,onDelete:Bs}),L.value&&x(s).activeChatId?(v(),Y(rc,{key:0,"chat-id":x(s).activeChatId,onClose:C[0]||(C[0]=P=>L.value=!1),onJumpToMessage:js},null,8,["chat-id"])):F("",!0),te(j(To,{onBack:C[1]||(C[1]=P=>n("back")),onOpenUserProfile:C[2]||(C[2]=P=>n("openUserProfile",P)),onOpenChannelInfo:C[3]||(C[3]=P=>_.value=!0),onOpenSearch:C[4]||(C[4]=P=>L.value=!0)},null,512),[[yt,!x(M).selectionMode&&!L.value]]),Q.value&&!x(M).selectionMode?(v(),Y(So,{key:1,message:Q.value.message,onClick:C[5]||(C[5]=P=>dt(Q.value.message.id)),onDismiss:C[6]||(C[6]=P=>x(i).dismissPin(x(s).activeChatId))},null,8,["message"])):F("",!0),ue.value?(v(),y("div",vc,[...C[22]||(C[22]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):F("",!0),$.value>0?(v(),y("button",{key:3,class:"new-messages-pill",onClick:I},D($.value)+" new message"+D($.value>1?"s":"")+" â†“ ",1)):F("",!0),t("div",{ref_key:"msgListRef",ref:f,class:"msg-list",onClick:Os,onScroll:X},[x(i).loadingChat===x(s).activeChatId?(v(),Y(Qn,{key:0})):(v(),y(se,{key:1},[t("div",{ref_key:"olderSentinelRef",ref:c,class:"older-sentinel"},[h.value?(v(),Y(Qn,{key:0})):F("",!0)],512),(v(!0),y(se,null,fe(Yt.value,P=>(v(),y(se,{key:P.type==="date"?"date-"+P.label:"msg-"+P.msg.id},[P.type==="date"?(v(),y("div",mc,[t("span",null,D(P.label),1)])):(v(),Y(hi,{key:1,message:P.msg,"is-mine":P.msg.sender_id===x(o).user?.id,onMentionClick:C[7]||(C[7]=ee=>n("openUserProfile",ee)),onOpenEmojiPicker:As,onToggleReaction:Rs,onReplyClick:dt},null,8,["message","is-mine"]))],64))),128))],64))],544),j(Ui,{visible:u.value,x:g.value,y:A.value,onSelect:Ds,onClose:C[8]||(C[8]=P=>u.value=!1)},null,8,["visible","x","y"]),k.value?(v(),y("div",fc,[j(Di,{onSelect:Is})])):F("",!0),ue.value?F("",!0):te((v(),Y(Ti,{key:5,"sticker-picker-open":k.value,"reply-to":ne.value,onSend:Es,onEditMessage:Ls,onToggleStickers:C[9]||(C[9]=P=>k.value=!k.value),onStartRecording:Ps,onTyping:Ts},null,8,["sticker-picker-open","reply-to"])),[[yt,!O.value]]),O.value?(v(),y("div",pc,[C[23]||(C[23]=t("span",{class:"rec-dot"},null,-1)),t("span",hc,D(x(r).formatTime(x(r).seconds.value)),1),C[24]||(C[24]=t("span",{class:"rec-label"},"Recording...",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:Us},"âœ•"),t("button",{class:"icon-btn rec-send",title:"Send",onClick:Ns},"â¤")])):F("",!0),j(Bi),j(Ji,{visible:U.value,onClose:C[18]||(C[18]=P=>U.value=!1)},{default:bn(()=>[t("button",{class:"ctx-item",onClick:C[10]||(C[10]=P=>Ne("reply"))},"Reply"),We.value?(v(),y("button",{key:0,class:"ctx-item",onClick:C[11]||(C[11]=P=>Ne("edit"))},"Edit")):F("",!0),t("button",{class:"ctx-item",onClick:C[12]||(C[12]=P=>Ne(V.value?"unpin":"pin"))},D(V.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:C[13]||(C[13]=P=>Ne("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:C[14]||(C[14]=P=>Ne("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:C[15]||(C[15]=P=>Ne("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:C[16]||(C[16]=P=>Ne("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:C[17]||(C[17]=P=>Ne("delete"))},"Delete")]),_:1},8,["visible"]),ie.value?(v(),Y(cl,{key:7,"message-ids":pe.value,"from-chat-id":x(s).activeChatId,onClose:Pn,onForwarded:Pn},null,8,["message-ids","from-chat-id"])):F("",!0),xe.value?(v(),Y(gl,{key:8,"message-count":W.value.length,"can-delete-for-everyone":z.value,onClose:C[19]||(C[19]=P=>xe.value=!1),onConfirm:Hs},null,8,["message-count","can-delete-for-everyone"])):F("",!0),_.value?(v(),Y(Xr,{key:9,"chat-id":String(x(s).activeChatId),onClose:C[20]||(C[20]=P=>_.value=!1)},null,8,["chat-id"])):F("",!0)])):(v(),y("div",uc,[...C[21]||(C[21]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),yc=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Favorites",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function bc(e){return yc.filter(a=>a.visible(e))}const kc=["disabled"],wc={class:"menu-item__label"},_c={key:1,class:"menu-item__badge"},Cc=Z({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:a}){const n=a;return(o,s)=>(v(),y("button",{class:ve(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:s[0]||(s[0]=i=>n("click"))},[e.icon?(v(),Y(bt(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):F("",!0),t("span",wc,D(e.label),1),e.badge?(v(),y("span",_c,D(e.badge),1)):F("",!0),ts(o.$slots,"right",{},void 0),e.chevron?(v(),Y(bt(x(Ua)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):F("",!0)],10,kc))}}),Yn=me(Cc,[["__scopeId","data-v-682bc042"]]),$c={class:"drawer-header"},Sc={class:"drawer-avatar-wrap"},Mc={class:"drawer-user-info"},xc={class:"drawer-display-name"},Tc={class:"drawer-username"},Ec={class:"drawer-nav"},Lc={key:0,class:"drawer-divider"},Ic=["onClick"],Ac={class:"menu-item__label"},Dc=["aria-checked"],Rc=Z({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:a}){const n=a,o=ss(),s=Ee(),i=Gt(),l={user:ds,users:wn,megaphone:cs,bookmark:Pa,settings:Ga,moon:Wa,download:Ba,"log-out":kn,star:Qa},r=B(()=>({isAuthenticated:!!s.user,isDesktop:!0})),m=B(()=>bc(r.value)),w={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const f=i.theme==="dark"?"light":"dark";i.applyTheme(f),i.saveSettings({theme:f})},openDownload:()=>n("openDownload"),logout:()=>{s.logout(),o.push("/login")}};function p(f){f&&w[f]&&w[f]()}return(f,c)=>(v(),y("div",{class:ve(["drawer",{open:e.open}])},[t("div",$c,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:c[0]||(c[0]=h=>n("close"))},[j(x(je),{size:20,"stroke-width":2})]),c[1]||(c[1]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",Sc,[j(ye,{name:x(s).user?.display_name||x(s).user?.username||"?",url:x(s).user?.avatar_url,size:"lg"},null,8,["name","url"]),t("div",Mc,[t("div",xc,D(x(s).user?.display_name||x(s).user?.username||"---"),1),t("div",Tc,"@"+D(x(s).user?.username||"---"),1)])]),t("nav",Ec,[(v(!0),y(se,null,fe(m.value,h=>(v(),y(se,{key:h.id},[h.separator?(v(),y("div",Lc)):F("",!0),h.rightSlot==="toggle"?(v(),y("div",{key:1,class:"menu-item menu-item--toggle",onClick:d=>p(h.action)},[(v(),Y(bt(l[h.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",Ac,D(h.label),1),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":x(i).theme==="dark"}]),role:"switch","aria-checked":x(i).theme==="dark"},[...c[2]||(c[2]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Dc)],8,Ic)):h.id==="logout"?(v(),Y(Yn,{key:2,icon:l[h.icon],label:h.label,danger:"",onClick:d=>p(h.action)},null,8,["icon","label","onClick"])):(v(),Y(Yn,{key:3,icon:l[h.icon],label:h.label,onClick:d=>p(h.action)},null,8,["icon","label","onClick"]))],64))),128))]),c[3]||(c[3]=t("div",{class:"drawer-footer"},"Simple Messenger v2",-1))],2))}}),Oc=me(Rc,[["__scopeId","data-v-de7cf394"]]),Pc={class:"modal"},Nc={class:"modal-header"},Uc={class:"modal-body"},Fc={key:0,class:"chat-type-cards"},Bc={class:"chat-type-icon"},Hc={class:"chat-type-icon"},jc={class:"chat-type-icon"},zc={key:1,class:"new-chat-form"},Vc={class:"user-pick-list"},Wc={key:0,class:"empty-state-small"},qc={key:1,class:"empty-state-small"},Gc=["onClick"],Kc={class:"user-pick-name"},Jc={class:"user-pick-handle"},Qc={key:2,class:"new-chat-form"},Yc={class:"form-group"},Xc={class:"form-group"},Zc={class:"form-group"},eu={class:"user-pick-list"},tu=["onClick"],nu={class:"user-pick-name"},su={class:"user-pick-handle"},au={class:"modal-actions"},ou=["disabled"],iu={key:3,class:"new-chat-form"},lu={class:"form-group"},ru={class:"form-group"},cu={class:"form-group"},uu={class:"modal-actions"},du=["disabled"],vu=Z({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:a}){const n=e,o=a,s=Ee(),{showToast:i}=Me(),l=b(n.initialStep),r=b(!1),m=b(""),w=b([]),p=b(!1);let f=null;const c=b(""),h=b(""),d=b(""),k=b([]),O=b(new Set);let S=null;const _=b(""),L=b(""),H=b("");ge(()=>{$("")});async function $(T){p.value=!0;try{const M=await Bn(T);w.value=M.filter(U=>U.id!==s.user?.id)}catch{w.value=[]}finally{p.value=!1}}function R(){f&&clearTimeout(f),f=setTimeout(()=>$(m.value),300)}async function q(T){try{k.value=await Bn(T)}catch{k.value=[]}}function X(){S&&clearTimeout(S),S=setTimeout(()=>q(d.value),300)}function I(T){O.value.has(T)?O.value.delete(T):O.value.add(T)}async function u(T){r.value=!0;try{const M=await et({type:"direct",member_ids:[T]});o("chatCreated",M.id)}catch{i("Failed to start conversation")}finally{r.value=!1}}async function g(){if(!c.value.trim()){i("Group name is required");return}r.value=!0;try{const T=await et({type:"group",title:c.value.trim(),description:h.value.trim(),member_ids:Array.from(O.value)});i("Group created!"),o("chatCreated",T.id)}catch{i("Failed to create group")}finally{r.value=!1}}async function A(){if(!_.value.trim()){i("Channel name is required");return}r.value=!0;try{const T=await et({type:"channel",title:_.value.trim(),description:H.value.trim(),public_name:L.value.trim()||void 0,member_ids:[]});i("Channel created!"),o("chatCreated",T.id)}catch{i("Failed to create channel")}finally{r.value=!1}}return(T,M)=>(v(),y("div",{class:"modal-backdrop",onClick:M[14]||(M[14]=ae(U=>o("close"),["self"]))},[t("div",Pc,[t("div",Nc,[M[15]||(M[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:M[0]||(M[0]=U=>o("close"))},[j(x(je),{size:20})])]),t("div",Uc,[l.value==="select"?(v(),y("div",Fc,[t("button",{class:"chat-type-card",onClick:M[1]||(M[1]=U=>l.value="direct")},[t("span",Bc,[j(x(ds),{size:24})]),M[16]||(M[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:M[2]||(M[2]=U=>l.value="group")},[t("span",Hc,[j(x(wn),{size:24})]),M[17]||(M[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:M[3]||(M[3]=U=>l.value="channel")},[t("span",jc,[j(x(cs),{size:24})]),M[18]||(M[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):F("",!0),l.value==="direct"?(v(),y("div",zc,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[4]||(M[4]=U=>l.value="select")},[j(x(Ve),{size:16}),M[19]||(M[19]=_e(" Back ",-1))]),te(t("input",{"onUpdate:modelValue":M[5]||(M[5]=U=>m.value=U),class:"search-input",type:"search",placeholder:"Search users...",onInput:R},null,544),[[de,m.value]]),t("div",Vc,[p.value?(v(),y("div",Wc,"Loading users...")):w.value.length===0?(v(),y("div",qc,"No users found.")):(v(!0),y(se,{key:2},fe(w.value,U=>(v(),y("div",{key:U.id,class:"user-pick-item",onClick:J=>u(U.id)},[j(ye,{name:U.display_name||U.username,url:U.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Kc,D(U.display_name||U.username),1),t("div",Jc,"@"+D(U.username),1)])],8,Gc))),128))])])):F("",!0),l.value==="group"?(v(),y("div",Qc,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[6]||(M[6]=U=>l.value="select")},[j(x(Ve),{size:16}),M[20]||(M[20]=_e(" Back ",-1))]),t("div",Yc,[M[21]||(M[21]=t("label",{class:"form-label"},"Group name",-1)),te(t("input",{"onUpdate:modelValue":M[7]||(M[7]=U=>c.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[de,c.value]])]),t("div",Xc,[M[22]||(M[22]=t("label",{class:"form-label"},"Description (optional)",-1)),te(t("textarea",{"onUpdate:modelValue":M[8]||(M[8]=U=>h.value=U),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[de,h.value]])]),t("div",Zc,[M[23]||(M[23]=t("label",{class:"form-label"},"Add members",-1)),te(t("input",{"onUpdate:modelValue":M[9]||(M[9]=U=>d.value=U),class:"search-input",type:"search",placeholder:"Search users...",onInput:X},null,544),[[de,d.value]]),t("div",eu,[(v(!0),y(se,null,fe(k.value,U=>(v(),y("div",{key:U.id,class:ve(["user-pick-item",{selected:O.value.has(U.id)}]),onClick:J=>I(U.id)},[j(ye,{name:U.display_name||U.username,url:U.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",nu,[O.value.has(U.id)?(v(),Y(x(Na),{key:0,size:14,style:{"margin-right":"4px"}})):F("",!0),_e(D(U.display_name||U.username),1)]),t("div",su,"@"+D(U.username),1)])],10,tu))),128))])]),t("div",au,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:g}," Create Group ",8,ou)])])):F("",!0),l.value==="channel"?(v(),y("div",iu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[10]||(M[10]=U=>l.value="select")},[j(x(Ve),{size:16}),M[24]||(M[24]=_e(" Back ",-1))]),t("div",lu,[M[25]||(M[25]=t("label",{class:"form-label"},"Channel name",-1)),te(t("input",{"onUpdate:modelValue":M[11]||(M[11]=U=>_.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[de,_.value]])]),t("div",ru,[M[26]||(M[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),te(t("input",{"onUpdate:modelValue":M[12]||(M[12]=U=>L.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[de,L.value]]),M[27]||(M[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",cu,[M[28]||(M[28]=t("label",{class:"form-label"},"Description (optional)",-1)),te(t("textarea",{"onUpdate:modelValue":M[13]||(M[13]=U=>H.value=U),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[de,H.value]])]),t("div",uu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:A}," Create Channel ",8,du)])])):F("",!0)])])]))}}),mu={class:"modal profile-modal profile-modal--self"},fu={class:"profile-tabs"},pu={class:"profile-modal-body profile-modal-body--scrollable"},hu={class:"profile-avatar-section profile-avatar-upload-section"},gu={class:"profile-avatar-overlay"},yu={class:"profile-name"},bu={key:0,class:"profile-status profile-status--online"},ku={class:"profile-info-list"},wu={class:"form-group"},_u={class:"form-group"},Cu={key:0,class:"form-hint form-error"},$u={class:"form-group"},Su={class:"profile-info-item"},Mu={class:"profile-info-value"},xu={class:"profile-edit-actions"},Tu={class:"profile-info-list"},Eu={class:"form-group form-inline"},Lu={class:"form-group form-inline"},Iu={class:"toggle"},Au={class:"form-group form-inline"},Du={class:"form-group form-inline"},Ru=Z({__name:"ProfileModal",props:{initialTab:{default:"profile"}},emits:["close"],setup(e,{emit:a}){const n=e,o=a,s=Ee(),i=Gt(),{showToast:l}=Me(),r=b(n.initialTab),m=b(""),w=b(""),p=b(""),f=b(""),c=b(null),h=b("light"),d=b(!0),k=b("en"),O=b("everyone");De(d,async H=>{H&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(d.value=!1,l("Notifications blocked by browser"))}),ge(async()=>{s.user&&(m.value=s.user.display_name||"",w.value=s.user.username,p.value=s.user.bio||""),h.value=i.theme,d.value=i.notificationsEnabled,k.value=i.language,O.value=i.lastSeenVisibility});async function S(){const H=c.value?.files?.[0];if(H){try{const $=await _n(H),R=await Ta($.id);s.updateUser({avatar_url:R.avatar_url}),l("Avatar updated!")}catch{l("Upload failed")}c.value&&(c.value.value="")}}async function _(){if(f.value="",!s.user)return;const H={display_name:m.value.trim(),bio:p.value.trim()};w.value.trim()&&w.value.trim()!==s.user.username&&(H.username=w.value.trim());try{const $=await xa(s.user.id,H);s.updateUser({display_name:$.display_name,username:$.username}),l("Profile saved!"),o("close")}catch($){$.response?.status===409?f.value="Username already taken":l("Save failed")}}async function L(){try{await i.saveSettings({theme:h.value,notifications_enabled:d.value,language:k.value,last_seen_visibility:O.value}),l("Settings saved!"),o("close")}catch{l("Settings save failed")}}return(H,$)=>(v(),y("div",{class:"modal-backdrop profile-backdrop",onClick:$[12]||($[12]=ae(R=>o("close"),["self"]))},[t("div",mu,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:$[0]||($[0]=R=>o("close"))},[j(x(je),{size:20,"stroke-width":2})]),t("div",fu,[t("button",{class:ve(["profile-tab",{active:r.value==="profile"}]),onClick:$[1]||($[1]=R=>r.value="profile")},"Profile",2),t("button",{class:ve(["profile-tab",{active:r.value==="settings"}]),onClick:$[2]||($[2]=R=>r.value="settings")},"Settings",2)]),t("div",pu,[te(t("div",null,[t("div",hu,[t("div",{class:"profile-avatar-upload-wrap",onClick:$[3]||($[3]=R=>c.value?.click())},[j(ye,{name:m.value||x(s).user?.username||"?",url:x(s).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",gu,[j(x(rs),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",class:"hidden",onChange:S},null,544)]),t("div",yu,D(m.value||x(s).user?.username||"?"),1),x(s).user?(v(),y("div",bu," online ")):F("",!0),$[17]||($[17]=t("div",{class:"profile-divider"},null,-1)),t("div",ku,[t("div",wu,[$[13]||($[13]=t("label",{class:"form-label"},"Display name",-1)),te(t("input",{"onUpdate:modelValue":$[4]||($[4]=R=>m.value=R),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[de,m.value]])]),t("div",_u,[$[14]||($[14]=t("label",{class:"form-label"},"Username",-1)),te(t("input",{"onUpdate:modelValue":$[5]||($[5]=R=>w.value=R),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[de,w.value]]),f.value?(v(),y("small",Cu,D(f.value),1)):F("",!0)]),t("div",$u,[$[15]||($[15]=t("label",{class:"form-label"},"Bio",-1)),te(t("textarea",{"onUpdate:modelValue":$[6]||($[6]=R=>p.value=R),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[de,p.value]])]),t("div",Su,[$[16]||($[16]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Mu,D(x(s).user?.id),1)])]),t("div",xu,[t("button",{class:"btn btn-primary",onClick:_},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:$[7]||($[7]=R=>o("close"))},"Cancel")])],512),[[yt,r.value==="profile"]]),te(t("div",null,[t("div",Tu,[t("div",Eu,[$[19]||($[19]=t("label",{class:"form-label"},"Theme",-1)),te(t("select",{"onUpdate:modelValue":$[8]||($[8]=R=>h.value=R),class:"form-input form-select"},[...$[18]||($[18]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[en,h.value]])]),t("div",Lu,[$[21]||($[21]=t("label",{class:"form-label"},"Notifications",-1)),t("label",Iu,[te(t("input",{"onUpdate:modelValue":$[9]||($[9]=R=>d.value=R),type:"checkbox"},null,512),[[ns,d.value]]),$[20]||($[20]=t("span",{class:"toggle-slider"},null,-1))])]),t("div",Au,[$[23]||($[23]=t("label",{class:"form-label"},"Language",-1)),te(t("select",{"onUpdate:modelValue":$[10]||($[10]=R=>k.value=R),class:"form-input form-select"},[...$[22]||($[22]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[en,k.value]])]),$[26]||($[26]=t("div",{class:"profile-divider"},null,-1)),$[27]||($[27]=t("h4",{class:"form-section-heading"},"Privacy",-1)),t("div",Du,[$[25]||($[25]=t("label",{class:"form-label"},"Last seen & online",-1)),te(t("select",{"onUpdate:modelValue":$[11]||($[11]=R=>O.value=R),class:"form-input form-select"},[...$[24]||($[24]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[en,O.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:L},"Save Settings")])],512),[[yt,r.value==="settings"]])])])]))}}),Ou={class:"profile-actions"},Pu=["disabled","onClick"],Nu={class:"profile-action-btn__circle"},Uu={class:"profile-action-btn__label"},Fu=Z({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:a}){const n=e,o=a,s=B(()=>{const i=[{icon:Va,label:"Message",event:"message"}];return n.showMute!==!1&&i.push({icon:Oa,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&i.push({icon:Ha,label:"More",event:"more"}),i});return(i,l)=>(v(),y("div",Ou,[(v(!0),y(se,null,fe(s.value,r=>(v(),y("button",{key:r.label,class:ve(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:m=>o(r.event)},[t("span",Nu,[(v(),Y(bt(r.icon),{size:22,"stroke-width":1.8}))]),t("span",Uu,D(r.label),1)],10,Pu))),128))]))}}),Bu=me(Fu,[["__scopeId","data-v-b5376905"]]),Hu={class:"modal profile-modal"},ju={class:"profile-modal-body"},zu={key:0,class:"profile-loading"},Vu={class:"profile-avatar-section"},Wu={class:"profile-name"},qu={class:"profile-info-list"},Gu={class:"profile-info-item"},Ku={class:"profile-info-value"},Ju={key:0,class:"profile-info-item"},Qu={class:"profile-info-value"},Yu={class:"profile-info-item"},Xu={class:"profile-info-value"},Zu={key:2,class:"profile-loading"},ed=Z({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:a}){const n=e,o=a,s=Se(),{showToast:i}=Me(),l=b(null),r=b(!0),m=b(!1),w=B(()=>l.value?s.isUserOnline(l.value.id):!1),p=B(()=>{if(w.value)return"online";if(!l.value)return"offline";const c=s.getUserPresence(l.value.id);return c?.lastSeenAt?vs(c.lastSeenAt):c?.lastSeenBucket?`last seen ${c.lastSeenBucket}`:"offline"});ge(async()=>{try{l.value=await ls(n.username)}catch{l.value=null}finally{r.value=!1}});function f(){m.value=!m.value,i(m.value?"User muted":"User unmuted")}return(c,h)=>(v(),y("div",{class:"modal-backdrop profile-backdrop",onClick:h[2]||(h[2]=ae(d=>o("close"),["self"]))},[t("div",Hu,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:h[0]||(h[0]=d=>o("close"))},[j(x(je),{size:20,"stroke-width":2})]),t("div",ju,[r.value?(v(),y("div",zu,[...h[3]||(h[3]=[t("p",null,"Loading...",-1)])])):l.value?(v(),y(se,{key:1},[t("div",Vu,[j(ye,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:w.value,size:"xxl"},null,8,["name","url","online"])]),t("div",Wu,[_e(D(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(v(),Y($s,{key:0})):F("",!0)]),t("div",{class:ve(["profile-status",{"profile-status--online":w.value}])},D(p.value),3),j(Bu,{muted:m.value,"show-more":!1,onMessage:h[1]||(h[1]=d=>o("message",l.value.username)),onMute:f},null,8,["muted"]),h[7]||(h[7]=t("div",{class:"profile-divider"},null,-1)),t("div",qu,[t("div",Gu,[h[4]||(h[4]=t("div",{class:"profile-info-label"},"Username",-1)),t("div",Ku,"@"+D(l.value.username),1)]),l.value.bio?(v(),y("div",Ju,[h[5]||(h[5]=t("div",{class:"profile-info-label"},"Bio",-1)),t("div",Qu,D(l.value.bio),1)])):F("",!0),t("div",Yu,[h[6]||(h[6]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Xu,D(l.value.id),1)])])],64)):(v(),y("div",Zu,[...h[8]||(h[8]=[t("p",null,"User not found",-1)])]))])])]))}}),td={class:"modal",style:{"max-width":"420px"}},nd={class:"modal-header"},sd={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},ad=Z({__name:"DownloadModal",emits:["close"],setup(e,{emit:a}){const n=a,o=navigator.userAgent.toLowerCase(),s=o.includes("win"),i=o.includes("mac")&&!o.includes("iphone")&&!o.includes("ipad"),l=B(()=>s?"Windows":i?"macOS":null);function r(){s?window.location.href="/downloads/windows/MessengerSetup.exe":i&&(window.location.href="/downloads/macos/Messenger.dmg")}return(m,w)=>(v(),y("div",{class:"modal-backdrop",onClick:w[1]||(w[1]=ae(p=>n("close"),["self"]))},[t("div",td,[t("div",nd,[w[2]||(w[2]=t("h2",{class:"modal-title"},"Download Simple Messenger",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:w[0]||(w[0]=p=>n("close"))},[j(x(je),{size:20})])]),t("div",sd,[l.value?(v(),y("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+D(l.value),1)):F("",!0),w[3]||(w[3]=qs('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/MessengerSetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/Messenger.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),od={class:"modal",style:{"max-width":"400px"}},id={class:"modal-header"},ld={class:"modal-body",style:{"text-align":"center"}},rd={key:0},cd={style:{"font-size":"1.25rem","font-weight":"700"}},ud={style:{color:"var(--text-muted)","margin-top":".5rem"}},dd={class:"profile-avatar-section"},vd={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},md={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},fd={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},pd={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},hd=["disabled"],gd=Z({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:a}){const n=e,o=a,{showToast:s}=Me(),i=b(null),l=b(!0),r=b(!1),m=b(""),w=b("");ge(async()=>{if(!n.token){m.value="Invalid Link",w.value="No invite token provided.",l.value=!1;return}try{i.value=await Xs(n.token)}catch(f){f.response?.status===410?(m.value="Invite Revoked",w.value="This invite link has been revoked."):(m.value="Invite Not Found",w.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function p(){r.value=!0;try{const f=await Zs(n.token);s(f.already_member?"You are already a member":"Joined successfully!"),o("joined",f.chat_id)}catch(f){s(f.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(f,c)=>(v(),y("div",{class:"modal-backdrop",onClick:c[2]||(c[2]=ae(h=>o("close"),["self"]))},[t("div",od,[t("div",id,[c[3]||(c[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:c[0]||(c[0]=h=>o("close"))},"âœ•")]),t("div",ld,[l.value?(v(),y("p",rd,"Loading invite preview...")):w.value?(v(),y(se,{key:1},[t("h2",cd,D(m.value),1),t("p",ud,D(w.value),1)],64)):i.value?(v(),y(se,{key:2},[t("div",dd,[j(ye,{name:i.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",vd,D(i.value.title||i.value.type||"Chat"),1),i.value.description?(v(),y("p",md,D(i.value.description),1)):F("",!0),i.value.member_count?(v(),y("p",fd,D(i.value.member_count)+" members ",1)):F("",!0),t("div",pd,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:p},D(r.value?"Joining...":"Join"),9,hd),t("button",{class:"btn btn-ghost",onClick:c[1]||(c[1]=h=>o("close"))},"Cancel")])],64)):F("",!0)])])]))}}),yd=Z({__name:"ContextMenu",setup(e){const a=Se(),{showToast:n}=Me(),{showConfirm:o}=Gs(),s=b(!1),i=b(0),l=b(0),r=b(null),m=B(()=>r.value?a.chats.find(k=>k.id===r.value)??null:null);function w(k){r.value=k.detail.chatId,i.value=k.detail.x,l.value=k.detail.y,s.value=!0}function p(){s.value&&(s.value=!1,r.value=null)}ge(()=>{window.addEventListener("show-context-menu",w),document.addEventListener("click",p)}),He(()=>{window.removeEventListener("show-context-menu",w),document.removeEventListener("click",p)});async function f(){if(r.value){s.value=!1;try{await a.toggleFavorite(r.value)}catch{n("Failed to update favorite")}}}async function c(){if(r.value){s.value=!1;try{await a.toggleMute(r.value)}catch{n("Failed to update mute")}}}async function h(){if(!(!r.value||(s.value=!1,!await o({title:"Leave Chat",message:"Leave this chat?",confirmLabel:"Leave",danger:!0}))))try{await a.leave(r.value),n("Left chat")}catch{n("Failed to leave chat")}}async function d(){if(!(!r.value||(s.value=!1,!await o({title:"Delete Chat",message:"Delete this chat? All messages will be permanently removed.",confirmLabel:"Delete",danger:!0}))))try{await a.deleteChat(r.value),n("Chat deleted")}catch{n("Failed to delete chat")}}return(k,O)=>s.value?(v(),y("div",{key:0,class:"context-menu",style:ct({left:i.value+"px",top:l.value+"px"})},[t("button",{class:"ctx-item",onClick:f},D(m.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:c},D(m.value?.is_muted?"Unmute":"Mute"),1),m.value&&m.value.type!=="direct"?(v(),y("button",{key:0,class:"ctx-item ctx-leave",onClick:h}," Leave chat ")):F("",!0),t("button",{class:"ctx-item ctx-delete",onClick:d}," Delete chat ")],4)):F("",!0)}}),Xn=240,bd=.5,_d=Z({__name:"MessengerView",setup(e){const a=Ks(),n=ss(),o=Ee(),s=Se(),i=Gt(),l=Kt(),{showToast:r}=Me(),{connect:m,disconnect:w,sendTyping:p}=Ma();pt("sendTyping",p);const f=b(!1),c=b(!1),h=b("select"),d=b(!1),k=b("profile"),O=b(!1),S=b(null),_=b(null),L=b([]),H=b(null);pt("stickers",L),pt("pendingScrollMessageId",H);let $=null;ge(async()=>{await i.loadSettings();try{L.value=await Ea()}catch{}await s.loadChats(),m(),$=setInterval(()=>s.loadChats(),5e3),R()}),He(()=>{w(),$&&(clearInterval($),$=null)}),De(()=>a.path,()=>{R()}),De(()=>s.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function R(){const W=a.path;if(W.startsWith("/@")){const z=a.params.username;z&&(S.value=z)}else if(W.startsWith("/u/")){const z=a.params.id;if(z)try{const ne=await is(parseInt(z));S.value=ne.username}catch{r("User not found")}}else if(W.startsWith("/dm/")){const z=a.params.id;z&&await q(z)}else if(W.startsWith("/c/")){const z=a.params.chatIdOrName||a.params.name,ne=a.params.messageId?parseInt(a.params.messageId):null;if(z)if(/^\d+$/.test(z)){const ue=parseInt(z);ne?await I(ue,ne):s.setActiveChat(ue)}else await X(z)}}async function q(W){try{let z;if(W.startsWith("@")){const ce=W.substring(1);z=(await ls(ce)).id}else z=parseInt(W);const ne=await et({type:"direct",member_ids:[z]});await s.loadChats(),s.setActiveChat(ne.id)}catch{r("Failed to open conversation")}}async function X(W){try{const z=await ta(W);s.chats.find(ce=>ce.id===z.id)?s.setActiveChat(z.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function I(W,z){if(!s.chats.find(ce=>ce.id===W)){r("Chat not found");return}s.setActiveChat(W),await ke(),H.value=z}const u=parseInt(localStorage.getItem("sidebar-width")||"360",10);u>=Xn&&document.documentElement.style.setProperty("--sidebar-width",u+"px");function g(W){W.preventDefault();const z=W.currentTarget;z.setPointerCapture(W.pointerId);const ne=ue=>{const Te=window.innerWidth*bd,Yt=Math.min(Te,Math.max(Xn,ue.clientX));document.documentElement.style.setProperty("--sidebar-width",Yt+"px")},ce=()=>{z.removeEventListener("pointermove",ne),z.removeEventListener("pointerup",ce);const ue=getComputedStyle(document.documentElement).getPropertyValue("--sidebar-width").trim();localStorage.setItem("sidebar-width",parseInt(ue,10).toString())};z.addEventListener("pointermove",ne),z.addEventListener("pointerup",ce)}function A(W){s.setActiveChat(W),n.replace("/app")}function T(){s.setActiveChat(null)}function M(){f.value=!1,k.value="profile",d.value=!0}function U(){f.value=!1,k.value="settings",d.value=!0}function J(){f.value=!1,h.value="group",c.value=!0}function re(){f.value=!1,h.value="channel",c.value=!0}async function be(){if(f.value=!1,!!o.user)try{const W=await et({type:"direct",member_ids:[o.user.id]});await s.loadChats(),s.setActiveChat(W.id)}catch{r("Failed to open Saved Messages")}}function We(W){S.value=W}async function V(W){S.value=null,await q("@"+W)}async function Q(W){c.value=!1,await s.loadChats(),s.setActiveChat(W)}async function ie(W){_.value=null,await s.loadChats(),s.setActiveChat(W)}function pe(W){const z=W.target?.closest("a");if(!z)return;const ne=z.getAttribute("href");if(!ne)return;let ce;try{ce=new URL(ne,window.location.origin)}catch{return}if(ce.origin!==window.location.origin){W.preventDefault(),W.stopPropagation(),window.open(ce.href,"_blank");return}W.preventDefault(),W.stopPropagation();const ue=ce.pathname,Te=ue.match(/^\/join\/([^/]+)$/);if(Te){_.value=Te[1]??null;return}if(ue.startsWith("/@")||ue.startsWith("/u/")||ue.startsWith("/dm/")||ue.startsWith("/c/")){n.push(ue);return}n.push(ue)}function xe(W){if(W.key==="Escape"){if(_.value){_.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if(S.value){S.value=null;return}if(c.value){c.value=!1;return}if(d.value){d.value=!1;return}if(O.value){O.value=!1;return}if(f.value){f.value=!1;return}if(s.activeChatId!==null){T();return}}}return ge(()=>{document.addEventListener("keydown",xe),document.addEventListener("click",pe,!0)}),He(()=>{document.removeEventListener("keydown",xe),document.removeEventListener("click",pe,!0)}),(W,z)=>(v(),y("div",{class:ve(["layout",{"chat-open":!!x(s).activeChatId}])},[j(Oc,{open:f.value,onClose:z[0]||(z[0]=ne=>f.value=!1),onOpenProfile:M,onOpenSettings:U,onOpenNewGroup:J,onOpenNewChannel:re,onOpenFavorites:be,onOpenDownload:z[1]||(z[1]=ne=>O.value=!0)},null,8,["open"]),t("div",{class:ve(["drawer-overlay",{visible:f.value}]),onClick:z[2]||(z[2]=ne=>f.value=!1)},null,2),j(ko,{onOpenDrawer:z[3]||(z[3]=ne=>f.value=!0),onOpenNewChat:z[4]||(z[4]=ne=>{h.value="select",c.value=!0}),onSelectChat:A}),t("div",{class:"resize-handle",onPointerdown:g},null,32),j(gc,{onBack:T,onOpenUserProfile:We}),c.value?(v(),Y(vu,{key:0,"initial-step":h.value,onClose:z[5]||(z[5]=ne=>c.value=!1),onChatCreated:Q},null,8,["initial-step"])):F("",!0),d.value?(v(),Y(Ru,{key:1,"initial-tab":k.value,onClose:z[6]||(z[6]=ne=>d.value=!1)},null,8,["initial-tab"])):F("",!0),S.value?(v(),Y(ed,{key:2,username:S.value,onClose:z[7]||(z[7]=ne=>S.value=null),onMessage:V},null,8,["username"])):F("",!0),O.value?(v(),Y(ad,{key:3,onClose:z[8]||(z[8]=ne=>O.value=!1)})):F("",!0),_.value?(v(),Y(gd,{key:4,token:_.value,onClose:z[9]||(z[9]=ne=>_.value=null),onJoined:ie},null,8,["token"])):F("",!0),j(yd)],2))}});export{_d as default};
