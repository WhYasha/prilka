const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmojiPickerPanel-CTtJfjhL.js","assets/index-y0clz0cy.js","assets/index-BqHOj3sy.css","assets/invites-BoJ6GeKb.js","assets/EmojiPickerPanel-BVUGRNAt.css"])))=>i.map(i=>d[i]);
import{l as Z,m as lt,r as g,p as H,q as ba,s as Fe,u as Pe,x as $n,d as se,o as u,c as p,a as t,t as E,w as le,y as rt,n as ve,h as F,b,e as P,g as we,z as J,f as pe,v as _e,F as re,A as ke,B as pt,C as Ue,D as ot,E as ka,G as Ee,H as Rt,I as Ie,T as Cs,J as Ae,i as un,K as Dn,L as $s,M as _a,N as ss,O as as,P as wa,_ as Ca,Q as Ve,k as Ss,R as pn,S as $a,U as Sa}from"./index-y0clz0cy.js";import{_ as Se,l as Ma,c as xa,r as Ea,p as Ta,j as Ia}from"./invites-BoJ6GeKb.js";async function La(){const{data:e}=await Z.get("/chats");return e}async function Ms(e){const{data:s}=await Z.get(`/chats/${e}`);return s}async function Aa(e){const{data:s}=await Z.get(`/chats/by-name/${encodeURIComponent(e)}`);return s}async function ht(e){const{data:s}=await Z.post("/chats",e);return s}async function Da(e){await Z.post(`/chats/${e}/favorite`)}async function Ra(e){await Z.delete(`/chats/${e}/favorite`)}async function Pa(e,s){await Z.post(`/chats/${e}/mute`,{})}async function Oa(e){await Z.delete(`/chats/${e}/mute`)}async function Na(e){await Z.delete(`/chats/${e}/leave`)}async function gt(e){await Z.post(`/chats/${e}/read`)}async function Ua(e){await Z.post(`/chats/${e}/pin`)}async function Fa(e){await Z.delete(`/chats/${e}/pin`)}async function za(e){await Z.post(`/chats/${e}/archive`)}async function Ba(e){await Z.delete(`/chats/${e}/archive`)}async function ja(e){const{data:s}=await Z.get(`/chats/${e}`);return s.members??[]}async function xs(e){await Z.delete(`/chats/${e}`)}async function Ha(e,s){const{data:n}=await Z.patch(`/chats/${e}`,s);return n}async function Va(e){const{data:s}=await Z.get(`/chats/${e}/read-receipts`);return s}const xe=lt("chats",()=>{const e=g([]),s=g(null),n=g({}),o=g(!0),i=g(new Set),a=g({}),l=H(()=>e.value.find(I=>I.id===s.value)??null),r=H(()=>[...e.value].sort((I,M)=>{if(I.is_pinned&&!M.is_pinned)return-1;if(!I.is_pinned&&M.is_pinned)return 1;if(I.is_favorite&&!M.is_favorite)return-1;if(!I.is_favorite&&M.is_favorite)return 1;const $=I.last_at||I.updated_at||"";return(M.last_at||M.updated_at||"").localeCompare($)}));async function c(){try{const I=await La();e.value=I;for(const M of I){const $=M;M.type==="direct"&&$.other_user_id&&$.other_is_online===!0&&ae($.other_user_id)}}catch(I){console.error("Failed to load chats",I)}}function y(I){if(s.value=I,I!==null){const M=e.value.find($=>$.id===I);M&&M.unread_count>0&&(M.unread_count=0),gt(I).catch(()=>{})}}async function m(I){const M=e.value.find($=>$.id===I);if(M)try{M.is_favorite?await Ra(I):await Da(I),M.is_favorite=!M.is_favorite}catch($){throw console.error("Failed to toggle favorite",$),$}}async function f(I){const M=e.value.find($=>$.id===I);if(M)try{M.is_muted?await Oa(I):await Pa(I),M.is_muted=!M.is_muted}catch($){throw console.error("Failed to toggle mute",$),$}}async function v(I){const M=e.value.find($=>$.id===I);if(M)try{M.is_pinned?await Fa(I):await Ua(I),M.is_pinned=!M.is_pinned}catch($){throw console.error("Failed to toggle pin",$),$}}async function d(I){const M=e.value.find($=>$.id===I);if(M)try{M.is_archived?await Ba(I):await za(I),M.is_archived=!M.is_archived}catch($){throw console.error("Failed to toggle archive",$),$}}async function h(I){await Na(I),e.value=e.value.filter(M=>M.id!==I),s.value===I&&(s.value=null)}async function k(I){await xs(I),e.value=e.value.filter(M=>M.id!==I),s.value===I&&(s.value=null)}function C(I,M,$){const B=e.value.find(ue=>ue.id===I);B&&(B.last_message=M,B.last_at=$)}function _(I,M){const $=e.value.find(B=>B.id===I);$&&(M.title!==void 0&&($.title=M.title),M.description!==void 0&&($.description=M.description),M.avatar_url!==void 0&&($.avatar_url=M.avatar_url))}function S(I){e.value=e.value.filter(M=>M.id!==I),s.value===I&&(s.value=null)}function z(I){const M=e.value.find($=>$.id===I);M&&(M.unread_count=(M.unread_count||0)+1)}function q(I,M,$){n.value[I]||(n.value[I]={});const B=n.value[I][M];B&&clearTimeout(B.timer);const ue=setTimeout(()=>{U(I,M)},3e3);n.value[I][M]={username:$,timer:ue}}function U(I,M){if(n.value[I]){const $=n.value[I][M];$&&(clearTimeout($.timer),delete n.value[I][M])}}function j(I){const M=n.value[I];return M?Object.values(M).map($=>$.username):[]}function ae(I){i.value=new Set([...i.value,I]),a.value={...a.value,[I]:{isOnline:!0}}}function he(I,M,$){const B=new Set(i.value);B.delete(I),i.value=B,a.value={...a.value,[I]:{isOnline:!1,lastSeenAt:M,lastSeenBucket:$}}}function ce(I,M){if(M.isOnline)i.value=new Set([...i.value,I]);else{const $=new Set(i.value);$.delete(I),i.value=$}a.value={...a.value,[I]:M}}function oe(I){return a.value[I]}function de(I){return i.value.has(I)}return{chats:e,activeChatId:s,activeChat:l,sortedChats:r,isNearBottom:o,typingUsers:n,loadChats:c,setActiveChat:y,toggleFavorite:m,toggleMute:f,togglePin:v,toggleArchive:d,leave:h,deleteChat:k,updateChatLastMessage:C,updateChatMetadata:_,removeChatLocal:S,incrementUnread:z,setTyping:q,clearTyping:U,getTypingUsernames:j,onlineUsers:i,userPresenceDetails:a,setUserOnline:ae,setUserOffline:he,setUserPresence:ce,getUserPresence:oe,isUserOnline:de}});async function Wa(){const{data:e}=await Z.get("/settings");return e}async function qa(e){await Z.put("/settings",e)}const Mt=lt("settings",()=>{const e=g(localStorage.getItem("theme")||"light"),s=g(!0),n=g("en"),o=g("everyone"),i=g(!0);function a(c){e.value=c,document.body.setAttribute("data-theme",c),localStorage.setItem("theme",c)}async function l(){try{const c=await Wa();a(c.theme||"light"),s.value=c.notifications_enabled,n.value=c.language||"en",o.value=c.last_seen_visibility||"everyone",i.value=c.read_receipts_enabled!==!1}catch(c){console.error("Failed to load settings",c)}}async function r(c){await qa(c),c.theme&&a(c.theme),c.notifications_enabled!==void 0&&(s.value=c.notifications_enabled),c.language&&(n.value=c.language),c.last_seen_visibility&&(o.value=c.last_seen_visibility),c.read_receipts_enabled!==void 0&&(i.value=c.read_receipts_enabled)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:s,language:n,lastSeenVisibility:o,readReceiptsEnabled:i,applyTheme:a,loadSettings:l,saveSettings:r}}),tt=lt("selection",()=>{const e=g(new Set),s=g(!1),n=g(null),o=H(()=>e.value.size);function i(m,f){s.value=!0,n.value=m,e.value=new Set(f!=null?[f]:[])}function a(){s.value=!1,n.value=null,e.value=new Set}function l(m){const f=new Set(e.value);f.has(m)?f.delete(m):f.add(m),e.value=f,f.size===0&&a()}function r(m){if(!s.value||e.value.has(m))return;const f=new Set(e.value);f.add(m),e.value=f}function c(){e.value=new Set}function y(m){return e.value.has(m)}return{selectedMessageIds:e,selectionMode:s,currentChatId:n,selectedCount:o,enterSelectionMode:i,exitSelectionMode:a,toggleMessage:l,addMessage:r,clearSelection:c,isSelected:y}});async function At(e,s){const{data:n}=await Z.get(`/chats/${e}/messages`,{params:s});return n}async function Ga(e,s){const{data:n}=await Z.post(`/chats/${e}/messages`,s);return n}async function Ka(e,s,n=!1){await Z.delete(`/chats/${e}/messages/${s}`,n?{data:{for_everyone:!0}}:void 0)}async function Ya(e,s,n){const{data:o}=await Z.put(`/chats/${e}/messages/${s}`,{content:n});return o}async function Ja(e,s){const{data:n}=await Z.post(`/chats/${e}/messages/forward`,s);return n}async function Xa(e,s){const{data:n}=await Z.post(`/chats/${e}/messages/${s}/pin`);return n}async function Qa(e,s){await Z.delete(`/chats/${e}/messages/${s}/pin`)}async function Za(e){const{data:s}=await Z.get(`/chats/${e}/pinned-message`);return s}async function is(e,s,n){const{data:o}=await Z.get(`/chats/${e}/messages/search`,{params:{q:s,...n}});return o}async function ei(e,s,n){const{data:o}=await Z.post(`/chats/${e}/messages/${s}/reactions`,{emoji:n});return o}async function ti(e,s){if(!s.length)return{};const{data:n}=await Z.get(`/chats/${e}/reactions`,{params:{message_ids:s.join(",")}});return n}const et=lt("messages",()=>{const e=g({}),s=g({}),n=g(null),o=g({}),i=g(new Set),a=ba(new Set);function l(T){return a.add(T),new Promise(A=>setTimeout(A,600))}function r(T){return a.has(T)}async function c(T){const A=e.value[T];if(!A||A.length===0)return;const G=A.map(V=>V.id);try{const V=await ti(T,G);for(const X of A)X.reactions=V[String(X.id)]||void 0}catch(V){console.error("Failed to load reactions",V)}}async function y(T){n.value=T;try{const A=await At(T,{limit:50});e.value[T]=A,A.length>0&&(s.value[T]=Math.max(...A.map(G=>G.id))),await c(T)}catch(A){throw console.error("Failed to load messages",A),A}finally{n.value=null}}async function m(T){const A=s.value[T]||0;if(A===0)return[];try{const G=await At(T,{after_id:A,limit:50});if(G.length>0){e.value[T]||(e.value[T]=[]);const V=new Set(e.value[T].map(ie=>ie.id)),X=G.filter(ie=>!V.has(ie.id));e.value[T].push(...X),s.value[T]=Math.max(...G.map(ie=>ie.id)),await c(T)}return G}catch(G){return console.error("Failed to load newer messages",G),[]}}async function f(T){const A=e.value[T];if(!A||A.length===0)return[];const G=A[0];if(!G)return[];try{const V=await At(T,{before:G.created_at,limit:50});if(V.length>0){const X=new Set(A.map(K=>K.id)),ie=V.filter(K=>!X.has(K.id));e.value[T]=[...ie,...A],await c(T)}return V}catch(V){return console.error("Failed to load older messages",V),[]}}async function v(T,A,G){try{const V=await ei(T,A,G);d(T,A,V.action,G,!0)}catch(V){console.error("Failed to toggle reaction",V)}}function d(T,A,G,V,X){const ie=e.value[T];if(!ie)return;const K=ie.find(x=>x.id===A);if(!K)return;K.reactions||(K.reactions=[]);const W=K.reactions.find(x=>x.emoji===V);G==="added"?W?(W.count++,X&&(W.me=!0)):K.reactions.push({emoji:V,count:1,me:X}):W&&(W.count--,X&&(W.me=!1),W.count<=0&&(K.reactions=K.reactions.filter(x=>x.emoji!==V))),K.reactions.length===0&&(K.reactions=void 0)}async function h(T,A,G="text",V){const X=await Ga(T,{content:A,type:G,...V});e.value[T]||(e.value[T]=[]),k(T,X);const ie=e.value[T].findIndex(K=>K.id===X.id);return ie!==-1?e.value[T][ie]=X:e.value[T].push(X),s.value[T]=Math.max(s.value[T]||0,X.id),X}function k(T,A){if(!A.reply_to_message_id||A.reply_to_sender_username||A.reply_to_sender_name)return;const G=e.value[T];if(!G)return;const V=G.find(X=>X.id===A.reply_to_message_id);V&&(A.reply_to_sender_username=V.sender_username,A.reply_to_sender_name=V.sender_display_name||V.sender_username,!A.reply_to_content&&V.content&&(A.reply_to_content=V.content),!A.reply_to_type&&V.message_type&&(A.reply_to_type=V.message_type))}function C(T,A){e.value[T]||(e.value[T]=[]),e.value[T].find(V=>V.id===A.id)||(k(T,A),e.value[T].push(A),s.value[T]=Math.max(s.value[T]||0,A.id))}async function _(T,A,G=!1){try{await l(A),await Ka(T,A,G),S(T,A)}catch(V){throw console.error("Failed to delete message",V),V}finally{a.delete(A)}}function S(T,A){const G=e.value[T];G&&(e.value[T]=G.filter(V=>V.id!==A))}async function z(T,A,G){try{const V=await Ya(T,A,G);q(T,A,V.content,V.updated_at)}catch(V){throw console.error("Failed to edit message",V),V}}function q(T,A,G,V){const X=e.value[T];if(!X)return;const ie=X.find(K=>K.id===A);ie&&(ie.content=G,ie.is_edited=!0,V&&(ie.updated_at=V))}async function U(T,A,G){try{const V=await Ja(T,{from_chat_id:A,message_ids:G});for(const X of V)C(T,X);return V}catch(V){throw console.error("Failed to forward messages",V),V}}async function j(T){try{const A=await Za(T);A&&A.message?o.value[T]={message:A.message,pinnedAt:A.pinned_at,pinnedBy:A.pinned_by}:o.value[T]=null}catch(A){console.error("Failed to load pinned message",A),o.value[T]=null}}async function ae(T,A){try{const G=await Xa(T,A);o.value[T]={message:G.message,pinnedAt:G.pinned_at,pinnedBy:G.pinned_by},i.value.delete(T)}catch(G){throw console.error("Failed to pin message",G),G}}async function he(T,A){try{await Qa(T,A),o.value[T]=null}catch(G){throw console.error("Failed to unpin message",G),G}}function ce(T,A,G,V){o.value[T]={message:V,pinnedAt:new Date().toISOString(),pinnedBy:G},i.value.delete(T)}function oe(T){o.value[T]=null}function de(T){i.value.add(T)}function I(T){return e.value[T]||[]}const M=g({});function $(T,A,G){M.value[T]||(M.value[T]={});const V=M.value[T][A]||0;G>V&&(M.value[T][A]=G)}async function B(T){try{const A=await Va(T);M.value[T]||(M.value[T]={});for(const G of A)M.value[T][G.user_id]=G.last_read_msg_id}catch(A){console.error("Failed to load read receipts",A)}}function ue(T,A,G){const V=M.value[T];return V?G?(V[G]||0)>=A:Object.values(V).some(X=>X>=A):!1}function Ce(T,A){const G=M.value[T];return G?Object.values(G).filter(V=>V>=A).length:0}return{messagesByChat:e,lastMsgId:s,loadingChat:n,loadMessages:y,loadNewer:m,loadOlder:f,sendMessage:h,pushMessage:C,getMessages:I,toggleReaction:v,applyReactionUpdate:d,deleteMessage:_,removeMessage:S,editMessage:z,applyMessageUpdate:q,forwardMessages:U,pinnedByChat:o,pinnedDismissed:i,loadPinnedMessage:j,pinMsg:ae,unpinMsg:he,applyMessagePinned:ce,applyMessageUnpinned:oe,dismissPin:de,deletingMessages:a,markForDeletion:l,isDeleting:r,readReceipts:M,applyReadReceipt:$,loadReadReceipts:B,isMessageRead:ue,getReadCount:Ce}});function ni(e,s,n){if(e.sender_id===n.user?.id||!Mt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||s.chats.find(c=>c.id===e.chat_id)?.is_muted)return;const a=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(a,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),s.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function si(){const e=g(!1);let s=null,n=null,o=null,i=null,a=1e3,l=!1,r=!1,c=null;const y=3e4;let m=Date.now(),f=0,v=!1,d=null,h=!1,k=null,C=!0;const _=new Map;let S=null,z=null;function q(x){z=x,!S&&(S=setTimeout(()=>{S=null,z!==null&&(gt(z).catch(()=>{}),z=null)},1e3))}function U(x){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"presence_update",status:x}))}function j(){C&&(m=Date.now(),!v&&!document.hidden&&(v=!0,U("active")))}function ae(){v&&!k&&(k=setTimeout(()=>{k=null,v&&(v=!1,U("away"))},3e3))}function he(){k&&(clearTimeout(k),k=null)}function ce(){if(document.hidden)ae();else{he(),!v&&Date.now()-m<y&&(v=!0,U("active"));const x=xe();if(x.activeChatId&&x.isNearBottom){const R=x.chats.find(N=>N.id===x.activeChatId);R&&R.unread_count>0&&(R.unread_count=0),gt(x.activeChatId).catch(()=>{})}}}function oe(){C=!1,ae()}function de(){C=!0,he(),m=Date.now(),v||(v=!0,U("active"));const x=xe();if(x.activeChatId&&x.isNearBottom){const R=x.chats.find(N=>N.id===x.activeChatId);R&&R.unread_count>0&&(R.unread_count=0),gt(x.activeChatId).catch(()=>{})}}function I(){document.hidden||Date.now()-m>y&&v&&(v=!1,U("away"))}function M(){if(h)return;h=!0;const x={passive:!0,capture:!0};document.addEventListener("mousemove",j,x),document.addEventListener("keydown",j,x),document.addEventListener("click",j,x),document.addEventListener("scroll",j,x),document.addEventListener("touchstart",j,x),document.addEventListener("visibilitychange",ce),window.addEventListener("blur",oe),window.addEventListener("focus",de),d=setInterval(I,15e3)}function $(){if(!h)return;h=!1;const x={capture:!0};document.removeEventListener("mousemove",j,x),document.removeEventListener("keydown",j,x),document.removeEventListener("click",j,x),document.removeEventListener("scroll",j,x),document.removeEventListener("touchstart",j,x),document.removeEventListener("visibilitychange",ce),window.removeEventListener("blur",oe),window.removeEventListener("focus",de),k&&(clearTimeout(k),k=null),d&&(clearInterval(d),d=null)}function B(){return localStorage.getItem("access_token")?"wss://ws.behappy.rest/ws":null}function ue(){if(s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING))return;const x=B();x&&(l=!1,s=new WebSocket(x),s.onopen=()=>{e.value=!0,a=1e3,c=null,K(),m=Date.now(),f=0,v=!document.hidden;const R=localStorage.getItem("access_token");R&&s.send(JSON.stringify({type:"auth",token:R,active:v}));const N=xe();for(const Q of N.chats)s.send(JSON.stringify({type:"subscribe",chat_id:Q.id}));if(r){const Q=et();N.loadChats(),N.activeChatId&&Q.loadNewer(N.activeChatId)}r=!0,T(),M()},s.onmessage=R=>{try{const N=JSON.parse(R.data);Ce(N)}catch{}},s.onclose=()=>{e.value=!1,A(),l||(c=c||Date.now(),G(),ie())},s.onerror=()=>{})}function Ce(x){const R=et(),N=xe(),Q=Pe();switch(x.type){case"message":{const Y=x;R.pushMessage(Y.chat_id,Y),N.updateChatLastMessage(Y.chat_id,Y.content||(Y.message_type==="sticker"?"Sticker":"Attachment"),Y.created_at),Y.sender_id!==Q.user?.id&&(Y.chat_id===N.activeChatId&&v&&C&&N.isNearBottom?q(Y.chat_id):N.incrementUnread(Y.chat_id)),N.clearTyping(Y.chat_id,Y.sender_id),(!v||!C||document.hidden)&&ni(Y,N,Q);break}case"typing":{const Y=x.chat_id,fe=x.user_id;if(fe!==Q.user?.id){const be=x.username||"Someone";N.setTyping(Y,fe,be)}break}case"pong":break;case"presence":{const Y=x.user_id,fe=x.status;if(_.get(Y)===fe)break;_.set(Y,fe);const be=x.last_seen_at,Me=x.last_seen_bucket;if(fe==="online")N.setUserOnline(Y);else if(fe==="offline"){const Je=be||new Date().toISOString();N.setUserOffline(Y,Je,Me)}break}case"message_deleted":{const Y=x.chat_id,fe=x.message_id;R.removeMessage(Y,fe);break}case"message_updated":{const Y=x.chat_id,fe=x.message_id,be=x.content,Me=x.updated_at;R.applyMessageUpdate(Y,fe,be,Me);break}case"message_pinned":{const Y=x.chat_id,fe=x.message_id,be=x.pinned_by,Me=x.message;R.applyMessagePinned(Y,fe,be,Me);break}case"message_unpinned":{const Y=x.chat_id;R.applyMessageUnpinned(Y);break}case"reaction":{const Y=x.chat_id,fe=x.message_id,be=x.user_id,Me=x.emoji,Je=x.action;R.applyReactionUpdate(Y,fe,Je,Me,be===Q.user?.id);break}case"read_receipt":{const Y=x.chat_id,fe=x.user_id,be=x.last_read_msg_id;R.applyReadReceipt(Y,fe,be);break}case"chat_created":{const Y=x.chat_id;N.loadChats().then(()=>{V(Y)});break}case"chat_updated":{const Y=x.chat_id;N.updateChatMetadata(Y,{title:x.title,description:x.description,avatar_url:x.avatar_url});break}case"chat_deleted":{const Y=x.chat_id;N.removeChatLocal(Y);break}case"chat_member_joined":break;case"chat_member_left":{const Y=x.chat_id;x.user_id===Q.user?.id&&N.removeChatLocal(Y);break}case"user_profile_updated":{const Y=x.user_id,fe=x.display_name,be=x.avatar_url;for(const Me of N.chats)Me.type==="direct"&&Me.other_user_id===Y&&(fe!==void 0&&(Me.title=fe),be!==void 0&&(Me.other_avatar_url=be));break}}}function T(){A(),o=setInterval(()=>{if(s&&s.readyState===WebSocket.OPEN){const x=Date.now(),R=x-m<6e4,N=x-f>12e4;v&&R&&N?(s.send(JSON.stringify({type:"ping",active:!0})),f=x):s.send(JSON.stringify({type:"ping"}))}},25e3)}function A(){o&&(clearInterval(o),o=null)}function G(){n||(n=setTimeout(()=>{n=null,ue(),a=Math.min(a*2,3e4)},a))}function V(x){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"subscribe",chat_id:x}))}function X(x){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"typing",chat_id:x}))}function ie(){i||(i=setInterval(()=>{if(c&&Date.now()-c>1e4){const x=xe();x.loadChats();const R=et();x.activeChatId&&R.loadNewer(x.activeChatId)}},5e3))}function K(){i&&(clearInterval(i),i=null)}function W(){l=!0,A(),K(),$(),n&&(clearTimeout(n),n=null),s&&(s.close(),s=null),e.value=!1}return Fe(()=>{W()}),{connected:e,connect:ue,disconnect:W,subscribeToChat:V,sendTyping:X}}async function Es(e){const{data:s}=await Z.get(`/users/${e}`);return s}async function Ts(e){const{data:s}=await Z.get(`/users/by-username/${encodeURIComponent(e)}`);return s}async function os(e){const{data:s}=await Z.get("/users/search",{params:{q:e}});return s}async function ai(e,s){const{data:n}=await Z.put(`/users/${e}`,s);return n}async function ii(e){const{data:s}=await Z.put("/users/me/avatar",{file_id:e});return s}async function oi(){const{data:e}=await Z.get("/stickers");return e}const li=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};const ls=e=>e==="";const ri=(...e)=>e.filter((s,n,o)=>!!s&&s.trim()!==""&&o.indexOf(s)===n).join(" ").trim();const rs=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const ci=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,n,o)=>o?o.toUpperCase():n.toLowerCase());const ui=e=>{const s=ci(e);return s.charAt(0).toUpperCase()+s.slice(1)};var vt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const di=({name:e,iconNode:s,absoluteStrokeWidth:n,"absolute-stroke-width":o,strokeWidth:i,"stroke-width":a,size:l=vt.width,color:r=vt.stroke,...c},{slots:y})=>$n("svg",{...vt,...c,width:l,height:l,stroke:r,"stroke-width":ls(n)||ls(o)||n===!0||o===!0?Number(i||a||vt["stroke-width"])*24/Number(l):i||a||vt["stroke-width"],class:ri("lucide",c.class,...e?[`lucide-${rs(ui(e))}-icon`,`lucide-${rs(e)}`]:["lucide-icon"]),...!y.default&&!li(c)&&{"aria-hidden":"true"}},[...s.map(m=>$n(...m)),...y.default?[y.default()]:[]]);const te=(e,s)=>(n,{slots:o,attrs:i})=>$n(di,{...i,...n,iconNode:s,name:e},o);const He=te("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const vi=te("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);const Is=te("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const cs=te("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);const mi=te("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const Ls=te("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const As=te("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const fi=te("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Ds=te("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const pi=te("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const hi=te("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const us=te("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const hn=te("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Rn=te("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const ds=te("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const gi=te("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);const Pn=te("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const yi=te("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const bi=te("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const On=te("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const Rs=te("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const ki=te("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const _i=te("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const Ps=te("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);const wi=te("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const vs=te("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);const Ci=te("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);const Nn=te("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const $i=te("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);const Si=te("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);const Mi=te("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]);const xi=te("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Ei=te("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Ti=te("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);const Ii=te("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const Li=te("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const Os=te("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const Ns=te("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const Un=te("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const Ye=te("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ai="/assets/chat-type-channel-BdwnW-Co.png",Di="/assets/chat-type-group-DoN7bi6N.png",Ri={class:"swipe-actions swipe-actions-left"},Pi={class:"chat-item-info"},Oi={class:"chat-item-top"},Ni={class:"chat-item-name"},Ui={key:0,src:Ai,alt:"",class:"chat-type-icon-img"},Fi={key:1,src:Di,alt:"",class:"chat-type-icon-img"},zi={class:"chat-item-time"},Bi={class:"chat-item-bottom"},ji={class:"chat-item-preview"},Hi=["title"],Vi={class:"swipe-actions swipe-actions-right"},ms=70,Wi=se({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:s}){const n=e,o=xe(),i=Pe(),a=H(()=>n.chat.type==="direct"&&!n.chat.other_user_id),l=H(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:o.isUserOnline(n.chat.other_user_id)||null),r=H(()=>(n.chat.unread_count??0)>0),c=s,y=H(()=>{const _=n.chat;return a.value?"Saved Messages":_.type==="channel"||_.type==="group"?_.title||_.name||"Untitled":_.other_display_name||_.other_username||_.title||_.name||"Chat"});function m(_){if(!_)return"";const S=new Date(_.endsWith("Z")?_:_+"Z"),z=new Date;return S.toDateString()===z.toDateString()?S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):S.toLocaleDateString([],{month:"short",day:"numeric"})}const f=g(0);let v=0,d=!1;function h(_){v=_.touches[0].clientX,d=!0}function k(_){if(!d)return;const S=_.touches[0].clientX-v;f.value=Math.max(-ms,Math.min(ms,S))}function C(){d=!1,f.value=0}return(_,S)=>(u(),p("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:h,onTouchmove:k,onTouchend:C},[t("div",Ri,[t("button",{class:"swipe-action swipe-pin",onClick:S[0]||(S[0]=z=>c("togglePin"))},E(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:ve(["chat-item",{active:e.active,"chat-item-unread":r.value}]),style:rt({transform:`translateX(${f.value}px)`}),onClick:S[2]||(S[2]=z=>c("select")),onContextmenu:S[3]||(S[3]=le(z=>c("contextmenu",z),["prevent"]))},[F(Se,{name:y.value,url:a.value?b(i).user?.avatar_url||null:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"md",online:l.value},null,8,["name","url","online"]),t("div",Pi,[t("div",Oi,[t("span",Ni,[e.chat.type==="channel"?(u(),p("img",Ui)):e.chat.type==="group"?(u(),p("img",Fi)):P("",!0),we(" "+E(y.value)+" ",1),e.chat.is_pinned?(u(),J(b($i),{key:2,class:"status-icon",size:14,"stroke-width":1.8,title:"Pinned"})):P("",!0),e.chat.is_muted?(u(),J(b(Is),{key:3,class:"status-icon status-icon-muted",size:14,"stroke-width":1.8,title:"Muted"})):P("",!0)]),t("span",zi,E(m(e.chat.last_at||e.chat.updated_at)),1)]),t("div",Bi,[t("span",ji,E(e.chat.last_message||""),1),e.chat.unread_count>0?(u(),p("span",{key:0,class:ve(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},E(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):P("",!0)])]),t("button",{class:ve(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:S[1]||(S[1]=le(z=>c("toggleFavorite"),["stop"]))},"â˜…",10,Hi)],38),t("div",Vi,[t("button",{class:"swipe-action swipe-mute",onClick:S[4]||(S[4]=z=>c("toggleMute"))},E(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),me=(e,s)=>{const n=e.__vccOpts||e;for(const[o,i]of s)n[o]=i;return n},gn=me(Wi,[["__scopeId","data-v-2efc56eb"]]),qi={class:"sidebar"},Gi={class:"sidebar-header"},Ki={class:"search-wrap"},Yi={class:"chat-list"},Ji={key:0,class:"empty-state-small"},Xi={key:0,class:"chat-section-label"},Qi={key:1,class:"chat-section-label"},Zi={key:2,class:"chat-section-label"},eo=se({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:s}){const n=s,o=xe(),i=g(""),a=H(()=>{const v=i.value.toLowerCase(),d=o.sortedChats.filter(h=>!h.is_archived);return v?d.filter(h=>{const k=y(h).toLowerCase(),C=(h.other_username||"").toLowerCase();return k.includes(v)||C.includes(v)}):d}),l=H(()=>a.value.filter(v=>v.is_pinned&&!v.is_favorite)),r=H(()=>a.value.filter(v=>v.is_favorite&&!v.is_pinned)),c=H(()=>a.value.filter(v=>!v.is_favorite&&!v.is_pinned));function y(v){return v.type==="channel"||v.type==="group"?v.title||v.name||"Untitled":v.type==="direct"&&!v.other_user_id?"Saved Messages":v.other_display_name||v.other_username||v.title||v.name||"Chat"}const m=g(null);pt("contextChatId",m);function f(v,d){v.preventDefault(),m.value=d,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:v.clientX,y:v.clientY,chatId:d}}))}return(v,d)=>(u(),p("aside",qi,[t("header",Gi,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:d[0]||(d[0]=h=>n("openDrawer"))},[F(b(ki),{size:20})]),t("div",Ki,[F(b(Si),{size:16,class:"search-icon"}),pe(t("input",{"onUpdate:modelValue":d[1]||(d[1]=h=>i.value=h),class:"search-input",type:"search",placeholder:"Search"},null,512),[[_e,i.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:d[2]||(d[2]=h=>n("openNewChat"))},[F(b(Ii),{size:20})])]),t("div",Yi,[a.value.length===0?(u(),p("div",Ji,[...d[3]||(d[3]=[we(" No conversations yet.",-1),t("br",null,null,-1),we("Click the pencil icon to start one. ",-1)])])):(u(),p(re,{key:1},[l.value.length>0?(u(),p("div",Xi,"Pinned")):P("",!0),(u(!0),p(re,null,ke(l.value,h=>(u(),J(gn,{key:h.id,chat:h,active:h.id===b(o).activeChatId,onSelect:k=>n("selectChat",h.id),onToggleFavorite:k=>b(o).toggleFavorite(h.id),onTogglePin:k=>b(o).togglePin(h.id),onToggleMute:k=>b(o).toggleMute(h.id),onToggleArchive:k=>b(o).toggleArchive(h.id),onContextmenu:k=>f(k,h.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(u(),p("div",Qi,"Starred")):P("",!0),(u(!0),p(re,null,ke(r.value,h=>(u(),J(gn,{key:h.id,chat:h,active:h.id===b(o).activeChatId,onSelect:k=>n("selectChat",h.id),onToggleFavorite:k=>b(o).toggleFavorite(h.id),onTogglePin:k=>b(o).togglePin(h.id),onToggleMute:k=>b(o).toggleMute(h.id),onToggleArchive:k=>b(o).toggleArchive(h.id),onContextmenu:k=>f(k,h.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&c.value.length>0?(u(),p("div",Zi," All chats ")):P("",!0),(u(!0),p(re,null,ke(c.value,h=>(u(),J(gn,{key:h.id,chat:h,active:h.id===b(o).activeChatId,onSelect:k=>n("selectChat",h.id),onToggleFavorite:k=>b(o).toggleFavorite(h.id),onTogglePin:k=>b(o).togglePin(h.id),onToggleMute:k=>b(o).toggleMute(h.id),onToggleArchive:k=>b(o).toggleArchive(h.id),onContextmenu:k=>f(k,h.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function to(){const e=g(!1),s=g(0);let n=null,o=[],i=null;async function a(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const m=await navigator.mediaDevices.getUserMedia({audio:!0});o=[],s.value=0,n=new MediaRecorder(m),n.ondataavailable=f=>{f.data.size&&o.push(f.data)},n.start(),e.value=!0,i=setInterval(()=>{s.value++},1e3)}function l(){return new Promise((m,f)=>{if(!n||n.state!=="recording"){f(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(C=>C.stop()),c(),e.value=!1;const v=n?.mimeType||"audio/webm",d=v.includes("ogg")?"ogg":"webm",h=new Blob(o,{type:v}),k=new File([h],`voice.${d}`,{type:v});m(k)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(m=>m.stop())},n.stop()),c(),e.value=!1,s.value=0}function c(){i&&(clearInterval(i),i=null)}function y(m){const f=Math.floor(m/60),v=m%60;return`${f}:${String(v).padStart(2,"0")}`}return{isRecording:e,seconds:s,startRecording:a,stopRecording:l,cancelRecording:r,formatTime:y}}async function Pt(e){const s=new FormData;s.append("file",e);const{data:n}=await Z.post("/files",s);return n}const no={class:"pin-bar-content"},so={class:"pin-bar-sender"},ao={class:"pin-bar-text"},io=se({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const s=e,n=H(()=>s.message.sender_display_name||s.message.sender_username||"Unknown"),o=H(()=>{const i=s.message;switch(i.message_type){case"sticker":return i.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return i.content||""}});return(i,a)=>(u(),p("div",{class:"pin-bar",onClick:a[1]||(a[1]=l=>i.$emit("click"))},[a[2]||(a[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",no,[t("span",so,E(n.value),1),t("span",ao,E(o.value),1)]),t("button",{class:"pin-bar-close",onClick:a[0]||(a[0]=le(l=>i.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}}),oo="/assets/search-messages-Zb3bde1c.png";function Us(e,s){const n=new Date(e),i=new Date().getTime()-n.getTime(),a=Math.floor(i/1e3),l=Math.floor(a/60),r=Math.floor(l/60),c=Math.floor(r/24);if(l<1)return"last seen just now";if(l<60)return`last seen ${l} minute${l!==1?"s":""} ago`;if(r<24)return`last seen ${r} hour${r!==1?"s":""} ago`;if(c===1)return"last seen yesterday";if(c<7)return`last seen ${c} days ago`;const y=n.toLocaleString("en",{month:"short"}),m=n.getDate();return`last seen ${y} ${m}`}const lo={class:"chat-header"},ro={class:"chat-header-name"},co={key:0,class:"typing-dots"},uo=se({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:s}){const n=s,o=xe(),i=Pe(),a=H(()=>o.activeChat),l=g(Date.now()),r=setInterval(()=>{l.value=Date.now()},3e4);Fe(()=>clearInterval(r));const c=H(()=>{const C=a.value;return C?.type==="direct"&&!C.other_user_id}),y=H(()=>{const C=a.value;return C?c.value?"Saved Messages":C.type==="channel"||C.type==="group"?C.title||C.name||"Untitled":C.other_display_name||C.other_username||C.title||C.name||"Chat":"---"}),m=H(()=>{const C=a.value;if(C)return c.value?i.user?.avatar_url:C.type==="direct"?C.other_avatar_url:C.avatar_url}),f=H(()=>a.value?o.getTypingUsernames(a.value.id):[]),v=H(()=>f.value.length>0),d=H(()=>{const C=a.value;return!C||C.type!=="direct"||!C.other_user_id?!1:o.isUserOnline(C.other_user_id)}),h=H(()=>{if(f.value.length===1)return`${f.value[0]} is typing`;if(f.value.length>1)return`${f.value.length} people typing`;const C=a.value;if(!C)return"";if(c.value)return"personal storage";if(C.type==="channel"){const _=C.member_count??0;return`${_} subscriber${_!==1?"s":""}`}if(C.type==="group"){const _=C.member_count??0;return`${_} member${_!==1?"s":""}`}if(d.value)return"online";if(C.type==="direct"&&C.other_user_id){const _=o.getUserPresence(C.other_user_id);if(_){if(_.lastSeenAt)return Us(_.lastSeenAt,l.value);if(_.lastSeenBucket)return`last seen ${_.lastSeenBucket}`}}return C.other_username?"@"+C.other_username:""});Ue(()=>a.value?.id,()=>{const C=a.value;if(!C||C.type!=="direct"||!C.other_user_id)return;const _=C.other_user_id;o.getUserPresence(_)||Es(_).then(S=>{S.last_activity&&o.setUserPresence(_,{isOnline:o.isUserOnline(_),lastSeenAt:S.last_activity})}).catch(()=>{})},{immediate:!0});function k(){const C=a.value;C&&(C.type==="channel"||C.type==="group"?n("openChannelInfo"):C.type==="direct"&&C.other_username&&n("openUserProfile",C.other_username))}return(C,_)=>(u(),p("header",lo,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:_[0]||(_[0]=S=>n("back"))},"â†"),F(Se,{class:"chat-header-avatar",name:y.value,url:m.value,online:d.value,size:"sm",onClick:k},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:k},[t("div",ro,E(y.value),1),h.value?(u(),p("div",{key:0,class:ve(["chat-header-sub",{"typing-text":v.value,"online-text":d.value&&!v.value}])},[we(E(h.value),1),v.value?(u(),p("span",co,[..._[2]||(_[2]=[t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1)])])):P("",!0)],2)):P("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:_[1]||(_[1]=S=>n("openSearch"))},[..._[3]||(_[3]=[t("img",{src:oo,alt:"Search",class:"search-icon-img"},null,-1)])])]))}}),vo=me(uo,[["__scopeId","data-v-d8841314"]]),mo="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",fo="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",Sn="numeric",Mn="ascii",xn="alpha",yt="asciinumeric",ft="alphanumeric",En="domain",Fs="emoji",po="scheme",ho="slashscheme",yn="whitespace";function go(e,s){return e in s||(s[e]=[]),s[e]}function Ze(e,s,n){s[Sn]&&(s[yt]=!0,s[ft]=!0),s[Mn]&&(s[yt]=!0,s[xn]=!0),s[yt]&&(s[ft]=!0),s[xn]&&(s[ft]=!0),s[ft]&&(s[En]=!0),s[Fs]&&(s[En]=!0);for(const o in s){const i=go(o,n);i.indexOf(e)<0&&i.push(e)}}function yo(e,s){const n={};for(const o in s)s[o].indexOf(e)>=0&&(n[o]=!0);return n}function Le(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}Le.groups={};Le.prototype={accepts(){return!!this.t},go(e){const s=this,n=s.j[e];if(n)return n;for(let o=0;o<s.jr.length;o++){const i=s.jr[o][0],a=s.jr[o][1];if(a&&i.test(e))return a}return s.jd},has(e,s=!1){return s?e in this.j:!!this.go(e)},ta(e,s,n,o){for(let i=0;i<e.length;i++)this.tt(e[i],s,n,o)},tr(e,s,n,o){o=o||Le.groups;let i;return s&&s.j?i=s:(i=new Le(s),n&&o&&Ze(s,n,o)),this.jr.push([e,i]),i},ts(e,s,n,o){let i=this;const a=e.length;if(!a)return i;for(let l=0;l<a-1;l++)i=i.tt(e[l]);return i.tt(e[a-1],s,n,o)},tt(e,s,n,o){o=o||Le.groups;const i=this;if(s&&s.j)return i.j[e]=s,s;const a=s;let l,r=i.go(e);if(r?(l=new Le,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new Le,a){if(o)if(l.t&&typeof l.t=="string"){const c=Object.assign(yo(l.t,o),n);Ze(a,c,o)}else n&&Ze(a,n,o);l.t=a}return i.j[e]=l,l}};const ee=(e,s,n,o,i)=>e.ta(s,n,o,i),ye=(e,s,n,o,i)=>e.tr(s,n,o,i),fs=(e,s,n,o,i)=>e.ts(s,n,o,i),O=(e,s,n,o,i)=>e.tt(s,n,o,i),je="WORD",Tn="UWORD",zs="ASCIINUMERICAL",Bs="ALPHANUMERICAL",$t="LOCALHOST",In="TLD",Ln="UTLD",Dt="SCHEME",it="SLASH_SCHEME",Fn="NUM",An="WS",zn="NL",bt="OPENBRACE",kt="CLOSEBRACE",Ot="OPENBRACKET",Nt="CLOSEBRACKET",Ut="OPENPAREN",Ft="CLOSEPAREN",zt="OPENANGLEBRACKET",Bt="CLOSEANGLEBRACKET",jt="FULLWIDTHLEFTPAREN",Ht="FULLWIDTHRIGHTPAREN",Vt="LEFTCORNERBRACKET",Wt="RIGHTCORNERBRACKET",qt="LEFTWHITECORNERBRACKET",Gt="RIGHTWHITECORNERBRACKET",Kt="FULLWIDTHLESSTHAN",Yt="FULLWIDTHGREATERTHAN",Jt="AMPERSAND",Xt="APOSTROPHE",Qt="ASTERISK",Ge="AT",Zt="BACKSLASH",en="BACKTICK",tn="CARET",Ke="COLON",Bn="COMMA",nn="DOLLAR",Oe="DOT",sn="EQUALS",jn="EXCLAMATION",Re="HYPHEN",_t="PERCENT",an="PIPE",on="PLUS",ln="POUND",wt="QUERY",Hn="QUOTE",js="FULLWIDTHMIDDLEDOT",Vn="SEMI",Ne="SLASH",Ct="TILDE",rn="UNDERSCORE",Hs="EMOJI",cn="SYM";var Vs=Object.freeze({__proto__:null,ALPHANUMERICAL:Bs,AMPERSAND:Jt,APOSTROPHE:Xt,ASCIINUMERICAL:zs,ASTERISK:Qt,AT:Ge,BACKSLASH:Zt,BACKTICK:en,CARET:tn,CLOSEANGLEBRACKET:Bt,CLOSEBRACE:kt,CLOSEBRACKET:Nt,CLOSEPAREN:Ft,COLON:Ke,COMMA:Bn,DOLLAR:nn,DOT:Oe,EMOJI:Hs,EQUALS:sn,EXCLAMATION:jn,FULLWIDTHGREATERTHAN:Yt,FULLWIDTHLEFTPAREN:jt,FULLWIDTHLESSTHAN:Kt,FULLWIDTHMIDDLEDOT:js,FULLWIDTHRIGHTPAREN:Ht,HYPHEN:Re,LEFTCORNERBRACKET:Vt,LEFTWHITECORNERBRACKET:qt,LOCALHOST:$t,NL:zn,NUM:Fn,OPENANGLEBRACKET:zt,OPENBRACE:bt,OPENBRACKET:Ot,OPENPAREN:Ut,PERCENT:_t,PIPE:an,PLUS:on,POUND:ln,QUERY:wt,QUOTE:Hn,RIGHTCORNERBRACKET:Wt,RIGHTWHITECORNERBRACKET:Gt,SCHEME:Dt,SEMI:Vn,SLASH:Ne,SLASH_SCHEME:it,SYM:cn,TILDE:Ct,TLD:In,UNDERSCORE:rn,UTLD:Ln,UWORD:Tn,WORD:je,WS:An});const ze=/[a-z]/,mt=new RegExp("\\p{L}","u"),bn=new RegExp("\\p{Emoji}","u"),Be=/\d/,kn=/\s/,ps="\r",_n=`
`,bo="ï¸",ko="â€",wn="ï¿¼";let Tt=null,It=null;function _o(e=[]){const s={};Le.groups=s;const n=new Le;Tt==null&&(Tt=hs(mo)),It==null&&(It=hs(fo)),O(n,"'",Xt),O(n,"{",bt),O(n,"}",kt),O(n,"[",Ot),O(n,"]",Nt),O(n,"(",Ut),O(n,")",Ft),O(n,"<",zt),O(n,">",Bt),O(n,"ï¼ˆ",jt),O(n,"ï¼‰",Ht),O(n,"ã€Œ",Vt),O(n,"ã€",Wt),O(n,"ã€",qt),O(n,"ã€",Gt),O(n,"ï¼œ",Kt),O(n,"ï¼",Yt),O(n,"&",Jt),O(n,"*",Qt),O(n,"@",Ge),O(n,"`",en),O(n,"^",tn),O(n,":",Ke),O(n,",",Bn),O(n,"$",nn),O(n,".",Oe),O(n,"=",sn),O(n,"!",jn),O(n,"-",Re),O(n,"%",_t),O(n,"|",an),O(n,"+",on),O(n,"#",ln),O(n,"?",wt),O(n,'"',Hn),O(n,"/",Ne),O(n,";",Vn),O(n,"~",Ct),O(n,"_",rn),O(n,"\\",Zt),O(n,"ãƒ»",js);const o=ye(n,Be,Fn,{[Sn]:!0});ye(o,Be,o);const i=ye(o,ze,zs,{[yt]:!0}),a=ye(o,mt,Bs,{[ft]:!0}),l=ye(n,ze,je,{[Mn]:!0});ye(l,Be,i),ye(l,ze,l),ye(i,Be,i),ye(i,ze,i);const r=ye(n,mt,Tn,{[xn]:!0});ye(r,ze),ye(r,Be,a),ye(r,mt,r),ye(a,Be,a),ye(a,ze),ye(a,mt,a);const c=O(n,_n,zn,{[yn]:!0}),y=O(n,ps,An,{[yn]:!0}),m=ye(n,kn,An,{[yn]:!0});O(n,wn,m),O(y,_n,c),O(y,wn,m),ye(y,kn,m),O(m,ps),O(m,_n),ye(m,kn,m),O(m,wn,m);const f=ye(n,bn,Hs,{[Fs]:!0});O(f,"#"),ye(f,bn,f),O(f,bo,f);const v=O(f,ko);O(v,"#"),ye(v,bn,f);const d=[[ze,l],[Be,i]],h=[[ze,null],[mt,r],[Be,a]];for(let k=0;k<Tt.length;k++)qe(n,Tt[k],In,je,d);for(let k=0;k<It.length;k++)qe(n,It[k],Ln,Tn,h);Ze(In,{tld:!0,ascii:!0},s),Ze(Ln,{utld:!0,alpha:!0},s),qe(n,"file",Dt,je,d),qe(n,"mailto",Dt,je,d),qe(n,"http",it,je,d),qe(n,"https",it,je,d),qe(n,"ftp",it,je,d),qe(n,"ftps",it,je,d),Ze(Dt,{scheme:!0,ascii:!0},s),Ze(it,{slashscheme:!0,ascii:!0},s),e=e.sort((k,C)=>k[0]>C[0]?1:-1);for(let k=0;k<e.length;k++){const C=e[k][0],S=e[k][1]?{[po]:!0}:{[ho]:!0};C.indexOf("-")>=0?S[En]=!0:ze.test(C)?Be.test(C)?S[yt]=!0:S[Mn]=!0:S[Sn]=!0,fs(n,C,C,S)}return fs(n,"localhost",$t,{ascii:!0}),n.jd=new Le(cn),{start:n,tokens:Object.assign({groups:s},Vs)}}function Ws(e,s){const n=wo(s.replace(/[A-Z]/g,r=>r.toLowerCase())),o=n.length,i=[];let a=0,l=0;for(;l<o;){let r=e,c=null,y=0,m=null,f=-1,v=-1;for(;l<o&&(c=r.go(n[l]));)r=c,r.accepts()?(f=0,v=0,m=r):f>=0&&(f+=n[l].length,v++),y+=n[l].length,a+=n[l].length,l++;a-=f,l-=v,y-=f,i.push({t:m.t,v:s.slice(a-y,a),s:a-y,e:a})}return i}function wo(e){const s=[],n=e.length;let o=0;for(;o<n;){let i=e.charCodeAt(o),a,l=i<55296||i>56319||o+1===n||(a=e.charCodeAt(o+1))<56320||a>57343?e[o]:e.slice(o,o+2);s.push(l),o+=l.length}return s}function qe(e,s,n,o,i){let a;const l=s.length;for(let r=0;r<l-1;r++){const c=s[r];e.j[c]?a=e.j[c]:(a=new Le(o),a.jr=i.slice(),e.j[c]=a),e=a}return a=new Le(n),a.jr=i.slice(),e.j[s[l-1]]=a,a}function hs(e){const s=[],n=[];let o=0,i="0123456789";for(;o<e.length;){let a=0;for(;i.indexOf(e[o+a])>=0;)a++;if(a>0){s.push(n.join(""));for(let l=parseInt(e.substring(o,o+a),10);l>0;l--)n.pop();o+=a}else n.push(e[o]),o++}return s}const St={defaultProtocol:"http",events:null,format:gs,formatHref:gs,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Wn(e,s=null){let n=Object.assign({},St);e&&(n=Object.assign(n,e instanceof Wn?e.o:e));const o=n.ignoreTags,i=[];for(let a=0;a<o.length;a++)i.push(o[a].toUpperCase());this.o=n,s&&(this.defaultRender=s),this.ignoreTags=i}Wn.prototype={o:St,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,s,n){const o=s!=null;let i=this.o[e];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:St[e],typeof i=="function"&&o&&(i=i(s,n))):typeof i=="function"&&o&&(i=i(s,n.t,n)),i)},getObj(e,s,n){let o=this.o[e];return typeof o=="function"&&s!=null&&(o=o(s,n.t,n)),o},render(e){const s=e.render(this);return(this.get("render",null,e)||this.defaultRender)(s,e.t,e)}};function gs(e){return e}function qs(e,s){this.t="token",this.v=e,this.tk=s}qs.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const s=this.toString(),n=e.get("truncate",s,this),o=e.get("format",s,this);return n&&o.length>n?o.substring(0,n)+"â€¦":o},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=St.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const s=this,n=this.toHref(e.get("defaultProtocol")),o=e.get("formatHref",n,this),i=e.get("tagName",n,s),a=this.toFormattedString(e),l={},r=e.get("className",n,s),c=e.get("target",n,s),y=e.get("rel",n,s),m=e.getObj("attributes",n,s),f=e.getObj("events",n,s);return l.href=o,r&&(l.class=r),c&&(l.target=c),y&&(l.rel=y),m&&Object.assign(l,m),{tagName:i,attributes:l,content:a,eventListeners:f}}};function dn(e,s){class n extends qs{constructor(i,a){super(i,a),this.t=e}}for(const o in s)n.prototype[o]=s[o];return n.t=e,n}const ys=dn("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),bs=dn("text"),Co=dn("nl"),Lt=dn("url",{isLink:!0,toHref(e=St.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==$t&&e[1].t===Ke}}),De=e=>new Le(e);function $o({groups:e}){const s=e.domain.concat([Jt,Qt,Ge,Zt,en,tn,nn,sn,Re,Fn,_t,an,on,ln,Ne,cn,Ct,rn]),n=[Xt,Ke,Bn,Oe,jn,_t,wt,Hn,Vn,zt,Bt,bt,kt,Nt,Ot,Ut,Ft,jt,Ht,Vt,Wt,qt,Gt,Kt,Yt],o=[Jt,Xt,Qt,Zt,en,tn,nn,sn,Re,bt,kt,_t,an,on,ln,wt,Ne,cn,Ct,rn],i=De(),a=O(i,Ct);ee(a,o,a),ee(a,e.domain,a);const l=De(),r=De(),c=De();ee(i,e.domain,l),ee(i,e.scheme,r),ee(i,e.slashscheme,c),ee(l,o,a),ee(l,e.domain,l);const y=O(l,Ge);O(a,Ge,y),O(r,Ge,y),O(c,Ge,y);const m=O(a,Oe);ee(m,o,a),ee(m,e.domain,a);const f=De();ee(y,e.domain,f),ee(f,e.domain,f);const v=O(f,Oe);ee(v,e.domain,f);const d=De(ys);ee(v,e.tld,d),ee(v,e.utld,d),O(y,$t,d);const h=O(f,Re);O(h,Re,h),ee(h,e.domain,f),ee(d,e.domain,f),O(d,Oe,v),O(d,Re,h);const k=O(d,Ke);ee(k,e.numeric,ys);const C=O(l,Re),_=O(l,Oe);O(C,Re,C),ee(C,e.domain,l),ee(_,o,a),ee(_,e.domain,l);const S=De(Lt);ee(_,e.tld,S),ee(_,e.utld,S),ee(S,e.domain,l),ee(S,o,a),O(S,Oe,_),O(S,Re,C),O(S,Ge,y);const z=O(S,Ke),q=De(Lt);ee(z,e.numeric,q);const U=De(Lt),j=De();ee(U,s,U),ee(U,n,j),ee(j,s,U),ee(j,n,j),O(S,Ne,U),O(q,Ne,U);const ae=O(r,Ke),he=O(c,Ke),ce=O(he,Ne),oe=O(ce,Ne);ee(r,e.domain,l),O(r,Oe,_),O(r,Re,C),ee(c,e.domain,l),O(c,Oe,_),O(c,Re,C),ee(ae,e.domain,U),O(ae,Ne,U),O(ae,wt,U),ee(oe,e.domain,U),ee(oe,s,U),O(oe,Ne,U);const de=[[bt,kt],[Ot,Nt],[Ut,Ft],[zt,Bt],[jt,Ht],[Vt,Wt],[qt,Gt],[Kt,Yt]];for(let I=0;I<de.length;I++){const[M,$]=de[I],B=O(U,M);O(j,M,B),O(B,$,U);const ue=De(Lt);ee(B,s,ue);const Ce=De();ee(B,n),ee(ue,s,ue),ee(ue,n,Ce),ee(Ce,s,ue),ee(Ce,n,Ce),O(ue,$,U),O(Ce,$,U)}return O(i,$t,S),O(i,zn,Co),{start:i,tokens:Vs}}function So(e,s,n){let o=n.length,i=0,a=[],l=[];for(;i<o;){let r=e,c=null,y=null,m=0,f=null,v=-1;for(;i<o&&!(c=r.go(n[i].t));)l.push(n[i++]);for(;i<o&&(y=c||r.go(n[i].t));)c=null,r=y,r.accepts()?(v=0,f=r):v>=0&&v++,i++,m++;if(v<0)i-=m,i<o&&(l.push(n[i]),i++);else{l.length>0&&(a.push(Cn(bs,s,l)),l=[]),i-=v,m-=v;const d=f.t,h=n.slice(i-m,i);a.push(Cn(d,s,h))}}return l.length>0&&a.push(Cn(bs,s,l)),a}function Cn(e,s,n){const o=n[0].s,i=n[n.length-1].e,a=s.slice(o,i);return new e(a,n)}const $e={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Mo(){$e.scanner=_o($e.customSchemes);for(let e=0;e<$e.tokenQueue.length;e++)$e.tokenQueue[e][1]({scanner:$e.scanner});$e.parser=$o($e.scanner.tokens);for(let e=0;e<$e.pluginQueue.length;e++)$e.pluginQueue[e][1]({scanner:$e.scanner,parser:$e.parser});return $e.initialized=!0,$e}function Gs(e){return $e.initialized||Mo(),So($e.parser.start,e,Ws($e.scanner.start,e))}Gs.scan=Ws;function Ks(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function xo(e){return e.replace(/"/g,"&quot;")}function Eo(e){const s=[];for(const n in e){let o=e[n]+"";s.push(`${n}="${xo(o)}"`)}return s.join(" ")}function To({tagName:e,attributes:s,content:n}){return`<${e} ${Eo(s)}>${Ks(n)}</${e}>`}function Ys(e,s={}){s=new Wn(s,To);const n=Gs(e),o=[];for(let i=0;i<n.length;i++){const a=n[i];a.t==="nl"&&s.get("nl2br")?o.push(`<br>
`):!a.isLink||!s.check(a)?o.push(Ks(a.toString())):o.push(s.render(a))}return o.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(s){return Ys(this,s)}});const Io={},Lo={class:"admin-badge",title:"Admin"};function Ao(e,s){return u(),p("span",Lo,"âœ“")}const qn=me(Io,[["render",Ao]]),Do={class:"image-message"},Ro=["src","alt"],Po={key:0,class:"image-message-caption"},Oo=se({__name:"ImageMessage",props:{message:{}},setup(e){const s=e,n=H(()=>{const l=s.message.content?.trim();return!l||l===s.message.attachment_filename?"":l}),o=g(!1);function i(){o.value=!0}function a(){s.message.attachment_url&&window.open(s.message.attachment_url,"_blank","noopener,noreferrer")}return(l,r)=>(u(),p("div",Do,[t("img",{class:"image-message-thumb",src:e.message.attachment_url,alt:e.message.attachment_filename||"image",loading:"lazy",onClick:a,onError:i},null,40,Ro),n.value?(u(),p("div",Po,E(n.value),1)):P("",!0)]))}}),No=me(Oo,[["__scopeId","data-v-71beba71"]]),Uo={class:"file-message"},Fo=["href","download"],zo={class:"file-message-info"},Bo={class:"file-message-name"},jo={key:0,class:"file-message-caption"},Ho=se({__name:"FileMessage",props:{message:{}},setup(e){const s=e,n=H(()=>s.message.attachment_filename||"File"),o=H(()=>{const i=s.message.content?.trim();return!i||i===s.message.attachment_filename?"":i});return(i,a)=>(u(),p("div",Uo,[t("a",{class:"file-message-card",href:e.message.attachment_url,target:"_blank",rel:"noopener noreferrer",download:e.message.attachment_filename},[a[0]||(a[0]=t("div",{class:"file-message-icon"},"ğŸ“„",-1)),t("div",zo,[t("div",Bo,E(n.value),1),o.value?(u(),p("div",jo,E(o.value),1)):P("",!0)])],8,Fo)]))}}),Vo=me(Ho,[["__scopeId","data-v-6ead7a7d"]]);function Wo(e){const{delay:s=500,scrollThreshold:n=5,onLongPress:o,onCancel:i}=e,a=g(!1);let l=null,r=0,c=0,y=!1;function m(){l&&(clearTimeout(l),l=null)}function f(k){r=k.clientX,c=k.clientY,y=!1,a.value=!0,m(),l=setTimeout(()=>{y=!0,o(k)},s)}function v(k){if(!l)return;const C=k.clientX-r,_=k.clientY-c;(Math.abs(C)>n||Math.abs(_)>n)&&h()}function d(){m(),a.value=!1}function h(){m(),a.value=!1,y||i?.()}return{isPressed:a,onPointerDown:f,onPointerUp:d,onPointerMove:v}}const qo=["data-message-id"],Go={key:0,class:"selection-checkbox"},Ko=["checked"],Yo={key:1,class:"msg-sender-name"},Jo={class:"msg-content-wrap"},Xo={key:0,class:"msg-bubble sticker-bubble"},Qo=["src","alt"],Zo={class:"msg-time"},el={key:0,class:"msg-edited-label"},tl={key:1,class:"msg-bubble"},nl={key:0,class:"msg-forwarded-label"},sl={class:"msg-reply-quote-name"},al={class:"msg-reply-quote-text"},il={class:"voice-player"},ol={class:"voice-dur"},ll={class:"msg-time"},rl={key:0,class:"msg-edited-label"},cl={key:2,class:"msg-bubble"},ul={key:0,class:"msg-forwarded-label"},dl={class:"msg-reply-quote-name"},vl={class:"msg-reply-quote-text"},ml={class:"msg-time"},fl={key:0,class:"msg-edited-label"},pl={key:3,class:"msg-bubble"},hl={key:0,class:"msg-forwarded-label"},gl={class:"msg-reply-quote-name"},yl={class:"msg-reply-quote-text"},bl=["innerHTML"],kl={class:"msg-time"},_l={key:0,class:"msg-edited-label"},wl={key:4,class:"reaction-chips"},Cl=["onClick"],$l={class:"reaction-emoji"},Sl={class:"reaction-count"},Ml=se({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:s}){const n=e,o=s,i=tt(),a=xe(),l=et(),r=H(()=>i.isSelected(n.message.id)),c=H(()=>l.deletingMessages.has(n.message.id)),y=ot("lastSentMessageId",g(null)),m=H(()=>n.isMine&&n.message.id===y.value),{onPointerDown:f,onPointerUp:v,onPointerMove:d}=Wo({delay:500,onLongPress(R){C(R.clientX,R.clientY)}}),h={onPointerdown:f,onPointerup:v,onPointermove:d};function k(R){if(i.selectionMode){i.toggleMessage(n.message.id);return}C(R.clientX,R.clientY)}function C(R,N){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:a.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:R,y:N}}))}function _(){i.selectionMode&&i.toggleMessage(n.message.id)}const S=Pe(),z=Mt(),q=H(()=>{if(!z.readReceiptsEnabled)return null;const R=a.activeChat;if(!R)return null;const N=R.id;if(R.type==="direct"&&R.other_user_id===S.user?.id)return{text:"âœ“âœ“",cls:"read"};if(R.type==="direct")return l.isMessageRead(N,n.message.id,R.other_user_id)?{text:"âœ“âœ“",cls:"read"}:{text:"âœ“",cls:"sent"};const Q=l.getReadCount(N,n.message.id);return Q>0?{text:`âœ“âœ“ ${Q}`,cls:"read"}:{text:"âœ“",cls:"sent"}}),U=H(()=>{if(!n.message.forwarded_from_chat_id)return null;const R=n.message.forwarded_from_user_id;if(R&&R===S.user?.id)return null;const N=n.message.forwarded_from_display_name;return N?`Forwarded from ${N}`:"Forwarded"}),j=ot("stickers",g([])),ae=H(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const R=j.value.find(N=>N.id===n.message.sticker_id);if(R)return R.url}return""}),he=H(()=>n.message.attachment_url||""),ce=g(!1),oe=g(0),de=g(0),I=g(n.message.duration_seconds||0);let M=null,$=null;function B(){return M||(M=new Audio(he.value),M.addEventListener("loadedmetadata",()=>{M&&isFinite(M.duration)&&(I.value=M.duration)}),M.addEventListener("ended",()=>{ce.value=!1,oe.value=0,de.value=0,Ce()})),M}function ue(){if(M&&ce.value){de.value=M.currentTime;const R=M.duration;oe.value=R&&isFinite(R)?M.currentTime/R*100:0,$=requestAnimationFrame(ue)}}function Ce(){$!==null&&(cancelAnimationFrame($),$=null)}function T(){const R=B();ce.value?(R.pause(),ce.value=!1,Ce()):(R.play(),ce.value=!0,$=requestAnimationFrame(ue))}function A(R){const N=B(),Y=R.currentTarget.getBoundingClientRect(),fe=Math.max(0,Math.min(1,(R.clientX-Y.left)/Y.width)),be=N.duration;be&&isFinite(be)&&(N.currentTime=fe*be,de.value=N.currentTime,oe.value=fe*100)}const G=H(()=>{const R=I.value;return ce.value||de.value>0?W(Math.floor(de.value))+" / "+W(Math.floor(R)):W(Math.floor(R))});Ue(he,()=>{M&&(M.pause(),ce.value=!1,Ce(),M=null,oe.value=0,de.value=0)}),Fe(()=>{M&&(M.pause(),M=null),Ce()});const V=H(()=>(n.message.attachment_mime_type||"").startsWith("image/")),X=H(()=>{const R=n.message.reply_to_type;if(R==="sticker")return"ğŸ¨ Sticker";if(R==="voice")return"ğŸ¤ Voice message";if(R==="file")return"ğŸ“ File";const N=n.message.reply_to_content||"";return N.length>80?N.slice(0,80)+"...":N}),ie=H(()=>Ys(n.message.content||"",{defaultProtocol:"https",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(N,Q,Y)=>Q||`<span class="mention" data-u="${Y}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${Y}'}))">@${Y}</span>`));function K(R){if(!R)return"";const N=new Date(R.endsWith("Z")?R:R+"Z"),Q=new Date;return N.toDateString()===Q.toDateString()?N.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):N.toLocaleDateString([],{month:"short",day:"numeric"})}function W(R){const N=Math.floor(R/60),Q=R%60;return`${N}:${String(Q).padStart(2,"0")}`}function x(R){const N=R.target.getBoundingClientRect();o("openEmojiPicker",n.message.id,N.left,N.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(R=>{o("mentionClick",R.detail)})),(R,N)=>(u(),p("div",ka({class:["msg-row",[e.isMine?"mine":"theirs",{selected:r.value,"msg-deleting":c.value,"msg-new":m.value}]],"data-message-id":e.message.id,onContextmenu:le(k,["prevent"])},h,{onClick:_}),[b(i).selectionMode?(u(),p("div",Go,[t("input",{type:"checkbox",checked:r.value,tabindex:"-1"},null,8,Ko)])):P("",!0),!e.isMine&&e.message.message_type!=="sticker"?(u(),p("div",Yo,[we(E(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(u(),J(qn,{key:0})):P("",!0)])):P("",!0),t("div",Jo,[e.message.message_type==="sticker"?(u(),p("div",Xo,[t("img",{class:"sticker-img",src:ae.value,alt:e.message.sticker_label||"sticker"},null,8,Qo),t("div",Zo,[e.message.is_edited?(u(),p("span",el,"(edited)")):P("",!0),we(" "+E(K(e.message.created_at)),1),e.isMine&&q.value?(u(),p("span",{key:1,class:ve(["msg-read-check",q.value.cls])},E(q.value.text),3)):P("",!0)])])):e.message.message_type==="voice"?(u(),p("div",tl,[U.value?(u(),p("div",nl,E(U.value),1)):P("",!0),e.message.reply_to_message_id?(u(),p("div",{key:1,class:"msg-reply-quote",onClick:N[0]||(N[0]=le(Q=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[N[3]||(N[3]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",sl,E(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",al,E(X.value),1)])])):P("",!0),t("div",il,[t("button",{class:"voice-play-btn",onClick:le(T,["stop"])},E(ce.value?"â¸":"â–¶"),1),t("div",{class:"voice-track",onClick:le(A,["stop"])},[t("div",{class:"voice-progress",style:rt({width:oe.value+"%"})},null,4)]),t("span",ol,E(G.value),1)]),t("div",ll,[e.message.is_edited?(u(),p("span",rl,"(edited)")):P("",!0),we(" "+E(K(e.message.created_at)),1),e.isMine&&q.value?(u(),p("span",{key:1,class:ve(["msg-read-check",q.value.cls])},E(q.value.text),3)):P("",!0)])])):e.message.message_type==="file"?(u(),p("div",cl,[U.value?(u(),p("div",ul,E(U.value),1)):P("",!0),e.message.reply_to_message_id?(u(),p("div",{key:1,class:"msg-reply-quote",onClick:N[1]||(N[1]=le(Q=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[N[4]||(N[4]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",dl,E(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",vl,E(X.value),1)])])):P("",!0),V.value?(u(),J(No,{key:2,message:e.message},null,8,["message"])):(u(),J(Vo,{key:3,message:e.message},null,8,["message"])),t("div",ml,[e.message.is_edited?(u(),p("span",fl,"(edited)")):P("",!0),we(" "+E(K(e.message.created_at)),1),e.isMine&&q.value?(u(),p("span",{key:1,class:ve(["msg-read-check",q.value.cls])},E(q.value.text),3)):P("",!0)])])):(u(),p("div",pl,[U.value?(u(),p("div",hl,E(U.value),1)):P("",!0),e.message.reply_to_message_id?(u(),p("div",{key:1,class:"msg-reply-quote",onClick:N[2]||(N[2]=le(Q=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[N[5]||(N[5]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",gl,E(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",yl,E(X.value),1)])])):P("",!0),t("span",{class:"msg-text",innerHTML:ie.value},null,8,bl),t("div",kl,[e.message.is_edited?(u(),p("span",_l,"(edited)")):P("",!0),we(" "+E(K(e.message.created_at)),1),e.isMine&&q.value?(u(),p("span",{key:1,class:ve(["msg-read-check",q.value.cls])},E(q.value.text),3)):P("",!0)])])),t("button",{class:"reaction-add-btn",onClick:le(x,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(u(),p("div",wl,[(u(!0),p(re,null,ke(e.message.reactions,Q=>(u(),p("button",{key:Q.emoji,class:ve(["reaction-chip",{"reaction-mine":Q.me}]),onClick:le(Y=>o("toggleReaction",e.message.id,Q.emoji),["stop"])},[t("span",$l,E(Q.emoji),1),t("span",Sl,E(Q.count),1)],10,Cl))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:le(x,["stop"])},"+")])):P("",!0)])],16,qo))}}),xl={class:"composer-wrapper"},El={key:0,class:"reply-preview"},Tl={class:"reply-preview-content"},Il={class:"reply-preview-sender"},Ll={class:"reply-preview-text"},Al={key:1,class:"reply-preview edit-preview"},Dl={class:"reply-preview-content"},Rl={class:"reply-preview-text"},Pl={class:"composer"},Ol=["onKeydown"],Nl=se({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","toggleEmojiPanel","openAttachmentMenu","startRecording","typing","editMessage"],setup(e,{expose:s,emit:n}){const o=e,i=n,a=g(""),l=g(null),r=g(null),c=g(null);let y=0;const m=H(()=>a.value.trim().length>0);function f(){const U=a.value.trim();U&&(c.value?(i("editMessage",c.value.messageId,U),c.value=null):r.value?(i("send",U,{...r.value}),r.value=null):i("send",U),a.value="",q())}function v(U){const j=l.value;if(!j){a.value+=U;return}const ae=j.selectionStart??a.value.length,he=j.selectionEnd??a.value.length;a.value=a.value.slice(0,ae)+U+a.value.slice(he),Ie(()=>{const ce=ae+U.length;j.selectionStart=ce,j.selectionEnd=ce,j.focus(),q()})}function d(){r.value=null,l.value?.focus()}function h(){c.value=null,a.value="",q(),l.value?.focus()}function k(){r.value?d():c.value&&h()}function C(U){const j=U.detail;j&&(c.value=null,r.value={messageId:j.messageId,senderName:j.senderName||"Unknown",snippet:(j.text||"").slice(0,100)},Ie(()=>l.value?.focus()))}function _(U){const j=U.detail;j&&(r.value=null,c.value={messageId:j.messageId,snippet:(j.text||"").slice(0,100),fullText:j.text||""},a.value=c.value.fullText,Ie(()=>{q(),l.value?.focus()}))}function S(U){U.preventDefault(),U.stopPropagation();const j=l.value;j&&j.selectionStart!==j.selectionEnd&&window.dispatchEvent(new CustomEvent("show-text-format-menu",{detail:{x:U.clientX,y:U.clientY,target:j}}))}function z(){q();const U=Date.now();U-y>2e3&&a.value.trim().length>0&&(y=U,i("typing"))}function q(){const U=l.value;U&&(U.style.height="auto",U.style.height=Math.min(U.scrollHeight,120)+"px")}return Ee(()=>{l.value?.focus(),window.addEventListener("reply-to-message",C),window.addEventListener("edit-message",_)}),Fe(()=>{window.removeEventListener("reply-to-message",C),window.removeEventListener("edit-message",_)}),Ue(()=>o.replyTo,U=>{U&&l.value?.focus()}),s({focus:()=>l.value?.focus(),insertText:v}),(U,j)=>(u(),p("div",xl,[r.value?(u(),p("div",El,[j[4]||(j[4]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",Tl,[t("span",Il,E(r.value.senderName),1),t("span",Ll,E(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:d},"âœ•")])):P("",!0),c.value?(u(),p("div",Al,[j[6]||(j[6]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",Dl,[j[5]||(j[5]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",Rl,E(c.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:h},"âœ•")])):P("",!0),t("div",Pl,[t("button",{class:"icon-btn composer-btn","aria-label":"Attach file",title:"Attach file",onClick:j[0]||(j[0]=ae=>i("openAttachmentMenu"))},[F(b(Ci),{size:22})]),pe(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":j[1]||(j[1]=ae=>a.value=ae),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[Rt(le(f,["exact","prevent"]),["enter"]),Rt(k,["escape"])],onInput:z,onContextmenu:S},null,40,Ol),[[_e,a.value]]),t("button",{class:"icon-btn composer-btn","aria-label":"Emoji",title:"Emoji",onClick:j[2]||(j[2]=ae=>i("toggleEmojiPanel"))},[F(b(Ti),{size:22})]),m.value?(u(),p("button",{key:1,class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:f},[F(b(Mi),{size:22})])):(u(),p("button",{key:0,class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:j[3]||(j[3]=ae=>i("startRecording"))},[F(b(Ps),{size:22})]))])]))}}),Ul=me(Nl,[["__scopeId","data-v-f741d27a"]]),Fl={class:"sticker-grid"},zl=["title","onClick"],Bl=["src","alt"],jl={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Hl=se({__name:"StickerPicker",emits:["select"],setup(e,{emit:s}){const n=s,o=ot("stickers",g([])),i=H(()=>o.value);return(a,l)=>(u(),p("div",Fl,[(u(!0),p(re,null,ke(i.value,r=>(u(),p("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:c=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,Bl)],8,zl))),128)),i.value.length===0?(u(),p("div",jl," No stickers available ")):P("",!0)]))}}),Vl={},Wl={class:"msgs-loading"};function ql(e,s){return u(),p("div",Wl,"Loading...")}const ks=me(Vl,[["render",ql]]),Gl=["onClick"],Kl=se({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:s}){const n=s,o=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(i,a)=>e.visible?(u(),p("div",{key:0,class:"emoji-picker",style:rt({left:e.x+"px",top:e.y+"px"}),onClick:a[0]||(a[0]=le(()=>{},["stop"]))},[(u(),p(re,null,ke(o,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},E(l),9,Gl)),64))],4)):P("",!0)}}),Yl=se({__name:"MessageContextMenu",setup(e){const{showToast:s}=Ae(),n=Pe(),o=et(),i=tt(),a=g(!1),l=g(0),r=g(0),c=g(null),y=g(null),m=g(""),f=g(""),v=g(""),d=g(null),h=g(!1),k=H(()=>!d.value||!n.user?!1:d.value===n.user.id),C=H(()=>!y.value||!c.value?null:`${window.location.origin}/c/${y.value}/${c.value}`),_=H(()=>!y.value||!c.value?!1:o.pinnedByChat[y.value]?.message?.id===c.value);function S($){h.value=!!$.detail.areaOnly,c.value=$.detail.messageId??null,y.value=$.detail.chatId,m.value=$.detail.text||"",f.value=$.detail.messageType||"text",v.value=$.detail.senderName||"",d.value=$.detail.senderId??null,l.value=$.detail.x,r.value=$.detail.y,a.value=!0,requestAnimationFrame(()=>{const B=document.querySelector(".msg-context-menu");if(!B)return;const ue=B.getBoundingClientRect();ue.right>window.innerWidth&&(l.value=window.innerWidth-ue.width-8),ue.bottom>window.innerHeight&&(r.value=window.innerHeight-ue.height-8)})}function z(){a.value&&(a.value=!1,c.value=null,y.value=null,m.value="",f.value="",v.value="",d.value=null,h.value=!1)}Ee(()=>{window.addEventListener("show-message-context-menu",S),document.addEventListener("click",z)}),Fe(()=>{window.removeEventListener("show-message-context-menu",S),document.removeEventListener("click",z)});function q(){a.value=!1}function U(){q(),!(!c.value||!y.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:c.value,chatId:y.value,senderName:v.value,text:m.value}}))}function j(){q(),!(!c.value||!y.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:c.value,chatId:y.value,text:m.value}}))}async function ae(){q();try{await navigator.clipboard.writeText(m.value),s("Copied to clipboard")}catch{s("Failed to copy text")}}async function he(){if(q(),!!C.value)try{await navigator.clipboard.writeText(C.value),s("Link copied")}catch{s("Failed to copy link")}}function ce(){q(),!(!c.value||!y.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[c.value],chatId:y.value}}))}function oe(){q(),!(!c.value||!y.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:c.value,chatId:y.value}}))}function de(){if(q(),!c.value||!y.value)return;const $=_.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent($,{detail:{messageId:c.value,chatId:y.value}}))}function I(){q(),y.value&&i.enterSelectionMode(y.value)}function M(){q(),!(!c.value||!y.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:c.value,chatId:y.value}}))}return($,B)=>(u(),J(Cs,{to:"body"},[a.value?(u(),p("div",{key:0,class:"msg-context-menu",style:rt({left:l.value+"px",top:r.value+"px"}),onClick:B[0]||(B[0]=le(()=>{},["stop"])),onContextmenu:B[1]||(B[1]=le(()=>{},["prevent"]))},[h.value?(u(),p("button",{key:0,class:"ctx-item",onClick:I},"Select Messages")):(u(),p(re,{key:1},[t("button",{class:"ctx-item",onClick:U}," Reply "),k.value&&f.value==="text"?(u(),p("button",{key:0,class:"ctx-item",onClick:j}," Edit ")):P("",!0),t("button",{class:"ctx-item",onClick:de},E(_.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:ae}," Copy text "),C.value?(u(),p("button",{key:1,class:"ctx-item",onClick:he}," Copy link ")):P("",!0),t("button",{class:"ctx-item",onClick:ce}," Forward "),t("button",{class:"ctx-item",onClick:oe}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:M}," Delete ")],64))],36)):P("",!0)]))}}),Jl=me(Yl,[["__scopeId","data-v-e4c122b4"]]),Xl={key:0,class:"selection-bar"},Ql={class:"selection-bar-count"},Zl={class:"selection-bar-actions"},er=["disabled"],tr=["disabled"],nr=se({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:s}){const n=s,o=tt();return(i,a)=>(u(),J(Dn,{name:"slide-down"},{default:un(()=>[b(o).selectionMode?(u(),p("div",Xl,[t("button",{class:"selection-bar-btn cancel-btn",onClick:a[0]||(a[0]=l=>b(o).exitSelectionMode())}," Cancel "),t("span",Ql,E(b(o).selectedCount)+" selected",1),t("div",Zl,[t("button",{class:"selection-bar-btn forward-btn",disabled:b(o).selectedCount===0,onClick:a[1]||(a[1]=l=>n("forward"))}," Forward ("+E(b(o).selectedCount)+") ",9,er),t("button",{class:"selection-bar-btn delete-btn",disabled:b(o).selectedCount===0,onClick:a[2]||(a[2]=l=>n("delete"))}," Delete ("+E(b(o).selectedCount)+") ",9,tr)])])):P("",!0)]),_:1}))}}),sr=me(nr,[["__scopeId","data-v-9ba988f2"]]),ar=se({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const n=s;function o(){n("close")}return(i,a)=>(u(),J(Cs,{to:"body"},[F(Dn,{name:"bottom-sheet"},{default:un(()=>[e.visible?(u(),p("div",{key:0,class:"bottom-sheet-backdrop",onClick:le(o,["self"])},[t("div",{class:"bottom-sheet",onClick:a[0]||(a[0]=le(()=>{},["stop"]))},[a[1]||(a[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),$s(i.$slots,"default",{},void 0,!0)])])):P("",!0)]),_:3})]))}}),ir=me(ar,[["__scopeId","data-v-9712ffdf"]]),or={class:"modal"},lr={class:"modal-header"},rr={class:"modal-body"},cr={class:"forward-chat-list"},ur={key:0,class:"empty-state-small"},dr=["onClick"],vr={class:"forward-chat-info"},mr={class:"forward-chat-name"},fr={class:"forward-chat-type"},pr={key:0,class:"forward-check"},hr={class:"modal-actions"},gr=["disabled"],yr=se({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:s}){const n=e,o=s,i=xe(),a=et(),{showToast:l}=Ae(),r=g(""),c=g(null),y=g(!1),m=H(()=>{const k=r.value.toLowerCase().trim(),C=i.sortedChats;return k?C.filter(_=>f(_).toLowerCase().includes(k)):C});function f(k){return k.type==="direct"?k.other_user_id?k.other_display_name||k.other_username||k.title||"Direct Chat":"Saved Messages":k.title||k.name||"Unnamed Chat"}function v(k){if(k.type==="direct")return k.other_avatar_url??void 0}function d(){}async function h(){if(c.value!==null){y.value=!0;try{await a.forwardMessages(c.value,n.fromChatId,n.messageIds),l("Message forwarded!"),o("forwarded",c.value)}catch{l("Failed to forward message")}finally{y.value=!1}}}return(k,C)=>(u(),p("div",{class:"modal-backdrop",onClick:C[2]||(C[2]=le(_=>o("close"),["self"]))},[t("div",or,[t("div",lr,[C[3]||(C[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:C[0]||(C[0]=_=>o("close"))},"âœ•")]),t("div",rr,[pe(t("input",{"onUpdate:modelValue":C[1]||(C[1]=_=>r.value=_),class:"search-input",type:"search",placeholder:"Search chats...",onInput:d},null,544),[[_e,r.value]]),t("div",cr,[m.value.length===0?(u(),p("div",ur,"No chats found.")):P("",!0),(u(!0),p(re,null,ke(m.value,_=>(u(),p("div",{key:_.id,class:ve(["forward-chat-item",{selected:c.value===_.id}]),onClick:S=>c.value=_.id},[F(Se,{name:f(_),url:v(_),size:"sm"},null,8,["name","url"]),t("div",vr,[t("div",mr,E(f(_)),1),t("div",fr,E(_.type),1)]),c.value===_.id?(u(),p("span",pr,"âœ“")):P("",!0)],10,dr))),128))]),t("div",hr,[t("button",{class:"btn btn-primary",disabled:c.value===null||y.value,onClick:h},E(y.value?"Forwarding...":"Forward"),9,gr)])])])]))}}),br=me(yr,[["__scopeId","data-v-4e477e89"]]),kr={class:"modal modal-sm"},_r={class:"modal-header"},wr={class:"modal-body"},Cr={class:"delete-confirm-text"},$r={key:0,class:"delete-checkbox-label"},Sr={class:"modal-actions"},Mr=se({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:s}){const n=s,o=g(!1);function i(){n("confirm",o.value)}return(a,l)=>(u(),p("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=le(r=>n("close"),["self"]))},[t("div",kr,[t("div",_r,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",wr,[t("p",Cr," Are you sure you want to delete "+E(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(u(),p("label",$r,[pe(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>o.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[_a,o.value]]),l[5]||(l[5]=we(" Delete for everyone ",-1))])):P("",!0)]),t("div",Sr,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:i},"Delete")])])]))}}),xr=me(Mr,[["__scopeId","data-v-388dbae2"]]),xt=lt("channel",()=>{const e=g(null),s=g([]),n=g(!1),o=H(()=>s.value.length),i=H(()=>s.value.filter(f=>f.role==="admin"||f.role==="owner").length),a=H(()=>{const f=Pe();return f.user?s.value.find(d=>d.id===f.user.id)?.role??null:null}),l=H(()=>a.value==="owner"),r=H(()=>a.value==="admin"||a.value==="owner");async function c(f){n.value=!0;try{e.value=await Ms(f)}catch(v){console.error("Failed to load channel detail",v)}finally{n.value=!1}}async function y(f){try{s.value=await ja(f)}catch(v){console.error("Failed to load channel members",v)}}async function m(f,v){try{e.value=await Ha(f,v)}catch(d){throw console.error("Failed to update channel",d),d}}return{detail:e,members:s,loading:n,memberCount:o,adminCount:i,myRole:a,isOwner:l,isAdmin:r,loadDetail:c,loadMembers:y,updateChannel:m}}),Er=lt("invites",()=>{const e=g([]),s=g(!1);async function n(a){s.value=!0;try{e.value=await Ma(a)}catch(l){console.error("Failed to load invites",l)}finally{s.value=!1}}async function o(a){try{const l=await xa(a);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function i(a){const l=[...e.value];e.value=e.value.filter(r=>r.token!==a);try{await Ea(a)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:s,loadInvites:n,createInvite:o,revokeInvite:i}}),Tr={class:"invite-links-view"},Ir={class:"view-header"},Lr={style:{padding:"0 1rem .5rem"}},Ar=["disabled"],Dr={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},Rr={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},Pr={key:2,class:"invite-list",style:{padding:"0 1rem"}},Or={class:"invite-item-info"},Nr={class:"invite-token"},Ur={class:"invite-date"},Fr={class:"invite-item-actions"},zr=["onClick"],Br=["onClick"],jr=se({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,o=s,i=Er(),{showToast:a}=Ae(),l=g(!1);function r(f){return new Date(f).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function c(f){const v=`${window.location.origin}/join/${f}`;navigator.clipboard&&navigator.clipboard.writeText(v).then(()=>a("Link copied!"))}async function y(){l.value=!0;try{await i.createInvite(n.chatId),a("Invite link created")}catch{a("Failed to create invite")}finally{l.value=!1}}async function m(f){try{await i.revokeInvite(f),a("Invite revoked")}catch{a("Failed to revoke invite")}}return Ee(()=>i.loadInvites(n.chatId)),(f,v)=>(u(),p("div",Tr,[t("div",Ir,[t("button",{class:"icon-btn","aria-label":"Back",onClick:v[0]||(v[0]=d=>o("back"))},[F(b(He),{size:20,"stroke-width":2})]),v[1]||(v[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",Lr,[t("button",{class:"btn btn-sm btn-outline",onClick:y,disabled:l.value},E(l.value?"Creating...":"Create Invite Link"),9,Ar)]),b(i).loading?(u(),p("div",Dr," Loading... ")):b(i).invites.length===0?(u(),p("div",Rr," No active invite links ")):(u(),p("div",Pr,[(u(!0),p(re,null,ke(b(i).invites,d=>(u(),p("div",{key:d.id,class:"invite-item"},[t("div",Or,[t("code",Nr,E(d.token),1),t("span",Ur,E(r(d.created_at)),1)]),t("div",Fr,[t("button",{class:"icon-btn",title:"Copy link",onClick:h=>c(d.token)},[F(b(Ds),{size:16,"stroke-width":2})],8,zr),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:h=>m(d.token)}," Revoke ",8,Br)])]))),128))]))]))}}),Hr=me(jr,[["__scopeId","data-v-97b82dd0"]]);async function Vr(e,s){await Z.post(`/chats/${e}/avatar`,{file_id:s})}async function Wr(e,s){return(await Z.post(`/chats/${e}/members/${s}/promote`)).data}async function qr(e,s){return(await Z.post(`/chats/${e}/members/${s}/demote`)).data}const Gr={class:"admins-view"},Kr={class:"view-header"},Yr={class:"search-bar"},Jr={key:0,class:"member-empty"},Xr={key:1,class:"member-list"},Qr=["onClick"],Zr={class:"member-info"},ec={class:"member-name"},tc={class:"role-badge"},nc={class:"view-footer"},sc={key:0,class:"member-empty"},ac={key:1,class:"member-list"},ic={class:"member-info"},oc={class:"member-name"},lc=["onClick"],rc={key:2,class:"view-footer"},cc=se({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,o=s,i=xt(),a=g(!1),l=g(""),r=H(()=>i.members.filter(v=>v.role==="admin"||v.role==="owner")),c=H(()=>i.members.filter(v=>v.role==="member")),y=H(()=>{const v=l.value.toLowerCase().trim();return v?c.value.filter(d=>d.username.toLowerCase().includes(v)||d.display_name&&d.display_name.toLowerCase().includes(v)):c.value});async function m(v){try{await Wr(n.chatId,v);const d=i.members.find(h=>h.id===v);d&&(d.role="admin"),a.value=!1,l.value=""}catch{}}async function f(v){try{await qr(n.chatId,v);const d=i.members.find(h=>h.id===v);d&&(d.role="member")}catch{}}return(v,d)=>(u(),p("div",Gr,[t("div",Kr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:d[0]||(d[0]=h=>o("back"))},[F(b(He),{size:20,"stroke-width":2})]),d[4]||(d[4]=t("span",{class:"view-title"},"Administrators",-1))]),a.value?(u(),p(re,{key:0},[t("div",Yr,[pe(t("input",{"onUpdate:modelValue":d[1]||(d[1]=h=>l.value=h),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[_e,l.value]])]),y.value.length===0?(u(),p("div",Jr,E(l.value?"No members found":"No members to promote"),1)):(u(),p("div",Xr,[(u(!0),p(re,null,ke(y.value,h=>(u(),p("div",{key:h.id,class:"member-item member-item--selectable",onClick:k=>m(h.id)},[F(Se,{name:h.display_name||h.username,url:h.avatar_url,size:"md"},null,8,["name","url"]),t("div",Zr,[t("span",ec,E(h.display_name||h.username),1),t("span",tc,E(h.role),1)])],8,Qr))),128))])),t("div",nc,[t("button",{class:"btn btn--secondary",onClick:d[2]||(d[2]=h=>a.value=!1)},"Cancel")])],64)):(u(),p(re,{key:1},[r.value.length===0?(u(),p("div",sc," No administrators found ")):(u(),p("div",ac,[(u(!0),p(re,null,ke(r.value,h=>(u(),p("div",{key:h.id,class:"member-item"},[F(Se,{name:h.display_name||h.username,url:h.avatar_url,size:"md"},null,8,["name","url"]),t("div",ic,[t("span",oc,E(h.display_name||h.username),1),t("span",{class:ve(["role-badge",`role-badge--${h.role}`])},E(h.role),3)]),b(i).isOwner&&h.role==="admin"?(u(),p("button",{key:0,class:"btn btn--small btn--danger",onClick:k=>f(h.id)}," Demote ",8,lc)):P("",!0)]))),128))])),b(i).isOwner?(u(),p("div",rc,[t("button",{class:"btn btn--primary",onClick:d[3]||(d[3]=h=>a.value=!0)},"Add Admin")])):P("",!0)],64))]))}}),uc=me(cc,[["__scopeId","data-v-2bd7c861"]]),dc={class:"subscribers-view"},vc={class:"view-header"},mc={class:"search-bar"},fc={key:0,class:"member-empty"},pc={key:1,class:"member-list"},hc={class:"member-info"},gc={class:"member-name"},yc=se({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=s,o=xt(),i=g(""),a=H(()=>{const l=i.value.toLowerCase().trim();return l?o.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):o.members});return(l,r)=>(u(),p("div",dc,[t("div",vc,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=c=>n("back"))},[F(b(He),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",mc,[pe(t("input",{"onUpdate:modelValue":r[1]||(r[1]=c=>i.value=c),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[_e,i.value]])]),a.value.length===0?(u(),p("div",fc,E(i.value?"No members found":"No subscribers"),1)):(u(),p("div",pc,[(u(!0),p(re,null,ke(a.value,c=>(u(),p("div",{key:c.id,class:"member-item"},[F(Se,{name:c.display_name||c.username,url:c.avatar_url,size:"md"},null,8,["name","url"]),t("div",hc,[t("span",gc,E(c.display_name||c.username),1),t("span",{class:ve(["role-badge",`role-badge--${c.role}`])},E(c.role),3)])]))),128))]))]))}}),bc=me(yc,[["__scopeId","data-v-f99a8a5f"]]),kc={class:"modal profile-modal"},_c={class:"profile-modal-body profile-modal-body--scrollable"},wc={class:"profile-avatar-section profile-avatar-upload-section"},Cc={class:"profile-avatar-overlay"},$c={class:"profile-info-list"},Sc={class:"form-group"},Mc={class:"form-label"},xc=["placeholder"],Ec={class:"form-group"},Tc=["placeholder"],Ic={key:0,class:"form-group"},Lc={class:"form-label"},Ac={class:"type-selector"},Dc={class:"type-option"},Rc={class:"type-option"},Pc={class:"profile-edit-actions"},Oc=["disabled"],Nc=se({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:s}){const n=e,o=s,i=xt(),{showToast:a}=Ae(),l=g(""),r=g(""),c=g(void 0),y=g("public"),m=g(!1),f=g(null),v=H(()=>i.detail?.type==="group"),d=H(()=>v.value?"Group":"Channel");Ee(()=>{i.detail&&(l.value=i.detail.title||"",r.value=i.detail.description||"",c.value=i.detail.avatar_url??void 0,y.value=i.detail.public_name?"public":"private")});async function h(){const C=f.value?.files?.[0];if(C){try{const _=await Pt(C);await Vr(n.chatId,_.id),c.value=URL.createObjectURL(C),a("Avatar updated!")}catch{a("Avatar upload failed")}f.value&&(f.value.value="")}}async function k(){if(!l.value.trim()){a(`${d.value} name is required`);return}m.value=!0;try{await i.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),a(`${d.value} updated!`),o("saved"),o("close")}catch{a(`Failed to update ${d.value.toLowerCase()}`)}finally{m.value=!1}}return(C,_)=>(u(),p("div",{class:"modal-backdrop profile-backdrop",onClick:_[7]||(_[7]=le(S=>o("close"),["self"]))},[t("div",kc,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:_[0]||(_[0]=S=>o("close"))},[F(b(Ye),{size:20,"stroke-width":2})]),t("div",_c,[t("div",wc,[t("div",{class:"profile-avatar-upload-wrap",onClick:_[1]||(_[1]=S=>f.value?.click())},[F(Se,{name:l.value||d.value,url:c.value,size:"xxl"},null,8,["name","url"]),t("div",Cc,[F(b(Ls),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",class:"hidden",onChange:h},null,544)]),t("div",$c,[t("div",Sc,[t("label",Mc,E(d.value)+" name",1),pe(t("input",{"onUpdate:modelValue":_[2]||(_[2]=S=>l.value=S),class:"form-input",type:"text",maxlength:"128",placeholder:`${d.value} name`},null,8,xc),[[_e,l.value]])]),t("div",Ec,[_[8]||(_[8]=t("label",{class:"form-label"},"Description",-1)),pe(t("textarea",{"onUpdate:modelValue":_[3]||(_[3]=S=>r.value=S),class:"form-input",maxlength:"500",rows:"4",placeholder:`${d.value} description...`},null,8,Tc),[[_e,r.value]])]),b(i).isOwner?(u(),p("div",Ic,[t("label",Lc,E(d.value)+" type",1),t("div",Ac,[t("label",Dc,[pe(t("input",{"onUpdate:modelValue":_[4]||(_[4]=S=>y.value=S),type:"radio",value:"public",name:"chatType"},null,512),[[ss,y.value]]),_[9]||(_[9]=t("span",{class:"type-option-label"},"Public",-1)),_[10]||(_[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",Rc,[pe(t("input",{"onUpdate:modelValue":_[5]||(_[5]=S=>y.value=S),type:"radio",value:"private",name:"chatType"},null,512),[[ss,y.value]]),_[11]||(_[11]=t("span",{class:"type-option-label"},"Private",-1)),_[12]||(_[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):P("",!0)]),t("div",Pc,[t("button",{class:"btn btn-primary",disabled:m.value,onClick:k},E(m.value?"Saving...":"Save"),9,Oc),t("button",{class:"btn btn-ghost",onClick:_[6]||(_[6]=S=>o("close"))},"Cancel")])])])]))}}),Uc=me(Nc,[["__scopeId","data-v-6ec12915"]]),Fc={class:"danger-zone"},zc={class:"view-header"},Bc={class:"danger-zone-body"},jc={class:"modal modal-sm"},Hc={class:"modal-header"},Vc={class:"modal-actions"},Wc=["disabled"],qc=se({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:s}){const n=e,o=s,i=xe(),a=xt(),{showToast:l}=Ae(),r=g(!1),c=g(!1);async function y(){try{await i.leave(n.chatId),o("left")}catch{l("Failed to leave channel")}}async function m(){c.value=!0;try{await xs(n.chatId),i.chats=i.chats.filter(f=>f.id!==n.chatId),i.activeChatId===n.chatId&&i.setActiveChat(null),r.value=!1,o("deleted")}catch{l("Failed to delete channel")}finally{c.value=!1}}return(f,v)=>(u(),p("div",Fc,[t("div",zc,[t("button",{class:"icon-btn","aria-label":"Back",onClick:v[0]||(v[0]=d=>o("back"))},[F(b(He),{size:20,"stroke-width":2})]),v[5]||(v[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",Bc,[t("button",{class:"btn btn-danger-outline",onClick:y},[F(b(On),{size:18,"stroke-width":1.8}),v[6]||(v[6]=we(" Leave Channel ",-1))]),b(a).isOwner?(u(),p("button",{key:0,class:"btn btn-danger",onClick:v[1]||(v[1]=d=>r.value=!0)},[F(b(Os),{size:18,"stroke-width":1.8}),v[7]||(v[7]=we(" Delete Channel ",-1))])):P("",!0)]),r.value?(u(),p("div",{key:0,class:"modal-backdrop",onClick:v[4]||(v[4]=le(d=>r.value=!1,["self"]))},[t("div",jc,[t("div",Hc,[v[8]||(v[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:v[2]||(v[2]=d=>r.value=!1)},[F(b(Ye),{size:20,"stroke-width":2})])]),v[9]||(v[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",Vc,[t("button",{class:"btn btn-ghost",onClick:v[3]||(v[3]=d=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:c.value,onClick:m},E(c.value?"Deleting...":"Delete"),9,Wc)])])])):P("",!0)]))}}),Gc=me(qc,[["__scopeId","data-v-997b5e56"]]),Kc={class:"modal profile-modal"},Yc={class:"profile-modal-body"},Jc={key:5,class:"profile-loading"},Xc={class:"profile-avatar-section"},Qc={class:"profile-name"},Zc={class:"profile-status"},eu={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},tu={class:"profile-info-item"},nu={class:"profile-info-value"},su={class:"channel-info-menu"},au={class:"channel-info-menu-count"},iu={class:"channel-info-menu-count"},ou={key:7,class:"profile-loading"},lu=se({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:s}){const n=e,o=s,i=xt(),a=g("main"),l=H(()=>Number(n.chatId)),r=H(()=>i.detail?.type==="group");function c(){a.value="main",i.loadDetail(l.value)}return Ee(async()=>{await Promise.all([i.loadDetail(l.value),i.loadMembers(l.value)])}),(y,m)=>(u(),p("div",{class:"modal-backdrop profile-backdrop",onClick:m[14]||(m[14]=le(f=>o("close"),["self"]))},[t("div",Kc,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:m[0]||(m[0]=f=>o("close"))},[F(b(Ye),{size:20,"stroke-width":2})]),t("div",Yc,[a.value==="invites"?(u(),J(Hr,{key:0,"chat-id":l.value,onBack:m[1]||(m[1]=f=>a.value="main")},null,8,["chat-id"])):a.value==="admins"?(u(),J(uc,{key:1,"chat-id":l.value,onBack:m[2]||(m[2]=f=>a.value="main")},null,8,["chat-id"])):a.value==="subscribers"?(u(),J(bc,{key:2,"chat-id":l.value,onBack:m[3]||(m[3]=f=>a.value="main")},null,8,["chat-id"])):a.value==="edit"?(u(),J(Uc,{key:3,"chat-id":l.value,onClose:m[4]||(m[4]=f=>a.value="main"),onSaved:c},null,8,["chat-id"])):a.value==="danger"?(u(),J(Gc,{key:4,"chat-id":l.value,onBack:m[5]||(m[5]=f=>a.value="main"),onLeft:m[6]||(m[6]=f=>o("close")),onDeleted:m[7]||(m[7]=f=>o("close"))},null,8,["chat-id"])):b(i).loading?(u(),p("div",Jc,[...m[15]||(m[15]=[t("p",null,"Loading...",-1)])])):b(i).detail?(u(),p(re,{key:6},[t("div",Xc,[F(Se,{name:b(i).detail.title||"Channel",url:b(i).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",Qc,E(b(i).detail.title),1),t("div",Zc,E(b(i).memberCount)+" "+E(r.value?b(i).memberCount===1?"member":"members":b(i).memberCount===1?"subscriber":"subscribers"),1),b(i).detail.description?(u(),p("div",eu,[t("div",tu,[m[16]||(m[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",nu,E(b(i).detail.description),1)])])):P("",!0),m[19]||(m[19]=t("div",{class:"profile-divider"},null,-1)),t("div",su,[t("button",{class:"channel-info-menu-item",onClick:m[8]||(m[8]=f=>a.value="invites")},[F(b(bi),{size:20,"stroke-width":1.8}),m[17]||(m[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:m[9]||(m[9]=f=>a.value="admins")},[F(b(Ei),{size:20,"stroke-width":1.8}),m[18]||(m[18]=t("span",null,"Administrators",-1)),t("span",au,E(b(i).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:m[10]||(m[10]=f=>a.value="subscribers")},[F(b(Un),{size:20,"stroke-width":1.8}),t("span",null,E(r.value?"Members":"Subscribers"),1),t("span",iu,E(b(i).memberCount),1)]),b(i).isOwner||b(i).isAdmin?(u(),p("button",{key:0,class:"channel-info-menu-item",onClick:m[11]||(m[11]=f=>a.value="edit")},[F(b(Nn),{size:20,"stroke-width":1.8}),t("span",null,E(r.value?"Edit Group":"Edit Channel"),1)])):P("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:m[12]||(m[12]=f=>a.value="danger")},[F(b(On),{size:20,"stroke-width":1.8}),t("span",null,E(r.value?"Leave Group":"Leave Channel"),1)]),b(i).isOwner?(u(),p("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:m[13]||(m[13]=f=>a.value="danger")},[F(b(Os),{size:20,"stroke-width":1.8}),t("span",null,E(r.value?"Delete Group":"Delete Channel"),1)])):P("",!0)])],64)):(u(),p("div",ou,[...m[20]||(m[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),ru=me(lu,[["__scopeId","data-v-d1526322"]]),cu={class:"search-bar"},uu={class:"search-bar-header"},du={key:0,class:"search-loading"},vu={key:1,class:"search-empty"},mu=["onClick"],fu={class:"search-result-sender"},pu=["innerHTML"],hu={class:"search-result-date"},gu={key:0,class:"search-loading"},yu=se({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:s}){const n=e,o=s,i=g(null),a=g(null),l=g(""),r=g([]),c=g(!1),y=g(!1),m=g(!0);let f=null;Ee(()=>{Ie(()=>i.value?.focus())}),Ue(l,S=>{if(f&&clearTimeout(f),!S.trim()){r.value=[],y.value=!1,m.value=!0;return}f=setTimeout(()=>v(S.trim()),300)});async function v(S){c.value=!0,y.value=!0,m.value=!0;try{const z=await is(n.chatId,S,{limit:20});r.value=z,z.length<20&&(m.value=!1)}catch{r.value=[]}finally{c.value=!1}}async function d(){if(c.value||!m.value||r.value.length===0)return;const S=Math.min(...r.value.map(z=>z.id));c.value=!0;try{const z=await is(n.chatId,l.value.trim(),{limit:20,before_id:S});z.length<20&&(m.value=!1),r.value=[...r.value,...z]}catch{}finally{c.value=!1}}function h(){if(!a.value)return;const S=a.value;S.scrollTop+S.clientHeight>=S.scrollHeight-40&&d()}function k(S,z){if(!z)return C(S);const q=C(S),U=C(z),j=new RegExp(U.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return q.replace(j,"<mark>$&</mark>")}function C(S){return S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function _(S){if(!S)return"";const z=new Date(S.endsWith("Z")?S:S+"Z"),q=new Date;return z.toDateString()===q.toDateString()?z.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):z.toLocaleDateString([],{month:"short",day:"numeric"})+" "+z.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return(S,z)=>(u(),p("div",cu,[t("div",uu,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:z[0]||(z[0]=q=>o("close"))},"â†"),pe(t("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":z[1]||(z[1]=q=>l.value=q),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:z[2]||(z[2]=Rt(q=>o("close"),["escape"]))},null,544),[[_e,l.value]]),l.value?(u(),p("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:z[3]||(z[3]=q=>l.value="")},"âœ•")):P("",!0)]),c.value&&r.value.length===0?(u(),p("div",du,"Searching...")):y.value&&r.value.length===0&&!c.value?(u(),p("div",vu,"No messages found")):r.value.length>0?(u(),p("div",{key:2,ref_key:"resultsRef",ref:a,class:"search-results",onScroll:h},[(u(!0),p(re,null,ke(r.value,q=>(u(),p("div",{key:q.id,class:"search-result-item",onClick:U=>o("jumpToMessage",q.id)},[t("div",fu,E(q.sender_display_name||q.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:k(q.content||"",l.value)},null,8,pu),t("div",hu,E(_(q.created_at)),1)],8,mu))),128)),c.value?(u(),p("div",gu,"Loading more...")):P("",!0)],544)):P("",!0)]))}}),bu=["accept"],ku=se({__name:"AttachmentMenu",props:{visible:{type:Boolean}},emits:["file-selected","close"],setup(e,{emit:s}){const n=s,o=g(null),i=g(""),a=g("media");function l(c){a.value=c,i.value=c==="media"?"image/*,video/*":"*/*",setTimeout(()=>{o.value?.click()},0)}function r(c){const y=c.target,m=y.files?.[0];m&&n("file-selected",m,a.value),y.value="",n("close")}return(c,y)=>e.visible?(u(),p("div",{key:0,class:"attachment-menu",onClick:y[2]||(y[2]=le(()=>{},["stop"]))},[t("button",{class:"attachment-option",onClick:y[0]||(y[0]=m=>l("media"))},[F(b(Pn),{size:20}),y[3]||(y[3]=t("span",null,"Photo or Video",-1))]),t("button",{class:"attachment-option",onClick:y[1]||(y[1]=m=>l("document"))},[F(b(Rn),{size:20}),y[4]||(y[4]=t("span",null,"Document",-1))]),t("input",{ref_key:"fileInput",ref:o,type:"file",hidden:"",accept:i.value,onChange:r},null,40,bu)])):P("",!0)}}),_u=me(ku,[["__scopeId","data-v-a9e355ea"]]),wu={class:"modal"},Cu={class:"modal-header"},$u={class:"modal-title"},Su={class:"modal-body"},Mu={key:0,class:"attachment-error"},xu={class:"attachment-preview-area"},Eu=["src","alt"],Tu={key:1,class:"attachment-file-icon"},Iu={class:"file-name"},Lu={class:"file-size"},Au={class:"modal-actions"},Du=["disabled"],Ru=50*1024*1024,Pu=se({__name:"AttachmentPreview",props:{file:{}},emits:["send","cancel"],setup(e,{emit:s}){const n=e,o=s,i=g(""),a=g(""),l=H(()=>n.file.type.startsWith("image/")),r=H(()=>l.value?"Send Image":n.file.type.startsWith("video/")?"Send Video":n.file.type.startsWith("audio/")?"Send Audio":"Send File"),c=H(()=>n.file.size>Ru?"File is too large. Maximum size is 50MB.":null),y=H(()=>{const f=n.file.size;return f<1024?`${f} B`:f<1024*1024?`${(f/1024).toFixed(1)} KB`:`${(f/(1024*1024)).toFixed(1)} MB`});function m(){c.value||o("send",n.file,i.value)}return Ee(()=>{l.value&&(a.value=URL.createObjectURL(n.file))}),Fe(()=>{a.value&&URL.revokeObjectURL(a.value)}),(f,v)=>(u(),p("div",{class:"modal-backdrop",onClick:v[3]||(v[3]=le(d=>o("cancel"),["self"]))},[t("div",wu,[t("div",Cu,[t("h2",$u,E(r.value),1),t("button",{class:"icon-btn",onClick:v[0]||(v[0]=d=>o("cancel"))},"âœ•")]),t("div",Su,[c.value?(u(),p("div",Mu,E(c.value),1)):(u(),p(re,{key:1},[t("div",xu,[l.value?(u(),p("img",{key:0,src:a.value,alt:e.file.name,class:"attachment-thumbnail"},null,8,Eu)):(u(),p("div",Tu,[v[4]||(v[4]=t("span",{class:"file-icon"},"ğŸ“„",-1)),t("span",Iu,E(e.file.name),1),t("span",Lu,E(y.value),1)]))]),pe(t("input",{"onUpdate:modelValue":v[1]||(v[1]=d=>i.value=d),class:"caption-input",type:"text",placeholder:"Add a caption...",onKeydown:Rt(m,["enter"])},null,544),[[_e,i.value]])],64))]),t("div",Au,[t("button",{class:"btn btn-ghost",onClick:v[2]||(v[2]=d=>o("cancel"))},"Cancel"),t("button",{class:"btn btn-primary",disabled:!!c.value,onClick:m},"Send",8,Du)])])]))}}),Ou=me(Pu,[["__scopeId","data-v-80e7f118"]]);function Nu(e){const{chatId:s,verticalThreshold:n=8}=e,o=g(!1);let i=0,a=!1,l=!1,r=null;function c(d){const h=d?.closest?.("[data-message-id]");if(!h)return null;const k=h.getAttribute("data-message-id");return k!=null?Number(k):null}function y(d,h){const k=document.elementFromPoint(d,h),C=c(k);if(C!=null)return C;const _=document.querySelectorAll("[data-message-id]");let S=null,z=1/0;for(const q of _){const U=q.getBoundingClientRect(),j=U.top+U.height/2,ae=Math.abs(h-j);ae<z&&(z=ae,S=q)}if(S){const q=S.getAttribute("data-message-id");return q!=null?Number(q):null}return null}function m(d){if(d.button!==0)return;const h=d.target;!h.closest("[data-message-id]")||s()==null||(i=d.clientY,a=!0,l=!1,r=c(h))}function f(d){if(!a)return;if(!l){if(Math.abs(d.clientY-i)<n)return;l=!0;const C=tt(),_=s();if(_==null){a=!1;return}C.selectionMode?r!=null&&C.addMessage(r):C.enterSelectionMode(_,r??void 0),o.value=!0}d.preventDefault();const h=y(d.clientX,d.clientY);h!=null&&tt().addMessage(h)}function v(){a&&(a=!1,l=!1,o.value=!1)}return{isDragSelecting:o,onMouseDown:m,onMouseMove:f,onMouseUp:v}}const Uu={class:"chat-panel"},Fu={key:1,class:"chat-view"},zu={key:2,class:"channel-readonly-bar"},Bu={key:0,class:"date-sep"},ju={key:4,class:"sticker-picker"},Hu={key:8,class:"recording-bar"},Vu={class:"rec-time"},Wu=se({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:s}){const n=wa(()=>Ca(()=>import("./EmojiPickerPanel-CTtJfjhL.js"),__vite__mapDeps([0,1,2,3,4]))),o=s,i=Pe(),a=xe(),l=et(),{showToast:r}=Ae(),c=to(),y=ot("stickers",g([])),m=ot("sendTyping",()=>{}),f=ot("pendingScrollMessageId",g(null)),v=g(null),d=g(null),h=g(!1);let k=null;const C=g(!1),_=g(!1),S=g(null),z=g(!1),q=g("member"),U=g(!1),j=g(!1),ae=g(!1),he=g(null),ce=g("media"),oe=g(null);pt("lastSentMessageId",oe);const de=g(!0),I=g(0);let M=null;function $(){if(!v.value)return!0;const L=v.value;return L.scrollTop+L.clientHeight>=L.scrollHeight-100}function B(){M||(M=setTimeout(()=>{if(M=null,de.value=$(),a.isNearBottom=de.value,de.value&&(I.value=0,a.activeChatId)){const L=a.chats.find(w=>w.id===a.activeChatId);L&&L.unread_count>0&&(L.unread_count=0),gt(a.activeChatId).catch(()=>{})}},100))}function ue(L){if(!v.value)return null;const w=v.value.querySelectorAll("[data-message-id]");let D=null,ne=1/0;for(const ge of w){const Te=ge.getBoundingClientRect();if(L>=Te.top-15&&L<=Te.bottom+15){const Qe=(Te.top+Te.bottom)/2,ns=Math.abs(L-Qe);ns<ne&&(ne=ns,D=ge)}}return D}function Ce(L){if(L.target.closest(".msg-row"))return;L.preventDefault();const D=ue(L.clientY);if(D){const ne=Number(D.dataset.messageId),ge=Xe.value.find(Te=>Te.id===ne);if(ge){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:ge.id,chatId:a.activeChatId,text:ge.content||"",messageType:ge.message_type,senderId:ge.sender_id,senderName:ge.sender_display_name||ge.sender_username||"",x:L.clientX,y:L.clientY}}));return}}window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{areaOnly:!0,chatId:a.activeChatId,x:L.clientX,y:L.clientY}}))}function T(){at(),I.value=0,de.value=!0}const A=g(!1),G=g(0),V=g(0),X=g(null),ie=tt(),{isDragSelecting:K,onMouseDown:W,onMouseMove:x,onMouseUp:R}=Nu({chatId:()=>a.activeChatId}),N=g(!1),Q=g(null),Y=g(""),fe=H(()=>!Q.value||!i.user?!1:Xe.value.find(w=>w.id===Q.value)?.sender_id===i.user.id),be=H(()=>fe.value?Xe.value.find(w=>w.id===Q.value)?.message_type==="text":!1),Me=H(()=>!Q.value||!a.activeChatId?!1:l.pinnedByChat[a.activeChatId]?.message?.id===Q.value),Je=H(()=>!a.activeChatId||l.pinnedDismissed.has(a.activeChatId)?null:l.pinnedByChat[a.activeChatId]||null),ct=g(!1),ut=g([]),dt=g(!1),nt=g([]),vn=g(!1),st=g(null),Gn=H(()=>a.activeChat?.type==="channel"&&q.value==="member"),Xe=H(()=>a.activeChatId?l.getMessages(a.activeChatId):[]),Xs=H(()=>{const L=[];let w="";for(const D of Xe.value){const ne=Qs(D.created_at);ne!==w&&(L.push({type:"date",label:ne}),w=ne),L.push({type:"msg",msg:D})}return L});function Qs(L){if(!L)return"";const w=new Date(L.endsWith("Z")?L:L+"Z"),D=new Date;if(w.toDateString()===D.toDateString())return"Today";const ne=new Date(D);return ne.setDate(D.getDate()-1),w.toDateString()===ne.toDateString()?"Yesterday":w.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Zs(){mn(),!(!d.value||!v.value)&&(k=new IntersectionObserver(async L=>{if(!L[0]?.isIntersecting)return;const D=a.activeChatId;if(!D||h.value||l.loadingChat===D)return;h.value=!0;const ne=v.value,ge=ne?ne.scrollHeight:0;try{if((await l.loadOlder(D)).length>0&&ne){await Ie();const Qe=ne.scrollHeight;ne.scrollTop+=Qe-ge}}finally{h.value=!1}},{root:v.value,threshold:0}),k.observe(d.value))}function mn(){k&&(k.disconnect(),k=null)}Ue(()=>a.activeChatId,async L=>{if(C.value=!1,_.value=!1,q.value="member",I.value=0,de.value=!0,a.isNearBottom=!0,mn(),!L)return;await Promise.all([l.loadMessages(L),l.loadPinnedMessage(L),l.loadReadReceipts(L)]),await Ie(),at(),await Ie(),Zs();const w=a.activeChat;if(w&&(w.type==="channel"||w.type==="group"))try{const D=await Ms(L);q.value=D.my_role||"member"}catch{}});function at(){v.value&&(v.value.scrollTop=v.value.scrollHeight)}function ea(){a.activeChatId&&m(a.activeChatId)}async function ta(L,w){if(!(!a.activeChatId||!L.trim())){st.value=null;try{const D=w?{reply_to_message_id:w.messageId}:void 0,ne=await l.sendMessage(a.activeChatId,L.trim(),"text",D);i.user&&(ne.sender_id=i.user.id,ne.sender_username=i.user.username,ne.sender_display_name=i.user.display_name),oe.value=ne.id,setTimeout(()=>{oe.value===ne.id&&(oe.value=null)},500),await Ie(),at(),a.loadChats()}catch{r("Failed to send message")}}}async function na(L,w){if(!(!a.activeChatId||!w.trim()))try{await l.editMessage(a.activeChatId,L,w.trim())}catch{r("Failed to edit message")}}async function sa(L){if(a.activeChatId){C.value=!1;try{const w=await l.sendMessage(a.activeChatId,"","sticker",{sticker_id:L}),D=y.value.find(ne=>ne.id===L);D&&(w.sticker_url=D.url,w.sticker_label=D.label),oe.value=w.id,setTimeout(()=>{oe.value===w.id&&(oe.value=null)},500),await Ie(),at(),a.loadChats()}catch{r("Failed to send sticker")}}}function aa(L,w,D){X.value=L,G.value=w,V.value=D,A.value=!0}function ia(L){X.value&&a.activeChatId&&l.toggleReaction(a.activeChatId,X.value,L),A.value=!1,X.value=null}function oa(L,w){a.activeChatId&&l.toggleReaction(a.activeChatId,L,w)}function la(){A.value=!1,X.value=null}function ra(L){if(!L){_.value=!1;return}S.value?.insertText(L)}async function ca(){try{await c.startRecording(),z.value=!0}catch{z.value=!1,r("Microphone access denied")}}async function ua(){try{const L=await c.stopRecording();z.value=!1,await ya(L)}catch{z.value=!1}}function da(){c.cancelRecording(),z.value=!1}function Kn(L){const{messageIds:w}=L.detail;ut.value=w,ct.value=!0}function Yn(L){const{messageId:w,chatId:D}=L.detail;D&&ie.enterSelectionMode(D,w)}async function Jn(L,w){try{await l.pinMsg(L,w)}catch{r("Failed to pin message")}}async function Xn(L,w){try{await l.unpinMsg(L,w)}catch{r("Failed to unpin message")}}function Qn(L){const{messageId:w,chatId:D}=L.detail;w&&D&&Jn(D,w)}function Zn(L){const{messageId:w,chatId:D}=L.detail;w&&D&&Xn(D,w)}function fn(L){const{messageId:w,chatId:D}=L.detail;if(!w||!D)return;nt.value=[w];const ne=Xe.value.find(ge=>ge.id===w);vn.value=!!(ne&&ne.sender_id===i.user?.id),dt.value=!0}function va(){ut.value=[...ie.selectedMessageIds],ct.value=!0}function ma(){nt.value=[...ie.selectedMessageIds],vn.value=nt.value.every(L=>{const w=Xe.value.find(D=>D.id===L);return w&&w.sender_id===i.user?.id}),dt.value=!0}function es(){ct.value=!1,ut.value=[],ie.exitSelectionMode()}async function fa(L){dt.value=!1;const w=a.activeChatId;if(w){for(const D of nt.value)try{await l.deleteMessage(w,D,L)}catch{r("Failed to delete message")}nt.value=[],ie.exitSelectionMode()}}function We(L){N.value=!1;const w=Q.value,D=a.activeChatId;if(!(!w||!D))switch(L){case"reply":{const ne=Xe.value.find(ge=>ge.id===w);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:w,senderName:ne?.sender_display_name||ne?.sender_username||"Unknown",text:ne?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:w,chatId:D,text:Y.value}}));break}case"copy":navigator.clipboard.writeText(Y.value).then(()=>r("Copied to clipboard"),()=>r("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${D}/${w}`).then(()=>r("Link copied"),()=>r("Failed to copy link"));break;case"forward":ut.value=[w],ct.value=!0;break;case"select":ie.enterSelectionMode(D,w);break;case"delete":fn(new CustomEvent("",{detail:{messageId:w,chatId:D}}));break;case"pin":Jn(D,w);break;case"unpin":Xn(D,w);break}}async function Et(L){if(!v.value)return;const w=a.activeChatId;if(!w)return;let D=v.value.querySelector(`[data-message-id="${L}"]`);if(!D)try{const ne=Math.max(0,L-25),ge=await At(w,{after_id:ne,limit:50});if(!ge.find(Qe=>Qe.id===L)){r("Message not found");return}l.messagesByChat[w]=ge,ge.length>0&&(l.lastMsgId[w]=Math.max(...ge.map(Qe=>Qe.id))),await Ie(),D=v.value?.querySelector(`[data-message-id="${L}"]`)}catch{r("Message not found");return}D&&(D.scrollIntoView({behavior:"smooth",block:"center"}),D.classList.add("highlight-message"),setTimeout(()=>D.classList.remove("highlight-message"),2e3))}function pa(L){j.value=!1,Et(L)}function ts(L){if(L.key==="Escape"){if(_.value){_.value=!1,L.stopPropagation();return}if(j.value){j.value=!1,L.stopPropagation();return}U.value&&(U.value=!1,L.stopPropagation())}}Ee(()=>{window.addEventListener("forward-messages",Kn),window.addEventListener("select-message",Yn),window.addEventListener("delete-message",fn),window.addEventListener("pin-message",Qn),window.addEventListener("unpin-message",Zn),document.addEventListener("keydown",ts)}),Fe(()=>{mn(),window.removeEventListener("forward-messages",Kn),window.removeEventListener("select-message",Yn),window.removeEventListener("delete-message",fn),window.removeEventListener("pin-message",Qn),window.removeEventListener("unpin-message",Zn),document.removeEventListener("keydown",ts)}),Ue(()=>f.value,async L=>{L&&(await Ie(),setTimeout(()=>{Et(L),f.value=null},300))}),Ue(()=>a.activeChatId,()=>{ie.exitSelectionMode(),st.value=null,j.value=!1});function ha(L,w){ce.value=w,he.value=L,ae.value=!1}async function ga(L,w){if(a.activeChatId){he.value=null;try{const D=await Pt(L),ne=L.type.startsWith("image/")?"image":"file",ge={file_id:D.id};st.value&&(ge.reply_to_message_id=st.value.id);const Te=await l.sendMessage(a.activeChatId,w,ne,ge);i.user&&(Te.sender_id=i.user.id,Te.sender_username=i.user.username,Te.sender_display_name=i.user.display_name),st.value=null,oe.value=Te.id,setTimeout(()=>{oe.value===Te.id&&(oe.value=null)},500),await Ie(),at(),a.loadChats()}catch{r("Failed to send attachment")}}}async function ya(L){if(a.activeChatId)try{const w=await Pt(L);await l.sendMessage(a.activeChatId,"","voice",{file_id:w.id,duration_seconds:c.seconds.value}),await l.loadMessages(a.activeChatId),await Ie(),at(),a.loadChats()}catch{r("Failed to upload voice message")}}return(L,w)=>(u(),p("main",Uu,[b(a).activeChatId?(u(),p("div",Fu,[F(sr,{onForward:va,onDelete:ma}),j.value&&b(a).activeChatId?(u(),J(yu,{key:0,"chat-id":b(a).activeChatId,onClose:w[1]||(w[1]=D=>j.value=!1),onJumpToMessage:pa},null,8,["chat-id"])):P("",!0),pe(F(vo,{onBack:w[2]||(w[2]=D=>o("back")),onOpenUserProfile:w[3]||(w[3]=D=>o("openUserProfile",D)),onOpenChannelInfo:w[4]||(w[4]=D=>U.value=!0),onOpenSearch:w[5]||(w[5]=D=>j.value=!0)},null,512),[[as,!b(ie).selectionMode&&!j.value]]),Je.value&&!b(ie).selectionMode?(u(),J(io,{key:1,message:Je.value.message,onClick:w[6]||(w[6]=D=>Et(Je.value.message.id)),onDismiss:w[7]||(w[7]=D=>b(l).dismissPin(b(a).activeChatId))},null,8,["message"])):P("",!0),Gn.value?(u(),p("div",zu,[...w[30]||(w[30]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):P("",!0),I.value>0?(u(),p("button",{key:3,class:"new-messages-pill",onClick:T},E(I.value)+" new message"+E(I.value>1?"s":"")+" â†“ ",1)):P("",!0),t("div",{ref_key:"msgListRef",ref:v,class:ve(["msg-list",{"drag-selecting":b(K)}]),onClick:la,onScroll:B,onContextmenu:Ce,onMousedown:w[9]||(w[9]=(...D)=>b(W)&&b(W)(...D)),onMousemove:w[10]||(w[10]=(...D)=>b(x)&&b(x)(...D)),onMouseup:w[11]||(w[11]=(...D)=>b(R)&&b(R)(...D))},[b(l).loadingChat===b(a).activeChatId?(u(),J(ks,{key:0})):(u(),p(re,{key:1},[w[31]||(w[31]=t("div",{class:"msg-list-spacer"},null,-1)),t("div",{ref_key:"olderSentinelRef",ref:d,class:"older-sentinel"},[h.value?(u(),J(ks,{key:0})):P("",!0)],512),(u(!0),p(re,null,ke(Xs.value,D=>(u(),p(re,{key:D.type==="date"?"date-"+D.label:"msg-"+D.msg.id},[D.type==="date"?(u(),p("div",Bu,[t("span",null,E(D.label),1)])):(u(),J(Ml,{key:1,message:D.msg,"is-mine":D.msg.sender_id===b(i).user?.id,onMentionClick:w[8]||(w[8]=ne=>o("openUserProfile",ne)),onOpenEmojiPicker:aa,onToggleReaction:oa,onReplyClick:Et},null,8,["message","is-mine"]))],64))),128))],64))],34),F(Kl,{visible:A.value,x:G.value,y:V.value,onSelect:ia,onClose:w[12]||(w[12]=D=>A.value=!1)},null,8,["visible","x","y"]),C.value?(u(),p("div",ju,[F(Hl,{onSelect:sa})])):P("",!0),_.value?(u(),J(b(n),{key:5,onSelect:ra})):P("",!0),Gn.value?P("",!0):pe((u(),J(Ul,{key:6,ref_key:"composerRef",ref:S,"sticker-picker-open":C.value,"reply-to":st.value,onSend:ta,onEditMessage:na,onToggleStickers:w[13]||(w[13]=D=>C.value=!C.value),onToggleEmojiPanel:w[14]||(w[14]=D=>_.value=!_.value),onStartRecording:ca,onTyping:ea,onOpenAttachmentMenu:w[15]||(w[15]=D=>ae.value=!ae.value)},null,8,["sticker-picker-open","reply-to"])),[[as,!z.value]]),F(_u,{visible:ae.value,onFileSelected:ha,onClose:w[16]||(w[16]=D=>ae.value=!1)},null,8,["visible"]),he.value?(u(),J(Ou,{key:7,file:he.value,onSend:ga,onCancel:w[17]||(w[17]=D=>he.value=null)},null,8,["file"])):P("",!0),z.value?(u(),p("div",Hu,[w[32]||(w[32]=t("span",{class:"rec-dot"},null,-1)),t("span",Vu,E(b(c).formatTime(b(c).seconds.value)),1),w[33]||(w[33]=t("span",{class:"rec-label"},"Recording...",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:da},"âœ•"),t("button",{class:"icon-btn rec-send",title:"Send",onClick:ua},"â¤")])):P("",!0),F(Jl),F(ir,{visible:N.value,onClose:w[26]||(w[26]=D=>N.value=!1)},{default:un(()=>[t("button",{class:"ctx-item",onClick:w[18]||(w[18]=D=>We("reply"))},"Reply"),be.value?(u(),p("button",{key:0,class:"ctx-item",onClick:w[19]||(w[19]=D=>We("edit"))},"Edit")):P("",!0),t("button",{class:"ctx-item",onClick:w[20]||(w[20]=D=>We(Me.value?"unpin":"pin"))},E(Me.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:w[21]||(w[21]=D=>We("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:w[22]||(w[22]=D=>We("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:w[23]||(w[23]=D=>We("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:w[24]||(w[24]=D=>We("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:w[25]||(w[25]=D=>We("delete"))},"Delete")]),_:1},8,["visible"]),ct.value?(u(),J(br,{key:9,"message-ids":ut.value,"from-chat-id":b(a).activeChatId,onClose:es,onForwarded:es},null,8,["message-ids","from-chat-id"])):P("",!0),dt.value?(u(),J(xr,{key:10,"message-count":nt.value.length,"can-delete-for-everyone":vn.value,onClose:w[27]||(w[27]=D=>dt.value=!1),onConfirm:fa},null,8,["message-count","can-delete-for-everyone"])):P("",!0),U.value?(u(),J(ru,{key:11,"chat-id":String(b(a).activeChatId),onClose:w[28]||(w[28]=D=>U.value=!1)},null,8,["chat-id"])):P("",!0)])):(u(),p("div",{key:0,class:"empty-chat",onContextmenu:w[0]||(w[0]=le(()=>{},["prevent"]))},[...w[29]||(w[29]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])],32))]))}}),qu=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Saved Messages",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop&&!e.isTauri,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function Gu(e){return qu.filter(s=>s.visible(e))}const Ku=["disabled"],Yu={class:"menu-item__label"},Ju={key:1,class:"menu-item__badge"},Xu=se({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:s}){const n=s;return(o,i)=>(u(),p("button",{class:ve(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:i[0]||(i[0]=a=>n("click"))},[e.icon?(u(),J(Ve(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):P("",!0),t("span",Yu,E(e.label),1),e.badge?(u(),p("span",Ju,E(e.badge),1)):P("",!0),$s(o.$slots,"right",{},void 0,!0),e.chevron?(u(),J(Ve(b(fi)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):P("",!0)],10,Ku))}}),_s=me(Xu,[["__scopeId","data-v-682bc042"]]),Qu={class:"drawer-profile"},Zu={class:"drawer-profile-bottom"},ed={class:"drawer-profile-info"},td={class:"drawer-display-name"},nd={class:"drawer-username"},sd={class:"drawer-nav"},ad={key:0,class:"drawer-divider"},id=["onClick"],od={class:"menu-item__label"},ld=["aria-checked"],rd=se({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:s}){const n=s,o=Ss(),i=Pe(),a=Mt(),l={user:Ns,users:Un,megaphone:Rs,bookmark:mi,settings:xi,moon:wi,download:pi,"log-out":On,star:Li},r="__TAURI_INTERNALS__"in window,c=H(()=>({isAuthenticated:!!i.user,isDesktop:!0,isTauri:r})),y=H(()=>Gu(c.value)),m={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const v=a.theme==="dark"?"light":"dark";a.applyTheme(v),a.saveSettings({theme:v})},openDownload:()=>n("openDownload"),logout:()=>{i.logout(),o.push("/login")}};function f(v){v&&m[v]&&m[v]()}return(v,d)=>(u(),p("div",{class:ve(["drawer",{open:e.open}])},[t("div",Qu,[F(Se,{name:b(i).user?.display_name||b(i).user?.username||"?",url:b(i).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",Zu,[t("div",ed,[t("div",td,E(b(i).user?.display_name||b(i).user?.username||"---"),1),t("div",nd,"@"+E(b(i).user?.username||"---"),1)]),t("button",{class:"icon-btn drawer-edit-btn","aria-label":"Edit profile",onClick:d[0]||(d[0]=h=>n("openProfile"))},[F(b(Nn),{size:18,"stroke-width":2})])])]),t("nav",sd,[(u(!0),p(re,null,ke(y.value,h=>(u(),p(re,{key:h.id},[h.separator?(u(),p("div",ad)):P("",!0),h.rightSlot==="toggle"?(u(),p("div",{key:1,class:"menu-item menu-item--toggle",onClick:k=>f(h.action)},[(u(),J(Ve(l[h.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",od,E(h.label),1),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":b(a).theme==="dark"}]),role:"switch","aria-checked":b(a).theme==="dark"},[...d[1]||(d[1]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,ld)],8,id)):h.id==="logout"?(u(),J(_s,{key:2,icon:l[h.icon],label:h.label,danger:"",onClick:k=>f(h.action)},null,8,["icon","label","onClick"])):(u(),J(_s,{key:3,icon:l[h.icon],label:h.label,onClick:k=>f(h.action)},null,8,["icon","label","onClick"]))],64))),128))]),d[2]||(d[2]=t("div",{class:"drawer-footer"},"BeHappy v2",-1))],2))}}),cd=me(rd,[["__scopeId","data-v-4b45009b"]]),ud={class:"modal"},dd={class:"modal-header"},vd={class:"modal-body"},md={key:0,class:"chat-type-cards"},fd={class:"chat-type-icon"},pd={class:"chat-type-icon"},hd={class:"chat-type-icon"},gd={key:1,class:"new-chat-form"},yd={class:"user-pick-list"},bd={key:0,class:"empty-state-small"},kd={key:1,class:"empty-state-small"},_d=["onClick"],wd={class:"user-pick-name"},Cd={class:"user-pick-handle"},$d={key:2,class:"new-chat-form"},Sd={class:"form-group"},Md={class:"form-group"},xd={class:"form-group"},Ed={class:"user-pick-list"},Td=["onClick"],Id={class:"user-pick-name"},Ld={class:"user-pick-handle"},Ad={class:"modal-actions"},Dd=["disabled"],Rd={key:3,class:"new-chat-form"},Pd={class:"form-group"},Od={class:"form-group"},Nd={class:"form-group"},Ud={class:"modal-actions"},Fd=["disabled"],zd=se({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:s}){const n=e,o=s,i=Pe(),{showToast:a}=Ae(),l=g(n.initialStep),r=g(!1),c=g(""),y=g([]),m=g(!1);let f=null;const v=g(""),d=g(""),h=g(""),k=g([]),C=g(new Set);let _=null;const S=g(""),z=g(""),q=g("");Ee(()=>{U("")});async function U(M){m.value=!0;try{const $=await os(M);y.value=$.filter(B=>B.id!==i.user?.id)}catch{y.value=[]}finally{m.value=!1}}function j(){f&&clearTimeout(f),f=setTimeout(()=>U(c.value),300)}async function ae(M){try{k.value=await os(M)}catch{k.value=[]}}function he(){_&&clearTimeout(_),_=setTimeout(()=>ae(h.value),300)}function ce(M){C.value.has(M)?C.value.delete(M):C.value.add(M)}async function oe(M){r.value=!0;try{const $=await ht({type:"direct",member_ids:[M]});o("chatCreated",$.id)}catch{a("Failed to start conversation")}finally{r.value=!1}}async function de(){if(!v.value.trim()){a("Group name is required");return}r.value=!0;try{const M=await ht({type:"group",title:v.value.trim(),description:d.value.trim(),member_ids:Array.from(C.value)});a("Group created!"),o("chatCreated",M.id)}catch{a("Failed to create group")}finally{r.value=!1}}async function I(){if(!S.value.trim()){a("Channel name is required");return}r.value=!0;try{const M=await ht({type:"channel",title:S.value.trim(),description:q.value.trim(),public_name:z.value.trim()||void 0,member_ids:[]});a("Channel created!"),o("chatCreated",M.id)}catch{a("Failed to create channel")}finally{r.value=!1}}return(M,$)=>(u(),p("div",{class:"modal-backdrop",onClick:$[14]||($[14]=le(B=>o("close"),["self"]))},[t("div",ud,[t("div",dd,[$[15]||($[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:$[0]||($[0]=B=>o("close"))},[F(b(Ye),{size:20})])]),t("div",vd,[l.value==="select"?(u(),p("div",md,[t("button",{class:"chat-type-card",onClick:$[1]||($[1]=B=>l.value="direct")},[t("span",fd,[F(b(Ns),{size:24})]),$[16]||($[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:$[2]||($[2]=B=>l.value="group")},[t("span",pd,[F(b(Un),{size:24})]),$[17]||($[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:$[3]||($[3]=B=>l.value="channel")},[t("span",hd,[F(b(Rs),{size:24})]),$[18]||($[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):P("",!0),l.value==="direct"?(u(),p("div",gd,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:$[4]||($[4]=B=>l.value="select")},[F(b(He),{size:16}),$[19]||($[19]=we(" Back ",-1))]),pe(t("input",{"onUpdate:modelValue":$[5]||($[5]=B=>c.value=B),class:"search-input",type:"search",placeholder:"Search users...",onInput:j},null,544),[[_e,c.value]]),t("div",yd,[m.value?(u(),p("div",bd,"Loading users...")):y.value.length===0?(u(),p("div",kd,"No users found.")):(u(!0),p(re,{key:2},ke(y.value,B=>(u(),p("div",{key:B.id,class:"user-pick-item",onClick:ue=>oe(B.id)},[F(Se,{name:B.display_name||B.username,url:B.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",wd,E(B.display_name||B.username),1),t("div",Cd,"@"+E(B.username),1)])],8,_d))),128))])])):P("",!0),l.value==="group"?(u(),p("div",$d,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:$[6]||($[6]=B=>l.value="select")},[F(b(He),{size:16}),$[20]||($[20]=we(" Back ",-1))]),t("div",Sd,[$[21]||($[21]=t("label",{class:"form-label"},"Group name",-1)),pe(t("input",{"onUpdate:modelValue":$[7]||($[7]=B=>v.value=B),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[_e,v.value]])]),t("div",Md,[$[22]||($[22]=t("label",{class:"form-label"},"Description (optional)",-1)),pe(t("textarea",{"onUpdate:modelValue":$[8]||($[8]=B=>d.value=B),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[_e,d.value]])]),t("div",xd,[$[23]||($[23]=t("label",{class:"form-label"},"Add members",-1)),pe(t("input",{"onUpdate:modelValue":$[9]||($[9]=B=>h.value=B),class:"search-input",type:"search",placeholder:"Search users...",onInput:he},null,544),[[_e,h.value]]),t("div",Ed,[(u(!0),p(re,null,ke(k.value,B=>(u(),p("div",{key:B.id,class:ve(["user-pick-item",{selected:C.value.has(B.id)}]),onClick:ue=>ce(B.id)},[F(Se,{name:B.display_name||B.username,url:B.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Id,[C.value.has(B.id)?(u(),J(b(As),{key:0,size:14,style:{"margin-right":"4px"}})):P("",!0),we(E(B.display_name||B.username),1)]),t("div",Ld,"@"+E(B.username),1)])],10,Td))),128))])]),t("div",Ad,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:de}," Create Group ",8,Dd)])])):P("",!0),l.value==="channel"?(u(),p("div",Rd,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:$[10]||($[10]=B=>l.value="select")},[F(b(He),{size:16}),$[24]||($[24]=we(" Back ",-1))]),t("div",Pd,[$[25]||($[25]=t("label",{class:"form-label"},"Channel name",-1)),pe(t("input",{"onUpdate:modelValue":$[11]||($[11]=B=>S.value=B),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[_e,S.value]])]),t("div",Od,[$[26]||($[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),pe(t("input",{"onUpdate:modelValue":$[12]||($[12]=B=>z.value=B),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[_e,z.value]]),$[27]||($[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",Nd,[$[28]||($[28]=t("label",{class:"form-label"},"Description (optional)",-1)),pe(t("textarea",{"onUpdate:modelValue":$[13]||($[13]=B=>q.value=B),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[_e,q.value]])]),t("div",Ud,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:I}," Create Channel ",8,Fd)])])):P("",!0)])])]))}}),Bd={class:"profile-info-list"},jd=["onClick"],Hd={class:"profile-info-item__content"},Vd={class:"profile-info-item__value"},Wd={class:"profile-info-item__label"},qd=se({__name:"ProfileInfoList",props:{username:{},bio:{},userId:{}},setup(e){const s=e,n=g(null),o=H(()=>{const a=[];return s.username&&a.push({icon:vi,label:"Username",value:`@${s.username}`,copyable:!0}),s.bio&&a.push({icon:Rn,label:"Bio",value:s.bio}),s.userId!=null&&a.push({icon:gi,label:"User ID",value:String(s.userId),copyable:!0}),a});async function i(a){try{await navigator.clipboard.writeText(a.replace(/^@/,""));const l=o.value.find(r=>r.value===a)?.label??null;n.value=l,setTimeout(()=>{n.value=null},1500)}catch{}}return(a,l)=>(u(),p("div",Bd,[(u(!0),p(re,null,ke(o.value,r=>(u(),p("div",{key:r.label,class:ve(["profile-info-item",{"profile-info-item--copyable":r.copyable}]),onClick:c=>r.copyable?i(r.value):void 0},[(u(),J(Ve(r.icon),{class:"profile-info-item__icon",size:20,"stroke-width":1.8})),t("div",Hd,[t("span",Vd,E(r.value),1),t("span",Wd,E(r.label),1)]),r.copyable?(u(),J(Ve(n.value===r.label?b(As):b(Ds)),{key:0,class:"profile-info-item__copy",size:16,"stroke-width":1.8})):P("",!0)],10,jd))),128))]))}}),Js=me(qd,[["__scopeId","data-v-bc174e9a"]]),Gd={class:"profile-media-tabs"},Kd={class:"profile-media-tabs__header"},Yd=["onClick"],Jd={key:0,class:"profile-media-tabs__count"},Xd={key:0,class:"profile-media-tabs__content"},Qd={class:"profile-media-tabs__empty"},Zd={class:"profile-media-tabs__empty-text"},ev=se({__name:"ProfileMediaTabs",setup(e){const s=[{key:"media",label:"Media",count:0,emptyIcon:Pn},{key:"files",label:"Files",count:0,emptyIcon:Rn},{key:"links",label:"Links",count:0,emptyIcon:yi},{key:"voice",label:"Voice",count:0,emptyIcon:Ps}],n=g("media"),o=H(()=>s.findIndex(l=>l.key===n.value)),i=H(()=>s[o.value]??s[0]),a=H(()=>({width:`${100/s.length}%`,transform:`translateX(${o.value*100}%)`}));return(l,r)=>(u(),p("div",Gd,[t("div",Kd,[(u(),p(re,null,ke(s,c=>t("button",{key:c.key,class:ve(["profile-media-tabs__tab",{"profile-media-tabs__tab--active":n.value===c.key}]),onClick:y=>n.value=c.key},[we(E(c.label)+" ",1),c.count!==void 0?(u(),p("span",Jd,E(c.count),1)):P("",!0)],10,Yd)),64)),t("div",{class:"profile-media-tabs__indicator",style:rt(a.value)},null,4)]),i.value?(u(),p("div",Xd,[t("div",Qd,[(u(),J(Ve(i.value.emptyIcon),{size:40,"stroke-width":1.2,class:"profile-media-tabs__empty-icon"})),t("span",Zd," No "+E(i.value.label.toLowerCase())+" yet ",1)])])):P("",!0)]))}}),tv=me(ev,[["__scopeId","data-v-bb3b131e"]]),nv={class:"modal profile-modal profile-modal--self"},sv={key:"view"},av={class:"profile-header"},iv={class:"profile-header__content"},ov={class:"profile-header__info"},lv={class:"profile-name"},rv={class:"profile-modal-body"},cv={key:"edit"},uv={class:"profile-edit-header"},dv={class:"profile-modal-body profile-modal-body--scrollable"},vv={class:"profile-avatar-section profile-avatar-upload-section"},mv={class:"profile-avatar-overlay"},fv={class:"profile-info-list"},pv={class:"form-group"},hv={class:"form-group"},gv={key:0,class:"form-hint form-error"},yv={class:"form-group"},bv=se({__name:"ProfileModal",emits:["close"],setup(e,{emit:s}){const n=s,o=Pe(),{showToast:i}=Ae(),a=g("view"),l=g("profile-slide-left"),r=g(""),c=g(""),y=g(""),m=g(""),f=g(null);function v(){o.user&&(r.value=o.user.display_name||"",c.value=o.user.username,y.value=o.user.bio||""),m.value=""}function d(){v(),l.value="profile-slide-left",a.value="edit"}function h(){l.value="profile-slide-right",a.value="view"}async function k(){const _=f.value?.files?.[0];if(_){try{const S=await Pt(_),z=await ii(S.id);o.updateUser({avatar_url:z.avatar_url}),i("Avatar updated!")}catch{i("Upload failed")}f.value&&(f.value.value="")}}async function C(){if(m.value="",!o.user)return;const _={display_name:r.value.trim(),bio:y.value.trim()};c.value.trim()&&c.value.trim()!==o.user.username&&(_.username=c.value.trim());try{const S=await ai(o.user.id,_);o.updateUser({display_name:S.display_name,username:S.username}),i("Profile saved!"),n("close")}catch(S){S.response?.status===409?m.value="Username already taken":i("Save failed")}}return(_,S)=>(u(),p("div",{class:"modal-backdrop profile-backdrop",onClick:S[5]||(S[5]=le(z=>n("close"),["self"]))},[t("div",nv,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:S[0]||(S[0]=z=>n("close"))},[F(b(Ye),{size:20,"stroke-width":2})]),a.value==="view"?(u(),p("button",{key:0,class:"icon-btn profile-edit-btn","aria-label":"Edit profile",onClick:d},[F(b(Nn),{size:18,"stroke-width":2})])):P("",!0),F(Dn,{name:l.value,mode:"out-in"},{default:un(()=>[a.value==="view"?(u(),p("div",sv,[t("div",av,[S[6]||(S[6]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",iv,[F(Se,{name:b(o).user?.display_name||b(o).user?.username||"?",url:b(o).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",ov,[t("div",lv,[we(E(b(o).user?.display_name||b(o).user?.username||"?")+" ",1),b(o).user?.is_admin?(u(),J(qn,{key:0})):P("",!0)])])])]),t("div",rv,[F(Js,{username:b(o).user?.username,bio:b(o).user?.bio,"user-id":b(o).user?.id},null,8,["username","bio","user-id"]),F(tv)])])):(u(),p("div",cv,[t("div",uv,[t("button",{class:"icon-btn","aria-label":"Back",onClick:h},[F(b(He),{size:20,"stroke-width":2})]),S[7]||(S[7]=t("span",{class:"profile-edit-header__title"},"Edit Profile",-1))]),t("div",dv,[t("div",vv,[t("div",{class:"profile-avatar-upload-wrap",onClick:S[1]||(S[1]=z=>f.value?.click())},[F(Se,{name:r.value||b(o).user?.username||"?",url:b(o).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",mv,[F(b(Ls),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",class:"hidden",onChange:k},null,544)]),t("div",fv,[t("div",pv,[S[8]||(S[8]=t("label",{class:"form-label"},"Display name",-1)),pe(t("input",{"onUpdate:modelValue":S[2]||(S[2]=z=>r.value=z),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[_e,r.value]])]),t("div",hv,[S[9]||(S[9]=t("label",{class:"form-label"},"Username",-1)),pe(t("input",{"onUpdate:modelValue":S[3]||(S[3]=z=>c.value=z),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[_e,c.value]]),m.value?(u(),p("small",gv,E(m.value),1)):P("",!0)]),t("div",yv,[S[10]||(S[10]=t("label",{class:"form-label"},"Bio",-1)),pe(t("textarea",{"onUpdate:modelValue":S[4]||(S[4]=z=>y.value=z),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[_e,y.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:C},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:h},"Cancel")])])]))]),_:1},8,["name"])])]))}}),kv=me(bv,[["__scopeId","data-v-7fb8ac23"]]),_v={class:"profile-actions"},wv=["disabled","onClick"],Cv={class:"profile-action-btn__circle"},$v={class:"profile-action-btn__label"},Sv=se({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:s}){const n=e,o=s,i=H(()=>{const a=[{icon:_i,label:"Message",event:"message"}];return n.showMute!==!1&&a.push({icon:Is,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&a.push({icon:hi,label:"More",event:"more"}),a});return(a,l)=>(u(),p("div",_v,[(u(!0),p(re,null,ke(i.value,r=>(u(),p("button",{key:r.label,class:ve(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:c=>o(r.event)},[t("span",Cv,[(u(),J(Ve(r.icon),{size:22,"stroke-width":1.8}))]),t("span",$v,E(r.label),1)],10,wv))),128))]))}}),Mv=me(Sv,[["__scopeId","data-v-a16c1098"]]),xv={class:"modal profile-modal"},Ev={key:0,class:"profile-modal-body"},Tv={class:"profile-header"},Iv={class:"profile-header__content"},Lv={class:"profile-header__info"},Av={class:"profile-name"},Dv={class:"profile-modal-body"},Rv={class:"profile-media-tabs"},Pv=["onClick"],Ov={class:"profile-media-empty"},Nv={key:2,class:"profile-modal-body"},Uv=se({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:s}){const n=e,o=s,i=xe(),{showToast:a}=Ae(),l=g(null),r=g(!0),c=g(!1),y=["Media","Files","Links"],m=g("Media"),f=H(()=>l.value?i.isUserOnline(l.value.id):!1),v=H(()=>{if(f.value)return"online";if(!l.value)return"offline";const h=i.getUserPresence(l.value.id);return h?.lastSeenAt?Us(h.lastSeenAt):h?.lastSeenBucket?`last seen ${h.lastSeenBucket}`:"offline"});Ee(async()=>{try{const h=await Ts(n.username);l.value=h;const k=h;k.is_online===!0?i.setUserOnline(h.id):k.is_online===!1&&i.setUserOffline(h.id,k.last_activity)}catch{l.value=null}finally{r.value=!1}});function d(){c.value=!c.value,a(c.value?"User muted":"User unmuted")}return(h,k)=>(u(),p("div",{class:"modal-backdrop profile-backdrop",onClick:k[2]||(k[2]=le(C=>o("close"),["self"]))},[t("div",xv,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:k[0]||(k[0]=C=>o("close"))},[F(b(Ye),{size:20,"stroke-width":2})]),r.value?(u(),p("div",Ev,[...k[3]||(k[3]=[t("div",{class:"profile-loading"},[t("p",null,"Loading...")],-1)])])):l.value?(u(),p(re,{key:1},[t("div",Tv,[k[4]||(k[4]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",Iv,[F(Se,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:f.value,size:"xxl"},null,8,["name","url","online"]),t("div",Lv,[t("div",Av,[we(E(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(u(),J(qn,{key:0})):P("",!0)]),t("div",{class:ve(["profile-status",{"profile-status--online":f.value}])},E(v.value),3)])])]),t("div",Dv,[F(Mv,{muted:c.value,"show-more":!1,onMessage:k[1]||(k[1]=C=>o("message",l.value.username)),onMute:d},null,8,["muted"]),k[5]||(k[5]=t("div",{class:"profile-divider"},null,-1)),F(Js,{username:l.value.username,bio:l.value.bio,"user-id":l.value.id},null,8,["username","bio","user-id"]),t("div",Rv,[(u(),p(re,null,ke(y,C=>t("button",{key:C,class:ve(["profile-media-tab",{"profile-media-tab--active":m.value===C}]),onClick:_=>m.value=C},E(C),11,Pv)),64))]),t("div",Ov,[F(b(Pn),{size:32,"stroke-width":1.5}),t("span",null,"No "+E(m.value.toLowerCase())+" yet",1)])])],64)):(u(),p("div",Nv,[...k[6]||(k[6]=[t("div",{class:"profile-loading"},[t("p",null,"User not found")],-1)])]))])]))}}),Fv=me(Uv,[["__scopeId","data-v-19d7424b"]]),zv={class:"modal",style:{"max-width":"420px"}},Bv={class:"modal-header"},jv={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},Hv=se({__name:"DownloadModal",emits:["close"],setup(e,{emit:s}){const n=s,o=navigator.userAgent.toLowerCase(),i=o.includes("win"),a=o.includes("mac")&&!o.includes("iphone")&&!o.includes("ipad"),l=H(()=>i?"Windows":a?"macOS":null);function r(){i&&(window.location.href="https://downloads.behappy.rest/BeHappy_0.1.0_x64-setup.exe")}return(c,y)=>(u(),p("div",{class:"modal-backdrop",onClick:y[1]||(y[1]=le(m=>n("close"),["self"]))},[t("div",zv,[t("div",Bv,[y[2]||(y[2]=t("h2",{class:"modal-title"},"Download BeHappy",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:y[0]||(y[0]=m=>n("close"))},[F(b(Ye),{size:20})])]),t("div",jv,[l.value?(u(),p("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+E(l.value),1)):P("",!0),y[3]||(y[3]=t("details",null,[t("summary",{style:{cursor:"pointer",color:"var(--accent)"}},"Other platforms"),t("div",{style:{display:"flex","flex-direction":"column",gap:"8px","margin-top":"8px"}},[t("a",{href:"https://downloads.behappy.rest/BeHappy_0.1.0_x64-setup.exe",class:"btn btn-ghost btn-full",download:""},"Windows installer (.exe)")])],-1)),y[4]||(y[4]=t("p",{style:{"font-size":"0.8rem",color:"var(--text-muted)",margin:"0"}}," Files not available yet? Check back soon. ",-1))])])]))}}),Vv={class:"modal",style:{"max-width":"400px"}},Wv={class:"modal-header"},qv={class:"modal-body",style:{"text-align":"center"}},Gv={key:0},Kv={style:{"font-size":"1.25rem","font-weight":"700"}},Yv={style:{color:"var(--text-muted)","margin-top":".5rem"}},Jv={class:"profile-avatar-section"},Xv={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},Qv={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},Zv={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},em={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},tm=["disabled"],nm=se({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:s}){const n=e,o=s,{showToast:i}=Ae(),a=g(null),l=g(!0),r=g(!1),c=g(""),y=g("");Ee(async()=>{if(!n.token){c.value="Invalid Link",y.value="No invite token provided.",l.value=!1;return}try{a.value=await Ta(n.token)}catch(f){f.response?.status===410?(c.value="Invite Revoked",y.value="This invite link has been revoked."):(c.value="Invite Not Found",y.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function m(){r.value=!0;try{const f=await Ia(n.token);i(f.already_member?"You are already a member":"Joined successfully!"),o("joined",f.chat_id)}catch(f){i(f.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(f,v)=>(u(),p("div",{class:"modal-backdrop",onClick:v[2]||(v[2]=le(d=>o("close"),["self"]))},[t("div",Vv,[t("div",Wv,[v[3]||(v[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:v[0]||(v[0]=d=>o("close"))},"âœ•")]),t("div",qv,[l.value?(u(),p("p",Gv,"Loading invite preview...")):y.value?(u(),p(re,{key:1},[t("h2",Kv,E(c.value),1),t("p",Yv,E(y.value),1)],64)):a.value?(u(),p(re,{key:2},[t("div",Jv,[F(Se,{name:a.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",Xv,E(a.value.title||a.value.type||"Chat"),1),a.value.description?(u(),p("p",Qv,E(a.value.description),1)):P("",!0),a.value.member_count?(u(),p("p",Zv,E(a.value.member_count)+" members ",1)):P("",!0),t("div",em,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:m},E(r.value?"Joining...":"Join"),9,tm),t("button",{class:"btn btn-ghost",onClick:v[1]||(v[1]=d=>o("close"))},"Cancel")])],64)):P("",!0)])])]))}}),sm={class:"modal modal-wide settings-modal"},am={class:"modal-header"},im={class:"modal-body"},om={class:"settings-profile-header"},lm={class:"settings-profile-info"},rm={class:"settings-display-name"},cm={class:"settings-username"},um={class:"settings-group"},dm={class:"settings-section-title"},vm={class:"menu-item menu-item--setting"},mm={class:"settings-group"},fm={class:"settings-section-title"},pm=["aria-checked"],hm={class:"settings-group"},gm={class:"settings-section-title"},ym={class:"menu-item menu-item--setting"},bm={class:"settings-group"},km={class:"settings-section-title"},_m={class:"menu-item menu-item--setting"},wm=["aria-checked"],Cm={class:"settings-actions"},$m=se({__name:"SettingsView",emits:["close"],setup(e,{emit:s}){const n=s,o=Pe(),i=Mt(),{showToast:a}=Ae(),l=g("light"),r=g(!0),c=g("en"),y=g("everyone"),m=g(!0);Ue(r,async v=>{v&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(r.value=!1,a("Notifications blocked by browser"))}),Ee(()=>{l.value=i.theme,r.value=i.notificationsEnabled,c.value=i.language,y.value=i.lastSeenVisibility,m.value=i.readReceiptsEnabled});async function f(){try{await i.saveSettings({theme:l.value,notifications_enabled:r.value,language:c.value,last_seen_visibility:y.value,read_receipts_enabled:m.value}),a("Settings saved"),n("close")}catch{a("Failed to save settings")}}return(v,d)=>(u(),p("div",{class:"modal-backdrop",onClick:d[8]||(d[8]=le(h=>n("close"),["self"]))},[t("div",sm,[t("div",am,[t("button",{class:"icon-btn","aria-label":"Back",onClick:d[0]||(d[0]=h=>n("close"))},[F(b(He),{size:20,"stroke-width":2})]),d[9]||(d[9]=t("span",{class:"modal-title"},"Settings",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:d[1]||(d[1]=h=>n("close"))},[F(b(Ye),{size:20,"stroke-width":2})])]),t("div",im,[t("div",om,[F(Se,{name:b(o).user?.display_name||b(o).user?.username||"?",url:b(o).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",lm,[t("div",rm,E(b(o).user?.display_name||b(o).user?.username||"---"),1),t("div",cm,"@"+E(b(o).user?.username||"---"),1)])]),d[24]||(d[24]=t("div",{class:"settings-divider"},null,-1)),t("div",um,[t("div",dm,[F(b(vs),{size:18,"stroke-width":1.8}),d[10]||(d[10]=t("span",null,"Appearance",-1))]),t("div",vm,[F(b(vs),{class:"menu-item__icon",size:24,"stroke-width":1.8}),d[12]||(d[12]=t("span",{class:"menu-item__label"},"Theme",-1)),pe(t("select",{"onUpdate:modelValue":d[2]||(d[2]=h=>l.value=h),class:"form-input form-select settings-select"},[...d[11]||(d[11]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[pn,l.value]])])]),d[25]||(d[25]=t("div",{class:"settings-divider"},null,-1)),t("div",mm,[t("div",fm,[F(b(cs),{size:18,"stroke-width":1.8}),d[13]||(d[13]=t("span",null,"Notifications",-1))]),t("div",{class:"menu-item menu-item--toggle",onClick:d[3]||(d[3]=h=>r.value=!r.value)},[F(b(cs),{class:"menu-item__icon",size:24,"stroke-width":1.8}),d[15]||(d[15]=t("span",{class:"menu-item__label"},"Notifications",-1)),t("span",{class:ve(["toggle-status",{"toggle-status--on":r.value}])},E(r.value?"Enabled":"Disabled"),3),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":r.value}]),role:"switch","aria-checked":r.value},[...d[14]||(d[14]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,pm)])]),d[26]||(d[26]=t("div",{class:"settings-divider"},null,-1)),t("div",hm,[t("div",gm,[F(b(ds),{size:18,"stroke-width":1.8}),d[16]||(d[16]=t("span",null,"Language",-1))]),t("div",ym,[F(b(ds),{class:"menu-item__icon",size:24,"stroke-width":1.8}),d[18]||(d[18]=t("span",{class:"menu-item__label"},"Language",-1)),pe(t("select",{"onUpdate:modelValue":d[4]||(d[4]=h=>c.value=h),class:"form-input form-select settings-select"},[...d[17]||(d[17]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[pn,c.value]])])]),d[27]||(d[27]=t("div",{class:"settings-divider"},null,-1)),t("div",bm,[t("div",km,[F(b(hn),{size:18,"stroke-width":1.8}),d[19]||(d[19]=t("span",null,"Privacy",-1))]),t("div",_m,[(u(),J(Ve(y.value==="nobody"?b(us):b(hn)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),d[21]||(d[21]=t("span",{class:"menu-item__label"},"Last Seen & Online",-1)),pe(t("select",{"onUpdate:modelValue":d[5]||(d[5]=h=>y.value=h),class:"form-input form-select settings-select"},[...d[20]||(d[20]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[pn,y.value]])]),t("div",{class:"menu-item menu-item--toggle",onClick:d[6]||(d[6]=h=>m.value=!m.value)},[(u(),J(Ve(m.value?b(hn):b(us)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),d[23]||(d[23]=t("span",{class:"menu-item__label"},"Read Receipts",-1)),t("span",{class:ve(["toggle-status",{"toggle-status--on":m.value}])},E(m.value?"Enabled":"Disabled"),3),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":m.value}]),role:"switch","aria-checked":m.value},[...d[22]||(d[22]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,wm)])]),d[28]||(d[28]=t("div",{class:"settings-divider"},null,-1)),t("div",Cm,[t("button",{class:"btn btn-primary",onClick:f},"Save Settings"),t("button",{class:"btn btn-ghost",onClick:d[7]||(d[7]=h=>n("close"))},"Cancel")])])])]))}}),Sm=me($m,[["__scopeId","data-v-3b2634a6"]]),Mm=se({__name:"ContextMenu",setup(e){const s=xe(),{showToast:n}=Ae(),{showConfirm:o}=$a(),i=g(!1),a=g(0),l=g(0),r=g(null),c=H(()=>r.value?s.chats.find(k=>k.id===r.value)??null:null);function y(k){r.value=k.detail.chatId,a.value=k.detail.x,l.value=k.detail.y,i.value=!0}function m(){i.value&&(i.value=!1,r.value=null)}Ee(()=>{window.addEventListener("show-context-menu",y),document.addEventListener("click",m)}),Fe(()=>{window.removeEventListener("show-context-menu",y),document.removeEventListener("click",m)});async function f(){if(r.value){i.value=!1;try{await s.toggleFavorite(r.value)}catch{n("Failed to update favorite")}}}async function v(){if(r.value){i.value=!1;try{await s.toggleMute(r.value)}catch{n("Failed to update mute")}}}async function d(){if(!(!r.value||(i.value=!1,!await o({title:"Leave Chat",message:"Leave this chat?",confirmLabel:"Leave",danger:!0}))))try{await s.leave(r.value),n("Left chat")}catch{n("Failed to leave chat")}}async function h(){if(!(!r.value||(i.value=!1,!await o({title:"Delete Chat",message:"Delete this chat? All messages will be permanently removed.",confirmLabel:"Delete",danger:!0}))))try{await s.deleteChat(r.value),n("Chat deleted")}catch{n("Failed to delete chat")}}return(k,C)=>i.value?(u(),p("div",{key:0,class:"context-menu",style:rt({left:a.value+"px",top:l.value+"px"})},[t("button",{class:"ctx-item",onClick:f},E(c.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:v},E(c.value?.is_muted?"Unmute":"Mute"),1),c.value&&c.value.type!=="direct"?(u(),p("button",{key:0,class:"ctx-item ctx-leave",onClick:d}," Leave chat ")):P("",!0),t("button",{class:"ctx-item ctx-delete",onClick:h}," Delete chat ")],4)):P("",!0)}}),ws=240,xm=.5,Em=se({__name:"MessengerView",setup(e){const s=Sa(),n=Ss(),o=Pe(),i=xe(),a=Mt(),l=tt(),{showToast:r}=Ae(),{connect:c,disconnect:y,sendTyping:m}=si();pt("sendTyping",m);const f=g(!1),v=g(!1),d=g("select"),h=g(!1),k=g(!1),C=g(!1),_=g(null),S=g(null),z=g([]),q=g(null);pt("stickers",z),pt("pendingScrollMessageId",q),Ee(async()=>{await a.loadSettings();try{z.value=await oi()}catch{}await i.loadChats(),c(),U()}),Fe(()=>{y()}),Ue(()=>s.path,()=>{U()}),Ue(()=>i.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function U(){const K=s.path;if(K.startsWith("/@")){const W=s.params.username;W&&(_.value=W)}else if(K.startsWith("/u/")){const W=s.params.id;if(W)try{const x=await Es(parseInt(W));_.value=x.username}catch{r("User not found")}}else if(K.startsWith("/dm/")){const W=s.params.id;W&&await j(W)}else if(K.startsWith("/c/")){const W=s.params.chatIdOrName||s.params.name,x=s.params.messageId?parseInt(s.params.messageId):null;if(W)if(/^\d+$/.test(W)){const N=parseInt(W);x?await he(N,x):i.setActiveChat(N)}else await ae(W)}}async function j(K){try{let W;if(K.startsWith("@")){const R=K.substring(1);W=(await Ts(R)).id}else W=parseInt(K);const x=await ht({type:"direct",member_ids:[W]});await i.loadChats(),i.setActiveChat(x.id)}catch{r("Failed to open conversation")}}async function ae(K){try{const W=await Aa(K);i.chats.find(R=>R.id===W.id)?i.setActiveChat(W.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function he(K,W){if(!i.chats.find(R=>R.id===K)){r("Chat not found");return}i.setActiveChat(K),await Ie(),q.value=W}const ce=parseInt(localStorage.getItem("sidebar-width")||"360",10);ce>=ws&&document.documentElement.style.setProperty("--sidebar-width",ce+"px");function oe(K){K.preventDefault();const W=K.currentTarget;W.setPointerCapture(K.pointerId);const x=N=>{const Q=window.innerWidth*xm,Y=Math.min(Q,Math.max(ws,N.clientX));document.documentElement.style.setProperty("--sidebar-width",Y+"px")},R=()=>{W.removeEventListener("pointermove",x),W.removeEventListener("pointerup",R);const N=getComputedStyle(document.documentElement).getPropertyValue("--sidebar-width").trim();localStorage.setItem("sidebar-width",parseInt(N,10).toString())};W.addEventListener("pointermove",x),W.addEventListener("pointerup",R)}function de(K){i.setActiveChat(K),n.replace("/app")}function I(){i.setActiveChat(null)}function M(){f.value=!1,h.value=!0}function $(){f.value=!1,k.value=!0}function B(){f.value=!1,d.value="group",v.value=!0}function ue(){f.value=!1,d.value="channel",v.value=!0}async function Ce(){if(f.value=!1,!!o.user)try{const K=await ht({type:"direct",member_ids:[o.user.id]});await i.loadChats(),i.setActiveChat(K.id)}catch{r("Failed to open Saved Messages")}}function T(K){_.value=K}async function A(K){_.value=null,await j("@"+K)}async function G(K){v.value=!1,await i.loadChats(),i.setActiveChat(K)}async function V(K){S.value=null,await i.loadChats(),i.setActiveChat(K)}function X(K){const W=K.target?.closest("a");if(!W)return;const x=W.getAttribute("href");if(!x)return;let R;try{R=new URL(x,window.location.origin)}catch{return}if(R.origin!==window.location.origin){K.preventDefault(),K.stopPropagation(),window.open(R.href,"_blank");return}K.preventDefault(),K.stopPropagation();const N=R.pathname,Q=N.match(/^\/join\/([^/]+)$/);if(Q){S.value=Q[1]??null;return}if(N.startsWith("/@")||N.startsWith("/u/")||N.startsWith("/dm/")||N.startsWith("/c/")){n.push(N);return}n.push(N)}function ie(K){if(K.key==="Escape"){if(S.value){S.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if(_.value){_.value=null;return}if(v.value){v.value=!1;return}if(h.value){h.value=!1;return}if(k.value){k.value=!1;return}if(C.value){C.value=!1;return}if(f.value){f.value=!1;return}if(i.activeChatId!==null){I();return}}}return Ee(()=>{document.addEventListener("keydown",ie),document.addEventListener("click",X,!0)}),Fe(()=>{document.removeEventListener("keydown",ie),document.removeEventListener("click",X,!0)}),(K,W)=>(u(),p("div",{class:ve(["layout",{"chat-open":!!b(i).activeChatId}])},[F(cd,{open:f.value,onClose:W[0]||(W[0]=x=>f.value=!1),onOpenProfile:M,onOpenSettings:$,onOpenNewGroup:B,onOpenNewChannel:ue,onOpenFavorites:Ce,onOpenDownload:W[1]||(W[1]=x=>C.value=!0)},null,8,["open"]),t("div",{class:ve(["drawer-overlay",{visible:f.value}]),onClick:W[2]||(W[2]=x=>f.value=!1)},null,2),F(eo,{onOpenDrawer:W[3]||(W[3]=x=>f.value=!0),onOpenNewChat:W[4]||(W[4]=x=>{d.value="select",v.value=!0}),onSelectChat:de}),t("div",{class:"resize-handle",onPointerdown:oe},null,32),F(Wu,{onBack:I,onOpenUserProfile:T}),v.value?(u(),J(zd,{key:0,"initial-step":d.value,onClose:W[5]||(W[5]=x=>v.value=!1),onChatCreated:G},null,8,["initial-step"])):P("",!0),h.value?(u(),J(kv,{key:1,onClose:W[6]||(W[6]=x=>h.value=!1)})):P("",!0),k.value?(u(),J(Sm,{key:2,onClose:W[7]||(W[7]=x=>k.value=!1)})):P("",!0),_.value?(u(),J(Fv,{key:3,username:_.value,onClose:W[8]||(W[8]=x=>_.value=null),onMessage:A},null,8,["username"])):P("",!0),C.value?(u(),J(Hv,{key:4,onClose:W[9]||(W[9]=x=>C.value=!1)})):P("",!0),S.value?(u(),J(nm,{key:5,token:S.value,onClose:W[10]||(W[10]=x=>S.value=null),onJoined:V},null,8,["token"])):P("",!0),F(Mm)],2))}}),Lm=Object.freeze(Object.defineProperty({__proto__:null,default:Em},Symbol.toStringTag,{value:"Module"}));export{Lm as M,me as _};
