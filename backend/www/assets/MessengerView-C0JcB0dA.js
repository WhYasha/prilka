import{k as q,l as Ce,r as h,m as V,n as _e,u as he,p as Re,d as G,o as u,c as p,a as e,t as P,w as Q,q as Pe,s as ne,g as O,b as A,f as ie,x as _,e as Y,v as ae,F as K,y as oe,z as W,A as Ie,B as xe,C as At,D as le,E as ke,G as et,H as me,I as ue,T as lt,h as Ve,J as rt,K as ct,L as ut,M as Le,N as Ue,j as dt,O as tt,P as Bt,Q as zt}from"./index-DAVvEVZi.js";import{_ as re,l as vt,c as mt,r as ft}from"./invites-C7FQIrcG.js";async function Ot(){const{data:t}=await q.get("/chats");return t}async function pt(t){const{data:a}=await q.get(`/chats/${t}`);return a}async function Rt(t){const{data:a}=await q.get(`/chats/by-name/${encodeURIComponent(t)}`);return a}async function Te(t){const{data:a}=await q.post("/chats",t);return a}async function Vt(t){await q.post(`/chats/${t}/favorite`)}async function jt(t){await q.delete(`/chats/${t}/favorite`)}async function Ht(t,a){await q.post(`/chats/${t}/mute`,{})}async function qt(t){await q.delete(`/chats/${t}/mute`)}async function Wt(t){await q.delete(`/chats/${t}/leave`)}async function Gt(t){await q.post(`/chats/${t}/read`)}async function Xt(t){await q.post(`/chats/${t}/pin`)}async function Yt(t){await q.delete(`/chats/${t}/pin`)}async function Zt(t){await q.post(`/chats/${t}/archive`)}async function Jt(t){await q.delete(`/chats/${t}/archive`)}async function Qt(t){const{data:a}=await q.get(`/chats/${t}/members`);return a}async function Kt(t){await q.delete(`/chats/${t}`)}async function en(t,a){const{data:o}=await q.patch(`/chats/${t}`,a);return o}const ce=Ce("chats",()=>{const t=h([]),a=h(null),o=h({}),l=h(new Set),n=V(()=>t.value.find(b=>b.id===a.value)??null),i=V(()=>[...t.value].sort((b,U)=>{if(b.is_pinned&&!U.is_pinned)return-1;if(!b.is_pinned&&U.is_pinned)return 1;if(b.is_favorite&&!U.is_favorite)return-1;if(!b.is_favorite&&U.is_favorite)return 1;const x=b.last_at||b.updated_at||"";return(U.last_at||U.updated_at||"").localeCompare(x)}));async function s(){try{t.value=await Ot()}catch(b){console.error("Failed to load chats",b)}}function r(b){if(a.value=b,b!==null){const U=t.value.find(x=>x.id===b);U&&U.unread_count>0&&(U.unread_count=0,Gt(b).catch(()=>{}))}}async function f(b){const U=t.value.find(x=>x.id===b);if(U)try{U.is_favorite?await jt(b):await Vt(b),U.is_favorite=!U.is_favorite}catch(x){throw console.error("Failed to toggle favorite",x),x}}async function d(b){const U=t.value.find(x=>x.id===b);if(U)try{U.is_muted?await qt(b):await Ht(b),U.is_muted=!U.is_muted}catch(x){throw console.error("Failed to toggle mute",x),x}}async function k(b){const U=t.value.find(x=>x.id===b);if(U)try{U.is_pinned?await Yt(b):await Xt(b),U.is_pinned=!U.is_pinned}catch(x){throw console.error("Failed to toggle pin",x),x}}async function m(b){const U=t.value.find(x=>x.id===b);if(U)try{U.is_archived?await Jt(b):await Zt(b),U.is_archived=!U.is_archived}catch(x){throw console.error("Failed to toggle archive",x),x}}async function c(b){await Wt(b),t.value=t.value.filter(U=>U.id!==b),a.value===b&&(a.value=null)}function w(b,U,x){const H=t.value.find(C=>C.id===b);H&&(H.last_message=U,H.last_at=x)}function y(b){const U=t.value.find(x=>x.id===b);U&&(U.unread_count=(U.unread_count||0)+1)}function v(b,U,x){o.value[b]||(o.value[b]={});const H=o.value[b][U];H&&clearTimeout(H.timer);const C=setTimeout(()=>{S(b,U)},3e3);o.value[b][U]={username:x,timer:C}}function S(b,U){if(o.value[b]){const x=o.value[b][U];x&&(clearTimeout(x.timer),delete o.value[b][U])}}function D(b){const U=o.value[b];return U?Object.values(U).map(x=>x.username):[]}function z(b){l.value=new Set([...l.value,b])}function I(b){const U=new Set(l.value);U.delete(b),l.value=U}function $(b){return l.value.has(b)}return{chats:t,activeChatId:a,activeChat:n,sortedChats:i,typingUsers:o,loadChats:s,setActiveChat:r,toggleFavorite:f,toggleMute:d,togglePin:k,toggleArchive:m,leave:c,updateChatLastMessage:w,incrementUnread:y,setTyping:v,clearTyping:S,getTypingUsernames:D,onlineUsers:l,setUserOnline:z,setUserOffline:I,isUserOnline:$}});async function tn(){const{data:t}=await q.get("/settings");return t}async function nn(t){await q.put("/settings",t)}const Fe=Ce("settings",()=>{const t=h(localStorage.getItem("theme")||"light"),a=h(!0),o=h("en");function l(s){t.value=s,document.body.setAttribute("data-theme",s),localStorage.setItem("theme",s)}async function n(){try{const s=await tn();l(s.theme||"light"),a.value=s.notifications_enabled,o.value=s.language||"en"}catch(s){console.error("Failed to load settings",s)}}async function i(s){await nn(s),s.theme&&l(s.theme),s.notifications_enabled!==void 0&&(a.value=s.notifications_enabled),s.language&&(o.value=s.language)}return document.body.setAttribute("data-theme",t.value),{theme:t,notificationsEnabled:a,language:o,applyTheme:l,loadSettings:n,saveSettings:i}}),Ee=Ce("selection",()=>{const t=h(new Set),a=h(!1),o=h(null),l=V(()=>t.value.size);function n(d,k){a.value=!0,o.value=d,t.value=new Set(k!=null?[k]:[])}function i(){a.value=!1,o.value=null,t.value=new Set}function s(d){const k=new Set(t.value);k.has(d)?k.delete(d):k.add(d),t.value=k,k.size===0&&i()}function r(){t.value=new Set}function f(d){return t.value.has(d)}return{selectedMessageIds:t,selectionMode:a,currentChatId:o,selectedCount:l,enterSelectionMode:n,exitSelectionMode:i,toggleMessage:s,clearSelection:r,isSelected:f}});async function De(t,a){const{data:o}=await q.get(`/chats/${t}/messages`,{params:a});return o}async function sn(t,a){const{data:o}=await q.post(`/chats/${t}/messages`,a);return o}async function an(t,a){await q.delete(`/chats/${t}/messages/${a}`)}async function on(t,a,o){const{data:l}=await q.put(`/chats/${t}/messages/${a}`,{content:o});return l}async function ln(t,a){const{data:o}=await q.post(`/chats/${t}/messages/forward`,a);return o}async function rn(t,a){const{data:o}=await q.post(`/chats/${t}/messages/${a}/pin`);return o}async function cn(t,a){await q.delete(`/chats/${t}/messages/${a}/pin`)}async function un(t){const{data:a}=await q.get(`/chats/${t}/pinned-message`);return a}async function dn(t,a,o){const{data:l}=await q.post(`/chats/${t}/messages/${a}/reactions`,{emoji:o});return l}async function vn(t,a){if(!a.length)return{};const{data:o}=await q.get(`/chats/${t}/reactions`,{params:{message_ids:a.join(",")}});return o}const Ne=Ce("messages",()=>{const t=h({}),a=h({}),o=h(null),l=h({}),n=h(new Set);async function i(C){const E=t.value[C];if(!E||E.length===0)return;const N=E.map(B=>B.id);try{const B=await vn(C,N);for(const j of E)j.reactions=B[String(j.id)]||void 0}catch(B){console.error("Failed to load reactions",B)}}async function s(C){o.value=C;try{const E=await De(C,{limit:50});t.value[C]=E,E.length>0&&(a.value[C]=Math.max(...E.map(N=>N.id))),await i(C)}catch(E){throw console.error("Failed to load messages",E),E}finally{o.value=null}}async function r(C){const E=a.value[C]||0;if(E===0)return[];try{const N=await De(C,{after_id:E,limit:50});if(N.length>0){t.value[C]||(t.value[C]=[]);const B=new Set(t.value[C].map(M=>M.id)),j=N.filter(M=>!B.has(M.id));t.value[C].push(...j),a.value[C]=Math.max(...N.map(M=>M.id)),await i(C)}return N}catch(N){return console.error("Failed to load newer messages",N),[]}}async function f(C){const E=t.value[C];if(!E||E.length===0)return[];const N=E[0];if(!N)return[];try{const B=await De(C,{before:N.created_at,limit:50});if(B.length>0){const j=new Set(E.map(F=>F.id)),M=B.filter(F=>!j.has(F.id));t.value[C]=[...M,...E],await i(C)}return B}catch(B){return console.error("Failed to load older messages",B),[]}}async function d(C,E,N){try{const B=await dn(C,E,N);k(C,E,B.action,N,!0)}catch(B){console.error("Failed to toggle reaction",B)}}function k(C,E,N,B,j){const M=t.value[C];if(!M)return;const F=M.find(de=>de.id===E);if(!F)return;F.reactions||(F.reactions=[]);const te=F.reactions.find(de=>de.emoji===B);N==="added"?te?(te.count++,j&&(te.me=!0)):F.reactions.push({emoji:B,count:1,me:j}):te&&(te.count--,j&&(te.me=!1),te.count<=0&&(F.reactions=F.reactions.filter(de=>de.emoji!==B))),F.reactions.length===0&&(F.reactions=void 0)}async function m(C,E,N="text",B){const j=await sn(C,{content:E,type:N,...B});return t.value[C]||(t.value[C]=[]),t.value[C].push(j),a.value[C]=Math.max(a.value[C]||0,j.id),j}function c(C,E){t.value[C]||(t.value[C]=[]),t.value[C].find(B=>B.id===E.id)||(t.value[C].push(E),a.value[C]=Math.max(a.value[C]||0,E.id))}async function w(C,E){try{await an(C,E),y(C,E)}catch(N){throw console.error("Failed to delete message",N),N}}function y(C,E){const N=t.value[C];N&&(t.value[C]=N.filter(B=>B.id!==E))}async function v(C,E,N){try{const B=await on(C,E,N);S(C,E,B.content,B.updated_at)}catch(B){throw console.error("Failed to edit message",B),B}}function S(C,E,N,B){const j=t.value[C];if(!j)return;const M=j.find(F=>F.id===E);M&&(M.content=N,M.is_edited=!0,B&&(M.updated_at=B))}async function D(C,E,N){try{const B=await ln(C,{from_chat_id:E,message_ids:N});for(const j of B)c(C,j);return B}catch(B){throw console.error("Failed to forward messages",B),B}}async function z(C){try{const E=await un(C);E&&E.message?l.value[C]={message:E.message,pinnedAt:E.pinned_at,pinnedBy:E.pinned_by}:l.value[C]=null}catch(E){console.error("Failed to load pinned message",E),l.value[C]=null}}async function I(C,E){try{const N=await rn(C,E);l.value[C]={message:N.message,pinnedAt:N.pinned_at,pinnedBy:N.pinned_by},n.value.delete(C)}catch(N){throw console.error("Failed to pin message",N),N}}async function $(C,E){try{await cn(C,E),l.value[C]=null}catch(N){throw console.error("Failed to unpin message",N),N}}function b(C,E,N,B){l.value[C]={message:B,pinnedAt:new Date().toISOString(),pinnedBy:N},n.value.delete(C)}function U(C){l.value[C]=null}function x(C){n.value.add(C)}function H(C){return t.value[C]||[]}return{messagesByChat:t,lastMsgId:a,loadingChat:o,loadMessages:s,loadNewer:r,loadOlder:f,sendMessage:m,pushMessage:c,getMessages:H,toggleReaction:d,applyReactionUpdate:k,deleteMessage:w,removeMessage:y,editMessage:v,applyMessageUpdate:S,forwardMessages:D,pinnedByChat:l,pinnedDismissed:n,loadPinnedMessage:z,pinMsg:I,unpinMsg:$,applyMessagePinned:b,applyMessageUnpinned:U,dismissPin:x}});function mn(t,a,o){if(!document.hidden||t.sender_id===o.user?.id||!Fe().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||a.chats.find(f=>f.id===t.chat_id)?.is_muted)return;const i=t.sender_display_name||t.sender_username||"Someone",s=t.message_type==="text"?t.content?.length>100?t.content.substring(0,100)+"...":t.content:`sent a ${t.message_type==="sticker"?"sticker":t.message_type==="voice"?"voice message":"file"}`,r=new Notification(i,{body:s,tag:`chat-${t.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),a.setActiveChat(t.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function fn(){const t=h(!1);let a=null,o=null,l=null,n=1e3,i=!1;function s(){const v=localStorage.getItem("access_token");return v?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws?token=${encodeURIComponent(v)}`:null}function r(){if(a&&(a.readyState===WebSocket.OPEN||a.readyState===WebSocket.CONNECTING))return;const v=s();v&&(i=!1,a=new WebSocket(v),a.onopen=()=>{t.value=!0,n=1e3;const S=localStorage.getItem("access_token");S&&a.send(JSON.stringify({type:"auth",token:S}));const D=ce();for(const z of D.chats)a.send(JSON.stringify({type:"subscribe",chat_id:z.id}));d()},a.onmessage=S=>{try{const D=JSON.parse(S.data);f(D)}catch{}},a.onclose=()=>{t.value=!1,k(),i||m()},a.onerror=()=>{})}function f(v){const S=Ne(),D=ce(),z=he();switch(v.type){case"message":{const I=v;S.pushMessage(I.chat_id,I),D.updateChatLastMessage(I.chat_id,I.content||(I.message_type==="sticker"?"Sticker":"Attachment"),I.created_at),I.chat_id!==D.activeChatId&&I.sender_id!==z.user?.id&&D.incrementUnread(I.chat_id),D.clearTyping(I.chat_id,I.sender_id),mn(I,D,z);break}case"typing":{const I=v.chat_id,$=v.user_id;if($!==z.user?.id){const b=v.username||"Someone";D.setTyping(I,$,b)}break}case"pong":break;case"presence":{const I=v.user_id,$=v.status;$==="online"?D.setUserOnline(I):$==="offline"&&D.setUserOffline(I);break}case"message_deleted":{const I=v.chat_id,$=v.message_id;S.removeMessage(I,$);break}case"message_updated":{const I=v.chat_id,$=v.message_id,b=v.content,U=v.updated_at;S.applyMessageUpdate(I,$,b,U);break}case"message_pinned":{const I=v.chat_id,$=v.message_id,b=v.pinned_by,U=v.message;S.applyMessagePinned(I,$,b,U);break}case"message_unpinned":{const I=v.chat_id;S.applyMessageUnpinned(I);break}case"reaction":{const I=v.chat_id,$=v.message_id,b=v.user_id,U=v.emoji,x=v.action;S.applyReactionUpdate(I,$,x,U,b===z.user?.id);break}}}function d(){k(),l=setInterval(()=>{a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"ping"}))},25e3)}function k(){l&&(clearInterval(l),l=null)}function m(){o||(o=setTimeout(()=>{o=null,r(),n=Math.min(n*2,3e4)},n))}function c(v){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"subscribe",chat_id:v}))}function w(v){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"typing",chat_id:v}))}function y(){i=!0,k(),o&&(clearTimeout(o),o=null),a&&(a.close(),a=null),t.value=!1}return _e(()=>{y()}),{connected:t,connect:r,disconnect:y,subscribeToChat:c,sendTyping:w}}async function pn(t){const{data:a}=await q.get(`/users/${t}`);return a}async function gt(t){const{data:a}=await q.get(`/users/by-username/${encodeURIComponent(t)}`);return a}async function nt(t){const{data:a}=await q.get("/users/search",{params:{q:t}});return a}async function gn(t,a){const{data:o}=await q.put(`/users/${t}`,a);return o}async function hn(t){const{data:a}=await q.put("/users/me/avatar",{file_id:t});return a}async function yn(){const{data:t}=await q.get("/stickers");return t}const bn=t=>{for(const a in t)if(a.startsWith("aria-")||a==="role"||a==="title")return!0;return!1};const st=t=>t==="";const kn=(...t)=>t.filter((a,o,l)=>!!a&&a.trim()!==""&&l.indexOf(a)===o).join(" ").trim();const at=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const wn=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,o,l)=>l?l.toUpperCase():o.toLowerCase());const _n=t=>{const a=wn(t);return a.charAt(0).toUpperCase()+a.slice(1)};var Me={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Cn=({name:t,iconNode:a,absoluteStrokeWidth:o,"absolute-stroke-width":l,strokeWidth:n,"stroke-width":i,size:s=Me.width,color:r=Me.stroke,...f},{slots:d})=>Re("svg",{...Me,...f,width:s,height:s,stroke:r,"stroke-width":st(o)||st(l)||o===!0||l===!0?Number(n||i||Me["stroke-width"])*24/Number(s):n||i||Me["stroke-width"],class:kn("lucide",f.class,...t?[`lucide-${at(_n(t))}-icon`,`lucide-${at(t)}`]:["lucide-icon"]),...!d.default&&!bn(f)&&{"aria-hidden":"true"}},[...a.map(k=>Re(...k)),...d.default?[d.default()]:[]]);const Z=(t,a)=>(o,{slots:l,attrs:n})=>Re(Cn,{...n,...o,iconNode:a,name:t},l);const we=Z("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const $n=Z("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const Mn=Z("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const ht=Z("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const xn=Z("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const Sn=Z("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const In=Z("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Tn=Z("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const Dn=Z("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const Ln=Z("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const je=Z("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const yt=Z("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const Un=Z("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const Pn=Z("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const Fn=Z("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const En=Z("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Nn=Z("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const An=Z("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Bn=Z("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const zn=Z("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const bt=Z("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const kt=Z("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const He=Z("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const ye=Z("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),On={class:"swipe-actions swipe-actions-left"},Rn={class:"chat-item-info"},Vn={class:"chat-item-top"},jn={class:"chat-item-name"},Hn={key:0,class:"pin-icon",title:"Pinned"},qn={key:1,class:"ci-channel"},Wn={key:2,class:"ci-group"},Gn={key:3,class:"mute-icon",title:"Muted"},Xn={class:"chat-item-time"},Yn={class:"chat-item-bottom"},Zn={class:"chat-item-preview"},Jn=["title"],Qn={class:"swipe-actions swipe-actions-right"},ot=70,Kn=G({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(t,{emit:a}){const o=t,l=ce(),n=V(()=>o.chat.type!=="direct"||!o.chat.other_user_id?null:l.isUserOnline(o.chat.other_user_id)||null),i=V(()=>(o.chat.unread_count??0)>0),s=a,r=V(()=>{const v=o.chat;return v.type==="channel"||v.type==="group"?v.title||v.name||"Untitled":v.other_display_name||v.other_username||v.title||v.name||"Chat"});function f(v){if(!v)return"";const S=new Date(v.endsWith("Z")?v:v+"Z"),D=new Date;return S.toDateString()===D.toDateString()?S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):S.toLocaleDateString([],{month:"short",day:"numeric"})}const d=h(0);let k=0,m=!1;function c(v){k=v.touches[0].clientX,m=!0}function w(v){if(!m)return;const S=v.touches[0].clientX-k;d.value=Math.max(-ot,Math.min(ot,S))}function y(){m=!1,d.value=0}return(v,S)=>(u(),p("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:c,onTouchmove:w,onTouchend:y},[e("div",On,[e("button",{class:"swipe-action swipe-pin",onClick:S[0]||(S[0]=D=>s("togglePin"))},P(t.chat.is_pinned?"Unpin":"Pin"),1)]),e("div",{class:ne(["chat-item",{active:t.active,"chat-item-unread":i.value}]),style:Pe({transform:`translateX(${d.value}px)`}),onClick:S[2]||(S[2]=D=>s("select")),onContextmenu:S[3]||(S[3]=Q(D=>s("contextmenu",D),["prevent"]))},[O(re,{name:r.value,url:t.chat.other_avatar_url,size:"sm",online:n.value},null,8,["name","url","online"]),e("div",Rn,[e("div",Vn,[e("span",jn,[t.chat.is_pinned?(u(),p("span",Hn,"ðŸ“Œ")):A("",!0),t.chat.type==="channel"?(u(),p("span",qn)):t.chat.type==="group"?(u(),p("span",Wn)):A("",!0),ie(" "+P(r.value)+" ",1),t.chat.is_muted?(u(),p("span",Gn,"ðŸ””")):A("",!0)]),e("span",Xn,P(f(t.chat.last_at||t.chat.updated_at)),1)]),e("div",Yn,[e("span",Zn,P(t.chat.last_message||""),1),t.chat.unread_count>0?(u(),p("span",{key:0,class:ne(["unread-badge",{"unread-badge-muted":t.chat.is_muted}])},P(t.chat.unread_count>99?"99+":t.chat.unread_count),3)):A("",!0)])]),e("button",{class:ne(["star-btn",{"star-active":t.chat.is_favorite}]),title:t.chat.is_favorite?"Unstar":"Star",onClick:S[1]||(S[1]=Q(D=>s("toggleFavorite"),["stop"]))},"â˜…",10,Jn)],38),e("div",Qn,[e("button",{class:"swipe-action swipe-mute",onClick:S[4]||(S[4]=D=>s("toggleMute"))},P(t.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),se=(t,a)=>{const o=t.__vccOpts||t;for(const[l,n]of a)o[l]=n;return o},Oe=se(Kn,[["__scopeId","data-v-455ebfed"]]),es={class:"sidebar"},ts={class:"sidebar-header"},ns={class:"search-wrap"},ss={class:"chat-list"},as={key:0,class:"empty-state-small"},os={key:0,class:"chat-section-label"},is={key:1,class:"chat-section-label"},ls={key:2,class:"chat-section-label"},rs=G({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(t,{emit:a}){const o=a,l=ce(),n=h(""),i=V(()=>{const c=n.value.toLowerCase(),w=l.sortedChats.filter(y=>!y.is_archived);return c?w.filter(y=>{const v=d(y).toLowerCase(),S=(y.other_username||"").toLowerCase();return v.includes(c)||S.includes(c)}):w}),s=V(()=>i.value.filter(c=>c.is_pinned&&!c.is_favorite)),r=V(()=>i.value.filter(c=>c.is_favorite&&!c.is_pinned)),f=V(()=>i.value.filter(c=>!c.is_favorite&&!c.is_pinned));function d(c){return c.type==="channel"||c.type==="group"?c.title||c.name||"Untitled":c.other_display_name||c.other_username||c.title||c.name||"Chat"}const k=h(null);Ie("contextChatId",k);function m(c,w){c.preventDefault(),k.value=w,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:c.clientX,y:c.clientY,chatId:w}}))}return(c,w)=>(u(),p("aside",es,[e("header",ts,[e("button",{class:"icon-btn","aria-label":"Menu",onClick:w[0]||(w[0]=y=>o("openDrawer"))},[O(_(Un),{size:20})]),e("div",ns,[Y(e("input",{"onUpdate:modelValue":w[1]||(w[1]=y=>n.value=y),class:"search-input",type:"search",placeholder:"Search chats..."},null,512),[[ae,n.value]])]),e("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:w[2]||(w[2]=y=>o("openNewChat"))},[O(_(Bn),{size:20})])]),e("div",ss,[i.value.length===0?(u(),p("div",as,[...w[3]||(w[3]=[ie(" No conversations yet.",-1),e("br",null,null,-1),ie("Click the pencil icon to start one. ",-1)])])):(u(),p(K,{key:1},[s.value.length>0?(u(),p("div",os,"Pinned")):A("",!0),(u(!0),p(K,null,oe(s.value,y=>(u(),W(Oe,{key:y.id,chat:y,active:y.id===_(l).activeChatId,onSelect:v=>o("selectChat",y.id),onToggleFavorite:v=>_(l).toggleFavorite(y.id),onTogglePin:v=>_(l).togglePin(y.id),onToggleMute:v=>_(l).toggleMute(y.id),onToggleArchive:v=>_(l).toggleArchive(y.id),onContextmenu:v=>m(v,y.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(u(),p("div",is,"Starred")):A("",!0),(u(!0),p(K,null,oe(r.value,y=>(u(),W(Oe,{key:y.id,chat:y,active:y.id===_(l).activeChatId,onSelect:v=>o("selectChat",y.id),onToggleFavorite:v=>_(l).toggleFavorite(y.id),onTogglePin:v=>_(l).togglePin(y.id),onToggleMute:v=>_(l).toggleMute(y.id),onToggleArchive:v=>_(l).toggleArchive(y.id),onContextmenu:v=>m(v,y.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(s.value.length>0||r.value.length>0)&&f.value.length>0?(u(),p("div",ls," All chats ")):A("",!0),(u(!0),p(K,null,oe(f.value,y=>(u(),W(Oe,{key:y.id,chat:y,active:y.id===_(l).activeChatId,onSelect:v=>o("selectChat",y.id),onToggleFavorite:v=>_(l).toggleFavorite(y.id),onTogglePin:v=>_(l).togglePin(y.id),onToggleMute:v=>_(l).toggleMute(y.id),onToggleArchive:v=>_(l).toggleArchive(y.id),onContextmenu:v=>m(v,y.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function cs(){const t=h(!1),a=h(0);let o=null,l=[],n=null;async function i(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const k=await navigator.mediaDevices.getUserMedia({audio:!0});l=[],a.value=0,o=new MediaRecorder(k),o.ondataavailable=m=>{m.data.size&&l.push(m.data)},o.start(),t.value=!0,n=setInterval(()=>{a.value++},1e3)}function s(){return new Promise((k,m)=>{if(!o||o.state!=="recording"){m(new Error("Not recording"));return}o.onstop=()=>{o?.stream&&o.stream.getTracks().forEach(S=>S.stop()),f(),t.value=!1;const c=o?.mimeType||"audio/webm",w=c.includes("ogg")?"ogg":"webm",y=new Blob(l,{type:c}),v=new File([y],`voice.${w}`,{type:c});k(v)},o.stop()})}function r(){o&&o.state==="recording"&&(o.onstop=()=>{o?.stream&&o.stream.getTracks().forEach(k=>k.stop())},o.stop()),f(),t.value=!1,a.value=0}function f(){n&&(clearInterval(n),n=null)}function d(k){const m=Math.floor(k/60),c=k%60;return`${m}:${String(c).padStart(2,"0")}`}return{isRecording:t,seconds:a,startRecording:i,stopRecording:s,cancelRecording:r,formatTime:d}}async function qe(t){const a=new FormData;a.append("file",t);const{data:o}=await q.post("/files",a);return o}const us={class:"pin-bar-content"},ds={class:"pin-bar-sender"},vs={class:"pin-bar-text"},ms=G({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(t){const a=t,o=V(()=>a.message.sender_display_name||a.message.sender_username||"Unknown"),l=V(()=>{const n=a.message;switch(n.message_type){case"sticker":return n.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return n.content||""}});return(n,i)=>(u(),p("div",{class:"pin-bar",onClick:i[1]||(i[1]=s=>n.$emit("click"))},[i[2]||(i[2]=e("span",{class:"pin-bar-icon"},"ðŸ“Œ",-1)),e("div",us,[e("span",ds,P(o.value),1),e("span",vs,P(l.value),1)]),e("button",{class:"pin-bar-close",onClick:i[0]||(i[0]=Q(s=>n.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}}),fs={class:"chat-header"},ps={class:"chat-header-name"},gs=G({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo"],setup(t,{emit:a}){const o=a,l=ce(),n=V(()=>l.activeChat),i=V(()=>{const m=n.value;return m?m.type==="channel"||m.type==="group"?m.title||m.name||"Untitled":m.other_display_name||m.other_username||m.title||m.name||"Chat":"---"}),s=V(()=>n.value?l.getTypingUsernames(n.value.id):[]),r=V(()=>s.value.length>0),f=V(()=>{const m=n.value;return!m||m.type!=="direct"||!m.other_user_id?!1:l.isUserOnline(m.other_user_id)}),d=V(()=>{if(s.value.length===1)return`${s.value[0]} is typing...`;if(s.value.length>1)return`${s.value.length} people typing...`;const m=n.value;if(!m)return"";if(m.type==="channel"){const c=m.member_count??0;return`${c} subscriber${c!==1?"s":""}`}if(m.type==="group"){const c=m.member_count??0;return`${c} member${c!==1?"s":""}`}return f.value?"online":m.other_username?"@"+m.other_username:""});function k(){const m=n.value;m&&(m.type==="channel"||m.type==="group"?o("openChannelInfo"):m.type==="direct"&&m.other_username&&o("openUserProfile",m.other_username))}return(m,c)=>(u(),p("header",fs,[e("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:c[0]||(c[0]=w=>o("back"))},"â†"),O(re,{class:"chat-header-avatar",name:i.value,url:n.value?.other_avatar_url,online:f.value,onClick:k},null,8,["name","url","online"]),e("div",{class:"chat-header-info",onClick:k},[e("div",ps,P(i.value),1),e("div",{class:ne(["chat-header-sub",{"typing-text":r.value,"online-text":f.value&&!r.value}])},P(d.value),3)])]))}}),hs={},ys={class:"admin-badge",title:"Admin"};function bs(t,a){return u(),p("span",ys,"âœ“")}const wt=se(hs,[["render",bs]]);function ks(t){const{delay:a=500,scrollThreshold:o=5,onLongPress:l,onCancel:n}=t,i=h(!1);let s=null,r=0,f=0,d=!1;function k(){s&&(clearTimeout(s),s=null)}function m(v){r=v.clientX,f=v.clientY,d=!1,i.value=!0,k(),s=setTimeout(()=>{d=!0,l(v)},a)}function c(v){if(!s)return;const S=v.clientX-r,D=v.clientY-f;(Math.abs(S)>o||Math.abs(D)>o)&&y()}function w(){k(),i.value=!1}function y(){k(),i.value=!1,d||n?.()}return{isPressed:i,onPointerDown:m,onPointerUp:w,onPointerMove:c}}const ws=["data-message-id"],_s={key:0,class:"selection-checkbox"},Cs=["checked"],$s={key:1,class:"msg-sender-name"},Ms={class:"msg-content-wrap"},xs={class:"msg-reply-quote-name"},Ss={class:"msg-reply-quote-text"},Is={key:1,class:"msg-bubble sticker-bubble"},Ts=["src","alt"],Ds={key:2,class:"msg-bubble"},Ls={class:"voice-player"},Us=["src"],Ps={key:0,class:"voice-dur"},Fs=["innerHTML"],Es={key:4,class:"reaction-chips"},Ns=["onClick"],As={class:"reaction-emoji"},Bs={class:"reaction-count"},zs={class:"msg-time"},Os={key:0,class:"msg-edited-label"},Rs=G({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(t,{emit:a}){const o=t,l=a,n=Ee(),i=ce(),s=V(()=>n.isSelected(o.message.id)),{onPointerDown:r,onPointerUp:f,onPointerMove:d}=ks({delay:500,onLongPress(x){c(x.clientX,x.clientY)}}),k={onPointerdown:r,onPointerup:f,onPointermove:d};function m(x){if(n.selectionMode){n.toggleMessage(o.message.id);return}c(x.clientX,x.clientY)}function c(x,H){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:o.message.id,chatId:i.activeChatId,text:o.message.content||"",messageType:o.message.message_type,senderId:o.message.sender_id,senderName:o.message.sender_display_name||o.message.sender_username||"",x,y:H}}))}function w(){n.selectionMode&&n.toggleMessage(o.message.id)}const y=xe("stickers",h([])),v=V(()=>{if(o.message.sticker_url)return o.message.sticker_url;if(o.message.sticker_id){const x=y.value.find(H=>H.id===o.message.sticker_id);if(x)return x.url}return""}),S=V(()=>o.message.attachment_url||""),D=V(()=>{const x=o.message.reply_to_type;if(x==="sticker")return"ðŸŽ¨ Sticker";if(x==="voice")return"ðŸŽ¤ Voice message";if(x==="file")return"ðŸ“Ž File";const H=o.message.reply_to_content||"";return H.length>80?H.slice(0,80)+"...":H}),z=V(()=>I(o.message.content||"").replace(/@(\w{1,30})/g,`<span class="mention" data-u="$1" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'$1'}))">@$1</span>`));function I(x){return x.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function $(x){if(!x)return"";const H=new Date(x.endsWith("Z")?x:x+"Z"),C=new Date;return H.toDateString()===C.toDateString()?H.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):H.toLocaleDateString([],{month:"short",day:"numeric"})}function b(x){const H=Math.floor(x/60),C=x%60;return`${H}:${String(C).padStart(2,"0")}`}function U(x){const H=x.target.getBoundingClientRect();l("openEmojiPicker",o.message.id,H.left,H.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(x=>{l("mentionClick",x.detail)})),(x,H)=>(u(),p("div",At({class:["msg-row",[t.isMine?"mine":"theirs",{selected:s.value}]],"data-message-id":t.message.id,onContextmenu:Q(m,["prevent"])},k,{onClick:w}),[_(n).selectionMode?(u(),p("div",_s,[e("input",{type:"checkbox",checked:s.value,tabindex:"-1"},null,8,Cs)])):A("",!0),!t.isMine&&t.message.message_type!=="sticker"?(u(),p("div",$s,[ie(P(t.message.sender_display_name||t.message.sender_username)+" ",1),t.message.sender_is_admin?(u(),W(wt,{key:0})):A("",!0)])):A("",!0),e("div",Ms,[t.message.reply_to_message_id?(u(),p("div",{key:0,class:"msg-reply-quote",onClick:H[0]||(H[0]=Q(C=>l("replyClick",t.message.reply_to_message_id),["stop"]))},[H[1]||(H[1]=e("div",{class:"msg-reply-quote-bar"},null,-1)),e("div",null,[e("div",xs,P(t.message.reply_to_sender_name||t.message.reply_to_sender_username||"Unknown"),1),e("div",Ss,P(D.value),1)])])):A("",!0),t.message.message_type==="sticker"?(u(),p("div",Is,[e("img",{class:"sticker-img",src:v.value,alt:t.message.sticker_label||"sticker"},null,8,Ts)])):t.message.message_type==="voice"?(u(),p("div",Ds,[e("div",Ls,[e("audio",{controls:"",src:S.value},null,8,Us),t.message.duration_seconds?(u(),p("span",Ps,P(b(t.message.duration_seconds)),1)):A("",!0)])])):(u(),p("div",{key:3,class:"msg-bubble",innerHTML:z.value},null,8,Fs)),e("button",{class:"reaction-add-btn",onClick:Q(U,["stop"])},"â˜º"),t.message.reactions&&t.message.reactions.length?(u(),p("div",Es,[(u(!0),p(K,null,oe(t.message.reactions,C=>(u(),p("button",{key:C.emoji,class:ne(["reaction-chip",{"reaction-mine":C.me}]),onClick:Q(E=>l("toggleReaction",t.message.id,C.emoji),["stop"])},[e("span",As,P(C.emoji),1),e("span",Bs,P(C.count),1)],10,Ns))),128)),e("button",{class:"reaction-chip reaction-add-chip",onClick:Q(U,["stop"])},"+")])):A("",!0)]),e("div",zs,[t.message.is_edited?(u(),p("span",Os,"(edited)")):A("",!0),ie(" "+P($(t.message.created_at)),1)])],16,ws))}}),Vs={class:"composer-wrapper"},js={key:0,class:"reply-preview"},Hs={class:"reply-preview-content"},qs={class:"reply-preview-sender"},Ws={class:"reply-preview-text"},Gs={key:1,class:"reply-preview edit-preview"},Xs={class:"reply-preview-content"},Ys={class:"reply-preview-text"},Zs={class:"composer"},Js=["onKeydown"],Qs=G({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(t,{expose:a,emit:o}){const l=t,n=o,i=h(""),s=h(null),r=h(null),f=h(null);let d=0;function k(){const z=i.value.trim();z&&(f.value?(n("editMessage",f.value.messageId,z),f.value=null):r.value?(n("send",z,{...r.value}),r.value=null):n("send",z),i.value="",D())}function m(){r.value=null,s.value?.focus()}function c(){f.value=null,i.value="",D(),s.value?.focus()}function w(){r.value?m():f.value&&c()}function y(z){const I=z.detail;I&&(f.value=null,r.value={messageId:I.messageId,senderName:I.senderName||"Unknown",snippet:(I.text||"").slice(0,100)},me(()=>s.value?.focus()))}function v(z){const I=z.detail;I&&(r.value=null,f.value={messageId:I.messageId,snippet:(I.text||"").slice(0,100),fullText:I.text||""},i.value=f.value.fullText,me(()=>{D(),s.value?.focus()}))}function S(){D();const z=Date.now();z-d>2e3&&i.value.trim().length>0&&(d=z,n("typing"))}function D(){const z=s.value;z&&(z.style.height="auto",z.style.height=Math.min(z.scrollHeight,120)+"px")}return le(()=>{s.value?.focus(),window.addEventListener("reply-to-message",y),window.addEventListener("edit-message",v)}),_e(()=>{window.removeEventListener("reply-to-message",y),window.removeEventListener("edit-message",v)}),ke(()=>l.replyTo,z=>{z&&s.value?.focus()}),a({focus:()=>s.value?.focus()}),(z,I)=>(u(),p("div",Vs,[r.value?(u(),p("div",js,[I[3]||(I[3]=e("div",{class:"reply-preview-bar"},null,-1)),e("div",Hs,[e("span",qs,P(r.value.senderName),1),e("span",Ws,P(r.value.snippet),1)]),e("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:m},"âœ•")])):A("",!0),f.value?(u(),p("div",Gs,[I[5]||(I[5]=e("div",{class:"reply-preview-bar edit-bar"},null,-1)),e("div",Xs,[I[4]||(I[4]=e("span",{class:"reply-preview-sender"},"Editing message",-1)),e("span",Ys,P(f.value.snippet),1)]),e("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:c},"âœ•")])):A("",!0),e("div",Zs,[e("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:I[0]||(I[0]=$=>n("toggleStickers"))},"ðŸŒ"),Y(e("textarea",{ref_key:"inputRef",ref:s,"onUpdate:modelValue":I[1]||(I[1]=$=>i.value=$),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[et(Q(k,["exact","prevent"]),["enter"]),et(w,["escape"])],onInput:S},null,40,Js),[[ae,i.value]]),e("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:I[2]||(I[2]=$=>n("startRecording"))},"ðŸŽ¤"),e("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:k},"âž¤")])]))}}),Ks=se(Qs,[["__scopeId","data-v-df4ad9ba"]]),ea={class:"sticker-grid"},ta=["title","onClick"],na=["src","alt"],sa={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},aa=G({__name:"StickerPicker",emits:["select"],setup(t,{emit:a}){const o=a,l=xe("stickers",h([])),n=V(()=>l.value);return(i,s)=>(u(),p("div",ea,[(u(!0),p(K,null,oe(n.value,r=>(u(),p("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:f=>o("select",r.id)},[e("img",{src:r.url,alt:r.label},null,8,na)],8,ta))),128)),n.value.length===0?(u(),p("div",sa," No stickers available ")):A("",!0)]))}}),oa={},ia={class:"msgs-loading"};function la(t,a){return u(),p("div",ia,"Loading...")}const ra=se(oa,[["render",la]]),ca={class:"invite-manage",style:{padding:"0 1rem .5rem"}},ua={class:"invite-link-wrap"},da=["value"],va=G({__name:"InviteSection",props:{chatId:{}},setup(t){const a=t,{showToast:o}=ue(),l=h("Loading..."),n=h("");async function i(){try{const f=await vt(a.chatId);if(f.length>0){const d=f[0];n.value=d.token,l.value=`${window.location.origin}/join/${d.token}`}else{const d=await mt(a.chatId);n.value=d.token,l.value=`${window.location.origin}/join/${d.token}`}}catch{l.value="Failed to generate invite"}}function s(){l.value&&navigator.clipboard&&navigator.clipboard.writeText(l.value).then(()=>o("Link copied!"))}async function r(){if(n.value)try{await ft(n.value),o("Invite revoked"),await i()}catch{o("Failed to revoke invite")}}return le(i),(f,d)=>(u(),p("div",ca,[d[0]||(d[0]=e("div",{class:"invite-manage-title"},"Invite Link",-1)),e("div",ua,[e("input",{class:"form-input invite-link-input",value:l.value,type:"text",readonly:""},null,8,da),e("button",{class:"btn btn-sm btn-outline",title:"Copy link",onClick:s}," ðŸ“‹ ")]),e("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:r}," Revoke link ")]))}}),ma=["onClick"],fa=G({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(t,{emit:a}){const o=a,l=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸŽ‰","ðŸ‘","ðŸ¤”","ðŸ˜","ðŸ˜¡","ðŸ‘Ž","ðŸ‘€","ðŸš€","âœ…","âŒ","ðŸ’¯","ðŸŒŸ","ðŸ˜Š","ðŸ¤¯","ðŸ¥³","ðŸ¥²","ðŸ¤—"];return(n,i)=>t.visible?(u(),p("div",{key:0,class:"emoji-picker",style:Pe({left:t.x+"px",top:t.y+"px"}),onClick:i[0]||(i[0]=Q(()=>{},["stop"]))},[(u(),p(K,null,oe(l,s=>e("button",{key:s,class:"emoji-pick-btn",onClick:r=>o("select",s)},P(s),9,ma)),64))],4)):A("",!0)}}),pa=G({__name:"MessageContextMenu",setup(t){const{showToast:a}=ue(),o=he(),l=Ne(),n=h(!1),i=h(0),s=h(0),r=h(null),f=h(null),d=h(""),k=h(""),m=h(""),c=h(null),w=V(()=>!c.value||!o.user?!1:c.value===o.user.id),y=V(()=>!f.value||!r.value?null:`${window.location.origin}/c/${f.value}/${r.value}`),v=V(()=>!f.value||!r.value?!1:l.pinnedByChat[f.value]?.message?.id===r.value);function S(N){r.value=N.detail.messageId,f.value=N.detail.chatId,d.value=N.detail.text||"",k.value=N.detail.messageType||"text",m.value=N.detail.senderName||"",c.value=N.detail.senderId??null,i.value=N.detail.x,s.value=N.detail.y,n.value=!0,requestAnimationFrame(()=>{const B=document.querySelector(".msg-context-menu");if(!B)return;const j=B.getBoundingClientRect();j.right>window.innerWidth&&(i.value=window.innerWidth-j.width-8),j.bottom>window.innerHeight&&(s.value=window.innerHeight-j.height-8)})}function D(){n.value&&(n.value=!1,r.value=null,f.value=null,d.value="",k.value="",m.value="",c.value=null)}le(()=>{window.addEventListener("show-message-context-menu",S),document.addEventListener("click",D)}),_e(()=>{window.removeEventListener("show-message-context-menu",S),document.removeEventListener("click",D)});function z(){n.value=!1}function I(){z(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:r.value,chatId:f.value,senderName:m.value,text:d.value}}))}function $(){z(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:r.value,chatId:f.value,text:d.value}}))}async function b(){z();try{await navigator.clipboard.writeText(d.value),a("Copied to clipboard")}catch{a("Failed to copy text")}}async function U(){if(z(),!!y.value)try{await navigator.clipboard.writeText(y.value),a("Link copied")}catch{a("Failed to copy link")}}function x(){z(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[r.value],chatId:f.value}}))}function H(){z(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:r.value,chatId:f.value}}))}function C(){if(z(),!r.value||!f.value)return;const N=v.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(N,{detail:{messageId:r.value,chatId:f.value}}))}function E(){z(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:r.value,chatId:f.value}}))}return(N,B)=>(u(),W(lt,{to:"body"},[n.value?(u(),p("div",{key:0,class:"msg-context-menu",style:Pe({left:i.value+"px",top:s.value+"px"}),onClick:B[0]||(B[0]=Q(()=>{},["stop"])),onContextmenu:B[1]||(B[1]=Q(()=>{},["prevent"]))},[e("button",{class:"ctx-item",onClick:I}," Reply "),w.value&&k.value==="text"?(u(),p("button",{key:0,class:"ctx-item",onClick:$}," Edit ")):A("",!0),e("button",{class:"ctx-item",onClick:C},P(v.value?"Unpin":"Pin"),1),e("button",{class:"ctx-item",onClick:b}," Copy text "),y.value?(u(),p("button",{key:1,class:"ctx-item",onClick:U}," Copy link ")):A("",!0),e("button",{class:"ctx-item",onClick:x}," Forward "),e("button",{class:"ctx-item",onClick:H}," Select "),e("button",{class:"ctx-item ctx-delete",onClick:E}," Delete ")],36)):A("",!0)]))}}),ga=se(pa,[["__scopeId","data-v-d52d68d5"]]),ha={key:0,class:"selection-bar"},ya={class:"selection-bar-count"},ba={class:"selection-bar-actions"},ka=["disabled"],wa=["disabled"],_a=G({__name:"SelectionBar",emits:["forward","delete"],setup(t,{emit:a}){const o=a,l=Ee();return(n,i)=>(u(),W(rt,{name:"slide-down"},{default:Ve(()=>[_(l).selectionMode?(u(),p("div",ha,[e("button",{class:"selection-bar-btn cancel-btn",onClick:i[0]||(i[0]=s=>_(l).exitSelectionMode())}," Cancel "),e("span",ya,P(_(l).selectedCount)+" selected",1),e("div",ba,[e("button",{class:"selection-bar-btn forward-btn",disabled:_(l).selectedCount===0,onClick:i[1]||(i[1]=s=>o("forward"))}," Forward ("+P(_(l).selectedCount)+") ",9,ka),e("button",{class:"selection-bar-btn delete-btn",disabled:_(l).selectedCount===0,onClick:i[2]||(i[2]=s=>o("delete"))}," Delete ("+P(_(l).selectedCount)+") ",9,wa)])])):A("",!0)]),_:1}))}}),Ca=se(_a,[["__scopeId","data-v-9ba988f2"]]),$a=G({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(t,{emit:a}){const o=a;function l(){o("close")}return(n,i)=>(u(),W(lt,{to:"body"},[O(rt,{name:"bottom-sheet"},{default:Ve(()=>[t.visible?(u(),p("div",{key:0,class:"bottom-sheet-backdrop",onClick:Q(l,["self"])},[e("div",{class:"bottom-sheet",onClick:i[0]||(i[0]=Q(()=>{},["stop"]))},[i[1]||(i[1]=e("div",{class:"bottom-sheet-handle"},null,-1)),ct(n.$slots,"default",{},void 0,!0)])])):A("",!0)]),_:3})]))}}),Ma=se($a,[["__scopeId","data-v-2c2a0a15"]]),xa={class:"modal"},Sa={class:"modal-header"},Ia={class:"modal-body"},Ta={class:"forward-chat-list"},Da={key:0,class:"empty-state-small"},La=["onClick"],Ua={class:"forward-chat-info"},Pa={class:"forward-chat-name"},Fa={class:"forward-chat-type"},Ea={key:0,class:"forward-check"},Na={class:"modal-actions"},Aa=["disabled"],Ba=G({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(t,{emit:a}){const o=t,l=a,n=ce(),i=Ne(),{showToast:s}=ue(),r=h(""),f=h(null),d=h(!1),k=V(()=>{const v=r.value.toLowerCase().trim(),S=n.sortedChats;return v?S.filter(D=>m(D).toLowerCase().includes(v)):S});function m(v){return v.type==="direct"?v.other_display_name||v.other_username||v.title||"Direct Chat":v.title||v.name||"Unnamed Chat"}function c(v){if(v.type==="direct")return v.other_avatar_url??void 0}function w(){}async function y(){if(f.value!==null){d.value=!0;try{await i.forwardMessages(f.value,o.fromChatId,o.messageIds),s("Message forwarded!"),l("forwarded",f.value)}catch{s("Failed to forward message")}finally{d.value=!1}}}return(v,S)=>(u(),p("div",{class:"modal-backdrop",onClick:S[2]||(S[2]=Q(D=>l("close"),["self"]))},[e("div",xa,[e("div",Sa,[S[3]||(S[3]=e("h2",{class:"modal-title"},"Forward Message",-1)),e("button",{class:"icon-btn",onClick:S[0]||(S[0]=D=>l("close"))},"âœ•")]),e("div",Ia,[Y(e("input",{"onUpdate:modelValue":S[1]||(S[1]=D=>r.value=D),class:"search-input",type:"search",placeholder:"Search chats...",onInput:w},null,544),[[ae,r.value]]),e("div",Ta,[k.value.length===0?(u(),p("div",Da,"No chats found.")):A("",!0),(u(!0),p(K,null,oe(k.value,D=>(u(),p("div",{key:D.id,class:ne(["forward-chat-item",{selected:f.value===D.id}]),onClick:z=>f.value=D.id},[O(re,{name:m(D),url:c(D),size:"sm"},null,8,["name","url"]),e("div",Ua,[e("div",Pa,P(m(D)),1),e("div",Fa,P(D.type),1)]),f.value===D.id?(u(),p("span",Ea,"âœ“")):A("",!0)],10,La))),128))]),e("div",Na,[e("button",{class:"btn btn-primary",disabled:f.value===null||d.value,onClick:y},P(d.value?"Forwarding...":"Forward"),9,Aa)])])])]))}}),za=se(Ba,[["__scopeId","data-v-ce3f4600"]]),Oa={class:"modal modal-sm"},Ra={class:"modal-header"},Va={class:"modal-body"},ja={class:"delete-confirm-text"},Ha={key:0,class:"delete-checkbox-label"},qa={class:"modal-actions"},Wa=G({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:a}){const o=a,l=h(!1);function n(){o("confirm",l.value)}return(i,s)=>(u(),p("div",{class:"modal-backdrop",onClick:s[3]||(s[3]=Q(r=>o("close"),["self"]))},[e("div",Oa,[e("div",Ra,[s[4]||(s[4]=e("h2",{class:"modal-title"},"Delete Message",-1)),e("button",{class:"icon-btn",onClick:s[0]||(s[0]=r=>o("close"))},"âœ•")]),e("div",Va,[e("p",ja," Are you sure you want to delete "+P(t.messageCount>1?`these ${t.messageCount} messages`:"this message")+"? ",1),t.canDeleteForEveryone?(u(),p("label",Ha,[Y(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>l.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[ut,l.value]]),s[5]||(s[5]=ie(" Delete for everyone ",-1))])):A("",!0)]),e("div",qa,[e("button",{class:"btn btn-ghost",onClick:s[2]||(s[2]=r=>o("close"))},"Cancel"),e("button",{class:"btn btn-danger",onClick:n},"Delete")])])]))}}),Ga=se(Wa,[["__scopeId","data-v-388dbae2"]]),Se=Ce("channel",()=>{const t=h(null),a=h([]),o=h(!1),l=V(()=>a.value.length),n=V(()=>a.value.filter(m=>m.role==="admin"||m.role==="owner").length),i=V(()=>{const m=he();return m.user?a.value.find(w=>w.id===m.user.id)?.role??null:null}),s=V(()=>i.value==="owner"),r=V(()=>i.value==="admin"||i.value==="owner");async function f(m){o.value=!0;try{t.value=await pt(m)}catch(c){console.error("Failed to load channel detail",c)}finally{o.value=!1}}async function d(m){try{a.value=await Qt(m)}catch(c){console.error("Failed to load channel members",c)}}async function k(m,c){try{t.value=await en(m,c)}catch(w){throw console.error("Failed to update channel",w),w}}return{detail:t,members:a,loading:o,memberCount:l,adminCount:n,myRole:i,isOwner:s,isAdmin:r,loadDetail:f,loadMembers:d,updateChannel:k}}),Xa=Ce("invites",()=>{const t=h([]),a=h(!1);async function o(i){a.value=!0;try{t.value=await vt(i)}catch(s){console.error("Failed to load invites",s)}finally{a.value=!1}}async function l(i){try{const s=await mt(i);return t.value.push(s),s}catch(s){throw console.error("Failed to create invite",s),s}}async function n(i){const s=[...t.value];t.value=t.value.filter(r=>r.token!==i);try{await ft(i)}catch(r){throw console.error("Failed to revoke invite",r),t.value=s,r}}return{invites:t,loading:a,loadInvites:o,createInvite:l,revokeInvite:n}}),Ya={class:"invite-links-view"},Za={class:"view-header"},Ja={style:{padding:"0 1rem .5rem"}},Qa=["disabled"],Ka={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},eo={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},to={key:2,class:"invite-list",style:{padding:"0 1rem"}},no={class:"invite-item-info"},so={class:"invite-token"},ao={class:"invite-date"},oo={class:"invite-item-actions"},io=["onClick"],lo=["onClick"],ro=G({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(t,{emit:a}){const o=t,l=a,n=Xa(),{showToast:i}=ue(),s=h(!1);function r(m){return new Date(m).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function f(m){const c=`${window.location.origin}/join/${m}`;navigator.clipboard&&navigator.clipboard.writeText(c).then(()=>i("Link copied!"))}async function d(){s.value=!0;try{await n.createInvite(o.chatId),i("Invite link created")}catch{i("Failed to create invite")}finally{s.value=!1}}async function k(m){try{await n.revokeInvite(m),i("Invite revoked")}catch{i("Failed to revoke invite")}}return le(()=>n.loadInvites(o.chatId)),(m,c)=>(u(),p("div",Ya,[e("div",Za,[e("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=w=>l("back"))},[O(_(we),{size:20,"stroke-width":2})]),c[1]||(c[1]=e("span",{class:"view-title"},"Invite Links",-1))]),e("div",Ja,[e("button",{class:"btn btn-sm btn-outline",onClick:d,disabled:s.value},P(s.value?"Creating...":"Create Invite Link"),9,Qa)]),_(n).loading?(u(),p("div",Ka," Loading... ")):_(n).invites.length===0?(u(),p("div",eo," No active invite links ")):(u(),p("div",to,[(u(!0),p(K,null,oe(_(n).invites,w=>(u(),p("div",{key:w.id,class:"invite-item"},[e("div",no,[e("code",so,P(w.token),1),e("span",ao,P(r(w.created_at)),1)]),e("div",oo,[e("button",{class:"icon-btn",title:"Copy link",onClick:y=>f(w.token)},[O(_(In),{size:16,"stroke-width":2})],8,io),e("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:y=>k(w.token)}," Revoke ",8,lo)])]))),128))]))]))}}),co=se(ro,[["__scopeId","data-v-97b82dd0"]]),uo={class:"admins-view"},vo={class:"view-header"},mo={key:0,class:"member-empty"},fo={key:1,class:"member-list"},po={class:"member-info"},go={class:"member-name"},ho=G({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(t,{emit:a}){const o=a,l=Se(),n=V(()=>l.members.filter(i=>i.role==="admin"||i.role==="owner"));return(i,s)=>(u(),p("div",uo,[e("div",vo,[e("button",{class:"icon-btn","aria-label":"Back",onClick:s[0]||(s[0]=r=>o("back"))},[O(_(we),{size:20,"stroke-width":2})]),s[1]||(s[1]=e("span",{class:"view-title"},"Administrators",-1))]),n.value.length===0?(u(),p("div",mo," No administrators found ")):(u(),p("div",fo,[(u(!0),p(K,null,oe(n.value,r=>(u(),p("div",{key:r.id,class:"member-item"},[O(re,{name:r.display_name||r.username,url:r.avatar_url,size:"md"},null,8,["name","url"]),e("div",po,[e("span",go,P(r.display_name||r.username),1),e("span",{class:ne(["role-badge",`role-badge--${r.role}`])},P(r.role),3)])]))),128))]))]))}}),yo=se(ho,[["__scopeId","data-v-8b39733e"]]),bo={class:"subscribers-view"},ko={class:"view-header"},wo={class:"search-bar"},_o={key:0,class:"member-empty"},Co={key:1,class:"member-list"},$o={class:"member-info"},Mo={class:"member-name"},xo=G({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(t,{emit:a}){const o=a,l=Se(),n=h(""),i=V(()=>{const s=n.value.toLowerCase().trim();return s?l.members.filter(r=>r.username.toLowerCase().includes(s)||r.display_name&&r.display_name.toLowerCase().includes(s)):l.members});return(s,r)=>(u(),p("div",bo,[e("div",ko,[e("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=f=>o("back"))},[O(_(we),{size:20,"stroke-width":2})]),r[2]||(r[2]=e("span",{class:"view-title"},"Subscribers",-1))]),e("div",wo,[Y(e("input",{"onUpdate:modelValue":r[1]||(r[1]=f=>n.value=f),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ae,n.value]])]),i.value.length===0?(u(),p("div",_o,P(n.value?"No members found":"No subscribers"),1)):(u(),p("div",Co,[(u(!0),p(K,null,oe(i.value,f=>(u(),p("div",{key:f.id,class:"member-item"},[O(re,{name:f.display_name||f.username,url:f.avatar_url,size:"md"},null,8,["name","url"]),e("div",$o,[e("span",Mo,P(f.display_name||f.username),1),e("span",{class:ne(["role-badge",`role-badge--${f.role}`])},P(f.role),3)])]))),128))]))]))}}),So=se(xo,[["__scopeId","data-v-f99a8a5f"]]);async function Io(t,a){await q.post(`/chats/${t}/avatar`,{file_id:a})}const To={class:"modal profile-modal"},Do={class:"profile-modal-body profile-modal-body--scrollable"},Lo={class:"profile-avatar-section profile-avatar-upload-section"},Uo={class:"profile-avatar-overlay"},Po={class:"profile-info-list"},Fo={class:"form-group"},Eo={class:"form-group"},No={class:"profile-edit-actions"},Ao=["disabled"],Bo=G({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(t,{emit:a}){const o=t,l=a,n=Se(),{showToast:i}=ue(),s=h(""),r=h(""),f=h(void 0),d=h(!1),k=h(null);le(()=>{n.detail&&(s.value=n.detail.title||"",r.value=n.detail.description||"",f.value=n.detail.avatar_url??void 0)});async function m(){const w=k.value?.files?.[0];if(w){try{const y=await qe(w);await Io(o.chatId,y.id),f.value=URL.createObjectURL(w),i("Avatar updated!")}catch{i("Avatar upload failed")}k.value&&(k.value.value="")}}async function c(){if(!s.value.trim()){i("Channel name is required");return}d.value=!0;try{await n.updateChannel(o.chatId,{title:s.value.trim(),description:r.value.trim()}),i("Channel updated!"),l("saved"),l("close")}catch{i("Failed to update channel")}finally{d.value=!1}}return(w,y)=>(u(),p("div",{class:"modal-backdrop profile-backdrop",onClick:y[5]||(y[5]=Q(v=>l("close"),["self"]))},[e("div",To,[e("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:y[0]||(y[0]=v=>l("close"))},[O(_(ye),{size:20,"stroke-width":2})]),e("div",Do,[e("div",Lo,[e("div",{class:"profile-avatar-upload-wrap",onClick:y[1]||(y[1]=v=>k.value?.click())},[O(re,{name:s.value||"Channel",url:f.value,size:"xxl"},null,8,["name","url"]),e("div",Uo,[O(_(ht),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),e("input",{ref_key:"fileInput",ref:k,type:"file",accept:"image/*",class:"hidden",onChange:m},null,544)]),e("div",Po,[e("div",Fo,[y[6]||(y[6]=e("label",{class:"form-label"},"Channel name",-1)),Y(e("input",{"onUpdate:modelValue":y[2]||(y[2]=v=>s.value=v),class:"form-input",type:"text",maxlength:"128",placeholder:"Channel name"},null,512),[[ae,s.value]])]),e("div",Eo,[y[7]||(y[7]=e("label",{class:"form-label"},"Description",-1)),Y(e("textarea",{"onUpdate:modelValue":y[3]||(y[3]=v=>r.value=v),class:"form-input",maxlength:"500",rows:"4",placeholder:"Channel description..."},null,512),[[ae,r.value]])])]),e("div",No,[e("button",{class:"btn btn-primary",disabled:d.value,onClick:c},P(d.value?"Saving...":"Save"),9,Ao),e("button",{class:"btn btn-ghost",onClick:y[4]||(y[4]=v=>l("close"))},"Cancel")])])])]))}}),zo={class:"danger-zone"},Oo={class:"view-header"},Ro={class:"danger-zone-body"},Vo={class:"modal modal-sm"},jo={class:"modal-header"},Ho={class:"modal-actions"},qo=["disabled"],Wo=G({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(t,{emit:a}){const o=t,l=a,n=ce(),i=Se(),{showToast:s}=ue(),r=h(!1),f=h(!1);async function d(){try{await n.leave(o.chatId),l("left")}catch{s("Failed to leave channel")}}async function k(){f.value=!0;try{await Kt(o.chatId),n.chats=n.chats.filter(m=>m.id!==o.chatId),n.activeChatId===o.chatId&&n.setActiveChat(null),r.value=!1,l("deleted")}catch{s("Failed to delete channel")}finally{f.value=!1}}return(m,c)=>(u(),p("div",zo,[e("div",Oo,[e("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=w=>l("back"))},[O(_(we),{size:20,"stroke-width":2})]),c[5]||(c[5]=e("span",{class:"view-title"},"Danger Zone",-1))]),e("div",Ro,[e("button",{class:"btn btn-danger-outline",onClick:d},[O(_(je),{size:18,"stroke-width":1.8}),c[6]||(c[6]=ie(" Leave Channel ",-1))]),_(i).isOwner?(u(),p("button",{key:0,class:"btn btn-danger",onClick:c[1]||(c[1]=w=>r.value=!0)},[O(_(bt),{size:18,"stroke-width":1.8}),c[7]||(c[7]=ie(" Delete Channel ",-1))])):A("",!0)]),r.value?(u(),p("div",{key:0,class:"modal-backdrop",onClick:c[4]||(c[4]=Q(w=>r.value=!1,["self"]))},[e("div",Vo,[e("div",jo,[c[8]||(c[8]=e("h2",{class:"modal-title"},"Delete Channel",-1)),e("button",{class:"icon-btn","aria-label":"Close",onClick:c[2]||(c[2]=w=>r.value=!1)},[O(_(ye),{size:20,"stroke-width":2})])]),c[9]||(c[9]=e("div",{class:"modal-body"},[e("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),e("div",Ho,[e("button",{class:"btn btn-ghost",onClick:c[3]||(c[3]=w=>r.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",disabled:f.value,onClick:k},P(f.value?"Deleting...":"Delete"),9,qo)])])])):A("",!0)]))}}),Go=se(Wo,[["__scopeId","data-v-997b5e56"]]),Xo={class:"modal profile-modal"},Yo={class:"profile-modal-body"},Zo={key:5,class:"profile-loading"},Jo={class:"profile-avatar-section"},Qo={class:"profile-name"},Ko={class:"profile-status"},ei={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},ti={class:"profile-info-item"},ni={class:"profile-info-value"},si={class:"channel-info-menu"},ai={class:"channel-info-menu-count"},oi={class:"channel-info-menu-count"},ii={key:7,class:"profile-loading"},li=G({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(t,{emit:a}){const o=t,l=a,n=Se(),i=h("main"),s=V(()=>Number(o.chatId));function r(){i.value="main",n.loadDetail(s.value)}return le(async()=>{await Promise.all([n.loadDetail(s.value),n.loadMembers(s.value)])}),(f,d)=>(u(),p("div",{class:"modal-backdrop profile-backdrop",onClick:d[14]||(d[14]=Q(k=>l("close"),["self"]))},[e("div",Xo,[e("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:d[0]||(d[0]=k=>l("close"))},[O(_(ye),{size:20,"stroke-width":2})]),e("div",Yo,[i.value==="invites"?(u(),W(co,{key:0,"chat-id":s.value,onBack:d[1]||(d[1]=k=>i.value="main")},null,8,["chat-id"])):i.value==="admins"?(u(),W(yo,{key:1,"chat-id":s.value,onBack:d[2]||(d[2]=k=>i.value="main")},null,8,["chat-id"])):i.value==="subscribers"?(u(),W(So,{key:2,"chat-id":s.value,onBack:d[3]||(d[3]=k=>i.value="main")},null,8,["chat-id"])):i.value==="edit"?(u(),W(Bo,{key:3,"chat-id":s.value,onClose:d[4]||(d[4]=k=>i.value="main"),onSaved:r},null,8,["chat-id"])):i.value==="danger"?(u(),W(Go,{key:4,"chat-id":s.value,onBack:d[5]||(d[5]=k=>i.value="main"),onLeft:d[6]||(d[6]=k=>l("close")),onDeleted:d[7]||(d[7]=k=>l("close"))},null,8,["chat-id"])):_(n).loading?(u(),p("div",Zo,[...d[15]||(d[15]=[e("p",null,"Loading...",-1)])])):_(n).detail?(u(),p(K,{key:6},[e("div",Jo,[O(re,{name:_(n).detail.title||"Channel",url:_(n).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),e("div",Qo,P(_(n).detail.title),1),e("div",Ko,P(_(n).memberCount)+" "+P(_(n).memberCount===1?"subscriber":"subscribers"),1),_(n).detail.description?(u(),p("div",ei,[e("div",ti,[d[16]||(d[16]=e("div",{class:"profile-info-label"},"Description",-1)),e("div",ni,P(_(n).detail.description),1)])])):A("",!0),d[23]||(d[23]=e("div",{class:"profile-divider"},null,-1)),e("div",si,[e("button",{class:"channel-info-menu-item",onClick:d[8]||(d[8]=k=>i.value="invites")},[O(_(Ln),{size:20,"stroke-width":1.8}),d[17]||(d[17]=e("span",null,"Invite Links",-1))]),e("button",{class:"channel-info-menu-item",onClick:d[9]||(d[9]=k=>i.value="admins")},[O(_(An),{size:20,"stroke-width":1.8}),d[18]||(d[18]=e("span",null,"Administrators",-1)),e("span",ai,P(_(n).adminCount),1)]),e("button",{class:"channel-info-menu-item",onClick:d[10]||(d[10]=k=>i.value="subscribers")},[O(_(He),{size:20,"stroke-width":1.8}),d[19]||(d[19]=e("span",null,"Subscribers",-1)),e("span",oi,P(_(n).memberCount),1)]),_(n).isOwner||_(n).isAdmin?(u(),p("button",{key:0,class:"channel-info-menu-item",onClick:d[11]||(d[11]=k=>i.value="edit")},[O(_(En),{size:20,"stroke-width":1.8}),d[20]||(d[20]=e("span",null,"Edit Channel",-1))])):A("",!0),e("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:d[12]||(d[12]=k=>i.value="danger")},[O(_(je),{size:20,"stroke-width":1.8}),d[21]||(d[21]=e("span",null,"Leave Channel",-1))]),_(n).isOwner?(u(),p("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:d[13]||(d[13]=k=>i.value="danger")},[O(_(bt),{size:20,"stroke-width":1.8}),d[22]||(d[22]=e("span",null,"Delete Channel",-1))])):A("",!0)])],64)):(u(),p("div",ii,[...d[24]||(d[24]=[e("p",null,"Channel not found",-1)])]))])])]))}}),ri=se(li,[["__scopeId","data-v-9c7df294"]]),ci={class:"chat-panel"},ui={key:0,class:"empty-chat"},di={key:1,class:"chat-view"},vi={key:1,class:"channel-readonly-bar"},mi={key:0,class:"date-sep"},fi={key:2,class:"sticker-picker"},pi={key:4,class:"recording-bar"},gi={class:"rec-time"},hi=G({__name:"ChatPanel",emits:["back","openUserProfile"],setup(t,{emit:a}){const o=a,l=he(),n=ce(),i=Ne(),{showToast:s}=ue(),r=cs(),f=xe("stickers",h([])),d=xe("sendTyping",()=>{}),k=xe("pendingScrollMessageId",h(null)),m=h(null),c=h(!1),w=h(!1),y=h("member"),v=h(!1),S=h(!1),D=h(!1),z=h(0),I=h(0),$=h(null),b=Ee(),U=h(!1),x=h(null),H=h(""),C=V(()=>!x.value||!l.user?!1:R.value.find(g=>g.id===x.value)?.sender_id===l.user.id),E=V(()=>C.value?R.value.find(g=>g.id===x.value)?.message_type==="text":!1),N=V(()=>!x.value||!n.activeChatId?!1:i.pinnedByChat[n.activeChatId]?.message?.id===x.value),B=V(()=>!n.activeChatId||i.pinnedDismissed.has(n.activeChatId)?null:i.pinnedByChat[n.activeChatId]||null),j=h(!1),M=h([]),F=h(!1),te=h([]),de=h(!1),$e=h(null);let be=null;const X=V(()=>n.activeChat?.type==="channel"&&y.value==="member"),R=V(()=>n.activeChatId?i.getMessages(n.activeChatId):[]),ee=V(()=>{const L=[];let g="";for(const T of R.value){const J=ve(T.created_at);J!==g&&(L.push({type:"date",label:J}),g=J),L.push({type:"msg",msg:T})}return L});function ve(L){if(!L)return"";const g=new Date(L.endsWith("Z")?L:L+"Z"),T=new Date;if(g.toDateString()===T.toDateString())return"Today";const J=new Date(T);return J.setDate(T.getDate()-1),g.toDateString()===J.toDateString()?"Yesterday":g.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}ke(()=>n.activeChatId,async L=>{if(c.value=!1,y.value="member",v.value=!1,be&&(clearInterval(be),be=null),!L)return;await Promise.all([i.loadMessages(L),i.loadPinnedMessage(L)]),await me(),fe();const g=n.activeChat;if(g&&(g.type==="channel"||g.type==="group"))try{const T=await pt(L);y.value=T.my_role||"member",v.value=y.value==="owner"||y.value==="admin"}catch{}be=setInterval(()=>{n.activeChatId===L&&i.loadNewer(L).then(T=>{T.length>0&&_t()})},2500)});function fe(){m.value&&(m.value.scrollTop=m.value.scrollHeight)}function _t(){if(!m.value)return;const L=m.value;L.scrollHeight-L.scrollTop-L.clientHeight<80&&me(()=>{L.scrollTop=L.scrollHeight})}function Ct(){n.activeChatId&&d(n.activeChatId)}async function $t(L,g){if(!(!n.activeChatId||!L.trim())){$e.value=null;try{const T=g?{reply_to_message_id:g.messageId}:void 0,J=await i.sendMessage(n.activeChatId,L.trim(),"text",T);l.user&&(J.sender_id=l.user.id,J.sender_username=l.user.username,J.sender_display_name=l.user.display_name),await me(),fe(),n.loadChats()}catch{s("Failed to send message")}}}async function Mt(L,g){if(!(!n.activeChatId||!g.trim()))try{await i.editMessage(n.activeChatId,L,g.trim())}catch{s("Failed to edit message")}}async function xt(L){if(n.activeChatId){c.value=!1;try{const g=await i.sendMessage(n.activeChatId,"","sticker",{sticker_id:L}),T=f.value.find(J=>J.id===L);T&&(g.sticker_url=T.url,g.sticker_label=T.label),await me(),fe(),n.loadChats()}catch{s("Failed to send sticker")}}}function St(L,g,T){$.value=L,z.value=g,I.value=T,D.value=!0}function It(L){$.value&&n.activeChatId&&i.toggleReaction(n.activeChatId,$.value,L),D.value=!1,$.value=null}function Tt(L,g){n.activeChatId&&i.toggleReaction(n.activeChatId,L,g)}function Dt(){D.value=!1,$.value=null}async function Lt(){try{await r.startRecording(),w.value=!0;const L=await r.stopRecording();w.value=!1,await Nt(L)}catch{w.value=!1,s("Microphone access denied")}}function Ut(){r.cancelRecording(),w.value=!1}function We(L){const{messageIds:g}=L.detail;M.value=g,j.value=!0}function Ge(L){const{messageId:g,chatId:T}=L.detail;T&&b.enterSelectionMode(T,g)}async function Xe(L,g){try{await i.pinMsg(L,g)}catch{s("Failed to pin message")}}async function Ye(L,g){try{await i.unpinMsg(L,g)}catch{s("Failed to unpin message")}}function Ze(L){const{messageId:g,chatId:T}=L.detail;g&&T&&Xe(T,g)}function Je(L){const{messageId:g,chatId:T}=L.detail;g&&T&&Ye(T,g)}function Ae(L){const{messageId:g,chatId:T}=L.detail;if(!g||!T)return;te.value=[g];const J=R.value.find(ge=>ge.id===g);de.value=!!(J&&J.sender_id===l.user?.id),F.value=!0}function Pt(){M.value=[...b.selectedMessageIds],j.value=!0}function Ft(){te.value=[...b.selectedMessageIds],de.value=te.value.every(L=>{const g=R.value.find(T=>T.id===L);return g&&g.sender_id===l.user?.id}),F.value=!0}function Qe(){j.value=!1,M.value=[],b.exitSelectionMode()}async function Et(L){F.value=!1;const g=n.activeChatId;if(g){for(const T of te.value)try{await i.deleteMessage(g,T)}catch{s("Failed to delete message")}te.value=[],b.exitSelectionMode()}}function pe(L){U.value=!1;const g=x.value,T=n.activeChatId;if(!(!g||!T))switch(L){case"reply":{const J=R.value.find(ge=>ge.id===g);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:g,senderName:J?.sender_display_name||J?.sender_username||"Unknown",text:J?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:g,chatId:T,text:H.value}}));break}case"copy":navigator.clipboard.writeText(H.value).then(()=>s("Copied to clipboard"),()=>s("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${T}/${g}`).then(()=>s("Link copied"),()=>s("Failed to copy link"));break;case"forward":M.value=[g],j.value=!0;break;case"select":b.enterSelectionMode(T,g);break;case"delete":Ae(new CustomEvent("",{detail:{messageId:g,chatId:T}}));break;case"pin":Xe(T,g);break;case"unpin":Ye(T,g);break}}async function Be(L){if(!m.value)return;const g=n.activeChatId;if(!g)return;let T=m.value.querySelector(`[data-message-id="${L}"]`);if(!T)try{const J=Math.max(0,L-25),ge=await De(g,{after_id:J,limit:50});if(!ge.find(ze=>ze.id===L)){s("Message not found");return}i.messagesByChat[g]=ge,ge.length>0&&(i.lastMsgId[g]=Math.max(...ge.map(ze=>ze.id))),await me(),T=m.value?.querySelector(`[data-message-id="${L}"]`)}catch{s("Message not found");return}T&&(T.scrollIntoView({behavior:"smooth",block:"center"}),T.classList.add("highlight-message"),setTimeout(()=>T.classList.remove("highlight-message"),2e3))}function Ke(L){L.key==="Escape"&&S.value&&(S.value=!1,L.stopPropagation())}le(()=>{window.addEventListener("forward-messages",We),window.addEventListener("select-message",Ge),window.addEventListener("delete-message",Ae),window.addEventListener("pin-message",Ze),window.addEventListener("unpin-message",Je),document.addEventListener("keydown",Ke)}),_e(()=>{window.removeEventListener("forward-messages",We),window.removeEventListener("select-message",Ge),window.removeEventListener("delete-message",Ae),window.removeEventListener("pin-message",Ze),window.removeEventListener("unpin-message",Je),document.removeEventListener("keydown",Ke)}),ke(()=>k.value,async L=>{L&&(await me(),setTimeout(()=>{Be(L),k.value=null},300))}),ke(()=>n.activeChatId,()=>{b.exitSelectionMode(),$e.value=null});async function Nt(L){if(n.activeChatId)try{const g=await qe(L);await i.sendMessage(n.activeChatId,"","voice",{file_id:g.id,duration_seconds:r.seconds.value}),await i.loadMessages(n.activeChatId),await me(),fe(),n.loadChats()}catch{s("Failed to upload voice message")}}return(L,g)=>(u(),p("main",ci,[_(n).activeChatId?(u(),p("div",di,[O(Ca,{onForward:Pt,onDelete:Ft}),Y(O(gs,{onBack:g[0]||(g[0]=T=>o("back")),onOpenUserProfile:g[1]||(g[1]=T=>o("openUserProfile",T)),onOpenChannelInfo:g[2]||(g[2]=T=>S.value=!0)},null,512),[[Le,!_(b).selectionMode]]),B.value&&!_(b).selectionMode?(u(),W(ms,{key:0,message:B.value.message,onClick:g[3]||(g[3]=T=>Be(B.value.message.id)),onDismiss:g[4]||(g[4]=T=>_(i).dismissPin(_(n).activeChatId))},null,8,["message"])):A("",!0),X.value?(u(),p("div",vi,[...g[20]||(g[20]=[e("span",{class:"readonly-icon"},"ðŸ”’",-1),e("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):A("",!0),e("div",{ref_key:"msgListRef",ref:m,class:"msg-list",onClick:Dt},[_(i).loadingChat===_(n).activeChatId?(u(),W(ra,{key:0})):(u(!0),p(K,{key:1},oe(ee.value,T=>(u(),p(K,{key:T.type==="date"?"date-"+T.label:"msg-"+T.msg.id},[T.type==="date"?(u(),p("div",mi,[e("span",null,P(T.label),1)])):(u(),W(Rs,{key:1,message:T.msg,"is-mine":T.msg.sender_id===_(l).user?.id,onMentionClick:g[5]||(g[5]=J=>o("openUserProfile",J)),onOpenEmojiPicker:St,onToggleReaction:Tt,onReplyClick:Be},null,8,["message","is-mine"]))],64))),128))],512),O(fa,{visible:D.value,x:z.value,y:I.value,onSelect:It,onClose:g[6]||(g[6]=T=>D.value=!1)},null,8,["visible","x","y"]),c.value?(u(),p("div",fi,[O(aa,{onSelect:xt})])):A("",!0),X.value?A("",!0):Y((u(),W(Ks,{key:3,"sticker-picker-open":c.value,"reply-to":$e.value,onSend:$t,onEditMessage:Mt,onToggleStickers:g[7]||(g[7]=T=>c.value=!c.value),onStartRecording:Lt,onTyping:Ct},null,8,["sticker-picker-open","reply-to"])),[[Le,!w.value]]),w.value?(u(),p("div",pi,[g[21]||(g[21]=e("span",{class:"rec-dot"},null,-1)),e("span",gi,P(_(r).formatTime(_(r).seconds.value)),1),g[22]||(g[22]=e("span",{class:"rec-label"},"Recording... tap mic to stop",-1)),e("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:Ut},"âœ•")])):A("",!0),v.value?(u(),W(va,{key:5,"chat-id":_(n).activeChatId},null,8,["chat-id"])):A("",!0),O(ga),O(Ma,{visible:U.value,onClose:g[16]||(g[16]=T=>U.value=!1)},{default:Ve(()=>[e("button",{class:"ctx-item",onClick:g[8]||(g[8]=T=>pe("reply"))},"Reply"),E.value?(u(),p("button",{key:0,class:"ctx-item",onClick:g[9]||(g[9]=T=>pe("edit"))},"Edit")):A("",!0),e("button",{class:"ctx-item",onClick:g[10]||(g[10]=T=>pe(N.value?"unpin":"pin"))},P(N.value?"Unpin":"Pin"),1),e("button",{class:"ctx-item",onClick:g[11]||(g[11]=T=>pe("copy"))},"Copy text"),e("button",{class:"ctx-item",onClick:g[12]||(g[12]=T=>pe("copyLink"))},"Copy link"),e("button",{class:"ctx-item",onClick:g[13]||(g[13]=T=>pe("forward"))},"Forward"),e("button",{class:"ctx-item",onClick:g[14]||(g[14]=T=>pe("select"))},"Select"),e("button",{class:"ctx-item ctx-delete",onClick:g[15]||(g[15]=T=>pe("delete"))},"Delete")]),_:1},8,["visible"]),j.value?(u(),W(za,{key:6,"message-ids":M.value,"from-chat-id":_(n).activeChatId,onClose:Qe,onForwarded:Qe},null,8,["message-ids","from-chat-id"])):A("",!0),F.value?(u(),W(Ga,{key:7,"message-count":te.value.length,"can-delete-for-everyone":de.value,onClose:g[17]||(g[17]=T=>F.value=!1),onConfirm:Et},null,8,["message-count","can-delete-for-everyone"])):A("",!0),S.value?(u(),W(ri,{key:8,"chat-id":String(_(n).activeChatId),onClose:g[18]||(g[18]=T=>S.value=!1)},null,8,["chat-id"])):A("",!0)])):(u(),p("div",ui,[...g[19]||(g[19]=[e("div",{class:"empty-chat-icon"},"ðŸ’¬",-1),e("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),yi=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Favorites",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:t=>t.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:t=>t.isAuthenticated,rightSlot:"none",separator:!0}];function bi(t){return yi.filter(a=>a.visible(t))}const ki=["disabled"],wi={class:"menu-item__label"},_i={key:1,class:"menu-item__badge"},Ci=G({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(t,{emit:a}){const o=a;return(l,n)=>(u(),p("button",{class:ne(["menu-item",{"menu-item--danger":t.danger,"menu-item--disabled":t.disabled}]),disabled:t.disabled,onClick:n[0]||(n[0]=i=>o("click"))},[t.icon?(u(),W(Ue(t.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):A("",!0),e("span",wi,P(t.label),1),t.badge?(u(),p("span",_i,P(t.badge),1)):A("",!0),ct(l.$slots,"right",{},void 0),t.chevron?(u(),W(Ue(_(Sn)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):A("",!0)],10,ki))}}),it=se(Ci,[["__scopeId","data-v-682bc042"]]),$i={class:"drawer-header"},Mi={class:"drawer-avatar-wrap"},xi={class:"drawer-user-info"},Si={class:"drawer-display-name"},Ii={class:"drawer-username"},Ti={class:"drawer-nav"},Di={key:0,class:"drawer-divider"},Li=["onClick"],Ui={class:"menu-item__label"},Pi=["aria-checked"],Fi=G({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(t,{emit:a}){const o=a,l=dt(),n=he(),i=Fe(),s={user:kt,users:He,megaphone:yt,bookmark:Mn,settings:Nn,moon:Fn,download:Tn,"log-out":je,star:zn},r=V(()=>({isAuthenticated:!!n.user,isDesktop:!0})),f=V(()=>bi(r.value)),d={openProfile:()=>o("openProfile"),createGroup:()=>o("openNewGroup"),createChannel:()=>o("openNewChannel"),openFavorites:()=>o("openFavorites"),openSettings:()=>o("openSettings"),toggleNightMode:()=>{const m=i.theme==="dark"?"light":"dark";i.applyTheme(m),i.saveSettings({theme:m})},openDownload:()=>o("openDownload"),logout:()=>{n.logout(),l.push("/login")}};function k(m){m&&d[m]&&d[m]()}return(m,c)=>(u(),p("div",{class:ne(["drawer",{open:t.open}])},[e("div",$i,[e("button",{class:"icon-btn","aria-label":"Close menu",onClick:c[0]||(c[0]=w=>o("close"))},[O(_(ye),{size:20,"stroke-width":2})]),c[1]||(c[1]=e("span",{class:"drawer-title"},"Menu",-1))]),e("div",Mi,[O(re,{name:_(n).user?.display_name||_(n).user?.username||"?",url:_(n).user?.avatar_url,size:"lg"},null,8,["name","url"]),e("div",xi,[e("div",Si,P(_(n).user?.display_name||_(n).user?.username||"---"),1),e("div",Ii,"@"+P(_(n).user?.username||"---"),1)])]),e("nav",Ti,[(u(!0),p(K,null,oe(f.value,w=>(u(),p(K,{key:w.id},[w.separator?(u(),p("div",Di)):A("",!0),w.rightSlot==="toggle"?(u(),p("div",{key:1,class:"menu-item menu-item--toggle",onClick:y=>k(w.action)},[(u(),W(Ue(s[w.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),e("span",Ui,P(w.label),1),e("span",{class:ne(["toggle-switch",{"toggle-switch--on":_(i).theme==="dark"}]),role:"switch","aria-checked":_(i).theme==="dark"},[...c[2]||(c[2]=[e("span",{class:"toggle-switch__thumb"},null,-1)])],10,Pi)],8,Li)):w.id==="logout"?(u(),W(it,{key:2,icon:s[w.icon],label:w.label,danger:"",onClick:y=>k(w.action)},null,8,["icon","label","onClick"])):(u(),W(it,{key:3,icon:s[w.icon],label:w.label,onClick:y=>k(w.action)},null,8,["icon","label","onClick"]))],64))),128))]),c[3]||(c[3]=e("div",{class:"drawer-footer"},"Simple Messenger v2",-1))],2))}}),Ei=se(Fi,[["__scopeId","data-v-de7cf394"]]),Ni={class:"modal"},Ai={class:"modal-header"},Bi={class:"modal-body"},zi={key:0,class:"chat-type-cards"},Oi={class:"chat-type-icon"},Ri={class:"chat-type-icon"},Vi={class:"chat-type-icon"},ji={key:1,class:"new-chat-form"},Hi={class:"user-pick-list"},qi={key:0,class:"empty-state-small"},Wi={key:1,class:"empty-state-small"},Gi=["onClick"],Xi={class:"user-pick-name"},Yi={class:"user-pick-handle"},Zi={key:2,class:"new-chat-form"},Ji={class:"form-group"},Qi={class:"form-group"},Ki={class:"form-group"},el={class:"user-pick-list"},tl=["onClick"],nl={class:"user-pick-name"},sl={class:"user-pick-handle"},al={class:"modal-actions"},ol=["disabled"],il={key:3,class:"new-chat-form"},ll={class:"form-group"},rl={class:"form-group"},cl={class:"form-group"},ul={class:"modal-actions"},dl=["disabled"],vl=G({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(t,{emit:a}){const o=t,l=a,n=he(),{showToast:i}=ue(),s=h(o.initialStep),r=h(!1),f=h(""),d=h([]),k=h(!1);let m=null;const c=h(""),w=h(""),y=h(""),v=h([]),S=h(new Set);let D=null;const z=h(""),I=h(""),$=h("");le(()=>{b("")});async function b(j){k.value=!0;try{const M=await nt(j);d.value=M.filter(F=>F.id!==n.user?.id)}catch{d.value=[]}finally{k.value=!1}}function U(){m&&clearTimeout(m),m=setTimeout(()=>b(f.value),300)}async function x(j){try{v.value=await nt(j)}catch{v.value=[]}}function H(){D&&clearTimeout(D),D=setTimeout(()=>x(y.value),300)}function C(j){S.value.has(j)?S.value.delete(j):S.value.add(j)}async function E(j){r.value=!0;try{const M=await Te({type:"direct",member_ids:[j]});l("chatCreated",M.id)}catch{i("Failed to start conversation")}finally{r.value=!1}}async function N(){if(!c.value.trim()){i("Group name is required");return}r.value=!0;try{const j=await Te({type:"group",title:c.value.trim(),description:w.value.trim(),member_ids:Array.from(S.value)});i("Group created!"),l("chatCreated",j.id)}catch{i("Failed to create group")}finally{r.value=!1}}async function B(){if(!z.value.trim()){i("Channel name is required");return}r.value=!0;try{const j=await Te({type:"channel",title:z.value.trim(),description:$.value.trim(),public_name:I.value.trim()||void 0,member_ids:[]});i("Channel created!"),l("chatCreated",j.id)}catch{i("Failed to create channel")}finally{r.value=!1}}return(j,M)=>(u(),p("div",{class:"modal-backdrop",onClick:M[14]||(M[14]=Q(F=>l("close"),["self"]))},[e("div",Ni,[e("div",Ai,[M[15]||(M[15]=e("h2",{class:"modal-title"},"New Conversation",-1)),e("button",{class:"icon-btn",onClick:M[0]||(M[0]=F=>l("close"))},[O(_(ye),{size:20})])]),e("div",Bi,[s.value==="select"?(u(),p("div",zi,[e("button",{class:"chat-type-card",onClick:M[1]||(M[1]=F=>s.value="direct")},[e("span",Oi,[O(_(kt),{size:24})]),M[16]||(M[16]=e("div",null,[e("div",{class:"chat-type-label"},"Direct Chat"),e("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),e("button",{class:"chat-type-card",onClick:M[2]||(M[2]=F=>s.value="group")},[e("span",Ri,[O(_(He),{size:24})]),M[17]||(M[17]=e("div",null,[e("div",{class:"chat-type-label"},"Group Chat"),e("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),e("button",{class:"chat-type-card",onClick:M[3]||(M[3]=F=>s.value="channel")},[e("span",Vi,[O(_(yt),{size:24})]),M[18]||(M[18]=e("div",null,[e("div",{class:"chat-type-label"},"Channel"),e("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):A("",!0),s.value==="direct"?(u(),p("div",ji,[e("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[4]||(M[4]=F=>s.value="select")},[O(_(we),{size:16}),M[19]||(M[19]=ie(" Back ",-1))]),Y(e("input",{"onUpdate:modelValue":M[5]||(M[5]=F=>f.value=F),class:"search-input",type:"search",placeholder:"Search users...",onInput:U},null,544),[[ae,f.value]]),e("div",Hi,[k.value?(u(),p("div",qi,"Loading users...")):d.value.length===0?(u(),p("div",Wi,"No users found.")):(u(!0),p(K,{key:2},oe(d.value,F=>(u(),p("div",{key:F.id,class:"user-pick-item",onClick:te=>E(F.id)},[O(re,{name:F.display_name||F.username,url:F.avatar_url,size:"sm"},null,8,["name","url"]),e("div",null,[e("div",Xi,P(F.display_name||F.username),1),e("div",Yi,"@"+P(F.username),1)])],8,Gi))),128))])])):A("",!0),s.value==="group"?(u(),p("div",Zi,[e("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[6]||(M[6]=F=>s.value="select")},[O(_(we),{size:16}),M[20]||(M[20]=ie(" Back ",-1))]),e("div",Ji,[M[21]||(M[21]=e("label",{class:"form-label"},"Group name",-1)),Y(e("input",{"onUpdate:modelValue":M[7]||(M[7]=F=>c.value=F),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[ae,c.value]])]),e("div",Qi,[M[22]||(M[22]=e("label",{class:"form-label"},"Description (optional)",-1)),Y(e("textarea",{"onUpdate:modelValue":M[8]||(M[8]=F=>w.value=F),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[ae,w.value]])]),e("div",Ki,[M[23]||(M[23]=e("label",{class:"form-label"},"Add members",-1)),Y(e("input",{"onUpdate:modelValue":M[9]||(M[9]=F=>y.value=F),class:"search-input",type:"search",placeholder:"Search users...",onInput:H},null,544),[[ae,y.value]]),e("div",el,[(u(!0),p(K,null,oe(v.value,F=>(u(),p("div",{key:F.id,class:ne(["user-pick-item",{selected:S.value.has(F.id)}]),onClick:te=>C(F.id)},[O(re,{name:F.display_name||F.username,url:F.avatar_url,size:"sm"},null,8,["name","url"]),e("div",null,[e("div",nl,[S.value.has(F.id)?(u(),W(_(xn),{key:0,size:14,style:{"margin-right":"4px"}})):A("",!0),ie(P(F.display_name||F.username),1)]),e("div",sl,"@"+P(F.username),1)])],10,tl))),128))])]),e("div",al,[e("button",{class:"btn btn-primary",disabled:r.value,onClick:N}," Create Group ",8,ol)])])):A("",!0),s.value==="channel"?(u(),p("div",il,[e("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[10]||(M[10]=F=>s.value="select")},[O(_(we),{size:16}),M[24]||(M[24]=ie(" Back ",-1))]),e("div",ll,[M[25]||(M[25]=e("label",{class:"form-label"},"Channel name",-1)),Y(e("input",{"onUpdate:modelValue":M[11]||(M[11]=F=>z.value=F),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[ae,z.value]])]),e("div",rl,[M[26]||(M[26]=e("label",{class:"form-label"},"Public link name (optional)",-1)),Y(e("input",{"onUpdate:modelValue":M[12]||(M[12]=F=>I.value=F),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[ae,I.value]]),M[27]||(M[27]=e("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),e("div",cl,[M[28]||(M[28]=e("label",{class:"form-label"},"Description (optional)",-1)),Y(e("textarea",{"onUpdate:modelValue":M[13]||(M[13]=F=>$.value=F),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[ae,$.value]])]),e("div",ul,[e("button",{class:"btn btn-primary",disabled:r.value,onClick:B}," Create Channel ",8,dl)])])):A("",!0)])])]))}}),ml={class:"modal profile-modal profile-modal--self"},fl={class:"profile-tabs"},pl={class:"profile-modal-body profile-modal-body--scrollable"},gl={class:"profile-avatar-section profile-avatar-upload-section"},hl={class:"profile-avatar-overlay"},yl={class:"profile-name"},bl={key:0,class:"profile-status profile-status--online"},kl={class:"profile-info-list"},wl={class:"form-group"},_l={class:"form-group"},Cl={key:0,class:"form-hint form-error"},$l={class:"form-group"},Ml={class:"profile-info-item"},xl={class:"profile-info-value"},Sl={class:"profile-edit-actions"},Il={class:"profile-info-list"},Tl={class:"form-group form-inline"},Dl={class:"form-group form-inline"},Ll={class:"toggle"},Ul={class:"form-group form-inline"},Pl=G({__name:"ProfileModal",props:{initialTab:{default:"profile"}},emits:["close"],setup(t,{emit:a}){const o=t,l=a,n=he(),i=Fe(),{showToast:s}=ue(),r=h(o.initialTab),f=h(""),d=h(""),k=h(""),m=h(""),c=h(null),w=h("light"),y=h(!0),v=h("en");ke(y,async I=>{I&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(y.value=!1,s("Notifications blocked by browser"))}),le(async()=>{n.user&&(f.value=n.user.display_name||"",d.value=n.user.username,k.value=n.user.bio||""),w.value=i.theme,y.value=i.notificationsEnabled,v.value=i.language});async function S(){const I=c.value?.files?.[0];if(I){try{const $=await qe(I),b=await hn($.id);n.updateUser({avatar_url:b.avatar_url}),s("Avatar updated!")}catch{s("Upload failed")}c.value&&(c.value.value="")}}async function D(){if(m.value="",!n.user)return;const I={display_name:f.value.trim(),bio:k.value.trim()};d.value.trim()&&d.value.trim()!==n.user.username&&(I.username=d.value.trim());try{const $=await gn(n.user.id,I);n.updateUser({display_name:$.display_name,username:$.username}),s("Profile saved!"),l("close")}catch($){$.response?.status===409?m.value="Username already taken":s("Save failed")}}async function z(){try{await i.saveSettings({theme:w.value,notifications_enabled:y.value,language:v.value}),s("Settings saved!"),l("close")}catch{s("Settings save failed")}}return(I,$)=>(u(),p("div",{class:"modal-backdrop profile-backdrop",onClick:$[11]||($[11]=Q(b=>l("close"),["self"]))},[e("div",ml,[e("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:$[0]||($[0]=b=>l("close"))},[O(_(ye),{size:20,"stroke-width":2})]),e("div",fl,[e("button",{class:ne(["profile-tab",{active:r.value==="profile"}]),onClick:$[1]||($[1]=b=>r.value="profile")},"Profile",2),e("button",{class:ne(["profile-tab",{active:r.value==="settings"}]),onClick:$[2]||($[2]=b=>r.value="settings")},"Settings",2)]),e("div",pl,[Y(e("div",null,[e("div",gl,[e("div",{class:"profile-avatar-upload-wrap",onClick:$[3]||($[3]=b=>c.value?.click())},[O(re,{name:f.value||_(n).user?.username||"?",url:_(n).user?.avatar_url,size:"xxl"},null,8,["name","url"]),e("div",hl,[O(_(ht),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),e("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",class:"hidden",onChange:S},null,544)]),e("div",yl,P(f.value||_(n).user?.username||"?"),1),_(n).user?(u(),p("div",bl," online ")):A("",!0),$[16]||($[16]=e("div",{class:"profile-divider"},null,-1)),e("div",kl,[e("div",wl,[$[12]||($[12]=e("label",{class:"form-label"},"Display name",-1)),Y(e("input",{"onUpdate:modelValue":$[4]||($[4]=b=>f.value=b),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[ae,f.value]])]),e("div",_l,[$[13]||($[13]=e("label",{class:"form-label"},"Username",-1)),Y(e("input",{"onUpdate:modelValue":$[5]||($[5]=b=>d.value=b),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[ae,d.value]]),m.value?(u(),p("small",Cl,P(m.value),1)):A("",!0)]),e("div",$l,[$[14]||($[14]=e("label",{class:"form-label"},"Bio",-1)),Y(e("textarea",{"onUpdate:modelValue":$[6]||($[6]=b=>k.value=b),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[ae,k.value]])]),e("div",Ml,[$[15]||($[15]=e("div",{class:"profile-info-label"},"User ID",-1)),e("div",xl,P(_(n).user?.id),1)])]),e("div",Sl,[e("button",{class:"btn btn-primary",onClick:D},"Save Profile"),e("button",{class:"btn btn-ghost",onClick:$[7]||($[7]=b=>l("close"))},"Cancel")])],512),[[Le,r.value==="profile"]]),Y(e("div",null,[e("div",Il,[e("div",Tl,[$[18]||($[18]=e("label",{class:"form-label"},"Theme",-1)),Y(e("select",{"onUpdate:modelValue":$[8]||($[8]=b=>w.value=b),class:"form-input form-select"},[...$[17]||($[17]=[e("option",{value:"light"},"Light",-1),e("option",{value:"dark"},"Dark",-1)])],512),[[tt,w.value]])]),e("div",Dl,[$[20]||($[20]=e("label",{class:"form-label"},"Notifications",-1)),e("label",Ll,[Y(e("input",{"onUpdate:modelValue":$[9]||($[9]=b=>y.value=b),type:"checkbox"},null,512),[[ut,y.value]]),$[19]||($[19]=e("span",{class:"toggle-slider"},null,-1))])]),e("div",Ul,[$[22]||($[22]=e("label",{class:"form-label"},"Language",-1)),Y(e("select",{"onUpdate:modelValue":$[10]||($[10]=b=>v.value=b),class:"form-input form-select"},[...$[21]||($[21]=[e("option",{value:"en"},"English",-1),e("option",{value:"ru"},"Ð ÑƒÑÑÐºÐ¸Ð¹",-1),e("option",{value:"de"},"Deutsch",-1)])],512),[[tt,v.value]])])]),e("div",{class:"profile-edit-actions"},[e("button",{class:"btn btn-primary",onClick:z},"Save Settings")])],512),[[Le,r.value==="settings"]])])])]))}}),Fl={class:"profile-actions"},El=["disabled","onClick"],Nl={class:"profile-action-btn__circle"},Al={class:"profile-action-btn__label"},Bl=G({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(t,{emit:a}){const o=t,l=a,n=V(()=>{const i=[{icon:Pn,label:"Message",event:"message"}];return o.showMute!==!1&&i.push({icon:$n,label:o.muted?"Unmute":"Mute",event:"mute"}),o.showMore!==!1&&i.push({icon:Dn,label:"More",event:"more"}),i});return(i,s)=>(u(),p("div",Fl,[(u(!0),p(K,null,oe(n.value,r=>(u(),p("button",{key:r.label,class:ne(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:f=>l(r.event)},[e("span",Nl,[(u(),W(Ue(r.icon),{size:22,"stroke-width":1.8}))]),e("span",Al,P(r.label),1)],10,El))),128))]))}}),zl=se(Bl,[["__scopeId","data-v-b5376905"]]),Ol={class:"modal profile-modal"},Rl={class:"profile-modal-body"},Vl={key:0,class:"profile-loading"},jl={class:"profile-avatar-section"},Hl={class:"profile-name"},ql={class:"profile-info-list"},Wl={class:"profile-info-item"},Gl={class:"profile-info-value"},Xl={key:0,class:"profile-info-item"},Yl={class:"profile-info-value"},Zl={class:"profile-info-item"},Jl={class:"profile-info-value"},Ql={key:2,class:"profile-loading"},Kl=G({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(t,{emit:a}){const o=t,l=a,n=ce(),{showToast:i}=ue(),s=h(null),r=h(!0),f=h(!1),d=V(()=>s.value?n.isUserOnline(s.value.id):!1);le(async()=>{try{s.value=await gt(o.username)}catch{s.value=null}finally{r.value=!1}});function k(){f.value=!f.value,i(f.value?"User muted":"User unmuted")}return(m,c)=>(u(),p("div",{class:"modal-backdrop profile-backdrop",onClick:c[2]||(c[2]=Q(w=>l("close"),["self"]))},[e("div",Ol,[e("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:c[0]||(c[0]=w=>l("close"))},[O(_(ye),{size:20,"stroke-width":2})]),e("div",Rl,[r.value?(u(),p("div",Vl,[...c[3]||(c[3]=[e("p",null,"Loading...",-1)])])):s.value?(u(),p(K,{key:1},[e("div",jl,[O(re,{name:s.value.display_name||s.value.username,url:s.value.avatar_url,online:d.value,size:"xxl"},null,8,["name","url","online"])]),e("div",Hl,[ie(P(s.value.display_name||s.value.username)+" ",1),s.value.is_admin?(u(),W(wt,{key:0})):A("",!0)]),e("div",{class:ne(["profile-status",{"profile-status--online":d.value}])},P(d.value?"online":"offline"),3),O(zl,{muted:f.value,"show-more":!1,onMessage:c[1]||(c[1]=w=>l("message",s.value.username)),onMute:k},null,8,["muted"]),c[7]||(c[7]=e("div",{class:"profile-divider"},null,-1)),e("div",ql,[e("div",Wl,[c[4]||(c[4]=e("div",{class:"profile-info-label"},"Username",-1)),e("div",Gl,"@"+P(s.value.username),1)]),s.value.bio?(u(),p("div",Xl,[c[5]||(c[5]=e("div",{class:"profile-info-label"},"Bio",-1)),e("div",Yl,P(s.value.bio),1)])):A("",!0),e("div",Zl,[c[6]||(c[6]=e("div",{class:"profile-info-label"},"User ID",-1)),e("div",Jl,P(s.value.id),1)])])],64)):(u(),p("div",Ql,[...c[8]||(c[8]=[e("p",null,"User not found",-1)])]))])])]))}}),er={class:"modal",style:{"max-width":"420px"}},tr={class:"modal-header"},nr={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},sr=G({__name:"DownloadModal",emits:["close"],setup(t,{emit:a}){const o=a,l=navigator.userAgent.toLowerCase(),n=l.includes("win"),i=l.includes("mac")&&!l.includes("iphone")&&!l.includes("ipad"),s=V(()=>n?"Windows":i?"macOS":null);function r(){n?window.location.href="/downloads/windows/MessengerSetup.exe":i&&(window.location.href="/downloads/macos/Messenger.dmg")}return(f,d)=>(u(),p("div",{class:"modal-backdrop",onClick:d[1]||(d[1]=Q(k=>o("close"),["self"]))},[e("div",er,[e("div",tr,[d[2]||(d[2]=e("h2",{class:"modal-title"},"Download Simple Messenger",-1)),e("button",{class:"icon-btn","aria-label":"Close",onClick:d[0]||(d[0]=k=>o("close"))},[O(_(ye),{size:20})])]),e("div",nr,[s.value?(u(),p("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+P(s.value),1)):A("",!0),d[3]||(d[3]=Bt('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/MessengerSetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/Messenger.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),ar=G({__name:"ContextMenu",setup(t){const a=ce(),{showToast:o}=ue(),l=h(!1),n=h(0),i=h(0),s=h(null),r=V(()=>s.value?a.chats.find(w=>w.id===s.value)??null:null);function f(w){s.value=w.detail.chatId,n.value=w.detail.x,i.value=w.detail.y,l.value=!0}function d(){l.value&&(l.value=!1,s.value=null)}le(()=>{window.addEventListener("show-context-menu",f),document.addEventListener("click",d)}),_e(()=>{window.removeEventListener("show-context-menu",f),document.removeEventListener("click",d)});async function k(){if(s.value){l.value=!1;try{await a.toggleFavorite(s.value)}catch{o("Failed to update favorite")}}}async function m(){if(s.value){l.value=!1;try{await a.toggleMute(s.value)}catch{o("Failed to update mute")}}}async function c(){if(s.value&&(l.value=!1,!!confirm("Leave this chat?")))try{await a.leave(s.value),o("Left chat")}catch{o("Failed to leave chat")}}return(w,y)=>l.value?(u(),p("div",{key:0,class:"context-menu",style:Pe({left:n.value+"px",top:i.value+"px"})},[e("button",{class:"ctx-item",onClick:k},P(r.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),e("button",{class:"ctx-item",onClick:m},P(r.value?.is_muted?"Unmute":"Mute"),1),r.value&&r.value.type!=="direct"?(u(),p("button",{key:0,class:"ctx-item ctx-leave",onClick:c}," Leave chat ")):A("",!0)],4)):A("",!0)}}),rr=G({__name:"MessengerView",setup(t){const a=zt(),o=dt(),l=he(),n=ce(),i=Fe(),s=Ee(),{showToast:r}=ue(),{connect:f,disconnect:d,sendTyping:k}=fn();Ie("sendTyping",k);const m=h(!1),c=h(!1),w=h("select"),y=h(!1),v=h("profile"),S=h(!1),D=h(null),z=h([]),I=h(null);Ie("stickers",z),Ie("pendingScrollMessageId",I);let $=null;le(async()=>{await i.loadSettings();try{z.value=await yn()}catch{}await n.loadChats(),f(),$=setInterval(()=>n.loadChats(),5e3),b()}),_e(()=>{d(),$&&(clearInterval($),$=null)}),ke(()=>a.path,()=>{b()}),ke(()=>n.activeChatId,()=>{s.selectionMode&&s.exitSelectionMode()});async function b(){const X=a.path;if(X.startsWith("/@")){const R=a.params.username;R&&(D.value=R)}else if(X.startsWith("/u/")){const R=a.params.id;if(R)try{const ee=await pn(parseInt(R));D.value=ee.username}catch{r("User not found")}}else if(X.startsWith("/dm/")){const R=a.params.id;R&&await U(R)}else if(X.startsWith("/c/")){const R=a.params.chatIdOrName||a.params.name,ee=a.params.messageId?parseInt(a.params.messageId):null;if(R)if(/^\d+$/.test(R)){const fe=parseInt(R);ee?await H(fe,ee):n.setActiveChat(fe)}else await x(R)}}async function U(X){try{let R;if(X.startsWith("@")){const ve=X.substring(1);if(l.user?.username===ve){D.value=ve;return}R=(await gt(ve)).id}else if(R=parseInt(X),l.user?.id===R){r("Cannot open DM with yourself");return}const ee=await Te({type:"direct",member_ids:[R]});await n.loadChats(),n.setActiveChat(ee.id)}catch{r("Failed to open conversation")}}async function x(X){try{const R=await Rt(X);n.chats.find(ve=>ve.id===R.id)?n.setActiveChat(R.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function H(X,R){if(!n.chats.find(ve=>ve.id===X)){r("Chat not found");return}n.setActiveChat(X),await me(),I.value=R}function C(X){n.setActiveChat(X),o.replace("/app")}function E(){n.setActiveChat(null)}function N(){m.value=!1,v.value="profile",y.value=!0}function B(){m.value=!1,v.value="settings",y.value=!0}function j(){m.value=!1,w.value="group",c.value=!0}function M(){m.value=!1,w.value="channel",c.value=!0}function F(){m.value=!1}function te(X){D.value=X}async function de(X){D.value=null,await U("@"+X)}async function $e(X){c.value=!1,await n.loadChats(),n.setActiveChat(X)}function be(X){if(X.key==="Escape"){if(s.selectionMode){s.exitSelectionMode();return}if(D.value){D.value=null;return}if(c.value){c.value=!1;return}if(y.value){y.value=!1;return}if(S.value){S.value=!1;return}if(m.value){m.value=!1;return}if(n.activeChatId!==null){E();return}}}return le(()=>document.addEventListener("keydown",be)),_e(()=>document.removeEventListener("keydown",be)),(X,R)=>(u(),p("div",{class:ne(["layout",{"chat-open":!!_(n).activeChatId}])},[O(Ei,{open:m.value,onClose:R[0]||(R[0]=ee=>m.value=!1),onOpenProfile:N,onOpenSettings:B,onOpenNewGroup:j,onOpenNewChannel:M,onOpenFavorites:F,onOpenDownload:R[1]||(R[1]=ee=>S.value=!0)},null,8,["open"]),e("div",{class:ne(["drawer-overlay",{visible:m.value}]),onClick:R[2]||(R[2]=ee=>m.value=!1)},null,2),O(rs,{onOpenDrawer:R[3]||(R[3]=ee=>m.value=!0),onOpenNewChat:R[4]||(R[4]=ee=>{w.value="select",c.value=!0}),onSelectChat:C}),O(hi,{onBack:E,onOpenUserProfile:te}),c.value?(u(),W(vl,{key:0,"initial-step":w.value,onClose:R[5]||(R[5]=ee=>c.value=!1),onChatCreated:$e},null,8,["initial-step"])):A("",!0),y.value?(u(),W(Pl,{key:1,"initial-tab":v.value,onClose:R[6]||(R[6]=ee=>y.value=!1)},null,8,["initial-tab"])):A("",!0),D.value?(u(),W(Kl,{key:2,username:D.value,onClose:R[7]||(R[7]=ee=>D.value=null),onMessage:de},null,8,["username"])):A("",!0),S.value?(u(),W(sr,{key:3,onClose:R[8]||(R[8]=ee=>S.value=!1)})):A("",!0),O(ar)],2))}});export{rr as default};
