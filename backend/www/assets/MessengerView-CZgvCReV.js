import{k as G,l as ze,r as y,m as z,n as Fe,u as Oe,p as ln,d as Y,o as u,c as h,a as t,t as A,w as ne,q as Vt,s as le,g as B,b as P,f as he,x as M,e as ee,v as ie,F as te,y as ue,z as Q,A as dt,B as Ee,C as Je,D as js,E as ve,G as rn,H as fe,T as Yn,I as ke,h as gn,J as Xn,K as Zn,L as es,M as Pn,N as pt,O as ht,j as ts,P as Xt,Q as Bs,R as zs}from"./index-CMumUhH3.js";import{_ as me,l as Vs,c as Ws,r as qs,p as Gs,j as Ks}from"./invites-D9N8TrTx.js";async function Js(){const{data:e}=await G.get("/chats");return e}async function ns(e){const{data:a}=await G.get(`/chats/${e}`);return a}async function Qs(e){const{data:a}=await G.get(`/chats/by-name/${encodeURIComponent(e)}`);return a}async function vt(e){const{data:a}=await G.post("/chats",e);return a}async function Ys(e){await G.post(`/chats/${e}/favorite`)}async function Xs(e){await G.delete(`/chats/${e}/favorite`)}async function Zs(e,a){await G.post(`/chats/${e}/mute`,{})}async function ea(e){await G.delete(`/chats/${e}/mute`)}async function ta(e){await G.delete(`/chats/${e}/leave`)}async function na(e){await G.post(`/chats/${e}/read`)}async function sa(e){await G.post(`/chats/${e}/pin`)}async function aa(e){await G.delete(`/chats/${e}/pin`)}async function oa(e){await G.post(`/chats/${e}/archive`)}async function ia(e){await G.delete(`/chats/${e}/archive`)}async function la(e){const{data:a}=await G.get(`/chats/${e}`);return a.members??[]}async function ra(e){await G.delete(`/chats/${e}`)}async function ca(e,a){const{data:n}=await G.patch(`/chats/${e}`,a);return n}const be=ze("chats",()=>{const e=y([]),a=y(null),n=y({}),o=y(new Set),s=y({}),i=z(()=>e.value.find(L=>L.id===a.value)??null),l=z(()=>[...e.value].sort((L,H)=>{if(L.is_pinned&&!H.is_pinned)return-1;if(!L.is_pinned&&H.is_pinned)return 1;if(L.is_favorite&&!H.is_favorite)return-1;if(!L.is_favorite&&H.is_favorite)return 1;const b=L.last_at||L.updated_at||"";return(H.last_at||H.updated_at||"").localeCompare(b)}));async function r(){try{e.value=await Js()}catch(L){console.error("Failed to load chats",L)}}function m(L){if(a.value=L,L!==null){const H=e.value.find(b=>b.id===L);H&&H.unread_count>0&&(H.unread_count=0,na(L).catch(()=>{}))}}async function k(L){const H=e.value.find(b=>b.id===L);if(H)try{H.is_favorite?await Xs(L):await Ys(L),H.is_favorite=!H.is_favorite}catch(b){throw console.error("Failed to toggle favorite",b),b}}async function f(L){const H=e.value.find(b=>b.id===L);if(H)try{H.is_muted?await ea(L):await Zs(L),H.is_muted=!H.is_muted}catch(b){throw console.error("Failed to toggle mute",b),b}}async function d(L){const H=e.value.find(b=>b.id===L);if(H)try{H.is_pinned?await aa(L):await sa(L),H.is_pinned=!H.is_pinned}catch(b){throw console.error("Failed to toggle pin",b),b}}async function c(L){const H=e.value.find(b=>b.id===L);if(H)try{H.is_archived?await ia(L):await oa(L),H.is_archived=!H.is_archived}catch(b){throw console.error("Failed to toggle archive",b),b}}async function v(L){await ta(L),e.value=e.value.filter(H=>H.id!==L),a.value===L&&(a.value=null)}function g(L,H,b){const T=e.value.find(F=>F.id===L);T&&(T.last_message=H,T.last_at=b)}function p(L){const H=e.value.find(b=>b.id===L);H&&(H.unread_count=(H.unread_count||0)+1)}function S(L,H,b){n.value[L]||(n.value[L]={});const T=n.value[L][H];T&&clearTimeout(T.timer);const F=setTimeout(()=>{C(L,H)},3e3);n.value[L][H]={username:b,timer:F}}function C(L,H){if(n.value[L]){const b=n.value[L][H];b&&(clearTimeout(b.timer),delete n.value[L][H])}}function $(L){const H=n.value[L];return H?Object.values(H).map(b=>b.username):[]}function x(L){o.value=new Set([...o.value,L]),s.value={...s.value,[L]:{isOnline:!0}}}function j(L,H,b){const T=new Set(o.value);T.delete(L),o.value=T,s.value={...s.value,[L]:{isOnline:!1,lastSeenAt:H,lastSeenBucket:b}}}function _(L,H){if(H.isOnline)o.value=new Set([...o.value,L]);else{const b=new Set(o.value);b.delete(L),o.value=b}s.value={...s.value,[L]:H}}function O(L){return s.value[L]}function W(L){return o.value.has(L)}return{chats:e,activeChatId:a,activeChat:i,sortedChats:l,typingUsers:n,loadChats:r,setActiveChat:m,toggleFavorite:k,toggleMute:f,togglePin:d,toggleArchive:c,leave:v,updateChatLastMessage:g,incrementUnread:p,setTyping:S,clearTyping:C,getTypingUsernames:$,onlineUsers:o,userPresenceDetails:s,setUserOnline:x,setUserOffline:j,setUserPresence:_,getUserPresence:O,isUserOnline:W}});async function ua(){const{data:e}=await G.get("/settings");return e}async function da(e){await G.put("/settings",e)}const Wt=ze("settings",()=>{const e=y(localStorage.getItem("theme")||"light"),a=y(!0),n=y("en"),o=y("everyone");function s(r){e.value=r,document.body.setAttribute("data-theme",r),localStorage.setItem("theme",r)}async function i(){try{const r=await ua();s(r.theme||"light"),a.value=r.notifications_enabled,n.value=r.language||"en",o.value=r.last_seen_visibility||"everyone"}catch(r){console.error("Failed to load settings",r)}}async function l(r){await da(r),r.theme&&s(r.theme),r.notifications_enabled!==void 0&&(a.value=r.notifications_enabled),r.language&&(n.value=r.language),r.last_seen_visibility&&(o.value=r.last_seen_visibility)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:a,language:n,lastSeenVisibility:o,applyTheme:s,loadSettings:i,saveSettings:l}}),qt=ze("selection",()=>{const e=y(new Set),a=y(!1),n=y(null),o=z(()=>e.value.size);function s(k,f){a.value=!0,n.value=k,e.value=new Set(f!=null?[f]:[])}function i(){a.value=!1,n.value=null,e.value=new Set}function l(k){const f=new Set(e.value);f.has(k)?f.delete(k):f.add(k),e.value=f,f.size===0&&i()}function r(){e.value=new Set}function m(k){return e.value.has(k)}return{selectedMessageIds:e,selectionMode:a,currentChatId:n,selectedCount:o,enterSelectionMode:s,exitSelectionMode:i,toggleMessage:l,clearSelection:r,isSelected:m}});async function mt(e,a){const{data:n}=await G.get(`/chats/${e}/messages`,{params:a});return n}async function va(e,a){const{data:n}=await G.post(`/chats/${e}/messages`,a);return n}async function ma(e,a){await G.delete(`/chats/${e}/messages/${a}`)}async function fa(e,a,n){const{data:o}=await G.put(`/chats/${e}/messages/${a}`,{content:n});return o}async function pa(e,a){const{data:n}=await G.post(`/chats/${e}/messages/forward`,a);return n}async function ha(e,a){const{data:n}=await G.post(`/chats/${e}/messages/${a}/pin`);return n}async function ga(e,a){await G.delete(`/chats/${e}/messages/${a}/pin`)}async function ya(e){const{data:a}=await G.get(`/chats/${e}/pinned-message`);return a}async function Un(e,a,n){const{data:o}=await G.get(`/chats/${e}/messages/search`,{params:{q:a,...n}});return o}async function ba(e,a,n){const{data:o}=await G.post(`/chats/${e}/messages/${a}/reactions`,{emoji:n});return o}async function ka(e,a){if(!a.length)return{};const{data:n}=await G.get(`/chats/${e}/reactions`,{params:{message_ids:a.join(",")}});return n}const Gt=ze("messages",()=>{const e=y({}),a=y({}),n=y(null),o=y({}),s=y(new Set);async function i(b){const T=e.value[b];if(!T||T.length===0)return;const F=T.map(D=>D.id);try{const D=await ka(b,F);for(const E of T)E.reactions=D[String(E.id)]||void 0}catch(D){console.error("Failed to load reactions",D)}}async function l(b){n.value=b;try{const T=await mt(b,{limit:50});e.value[b]=T,T.length>0&&(a.value[b]=Math.max(...T.map(F=>F.id))),await i(b)}catch(T){throw console.error("Failed to load messages",T),T}finally{n.value=null}}async function r(b){const T=a.value[b]||0;if(T===0)return[];try{const F=await mt(b,{after_id:T,limit:50});if(F.length>0){e.value[b]||(e.value[b]=[]);const D=new Set(e.value[b].map(U=>U.id)),E=F.filter(U=>!D.has(U.id));e.value[b].push(...E),a.value[b]=Math.max(...F.map(U=>U.id)),await i(b)}return F}catch(F){return console.error("Failed to load newer messages",F),[]}}async function m(b){const T=e.value[b];if(!T||T.length===0)return[];const F=T[0];if(!F)return[];try{const D=await mt(b,{before:F.created_at,limit:50});if(D.length>0){const E=new Set(T.map(J=>J.id)),U=D.filter(J=>!E.has(J.id));e.value[b]=[...U,...T],await i(b)}return D}catch(D){return console.error("Failed to load older messages",D),[]}}async function k(b,T,F){try{const D=await ba(b,T,F);f(b,T,D.action,F,!0)}catch(D){console.error("Failed to toggle reaction",D)}}function f(b,T,F,D,E){const U=e.value[b];if(!U)return;const J=U.find(Se=>Se.id===T);if(!J)return;J.reactions||(J.reactions=[]);const oe=J.reactions.find(Se=>Se.emoji===D);F==="added"?oe?(oe.count++,E&&(oe.me=!0)):J.reactions.push({emoji:D,count:1,me:E}):oe&&(oe.count--,E&&(oe.me=!1),oe.count<=0&&(J.reactions=J.reactions.filter(Se=>Se.emoji!==D))),J.reactions.length===0&&(J.reactions=void 0)}async function d(b,T,F="text",D){const E=await va(b,{content:T,type:F,...D});e.value[b]||(e.value[b]=[]);const U=e.value[b].findIndex(J=>J.id===E.id);return U!==-1?e.value[b][U]=E:e.value[b].push(E),a.value[b]=Math.max(a.value[b]||0,E.id),E}function c(b,T){if(!T.reply_to_message_id||T.reply_to_sender_username||T.reply_to_sender_name)return;const F=e.value[b];if(!F)return;const D=F.find(E=>E.id===T.reply_to_message_id);D&&(T.reply_to_sender_username=D.sender_username,T.reply_to_sender_name=D.sender_display_name||D.sender_username,!T.reply_to_content&&D.content&&(T.reply_to_content=D.content),!T.reply_to_type&&D.message_type&&(T.reply_to_type=D.message_type))}function v(b,T){e.value[b]||(e.value[b]=[]),e.value[b].find(D=>D.id===T.id)||(c(b,T),e.value[b].push(T),a.value[b]=Math.max(a.value[b]||0,T.id))}async function g(b,T){try{await ma(b,T),p(b,T)}catch(F){throw console.error("Failed to delete message",F),F}}function p(b,T){const F=e.value[b];F&&(e.value[b]=F.filter(D=>D.id!==T))}async function S(b,T,F){try{const D=await fa(b,T,F);C(b,T,D.content,D.updated_at)}catch(D){throw console.error("Failed to edit message",D),D}}function C(b,T,F,D){const E=e.value[b];if(!E)return;const U=E.find(J=>J.id===T);U&&(U.content=F,U.is_edited=!0,D&&(U.updated_at=D))}async function $(b,T,F){try{const D=await pa(b,{from_chat_id:T,message_ids:F});for(const E of D)v(b,E);return D}catch(D){throw console.error("Failed to forward messages",D),D}}async function x(b){try{const T=await ya(b);T&&T.message?o.value[b]={message:T.message,pinnedAt:T.pinned_at,pinnedBy:T.pinned_by}:o.value[b]=null}catch(T){console.error("Failed to load pinned message",T),o.value[b]=null}}async function j(b,T){try{const F=await ha(b,T);o.value[b]={message:F.message,pinnedAt:F.pinned_at,pinnedBy:F.pinned_by},s.value.delete(b)}catch(F){throw console.error("Failed to pin message",F),F}}async function _(b,T){try{await ga(b,T),o.value[b]=null}catch(F){throw console.error("Failed to unpin message",F),F}}function O(b,T,F,D){o.value[b]={message:D,pinnedAt:new Date().toISOString(),pinnedBy:F},s.value.delete(b)}function W(b){o.value[b]=null}function L(b){s.value.add(b)}function H(b){return e.value[b]||[]}return{messagesByChat:e,lastMsgId:a,loadingChat:n,loadMessages:l,loadNewer:r,loadOlder:m,sendMessage:d,pushMessage:v,getMessages:H,toggleReaction:k,applyReactionUpdate:f,deleteMessage:g,removeMessage:p,editMessage:S,applyMessageUpdate:C,forwardMessages:$,pinnedByChat:o,pinnedDismissed:s,loadPinnedMessage:x,pinMsg:j,unpinMsg:_,applyMessagePinned:O,applyMessageUnpinned:W,dismissPin:L}});function wa(e,a,n){if(!document.hidden||e.sender_id===n.user?.id||!Wt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||a.chats.find(m=>m.id===e.chat_id)?.is_muted)return;const i=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(i,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),a.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function _a(){const e=y(!1);let a=null,n=null,o=null,s=1e3,i=!1;function l(){const p=localStorage.getItem("access_token");return p?`wss://ws.behappy.rest/ws?token=${encodeURIComponent(p)}`:null}function r(){if(a&&(a.readyState===WebSocket.OPEN||a.readyState===WebSocket.CONNECTING))return;const p=l();p&&(i=!1,a=new WebSocket(p),a.onopen=()=>{e.value=!0,s=1e3;const S=localStorage.getItem("access_token");S&&a.send(JSON.stringify({type:"auth",token:S}));const C=be();for(const $ of C.chats)a.send(JSON.stringify({type:"subscribe",chat_id:$.id}));k()},a.onmessage=S=>{try{const C=JSON.parse(S.data);m(C)}catch{}},a.onclose=()=>{e.value=!1,f(),i||d()},a.onerror=()=>{})}function m(p){const S=Gt(),C=be(),$=Oe();switch(p.type){case"message":{const x=p;S.pushMessage(x.chat_id,x),C.updateChatLastMessage(x.chat_id,x.content||(x.message_type==="sticker"?"Sticker":"Attachment"),x.created_at),x.chat_id!==C.activeChatId&&x.sender_id!==$.user?.id&&C.incrementUnread(x.chat_id),C.clearTyping(x.chat_id,x.sender_id),wa(x,C,$);break}case"typing":{const x=p.chat_id,j=p.user_id;if(j!==$.user?.id){const _=p.username||"Someone";C.setTyping(x,j,_)}break}case"pong":break;case"presence":{const x=p.user_id,j=p.status,_=p.last_seen_at,O=p.last_seen_bucket;j==="online"?C.setUserOnline(x):j==="offline"&&C.setUserOffline(x,_,O);break}case"message_deleted":{const x=p.chat_id,j=p.message_id;S.removeMessage(x,j);break}case"message_updated":{const x=p.chat_id,j=p.message_id,_=p.content,O=p.updated_at;S.applyMessageUpdate(x,j,_,O);break}case"message_pinned":{const x=p.chat_id,j=p.message_id,_=p.pinned_by,O=p.message;S.applyMessagePinned(x,j,_,O);break}case"message_unpinned":{const x=p.chat_id;S.applyMessageUnpinned(x);break}case"reaction":{const x=p.chat_id,j=p.message_id,_=p.user_id,O=p.emoji,W=p.action;S.applyReactionUpdate(x,j,W,O,_===$.user?.id);break}}}function k(){f(),o=setInterval(()=>{a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"ping"}))},25e3)}function f(){o&&(clearInterval(o),o=null)}function d(){n||(n=setTimeout(()=>{n=null,r(),s=Math.min(s*2,3e4)},s))}function c(p){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"subscribe",chat_id:p}))}function v(p){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"typing",chat_id:p}))}function g(){i=!0,f(),n&&(clearTimeout(n),n=null),a&&(a.close(),a=null),e.value=!1}return Fe(()=>{g()}),{connected:e,connect:r,disconnect:g,subscribeToChat:c,sendTyping:v}}async function ss(e){const{data:a}=await G.get(`/users/${e}`);return a}async function as(e){const{data:a}=await G.get(`/users/by-username/${encodeURIComponent(e)}`);return a}async function Fn(e){const{data:a}=await G.get("/users/search",{params:{q:e}});return a}async function Ca(e,a){const{data:n}=await G.put(`/users/${e}`,a);return n}async function $a(e){const{data:a}=await G.put("/users/me/avatar",{file_id:e});return a}async function Sa(){const{data:e}=await G.get("/stickers");return e}const Ma=e=>{for(const a in e)if(a.startsWith("aria-")||a==="role"||a==="title")return!0;return!1};const Hn=e=>e==="";const xa=(...e)=>e.filter((a,n,o)=>!!a&&a.trim()!==""&&o.indexOf(a)===n).join(" ").trim();const jn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const Ta=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,n,o)=>o?o.toUpperCase():n.toLowerCase());const Ea=e=>{const a=Ta(e);return a.charAt(0).toUpperCase()+a.slice(1)};var qe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Ia=({name:e,iconNode:a,absoluteStrokeWidth:n,"absolute-stroke-width":o,strokeWidth:s,"stroke-width":i,size:l=qe.width,color:r=qe.stroke,...m},{slots:k})=>ln("svg",{...qe,...m,width:l,height:l,stroke:r,"stroke-width":Hn(n)||Hn(o)||n===!0||o===!0?Number(s||i||qe["stroke-width"])*24/Number(l):s||i||qe["stroke-width"],class:xa("lucide",m.class,...e?[`lucide-${jn(Ea(e))}-icon`,`lucide-${jn(e)}`]:["lucide-icon"]),...!k.default&&!Ma(m)&&{"aria-hidden":"true"}},[...a.map(f=>ln(...f)),...k.default?[k.default()]:[]]);const se=(e,a)=>(n,{slots:o,attrs:s})=>ln(Ia,{...s,...n,iconNode:a,name:e},o);const Ue=se("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const La=se("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const Aa=se("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const os=se("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Da=se("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const Ra=se("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Oa=se("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Na=se("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const Pa=se("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const Ua=se("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const yn=se("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const is=se("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const Fa=se("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const Ha=se("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const ja=se("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const Ba=se("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const za=se("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Va=se("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Wa=se("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const qa=se("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const ls=se("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const rs=se("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const bn=se("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const Ne=se("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ga={class:"swipe-actions swipe-actions-left"},Ka={class:"chat-item-info"},Ja={class:"chat-item-top"},Qa={class:"chat-item-name"},Ya={key:0,class:"pin-icon",title:"Pinned"},Xa={key:1,class:"ci-channel"},Za={key:2,class:"ci-group"},eo={key:3,class:"mute-icon",title:"Muted"},to={class:"chat-item-time"},no={class:"chat-item-bottom"},so={class:"chat-item-preview"},ao=["title"],oo={class:"swipe-actions swipe-actions-right"},Bn=70,io=Y({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:a}){const n=e,o=be(),s=z(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:o.isUserOnline(n.chat.other_user_id)||null),i=z(()=>(n.chat.unread_count??0)>0),l=a,r=z(()=>{const p=n.chat;return p.type==="channel"||p.type==="group"?p.title||p.name||"Untitled":p.other_display_name||p.other_username||p.title||p.name||"Chat"});function m(p){if(!p)return"";const S=new Date(p.endsWith("Z")?p:p+"Z"),C=new Date;return S.toDateString()===C.toDateString()?S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):S.toLocaleDateString([],{month:"short",day:"numeric"})}const k=y(0);let f=0,d=!1;function c(p){f=p.touches[0].clientX,d=!0}function v(p){if(!d)return;const S=p.touches[0].clientX-f;k.value=Math.max(-Bn,Math.min(Bn,S))}function g(){d=!1,k.value=0}return(p,S)=>(u(),h("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:c,onTouchmove:v,onTouchend:g},[t("div",Ga,[t("button",{class:"swipe-action swipe-pin",onClick:S[0]||(S[0]=C=>l("togglePin"))},A(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:le(["chat-item",{active:e.active,"chat-item-unread":i.value}]),style:Vt({transform:`translateX(${k.value}px)`}),onClick:S[2]||(S[2]=C=>l("select")),onContextmenu:S[3]||(S[3]=ne(C=>l("contextmenu",C),["prevent"]))},[B(me,{name:r.value,url:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"sm",online:s.value},null,8,["name","url","online"]),t("div",Ka,[t("div",Ja,[t("span",Qa,[e.chat.is_pinned?(u(),h("span",Ya,"ğŸ“Œ")):P("",!0),e.chat.type==="channel"?(u(),h("span",Xa)):e.chat.type==="group"?(u(),h("span",Za)):P("",!0),he(" "+A(r.value)+" ",1),e.chat.is_muted?(u(),h("span",eo,"ğŸ””")):P("",!0)]),t("span",to,A(m(e.chat.last_at||e.chat.updated_at)),1)]),t("div",no,[t("span",so,A(e.chat.last_message||""),1),e.chat.unread_count>0?(u(),h("span",{key:0,class:le(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},A(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):P("",!0)])]),t("button",{class:le(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:S[1]||(S[1]=ne(C=>l("toggleFavorite"),["stop"]))},"â˜…",10,ao)],38),t("div",oo,[t("button",{class:"swipe-action swipe-mute",onClick:S[4]||(S[4]=C=>l("toggleMute"))},A(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),re=(e,a)=>{const n=e.__vccOpts||e;for(const[o,s]of a)n[o]=s;return n},Zt=re(io,[["__scopeId","data-v-06a66b74"]]),lo={class:"sidebar"},ro={class:"sidebar-header"},co={class:"search-wrap"},uo={class:"chat-list"},vo={key:0,class:"empty-state-small"},mo={key:0,class:"chat-section-label"},fo={key:1,class:"chat-section-label"},po={key:2,class:"chat-section-label"},ho=Y({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:a}){const n=a,o=be(),s=y(""),i=z(()=>{const c=s.value.toLowerCase(),v=o.sortedChats.filter(g=>!g.is_archived);return c?v.filter(g=>{const p=k(g).toLowerCase(),S=(g.other_username||"").toLowerCase();return p.includes(c)||S.includes(c)}):v}),l=z(()=>i.value.filter(c=>c.is_pinned&&!c.is_favorite)),r=z(()=>i.value.filter(c=>c.is_favorite&&!c.is_pinned)),m=z(()=>i.value.filter(c=>!c.is_favorite&&!c.is_pinned));function k(c){return c.type==="channel"||c.type==="group"?c.title||c.name||"Untitled":c.other_display_name||c.other_username||c.title||c.name||"Chat"}const f=y(null);dt("contextChatId",f);function d(c,v){c.preventDefault(),f.value=v,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:c.clientX,y:c.clientY,chatId:v}}))}return(c,v)=>(u(),h("aside",lo,[t("header",ro,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:v[0]||(v[0]=g=>n("openDrawer"))},[B(M(Fa),{size:20})]),t("div",co,[ee(t("input",{"onUpdate:modelValue":v[1]||(v[1]=g=>s.value=g),class:"search-input",type:"search",placeholder:"Search chats..."},null,512),[[ie,s.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:v[2]||(v[2]=g=>n("openNewChat"))},[B(M(Wa),{size:20})])]),t("div",uo,[i.value.length===0?(u(),h("div",vo,[...v[3]||(v[3]=[he(" No conversations yet.",-1),t("br",null,null,-1),he("Click the pencil icon to start one. ",-1)])])):(u(),h(te,{key:1},[l.value.length>0?(u(),h("div",mo,"Pinned")):P("",!0),(u(!0),h(te,null,ue(l.value,g=>(u(),Q(Zt,{key:g.id,chat:g,active:g.id===M(o).activeChatId,onSelect:p=>n("selectChat",g.id),onToggleFavorite:p=>M(o).toggleFavorite(g.id),onTogglePin:p=>M(o).togglePin(g.id),onToggleMute:p=>M(o).toggleMute(g.id),onToggleArchive:p=>M(o).toggleArchive(g.id),onContextmenu:p=>d(p,g.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(u(),h("div",fo,"Starred")):P("",!0),(u(!0),h(te,null,ue(r.value,g=>(u(),Q(Zt,{key:g.id,chat:g,active:g.id===M(o).activeChatId,onSelect:p=>n("selectChat",g.id),onToggleFavorite:p=>M(o).toggleFavorite(g.id),onTogglePin:p=>M(o).togglePin(g.id),onToggleMute:p=>M(o).toggleMute(g.id),onToggleArchive:p=>M(o).toggleArchive(g.id),onContextmenu:p=>d(p,g.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&m.value.length>0?(u(),h("div",po," All chats ")):P("",!0),(u(!0),h(te,null,ue(m.value,g=>(u(),Q(Zt,{key:g.id,chat:g,active:g.id===M(o).activeChatId,onSelect:p=>n("selectChat",g.id),onToggleFavorite:p=>M(o).toggleFavorite(g.id),onTogglePin:p=>M(o).togglePin(g.id),onToggleMute:p=>M(o).toggleMute(g.id),onToggleArchive:p=>M(o).toggleArchive(g.id),onContextmenu:p=>d(p,g.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function go(){const e=y(!1),a=y(0);let n=null,o=[],s=null;async function i(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const f=await navigator.mediaDevices.getUserMedia({audio:!0});o=[],a.value=0,n=new MediaRecorder(f),n.ondataavailable=d=>{d.data.size&&o.push(d.data)},n.start(),e.value=!0,s=setInterval(()=>{a.value++},1e3)}function l(){return new Promise((f,d)=>{if(!n||n.state!=="recording"){d(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(S=>S.stop()),m(),e.value=!1;const c=n?.mimeType||"audio/webm",v=c.includes("ogg")?"ogg":"webm",g=new Blob(o,{type:c}),p=new File([g],`voice.${v}`,{type:c});f(p)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(f=>f.stop())},n.stop()),m(),e.value=!1,a.value=0}function m(){s&&(clearInterval(s),s=null)}function k(f){const d=Math.floor(f/60),c=f%60;return`${d}:${String(c).padStart(2,"0")}`}return{isRecording:e,seconds:a,startRecording:i,stopRecording:l,cancelRecording:r,formatTime:k}}async function kn(e){const a=new FormData;a.append("file",e);const{data:n}=await G.post("/files",a);return n}const yo={class:"pin-bar-content"},bo={class:"pin-bar-sender"},ko={class:"pin-bar-text"},wo=Y({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const a=e,n=z(()=>a.message.sender_display_name||a.message.sender_username||"Unknown"),o=z(()=>{const s=a.message;switch(s.message_type){case"sticker":return s.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return s.content||""}});return(s,i)=>(u(),h("div",{class:"pin-bar",onClick:i[1]||(i[1]=l=>s.$emit("click"))},[i[2]||(i[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",yo,[t("span",bo,A(n.value),1),t("span",ko,A(o.value),1)]),t("button",{class:"pin-bar-close",onClick:i[0]||(i[0]=ne(l=>s.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}});function _o(e){const a=new Date(e),o=new Date().getTime()-a.getTime(),s=Math.floor(o/1e3),i=Math.floor(s/60),l=Math.floor(i/60),r=Math.floor(l/24);if(i<1)return"last seen just now";if(i<60)return`last seen ${i} minute${i!==1?"s":""} ago`;if(l<24)return`last seen ${l} hour${l!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const m=a.toLocaleString("en",{month:"short"}),k=a.getDate();return`last seen ${m} ${k}`}const Co={class:"chat-header"},$o={class:"chat-header-name"},So=Y({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:a}){const n=a,o=be(),s=z(()=>o.activeChat),i=z(()=>{const c=s.value;return c?c.type==="channel"||c.type==="group"?c.title||c.name||"Untitled":c.other_display_name||c.other_username||c.title||c.name||"Chat":"---"}),l=z(()=>{const c=s.value;if(c)return c.type==="direct"?c.other_avatar_url:c.avatar_url}),r=z(()=>s.value?o.getTypingUsernames(s.value.id):[]),m=z(()=>r.value.length>0),k=z(()=>{const c=s.value;return!c||c.type!=="direct"||!c.other_user_id?!1:o.isUserOnline(c.other_user_id)}),f=z(()=>{if(r.value.length===1)return`${r.value[0]} is typing...`;if(r.value.length>1)return`${r.value.length} people typing...`;const c=s.value;if(!c)return"";if(c.type==="channel"){const v=c.member_count??0;return`${v} subscriber${v!==1?"s":""}`}if(c.type==="group"){const v=c.member_count??0;return`${v} member${v!==1?"s":""}`}if(k.value)return"online";if(c.type==="direct"&&c.other_user_id){const v=o.getUserPresence(c.other_user_id);if(v){if(v.lastSeenAt)return _o(v.lastSeenAt);if(v.lastSeenBucket)return`last seen ${v.lastSeenBucket}`}}return c.other_username?"@"+c.other_username:""});Ee(()=>s.value?.id,()=>{const c=s.value;if(!c||c.type!=="direct"||!c.other_user_id)return;const v=c.other_user_id;o.getUserPresence(v)||ss(v).then(g=>{g.last_activity&&o.setUserPresence(v,{isOnline:o.isUserOnline(v),lastSeenAt:g.last_activity})}).catch(()=>{})},{immediate:!0});function d(){const c=s.value;c&&(c.type==="channel"||c.type==="group"?n("openChannelInfo"):c.type==="direct"&&c.other_username&&n("openUserProfile",c.other_username))}return(c,v)=>(u(),h("header",Co,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:v[0]||(v[0]=g=>n("back"))},"â†"),B(me,{class:"chat-header-avatar",name:i.value,url:l.value,online:k.value,size:"sm",onClick:d},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:d},[t("div",$o,A(i.value),1),f.value?(u(),h("div",{key:0,class:le(["chat-header-sub",{"typing-text":m.value,"online-text":k.value&&!m.value}])},A(f.value),3)):P("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:v[1]||(v[1]=g=>n("openSearch"))},"ğŸ”")]))}}),Mo="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",xo="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",cn="numeric",un="ascii",dn="alpha",Qe="asciinumeric",Ke="alphanumeric",vn="domain",cs="emoji",To="scheme",Eo="slashscheme",en="whitespace";function Io(e,a){return e in a||(a[e]=[]),a[e]}function Pe(e,a,n){a[cn]&&(a[Qe]=!0,a[Ke]=!0),a[un]&&(a[Qe]=!0,a[dn]=!0),a[Qe]&&(a[Ke]=!0),a[dn]&&(a[Ke]=!0),a[Ke]&&(a[vn]=!0),a[cs]&&(a[vn]=!0);for(const o in a){const s=Io(o,n);s.indexOf(e)<0&&s.push(e)}}function Lo(e,a){const n={};for(const o in a)a[o].indexOf(e)>=0&&(n[o]=!0);return n}function pe(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}pe.groups={};pe.prototype={accepts(){return!!this.t},go(e){const a=this,n=a.j[e];if(n)return n;for(let o=0;o<a.jr.length;o++){const s=a.jr[o][0],i=a.jr[o][1];if(i&&s.test(e))return i}return a.jd},has(e,a=!1){return a?e in this.j:!!this.go(e)},ta(e,a,n,o){for(let s=0;s<e.length;s++)this.tt(e[s],a,n,o)},tr(e,a,n,o){o=o||pe.groups;let s;return a&&a.j?s=a:(s=new pe(a),n&&o&&Pe(a,n,o)),this.jr.push([e,s]),s},ts(e,a,n,o){let s=this;const i=e.length;if(!i)return s;for(let l=0;l<i-1;l++)s=s.tt(e[l]);return s.tt(e[i-1],a,n,o)},tt(e,a,n,o){o=o||pe.groups;const s=this;if(a&&a.j)return s.j[e]=a,a;const i=a;let l,r=s.go(e);if(r?(l=new pe,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new pe,i){if(o)if(l.t&&typeof l.t=="string"){const m=Object.assign(Lo(l.t,o),n);Pe(i,m,o)}else n&&Pe(i,n,o);l.t=i}return s.j[e]=l,l}};const q=(e,a,n,o,s)=>e.ta(a,n,o,s),ae=(e,a,n,o,s)=>e.tr(a,n,o,s),zn=(e,a,n,o,s)=>e.ts(a,n,o,s),I=(e,a,n,o,s)=>e.tt(a,n,o,s),Te="WORD",mn="UWORD",us="ASCIINUMERICAL",ds="ALPHANUMERICAL",nt="LOCALHOST",fn="TLD",pn="UTLD",ft="SCHEME",Be="SLASH_SCHEME",wn="NUM",hn="WS",_n="NL",Ye="OPENBRACE",Xe="CLOSEBRACE",gt="OPENBRACKET",yt="CLOSEBRACKET",bt="OPENPAREN",kt="CLOSEPAREN",wt="OPENANGLEBRACKET",_t="CLOSEANGLEBRACKET",Ct="FULLWIDTHLEFTPAREN",$t="FULLWIDTHRIGHTPAREN",St="LEFTCORNERBRACKET",Mt="RIGHTCORNERBRACKET",xt="LEFTWHITECORNERBRACKET",Tt="RIGHTWHITECORNERBRACKET",Et="FULLWIDTHLESSTHAN",It="FULLWIDTHGREATERTHAN",Lt="AMPERSAND",At="APOSTROPHE",Dt="ASTERISK",De="AT",Rt="BACKSLASH",Ot="BACKTICK",Nt="CARET",Re="COLON",Cn="COMMA",Pt="DOLLAR",Ce="DOT",Ut="EQUALS",$n="EXCLAMATION",ye="HYPHEN",Ze="PERCENT",Ft="PIPE",Ht="PLUS",jt="POUND",et="QUERY",Sn="QUOTE",vs="FULLWIDTHMIDDLEDOT",Mn="SEMI",$e="SLASH",tt="TILDE",Bt="UNDERSCORE",ms="EMOJI",zt="SYM";var fs=Object.freeze({__proto__:null,ALPHANUMERICAL:ds,AMPERSAND:Lt,APOSTROPHE:At,ASCIINUMERICAL:us,ASTERISK:Dt,AT:De,BACKSLASH:Rt,BACKTICK:Ot,CARET:Nt,CLOSEANGLEBRACKET:_t,CLOSEBRACE:Xe,CLOSEBRACKET:yt,CLOSEPAREN:kt,COLON:Re,COMMA:Cn,DOLLAR:Pt,DOT:Ce,EMOJI:ms,EQUALS:Ut,EXCLAMATION:$n,FULLWIDTHGREATERTHAN:It,FULLWIDTHLEFTPAREN:Ct,FULLWIDTHLESSTHAN:Et,FULLWIDTHMIDDLEDOT:vs,FULLWIDTHRIGHTPAREN:$t,HYPHEN:ye,LEFTCORNERBRACKET:St,LEFTWHITECORNERBRACKET:xt,LOCALHOST:nt,NL:_n,NUM:wn,OPENANGLEBRACKET:wt,OPENBRACE:Ye,OPENBRACKET:gt,OPENPAREN:bt,PERCENT:Ze,PIPE:Ft,PLUS:Ht,POUND:jt,QUERY:et,QUOTE:Sn,RIGHTCORNERBRACKET:Mt,RIGHTWHITECORNERBRACKET:Tt,SCHEME:ft,SEMI:Mn,SLASH:$e,SLASH_SCHEME:Be,SYM:zt,TILDE:tt,TLD:fn,UNDERSCORE:Bt,UTLD:pn,UWORD:mn,WORD:Te,WS:hn});const Me=/[a-z]/,Ge=new RegExp("\\p{L}","u"),tn=new RegExp("\\p{Emoji}","u"),xe=/\d/,nn=/\s/,Vn="\r",sn=`
`,Ao="ï¸",Do="â€",an="ï¿¼";let rt=null,ct=null;function Ro(e=[]){const a={};pe.groups=a;const n=new pe;rt==null&&(rt=Wn(Mo)),ct==null&&(ct=Wn(xo)),I(n,"'",At),I(n,"{",Ye),I(n,"}",Xe),I(n,"[",gt),I(n,"]",yt),I(n,"(",bt),I(n,")",kt),I(n,"<",wt),I(n,">",_t),I(n,"ï¼ˆ",Ct),I(n,"ï¼‰",$t),I(n,"ã€Œ",St),I(n,"ã€",Mt),I(n,"ã€",xt),I(n,"ã€",Tt),I(n,"ï¼œ",Et),I(n,"ï¼",It),I(n,"&",Lt),I(n,"*",Dt),I(n,"@",De),I(n,"`",Ot),I(n,"^",Nt),I(n,":",Re),I(n,",",Cn),I(n,"$",Pt),I(n,".",Ce),I(n,"=",Ut),I(n,"!",$n),I(n,"-",ye),I(n,"%",Ze),I(n,"|",Ft),I(n,"+",Ht),I(n,"#",jt),I(n,"?",et),I(n,'"',Sn),I(n,"/",$e),I(n,";",Mn),I(n,"~",tt),I(n,"_",Bt),I(n,"\\",Rt),I(n,"ãƒ»",vs);const o=ae(n,xe,wn,{[cn]:!0});ae(o,xe,o);const s=ae(o,Me,us,{[Qe]:!0}),i=ae(o,Ge,ds,{[Ke]:!0}),l=ae(n,Me,Te,{[un]:!0});ae(l,xe,s),ae(l,Me,l),ae(s,xe,s),ae(s,Me,s);const r=ae(n,Ge,mn,{[dn]:!0});ae(r,Me),ae(r,xe,i),ae(r,Ge,r),ae(i,xe,i),ae(i,Me),ae(i,Ge,i);const m=I(n,sn,_n,{[en]:!0}),k=I(n,Vn,hn,{[en]:!0}),f=ae(n,nn,hn,{[en]:!0});I(n,an,f),I(k,sn,m),I(k,an,f),ae(k,nn,f),I(f,Vn),I(f,sn),ae(f,nn,f),I(f,an,f);const d=ae(n,tn,ms,{[cs]:!0});I(d,"#"),ae(d,tn,d),I(d,Ao,d);const c=I(d,Do);I(c,"#"),ae(c,tn,d);const v=[[Me,l],[xe,s]],g=[[Me,null],[Ge,r],[xe,i]];for(let p=0;p<rt.length;p++)Ae(n,rt[p],fn,Te,v);for(let p=0;p<ct.length;p++)Ae(n,ct[p],pn,mn,g);Pe(fn,{tld:!0,ascii:!0},a),Pe(pn,{utld:!0,alpha:!0},a),Ae(n,"file",ft,Te,v),Ae(n,"mailto",ft,Te,v),Ae(n,"http",Be,Te,v),Ae(n,"https",Be,Te,v),Ae(n,"ftp",Be,Te,v),Ae(n,"ftps",Be,Te,v),Pe(ft,{scheme:!0,ascii:!0},a),Pe(Be,{slashscheme:!0,ascii:!0},a),e=e.sort((p,S)=>p[0]>S[0]?1:-1);for(let p=0;p<e.length;p++){const S=e[p][0],$=e[p][1]?{[To]:!0}:{[Eo]:!0};S.indexOf("-")>=0?$[vn]=!0:Me.test(S)?xe.test(S)?$[Qe]=!0:$[un]=!0:$[cn]=!0,zn(n,S,S,$)}return zn(n,"localhost",nt,{ascii:!0}),n.jd=new pe(zt),{start:n,tokens:Object.assign({groups:a},fs)}}function ps(e,a){const n=Oo(a.replace(/[A-Z]/g,r=>r.toLowerCase())),o=n.length,s=[];let i=0,l=0;for(;l<o;){let r=e,m=null,k=0,f=null,d=-1,c=-1;for(;l<o&&(m=r.go(n[l]));)r=m,r.accepts()?(d=0,c=0,f=r):d>=0&&(d+=n[l].length,c++),k+=n[l].length,i+=n[l].length,l++;i-=d,l-=c,k-=d,s.push({t:f.t,v:a.slice(i-k,i),s:i-k,e:i})}return s}function Oo(e){const a=[],n=e.length;let o=0;for(;o<n;){let s=e.charCodeAt(o),i,l=s<55296||s>56319||o+1===n||(i=e.charCodeAt(o+1))<56320||i>57343?e[o]:e.slice(o,o+2);a.push(l),o+=l.length}return a}function Ae(e,a,n,o,s){let i;const l=a.length;for(let r=0;r<l-1;r++){const m=a[r];e.j[m]?i=e.j[m]:(i=new pe(o),i.jr=s.slice(),e.j[m]=i),e=i}return i=new pe(n),i.jr=s.slice(),e.j[a[l-1]]=i,i}function Wn(e){const a=[],n=[];let o=0,s="0123456789";for(;o<e.length;){let i=0;for(;s.indexOf(e[o+i])>=0;)i++;if(i>0){a.push(n.join(""));for(let l=parseInt(e.substring(o,o+i),10);l>0;l--)n.pop();o+=i}else n.push(e[o]),o++}return a}const st={defaultProtocol:"http",events:null,format:qn,formatHref:qn,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function xn(e,a=null){let n=Object.assign({},st);e&&(n=Object.assign(n,e instanceof xn?e.o:e));const o=n.ignoreTags,s=[];for(let i=0;i<o.length;i++)s.push(o[i].toUpperCase());this.o=n,a&&(this.defaultRender=a),this.ignoreTags=s}xn.prototype={o:st,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,a,n){const o=a!=null;let s=this.o[e];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:st[e],typeof s=="function"&&o&&(s=s(a,n))):typeof s=="function"&&o&&(s=s(a,n.t,n)),s)},getObj(e,a,n){let o=this.o[e];return typeof o=="function"&&a!=null&&(o=o(a,n.t,n)),o},render(e){const a=e.render(this);return(this.get("render",null,e)||this.defaultRender)(a,e.t,e)}};function qn(e){return e}function hs(e,a){this.t="token",this.v=e,this.tk=a}hs.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const a=this.toString(),n=e.get("truncate",a,this),o=e.get("format",a,this);return n&&o.length>n?o.substring(0,n)+"â€¦":o},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=st.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const a=this,n=this.toHref(e.get("defaultProtocol")),o=e.get("formatHref",n,this),s=e.get("tagName",n,a),i=this.toFormattedString(e),l={},r=e.get("className",n,a),m=e.get("target",n,a),k=e.get("rel",n,a),f=e.getObj("attributes",n,a),d=e.getObj("events",n,a);return l.href=o,r&&(l.class=r),m&&(l.target=m),k&&(l.rel=k),f&&Object.assign(l,f),{tagName:s,attributes:l,content:i,eventListeners:d}}};function Kt(e,a){class n extends hs{constructor(s,i){super(s,i),this.t=e}}for(const o in a)n.prototype[o]=a[o];return n.t=e,n}const Gn=Kt("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Kn=Kt("text"),No=Kt("nl"),ut=Kt("url",{isLink:!0,toHref(e=st.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==nt&&e[1].t===Re}}),ge=e=>new pe(e);function Po({groups:e}){const a=e.domain.concat([Lt,Dt,De,Rt,Ot,Nt,Pt,Ut,ye,wn,Ze,Ft,Ht,jt,$e,zt,tt,Bt]),n=[At,Re,Cn,Ce,$n,Ze,et,Sn,Mn,wt,_t,Ye,Xe,yt,gt,bt,kt,Ct,$t,St,Mt,xt,Tt,Et,It],o=[Lt,At,Dt,Rt,Ot,Nt,Pt,Ut,ye,Ye,Xe,Ze,Ft,Ht,jt,et,$e,zt,tt,Bt],s=ge(),i=I(s,tt);q(i,o,i),q(i,e.domain,i);const l=ge(),r=ge(),m=ge();q(s,e.domain,l),q(s,e.scheme,r),q(s,e.slashscheme,m),q(l,o,i),q(l,e.domain,l);const k=I(l,De);I(i,De,k),I(r,De,k),I(m,De,k);const f=I(i,Ce);q(f,o,i),q(f,e.domain,i);const d=ge();q(k,e.domain,d),q(d,e.domain,d);const c=I(d,Ce);q(c,e.domain,d);const v=ge(Gn);q(c,e.tld,v),q(c,e.utld,v),I(k,nt,v);const g=I(d,ye);I(g,ye,g),q(g,e.domain,d),q(v,e.domain,d),I(v,Ce,c),I(v,ye,g);const p=I(v,Re);q(p,e.numeric,Gn);const S=I(l,ye),C=I(l,Ce);I(S,ye,S),q(S,e.domain,l),q(C,o,i),q(C,e.domain,l);const $=ge(ut);q(C,e.tld,$),q(C,e.utld,$),q($,e.domain,l),q($,o,i),I($,Ce,C),I($,ye,S),I($,De,k);const x=I($,Re),j=ge(ut);q(x,e.numeric,j);const _=ge(ut),O=ge();q(_,a,_),q(_,n,O),q(O,a,_),q(O,n,O),I($,$e,_),I(j,$e,_);const W=I(r,Re),L=I(m,Re),H=I(L,$e),b=I(H,$e);q(r,e.domain,l),I(r,Ce,C),I(r,ye,S),q(m,e.domain,l),I(m,Ce,C),I(m,ye,S),q(W,e.domain,_),I(W,$e,_),I(W,et,_),q(b,e.domain,_),q(b,a,_),I(b,$e,_);const T=[[Ye,Xe],[gt,yt],[bt,kt],[wt,_t],[Ct,$t],[St,Mt],[xt,Tt],[Et,It]];for(let F=0;F<T.length;F++){const[D,E]=T[F],U=I(_,D);I(O,D,U),I(U,E,_);const J=ge(ut);q(U,a,J);const oe=ge();q(U,n),q(J,a,J),q(J,n,oe),q(oe,a,J),q(oe,n,oe),I(J,E,_),I(oe,E,_)}return I(s,nt,$),I(s,_n,No),{start:s,tokens:fs}}function Uo(e,a,n){let o=n.length,s=0,i=[],l=[];for(;s<o;){let r=e,m=null,k=null,f=0,d=null,c=-1;for(;s<o&&!(m=r.go(n[s].t));)l.push(n[s++]);for(;s<o&&(k=m||r.go(n[s].t));)m=null,r=k,r.accepts()?(c=0,d=r):c>=0&&c++,s++,f++;if(c<0)s-=f,s<o&&(l.push(n[s]),s++);else{l.length>0&&(i.push(on(Kn,a,l)),l=[]),s-=c,f-=c;const v=d.t,g=n.slice(s-f,s);i.push(on(v,a,g))}}return l.length>0&&i.push(on(Kn,a,l)),i}function on(e,a,n){const o=n[0].s,s=n[n.length-1].e,i=a.slice(o,s);return new e(i,n)}const de={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Fo(){de.scanner=Ro(de.customSchemes);for(let e=0;e<de.tokenQueue.length;e++)de.tokenQueue[e][1]({scanner:de.scanner});de.parser=Po(de.scanner.tokens);for(let e=0;e<de.pluginQueue.length;e++)de.pluginQueue[e][1]({scanner:de.scanner,parser:de.parser});return de.initialized=!0,de}function gs(e){return de.initialized||Fo(),Uo(de.parser.start,e,ps(de.scanner.start,e))}gs.scan=ps;function ys(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Ho(e){return e.replace(/"/g,"&quot;")}function jo(e){const a=[];for(const n in e){let o=e[n]+"";a.push(`${n}="${Ho(o)}"`)}return a.join(" ")}function Bo({tagName:e,attributes:a,content:n}){return`<${e} ${jo(a)}>${ys(n)}</${e}>`}function bs(e,a={}){a=new xn(a,Bo);const n=gs(e),o=[];for(let s=0;s<n.length;s++){const i=n[s];i.t==="nl"&&a.get("nl2br")?o.push(`<br>
`):!i.isLink||!a.check(i)?o.push(ys(i.toString())):o.push(a.render(i))}return o.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(a){return bs(this,a)}});const zo={},Vo={class:"admin-badge",title:"Admin"};function Wo(e,a){return u(),h("span",Vo,"âœ“")}const ks=re(zo,[["render",Wo]]);function qo(e){const{delay:a=500,scrollThreshold:n=5,onLongPress:o,onCancel:s}=e,i=y(!1);let l=null,r=0,m=0,k=!1;function f(){l&&(clearTimeout(l),l=null)}function d(p){r=p.clientX,m=p.clientY,k=!1,i.value=!0,f(),l=setTimeout(()=>{k=!0,o(p)},a)}function c(p){if(!l)return;const S=p.clientX-r,C=p.clientY-m;(Math.abs(S)>n||Math.abs(C)>n)&&g()}function v(){f(),i.value=!1}function g(){f(),i.value=!1,k||s?.()}return{isPressed:i,onPointerDown:d,onPointerUp:v,onPointerMove:c}}const Go=["data-message-id"],Ko={key:0,class:"selection-checkbox"},Jo=["checked"],Qo={key:1,class:"msg-sender-name"},Yo={class:"msg-content-wrap"},Xo={class:"msg-reply-quote-name"},Zo={class:"msg-reply-quote-text"},ei={key:1,class:"msg-bubble sticker-bubble"},ti=["src","alt"],ni={key:2,class:"msg-bubble"},si={class:"voice-player"},ai=["src"],oi={key:0,class:"voice-dur"},ii=["innerHTML"],li={key:4,class:"reaction-chips"},ri=["onClick"],ci={class:"reaction-emoji"},ui={class:"reaction-count"},di={class:"msg-time"},vi={key:0,class:"msg-edited-label"},mi=Y({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:a}){const n=e,o=a,s=qt(),i=be(),l=z(()=>s.isSelected(n.message.id)),{onPointerDown:r,onPointerUp:m,onPointerMove:k}=qo({delay:500,onLongPress(O){c(O.clientX,O.clientY)}}),f={onPointerdown:r,onPointerup:m,onPointermove:k};function d(O){if(s.selectionMode){s.toggleMessage(n.message.id);return}c(O.clientX,O.clientY)}function c(O,W){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:i.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:O,y:W}}))}function v(){s.selectionMode&&s.toggleMessage(n.message.id)}const g=Je("stickers",y([])),p=z(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const O=g.value.find(W=>W.id===n.message.sticker_id);if(O)return O.url}return""}),S=z(()=>n.message.attachment_url||""),C=z(()=>{const O=n.message.reply_to_type;if(O==="sticker")return"ğŸ¨ Sticker";if(O==="voice")return"ğŸ¤ Voice message";if(O==="file")return"ğŸ“ File";const W=n.message.reply_to_content||"";return W.length>80?W.slice(0,80)+"...":W}),$=z(()=>bs(n.message.content||"",{defaultProtocol:"https",target:"_blank",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(W,L,H)=>L||`<span class="mention" data-u="${H}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${H}'}))">@${H}</span>`));function x(O){if(!O)return"";const W=new Date(O.endsWith("Z")?O:O+"Z"),L=new Date;return W.toDateString()===L.toDateString()?W.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):W.toLocaleDateString([],{month:"short",day:"numeric"})}function j(O){const W=Math.floor(O/60),L=O%60;return`${W}:${String(L).padStart(2,"0")}`}function _(O){const W=O.target.getBoundingClientRect();o("openEmojiPicker",n.message.id,W.left,W.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(O=>{o("mentionClick",O.detail)})),(O,W)=>(u(),h("div",js({class:["msg-row",[e.isMine?"mine":"theirs",{selected:l.value}]],"data-message-id":e.message.id,onContextmenu:ne(d,["prevent"])},f,{onClick:v}),[M(s).selectionMode?(u(),h("div",Ko,[t("input",{type:"checkbox",checked:l.value,tabindex:"-1"},null,8,Jo)])):P("",!0),!e.isMine&&e.message.message_type!=="sticker"?(u(),h("div",Qo,[he(A(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(u(),Q(ks,{key:0})):P("",!0)])):P("",!0),t("div",Yo,[e.message.reply_to_message_id?(u(),h("div",{key:0,class:"msg-reply-quote",onClick:W[0]||(W[0]=ne(L=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[W[1]||(W[1]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",Xo,A(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",Zo,A(C.value),1)])])):P("",!0),e.message.message_type==="sticker"?(u(),h("div",ei,[t("img",{class:"sticker-img",src:p.value,alt:e.message.sticker_label||"sticker"},null,8,ti)])):e.message.message_type==="voice"?(u(),h("div",ni,[t("div",si,[t("audio",{controls:"",src:S.value},null,8,ai),e.message.duration_seconds?(u(),h("span",oi,A(j(e.message.duration_seconds)),1)):P("",!0)])])):(u(),h("div",{key:3,class:"msg-bubble",innerHTML:$.value},null,8,ii)),t("button",{class:"reaction-add-btn",onClick:ne(_,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(u(),h("div",li,[(u(!0),h(te,null,ue(e.message.reactions,L=>(u(),h("button",{key:L.emoji,class:le(["reaction-chip",{"reaction-mine":L.me}]),onClick:ne(H=>o("toggleReaction",e.message.id,L.emoji),["stop"])},[t("span",ci,A(L.emoji),1),t("span",ui,A(L.count),1)],10,ri))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:ne(_,["stop"])},"+")])):P("",!0)]),t("div",di,[e.message.is_edited?(u(),h("span",vi,"(edited)")):P("",!0),he(" "+A(x(e.message.created_at)),1)])],16,Go))}}),fi={class:"composer-wrapper"},pi={key:0,class:"reply-preview"},hi={class:"reply-preview-content"},gi={class:"reply-preview-sender"},yi={class:"reply-preview-text"},bi={key:1,class:"reply-preview edit-preview"},ki={class:"reply-preview-content"},wi={class:"reply-preview-text"},_i={class:"composer"},Ci=["onKeydown"],$i=Y({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(e,{expose:a,emit:n}){const o=e,s=n,i=y(""),l=y(null),r=y(null),m=y(null);let k=0;function f(){const $=i.value.trim();$&&(m.value?(s("editMessage",m.value.messageId,$),m.value=null):r.value?(s("send",$,{...r.value}),r.value=null):s("send",$),i.value="",C())}function d(){r.value=null,l.value?.focus()}function c(){m.value=null,i.value="",C(),l.value?.focus()}function v(){r.value?d():m.value&&c()}function g($){const x=$.detail;x&&(m.value=null,r.value={messageId:x.messageId,senderName:x.senderName||"Unknown",snippet:(x.text||"").slice(0,100)},fe(()=>l.value?.focus()))}function p($){const x=$.detail;x&&(r.value=null,m.value={messageId:x.messageId,snippet:(x.text||"").slice(0,100),fullText:x.text||""},i.value=m.value.fullText,fe(()=>{C(),l.value?.focus()}))}function S(){C();const $=Date.now();$-k>2e3&&i.value.trim().length>0&&(k=$,s("typing"))}function C(){const $=l.value;$&&($.style.height="auto",$.style.height=Math.min($.scrollHeight,120)+"px")}return ve(()=>{l.value?.focus(),window.addEventListener("reply-to-message",g),window.addEventListener("edit-message",p)}),Fe(()=>{window.removeEventListener("reply-to-message",g),window.removeEventListener("edit-message",p)}),Ee(()=>o.replyTo,$=>{$&&l.value?.focus()}),a({focus:()=>l.value?.focus()}),($,x)=>(u(),h("div",fi,[r.value?(u(),h("div",pi,[x[3]||(x[3]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",hi,[t("span",gi,A(r.value.senderName),1),t("span",yi,A(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:d},"âœ•")])):P("",!0),m.value?(u(),h("div",bi,[x[5]||(x[5]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",ki,[x[4]||(x[4]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",wi,A(m.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:c},"âœ•")])):P("",!0),t("div",_i,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:x[0]||(x[0]=j=>s("toggleStickers"))},"ğŸŒ"),ee(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":x[1]||(x[1]=j=>i.value=j),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[rn(ne(f,["exact","prevent"]),["enter"]),rn(v,["escape"])],onInput:S},null,40,Ci),[[ie,i.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:x[2]||(x[2]=j=>s("startRecording"))},"ğŸ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:f},"â¤")])]))}}),Si=re($i,[["__scopeId","data-v-df4ad9ba"]]),Mi={class:"sticker-grid"},xi=["title","onClick"],Ti=["src","alt"],Ei={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Ii=Y({__name:"StickerPicker",emits:["select"],setup(e,{emit:a}){const n=a,o=Je("stickers",y([])),s=z(()=>o.value);return(i,l)=>(u(),h("div",Mi,[(u(!0),h(te,null,ue(s.value,r=>(u(),h("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:m=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,Ti)],8,xi))),128)),s.value.length===0?(u(),h("div",Ei," No stickers available ")):P("",!0)]))}}),Li={},Ai={class:"msgs-loading"};function Di(e,a){return u(),h("div",Ai,"Loading...")}const Jn=re(Li,[["render",Di]]),Ri=["onClick"],Oi=Y({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:a}){const n=a,o=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(s,i)=>e.visible?(u(),h("div",{key:0,class:"emoji-picker",style:Vt({left:e.x+"px",top:e.y+"px"}),onClick:i[0]||(i[0]=ne(()=>{},["stop"]))},[(u(),h(te,null,ue(o,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},A(l),9,Ri)),64))],4)):P("",!0)}}),Ni=Y({__name:"MessageContextMenu",setup(e){const{showToast:a}=ke(),n=Oe(),o=Gt(),s=y(!1),i=y(0),l=y(0),r=y(null),m=y(null),k=y(""),f=y(""),d=y(""),c=y(null),v=z(()=>!c.value||!n.user?!1:c.value===n.user.id),g=z(()=>!m.value||!r.value?null:`${window.location.origin}/c/${m.value}/${r.value}`),p=z(()=>!m.value||!r.value?!1:o.pinnedByChat[m.value]?.message?.id===r.value);function S(T){r.value=T.detail.messageId,m.value=T.detail.chatId,k.value=T.detail.text||"",f.value=T.detail.messageType||"text",d.value=T.detail.senderName||"",c.value=T.detail.senderId??null,i.value=T.detail.x,l.value=T.detail.y,s.value=!0,requestAnimationFrame(()=>{const F=document.querySelector(".msg-context-menu");if(!F)return;const D=F.getBoundingClientRect();D.right>window.innerWidth&&(i.value=window.innerWidth-D.width-8),D.bottom>window.innerHeight&&(l.value=window.innerHeight-D.height-8)})}function C(){s.value&&(s.value=!1,r.value=null,m.value=null,k.value="",f.value="",d.value="",c.value=null)}ve(()=>{window.addEventListener("show-message-context-menu",S),document.addEventListener("click",C)}),Fe(()=>{window.removeEventListener("show-message-context-menu",S),document.removeEventListener("click",C)});function $(){s.value=!1}function x(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:r.value,chatId:m.value,senderName:d.value,text:k.value}}))}function j(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:r.value,chatId:m.value,text:k.value}}))}async function _(){$();try{await navigator.clipboard.writeText(k.value),a("Copied to clipboard")}catch{a("Failed to copy text")}}async function O(){if($(),!!g.value)try{await navigator.clipboard.writeText(g.value),a("Link copied")}catch{a("Failed to copy link")}}function W(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[r.value],chatId:m.value}}))}function L(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:r.value,chatId:m.value}}))}function H(){if($(),!r.value||!m.value)return;const T=p.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(T,{detail:{messageId:r.value,chatId:m.value}}))}function b(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:r.value,chatId:m.value}}))}return(T,F)=>(u(),Q(Yn,{to:"body"},[s.value?(u(),h("div",{key:0,class:"msg-context-menu",style:Vt({left:i.value+"px",top:l.value+"px"}),onClick:F[0]||(F[0]=ne(()=>{},["stop"])),onContextmenu:F[1]||(F[1]=ne(()=>{},["prevent"]))},[t("button",{class:"ctx-item",onClick:x}," Reply "),v.value&&f.value==="text"?(u(),h("button",{key:0,class:"ctx-item",onClick:j}," Edit ")):P("",!0),t("button",{class:"ctx-item",onClick:H},A(p.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:_}," Copy text "),g.value?(u(),h("button",{key:1,class:"ctx-item",onClick:O}," Copy link ")):P("",!0),t("button",{class:"ctx-item",onClick:W}," Forward "),t("button",{class:"ctx-item",onClick:L}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:b}," Delete ")],36)):P("",!0)]))}}),Pi=re(Ni,[["__scopeId","data-v-d52d68d5"]]),Ui={key:0,class:"selection-bar"},Fi={class:"selection-bar-count"},Hi={class:"selection-bar-actions"},ji=["disabled"],Bi=["disabled"],zi=Y({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:a}){const n=a,o=qt();return(s,i)=>(u(),Q(Xn,{name:"slide-down"},{default:gn(()=>[M(o).selectionMode?(u(),h("div",Ui,[t("button",{class:"selection-bar-btn cancel-btn",onClick:i[0]||(i[0]=l=>M(o).exitSelectionMode())}," Cancel "),t("span",Fi,A(M(o).selectedCount)+" selected",1),t("div",Hi,[t("button",{class:"selection-bar-btn forward-btn",disabled:M(o).selectedCount===0,onClick:i[1]||(i[1]=l=>n("forward"))}," Forward ("+A(M(o).selectedCount)+") ",9,ji),t("button",{class:"selection-bar-btn delete-btn",disabled:M(o).selectedCount===0,onClick:i[2]||(i[2]=l=>n("delete"))}," Delete ("+A(M(o).selectedCount)+") ",9,Bi)])])):P("",!0)]),_:1}))}}),Vi=re(zi,[["__scopeId","data-v-9ba988f2"]]),Wi=Y({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:a}){const n=a;function o(){n("close")}return(s,i)=>(u(),Q(Yn,{to:"body"},[B(Xn,{name:"bottom-sheet"},{default:gn(()=>[e.visible?(u(),h("div",{key:0,class:"bottom-sheet-backdrop",onClick:ne(o,["self"])},[t("div",{class:"bottom-sheet",onClick:i[0]||(i[0]=ne(()=>{},["stop"]))},[i[1]||(i[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),Zn(s.$slots,"default",{},void 0,!0)])])):P("",!0)]),_:3})]))}}),qi=re(Wi,[["__scopeId","data-v-2c2a0a15"]]),Gi={class:"modal"},Ki={class:"modal-header"},Ji={class:"modal-body"},Qi={class:"forward-chat-list"},Yi={key:0,class:"empty-state-small"},Xi=["onClick"],Zi={class:"forward-chat-info"},el={class:"forward-chat-name"},tl={class:"forward-chat-type"},nl={key:0,class:"forward-check"},sl={class:"modal-actions"},al=["disabled"],ol=Y({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:a}){const n=e,o=a,s=be(),i=Gt(),{showToast:l}=ke(),r=y(""),m=y(null),k=y(!1),f=z(()=>{const p=r.value.toLowerCase().trim(),S=s.sortedChats;return p?S.filter(C=>d(C).toLowerCase().includes(p)):S});function d(p){return p.type==="direct"?p.other_display_name||p.other_username||p.title||"Direct Chat":p.title||p.name||"Unnamed Chat"}function c(p){if(p.type==="direct")return p.other_avatar_url??void 0}function v(){}async function g(){if(m.value!==null){k.value=!0;try{await i.forwardMessages(m.value,n.fromChatId,n.messageIds),l("Message forwarded!"),o("forwarded",m.value)}catch{l("Failed to forward message")}finally{k.value=!1}}}return(p,S)=>(u(),h("div",{class:"modal-backdrop",onClick:S[2]||(S[2]=ne(C=>o("close"),["self"]))},[t("div",Gi,[t("div",Ki,[S[3]||(S[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:S[0]||(S[0]=C=>o("close"))},"âœ•")]),t("div",Ji,[ee(t("input",{"onUpdate:modelValue":S[1]||(S[1]=C=>r.value=C),class:"search-input",type:"search",placeholder:"Search chats...",onInput:v},null,544),[[ie,r.value]]),t("div",Qi,[f.value.length===0?(u(),h("div",Yi,"No chats found.")):P("",!0),(u(!0),h(te,null,ue(f.value,C=>(u(),h("div",{key:C.id,class:le(["forward-chat-item",{selected:m.value===C.id}]),onClick:$=>m.value=C.id},[B(me,{name:d(C),url:c(C),size:"sm"},null,8,["name","url"]),t("div",Zi,[t("div",el,A(d(C)),1),t("div",tl,A(C.type),1)]),m.value===C.id?(u(),h("span",nl,"âœ“")):P("",!0)],10,Xi))),128))]),t("div",sl,[t("button",{class:"btn btn-primary",disabled:m.value===null||k.value,onClick:g},A(k.value?"Forwarding...":"Forward"),9,al)])])])]))}}),il=re(ol,[["__scopeId","data-v-ce3f4600"]]),ll={class:"modal modal-sm"},rl={class:"modal-header"},cl={class:"modal-body"},ul={class:"delete-confirm-text"},dl={key:0,class:"delete-checkbox-label"},vl={class:"modal-actions"},ml=Y({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:a}){const n=a,o=y(!1);function s(){n("confirm",o.value)}return(i,l)=>(u(),h("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=ne(r=>n("close"),["self"]))},[t("div",ll,[t("div",rl,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",cl,[t("p",ul," Are you sure you want to delete "+A(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(u(),h("label",dl,[ee(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>o.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[es,o.value]]),l[5]||(l[5]=he(" Delete for everyone ",-1))])):P("",!0)]),t("div",vl,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:s},"Delete")])])]))}}),fl=re(ml,[["__scopeId","data-v-388dbae2"]]),at=ze("channel",()=>{const e=y(null),a=y([]),n=y(!1),o=z(()=>a.value.length),s=z(()=>a.value.filter(d=>d.role==="admin"||d.role==="owner").length),i=z(()=>{const d=Oe();return d.user?a.value.find(v=>v.id===d.user.id)?.role??null:null}),l=z(()=>i.value==="owner"),r=z(()=>i.value==="admin"||i.value==="owner");async function m(d){n.value=!0;try{e.value=await ns(d)}catch(c){console.error("Failed to load channel detail",c)}finally{n.value=!1}}async function k(d){try{a.value=await la(d)}catch(c){console.error("Failed to load channel members",c)}}async function f(d,c){try{e.value=await ca(d,c)}catch(v){throw console.error("Failed to update channel",v),v}}return{detail:e,members:a,loading:n,memberCount:o,adminCount:s,myRole:i,isOwner:l,isAdmin:r,loadDetail:m,loadMembers:k,updateChannel:f}}),pl=ze("invites",()=>{const e=y([]),a=y(!1);async function n(i){a.value=!0;try{e.value=await Vs(i)}catch(l){console.error("Failed to load invites",l)}finally{a.value=!1}}async function o(i){try{const l=await Ws(i);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function s(i){const l=[...e.value];e.value=e.value.filter(r=>r.token!==i);try{await qs(i)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:a,loadInvites:n,createInvite:o,revokeInvite:s}}),hl={class:"invite-links-view"},gl={class:"view-header"},yl={style:{padding:"0 1rem .5rem"}},bl=["disabled"],kl={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},wl={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},_l={key:2,class:"invite-list",style:{padding:"0 1rem"}},Cl={class:"invite-item-info"},$l={class:"invite-token"},Sl={class:"invite-date"},Ml={class:"invite-item-actions"},xl=["onClick"],Tl=["onClick"],El=Y({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=e,o=a,s=pl(),{showToast:i}=ke(),l=y(!1);function r(d){return new Date(d).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function m(d){const c=`${window.location.origin}/join/${d}`;navigator.clipboard&&navigator.clipboard.writeText(c).then(()=>i("Link copied!"))}async function k(){l.value=!0;try{await s.createInvite(n.chatId),i("Invite link created")}catch{i("Failed to create invite")}finally{l.value=!1}}async function f(d){try{await s.revokeInvite(d),i("Invite revoked")}catch{i("Failed to revoke invite")}}return ve(()=>s.loadInvites(n.chatId)),(d,c)=>(u(),h("div",hl,[t("div",gl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=v=>o("back"))},[B(M(Ue),{size:20,"stroke-width":2})]),c[1]||(c[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",yl,[t("button",{class:"btn btn-sm btn-outline",onClick:k,disabled:l.value},A(l.value?"Creating...":"Create Invite Link"),9,bl)]),M(s).loading?(u(),h("div",kl," Loading... ")):M(s).invites.length===0?(u(),h("div",wl," No active invite links ")):(u(),h("div",_l,[(u(!0),h(te,null,ue(M(s).invites,v=>(u(),h("div",{key:v.id,class:"invite-item"},[t("div",Cl,[t("code",$l,A(v.token),1),t("span",Sl,A(r(v.created_at)),1)]),t("div",Ml,[t("button",{class:"icon-btn",title:"Copy link",onClick:g=>m(v.token)},[B(M(Oa),{size:16,"stroke-width":2})],8,xl),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:g=>f(v.token)}," Revoke ",8,Tl)])]))),128))]))]))}}),Il=re(El,[["__scopeId","data-v-97b82dd0"]]);async function Ll(e,a){await G.post(`/chats/${e}/avatar`,{file_id:a})}async function Al(e,a){return(await G.post(`/chats/${e}/members/${a}/promote`)).data}async function Dl(e,a){return(await G.post(`/chats/${e}/members/${a}/demote`)).data}const Rl={class:"admins-view"},Ol={class:"view-header"},Nl={class:"search-bar"},Pl={key:0,class:"member-empty"},Ul={key:1,class:"member-list"},Fl=["onClick"],Hl={class:"member-info"},jl={class:"member-name"},Bl={class:"role-badge"},zl={class:"view-footer"},Vl={key:0,class:"member-empty"},Wl={key:1,class:"member-list"},ql={class:"member-info"},Gl={class:"member-name"},Kl=["onClick"],Jl={key:2,class:"view-footer"},Ql=Y({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=e,o=a,s=at(),i=y(!1),l=y(""),r=z(()=>s.members.filter(c=>c.role==="admin"||c.role==="owner")),m=z(()=>s.members.filter(c=>c.role==="member")),k=z(()=>{const c=l.value.toLowerCase().trim();return c?m.value.filter(v=>v.username.toLowerCase().includes(c)||v.display_name&&v.display_name.toLowerCase().includes(c)):m.value});async function f(c){try{await Al(n.chatId,c);const v=s.members.find(g=>g.id===c);v&&(v.role="admin"),i.value=!1,l.value=""}catch{}}async function d(c){try{await Dl(n.chatId,c);const v=s.members.find(g=>g.id===c);v&&(v.role="member")}catch{}}return(c,v)=>(u(),h("div",Rl,[t("div",Ol,[t("button",{class:"icon-btn","aria-label":"Back",onClick:v[0]||(v[0]=g=>o("back"))},[B(M(Ue),{size:20,"stroke-width":2})]),v[4]||(v[4]=t("span",{class:"view-title"},"Administrators",-1))]),i.value?(u(),h(te,{key:0},[t("div",Nl,[ee(t("input",{"onUpdate:modelValue":v[1]||(v[1]=g=>l.value=g),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ie,l.value]])]),k.value.length===0?(u(),h("div",Pl,A(l.value?"No members found":"No members to promote"),1)):(u(),h("div",Ul,[(u(!0),h(te,null,ue(k.value,g=>(u(),h("div",{key:g.id,class:"member-item member-item--selectable",onClick:p=>f(g.id)},[B(me,{name:g.display_name||g.username,url:g.avatar_url,size:"md"},null,8,["name","url"]),t("div",Hl,[t("span",jl,A(g.display_name||g.username),1),t("span",Bl,A(g.role),1)])],8,Fl))),128))])),t("div",zl,[t("button",{class:"btn btn--secondary",onClick:v[2]||(v[2]=g=>i.value=!1)},"Cancel")])],64)):(u(),h(te,{key:1},[r.value.length===0?(u(),h("div",Vl," No administrators found ")):(u(),h("div",Wl,[(u(!0),h(te,null,ue(r.value,g=>(u(),h("div",{key:g.id,class:"member-item"},[B(me,{name:g.display_name||g.username,url:g.avatar_url,size:"md"},null,8,["name","url"]),t("div",ql,[t("span",Gl,A(g.display_name||g.username),1),t("span",{class:le(["role-badge",`role-badge--${g.role}`])},A(g.role),3)]),M(s).isOwner&&g.role==="admin"?(u(),h("button",{key:0,class:"btn btn--small btn--danger",onClick:p=>d(g.id)}," Demote ",8,Kl)):P("",!0)]))),128))])),M(s).isOwner?(u(),h("div",Jl,[t("button",{class:"btn btn--primary",onClick:v[3]||(v[3]=g=>i.value=!0)},"Add Admin")])):P("",!0)],64))]))}}),Yl=re(Ql,[["__scopeId","data-v-2bd7c861"]]),Xl={class:"subscribers-view"},Zl={class:"view-header"},er={class:"search-bar"},tr={key:0,class:"member-empty"},nr={key:1,class:"member-list"},sr={class:"member-info"},ar={class:"member-name"},or=Y({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=a,o=at(),s=y(""),i=z(()=>{const l=s.value.toLowerCase().trim();return l?o.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):o.members});return(l,r)=>(u(),h("div",Xl,[t("div",Zl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=m=>n("back"))},[B(M(Ue),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",er,[ee(t("input",{"onUpdate:modelValue":r[1]||(r[1]=m=>s.value=m),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ie,s.value]])]),i.value.length===0?(u(),h("div",tr,A(s.value?"No members found":"No subscribers"),1)):(u(),h("div",nr,[(u(!0),h(te,null,ue(i.value,m=>(u(),h("div",{key:m.id,class:"member-item"},[B(me,{name:m.display_name||m.username,url:m.avatar_url,size:"md"},null,8,["name","url"]),t("div",sr,[t("span",ar,A(m.display_name||m.username),1),t("span",{class:le(["role-badge",`role-badge--${m.role}`])},A(m.role),3)])]))),128))]))]))}}),ir=re(or,[["__scopeId","data-v-f99a8a5f"]]),lr={class:"modal profile-modal"},rr={class:"profile-modal-body profile-modal-body--scrollable"},cr={class:"profile-avatar-section profile-avatar-upload-section"},ur={class:"profile-avatar-overlay"},dr={class:"profile-info-list"},vr={class:"form-group"},mr={class:"form-label"},fr=["placeholder"],pr={class:"form-group"},hr=["placeholder"],gr={key:0,class:"form-group"},yr={class:"form-label"},br={class:"type-selector"},kr={class:"type-option"},wr={class:"type-option"},_r={class:"profile-edit-actions"},Cr=["disabled"],$r=Y({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:a}){const n=e,o=a,s=at(),{showToast:i}=ke(),l=y(""),r=y(""),m=y(void 0),k=y("public"),f=y(!1),d=y(null),c=z(()=>s.detail?.type==="group"),v=z(()=>c.value?"Group":"Channel");ve(()=>{s.detail&&(l.value=s.detail.title||"",r.value=s.detail.description||"",m.value=s.detail.avatar_url??void 0,k.value=s.detail.public_name?"public":"private")});async function g(){const S=d.value?.files?.[0];if(S){try{const C=await kn(S);await Ll(n.chatId,C.id),m.value=URL.createObjectURL(S),i("Avatar updated!")}catch{i("Avatar upload failed")}d.value&&(d.value.value="")}}async function p(){if(!l.value.trim()){i(`${v.value} name is required`);return}f.value=!0;try{await s.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),i(`${v.value} updated!`),o("saved"),o("close")}catch{i(`Failed to update ${v.value.toLowerCase()}`)}finally{f.value=!1}}return(S,C)=>(u(),h("div",{class:"modal-backdrop profile-backdrop",onClick:C[7]||(C[7]=ne($=>o("close"),["self"]))},[t("div",lr,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:C[0]||(C[0]=$=>o("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),t("div",rr,[t("div",cr,[t("div",{class:"profile-avatar-upload-wrap",onClick:C[1]||(C[1]=$=>d.value?.click())},[B(me,{name:l.value||v.value,url:m.value,size:"xxl"},null,8,["name","url"]),t("div",ur,[B(M(os),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:d,type:"file",accept:"image/*",class:"hidden",onChange:g},null,544)]),t("div",dr,[t("div",vr,[t("label",mr,A(v.value)+" name",1),ee(t("input",{"onUpdate:modelValue":C[2]||(C[2]=$=>l.value=$),class:"form-input",type:"text",maxlength:"128",placeholder:`${v.value} name`},null,8,fr),[[ie,l.value]])]),t("div",pr,[C[8]||(C[8]=t("label",{class:"form-label"},"Description",-1)),ee(t("textarea",{"onUpdate:modelValue":C[3]||(C[3]=$=>r.value=$),class:"form-input",maxlength:"500",rows:"4",placeholder:`${v.value} description...`},null,8,hr),[[ie,r.value]])]),M(s).isOwner?(u(),h("div",gr,[t("label",yr,A(v.value)+" type",1),t("div",br,[t("label",kr,[ee(t("input",{"onUpdate:modelValue":C[4]||(C[4]=$=>k.value=$),type:"radio",value:"public",name:"chatType"},null,512),[[Pn,k.value]]),C[9]||(C[9]=t("span",{class:"type-option-label"},"Public",-1)),C[10]||(C[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",wr,[ee(t("input",{"onUpdate:modelValue":C[5]||(C[5]=$=>k.value=$),type:"radio",value:"private",name:"chatType"},null,512),[[Pn,k.value]]),C[11]||(C[11]=t("span",{class:"type-option-label"},"Private",-1)),C[12]||(C[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):P("",!0)]),t("div",_r,[t("button",{class:"btn btn-primary",disabled:f.value,onClick:p},A(f.value?"Saving...":"Save"),9,Cr),t("button",{class:"btn btn-ghost",onClick:C[6]||(C[6]=$=>o("close"))},"Cancel")])])])]))}}),Sr=re($r,[["__scopeId","data-v-6ec12915"]]),Mr={class:"danger-zone"},xr={class:"view-header"},Tr={class:"danger-zone-body"},Er={class:"modal modal-sm"},Ir={class:"modal-header"},Lr={class:"modal-actions"},Ar=["disabled"],Dr=Y({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:a}){const n=e,o=a,s=be(),i=at(),{showToast:l}=ke(),r=y(!1),m=y(!1);async function k(){try{await s.leave(n.chatId),o("left")}catch{l("Failed to leave channel")}}async function f(){m.value=!0;try{await ra(n.chatId),s.chats=s.chats.filter(d=>d.id!==n.chatId),s.activeChatId===n.chatId&&s.setActiveChat(null),r.value=!1,o("deleted")}catch{l("Failed to delete channel")}finally{m.value=!1}}return(d,c)=>(u(),h("div",Mr,[t("div",xr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=v=>o("back"))},[B(M(Ue),{size:20,"stroke-width":2})]),c[5]||(c[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",Tr,[t("button",{class:"btn btn-danger-outline",onClick:k},[B(M(yn),{size:18,"stroke-width":1.8}),c[6]||(c[6]=he(" Leave Channel ",-1))]),M(i).isOwner?(u(),h("button",{key:0,class:"btn btn-danger",onClick:c[1]||(c[1]=v=>r.value=!0)},[B(M(ls),{size:18,"stroke-width":1.8}),c[7]||(c[7]=he(" Delete Channel ",-1))])):P("",!0)]),r.value?(u(),h("div",{key:0,class:"modal-backdrop",onClick:c[4]||(c[4]=ne(v=>r.value=!1,["self"]))},[t("div",Er,[t("div",Ir,[c[8]||(c[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[2]||(c[2]=v=>r.value=!1)},[B(M(Ne),{size:20,"stroke-width":2})])]),c[9]||(c[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",Lr,[t("button",{class:"btn btn-ghost",onClick:c[3]||(c[3]=v=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:m.value,onClick:f},A(m.value?"Deleting...":"Delete"),9,Ar)])])])):P("",!0)]))}}),Rr=re(Dr,[["__scopeId","data-v-997b5e56"]]),Or={class:"modal profile-modal"},Nr={class:"profile-modal-body"},Pr={key:5,class:"profile-loading"},Ur={class:"profile-avatar-section"},Fr={class:"profile-name"},Hr={class:"profile-status"},jr={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},Br={class:"profile-info-item"},zr={class:"profile-info-value"},Vr={class:"channel-info-menu"},Wr={class:"channel-info-menu-count"},qr={class:"channel-info-menu-count"},Gr={key:7,class:"profile-loading"},Kr=Y({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:a}){const n=e,o=a,s=at(),i=y("main"),l=z(()=>Number(n.chatId)),r=z(()=>s.detail?.type==="group");function m(){i.value="main",s.loadDetail(l.value)}return ve(async()=>{await Promise.all([s.loadDetail(l.value),s.loadMembers(l.value)])}),(k,f)=>(u(),h("div",{class:"modal-backdrop profile-backdrop",onClick:f[14]||(f[14]=ne(d=>o("close"),["self"]))},[t("div",Or,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:f[0]||(f[0]=d=>o("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),t("div",Nr,[i.value==="invites"?(u(),Q(Il,{key:0,"chat-id":l.value,onBack:f[1]||(f[1]=d=>i.value="main")},null,8,["chat-id"])):i.value==="admins"?(u(),Q(Yl,{key:1,"chat-id":l.value,onBack:f[2]||(f[2]=d=>i.value="main")},null,8,["chat-id"])):i.value==="subscribers"?(u(),Q(ir,{key:2,"chat-id":l.value,onBack:f[3]||(f[3]=d=>i.value="main")},null,8,["chat-id"])):i.value==="edit"?(u(),Q(Sr,{key:3,"chat-id":l.value,onClose:f[4]||(f[4]=d=>i.value="main"),onSaved:m},null,8,["chat-id"])):i.value==="danger"?(u(),Q(Rr,{key:4,"chat-id":l.value,onBack:f[5]||(f[5]=d=>i.value="main"),onLeft:f[6]||(f[6]=d=>o("close")),onDeleted:f[7]||(f[7]=d=>o("close"))},null,8,["chat-id"])):M(s).loading?(u(),h("div",Pr,[...f[15]||(f[15]=[t("p",null,"Loading...",-1)])])):M(s).detail?(u(),h(te,{key:6},[t("div",Ur,[B(me,{name:M(s).detail.title||"Channel",url:M(s).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",Fr,A(M(s).detail.title),1),t("div",Hr,A(M(s).memberCount)+" "+A(r.value?M(s).memberCount===1?"member":"members":M(s).memberCount===1?"subscriber":"subscribers"),1),M(s).detail.description?(u(),h("div",jr,[t("div",Br,[f[16]||(f[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",zr,A(M(s).detail.description),1)])])):P("",!0),f[19]||(f[19]=t("div",{class:"profile-divider"},null,-1)),t("div",Vr,[t("button",{class:"channel-info-menu-item",onClick:f[8]||(f[8]=d=>i.value="invites")},[B(M(Ua),{size:20,"stroke-width":1.8}),f[17]||(f[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:f[9]||(f[9]=d=>i.value="admins")},[B(M(Va),{size:20,"stroke-width":1.8}),f[18]||(f[18]=t("span",null,"Administrators",-1)),t("span",Wr,A(M(s).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:f[10]||(f[10]=d=>i.value="subscribers")},[B(M(bn),{size:20,"stroke-width":1.8}),t("span",null,A(r.value?"Members":"Subscribers"),1),t("span",qr,A(M(s).memberCount),1)]),M(s).isOwner||M(s).isAdmin?(u(),h("button",{key:0,class:"channel-info-menu-item",onClick:f[11]||(f[11]=d=>i.value="edit")},[B(M(Ba),{size:20,"stroke-width":1.8}),t("span",null,A(r.value?"Edit Group":"Edit Channel"),1)])):P("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:f[12]||(f[12]=d=>i.value="danger")},[B(M(yn),{size:20,"stroke-width":1.8}),t("span",null,A(r.value?"Leave Group":"Leave Channel"),1)]),M(s).isOwner?(u(),h("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:f[13]||(f[13]=d=>i.value="danger")},[B(M(ls),{size:20,"stroke-width":1.8}),t("span",null,A(r.value?"Delete Group":"Delete Channel"),1)])):P("",!0)])],64)):(u(),h("div",Gr,[...f[20]||(f[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),Jr=re(Kr,[["__scopeId","data-v-d1526322"]]),Qr={class:"search-bar"},Yr={class:"search-bar-header"},Xr={key:0,class:"search-loading"},Zr={key:1,class:"search-empty"},ec=["onClick"],tc={class:"search-result-sender"},nc=["innerHTML"],sc={class:"search-result-date"},ac={key:0,class:"search-loading"},oc=Y({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:a}){const n=e,o=a,s=y(null),i=y(null),l=y(""),r=y([]),m=y(!1),k=y(!1),f=y(!0);let d=null;ve(()=>{fe(()=>s.value?.focus())}),Ee(l,$=>{if(d&&clearTimeout(d),!$.trim()){r.value=[],k.value=!1,f.value=!0;return}d=setTimeout(()=>c($.trim()),300)});async function c($){m.value=!0,k.value=!0,f.value=!0;try{const x=await Un(n.chatId,$,{limit:20});r.value=x,x.length<20&&(f.value=!1)}catch{r.value=[]}finally{m.value=!1}}async function v(){if(m.value||!f.value||r.value.length===0)return;const $=Math.min(...r.value.map(x=>x.id));m.value=!0;try{const x=await Un(n.chatId,l.value.trim(),{limit:20,before_id:$});x.length<20&&(f.value=!1),r.value=[...r.value,...x]}catch{}finally{m.value=!1}}function g(){if(!i.value)return;const $=i.value;$.scrollTop+$.clientHeight>=$.scrollHeight-40&&v()}function p($,x){if(!x)return S($);const j=S($),_=S(x),O=new RegExp(_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return j.replace(O,"<mark>$&</mark>")}function S($){return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function C($){if(!$)return"";const x=new Date($.endsWith("Z")?$:$+"Z"),j=new Date;return x.toDateString()===j.toDateString()?x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):x.toLocaleDateString([],{month:"short",day:"numeric"})+" "+x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return($,x)=>(u(),h("div",Qr,[t("div",Yr,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:x[0]||(x[0]=j=>o("close"))},"â†"),ee(t("input",{ref_key:"inputRef",ref:s,"onUpdate:modelValue":x[1]||(x[1]=j=>l.value=j),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:x[2]||(x[2]=rn(j=>o("close"),["escape"]))},null,544),[[ie,l.value]]),l.value?(u(),h("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:x[3]||(x[3]=j=>l.value="")},"âœ•")):P("",!0)]),m.value&&r.value.length===0?(u(),h("div",Xr,"Searching...")):k.value&&r.value.length===0&&!m.value?(u(),h("div",Zr,"No messages found")):r.value.length>0?(u(),h("div",{key:2,ref_key:"resultsRef",ref:i,class:"search-results",onScroll:g},[(u(!0),h(te,null,ue(r.value,j=>(u(),h("div",{key:j.id,class:"search-result-item",onClick:_=>o("jumpToMessage",j.id)},[t("div",tc,A(j.sender_display_name||j.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:p(j.content||"",l.value)},null,8,nc),t("div",sc,A(C(j.created_at)),1)],8,ec))),128)),m.value?(u(),h("div",ac,"Loading more...")):P("",!0)],544)):P("",!0)]))}}),ic={class:"chat-panel"},lc={key:0,class:"empty-chat"},rc={key:1,class:"chat-view"},cc={key:2,class:"channel-readonly-bar"},uc={key:0,class:"date-sep"},dc={key:4,class:"sticker-picker"},vc={key:6,class:"recording-bar"},mc={class:"rec-time"},fc=Y({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:a}){const n=a,o=Oe(),s=be(),i=Gt(),{showToast:l}=ke(),r=go(),m=Je("stickers",y([])),k=Je("sendTyping",()=>{}),f=Je("pendingScrollMessageId",y(null)),d=y(null),c=y(null),v=y(!1);let g=null;const p=y(!1),S=y(!1),C=y("member"),$=y(!1),x=y(!1),j=y(!0),_=y(0);let O=null;function W(){if(!d.value)return!0;const N=d.value;return N.scrollTop+N.clientHeight>=N.scrollHeight-100}function L(){O||(O=setTimeout(()=>{O=null,j.value=W(),j.value&&(_.value=0)},100))}function H(){Ve(),_.value=0,j.value=!0}const b=y(!1),T=y(0),F=y(0),D=y(null),E=qt(),U=y(!1),J=y(null),oe=y(""),Se=z(()=>!J.value||!o.user?!1:je.value.find(w=>w.id===J.value)?.sender_id===o.user.id),Jt=z(()=>Se.value?je.value.find(w=>w.id===J.value)?.message_type==="text":!1),ot=z(()=>!J.value||!s.activeChatId?!1:i.pinnedByChat[s.activeChatId]?.message?.id===J.value),He=z(()=>!s.activeChatId||i.pinnedDismissed.has(s.activeChatId)?null:i.pinnedByChat[s.activeChatId]||null),Ie=y(!1),K=y([]),V=y(!1),X=y([]),ce=y(!1),we=y(null);let it=null;const Tn=z(()=>s.activeChat?.type==="channel"&&C.value==="member"),je=z(()=>s.activeChatId?i.getMessages(s.activeChatId):[]),ws=z(()=>{const N=[];let w="";for(const R of je.value){const Z=_s(R.created_at);Z!==w&&(N.push({type:"date",label:Z}),w=Z),N.push({type:"msg",msg:R})}return N});function _s(N){if(!N)return"";const w=new Date(N.endsWith("Z")?N:N+"Z"),R=new Date;if(w.toDateString()===R.toDateString())return"Today";const Z=new Date(R);return Z.setDate(R.getDate()-1),w.toDateString()===Z.toDateString()?"Yesterday":w.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Cs(){Qt(),!(!c.value||!d.value)&&(g=new IntersectionObserver(async N=>{if(!N[0]?.isIntersecting)return;const R=s.activeChatId;if(!R||v.value||i.loadingChat===R)return;v.value=!0;const Z=d.value,_e=Z?Z.scrollHeight:0;try{if((await i.loadOlder(R)).length>0&&Z){await fe();const We=Z.scrollHeight;Z.scrollTop+=We-_e}}finally{v.value=!1}},{root:d.value,threshold:0}),g.observe(c.value))}function Qt(){g&&(g.disconnect(),g=null)}Ee(()=>s.activeChatId,async N=>{if(p.value=!1,C.value="member",_.value=0,j.value=!0,Qt(),it&&(clearInterval(it),it=null),!N)return;await Promise.all([i.loadMessages(N),i.loadPinnedMessage(N)]),await fe(),Ve(),await fe(),Cs();const w=s.activeChat;if(w&&(w.type==="channel"||w.type==="group"))try{const R=await ns(N);C.value=R.my_role||"member"}catch{}it=setInterval(()=>{s.activeChatId===N&&i.loadNewer(N).then(R=>{R.length>0&&$s(R.length)})},2500)});function Ve(){d.value&&(d.value.scrollTop=d.value.scrollHeight)}function $s(N=1){if(!d.value)return;const w=d.value;w.scrollHeight-w.scrollTop-w.clientHeight<100?fe(()=>{w.scrollTop=w.scrollHeight}):_.value+=N}function Ss(){s.activeChatId&&k(s.activeChatId)}async function Ms(N,w){if(!(!s.activeChatId||!N.trim())){we.value=null;try{const R=w?{reply_to_message_id:w.messageId}:void 0,Z=await i.sendMessage(s.activeChatId,N.trim(),"text",R);o.user&&(Z.sender_id=o.user.id,Z.sender_username=o.user.username,Z.sender_display_name=o.user.display_name),await fe(),Ve(),s.loadChats()}catch{l("Failed to send message")}}}async function xs(N,w){if(!(!s.activeChatId||!w.trim()))try{await i.editMessage(s.activeChatId,N,w.trim())}catch{l("Failed to edit message")}}async function Ts(N){if(s.activeChatId){p.value=!1;try{const w=await i.sendMessage(s.activeChatId,"","sticker",{sticker_id:N}),R=m.value.find(Z=>Z.id===N);R&&(w.sticker_url=R.url,w.sticker_label=R.label),await fe(),Ve(),s.loadChats()}catch{l("Failed to send sticker")}}}function Es(N,w,R){D.value=N,T.value=w,F.value=R,b.value=!0}function Is(N){D.value&&s.activeChatId&&i.toggleReaction(s.activeChatId,D.value,N),b.value=!1,D.value=null}function Ls(N,w){s.activeChatId&&i.toggleReaction(s.activeChatId,N,w)}function As(){b.value=!1,D.value=null}async function Ds(){try{await r.startRecording(),S.value=!0;const N=await r.stopRecording();S.value=!1,await Fs(N)}catch{S.value=!1,l("Microphone access denied")}}function Rs(){r.cancelRecording(),S.value=!1}function En(N){const{messageIds:w}=N.detail;K.value=w,Ie.value=!0}function In(N){const{messageId:w,chatId:R}=N.detail;R&&E.enterSelectionMode(R,w)}async function Ln(N,w){try{await i.pinMsg(N,w)}catch{l("Failed to pin message")}}async function An(N,w){try{await i.unpinMsg(N,w)}catch{l("Failed to unpin message")}}function Dn(N){const{messageId:w,chatId:R}=N.detail;w&&R&&Ln(R,w)}function Rn(N){const{messageId:w,chatId:R}=N.detail;w&&R&&An(R,w)}function Yt(N){const{messageId:w,chatId:R}=N.detail;if(!w||!R)return;X.value=[w];const Z=je.value.find(_e=>_e.id===w);ce.value=!!(Z&&Z.sender_id===o.user?.id),V.value=!0}function Os(){K.value=[...E.selectedMessageIds],Ie.value=!0}function Ns(){X.value=[...E.selectedMessageIds],ce.value=X.value.every(N=>{const w=je.value.find(R=>R.id===N);return w&&w.sender_id===o.user?.id}),V.value=!0}function On(){Ie.value=!1,K.value=[],E.exitSelectionMode()}async function Ps(N){V.value=!1;const w=s.activeChatId;if(w){for(const R of X.value)try{await i.deleteMessage(w,R)}catch{l("Failed to delete message")}X.value=[],E.exitSelectionMode()}}function Le(N){U.value=!1;const w=J.value,R=s.activeChatId;if(!(!w||!R))switch(N){case"reply":{const Z=je.value.find(_e=>_e.id===w);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:w,senderName:Z?.sender_display_name||Z?.sender_username||"Unknown",text:Z?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:w,chatId:R,text:oe.value}}));break}case"copy":navigator.clipboard.writeText(oe.value).then(()=>l("Copied to clipboard"),()=>l("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${R}/${w}`).then(()=>l("Link copied"),()=>l("Failed to copy link"));break;case"forward":K.value=[w],Ie.value=!0;break;case"select":E.enterSelectionMode(R,w);break;case"delete":Yt(new CustomEvent("",{detail:{messageId:w,chatId:R}}));break;case"pin":Ln(R,w);break;case"unpin":An(R,w);break}}async function lt(N){if(!d.value)return;const w=s.activeChatId;if(!w)return;let R=d.value.querySelector(`[data-message-id="${N}"]`);if(!R)try{const Z=Math.max(0,N-25),_e=await mt(w,{after_id:Z,limit:50});if(!_e.find(We=>We.id===N)){l("Message not found");return}i.messagesByChat[w]=_e,_e.length>0&&(i.lastMsgId[w]=Math.max(..._e.map(We=>We.id))),await fe(),R=d.value?.querySelector(`[data-message-id="${N}"]`)}catch{l("Message not found");return}R&&(R.scrollIntoView({behavior:"smooth",block:"center"}),R.classList.add("highlight-message"),setTimeout(()=>R.classList.remove("highlight-message"),2e3))}function Us(N){x.value=!1,lt(N)}function Nn(N){if(N.key==="Escape"){if(x.value){x.value=!1,N.stopPropagation();return}$.value&&($.value=!1,N.stopPropagation())}}ve(()=>{window.addEventListener("forward-messages",En),window.addEventListener("select-message",In),window.addEventListener("delete-message",Yt),window.addEventListener("pin-message",Dn),window.addEventListener("unpin-message",Rn),document.addEventListener("keydown",Nn)}),Fe(()=>{Qt(),window.removeEventListener("forward-messages",En),window.removeEventListener("select-message",In),window.removeEventListener("delete-message",Yt),window.removeEventListener("pin-message",Dn),window.removeEventListener("unpin-message",Rn),document.removeEventListener("keydown",Nn)}),Ee(()=>f.value,async N=>{N&&(await fe(),setTimeout(()=>{lt(N),f.value=null},300))}),Ee(()=>s.activeChatId,()=>{E.exitSelectionMode(),we.value=null,x.value=!1});async function Fs(N){if(s.activeChatId)try{const w=await kn(N);await i.sendMessage(s.activeChatId,"","voice",{file_id:w.id,duration_seconds:r.seconds.value}),await i.loadMessages(s.activeChatId),await fe(),Ve(),s.loadChats()}catch{l("Failed to upload voice message")}}return(N,w)=>(u(),h("main",ic,[M(s).activeChatId?(u(),h("div",rc,[B(Vi,{onForward:Os,onDelete:Ns}),x.value&&M(s).activeChatId?(u(),Q(oc,{key:0,"chat-id":M(s).activeChatId,onClose:w[0]||(w[0]=R=>x.value=!1),onJumpToMessage:Us},null,8,["chat-id"])):P("",!0),ee(B(So,{onBack:w[1]||(w[1]=R=>n("back")),onOpenUserProfile:w[2]||(w[2]=R=>n("openUserProfile",R)),onOpenChannelInfo:w[3]||(w[3]=R=>$.value=!0),onOpenSearch:w[4]||(w[4]=R=>x.value=!0)},null,512),[[pt,!M(E).selectionMode&&!x.value]]),He.value&&!M(E).selectionMode?(u(),Q(wo,{key:1,message:He.value.message,onClick:w[5]||(w[5]=R=>lt(He.value.message.id)),onDismiss:w[6]||(w[6]=R=>M(i).dismissPin(M(s).activeChatId))},null,8,["message"])):P("",!0),Tn.value?(u(),h("div",cc,[...w[22]||(w[22]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):P("",!0),_.value>0?(u(),h("button",{key:3,class:"new-messages-pill",onClick:H},A(_.value)+" new message"+A(_.value>1?"s":"")+" â†“ ",1)):P("",!0),t("div",{ref_key:"msgListRef",ref:d,class:"msg-list",onClick:As,onScroll:L},[M(i).loadingChat===M(s).activeChatId?(u(),Q(Jn,{key:0})):(u(),h(te,{key:1},[t("div",{ref_key:"olderSentinelRef",ref:c,class:"older-sentinel"},[v.value?(u(),Q(Jn,{key:0})):P("",!0)],512),(u(!0),h(te,null,ue(ws.value,R=>(u(),h(te,{key:R.type==="date"?"date-"+R.label:"msg-"+R.msg.id},[R.type==="date"?(u(),h("div",uc,[t("span",null,A(R.label),1)])):(u(),Q(mi,{key:1,message:R.msg,"is-mine":R.msg.sender_id===M(o).user?.id,onMentionClick:w[7]||(w[7]=Z=>n("openUserProfile",Z)),onOpenEmojiPicker:Es,onToggleReaction:Ls,onReplyClick:lt},null,8,["message","is-mine"]))],64))),128))],64))],544),B(Oi,{visible:b.value,x:T.value,y:F.value,onSelect:Is,onClose:w[8]||(w[8]=R=>b.value=!1)},null,8,["visible","x","y"]),p.value?(u(),h("div",dc,[B(Ii,{onSelect:Ts})])):P("",!0),Tn.value?P("",!0):ee((u(),Q(Si,{key:5,"sticker-picker-open":p.value,"reply-to":we.value,onSend:Ms,onEditMessage:xs,onToggleStickers:w[9]||(w[9]=R=>p.value=!p.value),onStartRecording:Ds,onTyping:Ss},null,8,["sticker-picker-open","reply-to"])),[[pt,!S.value]]),S.value?(u(),h("div",vc,[w[23]||(w[23]=t("span",{class:"rec-dot"},null,-1)),t("span",mc,A(M(r).formatTime(M(r).seconds.value)),1),w[24]||(w[24]=t("span",{class:"rec-label"},"Recording... tap mic to stop",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:Rs},"âœ•")])):P("",!0),B(Pi),B(qi,{visible:U.value,onClose:w[18]||(w[18]=R=>U.value=!1)},{default:gn(()=>[t("button",{class:"ctx-item",onClick:w[10]||(w[10]=R=>Le("reply"))},"Reply"),Jt.value?(u(),h("button",{key:0,class:"ctx-item",onClick:w[11]||(w[11]=R=>Le("edit"))},"Edit")):P("",!0),t("button",{class:"ctx-item",onClick:w[12]||(w[12]=R=>Le(ot.value?"unpin":"pin"))},A(ot.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:w[13]||(w[13]=R=>Le("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:w[14]||(w[14]=R=>Le("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:w[15]||(w[15]=R=>Le("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:w[16]||(w[16]=R=>Le("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:w[17]||(w[17]=R=>Le("delete"))},"Delete")]),_:1},8,["visible"]),Ie.value?(u(),Q(il,{key:7,"message-ids":K.value,"from-chat-id":M(s).activeChatId,onClose:On,onForwarded:On},null,8,["message-ids","from-chat-id"])):P("",!0),V.value?(u(),Q(fl,{key:8,"message-count":X.value.length,"can-delete-for-everyone":ce.value,onClose:w[19]||(w[19]=R=>V.value=!1),onConfirm:Ps},null,8,["message-count","can-delete-for-everyone"])):P("",!0),$.value?(u(),Q(Jr,{key:9,"chat-id":String(M(s).activeChatId),onClose:w[20]||(w[20]=R=>$.value=!1)},null,8,["chat-id"])):P("",!0)])):(u(),h("div",lc,[...w[21]||(w[21]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),pc=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Favorites",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function hc(e){return pc.filter(a=>a.visible(e))}const gc=["disabled"],yc={class:"menu-item__label"},bc={key:1,class:"menu-item__badge"},kc=Y({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:a}){const n=a;return(o,s)=>(u(),h("button",{class:le(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:s[0]||(s[0]=i=>n("click"))},[e.icon?(u(),Q(ht(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):P("",!0),t("span",yc,A(e.label),1),e.badge?(u(),h("span",bc,A(e.badge),1)):P("",!0),Zn(o.$slots,"right",{},void 0),e.chevron?(u(),Q(ht(M(Ra)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):P("",!0)],10,gc))}}),Qn=re(kc,[["__scopeId","data-v-682bc042"]]),wc={class:"drawer-header"},_c={class:"drawer-avatar-wrap"},Cc={class:"drawer-user-info"},$c={class:"drawer-display-name"},Sc={class:"drawer-username"},Mc={class:"drawer-nav"},xc={key:0,class:"drawer-divider"},Tc=["onClick"],Ec={class:"menu-item__label"},Ic=["aria-checked"],Lc=Y({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:a}){const n=a,o=ts(),s=Oe(),i=Wt(),l={user:rs,users:bn,megaphone:is,bookmark:Aa,settings:za,moon:ja,download:Na,"log-out":yn,star:qa},r=z(()=>({isAuthenticated:!!s.user,isDesktop:!0})),m=z(()=>hc(r.value)),k={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const d=i.theme==="dark"?"light":"dark";i.applyTheme(d),i.saveSettings({theme:d})},openDownload:()=>n("openDownload"),logout:()=>{s.logout(),o.push("/login")}};function f(d){d&&k[d]&&k[d]()}return(d,c)=>(u(),h("div",{class:le(["drawer",{open:e.open}])},[t("div",wc,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:c[0]||(c[0]=v=>n("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),c[1]||(c[1]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",_c,[B(me,{name:M(s).user?.display_name||M(s).user?.username||"?",url:M(s).user?.avatar_url,size:"lg"},null,8,["name","url"]),t("div",Cc,[t("div",$c,A(M(s).user?.display_name||M(s).user?.username||"---"),1),t("div",Sc,"@"+A(M(s).user?.username||"---"),1)])]),t("nav",Mc,[(u(!0),h(te,null,ue(m.value,v=>(u(),h(te,{key:v.id},[v.separator?(u(),h("div",xc)):P("",!0),v.rightSlot==="toggle"?(u(),h("div",{key:1,class:"menu-item menu-item--toggle",onClick:g=>f(v.action)},[(u(),Q(ht(l[v.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",Ec,A(v.label),1),t("span",{class:le(["toggle-switch",{"toggle-switch--on":M(i).theme==="dark"}]),role:"switch","aria-checked":M(i).theme==="dark"},[...c[2]||(c[2]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Ic)],8,Tc)):v.id==="logout"?(u(),Q(Qn,{key:2,icon:l[v.icon],label:v.label,danger:"",onClick:g=>f(v.action)},null,8,["icon","label","onClick"])):(u(),Q(Qn,{key:3,icon:l[v.icon],label:v.label,onClick:g=>f(v.action)},null,8,["icon","label","onClick"]))],64))),128))]),c[3]||(c[3]=t("div",{class:"drawer-footer"},"Simple Messenger v2",-1))],2))}}),Ac=re(Lc,[["__scopeId","data-v-de7cf394"]]),Dc={class:"modal"},Rc={class:"modal-header"},Oc={class:"modal-body"},Nc={key:0,class:"chat-type-cards"},Pc={class:"chat-type-icon"},Uc={class:"chat-type-icon"},Fc={class:"chat-type-icon"},Hc={key:1,class:"new-chat-form"},jc={class:"user-pick-list"},Bc={key:0,class:"empty-state-small"},zc={key:1,class:"empty-state-small"},Vc=["onClick"],Wc={class:"user-pick-name"},qc={class:"user-pick-handle"},Gc={key:2,class:"new-chat-form"},Kc={class:"form-group"},Jc={class:"form-group"},Qc={class:"form-group"},Yc={class:"user-pick-list"},Xc=["onClick"],Zc={class:"user-pick-name"},eu={class:"user-pick-handle"},tu={class:"modal-actions"},nu=["disabled"],su={key:3,class:"new-chat-form"},au={class:"form-group"},ou={class:"form-group"},iu={class:"form-group"},lu={class:"modal-actions"},ru=["disabled"],cu=Y({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:a}){const n=e,o=a,s=Oe(),{showToast:i}=ke(),l=y(n.initialStep),r=y(!1),m=y(""),k=y([]),f=y(!1);let d=null;const c=y(""),v=y(""),g=y(""),p=y([]),S=y(new Set);let C=null;const $=y(""),x=y(""),j=y("");ve(()=>{_("")});async function _(D){f.value=!0;try{const E=await Fn(D);k.value=E.filter(U=>U.id!==s.user?.id)}catch{k.value=[]}finally{f.value=!1}}function O(){d&&clearTimeout(d),d=setTimeout(()=>_(m.value),300)}async function W(D){try{p.value=await Fn(D)}catch{p.value=[]}}function L(){C&&clearTimeout(C),C=setTimeout(()=>W(g.value),300)}function H(D){S.value.has(D)?S.value.delete(D):S.value.add(D)}async function b(D){r.value=!0;try{const E=await vt({type:"direct",member_ids:[D]});o("chatCreated",E.id)}catch{i("Failed to start conversation")}finally{r.value=!1}}async function T(){if(!c.value.trim()){i("Group name is required");return}r.value=!0;try{const D=await vt({type:"group",title:c.value.trim(),description:v.value.trim(),member_ids:Array.from(S.value)});i("Group created!"),o("chatCreated",D.id)}catch{i("Failed to create group")}finally{r.value=!1}}async function F(){if(!$.value.trim()){i("Channel name is required");return}r.value=!0;try{const D=await vt({type:"channel",title:$.value.trim(),description:j.value.trim(),public_name:x.value.trim()||void 0,member_ids:[]});i("Channel created!"),o("chatCreated",D.id)}catch{i("Failed to create channel")}finally{r.value=!1}}return(D,E)=>(u(),h("div",{class:"modal-backdrop",onClick:E[14]||(E[14]=ne(U=>o("close"),["self"]))},[t("div",Dc,[t("div",Rc,[E[15]||(E[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:E[0]||(E[0]=U=>o("close"))},[B(M(Ne),{size:20})])]),t("div",Oc,[l.value==="select"?(u(),h("div",Nc,[t("button",{class:"chat-type-card",onClick:E[1]||(E[1]=U=>l.value="direct")},[t("span",Pc,[B(M(rs),{size:24})]),E[16]||(E[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:E[2]||(E[2]=U=>l.value="group")},[t("span",Uc,[B(M(bn),{size:24})]),E[17]||(E[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:E[3]||(E[3]=U=>l.value="channel")},[t("span",Fc,[B(M(is),{size:24})]),E[18]||(E[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):P("",!0),l.value==="direct"?(u(),h("div",Hc,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:E[4]||(E[4]=U=>l.value="select")},[B(M(Ue),{size:16}),E[19]||(E[19]=he(" Back ",-1))]),ee(t("input",{"onUpdate:modelValue":E[5]||(E[5]=U=>m.value=U),class:"search-input",type:"search",placeholder:"Search users...",onInput:O},null,544),[[ie,m.value]]),t("div",jc,[f.value?(u(),h("div",Bc,"Loading users...")):k.value.length===0?(u(),h("div",zc,"No users found.")):(u(!0),h(te,{key:2},ue(k.value,U=>(u(),h("div",{key:U.id,class:"user-pick-item",onClick:J=>b(U.id)},[B(me,{name:U.display_name||U.username,url:U.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Wc,A(U.display_name||U.username),1),t("div",qc,"@"+A(U.username),1)])],8,Vc))),128))])])):P("",!0),l.value==="group"?(u(),h("div",Gc,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:E[6]||(E[6]=U=>l.value="select")},[B(M(Ue),{size:16}),E[20]||(E[20]=he(" Back ",-1))]),t("div",Kc,[E[21]||(E[21]=t("label",{class:"form-label"},"Group name",-1)),ee(t("input",{"onUpdate:modelValue":E[7]||(E[7]=U=>c.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[ie,c.value]])]),t("div",Jc,[E[22]||(E[22]=t("label",{class:"form-label"},"Description (optional)",-1)),ee(t("textarea",{"onUpdate:modelValue":E[8]||(E[8]=U=>v.value=U),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[ie,v.value]])]),t("div",Qc,[E[23]||(E[23]=t("label",{class:"form-label"},"Add members",-1)),ee(t("input",{"onUpdate:modelValue":E[9]||(E[9]=U=>g.value=U),class:"search-input",type:"search",placeholder:"Search users...",onInput:L},null,544),[[ie,g.value]]),t("div",Yc,[(u(!0),h(te,null,ue(p.value,U=>(u(),h("div",{key:U.id,class:le(["user-pick-item",{selected:S.value.has(U.id)}]),onClick:J=>H(U.id)},[B(me,{name:U.display_name||U.username,url:U.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Zc,[S.value.has(U.id)?(u(),Q(M(Da),{key:0,size:14,style:{"margin-right":"4px"}})):P("",!0),he(A(U.display_name||U.username),1)]),t("div",eu,"@"+A(U.username),1)])],10,Xc))),128))])]),t("div",tu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:T}," Create Group ",8,nu)])])):P("",!0),l.value==="channel"?(u(),h("div",su,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:E[10]||(E[10]=U=>l.value="select")},[B(M(Ue),{size:16}),E[24]||(E[24]=he(" Back ",-1))]),t("div",au,[E[25]||(E[25]=t("label",{class:"form-label"},"Channel name",-1)),ee(t("input",{"onUpdate:modelValue":E[11]||(E[11]=U=>$.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[ie,$.value]])]),t("div",ou,[E[26]||(E[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),ee(t("input",{"onUpdate:modelValue":E[12]||(E[12]=U=>x.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[ie,x.value]]),E[27]||(E[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",iu,[E[28]||(E[28]=t("label",{class:"form-label"},"Description (optional)",-1)),ee(t("textarea",{"onUpdate:modelValue":E[13]||(E[13]=U=>j.value=U),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[ie,j.value]])]),t("div",lu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:F}," Create Channel ",8,ru)])])):P("",!0)])])]))}}),uu={class:"modal profile-modal profile-modal--self"},du={class:"profile-tabs"},vu={class:"profile-modal-body profile-modal-body--scrollable"},mu={class:"profile-avatar-section profile-avatar-upload-section"},fu={class:"profile-avatar-overlay"},pu={class:"profile-name"},hu={key:0,class:"profile-status profile-status--online"},gu={class:"profile-info-list"},yu={class:"form-group"},bu={class:"form-group"},ku={key:0,class:"form-hint form-error"},wu={class:"form-group"},_u={class:"profile-info-item"},Cu={class:"profile-info-value"},$u={class:"profile-edit-actions"},Su={class:"profile-info-list"},Mu={class:"form-group form-inline"},xu={class:"form-group form-inline"},Tu={class:"toggle"},Eu={class:"form-group form-inline"},Iu={class:"form-group form-inline"},Lu=Y({__name:"ProfileModal",props:{initialTab:{default:"profile"}},emits:["close"],setup(e,{emit:a}){const n=e,o=a,s=Oe(),i=Wt(),{showToast:l}=ke(),r=y(n.initialTab),m=y(""),k=y(""),f=y(""),d=y(""),c=y(null),v=y("light"),g=y(!0),p=y("en"),S=y("everyone");Ee(g,async j=>{j&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(g.value=!1,l("Notifications blocked by browser"))}),ve(async()=>{s.user&&(m.value=s.user.display_name||"",k.value=s.user.username,f.value=s.user.bio||""),v.value=i.theme,g.value=i.notificationsEnabled,p.value=i.language,S.value=i.lastSeenVisibility});async function C(){const j=c.value?.files?.[0];if(j){try{const _=await kn(j),O=await $a(_.id);s.updateUser({avatar_url:O.avatar_url}),l("Avatar updated!")}catch{l("Upload failed")}c.value&&(c.value.value="")}}async function $(){if(d.value="",!s.user)return;const j={display_name:m.value.trim(),bio:f.value.trim()};k.value.trim()&&k.value.trim()!==s.user.username&&(j.username=k.value.trim());try{const _=await Ca(s.user.id,j);s.updateUser({display_name:_.display_name,username:_.username}),l("Profile saved!"),o("close")}catch(_){_.response?.status===409?d.value="Username already taken":l("Save failed")}}async function x(){try{await i.saveSettings({theme:v.value,notifications_enabled:g.value,language:p.value,last_seen_visibility:S.value}),l("Settings saved!"),o("close")}catch{l("Settings save failed")}}return(j,_)=>(u(),h("div",{class:"modal-backdrop profile-backdrop",onClick:_[12]||(_[12]=ne(O=>o("close"),["self"]))},[t("div",uu,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:_[0]||(_[0]=O=>o("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),t("div",du,[t("button",{class:le(["profile-tab",{active:r.value==="profile"}]),onClick:_[1]||(_[1]=O=>r.value="profile")},"Profile",2),t("button",{class:le(["profile-tab",{active:r.value==="settings"}]),onClick:_[2]||(_[2]=O=>r.value="settings")},"Settings",2)]),t("div",vu,[ee(t("div",null,[t("div",mu,[t("div",{class:"profile-avatar-upload-wrap",onClick:_[3]||(_[3]=O=>c.value?.click())},[B(me,{name:m.value||M(s).user?.username||"?",url:M(s).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",fu,[B(M(os),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",class:"hidden",onChange:C},null,544)]),t("div",pu,A(m.value||M(s).user?.username||"?"),1),M(s).user?(u(),h("div",hu," online ")):P("",!0),_[17]||(_[17]=t("div",{class:"profile-divider"},null,-1)),t("div",gu,[t("div",yu,[_[13]||(_[13]=t("label",{class:"form-label"},"Display name",-1)),ee(t("input",{"onUpdate:modelValue":_[4]||(_[4]=O=>m.value=O),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[ie,m.value]])]),t("div",bu,[_[14]||(_[14]=t("label",{class:"form-label"},"Username",-1)),ee(t("input",{"onUpdate:modelValue":_[5]||(_[5]=O=>k.value=O),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[ie,k.value]]),d.value?(u(),h("small",ku,A(d.value),1)):P("",!0)]),t("div",wu,[_[15]||(_[15]=t("label",{class:"form-label"},"Bio",-1)),ee(t("textarea",{"onUpdate:modelValue":_[6]||(_[6]=O=>f.value=O),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[ie,f.value]])]),t("div",_u,[_[16]||(_[16]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Cu,A(M(s).user?.id),1)])]),t("div",$u,[t("button",{class:"btn btn-primary",onClick:$},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:_[7]||(_[7]=O=>o("close"))},"Cancel")])],512),[[pt,r.value==="profile"]]),ee(t("div",null,[t("div",Su,[t("div",Mu,[_[19]||(_[19]=t("label",{class:"form-label"},"Theme",-1)),ee(t("select",{"onUpdate:modelValue":_[8]||(_[8]=O=>v.value=O),class:"form-input form-select"},[..._[18]||(_[18]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[Xt,v.value]])]),t("div",xu,[_[21]||(_[21]=t("label",{class:"form-label"},"Notifications",-1)),t("label",Tu,[ee(t("input",{"onUpdate:modelValue":_[9]||(_[9]=O=>g.value=O),type:"checkbox"},null,512),[[es,g.value]]),_[20]||(_[20]=t("span",{class:"toggle-slider"},null,-1))])]),t("div",Eu,[_[23]||(_[23]=t("label",{class:"form-label"},"Language",-1)),ee(t("select",{"onUpdate:modelValue":_[10]||(_[10]=O=>p.value=O),class:"form-input form-select"},[..._[22]||(_[22]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[Xt,p.value]])]),_[26]||(_[26]=t("div",{class:"profile-divider"},null,-1)),_[27]||(_[27]=t("h4",{class:"form-section-heading"},"Privacy",-1)),t("div",Iu,[_[25]||(_[25]=t("label",{class:"form-label"},"Last seen & online",-1)),ee(t("select",{"onUpdate:modelValue":_[11]||(_[11]=O=>S.value=O),class:"form-input form-select"},[..._[24]||(_[24]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[Xt,S.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:x},"Save Settings")])],512),[[pt,r.value==="settings"]])])])]))}}),Au={class:"profile-actions"},Du=["disabled","onClick"],Ru={class:"profile-action-btn__circle"},Ou={class:"profile-action-btn__label"},Nu=Y({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:a}){const n=e,o=a,s=z(()=>{const i=[{icon:Ha,label:"Message",event:"message"}];return n.showMute!==!1&&i.push({icon:La,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&i.push({icon:Pa,label:"More",event:"more"}),i});return(i,l)=>(u(),h("div",Au,[(u(!0),h(te,null,ue(s.value,r=>(u(),h("button",{key:r.label,class:le(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:m=>o(r.event)},[t("span",Ru,[(u(),Q(ht(r.icon),{size:22,"stroke-width":1.8}))]),t("span",Ou,A(r.label),1)],10,Du))),128))]))}}),Pu=re(Nu,[["__scopeId","data-v-b5376905"]]),Uu={class:"modal profile-modal"},Fu={class:"profile-modal-body"},Hu={key:0,class:"profile-loading"},ju={class:"profile-avatar-section"},Bu={class:"profile-name"},zu={class:"profile-info-list"},Vu={class:"profile-info-item"},Wu={class:"profile-info-value"},qu={key:0,class:"profile-info-item"},Gu={class:"profile-info-value"},Ku={class:"profile-info-item"},Ju={class:"profile-info-value"},Qu={key:2,class:"profile-loading"},Yu=Y({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:a}){const n=e,o=a,s=be(),{showToast:i}=ke(),l=y(null),r=y(!0),m=y(!1),k=z(()=>l.value?s.isUserOnline(l.value.id):!1);ve(async()=>{try{l.value=await as(n.username)}catch{l.value=null}finally{r.value=!1}});function f(){m.value=!m.value,i(m.value?"User muted":"User unmuted")}return(d,c)=>(u(),h("div",{class:"modal-backdrop profile-backdrop",onClick:c[2]||(c[2]=ne(v=>o("close"),["self"]))},[t("div",Uu,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:c[0]||(c[0]=v=>o("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),t("div",Fu,[r.value?(u(),h("div",Hu,[...c[3]||(c[3]=[t("p",null,"Loading...",-1)])])):l.value?(u(),h(te,{key:1},[t("div",ju,[B(me,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:k.value,size:"xxl"},null,8,["name","url","online"])]),t("div",Bu,[he(A(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(u(),Q(ks,{key:0})):P("",!0)]),t("div",{class:le(["profile-status",{"profile-status--online":k.value}])},A(k.value?"online":"offline"),3),B(Pu,{muted:m.value,"show-more":!1,onMessage:c[1]||(c[1]=v=>o("message",l.value.username)),onMute:f},null,8,["muted"]),c[7]||(c[7]=t("div",{class:"profile-divider"},null,-1)),t("div",zu,[t("div",Vu,[c[4]||(c[4]=t("div",{class:"profile-info-label"},"Username",-1)),t("div",Wu,"@"+A(l.value.username),1)]),l.value.bio?(u(),h("div",qu,[c[5]||(c[5]=t("div",{class:"profile-info-label"},"Bio",-1)),t("div",Gu,A(l.value.bio),1)])):P("",!0),t("div",Ku,[c[6]||(c[6]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Ju,A(l.value.id),1)])])],64)):(u(),h("div",Qu,[...c[8]||(c[8]=[t("p",null,"User not found",-1)])]))])])]))}}),Xu={class:"modal",style:{"max-width":"420px"}},Zu={class:"modal-header"},ed={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},td=Y({__name:"DownloadModal",emits:["close"],setup(e,{emit:a}){const n=a,o=navigator.userAgent.toLowerCase(),s=o.includes("win"),i=o.includes("mac")&&!o.includes("iphone")&&!o.includes("ipad"),l=z(()=>s?"Windows":i?"macOS":null);function r(){s?window.location.href="/downloads/windows/MessengerSetup.exe":i&&(window.location.href="/downloads/macos/Messenger.dmg")}return(m,k)=>(u(),h("div",{class:"modal-backdrop",onClick:k[1]||(k[1]=ne(f=>n("close"),["self"]))},[t("div",Xu,[t("div",Zu,[k[2]||(k[2]=t("h2",{class:"modal-title"},"Download Simple Messenger",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:k[0]||(k[0]=f=>n("close"))},[B(M(Ne),{size:20})])]),t("div",ed,[l.value?(u(),h("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+A(l.value),1)):P("",!0),k[3]||(k[3]=Bs('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/MessengerSetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/Messenger.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),nd={class:"modal",style:{"max-width":"400px"}},sd={class:"modal-header"},ad={class:"modal-body",style:{"text-align":"center"}},od={key:0},id={style:{"font-size":"1.25rem","font-weight":"700"}},ld={style:{color:"var(--text-muted)","margin-top":".5rem"}},rd={class:"profile-avatar-section"},cd={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},ud={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},dd={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},vd={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},md=["disabled"],fd=Y({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:a}){const n=e,o=a,{showToast:s}=ke(),i=y(null),l=y(!0),r=y(!1),m=y(""),k=y("");ve(async()=>{if(!n.token){m.value="Invalid Link",k.value="No invite token provided.",l.value=!1;return}try{i.value=await Gs(n.token)}catch(d){d.response?.status===410?(m.value="Invite Revoked",k.value="This invite link has been revoked."):(m.value="Invite Not Found",k.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function f(){r.value=!0;try{const d=await Ks(n.token);s(d.already_member?"You are already a member":"Joined successfully!"),o("joined",d.chat_id)}catch(d){s(d.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(d,c)=>(u(),h("div",{class:"modal-backdrop",onClick:c[2]||(c[2]=ne(v=>o("close"),["self"]))},[t("div",nd,[t("div",sd,[c[3]||(c[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:c[0]||(c[0]=v=>o("close"))},"âœ•")]),t("div",ad,[l.value?(u(),h("p",od,"Loading invite preview...")):k.value?(u(),h(te,{key:1},[t("h2",id,A(m.value),1),t("p",ld,A(k.value),1)],64)):i.value?(u(),h(te,{key:2},[t("div",rd,[B(me,{name:i.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",cd,A(i.value.title||i.value.type||"Chat"),1),i.value.description?(u(),h("p",ud,A(i.value.description),1)):P("",!0),i.value.member_count?(u(),h("p",dd,A(i.value.member_count)+" members ",1)):P("",!0),t("div",vd,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:f},A(r.value?"Joining...":"Join"),9,md),t("button",{class:"btn btn-ghost",onClick:c[1]||(c[1]=v=>o("close"))},"Cancel")])],64)):P("",!0)])])]))}}),pd=Y({__name:"ContextMenu",setup(e){const a=be(),{showToast:n}=ke(),o=y(!1),s=y(0),i=y(0),l=y(null),r=z(()=>l.value?a.chats.find(v=>v.id===l.value)??null:null);function m(v){l.value=v.detail.chatId,s.value=v.detail.x,i.value=v.detail.y,o.value=!0}function k(){o.value&&(o.value=!1,l.value=null)}ve(()=>{window.addEventListener("show-context-menu",m),document.addEventListener("click",k)}),Fe(()=>{window.removeEventListener("show-context-menu",m),document.removeEventListener("click",k)});async function f(){if(l.value){o.value=!1;try{await a.toggleFavorite(l.value)}catch{n("Failed to update favorite")}}}async function d(){if(l.value){o.value=!1;try{await a.toggleMute(l.value)}catch{n("Failed to update mute")}}}async function c(){if(l.value&&(o.value=!1,!!confirm("Leave this chat?")))try{await a.leave(l.value),n("Left chat")}catch{n("Failed to leave chat")}}return(v,g)=>o.value?(u(),h("div",{key:0,class:"context-menu",style:Vt({left:s.value+"px",top:i.value+"px"})},[t("button",{class:"ctx-item",onClick:f},A(r.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:d},A(r.value?.is_muted?"Unmute":"Mute"),1),r.value&&r.value.type!=="direct"?(u(),h("button",{key:0,class:"ctx-item ctx-leave",onClick:c}," Leave chat ")):P("",!0)],4)):P("",!0)}}),yd=Y({__name:"MessengerView",setup(e){const a=zs(),n=ts(),o=Oe(),s=be(),i=Wt(),l=qt(),{showToast:r}=ke(),{connect:m,disconnect:k,sendTyping:f}=_a();dt("sendTyping",f);const d=y(!1),c=y(!1),v=y("select"),g=y(!1),p=y("profile"),S=y(!1),C=y(null),$=y(null),x=y([]),j=y(null);dt("stickers",x),dt("pendingScrollMessageId",j);let _=null;ve(async()=>{await i.loadSettings();try{x.value=await Sa()}catch{}await s.loadChats(),m(),_=setInterval(()=>s.loadChats(),5e3),O()}),Fe(()=>{k(),_&&(clearInterval(_),_=null)}),Ee(()=>a.path,()=>{O()}),Ee(()=>s.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function O(){const K=a.path;if(K.startsWith("/@")){const V=a.params.username;V&&(C.value=V)}else if(K.startsWith("/u/")){const V=a.params.id;if(V)try{const X=await ss(parseInt(V));C.value=X.username}catch{r("User not found")}}else if(K.startsWith("/dm/")){const V=a.params.id;V&&await W(V)}else if(K.startsWith("/c/")){const V=a.params.chatIdOrName||a.params.name,X=a.params.messageId?parseInt(a.params.messageId):null;if(V)if(/^\d+$/.test(V)){const we=parseInt(V);X?await H(we,X):s.setActiveChat(we)}else await L(V)}}async function W(K){try{let V;if(K.startsWith("@")){const ce=K.substring(1);if(o.user?.username===ce){C.value=ce;return}V=(await as(ce)).id}else if(V=parseInt(K),o.user?.id===V){r("Cannot open DM with yourself");return}const X=await vt({type:"direct",member_ids:[V]});await s.loadChats(),s.setActiveChat(X.id)}catch{r("Failed to open conversation")}}async function L(K){try{const V=await Qs(K);s.chats.find(ce=>ce.id===V.id)?s.setActiveChat(V.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function H(K,V){if(!s.chats.find(ce=>ce.id===K)){r("Chat not found");return}s.setActiveChat(K),await fe(),j.value=V}function b(K){s.setActiveChat(K),n.replace("/app")}function T(){s.setActiveChat(null)}function F(){d.value=!1,p.value="profile",g.value=!0}function D(){d.value=!1,p.value="settings",g.value=!0}function E(){d.value=!1,v.value="group",c.value=!0}function U(){d.value=!1,v.value="channel",c.value=!0}function J(){d.value=!1}function oe(K){C.value=K}async function Se(K){C.value=null,await W("@"+K)}async function Jt(K){c.value=!1,await s.loadChats(),s.setActiveChat(K)}async function ot(K){$.value=null,await s.loadChats(),s.setActiveChat(K)}function He(K){const V=K.target?.closest("a");if(!V)return;const X=V.getAttribute("href");if(!X)return;let ce=null;try{const we=new URL(X,window.location.origin);we.origin===window.location.origin&&(ce=we.pathname.match(/^\/join\/([^/]+)$/))}catch{ce=X.match(/^\/join\/([^/]+)$/)}ce&&(K.preventDefault(),K.stopPropagation(),$.value=ce[1]??null)}function Ie(K){if(K.key==="Escape"){if($.value){$.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if(C.value){C.value=null;return}if(c.value){c.value=!1;return}if(g.value){g.value=!1;return}if(S.value){S.value=!1;return}if(d.value){d.value=!1;return}if(s.activeChatId!==null){T();return}}}return ve(()=>{document.addEventListener("keydown",Ie),document.addEventListener("click",He,!0)}),Fe(()=>{document.removeEventListener("keydown",Ie),document.removeEventListener("click",He,!0)}),(K,V)=>(u(),h("div",{class:le(["layout",{"chat-open":!!M(s).activeChatId}])},[B(Ac,{open:d.value,onClose:V[0]||(V[0]=X=>d.value=!1),onOpenProfile:F,onOpenSettings:D,onOpenNewGroup:E,onOpenNewChannel:U,onOpenFavorites:J,onOpenDownload:V[1]||(V[1]=X=>S.value=!0)},null,8,["open"]),t("div",{class:le(["drawer-overlay",{visible:d.value}]),onClick:V[2]||(V[2]=X=>d.value=!1)},null,2),B(ho,{onOpenDrawer:V[3]||(V[3]=X=>d.value=!0),onOpenNewChat:V[4]||(V[4]=X=>{v.value="select",c.value=!0}),onSelectChat:b}),B(fc,{onBack:T,onOpenUserProfile:oe}),c.value?(u(),Q(cu,{key:0,"initial-step":v.value,onClose:V[5]||(V[5]=X=>c.value=!1),onChatCreated:Jt},null,8,["initial-step"])):P("",!0),g.value?(u(),Q(Lu,{key:1,"initial-tab":p.value,onClose:V[6]||(V[6]=X=>g.value=!1)},null,8,["initial-tab"])):P("",!0),C.value?(u(),Q(Yu,{key:2,username:C.value,onClose:V[7]||(V[7]=X=>C.value=null),onMessage:Se},null,8,["username"])):P("",!0),S.value?(u(),Q(td,{key:3,onClose:V[8]||(V[8]=X=>S.value=!1)})):P("",!0),$.value?(u(),Q(fd,{key:4,token:$.value,onClose:V[9]||(V[9]=X=>$.value=null),onJoined:ot},null,8,["token"])):P("",!0),B(pd)],2))}});export{yd as default};
