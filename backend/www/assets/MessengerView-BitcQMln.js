import{k as B,l as xe,r as h,m as O,n as ge,u as he,p as Ne,d as W,o as u,c as b,a as t,t as E,w as Y,q as Se,s as Q,g as A,b as F,f as oe,x as D,e as G,v as K,F as J,y as ee,z as V,A as _e,B as we,C as ht,D as ie,E as fe,G as yt,H as ce,T as Je,h as Re,I as Qe,J as Ke,K as et,L as $e,M as me,N as Me,j as tt,O as qe,P as bt,Q as wt}from"./index-CqWu2B1A.js";import{_ as ue,l as kt,c as _t,r as Ct}from"./invites-C3NwLByf.js";async function $t(){const{data:e}=await B.get("/chats");return e}async function Mt(e){const{data:s}=await B.get(`/chats/${e}`);return s}async function xt(e){const{data:s}=await B.get(`/chats/by-name/${encodeURIComponent(e)}`);return s}async function Ce(e){const{data:s}=await B.post("/chats",e);return s}async function St(e){await B.post(`/chats/${e}/favorite`)}async function Tt(e){await B.delete(`/chats/${e}/favorite`)}async function It(e,s){await B.post(`/chats/${e}/mute`,{})}async function Dt(e){await B.delete(`/chats/${e}/mute`)}async function Ut(e){await B.delete(`/chats/${e}/leave`)}async function Pt(e){await B.post(`/chats/${e}/read`)}async function Ft(e){await B.post(`/chats/${e}/pin`)}async function Lt(e){await B.delete(`/chats/${e}/pin`)}async function Et(e){await B.post(`/chats/${e}/archive`)}async function Nt(e){await B.delete(`/chats/${e}/archive`)}const ne=xe("chats",()=>{const e=h([]),s=h(null),a=h({}),l=h(new Set),i=O(()=>e.value.find(v=>v.id===s.value)??null),c=O(()=>[...e.value].sort((v,S)=>{if(v.is_pinned&&!S.is_pinned)return-1;if(!v.is_pinned&&S.is_pinned)return 1;if(v.is_favorite&&!S.is_favorite)return-1;if(!v.is_favorite&&S.is_favorite)return 1;const C=v.last_at||v.updated_at||"";return(S.last_at||S.updated_at||"").localeCompare(C)}));async function n(){try{e.value=await $t()}catch(v){console.error("Failed to load chats",v)}}function m(v){if(s.value=v,v!==null){const S=e.value.find(C=>C.id===v);S&&S.unread_count>0&&(S.unread_count=0,Pt(v).catch(()=>{}))}}async function $(v){const S=e.value.find(C=>C.id===v);if(S)try{S.is_favorite?await Tt(v):await St(v),S.is_favorite=!S.is_favorite}catch(C){throw console.error("Failed to toggle favorite",C),C}}async function _(v){const S=e.value.find(C=>C.id===v);if(S)try{S.is_muted?await Dt(v):await It(v),S.is_muted=!S.is_muted}catch(C){throw console.error("Failed to toggle mute",C),C}}async function M(v){const S=e.value.find(C=>C.id===v);if(S)try{S.is_pinned?await Lt(v):await Ft(v),S.is_pinned=!S.is_pinned}catch(C){throw console.error("Failed to toggle pin",C),C}}async function f(v){const S=e.value.find(C=>C.id===v);if(S)try{S.is_archived?await Nt(v):await Et(v),S.is_archived=!S.is_archived}catch(C){throw console.error("Failed to toggle archive",C),C}}async function r(v){await Ut(v),e.value=e.value.filter(S=>S.id!==v),s.value===v&&(s.value=null)}function g(v,S,C){const R=e.value.find(j=>j.id===v);R&&(R.last_message=S,R.last_at=C)}function w(v){const S=e.value.find(C=>C.id===v);S&&(S.unread_count=(S.unread_count||0)+1)}function o(v,S,C){a.value[v]||(a.value[v]={});const R=a.value[v][S];R&&clearTimeout(R.timer);const j=setTimeout(()=>{d(v,S)},3e3);a.value[v][S]={username:C,timer:j}}function d(v,S){if(a.value[v]){const C=a.value[v][S];C&&(clearTimeout(C.timer),delete a.value[v][S])}}function y(v){const S=a.value[v];return S?Object.values(S).map(C=>C.username):[]}function I(v){l.value=new Set([...l.value,v])}function x(v){const S=new Set(l.value);S.delete(v),l.value=S}function p(v){return l.value.has(v)}return{chats:e,activeChatId:s,activeChat:i,sortedChats:c,typingUsers:a,loadChats:n,setActiveChat:m,toggleFavorite:$,toggleMute:_,togglePin:M,toggleArchive:f,leave:r,updateChatLastMessage:g,incrementUnread:w,setTyping:o,clearTyping:d,getTypingUsernames:y,onlineUsers:l,setUserOnline:I,setUserOffline:x,isUserOnline:p}});async function Rt(){const{data:e}=await B.get("/settings");return e}async function At(e){await B.put("/settings",e)}const Te=xe("settings",()=>{const e=h(localStorage.getItem("theme")||"light"),s=h(!0),a=h("en");function l(n){e.value=n,document.body.setAttribute("data-theme",n),localStorage.setItem("theme",n)}async function i(){try{const n=await Rt();l(n.theme||"light"),s.value=n.notifications_enabled,a.value=n.language||"en"}catch(n){console.error("Failed to load settings",n)}}async function c(n){await At(n),n.theme&&l(n.theme),n.notifications_enabled!==void 0&&(s.value=n.notifications_enabled),n.language&&(a.value=n.language)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:s,language:a,applyTheme:l,loadSettings:i,saveSettings:c}}),Ie=xe("selection",()=>{const e=h(new Set),s=h(!1),a=h(null),l=O(()=>e.value.size);function i(_,M){s.value=!0,a.value=_,e.value=new Set(M!=null?[M]:[])}function c(){s.value=!1,a.value=null,e.value=new Set}function n(_){const M=new Set(e.value);M.has(_)?M.delete(_):M.add(_),e.value=M,M.size===0&&c()}function m(){e.value=new Set}function $(_){return e.value.has(_)}return{selectedMessageIds:e,selectionMode:s,currentChatId:a,selectedCount:l,enterSelectionMode:i,exitSelectionMode:c,toggleMessage:n,clearSelection:m,isSelected:$}});async function Fe(e,s){const{data:a}=await B.get(`/chats/${e}/messages`,{params:s});return a}async function Ot(e,s){const{data:a}=await B.post(`/chats/${e}/messages`,s);return a}async function Bt(e,s){await B.delete(`/chats/${e}/messages/${s}`)}async function zt(e,s){const{data:a}=await B.post(`/chats/${e}/messages/forward`,s);return a}async function Vt(e,s,a){const{data:l}=await B.post(`/chats/${e}/messages/${s}/reactions`,{emoji:a});return l}async function jt(e,s){if(!s.length)return{};const{data:a}=await B.get(`/chats/${e}/reactions`,{params:{message_ids:s.join(",")}});return a}const Ae=xe("messages",()=>{const e=h({}),s=h({}),a=h(null);async function l(o){const d=e.value[o];if(!d||d.length===0)return;const y=d.map(I=>I.id);try{const I=await jt(o,y);for(const x of d)x.reactions=I[String(x.id)]||void 0}catch(I){console.error("Failed to load reactions",I)}}async function i(o){a.value=o;try{const d=await Fe(o,{limit:50});e.value[o]=d,d.length>0&&(s.value[o]=Math.max(...d.map(y=>y.id))),await l(o)}catch(d){throw console.error("Failed to load messages",d),d}finally{a.value=null}}async function c(o){const d=s.value[o]||0;if(d===0)return[];try{const y=await Fe(o,{after_id:d,limit:50});if(y.length>0){e.value[o]||(e.value[o]=[]);const I=new Set(e.value[o].map(p=>p.id)),x=y.filter(p=>!I.has(p.id));e.value[o].push(...x),s.value[o]=Math.max(...y.map(p=>p.id)),await l(o)}return y}catch(y){return console.error("Failed to load newer messages",y),[]}}async function n(o){const d=e.value[o];if(!d||d.length===0)return[];const y=d[0];if(!y)return[];try{const I=await Fe(o,{before:y.created_at,limit:50});if(I.length>0){const x=new Set(d.map(v=>v.id)),p=I.filter(v=>!x.has(v.id));e.value[o]=[...p,...d],await l(o)}return I}catch(I){return console.error("Failed to load older messages",I),[]}}async function m(o,d,y){try{const I=await Vt(o,d,y);$(o,d,I.action,y,!0)}catch(I){console.error("Failed to toggle reaction",I)}}function $(o,d,y,I,x){const p=e.value[o];if(!p)return;const v=p.find(C=>C.id===d);if(!v)return;v.reactions||(v.reactions=[]);const S=v.reactions.find(C=>C.emoji===I);y==="added"?S?(S.count++,x&&(S.me=!0)):v.reactions.push({emoji:I,count:1,me:x}):S&&(S.count--,x&&(S.me=!1),S.count<=0&&(v.reactions=v.reactions.filter(C=>C.emoji!==I))),v.reactions.length===0&&(v.reactions=void 0)}async function _(o,d,y="text",I){const x=await Ot(o,{content:d,type:y,...I});return e.value[o]||(e.value[o]=[]),e.value[o].push(x),s.value[o]=Math.max(s.value[o]||0,x.id),x}function M(o,d){e.value[o]||(e.value[o]=[]),e.value[o].find(I=>I.id===d.id)||(e.value[o].push(d),s.value[o]=Math.max(s.value[o]||0,d.id))}async function f(o,d){try{await Bt(o,d),r(o,d)}catch(y){throw console.error("Failed to delete message",y),y}}function r(o,d){const y=e.value[o];y&&(e.value[o]=y.filter(I=>I.id!==d))}async function g(o,d,y){try{const I=await zt(o,{from_chat_id:d,message_ids:y});for(const x of I)M(o,x);return I}catch(I){throw console.error("Failed to forward messages",I),I}}function w(o){return e.value[o]||[]}return{messagesByChat:e,lastMsgId:s,loadingChat:a,loadMessages:i,loadNewer:c,loadOlder:n,sendMessage:_,pushMessage:M,getMessages:w,toggleReaction:m,applyReactionUpdate:$,deleteMessage:f,removeMessage:r,forwardMessages:g}});function Ht(e,s,a){if(!document.hidden||e.sender_id===a.user?.id||!Te().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||s.chats.find($=>$.id===e.chat_id)?.is_muted)return;const c=e.sender_display_name||e.sender_username||"Someone",n=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,m=new Notification(c,{body:n,tag:`chat-${e.chat_id}`,silent:!1});m.onclick=()=>{window.focus(),s.setActiveChat(e.chat_id),m.close()},setTimeout(()=>m.close(),5e3)}function qt(){const e=h(!1);let s=null,a=null,l=null,i=1e3,c=!1;function n(){const o=localStorage.getItem("access_token");return o?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws?token=${encodeURIComponent(o)}`:null}function m(){if(s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING))return;const o=n();o&&(c=!1,s=new WebSocket(o),s.onopen=()=>{e.value=!0,i=1e3;const d=localStorage.getItem("access_token");d&&s.send(JSON.stringify({type:"auth",token:d}));const y=ne();for(const I of y.chats)s.send(JSON.stringify({type:"subscribe",chat_id:I.id}));_()},s.onmessage=d=>{try{const y=JSON.parse(d.data);$(y)}catch{}},s.onclose=()=>{e.value=!1,M(),c||f()},s.onerror=()=>{})}function $(o){const d=Ae(),y=ne(),I=he();switch(o.type){case"message":{const x=o;d.pushMessage(x.chat_id,x),y.updateChatLastMessage(x.chat_id,x.content||(x.message_type==="sticker"?"Sticker":"Attachment"),x.created_at),x.chat_id!==y.activeChatId&&x.sender_id!==I.user?.id&&y.incrementUnread(x.chat_id),y.clearTyping(x.chat_id,x.sender_id),Ht(x,y,I);break}case"typing":{const x=o.chat_id,p=o.user_id;if(p!==I.user?.id){const v=o.username||"Someone";y.setTyping(x,p,v)}break}case"pong":break;case"presence":{const x=o.user_id,p=o.status;p==="online"?y.setUserOnline(x):p==="offline"&&y.setUserOffline(x);break}case"message_deleted":{const x=o.chat_id,p=o.message_id;d.removeMessage(x,p);break}case"reaction":{const x=o.chat_id,p=o.message_id,v=o.user_id,S=o.emoji,C=o.action;d.applyReactionUpdate(x,p,C,S,v===I.user?.id);break}}}function _(){M(),l=setInterval(()=>{s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},25e3)}function M(){l&&(clearInterval(l),l=null)}function f(){a||(a=setTimeout(()=>{a=null,m(),i=Math.min(i*2,3e4)},i))}function r(o){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"subscribe",chat_id:o}))}function g(o){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"typing",chat_id:o}))}function w(){c=!0,M(),a&&(clearTimeout(a),a=null),s&&(s.close(),s=null),e.value=!1}return ge(()=>{w()}),{connected:e,connect:m,disconnect:w,subscribeToChat:r,sendTyping:g}}async function Wt(e){const{data:s}=await B.get(`/users/${e}`);return s}async function nt(e){const{data:s}=await B.get(`/users/by-username/${encodeURIComponent(e)}`);return s}async function We(e){const{data:s}=await B.get("/users/search",{params:{q:e}});return s}async function Gt(e,s){const{data:a}=await B.put(`/users/${e}`,s);return a}async function Xt(e){const{data:s}=await B.put("/users/me/avatar",{file_id:e});return s}async function Yt(){const{data:e}=await B.get("/stickers");return e}const Zt=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};const Ge=e=>e==="";const Jt=(...e)=>e.filter((s,a,l)=>!!s&&s.trim()!==""&&l.indexOf(s)===a).join(" ").trim();const Xe=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const Qt=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,a,l)=>l?l.toUpperCase():a.toLowerCase());const Kt=e=>{const s=Qt(e);return s.charAt(0).toUpperCase()+s.slice(1)};var be={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const en=({name:e,iconNode:s,absoluteStrokeWidth:a,"absolute-stroke-width":l,strokeWidth:i,"stroke-width":c,size:n=be.width,color:m=be.stroke,...$},{slots:_})=>Ne("svg",{...be,...$,width:n,height:n,stroke:m,"stroke-width":Ge(a)||Ge(l)||a===!0||l===!0?Number(i||c||be["stroke-width"])*24/Number(n):i||c||be["stroke-width"],class:Jt("lucide",$.class,...e?[`lucide-${Xe(Kt(e))}-icon`,`lucide-${Xe(e)}`]:["lucide-icon"]),...!_.default&&!Zt($)&&{"aria-hidden":"true"}},[...s.map(M=>Ne(...M)),..._.default?[_.default()]:[]]);const Z=(e,s)=>(a,{slots:l,attrs:i})=>Ne(en,{...i,...a,iconNode:s,name:e},l);const Le=Z("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const tn=Z("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const nn=Z("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const sn=Z("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const an=Z("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const on=Z("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const ln=Z("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const rn=Z("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const cn=Z("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const st=Z("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const un=Z("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const dn=Z("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const vn=Z("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const mn=Z("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const fn=Z("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const pn=Z("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const at=Z("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const ot=Z("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const ke=Z("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),gn={class:"swipe-actions swipe-actions-left"},hn={class:"chat-item-info"},yn={class:"chat-item-top"},bn={class:"chat-item-name"},wn={key:0,class:"pin-icon",title:"Pinned"},kn={key:1,class:"ci-channel"},_n={key:2,class:"ci-group"},Cn={key:3,class:"mute-icon",title:"Muted"},$n={class:"chat-item-time"},Mn={class:"chat-item-bottom"},xn={class:"chat-item-preview"},Sn=["title"],Tn={class:"swipe-actions swipe-actions-right"},Ye=70,In=W({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:s}){const a=e,l=ne(),i=O(()=>a.chat.type!=="direct"||!a.chat.other_user_id?null:l.isUserOnline(a.chat.other_user_id)||null),c=O(()=>(a.chat.unread_count??0)>0),n=s,m=O(()=>{const o=a.chat;return o.type==="channel"||o.type==="group"?o.title||o.name||"Untitled":o.other_display_name||o.other_username||o.title||o.name||"Chat"});function $(o){if(!o)return"";const d=new Date(o.endsWith("Z")?o:o+"Z"),y=new Date;return d.toDateString()===y.toDateString()?d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):d.toLocaleDateString([],{month:"short",day:"numeric"})}const _=h(0);let M=0,f=!1;function r(o){M=o.touches[0].clientX,f=!0}function g(o){if(!f)return;const d=o.touches[0].clientX-M;_.value=Math.max(-Ye,Math.min(Ye,d))}function w(){f=!1,_.value=0}return(o,d)=>(u(),b("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:r,onTouchmove:g,onTouchend:w},[t("div",gn,[t("button",{class:"swipe-action swipe-pin",onClick:d[0]||(d[0]=y=>n("togglePin"))},E(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:Q(["chat-item",{active:e.active,"chat-item-unread":c.value}]),style:Se({transform:`translateX(${_.value}px)`}),onClick:d[2]||(d[2]=y=>n("select")),onContextmenu:d[3]||(d[3]=Y(y=>n("contextmenu",y),["prevent"]))},[A(ue,{name:m.value,url:e.chat.other_avatar_url,size:"sm",online:i.value},null,8,["name","url","online"]),t("div",hn,[t("div",yn,[t("span",bn,[e.chat.is_pinned?(u(),b("span",wn,"ðŸ“Œ")):F("",!0),e.chat.type==="channel"?(u(),b("span",kn)):e.chat.type==="group"?(u(),b("span",_n)):F("",!0),oe(" "+E(m.value)+" ",1),e.chat.is_muted?(u(),b("span",Cn,"ðŸ””")):F("",!0)]),t("span",$n,E($(e.chat.last_at||e.chat.updated_at)),1)]),t("div",Mn,[t("span",xn,E(e.chat.last_message||""),1),e.chat.unread_count>0?(u(),b("span",{key:0,class:Q(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},E(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):F("",!0)])]),t("button",{class:Q(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:d[1]||(d[1]=Y(y=>n("toggleFavorite"),["stop"]))},"â˜…",10,Sn)],38),t("div",Tn,[t("button",{class:"swipe-action swipe-mute",onClick:d[4]||(d[4]=y=>n("toggleMute"))},E(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),se=(e,s)=>{const a=e.__vccOpts||e;for(const[l,i]of s)a[l]=i;return a},Ee=se(In,[["__scopeId","data-v-455ebfed"]]),Dn={class:"sidebar"},Un={class:"sidebar-header"},Pn={class:"search-wrap"},Fn={class:"chat-list"},Ln={key:0,class:"empty-state-small"},En={key:0,class:"chat-section-label"},Nn={key:1,class:"chat-section-label"},Rn={key:2,class:"chat-section-label"},An=W({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:s}){const a=s,l=ne(),i=h(""),c=O(()=>{const r=i.value.toLowerCase(),g=l.sortedChats.filter(w=>!w.is_archived);return r?g.filter(w=>{const o=_(w).toLowerCase(),d=(w.other_username||"").toLowerCase();return o.includes(r)||d.includes(r)}):g}),n=O(()=>c.value.filter(r=>r.is_pinned&&!r.is_favorite)),m=O(()=>c.value.filter(r=>r.is_favorite&&!r.is_pinned)),$=O(()=>c.value.filter(r=>!r.is_favorite&&!r.is_pinned));function _(r){return r.type==="channel"||r.type==="group"?r.title||r.name||"Untitled":r.other_display_name||r.other_username||r.title||r.name||"Chat"}const M=h(null);_e("contextChatId",M);function f(r,g){r.preventDefault(),M.value=g,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:r.clientX,y:r.clientY,chatId:g}}))}return(r,g)=>(u(),b("aside",Dn,[t("header",Un,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:g[0]||(g[0]=w=>a("openDrawer"))},[A(D(un),{size:20})]),t("div",Pn,[G(t("input",{"onUpdate:modelValue":g[1]||(g[1]=w=>i.value=w),class:"search-input",type:"search",placeholder:"Search chats..."},null,512),[[K,i.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:g[2]||(g[2]=w=>a("openNewChat"))},[A(D(fn),{size:20})])]),t("div",Fn,[c.value.length===0?(u(),b("div",Ln,[...g[3]||(g[3]=[oe(" No conversations yet.",-1),t("br",null,null,-1),oe("Click the pencil icon to start one. ",-1)])])):(u(),b(J,{key:1},[n.value.length>0?(u(),b("div",En,"Pinned")):F("",!0),(u(!0),b(J,null,ee(n.value,w=>(u(),V(Ee,{key:w.id,chat:w,active:w.id===D(l).activeChatId,onSelect:o=>a("selectChat",w.id),onToggleFavorite:o=>D(l).toggleFavorite(w.id),onTogglePin:o=>D(l).togglePin(w.id),onToggleMute:o=>D(l).toggleMute(w.id),onToggleArchive:o=>D(l).toggleArchive(w.id),onContextmenu:o=>f(o,w.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),m.value.length>0?(u(),b("div",Nn,"Starred")):F("",!0),(u(!0),b(J,null,ee(m.value,w=>(u(),V(Ee,{key:w.id,chat:w,active:w.id===D(l).activeChatId,onSelect:o=>a("selectChat",w.id),onToggleFavorite:o=>D(l).toggleFavorite(w.id),onTogglePin:o=>D(l).togglePin(w.id),onToggleMute:o=>D(l).toggleMute(w.id),onToggleArchive:o=>D(l).toggleArchive(w.id),onContextmenu:o=>f(o,w.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(n.value.length>0||m.value.length>0)&&$.value.length>0?(u(),b("div",Rn," All chats ")):F("",!0),(u(!0),b(J,null,ee($.value,w=>(u(),V(Ee,{key:w.id,chat:w,active:w.id===D(l).activeChatId,onSelect:o=>a("selectChat",w.id),onToggleFavorite:o=>D(l).toggleFavorite(w.id),onTogglePin:o=>D(l).togglePin(w.id),onToggleMute:o=>D(l).toggleMute(w.id),onToggleArchive:o=>D(l).toggleArchive(w.id),onContextmenu:o=>f(o,w.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function On(){const e=h(!1),s=h(0);let a=null,l=[],i=null;async function c(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const M=await navigator.mediaDevices.getUserMedia({audio:!0});l=[],s.value=0,a=new MediaRecorder(M),a.ondataavailable=f=>{f.data.size&&l.push(f.data)},a.start(),e.value=!0,i=setInterval(()=>{s.value++},1e3)}function n(){return new Promise((M,f)=>{if(!a||a.state!=="recording"){f(new Error("Not recording"));return}a.onstop=()=>{a?.stream&&a.stream.getTracks().forEach(d=>d.stop()),$(),e.value=!1;const r=a?.mimeType||"audio/webm",g=r.includes("ogg")?"ogg":"webm",w=new Blob(l,{type:r}),o=new File([w],`voice.${g}`,{type:r});M(o)},a.stop()})}function m(){a&&a.state==="recording"&&(a.onstop=()=>{a?.stream&&a.stream.getTracks().forEach(M=>M.stop())},a.stop()),$(),e.value=!1,s.value=0}function $(){i&&(clearInterval(i),i=null)}function _(M){const f=Math.floor(M/60),r=M%60;return`${f}:${String(r).padStart(2,"0")}`}return{isRecording:e,seconds:s,startRecording:c,stopRecording:n,cancelRecording:m,formatTime:_}}async function it(e){const s=new FormData;s.append("file",e);const{data:a}=await B.post("/files",s);return a}const Bn={class:"chat-header"},zn={class:"chat-header-name"},Vn=W({__name:"ChatHeader",emits:["back","openUserProfile"],setup(e,{emit:s}){const a=s,l=ne(),i=O(()=>l.activeChat),c=O(()=>{const f=i.value;return f?f.type==="channel"||f.type==="group"?f.title||f.name||"Untitled":f.other_display_name||f.other_username||f.title||f.name||"Chat":"---"}),n=O(()=>i.value?l.getTypingUsernames(i.value.id):[]),m=O(()=>n.value.length>0),$=O(()=>{const f=i.value;return!f||f.type!=="direct"||!f.other_user_id?!1:l.isUserOnline(f.other_user_id)}),_=O(()=>{if(n.value.length===1)return`${n.value[0]} is typing...`;if(n.value.length>1)return`${n.value.length} people typing...`;const f=i.value;return f?f.type==="channel"?"Channel":f.type==="group"?"Group":$.value?"online":f.other_username?"@"+f.other_username:"":""});function M(){i.value?.type==="direct"&&i.value.other_username&&a("openUserProfile",i.value.other_username)}return(f,r)=>(u(),b("header",Bn,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:r[0]||(r[0]=g=>a("back"))},"â†"),A(ue,{class:"chat-header-avatar",name:c.value,url:i.value?.other_avatar_url,online:$.value,onClick:M},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:M},[t("div",zn,E(c.value),1),t("div",{class:Q(["chat-header-sub",{"typing-text":m.value,"online-text":$.value&&!m.value}])},E(_.value),3)])]))}}),jn={},Hn={class:"admin-badge",title:"Admin"};function qn(e,s){return u(),b("span",Hn,"âœ“")}const lt=se(jn,[["render",qn]]);function Wn(e){const{delay:s=500,scrollThreshold:a=5,onLongPress:l,onCancel:i}=e,c=h(!1);let n=null,m=0,$=0,_=!1;function M(){n&&(clearTimeout(n),n=null)}function f(o){m=o.clientX,$=o.clientY,_=!1,c.value=!0,M(),n=setTimeout(()=>{_=!0,l(o)},s)}function r(o){if(!n)return;const d=o.clientX-m,y=o.clientY-$;(Math.abs(d)>a||Math.abs(y)>a)&&w()}function g(){M(),c.value=!1}function w(){M(),c.value=!1,_||i?.()}return{isPressed:c,onPointerDown:f,onPointerUp:g,onPointerMove:r}}const Gn=["data-message-id"],Xn={key:0,class:"selection-checkbox"},Yn=["checked"],Zn={key:1,class:"msg-sender-name"},Jn={class:"msg-content-wrap"},Qn={class:"msg-reply-quote-name"},Kn={class:"msg-reply-quote-text"},es={key:1,class:"msg-bubble sticker-bubble"},ts=["src","alt"],ns={key:2,class:"msg-bubble"},ss={class:"voice-player"},as=["src"],os={key:0,class:"voice-dur"},is=["innerHTML"],ls={key:4,class:"reaction-chips"},rs=["onClick"],cs={class:"reaction-emoji"},us={class:"reaction-count"},ds={class:"msg-time"},vs=W({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:s}){const a=e,l=s,i=Ie(),c=ne(),n=O(()=>i.isSelected(a.message.id)),{onPointerDown:m,onPointerUp:$,onPointerMove:_}=Wn({delay:500,onLongPress(C){r(C.clientX,C.clientY)}}),M={onPointerdown:m,onPointerup:$,onPointermove:_};function f(C){if(i.selectionMode){i.toggleMessage(a.message.id);return}r(C.clientX,C.clientY)}function r(C,R){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:a.message.id,chatId:c.activeChatId,text:a.message.content||"",x:C,y:R}}))}function g(){i.selectionMode&&i.toggleMessage(a.message.id)}const w=we("stickers",h([])),o=O(()=>{if(a.message.sticker_url)return a.message.sticker_url;if(a.message.sticker_id){const C=w.value.find(R=>R.id===a.message.sticker_id);if(C)return C.url}return""}),d=O(()=>a.message.attachment_url||""),y=O(()=>{const C=a.message.reply_to_type;if(C==="sticker")return"ðŸŽ¨ Sticker";if(C==="voice")return"ðŸŽ¤ Voice message";if(C==="file")return"ðŸ“Ž File";const R=a.message.reply_to_content||"";return R.length>80?R.slice(0,80)+"...":R}),I=O(()=>x(a.message.content||"").replace(/@(\w{1,30})/g,`<span class="mention" data-u="$1" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'$1'}))">@$1</span>`));function x(C){return C.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function p(C){if(!C)return"";const R=new Date(C.endsWith("Z")?C:C+"Z"),j=new Date;return R.toDateString()===j.toDateString()?R.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):R.toLocaleDateString([],{month:"short",day:"numeric"})}function v(C){const R=Math.floor(C/60),j=C%60;return`${R}:${String(j).padStart(2,"0")}`}function S(C){const R=C.target.getBoundingClientRect();l("openEmojiPicker",a.message.id,R.left,R.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(C=>{l("mentionClick",C.detail)})),(C,R)=>(u(),b("div",ht({class:["msg-row",[e.isMine?"mine":"theirs",{selected:n.value}]],"data-message-id":e.message.id,onContextmenu:Y(f,["prevent"])},M,{onClick:g}),[D(i).selectionMode?(u(),b("div",Xn,[t("input",{type:"checkbox",checked:n.value,tabindex:"-1"},null,8,Yn)])):F("",!0),!e.isMine&&e.message.message_type!=="sticker"?(u(),b("div",Zn,[oe(E(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(u(),V(lt,{key:0})):F("",!0)])):F("",!0),t("div",Jn,[e.message.reply_to_message_id?(u(),b("div",{key:0,class:"msg-reply-quote",onClick:R[0]||(R[0]=Y(j=>l("replyClick",e.message.reply_to_message_id),["stop"]))},[R[1]||(R[1]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",Qn,E(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",Kn,E(y.value),1)])])):F("",!0),e.message.message_type==="sticker"?(u(),b("div",es,[t("img",{class:"sticker-img",src:o.value,alt:e.message.sticker_label||"sticker"},null,8,ts)])):e.message.message_type==="voice"?(u(),b("div",ns,[t("div",ss,[t("audio",{controls:"",src:d.value},null,8,as),e.message.duration_seconds?(u(),b("span",os,E(v(e.message.duration_seconds)),1)):F("",!0)])])):(u(),b("div",{key:3,class:"msg-bubble",innerHTML:I.value},null,8,is)),t("button",{class:"reaction-add-btn",onClick:Y(S,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(u(),b("div",ls,[(u(!0),b(J,null,ee(e.message.reactions,j=>(u(),b("button",{key:j.emoji,class:Q(["reaction-chip",{"reaction-mine":j.me}]),onClick:Y(te=>l("toggleReaction",e.message.id,j.emoji),["stop"])},[t("span",cs,E(j.emoji),1),t("span",us,E(j.count),1)],10,rs))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:Y(S,["stop"])},"+")])):F("",!0)]),t("div",ds,E(p(e.message.created_at)),1)],16,Gn))}}),ms={class:"composer-wrap"},fs={key:0,class:"reply-preview"},ps={style:{flex:"1","min-width":"0"}},gs={class:"reply-preview-name"},hs={class:"reply-preview-text"},ys={class:"composer"},bs=["onKeydown"],ws=W({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","cancelReply"],setup(e,{expose:s,emit:a}){const l=e,i=a,c=h(""),n=h(null);let m=0;const $=O(()=>{if(!l.replyTo)return"";const r=l.replyTo.message_type;if(r==="sticker")return"ðŸŽ¨ Sticker";if(r==="voice")return"ðŸŽ¤ Voice message";if(r==="file")return"ðŸ“Ž File";const g=l.replyTo.content||"";return g.length>100?g.slice(0,100)+"...":g});function _(){const r=c.value.trim();r&&(i("send",r),c.value="",f())}function M(){f();const r=Date.now();r-m>2e3&&c.value.trim().length>0&&(m=r,i("typing"))}function f(){const r=n.value;r&&(r.style.height="auto",r.style.height=Math.min(r.scrollHeight,120)+"px")}return ie(()=>{n.value?.focus()}),fe(()=>l.replyTo,r=>{r&&n.value?.focus()}),s({focus:()=>n.value?.focus()}),(r,g)=>(u(),b("div",ms,[e.replyTo?(u(),b("div",fs,[g[4]||(g[4]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",ps,[t("div",gs,E(e.replyTo.sender_display_name||e.replyTo.sender_username),1),t("div",hs,E($.value),1)]),t("button",{class:"reply-preview-close","aria-label":"Cancel reply",onClick:g[0]||(g[0]=w=>i("cancelReply"))},"Ã—")])):F("",!0),t("div",ys,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:g[1]||(g[1]=w=>i("toggleStickers"))},"ðŸŒ"),G(t("textarea",{ref_key:"inputRef",ref:n,"onUpdate:modelValue":g[2]||(g[2]=w=>c.value=w),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:yt(Y(_,["exact","prevent"]),["enter"]),onInput:M},null,40,bs),[[K,c.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:g[3]||(g[3]=w=>i("startRecording"))},"ðŸŽ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:_},"âž¤")])]))}}),ks={class:"sticker-grid"},_s=["title","onClick"],Cs=["src","alt"],$s={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Ms=W({__name:"StickerPicker",emits:["select"],setup(e,{emit:s}){const a=s,l=we("stickers",h([])),i=O(()=>l.value);return(c,n)=>(u(),b("div",ks,[(u(!0),b(J,null,ee(i.value,m=>(u(),b("button",{key:m.id,class:"sticker-btn",title:m.label,onClick:$=>a("select",m.id)},[t("img",{src:m.url,alt:m.label},null,8,Cs)],8,_s))),128)),i.value.length===0?(u(),b("div",$s," No stickers available ")):F("",!0)]))}}),xs={},Ss={class:"msgs-loading"};function Ts(e,s){return u(),b("div",Ss,"Loading...")}const Is=se(xs,[["render",Ts]]),Ds={class:"invite-manage",style:{padding:"0 1rem .5rem"}},Us={class:"invite-link-wrap"},Ps=["value"],Fs=W({__name:"InviteSection",props:{chatId:{}},setup(e){const s=e,{showToast:a}=ce(),l=h("Loading..."),i=h("");async function c(){try{const $=await kt(s.chatId);if($.length>0){const _=$[0];i.value=_.token,l.value=`${window.location.origin}/join/${_.token}`}else{const _=await _t(s.chatId);i.value=_.token,l.value=`${window.location.origin}/join/${_.token}`}}catch{l.value="Failed to generate invite"}}function n(){l.value&&navigator.clipboard&&navigator.clipboard.writeText(l.value).then(()=>a("Link copied!"))}async function m(){if(i.value)try{await Ct(i.value),a("Invite revoked"),await c()}catch{a("Failed to revoke invite")}}return ie(c),($,_)=>(u(),b("div",Ds,[_[0]||(_[0]=t("div",{class:"invite-manage-title"},"Invite Link",-1)),t("div",Us,[t("input",{class:"form-input invite-link-input",value:l.value,type:"text",readonly:""},null,8,Ps),t("button",{class:"btn btn-sm btn-outline",title:"Copy link",onClick:n}," ðŸ“‹ ")]),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:m}," Revoke link ")]))}}),Ls=["onClick"],Es=W({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:s}){const a=s,l=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸŽ‰","ðŸ‘","ðŸ¤”","ðŸ˜","ðŸ˜¡","ðŸ‘Ž","ðŸ‘€","ðŸš€","âœ…","âŒ","ðŸ’¯","ðŸŒŸ","ðŸ˜Š","ðŸ¤¯","ðŸ¥³","ðŸ¥²","ðŸ¤—"];return(i,c)=>e.visible?(u(),b("div",{key:0,class:"emoji-picker",style:Se({left:e.x+"px",top:e.y+"px"}),onClick:c[0]||(c[0]=Y(()=>{},["stop"]))},[(u(),b(J,null,ee(l,n=>t("button",{key:n,class:"emoji-pick-btn",onClick:m=>a("select",n)},E(n),9,Ls)),64))],4)):F("",!0)}}),Ns=W({__name:"MessageContextMenu",setup(e){const{showToast:s}=ce(),a=h(!1),l=h(0),i=h(0),c=h(null),n=h(null),m=h(""),$=O(()=>!n.value||!c.value?null:`${window.location.origin}/c/${n.value}/m/${c.value}`);function _(I){c.value=I.detail.messageId,n.value=I.detail.chatId,m.value=I.detail.text||"",l.value=I.detail.x,i.value=I.detail.y,a.value=!0,requestAnimationFrame(()=>{const x=document.querySelector(".msg-context-menu");if(!x)return;const p=x.getBoundingClientRect();p.right>window.innerWidth&&(l.value=window.innerWidth-p.width-8),p.bottom>window.innerHeight&&(i.value=window.innerHeight-p.height-8)})}function M(){a.value&&(a.value=!1,c.value=null,n.value=null,m.value="")}ie(()=>{window.addEventListener("show-message-context-menu",_),document.addEventListener("click",M)}),ge(()=>{window.removeEventListener("show-message-context-menu",_),document.removeEventListener("click",M)});function f(){a.value=!1}async function r(){f();try{await navigator.clipboard.writeText(m.value),s("Copied to clipboard")}catch{s("Failed to copy text")}}async function g(){if(f(),!!$.value)try{await navigator.clipboard.writeText($.value),s("Link copied")}catch{s("Failed to copy link")}}function w(){f(),!(!c.value||!n.value)&&window.dispatchEvent(new CustomEvent("reply-message",{detail:{messageId:c.value,chatId:n.value}}))}function o(){f(),!(!c.value||!n.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[c.value],chatId:n.value}}))}function d(){f(),!(!c.value||!n.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:c.value,chatId:n.value}}))}function y(){f(),!(!c.value||!n.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:c.value,chatId:n.value}}))}return(I,x)=>(u(),V(Je,{to:"body"},[a.value?(u(),b("div",{key:0,class:"msg-context-menu",style:Se({left:l.value+"px",top:i.value+"px"}),onClick:x[0]||(x[0]=Y(()=>{},["stop"])),onContextmenu:x[1]||(x[1]=Y(()=>{},["prevent"]))},[t("button",{class:"ctx-item",onClick:w}," Reply "),t("button",{class:"ctx-item",onClick:r}," Copy text "),$.value?(u(),b("button",{key:0,class:"ctx-item",onClick:g}," Copy link ")):F("",!0),t("button",{class:"ctx-item",onClick:o}," Forward "),t("button",{class:"ctx-item",onClick:d}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:y}," Delete ")],36)):F("",!0)]))}}),Rs=se(Ns,[["__scopeId","data-v-240d4ba1"]]),As={key:0,class:"selection-bar"},Os={class:"selection-bar-count"},Bs={class:"selection-bar-actions"},zs=["disabled"],Vs=["disabled"],js=W({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:s}){const a=s,l=Ie();return(i,c)=>(u(),V(Qe,{name:"slide-down"},{default:Re(()=>[D(l).selectionMode?(u(),b("div",As,[t("button",{class:"selection-bar-btn cancel-btn",onClick:c[0]||(c[0]=n=>D(l).exitSelectionMode())}," Cancel "),t("span",Os,E(D(l).selectedCount)+" selected",1),t("div",Bs,[t("button",{class:"selection-bar-btn forward-btn",disabled:D(l).selectedCount===0,onClick:c[1]||(c[1]=n=>a("forward"))}," Forward ("+E(D(l).selectedCount)+") ",9,zs),t("button",{class:"selection-bar-btn delete-btn",disabled:D(l).selectedCount===0,onClick:c[2]||(c[2]=n=>a("delete"))}," Delete ("+E(D(l).selectedCount)+") ",9,Vs)])])):F("",!0)]),_:1}))}}),Hs=se(js,[["__scopeId","data-v-9ba988f2"]]),qs=W({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const a=s;function l(){a("close")}return(i,c)=>(u(),V(Je,{to:"body"},[A(Qe,{name:"bottom-sheet"},{default:Re(()=>[e.visible?(u(),b("div",{key:0,class:"bottom-sheet-backdrop",onClick:Y(l,["self"])},[t("div",{class:"bottom-sheet",onClick:c[0]||(c[0]=Y(()=>{},["stop"]))},[c[1]||(c[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),Ke(i.$slots,"default",{},void 0,!0)])])):F("",!0)]),_:3})]))}}),Ws=se(qs,[["__scopeId","data-v-84fa8179"]]),Gs={class:"modal"},Xs={class:"modal-header"},Ys={class:"modal-body"},Zs={class:"forward-chat-list"},Js={key:0,class:"empty-state-small"},Qs=["onClick"],Ks={class:"forward-chat-info"},ea={class:"forward-chat-name"},ta={class:"forward-chat-type"},na={key:0,class:"forward-check"},sa={class:"modal-actions"},aa=["disabled"],oa=W({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:s}){const a=e,l=s,i=ne(),c=Ae(),{showToast:n}=ce(),m=h(""),$=h(null),_=h(!1),M=O(()=>{const o=m.value.toLowerCase().trim(),d=i.sortedChats;return o?d.filter(y=>f(y).toLowerCase().includes(o)):d});function f(o){return o.type==="direct"?o.other_display_name||o.other_username||o.title||"Direct Chat":o.title||o.name||"Unnamed Chat"}function r(o){if(o.type==="direct")return o.other_avatar_url??void 0}function g(){}async function w(){if($.value!==null){_.value=!0;try{await c.forwardMessages($.value,a.fromChatId,a.messageIds),n("Message forwarded!"),l("forwarded",$.value)}catch{n("Failed to forward message")}finally{_.value=!1}}}return(o,d)=>(u(),b("div",{class:"modal-backdrop",onClick:d[2]||(d[2]=Y(y=>l("close"),["self"]))},[t("div",Gs,[t("div",Xs,[d[3]||(d[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:d[0]||(d[0]=y=>l("close"))},"âœ•")]),t("div",Ys,[G(t("input",{"onUpdate:modelValue":d[1]||(d[1]=y=>m.value=y),class:"search-input",type:"search",placeholder:"Search chats...",onInput:g},null,544),[[K,m.value]]),t("div",Zs,[M.value.length===0?(u(),b("div",Js,"No chats found.")):F("",!0),(u(!0),b(J,null,ee(M.value,y=>(u(),b("div",{key:y.id,class:Q(["forward-chat-item",{selected:$.value===y.id}]),onClick:I=>$.value=y.id},[A(ue,{name:f(y),url:r(y),size:"sm"},null,8,["name","url"]),t("div",Ks,[t("div",ea,E(f(y)),1),t("div",ta,E(y.type),1)]),$.value===y.id?(u(),b("span",na,"âœ“")):F("",!0)],10,Qs))),128))]),t("div",sa,[t("button",{class:"btn btn-primary",disabled:$.value===null||_.value,onClick:w},E(_.value?"Forwarding...":"Forward"),9,aa)])])])]))}}),ia=se(oa,[["__scopeId","data-v-ce3f4600"]]),la={class:"modal modal-sm"},ra={class:"modal-header"},ca={class:"modal-body"},ua={class:"delete-confirm-text"},da={key:0,class:"delete-checkbox-label"},va={class:"modal-actions"},ma=W({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:s}){const a=s,l=h(!1);function i(){a("confirm",l.value)}return(c,n)=>(u(),b("div",{class:"modal-backdrop",onClick:n[3]||(n[3]=Y(m=>a("close"),["self"]))},[t("div",la,[t("div",ra,[n[4]||(n[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:n[0]||(n[0]=m=>a("close"))},"âœ•")]),t("div",ca,[t("p",ua," Are you sure you want to delete "+E(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(u(),b("label",da,[G(t("input",{"onUpdate:modelValue":n[1]||(n[1]=m=>l.value=m),type:"checkbox",class:"delete-checkbox"},null,512),[[et,l.value]]),n[5]||(n[5]=oe(" Delete for everyone ",-1))])):F("",!0)]),t("div",va,[t("button",{class:"btn btn-ghost",onClick:n[2]||(n[2]=m=>a("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:i},"Delete")])])]))}}),fa=se(ma,[["__scopeId","data-v-388dbae2"]]),pa={class:"chat-panel"},ga={key:0,class:"empty-chat"},ha={key:1,class:"chat-view"},ya={key:0,class:"channel-readonly-bar"},ba={key:0,class:"date-sep"},wa={key:1,class:"sticker-picker"},ka={key:3,class:"recording-bar"},_a={class:"rec-time"},Ca=W({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:s}){const a=s,l=he(),i=ne(),c=Ae(),{showToast:n}=ce(),m=On(),$=we("stickers",h([])),_=we("sendTyping",()=>{}),M=we("pendingScrollMessageId",h(null)),f=h(null),r=h(!1),g=h(!1),w=h("member"),o=h(!1),d=h(!1),y=h(0),I=h(0),x=h(null),p=Ie(),v=h(!1),S=h(null),C=h(""),R=h(!1),j=h([]),te=h(!1),ae=h([]),de=h(!1),H=h(null);let T=null;const L=O(()=>i.activeChat?.type==="channel"&&w.value==="member"),le=O(()=>i.activeChatId?c.getMessages(i.activeChatId):[]),De=O(()=>{const U=[];let k="";for(const P of le.value){const q=Ue(P.created_at);q!==k&&(U.push({type:"date",label:q}),k=q),U.push({type:"msg",msg:P})}return U});function Ue(U){if(!U)return"";const k=new Date(U.endsWith("Z")?U:U+"Z"),P=new Date;if(k.toDateString()===P.toDateString())return"Today";const q=new Date(P);return q.setDate(P.getDate()-1),k.toDateString()===q.toDateString()?"Yesterday":k.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}fe(()=>i.activeChatId,async U=>{if(r.value=!1,w.value="member",o.value=!1,T&&(clearInterval(T),T=null),!U)return;await c.loadMessages(U),await me(),ve();const k=i.activeChat;if(k&&(k.type==="channel"||k.type==="group"))try{const P=await Mt(U);w.value=P.my_role||"member",o.value=w.value==="owner"||w.value==="admin"}catch{}T=setInterval(()=>{i.activeChatId===U&&c.loadNewer(U).then(P=>{P.length>0&&z()})},2500)});function ve(){f.value&&(f.value.scrollTop=f.value.scrollHeight)}function z(){if(!f.value)return;const U=f.value;U.scrollHeight-U.scrollTop-U.clientHeight<80&&me(()=>{U.scrollTop=U.scrollHeight})}function N(){i.activeChatId&&_(i.activeChatId)}async function X(U){if(!i.activeChatId||!U.trim())return;const k=H.value?.id;H.value=null;try{const P=k?{reply_to_message_id:k}:void 0,q=await c.sendMessage(i.activeChatId,U.trim(),"text",P);l.user&&(q.sender_id=l.user.id,q.sender_username=l.user.username,q.sender_display_name=l.user.display_name),await me(),ve(),i.loadChats()}catch{n("Failed to send message")}}async function re(U){if(i.activeChatId){r.value=!1;try{const k=await c.sendMessage(i.activeChatId,"","sticker",{sticker_id:U}),P=$.value.find(q=>q.id===U);P&&(k.sticker_url=P.url,k.sticker_label=P.label),await me(),ve(),i.loadChats()}catch{n("Failed to send sticker")}}}function Oe(U,k,P){x.value=U,y.value=k,I.value=P,d.value=!0}function rt(U){x.value&&i.activeChatId&&c.toggleReaction(i.activeChatId,x.value,U),d.value=!1,x.value=null}function ct(U,k){i.activeChatId&&c.toggleReaction(i.activeChatId,U,k)}function ut(){d.value=!1,x.value=null}async function dt(){try{await m.startRecording(),g.value=!0;const U=await m.stopRecording();g.value=!1,await gt(U)}catch{g.value=!1,n("Microphone access denied")}}function vt(){m.cancelRecording(),g.value=!1}function Be(U){const{messageIds:k}=U.detail;j.value=k,R.value=!0}function ze(U){const{messageId:k,chatId:P}=U.detail;P&&p.enterSelectionMode(P,k)}function Pe(U){const{messageId:k,chatId:P}=U.detail;if(!k||!P)return;ae.value=[k];const q=le.value.find(ye=>ye.id===k);de.value=!!(q&&q.sender_id===l.user?.id),te.value=!0}function mt(){j.value=[...p.selectedMessageIds],R.value=!0}function ft(){ae.value=[...p.selectedMessageIds],de.value=ae.value.every(U=>{const k=le.value.find(P=>P.id===U);return k&&k.sender_id===l.user?.id}),te.value=!0}function Ve(){R.value=!1,j.value=[],p.exitSelectionMode()}async function pt(U){te.value=!1;const k=i.activeChatId;if(k){for(const P of ae.value)try{await c.deleteMessage(k,P)}catch{n("Failed to delete message")}ae.value=[],p.exitSelectionMode()}}function pe(U){v.value=!1;const k=S.value,P=i.activeChatId;if(!(!k||!P))switch(U){case"reply":{const q=le.value.find(ye=>ye.id===k);q&&(H.value=q);break}case"copy":navigator.clipboard.writeText(C.value).then(()=>n("Copied to clipboard"),()=>n("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${P}/m/${k}`).then(()=>n("Link copied"),()=>n("Failed to copy link"));break;case"forward":j.value=[k],R.value=!0;break;case"select":p.enterSelectionMode(P,k);break;case"delete":Pe(new CustomEvent("",{detail:{messageId:k,chatId:P}}));break}}function je(U){if(!f.value)return;const k=f.value.querySelector(`[data-message-id="${U}"]`);k&&(k.scrollIntoView({behavior:"smooth",block:"center"}),k.classList.add("highlight-message"),setTimeout(()=>k.classList.remove("highlight-message"),2e3))}function He(U){const{messageId:k,chatId:P}=U.detail;if(!k||P!==i.activeChatId)return;const q=le.value.find(ye=>ye.id===k);q&&(H.value=q)}ie(()=>{window.addEventListener("forward-messages",Be),window.addEventListener("select-message",ze),window.addEventListener("delete-message",Pe),window.addEventListener("reply-message",He)}),ge(()=>{window.removeEventListener("forward-messages",Be),window.removeEventListener("select-message",ze),window.removeEventListener("delete-message",Pe),window.removeEventListener("reply-message",He)}),fe(()=>M.value,async U=>{U&&(await me(),setTimeout(()=>{je(U),M.value=null},300))}),fe(()=>i.activeChatId,()=>{p.exitSelectionMode(),H.value=null});async function gt(U){if(i.activeChatId)try{const k=await it(U);await c.sendMessage(i.activeChatId,"","voice",{file_id:k.id,duration_seconds:m.seconds.value}),await c.loadMessages(i.activeChatId),await me(),ve(),i.loadChats()}catch{n("Failed to upload voice message")}}return(U,k)=>(u(),b("main",pa,[D(i).activeChatId?(u(),b("div",ha,[A(Hs,{onForward:mt,onDelete:ft}),G(A(Vn,{onBack:k[0]||(k[0]=P=>a("back")),onOpenUserProfile:k[1]||(k[1]=P=>a("openUserProfile",P))},null,512),[[$e,!D(p).selectionMode]]),L.value?(u(),b("div",ya,[...k[15]||(k[15]=[t("span",{class:"readonly-icon"},"ðŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):F("",!0),t("div",{ref_key:"msgListRef",ref:f,class:"msg-list",onClick:ut},[D(c).loadingChat===D(i).activeChatId?(u(),V(Is,{key:0})):(u(!0),b(J,{key:1},ee(De.value,P=>(u(),b(J,{key:P.type==="date"?"date-"+P.label:"msg-"+P.msg.id},[P.type==="date"?(u(),b("div",ba,[t("span",null,E(P.label),1)])):(u(),V(vs,{key:1,message:P.msg,"is-mine":P.msg.sender_id===D(l).user?.id,onMentionClick:k[2]||(k[2]=q=>a("openUserProfile",q)),onOpenEmojiPicker:Oe,onToggleReaction:ct,onReplyClick:je},null,8,["message","is-mine"]))],64))),128))],512),A(Es,{visible:d.value,x:y.value,y:I.value,onSelect:rt,onClose:k[3]||(k[3]=P=>d.value=!1)},null,8,["visible","x","y"]),r.value?(u(),b("div",wa,[A(Ms,{onSelect:re})])):F("",!0),L.value?F("",!0):G((u(),V(ws,{key:2,"sticker-picker-open":r.value,"reply-to":H.value,onSend:X,onCancelReply:k[4]||(k[4]=P=>H.value=null),onToggleStickers:k[5]||(k[5]=P=>r.value=!r.value),onStartRecording:dt,onTyping:N},null,8,["sticker-picker-open","reply-to"])),[[$e,!g.value]]),g.value?(u(),b("div",ka,[k[16]||(k[16]=t("span",{class:"rec-dot"},null,-1)),t("span",_a,E(D(m).formatTime(D(m).seconds.value)),1),k[17]||(k[17]=t("span",{class:"rec-label"},"Recording... tap mic to stop",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:vt},"âœ•")])):F("",!0),o.value?(u(),V(Fs,{key:4,"chat-id":D(i).activeChatId},null,8,["chat-id"])):F("",!0),A(Rs),A(Ws,{visible:v.value,onClose:k[12]||(k[12]=P=>v.value=!1)},{default:Re(()=>[t("button",{class:"ctx-item",onClick:k[6]||(k[6]=P=>pe("reply"))},"Reply"),t("button",{class:"ctx-item",onClick:k[7]||(k[7]=P=>pe("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:k[8]||(k[8]=P=>pe("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:k[9]||(k[9]=P=>pe("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:k[10]||(k[10]=P=>pe("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:k[11]||(k[11]=P=>pe("delete"))},"Delete")]),_:1},8,["visible"]),R.value?(u(),V(ia,{key:5,"message-ids":j.value,"from-chat-id":D(i).activeChatId,onClose:Ve,onForwarded:Ve},null,8,["message-ids","from-chat-id"])):F("",!0),te.value?(u(),V(fa,{key:6,"message-count":ae.value.length,"can-delete-for-everyone":de.value,onClose:k[13]||(k[13]=P=>te.value=!1),onConfirm:pt},null,8,["message-count","can-delete-for-everyone"])):F("",!0)])):(u(),b("div",ga,[...k[14]||(k[14]=[t("div",{class:"empty-chat-icon"},"ðŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),$a=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Favorites",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function Ma(e){return $a.filter(s=>s.visible(e))}const xa=["disabled"],Sa={class:"menu-item__label"},Ta={key:1,class:"menu-item__badge"},Ia=W({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:s}){const a=s;return(l,i)=>(u(),b("button",{class:Q(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:i[0]||(i[0]=c=>a("click"))},[e.icon?(u(),V(Me(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):F("",!0),t("span",Sa,E(e.label),1),e.badge?(u(),b("span",Ta,E(e.badge),1)):F("",!0),Ke(l.$slots,"right",{},void 0),e.chevron?(u(),V(Me(D(on)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):F("",!0)],10,xa))}}),Ze=se(Ia,[["__scopeId","data-v-682bc042"]]),Da={class:"drawer-header"},Ua={class:"drawer-avatar-wrap"},Pa={class:"drawer-user-info"},Fa={class:"drawer-display-name"},La={class:"drawer-username"},Ea={class:"drawer-nav"},Na={key:0,class:"drawer-divider"},Ra=["onClick"],Aa={class:"menu-item__label"},Oa=["aria-checked"],Ba=W({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:s}){const a=s,l=tt(),i=he(),c=Te(),n={user:at,users:ot,megaphone:st,bookmark:nn,settings:mn,moon:vn,download:ln,"log-out":cn,star:pn},m=O(()=>({isAuthenticated:!!i.user,isDesktop:!0})),$=O(()=>Ma(m.value)),_={openProfile:()=>a("openProfile"),createGroup:()=>a("openNewGroup"),createChannel:()=>a("openNewChannel"),openFavorites:()=>a("openFavorites"),openSettings:()=>a("openSettings"),toggleNightMode:()=>{const f=c.theme==="dark"?"light":"dark";c.applyTheme(f),c.saveSettings({theme:f})},openDownload:()=>a("openDownload"),logout:()=>{i.logout(),l.push("/login")}};function M(f){f&&_[f]&&_[f]()}return(f,r)=>(u(),b("div",{class:Q(["drawer",{open:e.open}])},[t("div",Da,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:r[0]||(r[0]=g=>a("close"))},[A(D(ke),{size:20,"stroke-width":2})]),r[1]||(r[1]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",Ua,[A(ue,{name:D(i).user?.display_name||D(i).user?.username||"?",url:D(i).user?.avatar_url,size:"lg"},null,8,["name","url"]),t("div",Pa,[t("div",Fa,E(D(i).user?.display_name||D(i).user?.username||"---"),1),t("div",La,"@"+E(D(i).user?.username||"---"),1)])]),t("nav",Ea,[(u(!0),b(J,null,ee($.value,g=>(u(),b(J,{key:g.id},[g.separator?(u(),b("div",Na)):F("",!0),g.rightSlot==="toggle"?(u(),b("div",{key:1,class:"menu-item menu-item--toggle",onClick:w=>M(g.action)},[(u(),V(Me(n[g.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",Aa,E(g.label),1),t("span",{class:Q(["toggle-switch",{"toggle-switch--on":D(c).theme==="dark"}]),role:"switch","aria-checked":D(c).theme==="dark"},[...r[2]||(r[2]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Oa)],8,Ra)):g.id==="logout"?(u(),V(Ze,{key:2,icon:n[g.icon],label:g.label,danger:"",onClick:w=>M(g.action)},null,8,["icon","label","onClick"])):(u(),V(Ze,{key:3,icon:n[g.icon],label:g.label,onClick:w=>M(g.action)},null,8,["icon","label","onClick"]))],64))),128))]),r[3]||(r[3]=t("div",{class:"drawer-footer"},"Simple Messenger v2",-1))],2))}}),za=se(Ba,[["__scopeId","data-v-de7cf394"]]),Va={class:"modal"},ja={class:"modal-header"},Ha={class:"modal-body"},qa={key:0,class:"chat-type-cards"},Wa={class:"chat-type-icon"},Ga={class:"chat-type-icon"},Xa={class:"chat-type-icon"},Ya={key:1,class:"new-chat-form"},Za={class:"user-pick-list"},Ja={key:0,class:"empty-state-small"},Qa={key:1,class:"empty-state-small"},Ka=["onClick"],eo={class:"user-pick-name"},to={class:"user-pick-handle"},no={key:2,class:"new-chat-form"},so={class:"form-group"},ao={class:"form-group"},oo={class:"form-group"},io={class:"user-pick-list"},lo=["onClick"],ro={class:"user-pick-name"},co={class:"user-pick-handle"},uo={class:"modal-actions"},vo=["disabled"],mo={key:3,class:"new-chat-form"},fo={class:"form-group"},po={class:"form-group"},go={class:"form-group"},ho={class:"modal-actions"},yo=["disabled"],bo=W({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:s}){const a=e,l=s,i=he(),{showToast:c}=ce(),n=h(a.initialStep),m=h(!1),$=h(""),_=h([]),M=h(!1);let f=null;const r=h(""),g=h(""),w=h(""),o=h([]),d=h(new Set);let y=null;const I=h(""),x=h(""),p=h("");ie(()=>{v("")});async function v(H){M.value=!0;try{const T=await We(H);_.value=T.filter(L=>L.id!==i.user?.id)}catch{_.value=[]}finally{M.value=!1}}function S(){f&&clearTimeout(f),f=setTimeout(()=>v($.value),300)}async function C(H){try{o.value=await We(H)}catch{o.value=[]}}function R(){y&&clearTimeout(y),y=setTimeout(()=>C(w.value),300)}function j(H){d.value.has(H)?d.value.delete(H):d.value.add(H)}async function te(H){m.value=!0;try{const T=await Ce({type:"direct",member_ids:[H]});l("chatCreated",T.id)}catch{c("Failed to start conversation")}finally{m.value=!1}}async function ae(){if(!r.value.trim()){c("Group name is required");return}m.value=!0;try{const H=await Ce({type:"group",title:r.value.trim(),description:g.value.trim(),member_ids:Array.from(d.value)});c("Group created!"),l("chatCreated",H.id)}catch{c("Failed to create group")}finally{m.value=!1}}async function de(){if(!I.value.trim()){c("Channel name is required");return}m.value=!0;try{const H=await Ce({type:"channel",title:I.value.trim(),description:p.value.trim(),public_name:x.value.trim()||void 0,member_ids:[]});c("Channel created!"),l("chatCreated",H.id)}catch{c("Failed to create channel")}finally{m.value=!1}}return(H,T)=>(u(),b("div",{class:"modal-backdrop",onClick:T[14]||(T[14]=Y(L=>l("close"),["self"]))},[t("div",Va,[t("div",ja,[T[15]||(T[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:T[0]||(T[0]=L=>l("close"))},[A(D(ke),{size:20})])]),t("div",Ha,[n.value==="select"?(u(),b("div",qa,[t("button",{class:"chat-type-card",onClick:T[1]||(T[1]=L=>n.value="direct")},[t("span",Wa,[A(D(at),{size:24})]),T[16]||(T[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:T[2]||(T[2]=L=>n.value="group")},[t("span",Ga,[A(D(ot),{size:24})]),T[17]||(T[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:T[3]||(T[3]=L=>n.value="channel")},[t("span",Xa,[A(D(st),{size:24})]),T[18]||(T[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):F("",!0),n.value==="direct"?(u(),b("div",Ya,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:T[4]||(T[4]=L=>n.value="select")},[A(D(Le),{size:16}),T[19]||(T[19]=oe(" Back ",-1))]),G(t("input",{"onUpdate:modelValue":T[5]||(T[5]=L=>$.value=L),class:"search-input",type:"search",placeholder:"Search users...",onInput:S},null,544),[[K,$.value]]),t("div",Za,[M.value?(u(),b("div",Ja,"Loading users...")):_.value.length===0?(u(),b("div",Qa,"No users found.")):(u(!0),b(J,{key:2},ee(_.value,L=>(u(),b("div",{key:L.id,class:"user-pick-item",onClick:le=>te(L.id)},[A(ue,{name:L.display_name||L.username,url:L.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",eo,E(L.display_name||L.username),1),t("div",to,"@"+E(L.username),1)])],8,Ka))),128))])])):F("",!0),n.value==="group"?(u(),b("div",no,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:T[6]||(T[6]=L=>n.value="select")},[A(D(Le),{size:16}),T[20]||(T[20]=oe(" Back ",-1))]),t("div",so,[T[21]||(T[21]=t("label",{class:"form-label"},"Group name",-1)),G(t("input",{"onUpdate:modelValue":T[7]||(T[7]=L=>r.value=L),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[K,r.value]])]),t("div",ao,[T[22]||(T[22]=t("label",{class:"form-label"},"Description (optional)",-1)),G(t("textarea",{"onUpdate:modelValue":T[8]||(T[8]=L=>g.value=L),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[K,g.value]])]),t("div",oo,[T[23]||(T[23]=t("label",{class:"form-label"},"Add members",-1)),G(t("input",{"onUpdate:modelValue":T[9]||(T[9]=L=>w.value=L),class:"search-input",type:"search",placeholder:"Search users...",onInput:R},null,544),[[K,w.value]]),t("div",io,[(u(!0),b(J,null,ee(o.value,L=>(u(),b("div",{key:L.id,class:Q(["user-pick-item",{selected:d.value.has(L.id)}]),onClick:le=>j(L.id)},[A(ue,{name:L.display_name||L.username,url:L.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",ro,[d.value.has(L.id)?(u(),V(D(an),{key:0,size:14,style:{"margin-right":"4px"}})):F("",!0),oe(E(L.display_name||L.username),1)]),t("div",co,"@"+E(L.username),1)])],10,lo))),128))])]),t("div",uo,[t("button",{class:"btn btn-primary",disabled:m.value,onClick:ae}," Create Group ",8,vo)])])):F("",!0),n.value==="channel"?(u(),b("div",mo,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:T[10]||(T[10]=L=>n.value="select")},[A(D(Le),{size:16}),T[24]||(T[24]=oe(" Back ",-1))]),t("div",fo,[T[25]||(T[25]=t("label",{class:"form-label"},"Channel name",-1)),G(t("input",{"onUpdate:modelValue":T[11]||(T[11]=L=>I.value=L),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[K,I.value]])]),t("div",po,[T[26]||(T[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),G(t("input",{"onUpdate:modelValue":T[12]||(T[12]=L=>x.value=L),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[K,x.value]]),T[27]||(T[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",go,[T[28]||(T[28]=t("label",{class:"form-label"},"Description (optional)",-1)),G(t("textarea",{"onUpdate:modelValue":T[13]||(T[13]=L=>p.value=L),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[K,p.value]])]),t("div",ho,[t("button",{class:"btn btn-primary",disabled:m.value,onClick:de}," Create Channel ",8,yo)])])):F("",!0)])])]))}}),wo={class:"modal profile-modal profile-modal--self"},ko={class:"profile-tabs"},_o={class:"profile-modal-body profile-modal-body--scrollable"},Co={class:"profile-avatar-section profile-avatar-upload-section"},$o={class:"profile-avatar-overlay"},Mo={class:"profile-name"},xo={key:0,class:"profile-status profile-status--online"},So={class:"profile-info-list"},To={class:"form-group"},Io={class:"form-group"},Do={key:0,class:"form-hint form-error"},Uo={class:"form-group"},Po={class:"profile-info-item"},Fo={class:"profile-info-value"},Lo={class:"profile-edit-actions"},Eo={class:"profile-info-list"},No={class:"form-group form-inline"},Ro={class:"form-group form-inline"},Ao={class:"toggle"},Oo={class:"form-group form-inline"},Bo=W({__name:"ProfileModal",props:{initialTab:{default:"profile"}},emits:["close"],setup(e,{emit:s}){const a=e,l=s,i=he(),c=Te(),{showToast:n}=ce(),m=h(a.initialTab),$=h(""),_=h(""),M=h(""),f=h(""),r=h(null),g=h("light"),w=h(!0),o=h("en");fe(w,async x=>{x&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(w.value=!1,n("Notifications blocked by browser"))}),ie(async()=>{i.user&&($.value=i.user.display_name||"",_.value=i.user.username,M.value=i.user.bio||""),g.value=c.theme,w.value=c.notificationsEnabled,o.value=c.language});async function d(){const x=r.value?.files?.[0];if(x){try{const p=await it(x),v=await Xt(p.id);i.updateUser({avatar_url:v.avatar_url}),n("Avatar updated!")}catch{n("Upload failed")}r.value&&(r.value.value="")}}async function y(){if(f.value="",!i.user)return;const x={display_name:$.value.trim(),bio:M.value.trim()};_.value.trim()&&_.value.trim()!==i.user.username&&(x.username=_.value.trim());try{const p=await Gt(i.user.id,x);i.updateUser({display_name:p.display_name,username:p.username}),n("Profile saved!"),l("close")}catch(p){p.response?.status===409?f.value="Username already taken":n("Save failed")}}async function I(){try{await c.saveSettings({theme:g.value,notifications_enabled:w.value,language:o.value}),n("Settings saved!"),l("close")}catch{n("Settings save failed")}}return(x,p)=>(u(),b("div",{class:"modal-backdrop profile-backdrop",onClick:p[11]||(p[11]=Y(v=>l("close"),["self"]))},[t("div",wo,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:p[0]||(p[0]=v=>l("close"))},[A(D(ke),{size:20,"stroke-width":2})]),t("div",ko,[t("button",{class:Q(["profile-tab",{active:m.value==="profile"}]),onClick:p[1]||(p[1]=v=>m.value="profile")},"Profile",2),t("button",{class:Q(["profile-tab",{active:m.value==="settings"}]),onClick:p[2]||(p[2]=v=>m.value="settings")},"Settings",2)]),t("div",_o,[G(t("div",null,[t("div",Co,[t("div",{class:"profile-avatar-upload-wrap",onClick:p[3]||(p[3]=v=>r.value?.click())},[A(ue,{name:$.value||D(i).user?.username||"?",url:D(i).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",$o,[A(D(sn),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:r,type:"file",accept:"image/*",class:"hidden",onChange:d},null,544)]),t("div",Mo,E($.value||D(i).user?.username||"?"),1),D(i).user?(u(),b("div",xo," online ")):F("",!0),p[16]||(p[16]=t("div",{class:"profile-divider"},null,-1)),t("div",So,[t("div",To,[p[12]||(p[12]=t("label",{class:"form-label"},"Display name",-1)),G(t("input",{"onUpdate:modelValue":p[4]||(p[4]=v=>$.value=v),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[K,$.value]])]),t("div",Io,[p[13]||(p[13]=t("label",{class:"form-label"},"Username",-1)),G(t("input",{"onUpdate:modelValue":p[5]||(p[5]=v=>_.value=v),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[K,_.value]]),f.value?(u(),b("small",Do,E(f.value),1)):F("",!0)]),t("div",Uo,[p[14]||(p[14]=t("label",{class:"form-label"},"Bio",-1)),G(t("textarea",{"onUpdate:modelValue":p[6]||(p[6]=v=>M.value=v),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[K,M.value]])]),t("div",Po,[p[15]||(p[15]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Fo,E(D(i).user?.id),1)])]),t("div",Lo,[t("button",{class:"btn btn-primary",onClick:y},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:p[7]||(p[7]=v=>l("close"))},"Cancel")])],512),[[$e,m.value==="profile"]]),G(t("div",null,[t("div",Eo,[t("div",No,[p[18]||(p[18]=t("label",{class:"form-label"},"Theme",-1)),G(t("select",{"onUpdate:modelValue":p[8]||(p[8]=v=>g.value=v),class:"form-input form-select"},[...p[17]||(p[17]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[qe,g.value]])]),t("div",Ro,[p[20]||(p[20]=t("label",{class:"form-label"},"Notifications",-1)),t("label",Ao,[G(t("input",{"onUpdate:modelValue":p[9]||(p[9]=v=>w.value=v),type:"checkbox"},null,512),[[et,w.value]]),p[19]||(p[19]=t("span",{class:"toggle-slider"},null,-1))])]),t("div",Oo,[p[22]||(p[22]=t("label",{class:"form-label"},"Language",-1)),G(t("select",{"onUpdate:modelValue":p[10]||(p[10]=v=>o.value=v),class:"form-input form-select"},[...p[21]||(p[21]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ð ÑƒÑÑÐºÐ¸Ð¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[qe,o.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:I},"Save Settings")])],512),[[$e,m.value==="settings"]])])])]))}}),zo={class:"profile-actions"},Vo=["disabled","onClick"],jo={class:"profile-action-btn__circle"},Ho={class:"profile-action-btn__label"},qo=W({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:s}){const a=e,l=s,i=O(()=>{const c=[{icon:dn,label:"Message",event:"message"}];return a.showMute!==!1&&c.push({icon:tn,label:a.muted?"Unmute":"Mute",event:"mute"}),a.showMore!==!1&&c.push({icon:rn,label:"More",event:"more"}),c});return(c,n)=>(u(),b("div",zo,[(u(!0),b(J,null,ee(i.value,m=>(u(),b("button",{key:m.label,class:Q(["profile-action-btn",{"profile-action-btn--danger":m.danger}]),disabled:m.disabled,onClick:$=>l(m.event)},[t("span",jo,[(u(),V(Me(m.icon),{size:22,"stroke-width":1.8}))]),t("span",Ho,E(m.label),1)],10,Vo))),128))]))}}),Wo=se(qo,[["__scopeId","data-v-b5376905"]]),Go={class:"modal profile-modal"},Xo={class:"profile-modal-body"},Yo={key:0,class:"profile-loading"},Zo={class:"profile-avatar-section"},Jo={class:"profile-name"},Qo={class:"profile-info-list"},Ko={class:"profile-info-item"},ei={class:"profile-info-value"},ti={key:0,class:"profile-info-item"},ni={class:"profile-info-value"},si={class:"profile-info-item"},ai={class:"profile-info-value"},oi={key:2,class:"profile-loading"},ii=W({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:s}){const a=e,l=s,i=ne(),{showToast:c}=ce(),n=h(null),m=h(!0),$=h(!1),_=O(()=>n.value?i.isUserOnline(n.value.id):!1);ie(async()=>{try{n.value=await nt(a.username)}catch{n.value=null}finally{m.value=!1}});function M(){$.value=!$.value,c($.value?"User muted":"User unmuted")}return(f,r)=>(u(),b("div",{class:"modal-backdrop profile-backdrop",onClick:r[2]||(r[2]=Y(g=>l("close"),["self"]))},[t("div",Go,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:r[0]||(r[0]=g=>l("close"))},[A(D(ke),{size:20,"stroke-width":2})]),t("div",Xo,[m.value?(u(),b("div",Yo,[...r[3]||(r[3]=[t("p",null,"Loading...",-1)])])):n.value?(u(),b(J,{key:1},[t("div",Zo,[A(ue,{name:n.value.display_name||n.value.username,url:n.value.avatar_url,online:_.value,size:"xxl"},null,8,["name","url","online"])]),t("div",Jo,[oe(E(n.value.display_name||n.value.username)+" ",1),n.value.is_admin?(u(),V(lt,{key:0})):F("",!0)]),t("div",{class:Q(["profile-status",{"profile-status--online":_.value}])},E(_.value?"online":"offline"),3),A(Wo,{muted:$.value,"show-more":!1,onMessage:r[1]||(r[1]=g=>l("message",n.value.username)),onMute:M},null,8,["muted"]),r[7]||(r[7]=t("div",{class:"profile-divider"},null,-1)),t("div",Qo,[t("div",Ko,[r[4]||(r[4]=t("div",{class:"profile-info-label"},"Username",-1)),t("div",ei,"@"+E(n.value.username),1)]),n.value.bio?(u(),b("div",ti,[r[5]||(r[5]=t("div",{class:"profile-info-label"},"Bio",-1)),t("div",ni,E(n.value.bio),1)])):F("",!0),t("div",si,[r[6]||(r[6]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",ai,E(n.value.id),1)])])],64)):(u(),b("div",oi,[...r[8]||(r[8]=[t("p",null,"User not found",-1)])]))])])]))}}),li={class:"modal",style:{"max-width":"420px"}},ri={class:"modal-header"},ci={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},ui=W({__name:"DownloadModal",emits:["close"],setup(e,{emit:s}){const a=s,l=navigator.userAgent.toLowerCase(),i=l.includes("win"),c=l.includes("mac")&&!l.includes("iphone")&&!l.includes("ipad"),n=O(()=>i?"Windows":c?"macOS":null);function m(){i?window.location.href="/downloads/windows/MessengerSetup.exe":c&&(window.location.href="/downloads/macos/Messenger.dmg")}return($,_)=>(u(),b("div",{class:"modal-backdrop",onClick:_[1]||(_[1]=Y(M=>a("close"),["self"]))},[t("div",li,[t("div",ri,[_[2]||(_[2]=t("h2",{class:"modal-title"},"Download Simple Messenger",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:_[0]||(_[0]=M=>a("close"))},[A(D(ke),{size:20})])]),t("div",ci,[n.value?(u(),b("button",{key:0,class:"btn btn-primary btn-full",onClick:m}," Download for "+E(n.value),1)):F("",!0),_[3]||(_[3]=bt('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/MessengerSetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/Messenger.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),di=W({__name:"ContextMenu",setup(e){const s=ne(),{showToast:a}=ce(),l=h(!1),i=h(0),c=h(0),n=h(null),m=O(()=>n.value?s.chats.find(g=>g.id===n.value)??null:null);function $(g){n.value=g.detail.chatId,i.value=g.detail.x,c.value=g.detail.y,l.value=!0}function _(){l.value&&(l.value=!1,n.value=null)}ie(()=>{window.addEventListener("show-context-menu",$),document.addEventListener("click",_)}),ge(()=>{window.removeEventListener("show-context-menu",$),document.removeEventListener("click",_)});async function M(){if(n.value){l.value=!1;try{await s.toggleFavorite(n.value)}catch{a("Failed to update favorite")}}}async function f(){if(n.value){l.value=!1;try{await s.toggleMute(n.value)}catch{a("Failed to update mute")}}}async function r(){if(n.value&&(l.value=!1,!!confirm("Leave this chat?")))try{await s.leave(n.value),a("Left chat")}catch{a("Failed to leave chat")}}return(g,w)=>l.value?(u(),b("div",{key:0,class:"context-menu",style:Se({left:i.value+"px",top:c.value+"px"})},[t("button",{class:"ctx-item",onClick:M},E(m.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:f},E(m.value?.is_muted?"Unmute":"Mute"),1),m.value&&m.value.type!=="direct"?(u(),b("button",{key:0,class:"ctx-item ctx-leave",onClick:r}," Leave chat ")):F("",!0)],4)):F("",!0)}}),fi=W({__name:"MessengerView",setup(e){const s=wt(),a=tt(),l=he(),i=ne(),c=Te(),n=Ie(),{showToast:m}=ce(),{connect:$,disconnect:_,sendTyping:M}=qt();_e("sendTyping",M);const f=h(!1),r=h(!1),g=h("select"),w=h(!1),o=h("profile"),d=h(!1),y=h(null),I=h([]),x=h(null);_e("stickers",I),_e("pendingScrollMessageId",x);let p=null;ie(async()=>{await c.loadSettings();try{I.value=await Yt()}catch{}await i.loadChats(),$(),p=setInterval(()=>i.loadChats(),5e3),v()}),ge(()=>{_(),p&&(clearInterval(p),p=null)}),fe(()=>s.path,()=>{v()}),fe(()=>i.activeChatId,()=>{n.selectionMode&&n.exitSelectionMode()});async function v(){const z=s.path;if(z.startsWith("/@")){const N=s.params.username;N&&(y.value=N)}else if(z.startsWith("/u/")){const N=s.params.id;if(N)try{const X=await Wt(parseInt(N));y.value=X.username}catch{m("User not found")}}else if(z.startsWith("/dm/")){const N=s.params.id;N&&await S(N)}else if(s.name==="messageDeepLink"){const N=parseInt(s.params.chatId),X=parseInt(s.params.messageId);N&&X&&await R(N,X)}else if(z.startsWith("/c/")){const N=s.params.name;N&&await C(N)}}async function S(z){try{let N;if(z.startsWith("@")){const re=z.substring(1);if(l.user?.username===re){y.value=re;return}N=(await nt(re)).id}else if(N=parseInt(z),l.user?.id===N){m("Cannot open DM with yourself");return}const X=await Ce({type:"direct",member_ids:[N]});await i.loadChats(),i.setActiveChat(X.id)}catch{m("Failed to open conversation")}}async function C(z){try{const N=await xt(z);i.chats.find(re=>re.id===N.id)?i.setActiveChat(N.id):m("You are not a member of this channel")}catch{m("Channel not found")}}async function R(z,N){if(!i.chats.find(re=>re.id===z)){m("Chat not found");return}i.setActiveChat(z),await me(),x.value=N}function j(z){i.setActiveChat(z),a.replace("/app")}function te(){i.setActiveChat(null)}function ae(){f.value=!1,o.value="profile",w.value=!0}function de(){f.value=!1,o.value="settings",w.value=!0}function H(){f.value=!1,g.value="group",r.value=!0}function T(){f.value=!1,g.value="channel",r.value=!0}function L(){f.value=!1}function le(z){y.value=z}async function De(z){y.value=null,await S("@"+z)}async function Ue(z){r.value=!1,await i.loadChats(),i.setActiveChat(z)}function ve(z){if(z.key==="Escape"){if(n.selectionMode){n.exitSelectionMode();return}if(y.value){y.value=null;return}if(r.value){r.value=!1;return}if(w.value){w.value=!1;return}if(d.value){d.value=!1;return}if(f.value){f.value=!1;return}if(i.activeChatId!==null){te();return}}}return ie(()=>document.addEventListener("keydown",ve)),ge(()=>document.removeEventListener("keydown",ve)),(z,N)=>(u(),b("div",{class:Q(["layout",{"chat-open":!!D(i).activeChatId}])},[A(za,{open:f.value,onClose:N[0]||(N[0]=X=>f.value=!1),onOpenProfile:ae,onOpenSettings:de,onOpenNewGroup:H,onOpenNewChannel:T,onOpenFavorites:L,onOpenDownload:N[1]||(N[1]=X=>d.value=!0)},null,8,["open"]),t("div",{class:Q(["drawer-overlay",{visible:f.value}]),onClick:N[2]||(N[2]=X=>f.value=!1)},null,2),A(An,{onOpenDrawer:N[3]||(N[3]=X=>f.value=!0),onOpenNewChat:N[4]||(N[4]=X=>{g.value="select",r.value=!0}),onSelectChat:j}),A(Ca,{onBack:te,onOpenUserProfile:le}),r.value?(u(),V(bo,{key:0,"initial-step":g.value,onClose:N[5]||(N[5]=X=>r.value=!1),onChatCreated:Ue},null,8,["initial-step"])):F("",!0),w.value?(u(),V(Bo,{key:1,"initial-tab":o.value,onClose:N[6]||(N[6]=X=>w.value=!1)},null,8,["initial-tab"])):F("",!0),y.value?(u(),V(ii,{key:2,username:y.value,onClose:N[7]||(N[7]=X=>y.value=null),onMessage:De},null,8,["username"])):F("",!0),d.value?(u(),V(ui,{key:3,onClose:N[8]||(N[8]=X=>d.value=!1)})):F("",!0),A(di)],2))}});export{fi as default};
