const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmojiPickerPanel-CJCePGDx.js","assets/index-BXTx4BUI.js","assets/index-wL6QSoiE.css","assets/invites-DG96gcL_.js","assets/EmojiPickerPanel-BVUGRNAt.css"])))=>i.map(i=>d[i]);
import{l as J,m as st,r as y,p as j,q as ya,s as ze,u as Ae,x as wn,d as ne,o as d,c as h,a as t,t as M,w as le,y as at,n as ve,h as z,b as _,e as O,g as ke,z as Y,f as fe,v as be,F as re,A as ye,B as vt,C as Pe,D as nt,E as ba,G as Ce,H as Lt,I as Se,T as Cs,J as Te,i as ln,K as Ln,L as $s,M as ka,N as ss,O as as,P as _a,_ as wa,Q as je,k as Ss,R as Ca,S as mn,U as $a,V as Sa}from"./index-BXTx4BUI.js";import{_ as we,l as Ma,c as xa,r as Ea,p as Ta,j as Ia}from"./invites-DG96gcL_.js";async function La(){const{data:e}=await J.get("/chats");return e}async function Ms(e){const{data:s}=await J.get(`/chats/${e}`);return s}async function Aa(e){const{data:s}=await J.get(`/chats/by-name/${encodeURIComponent(e)}`);return s}async function mt(e){const{data:s}=await J.post("/chats",e);return s}async function Ra(e){await J.post(`/chats/${e}/favorite`)}async function Da(e){await J.delete(`/chats/${e}/favorite`)}async function Pa(e,s){await J.post(`/chats/${e}/mute`,{})}async function Oa(e){await J.delete(`/chats/${e}/mute`)}async function Na(e){await J.delete(`/chats/${e}/leave`)}async function Ua(e){await J.post(`/chats/${e}/read`)}async function Fa(e){await J.post(`/chats/${e}/pin`)}async function za(e){await J.delete(`/chats/${e}/pin`)}async function ja(e){await J.post(`/chats/${e}/archive`)}async function Ba(e){await J.delete(`/chats/${e}/archive`)}async function Ha(e){const{data:s}=await J.get(`/chats/${e}`);return s.members??[]}async function xs(e){await J.delete(`/chats/${e}`)}async function Va(e,s){const{data:n}=await J.patch(`/chats/${e}`,s);return n}async function Wa(e){const{data:s}=await J.get(`/chats/${e}/read-receipts`);return s}const Me=st("chats",()=>{const e=y([]),s=y(null),n=y({}),o=y(new Set),i=y({}),a=j(()=>e.value.find(k=>k.id===s.value)??null),l=j(()=>[...e.value].sort((k,A)=>{if(k.is_pinned&&!A.is_pinned)return-1;if(!k.is_pinned&&A.is_pinned)return 1;if(k.is_favorite&&!A.is_favorite)return-1;if(!k.is_favorite&&A.is_favorite)return 1;const $=k.last_at||k.updated_at||"";return(A.last_at||A.updated_at||"").localeCompare($)}));async function r(){try{e.value=await La()}catch(k){console.error("Failed to load chats",k)}}function u(k){if(s.value=k,k!==null){const A=e.value.find($=>$.id===k);A&&A.unread_count>0&&(A.unread_count=0,Ua(k).catch(()=>{}))}}async function g(k){const A=e.value.find($=>$.id===k);if(A)try{A.is_favorite?await Da(k):await Ra(k),A.is_favorite=!A.is_favorite}catch($){throw console.error("Failed to toggle favorite",$),$}}async function f(k){const A=e.value.find($=>$.id===k);if(A)try{A.is_muted?await Oa(k):await Pa(k),A.is_muted=!A.is_muted}catch($){throw console.error("Failed to toggle mute",$),$}}async function p(k){const A=e.value.find($=>$.id===k);if(A)try{A.is_pinned?await za(k):await Fa(k),A.is_pinned=!A.is_pinned}catch($){throw console.error("Failed to toggle pin",$),$}}async function v(k){const A=e.value.find($=>$.id===k);if(A)try{A.is_archived?await Ba(k):await ja(k),A.is_archived=!A.is_archived}catch($){throw console.error("Failed to toggle archive",$),$}}async function c(k){await Na(k),e.value=e.value.filter(A=>A.id!==k),s.value===k&&(s.value=null)}async function m(k){await xs(k),e.value=e.value.filter(A=>A.id!==k),s.value===k&&(s.value=null)}function b(k,A,$){const x=e.value.find(E=>E.id===k);x&&(x.last_message=A,x.last_at=$)}function L(k,A){const $=e.value.find(x=>x.id===k);$&&(A.title!==void 0&&($.title=A.title),A.description!==void 0&&($.description=A.description),A.avatar_url!==void 0&&($.avatar_url=A.avatar_url))}function C(k){e.value=e.value.filter(A=>A.id!==k),s.value===k&&(s.value=null)}function I(k){const A=e.value.find($=>$.id===k);A&&(A.unread_count=(A.unread_count||0)+1)}function W(k,A,$){n.value[k]||(n.value[k]={});const x=n.value[k][A];x&&clearTimeout(x.timer);const E=setTimeout(()=>{U(k,A)},3e3);n.value[k][A]={username:$,timer:E}}function U(k,A){if(n.value[k]){const $=n.value[k][A];$&&(clearTimeout($.timer),delete n.value[k][A])}}function T(k){const A=n.value[k];return A?Object.values(A).map($=>$.username):[]}function F(k){o.value=new Set([...o.value,k]),i.value={...i.value,[k]:{isOnline:!0}}}function ae(k,A,$){const x=new Set(o.value);x.delete(k),o.value=x,i.value={...i.value,[k]:{isOnline:!1,lastSeenAt:A,lastSeenBucket:$}}}function pe(k,A){if(A.isOnline)o.value=new Set([...o.value,k]);else{const $=new Set(o.value);$.delete(k),o.value=$}i.value={...i.value,[k]:A}}function de(k){return i.value[k]}function ie(k){return o.value.has(k)}return{chats:e,activeChatId:s,activeChat:a,sortedChats:l,typingUsers:n,loadChats:r,setActiveChat:u,toggleFavorite:g,toggleMute:f,togglePin:p,toggleArchive:v,leave:c,deleteChat:m,updateChatLastMessage:b,updateChatMetadata:L,removeChatLocal:C,incrementUnread:I,setTyping:W,clearTyping:U,getTypingUsernames:T,onlineUsers:o,userPresenceDetails:i,setUserOnline:F,setUserOffline:ae,setUserPresence:pe,getUserPresence:de,isUserOnline:ie}});async function qa(){const{data:e}=await J.get("/settings");return e}async function Ga(e){await J.put("/settings",e)}const wt=st("settings",()=>{const e=y(localStorage.getItem("theme")||"light"),s=y(!0),n=y("en"),o=y("everyone"),i=y(!0);function a(u){e.value=u,document.body.setAttribute("data-theme",u),localStorage.setItem("theme",u)}async function l(){try{const u=await qa();a(u.theme||"light"),s.value=u.notifications_enabled,n.value=u.language||"en",o.value=u.last_seen_visibility||"everyone",i.value=u.read_receipts_enabled!==!1}catch(u){console.error("Failed to load settings",u)}}async function r(u){await Ga(u),u.theme&&a(u.theme),u.notifications_enabled!==void 0&&(s.value=u.notifications_enabled),u.language&&(n.value=u.language),u.last_seen_visibility&&(o.value=u.last_seen_visibility),u.read_receipts_enabled!==void 0&&(i.value=u.read_receipts_enabled)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:s,language:n,lastSeenVisibility:o,readReceiptsEnabled:i,applyTheme:a,loadSettings:l,saveSettings:r}}),Je=st("selection",()=>{const e=y(new Set),s=y(!1),n=y(null),o=j(()=>e.value.size);function i(f,p){s.value=!0,n.value=f,e.value=new Set(p!=null?[p]:[])}function a(){s.value=!1,n.value=null,e.value=new Set}function l(f){const p=new Set(e.value);p.has(f)?p.delete(f):p.add(f),e.value=p,p.size===0&&a()}function r(f){if(!s.value||e.value.has(f))return;const p=new Set(e.value);p.add(f),e.value=p}function u(){e.value=new Set}function g(f){return e.value.has(f)}return{selectedMessageIds:e,selectionMode:s,currentChatId:n,selectedCount:o,enterSelectionMode:i,exitSelectionMode:a,toggleMessage:l,addMessage:r,clearSelection:u,isSelected:g}});async function Tt(e,s){const{data:n}=await J.get(`/chats/${e}/messages`,{params:s});return n}async function Ka(e,s){const{data:n}=await J.post(`/chats/${e}/messages`,s);return n}async function Ya(e,s,n=!1){await J.delete(`/chats/${e}/messages/${s}`,n?{data:{for_everyone:!0}}:void 0)}async function Xa(e,s,n){const{data:o}=await J.put(`/chats/${e}/messages/${s}`,{content:n});return o}async function Ja(e,s){const{data:n}=await J.post(`/chats/${e}/messages/forward`,s);return n}async function Qa(e,s){const{data:n}=await J.post(`/chats/${e}/messages/${s}/pin`);return n}async function Za(e,s){await J.delete(`/chats/${e}/messages/${s}/pin`)}async function ei(e){const{data:s}=await J.get(`/chats/${e}/pinned-message`);return s}async function is(e,s,n){const{data:o}=await J.get(`/chats/${e}/messages/search`,{params:{q:s,...n}});return o}async function ti(e,s,n){const{data:o}=await J.post(`/chats/${e}/messages/${s}/reactions`,{emoji:n});return o}async function ni(e,s){if(!s.length)return{};const{data:n}=await J.get(`/chats/${e}/reactions`,{params:{message_ids:s.join(",")}});return n}const Xe=st("messages",()=>{const e=y({}),s=y({}),n=y(null),o=y({}),i=y(new Set),a=ya(new Set);function l(S){return a.add(S),new Promise(R=>setTimeout(R,600))}function r(S){return a.has(S)}async function u(S){const R=e.value[S];if(!R||R.length===0)return;const q=R.map(B=>B.id);try{const B=await ni(S,q);for(const ee of R)ee.reactions=B[String(ee.id)]||void 0}catch(B){console.error("Failed to load reactions",B)}}async function g(S){n.value=S;try{const R=await Tt(S,{limit:50});e.value[S]=R,R.length>0&&(s.value[S]=Math.max(...R.map(q=>q.id))),await u(S)}catch(R){throw console.error("Failed to load messages",R),R}finally{n.value=null}}async function f(S){const R=s.value[S]||0;if(R===0)return[];try{const q=await Tt(S,{after_id:R,limit:50});if(q.length>0){e.value[S]||(e.value[S]=[]);const B=new Set(e.value[S].map(oe=>oe.id)),ee=q.filter(oe=>!B.has(oe.id));e.value[S].push(...ee),s.value[S]=Math.max(...q.map(oe=>oe.id)),await u(S)}return q}catch(q){return console.error("Failed to load newer messages",q),[]}}async function p(S){const R=e.value[S];if(!R||R.length===0)return[];const q=R[0];if(!q)return[];try{const B=await Tt(S,{before:q.created_at,limit:50});if(B.length>0){const ee=new Set(R.map(G=>G.id)),oe=B.filter(G=>!ee.has(G.id));e.value[S]=[...oe,...R],await u(S)}return B}catch(B){return console.error("Failed to load older messages",B),[]}}async function v(S,R,q){try{const B=await ti(S,R,q);c(S,R,B.action,q,!0)}catch(B){console.error("Failed to toggle reaction",B)}}function c(S,R,q,B,ee){const oe=e.value[S];if(!oe)return;const G=oe.find(se=>se.id===R);if(!G)return;G.reactions||(G.reactions=[]);const V=G.reactions.find(se=>se.emoji===B);q==="added"?V?(V.count++,ee&&(V.me=!0)):G.reactions.push({emoji:B,count:1,me:ee}):V&&(V.count--,ee&&(V.me=!1),V.count<=0&&(G.reactions=G.reactions.filter(se=>se.emoji!==B))),G.reactions.length===0&&(G.reactions=void 0)}async function m(S,R,q="text",B){const ee=await Ka(S,{content:R,type:q,...B});e.value[S]||(e.value[S]=[]),b(S,ee);const oe=e.value[S].findIndex(G=>G.id===ee.id);return oe!==-1?e.value[S][oe]=ee:e.value[S].push(ee),s.value[S]=Math.max(s.value[S]||0,ee.id),ee}function b(S,R){if(!R.reply_to_message_id||R.reply_to_sender_username||R.reply_to_sender_name)return;const q=e.value[S];if(!q)return;const B=q.find(ee=>ee.id===R.reply_to_message_id);B&&(R.reply_to_sender_username=B.sender_username,R.reply_to_sender_name=B.sender_display_name||B.sender_username,!R.reply_to_content&&B.content&&(R.reply_to_content=B.content),!R.reply_to_type&&B.message_type&&(R.reply_to_type=B.message_type))}function L(S,R){e.value[S]||(e.value[S]=[]),e.value[S].find(B=>B.id===R.id)||(b(S,R),e.value[S].push(R),s.value[S]=Math.max(s.value[S]||0,R.id))}async function C(S,R,q=!1){try{await l(R),await Ya(S,R,q),I(S,R)}catch(B){throw console.error("Failed to delete message",B),B}finally{a.delete(R)}}function I(S,R){const q=e.value[S];q&&(e.value[S]=q.filter(B=>B.id!==R))}async function W(S,R,q){try{const B=await Xa(S,R,q);U(S,R,B.content,B.updated_at)}catch(B){throw console.error("Failed to edit message",B),B}}function U(S,R,q,B){const ee=e.value[S];if(!ee)return;const oe=ee.find(G=>G.id===R);oe&&(oe.content=q,oe.is_edited=!0,B&&(oe.updated_at=B))}async function T(S,R,q){try{const B=await Ja(S,{from_chat_id:R,message_ids:q});for(const ee of B)L(S,ee);return B}catch(B){throw console.error("Failed to forward messages",B),B}}async function F(S){try{const R=await ei(S);R&&R.message?o.value[S]={message:R.message,pinnedAt:R.pinned_at,pinnedBy:R.pinned_by}:o.value[S]=null}catch(R){console.error("Failed to load pinned message",R),o.value[S]=null}}async function ae(S,R){try{const q=await Qa(S,R);o.value[S]={message:q.message,pinnedAt:q.pinned_at,pinnedBy:q.pinned_by},i.value.delete(S)}catch(q){throw console.error("Failed to pin message",q),q}}async function pe(S,R){try{await Za(S,R),o.value[S]=null}catch(q){throw console.error("Failed to unpin message",q),q}}function de(S,R,q,B){o.value[S]={message:B,pinnedAt:new Date().toISOString(),pinnedBy:q},i.value.delete(S)}function ie(S){o.value[S]=null}function k(S){i.value.add(S)}function A(S){return e.value[S]||[]}const $=y({});function x(S,R,q){$.value[S]||($.value[S]={});const B=$.value[S][R]||0;q>B&&($.value[S][R]=q)}async function E(S){try{const R=await Wa(S);$.value[S]||($.value[S]={});for(const q of R)$.value[S][q.user_id]=q.last_read_msg_id}catch(R){console.error("Failed to load read receipts",R)}}function X(S,R,q){const B=$.value[S];return B?q?(B[q]||0)>=R:Object.values(B).some(ee=>ee>=R):!1}function ce(S,R){const q=$.value[S];return q?Object.values(q).filter(B=>B>=R).length:0}return{messagesByChat:e,lastMsgId:s,loadingChat:n,loadMessages:g,loadNewer:f,loadOlder:p,sendMessage:m,pushMessage:L,getMessages:A,toggleReaction:v,applyReactionUpdate:c,deleteMessage:C,removeMessage:I,editMessage:W,applyMessageUpdate:U,forwardMessages:T,pinnedByChat:o,pinnedDismissed:i,loadPinnedMessage:F,pinMsg:ae,unpinMsg:pe,applyMessagePinned:de,applyMessageUnpinned:ie,dismissPin:k,deletingMessages:a,markForDeletion:l,isDeleting:r,readReceipts:$,applyReadReceipt:x,loadReadReceipts:E,isMessageRead:X,getReadCount:ce}});function si(e,s,n){if(!document.hidden||e.sender_id===n.user?.id||!wt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||s.chats.find(u=>u.id===e.chat_id)?.is_muted)return;const a=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(a,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),s.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function ai(){const e=y(!1);let s=null,n=null,o=null,i=null,a=1e3,l=!1,r=!1,u=null,g=null,f=!document.hidden&&document.hasFocus(),p=!1;function v(k){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"presence_update",status:k}))}function c(){const k=!document.hidden&&document.hasFocus();k&&!f?(g&&(clearTimeout(g),g=null),f=!0,v("active")):!k&&f&&(g||(g=setTimeout(()=>{g=null,f=!1,v("away")},3e3)))}function m(){p||(p=!0,document.addEventListener("visibilitychange",c),window.addEventListener("focus",c),window.addEventListener("blur",c))}function b(){p&&(p=!1,document.removeEventListener("visibilitychange",c),window.removeEventListener("focus",c),window.removeEventListener("blur",c),g&&(clearTimeout(g),g=null))}function L(){return localStorage.getItem("access_token")?"wss://ws.behappy.rest/ws":null}function C(){if(s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING))return;const k=L();k&&(l=!1,s=new WebSocket(k),s.onopen=()=>{e.value=!0,a=1e3,u=null,de(),f=!document.hidden&&document.hasFocus();const A=localStorage.getItem("access_token");A&&s.send(JSON.stringify({type:"auth",token:A,active:f}));const $=Me();for(const x of $.chats)s.send(JSON.stringify({type:"subscribe",chat_id:x.id}));if(r){const x=Xe();$.loadChats(),$.activeChatId&&x.loadNewer($.activeChatId)}r=!0,W(),m()},s.onmessage=A=>{try{const $=JSON.parse(A.data);I($)}catch{}},s.onclose=()=>{e.value=!1,U(),l||(u=u||Date.now(),T(),pe())},s.onerror=()=>{})}function I(k){const A=Xe(),$=Me(),x=Ae();switch(k.type){case"message":{const E=k;A.pushMessage(E.chat_id,E),$.updateChatLastMessage(E.chat_id,E.content||(E.message_type==="sticker"?"Sticker":"Attachment"),E.created_at),E.chat_id!==$.activeChatId&&E.sender_id!==x.user?.id&&$.incrementUnread(E.chat_id),$.clearTyping(E.chat_id,E.sender_id),si(E,$,x);break}case"typing":{const E=k.chat_id,X=k.user_id;if(X!==x.user?.id){const ce=k.username||"Someone";$.setTyping(E,X,ce)}break}case"pong":break;case"presence":{const E=k.user_id,X=k.status,ce=k.last_seen_at,S=k.last_seen_bucket;if(X==="online")$.setUserOnline(E);else if(X==="offline"){const R=ce||new Date().toISOString();$.setUserOffline(E,R,S)}break}case"message_deleted":{const E=k.chat_id,X=k.message_id;A.removeMessage(E,X);break}case"message_updated":{const E=k.chat_id,X=k.message_id,ce=k.content,S=k.updated_at;A.applyMessageUpdate(E,X,ce,S);break}case"message_pinned":{const E=k.chat_id,X=k.message_id,ce=k.pinned_by,S=k.message;A.applyMessagePinned(E,X,ce,S);break}case"message_unpinned":{const E=k.chat_id;A.applyMessageUnpinned(E);break}case"reaction":{const E=k.chat_id,X=k.message_id,ce=k.user_id,S=k.emoji,R=k.action;A.applyReactionUpdate(E,X,R,S,ce===x.user?.id);break}case"read_receipt":{const E=k.chat_id,X=k.user_id,ce=k.last_read_msg_id;A.applyReadReceipt(E,X,ce);break}case"chat_created":{const E=k.chat_id;$.loadChats().then(()=>{F(E)});break}case"chat_updated":{const E=k.chat_id;$.updateChatMetadata(E,{title:k.title,description:k.description,avatar_url:k.avatar_url});break}case"chat_deleted":{const E=k.chat_id;$.removeChatLocal(E);break}case"chat_member_joined":break;case"chat_member_left":{const E=k.chat_id;k.user_id===x.user?.id&&$.removeChatLocal(E);break}case"user_profile_updated":{const E=k.user_id,X=k.display_name,ce=k.avatar_url;for(const S of $.chats)S.type==="direct"&&S.other_user_id===E&&(X!==void 0&&(S.title=X),ce!==void 0&&(S.other_avatar_url=ce));break}}}function W(){U(),o=setInterval(()=>{s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},25e3)}function U(){o&&(clearInterval(o),o=null)}function T(){n||(n=setTimeout(()=>{n=null,C(),a=Math.min(a*2,3e4)},a))}function F(k){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"subscribe",chat_id:k}))}function ae(k){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"typing",chat_id:k}))}function pe(){i||(i=setInterval(()=>{if(u&&Date.now()-u>1e4){const k=Me();k.loadChats();const A=Xe();k.activeChatId&&A.loadNewer(k.activeChatId)}},5e3))}function de(){i&&(clearInterval(i),i=null)}function ie(){l=!0,U(),de(),b(),n&&(clearTimeout(n),n=null),s&&(s.close(),s=null),e.value=!1}return ze(()=>{ie()}),{connected:e,connect:C,disconnect:ie,subscribeToChat:F,sendTyping:ae}}async function Es(e){const{data:s}=await J.get(`/users/${e}`);return s}async function Ts(e){const{data:s}=await J.get(`/users/by-username/${encodeURIComponent(e)}`);return s}async function os(e){const{data:s}=await J.get("/users/search",{params:{q:e}});return s}async function ii(e,s){const{data:n}=await J.put(`/users/${e}`,s);return n}async function oi(e){const{data:s}=await J.put("/users/me/avatar",{file_id:e});return s}async function li(){const{data:e}=await J.get("/stickers");return e}const ri=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};const ls=e=>e==="";const ci=(...e)=>e.filter((s,n,o)=>!!s&&s.trim()!==""&&o.indexOf(s)===n).join(" ").trim();const rs=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const ui=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,n,o)=>o?o.toUpperCase():n.toLowerCase());const di=e=>{const s=ui(e);return s.charAt(0).toUpperCase()+s.slice(1)};var ct={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const vi=({name:e,iconNode:s,absoluteStrokeWidth:n,"absolute-stroke-width":o,strokeWidth:i,"stroke-width":a,size:l=ct.width,color:r=ct.stroke,...u},{slots:g})=>wn("svg",{...ct,...u,width:l,height:l,stroke:r,"stroke-width":ls(n)||ls(o)||n===!0||o===!0?Number(i||a||ct["stroke-width"])*24/Number(l):i||a||ct["stroke-width"],class:ci("lucide",u.class,...e?[`lucide-${rs(di(e))}-icon`,`lucide-${rs(e)}`]:["lucide-icon"]),...!g.default&&!ri(u)&&{"aria-hidden":"true"}},[...s.map(f=>wn(...f)),...g.default?[g.default()]:[]]);const Z=(e,s)=>(n,{slots:o,attrs:i})=>wn(vi,{...i,...n,iconNode:s,name:e},o);const Fe=Z("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const mi=Z("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);const Is=Z("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const cs=Z("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);const fi=Z("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const Ls=Z("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const As=Z("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const pi=Z("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Rs=Z("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const hi=Z("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const gi=Z("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const us=Z("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const fn=Z("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const An=Z("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const ds=Z("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const yi=Z("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);const Rn=Z("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const bi=Z("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const ki=Z("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const Dn=Z("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const Ds=Z("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const _i=Z("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const wi=Z("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const Ps=Z("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);const Ci=Z("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const vs=Z("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);const $i=Z("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);const Pn=Z("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Si=Z("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);const Mi=Z("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);const xi=Z("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]);const Ei=Z("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Ti=Z("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Ii=Z("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);const Li=Z("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const Ai=Z("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const Os=Z("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const Ns=Z("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const On=Z("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const qe=Z("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ri="/assets/chat-type-channel-BdwnW-Co.png",Di="/assets/chat-type-group-DoN7bi6N.png",Pi={class:"swipe-actions swipe-actions-left"},Oi={class:"chat-item-info"},Ni={class:"chat-item-top"},Ui={class:"chat-item-name"},Fi={key:0,src:Ri,alt:"",class:"chat-type-icon-img"},zi={key:1,src:Di,alt:"",class:"chat-type-icon-img"},ji={class:"chat-item-time"},Bi={class:"chat-item-bottom"},Hi={class:"chat-item-preview"},Vi=["title"],Wi={class:"swipe-actions swipe-actions-right"},ms=70,qi=ne({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:s}){const n=e,o=Me(),i=Ae(),a=j(()=>n.chat.type==="direct"&&!n.chat.other_user_id),l=j(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:o.isUserOnline(n.chat.other_user_id)||null),r=j(()=>(n.chat.unread_count??0)>0),u=s,g=j(()=>{const C=n.chat;return a.value?"Saved Messages":C.type==="channel"||C.type==="group"?C.title||C.name||"Untitled":C.other_display_name||C.other_username||C.title||C.name||"Chat"});function f(C){if(!C)return"";const I=new Date(C.endsWith("Z")?C:C+"Z"),W=new Date;return I.toDateString()===W.toDateString()?I.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):I.toLocaleDateString([],{month:"short",day:"numeric"})}const p=y(0);let v=0,c=!1;function m(C){v=C.touches[0].clientX,c=!0}function b(C){if(!c)return;const I=C.touches[0].clientX-v;p.value=Math.max(-ms,Math.min(ms,I))}function L(){c=!1,p.value=0}return(C,I)=>(d(),h("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:m,onTouchmove:b,onTouchend:L},[t("div",Pi,[t("button",{class:"swipe-action swipe-pin",onClick:I[0]||(I[0]=W=>u("togglePin"))},M(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:ve(["chat-item",{active:e.active,"chat-item-unread":r.value}]),style:at({transform:`translateX(${p.value}px)`}),onClick:I[2]||(I[2]=W=>u("select")),onContextmenu:I[3]||(I[3]=le(W=>u("contextmenu",W),["prevent"]))},[z(we,{name:g.value,url:a.value?_(i).user?.avatar_url||null:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"md",online:l.value},null,8,["name","url","online"]),t("div",Oi,[t("div",Ni,[t("span",Ui,[e.chat.type==="channel"?(d(),h("img",Fi)):e.chat.type==="group"?(d(),h("img",zi)):O("",!0),ke(" "+M(g.value)+" ",1),e.chat.is_pinned?(d(),Y(_(Si),{key:2,class:"status-icon",size:14,"stroke-width":1.8,title:"Pinned"})):O("",!0),e.chat.is_muted?(d(),Y(_(Is),{key:3,class:"status-icon status-icon-muted",size:14,"stroke-width":1.8,title:"Muted"})):O("",!0)]),t("span",ji,M(f(e.chat.last_at||e.chat.updated_at)),1)]),t("div",Bi,[t("span",Hi,M(e.chat.last_message||""),1),e.chat.unread_count>0?(d(),h("span",{key:0,class:ve(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},M(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):O("",!0)])]),t("button",{class:ve(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:I[1]||(I[1]=le(W=>u("toggleFavorite"),["stop"]))},"â˜…",10,Vi)],38),t("div",Wi,[t("button",{class:"swipe-action swipe-mute",onClick:I[4]||(I[4]=W=>u("toggleMute"))},M(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),me=(e,s)=>{const n=e.__vccOpts||e;for(const[o,i]of s)n[o]=i;return n},pn=me(qi,[["__scopeId","data-v-dde1f18d"]]),Gi={class:"sidebar"},Ki={class:"sidebar-header"},Yi={class:"search-wrap"},Xi={class:"chat-list"},Ji={key:0,class:"empty-state-small"},Qi={key:0,class:"chat-section-label"},Zi={key:1,class:"chat-section-label"},eo={key:2,class:"chat-section-label"},to=ne({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:s}){const n=s,o=Me(),i=y(""),a=j(()=>{const v=i.value.toLowerCase(),c=o.sortedChats.filter(m=>!m.is_archived);return v?c.filter(m=>{const b=g(m).toLowerCase(),L=(m.other_username||"").toLowerCase();return b.includes(v)||L.includes(v)}):c}),l=j(()=>a.value.filter(v=>v.is_pinned&&!v.is_favorite)),r=j(()=>a.value.filter(v=>v.is_favorite&&!v.is_pinned)),u=j(()=>a.value.filter(v=>!v.is_favorite&&!v.is_pinned));function g(v){return v.type==="channel"||v.type==="group"?v.title||v.name||"Untitled":v.type==="direct"&&!v.other_user_id?"Saved Messages":v.other_display_name||v.other_username||v.title||v.name||"Chat"}const f=y(null);vt("contextChatId",f);function p(v,c){v.preventDefault(),f.value=c,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:v.clientX,y:v.clientY,chatId:c}}))}return(v,c)=>(d(),h("aside",Gi,[t("header",Ki,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:c[0]||(c[0]=m=>n("openDrawer"))},[z(_(_i),{size:20})]),t("div",Yi,[z(_(Mi),{size:16,class:"search-icon"}),fe(t("input",{"onUpdate:modelValue":c[1]||(c[1]=m=>i.value=m),class:"search-input",type:"search",placeholder:"Search"},null,512),[[be,i.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:c[2]||(c[2]=m=>n("openNewChat"))},[z(_(Li),{size:20})])]),t("div",Xi,[a.value.length===0?(d(),h("div",Ji,[...c[3]||(c[3]=[ke(" No conversations yet.",-1),t("br",null,null,-1),ke("Click the pencil icon to start one. ",-1)])])):(d(),h(re,{key:1},[l.value.length>0?(d(),h("div",Qi,"Pinned")):O("",!0),(d(!0),h(re,null,ye(l.value,m=>(d(),Y(pn,{key:m.id,chat:m,active:m.id===_(o).activeChatId,onSelect:b=>n("selectChat",m.id),onToggleFavorite:b=>_(o).toggleFavorite(m.id),onTogglePin:b=>_(o).togglePin(m.id),onToggleMute:b=>_(o).toggleMute(m.id),onToggleArchive:b=>_(o).toggleArchive(m.id),onContextmenu:b=>p(b,m.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(d(),h("div",Zi,"Starred")):O("",!0),(d(!0),h(re,null,ye(r.value,m=>(d(),Y(pn,{key:m.id,chat:m,active:m.id===_(o).activeChatId,onSelect:b=>n("selectChat",m.id),onToggleFavorite:b=>_(o).toggleFavorite(m.id),onTogglePin:b=>_(o).togglePin(m.id),onToggleMute:b=>_(o).toggleMute(m.id),onToggleArchive:b=>_(o).toggleArchive(m.id),onContextmenu:b=>p(b,m.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&u.value.length>0?(d(),h("div",eo," All chats ")):O("",!0),(d(!0),h(re,null,ye(u.value,m=>(d(),Y(pn,{key:m.id,chat:m,active:m.id===_(o).activeChatId,onSelect:b=>n("selectChat",m.id),onToggleFavorite:b=>_(o).toggleFavorite(m.id),onTogglePin:b=>_(o).togglePin(m.id),onToggleMute:b=>_(o).toggleMute(m.id),onToggleArchive:b=>_(o).toggleArchive(m.id),onContextmenu:b=>p(b,m.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function no(){const e=y(!1),s=y(0);let n=null,o=[],i=null;async function a(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const f=await navigator.mediaDevices.getUserMedia({audio:!0});o=[],s.value=0,n=new MediaRecorder(f),n.ondataavailable=p=>{p.data.size&&o.push(p.data)},n.start(),e.value=!0,i=setInterval(()=>{s.value++},1e3)}function l(){return new Promise((f,p)=>{if(!n||n.state!=="recording"){p(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(L=>L.stop()),u(),e.value=!1;const v=n?.mimeType||"audio/webm",c=v.includes("ogg")?"ogg":"webm",m=new Blob(o,{type:v}),b=new File([m],`voice.${c}`,{type:v});f(b)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(f=>f.stop())},n.stop()),u(),e.value=!1,s.value=0}function u(){i&&(clearInterval(i),i=null)}function g(f){const p=Math.floor(f/60),v=f%60;return`${p}:${String(v).padStart(2,"0")}`}return{isRecording:e,seconds:s,startRecording:a,stopRecording:l,cancelRecording:r,formatTime:g}}async function At(e){const s=new FormData;s.append("file",e);const{data:n}=await J.post("/files",s);return n}const so={class:"pin-bar-content"},ao={class:"pin-bar-sender"},io={class:"pin-bar-text"},oo=ne({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const s=e,n=j(()=>s.message.sender_display_name||s.message.sender_username||"Unknown"),o=j(()=>{const i=s.message;switch(i.message_type){case"sticker":return i.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return i.content||""}});return(i,a)=>(d(),h("div",{class:"pin-bar",onClick:a[1]||(a[1]=l=>i.$emit("click"))},[a[2]||(a[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",so,[t("span",ao,M(n.value),1),t("span",io,M(o.value),1)]),t("button",{class:"pin-bar-close",onClick:a[0]||(a[0]=le(l=>i.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}}),lo="/assets/search-messages-Zb3bde1c.png";function Nn(e){const s=new Date(e),o=new Date().getTime()-s.getTime(),i=Math.floor(o/1e3),a=Math.floor(i/60),l=Math.floor(a/60),r=Math.floor(l/24);if(a<1)return"last seen just now";if(a<60)return`last seen ${a} minute${a!==1?"s":""} ago`;if(l<24)return`last seen ${l} hour${l!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const u=s.toLocaleString("en",{month:"short"}),g=s.getDate();return`last seen ${u} ${g}`}const ro={class:"chat-header"},co={class:"chat-header-name"},uo={key:0,class:"typing-dots"},vo=ne({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:s}){const n=s,o=Me(),i=Ae(),a=j(()=>o.activeChat),l=j(()=>{const m=a.value;return m?.type==="direct"&&!m.other_user_id}),r=j(()=>{const m=a.value;return m?l.value?"Saved Messages":m.type==="channel"||m.type==="group"?m.title||m.name||"Untitled":m.other_display_name||m.other_username||m.title||m.name||"Chat":"---"}),u=j(()=>{const m=a.value;if(m)return l.value?i.user?.avatar_url:m.type==="direct"?m.other_avatar_url:m.avatar_url}),g=j(()=>a.value?o.getTypingUsernames(a.value.id):[]),f=j(()=>g.value.length>0),p=j(()=>{const m=a.value;return!m||m.type!=="direct"||!m.other_user_id?!1:o.isUserOnline(m.other_user_id)}),v=j(()=>{if(g.value.length===1)return`${g.value[0]} is typing`;if(g.value.length>1)return`${g.value.length} people typing`;const m=a.value;if(!m)return"";if(l.value)return"personal storage";if(m.type==="channel"){const b=m.member_count??0;return`${b} subscriber${b!==1?"s":""}`}if(m.type==="group"){const b=m.member_count??0;return`${b} member${b!==1?"s":""}`}if(p.value)return"online";if(m.type==="direct"&&m.other_user_id){const b=o.getUserPresence(m.other_user_id);if(b){if(b.lastSeenAt)return Nn(b.lastSeenAt);if(b.lastSeenBucket)return`last seen ${b.lastSeenBucket}`}}return m.other_username?"@"+m.other_username:""});Pe(()=>a.value?.id,()=>{const m=a.value;if(!m||m.type!=="direct"||!m.other_user_id)return;const b=m.other_user_id;o.getUserPresence(b)||Es(b).then(L=>{L.last_activity&&o.setUserPresence(b,{isOnline:o.isUserOnline(b),lastSeenAt:L.last_activity})}).catch(()=>{})},{immediate:!0});function c(){const m=a.value;m&&(m.type==="channel"||m.type==="group"?n("openChannelInfo"):m.type==="direct"&&m.other_username&&n("openUserProfile",m.other_username))}return(m,b)=>(d(),h("header",ro,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:b[0]||(b[0]=L=>n("back"))},"â†"),z(we,{class:"chat-header-avatar",name:r.value,url:u.value,online:p.value,size:"sm",onClick:c},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:c},[t("div",co,M(r.value),1),v.value?(d(),h("div",{key:0,class:ve(["chat-header-sub",{"typing-text":f.value,"online-text":p.value&&!f.value}])},[ke(M(v.value),1),f.value?(d(),h("span",uo,[...b[2]||(b[2]=[t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1)])])):O("",!0)],2)):O("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:b[1]||(b[1]=L=>n("openSearch"))},[...b[3]||(b[3]=[t("img",{src:lo,alt:"Search",class:"search-icon-img"},null,-1)])])]))}}),mo=me(vo,[["__scopeId","data-v-59b43906"]]),fo="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",po="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",Cn="numeric",$n="ascii",Sn="alpha",ft="asciinumeric",dt="alphanumeric",Mn="domain",Us="emoji",ho="scheme",go="slashscheme",hn="whitespace";function yo(e,s){return e in s||(s[e]=[]),s[e]}function Ye(e,s,n){s[Cn]&&(s[ft]=!0,s[dt]=!0),s[$n]&&(s[ft]=!0,s[Sn]=!0),s[ft]&&(s[dt]=!0),s[Sn]&&(s[dt]=!0),s[dt]&&(s[Mn]=!0),s[Us]&&(s[Mn]=!0);for(const o in s){const i=yo(o,n);i.indexOf(e)<0&&i.push(e)}}function bo(e,s){const n={};for(const o in s)s[o].indexOf(e)>=0&&(n[o]=!0);return n}function Ee(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}Ee.groups={};Ee.prototype={accepts(){return!!this.t},go(e){const s=this,n=s.j[e];if(n)return n;for(let o=0;o<s.jr.length;o++){const i=s.jr[o][0],a=s.jr[o][1];if(a&&i.test(e))return a}return s.jd},has(e,s=!1){return s?e in this.j:!!this.go(e)},ta(e,s,n,o){for(let i=0;i<e.length;i++)this.tt(e[i],s,n,o)},tr(e,s,n,o){o=o||Ee.groups;let i;return s&&s.j?i=s:(i=new Ee(s),n&&o&&Ye(s,n,o)),this.jr.push([e,i]),i},ts(e,s,n,o){let i=this;const a=e.length;if(!a)return i;for(let l=0;l<a-1;l++)i=i.tt(e[l]);return i.tt(e[a-1],s,n,o)},tt(e,s,n,o){o=o||Ee.groups;const i=this;if(s&&s.j)return i.j[e]=s,s;const a=s;let l,r=i.go(e);if(r?(l=new Ee,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new Ee,a){if(o)if(l.t&&typeof l.t=="string"){const u=Object.assign(bo(l.t,o),n);Ye(a,u,o)}else n&&Ye(a,n,o);l.t=a}return i.j[e]=l,l}};const Q=(e,s,n,o,i)=>e.ta(s,n,o,i),ge=(e,s,n,o,i)=>e.tr(s,n,o,i),fs=(e,s,n,o,i)=>e.ts(s,n,o,i),N=(e,s,n,o,i)=>e.tt(s,n,o,i),Ue="WORD",xn="UWORD",Fs="ASCIINUMERICAL",zs="ALPHANUMERICAL",kt="LOCALHOST",En="TLD",Tn="UTLD",It="SCHEME",tt="SLASH_SCHEME",Un="NUM",In="WS",Fn="NL",pt="OPENBRACE",ht="CLOSEBRACE",Rt="OPENBRACKET",Dt="CLOSEBRACKET",Pt="OPENPAREN",Ot="CLOSEPAREN",Nt="OPENANGLEBRACKET",Ut="CLOSEANGLEBRACKET",Ft="FULLWIDTHLEFTPAREN",zt="FULLWIDTHRIGHTPAREN",jt="LEFTCORNERBRACKET",Bt="RIGHTCORNERBRACKET",Ht="LEFTWHITECORNERBRACKET",Vt="RIGHTWHITECORNERBRACKET",Wt="FULLWIDTHLESSTHAN",qt="FULLWIDTHGREATERTHAN",Gt="AMPERSAND",Kt="APOSTROPHE",Yt="ASTERISK",Ve="AT",Xt="BACKSLASH",Jt="BACKTICK",Qt="CARET",We="COLON",zn="COMMA",Zt="DOLLAR",Re="DOT",en="EQUALS",jn="EXCLAMATION",Le="HYPHEN",gt="PERCENT",tn="PIPE",nn="PLUS",sn="POUND",yt="QUERY",Bn="QUOTE",js="FULLWIDTHMIDDLEDOT",Hn="SEMI",De="SLASH",bt="TILDE",an="UNDERSCORE",Bs="EMOJI",on="SYM";var Hs=Object.freeze({__proto__:null,ALPHANUMERICAL:zs,AMPERSAND:Gt,APOSTROPHE:Kt,ASCIINUMERICAL:Fs,ASTERISK:Yt,AT:Ve,BACKSLASH:Xt,BACKTICK:Jt,CARET:Qt,CLOSEANGLEBRACKET:Ut,CLOSEBRACE:ht,CLOSEBRACKET:Dt,CLOSEPAREN:Ot,COLON:We,COMMA:zn,DOLLAR:Zt,DOT:Re,EMOJI:Bs,EQUALS:en,EXCLAMATION:jn,FULLWIDTHGREATERTHAN:qt,FULLWIDTHLEFTPAREN:Ft,FULLWIDTHLESSTHAN:Wt,FULLWIDTHMIDDLEDOT:js,FULLWIDTHRIGHTPAREN:zt,HYPHEN:Le,LEFTCORNERBRACKET:jt,LEFTWHITECORNERBRACKET:Ht,LOCALHOST:kt,NL:Fn,NUM:Un,OPENANGLEBRACKET:Nt,OPENBRACE:pt,OPENBRACKET:Rt,OPENPAREN:Pt,PERCENT:gt,PIPE:tn,PLUS:nn,POUND:sn,QUERY:yt,QUOTE:Bn,RIGHTCORNERBRACKET:Bt,RIGHTWHITECORNERBRACKET:Vt,SCHEME:It,SEMI:Hn,SLASH:De,SLASH_SCHEME:tt,SYM:on,TILDE:bt,TLD:En,UNDERSCORE:an,UTLD:Tn,UWORD:xn,WORD:Ue,WS:In});const Oe=/[a-z]/,ut=new RegExp("\\p{L}","u"),gn=new RegExp("\\p{Emoji}","u"),Ne=/\d/,yn=/\s/,ps="\r",bn=`
`,ko="ï¸",_o="â€",kn="ï¿¼";let Mt=null,xt=null;function wo(e=[]){const s={};Ee.groups=s;const n=new Ee;Mt==null&&(Mt=hs(fo)),xt==null&&(xt=hs(po)),N(n,"'",Kt),N(n,"{",pt),N(n,"}",ht),N(n,"[",Rt),N(n,"]",Dt),N(n,"(",Pt),N(n,")",Ot),N(n,"<",Nt),N(n,">",Ut),N(n,"ï¼ˆ",Ft),N(n,"ï¼‰",zt),N(n,"ã€Œ",jt),N(n,"ã€",Bt),N(n,"ã€",Ht),N(n,"ã€",Vt),N(n,"ï¼œ",Wt),N(n,"ï¼",qt),N(n,"&",Gt),N(n,"*",Yt),N(n,"@",Ve),N(n,"`",Jt),N(n,"^",Qt),N(n,":",We),N(n,",",zn),N(n,"$",Zt),N(n,".",Re),N(n,"=",en),N(n,"!",jn),N(n,"-",Le),N(n,"%",gt),N(n,"|",tn),N(n,"+",nn),N(n,"#",sn),N(n,"?",yt),N(n,'"',Bn),N(n,"/",De),N(n,";",Hn),N(n,"~",bt),N(n,"_",an),N(n,"\\",Xt),N(n,"ãƒ»",js);const o=ge(n,Ne,Un,{[Cn]:!0});ge(o,Ne,o);const i=ge(o,Oe,Fs,{[ft]:!0}),a=ge(o,ut,zs,{[dt]:!0}),l=ge(n,Oe,Ue,{[$n]:!0});ge(l,Ne,i),ge(l,Oe,l),ge(i,Ne,i),ge(i,Oe,i);const r=ge(n,ut,xn,{[Sn]:!0});ge(r,Oe),ge(r,Ne,a),ge(r,ut,r),ge(a,Ne,a),ge(a,Oe),ge(a,ut,a);const u=N(n,bn,Fn,{[hn]:!0}),g=N(n,ps,In,{[hn]:!0}),f=ge(n,yn,In,{[hn]:!0});N(n,kn,f),N(g,bn,u),N(g,kn,f),ge(g,yn,f),N(f,ps),N(f,bn),ge(f,yn,f),N(f,kn,f);const p=ge(n,gn,Bs,{[Us]:!0});N(p,"#"),ge(p,gn,p),N(p,ko,p);const v=N(p,_o);N(v,"#"),ge(v,gn,p);const c=[[Oe,l],[Ne,i]],m=[[Oe,null],[ut,r],[Ne,a]];for(let b=0;b<Mt.length;b++)He(n,Mt[b],En,Ue,c);for(let b=0;b<xt.length;b++)He(n,xt[b],Tn,xn,m);Ye(En,{tld:!0,ascii:!0},s),Ye(Tn,{utld:!0,alpha:!0},s),He(n,"file",It,Ue,c),He(n,"mailto",It,Ue,c),He(n,"http",tt,Ue,c),He(n,"https",tt,Ue,c),He(n,"ftp",tt,Ue,c),He(n,"ftps",tt,Ue,c),Ye(It,{scheme:!0,ascii:!0},s),Ye(tt,{slashscheme:!0,ascii:!0},s),e=e.sort((b,L)=>b[0]>L[0]?1:-1);for(let b=0;b<e.length;b++){const L=e[b][0],I=e[b][1]?{[ho]:!0}:{[go]:!0};L.indexOf("-")>=0?I[Mn]=!0:Oe.test(L)?Ne.test(L)?I[ft]=!0:I[$n]=!0:I[Cn]=!0,fs(n,L,L,I)}return fs(n,"localhost",kt,{ascii:!0}),n.jd=new Ee(on),{start:n,tokens:Object.assign({groups:s},Hs)}}function Vs(e,s){const n=Co(s.replace(/[A-Z]/g,r=>r.toLowerCase())),o=n.length,i=[];let a=0,l=0;for(;l<o;){let r=e,u=null,g=0,f=null,p=-1,v=-1;for(;l<o&&(u=r.go(n[l]));)r=u,r.accepts()?(p=0,v=0,f=r):p>=0&&(p+=n[l].length,v++),g+=n[l].length,a+=n[l].length,l++;a-=p,l-=v,g-=p,i.push({t:f.t,v:s.slice(a-g,a),s:a-g,e:a})}return i}function Co(e){const s=[],n=e.length;let o=0;for(;o<n;){let i=e.charCodeAt(o),a,l=i<55296||i>56319||o+1===n||(a=e.charCodeAt(o+1))<56320||a>57343?e[o]:e.slice(o,o+2);s.push(l),o+=l.length}return s}function He(e,s,n,o,i){let a;const l=s.length;for(let r=0;r<l-1;r++){const u=s[r];e.j[u]?a=e.j[u]:(a=new Ee(o),a.jr=i.slice(),e.j[u]=a),e=a}return a=new Ee(n),a.jr=i.slice(),e.j[s[l-1]]=a,a}function hs(e){const s=[],n=[];let o=0,i="0123456789";for(;o<e.length;){let a=0;for(;i.indexOf(e[o+a])>=0;)a++;if(a>0){s.push(n.join(""));for(let l=parseInt(e.substring(o,o+a),10);l>0;l--)n.pop();o+=a}else n.push(e[o]),o++}return s}const _t={defaultProtocol:"http",events:null,format:gs,formatHref:gs,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Vn(e,s=null){let n=Object.assign({},_t);e&&(n=Object.assign(n,e instanceof Vn?e.o:e));const o=n.ignoreTags,i=[];for(let a=0;a<o.length;a++)i.push(o[a].toUpperCase());this.o=n,s&&(this.defaultRender=s),this.ignoreTags=i}Vn.prototype={o:_t,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,s,n){const o=s!=null;let i=this.o[e];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:_t[e],typeof i=="function"&&o&&(i=i(s,n))):typeof i=="function"&&o&&(i=i(s,n.t,n)),i)},getObj(e,s,n){let o=this.o[e];return typeof o=="function"&&s!=null&&(o=o(s,n.t,n)),o},render(e){const s=e.render(this);return(this.get("render",null,e)||this.defaultRender)(s,e.t,e)}};function gs(e){return e}function Ws(e,s){this.t="token",this.v=e,this.tk=s}Ws.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const s=this.toString(),n=e.get("truncate",s,this),o=e.get("format",s,this);return n&&o.length>n?o.substring(0,n)+"â€¦":o},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=_t.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const s=this,n=this.toHref(e.get("defaultProtocol")),o=e.get("formatHref",n,this),i=e.get("tagName",n,s),a=this.toFormattedString(e),l={},r=e.get("className",n,s),u=e.get("target",n,s),g=e.get("rel",n,s),f=e.getObj("attributes",n,s),p=e.getObj("events",n,s);return l.href=o,r&&(l.class=r),u&&(l.target=u),g&&(l.rel=g),f&&Object.assign(l,f),{tagName:i,attributes:l,content:a,eventListeners:p}}};function rn(e,s){class n extends Ws{constructor(i,a){super(i,a),this.t=e}}for(const o in s)n.prototype[o]=s[o];return n.t=e,n}const ys=rn("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),bs=rn("text"),$o=rn("nl"),Et=rn("url",{isLink:!0,toHref(e=_t.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==kt&&e[1].t===We}}),Ie=e=>new Ee(e);function So({groups:e}){const s=e.domain.concat([Gt,Yt,Ve,Xt,Jt,Qt,Zt,en,Le,Un,gt,tn,nn,sn,De,on,bt,an]),n=[Kt,We,zn,Re,jn,gt,yt,Bn,Hn,Nt,Ut,pt,ht,Dt,Rt,Pt,Ot,Ft,zt,jt,Bt,Ht,Vt,Wt,qt],o=[Gt,Kt,Yt,Xt,Jt,Qt,Zt,en,Le,pt,ht,gt,tn,nn,sn,yt,De,on,bt,an],i=Ie(),a=N(i,bt);Q(a,o,a),Q(a,e.domain,a);const l=Ie(),r=Ie(),u=Ie();Q(i,e.domain,l),Q(i,e.scheme,r),Q(i,e.slashscheme,u),Q(l,o,a),Q(l,e.domain,l);const g=N(l,Ve);N(a,Ve,g),N(r,Ve,g),N(u,Ve,g);const f=N(a,Re);Q(f,o,a),Q(f,e.domain,a);const p=Ie();Q(g,e.domain,p),Q(p,e.domain,p);const v=N(p,Re);Q(v,e.domain,p);const c=Ie(ys);Q(v,e.tld,c),Q(v,e.utld,c),N(g,kt,c);const m=N(p,Le);N(m,Le,m),Q(m,e.domain,p),Q(c,e.domain,p),N(c,Re,v),N(c,Le,m);const b=N(c,We);Q(b,e.numeric,ys);const L=N(l,Le),C=N(l,Re);N(L,Le,L),Q(L,e.domain,l),Q(C,o,a),Q(C,e.domain,l);const I=Ie(Et);Q(C,e.tld,I),Q(C,e.utld,I),Q(I,e.domain,l),Q(I,o,a),N(I,Re,C),N(I,Le,L),N(I,Ve,g);const W=N(I,We),U=Ie(Et);Q(W,e.numeric,U);const T=Ie(Et),F=Ie();Q(T,s,T),Q(T,n,F),Q(F,s,T),Q(F,n,F),N(I,De,T),N(U,De,T);const ae=N(r,We),pe=N(u,We),de=N(pe,De),ie=N(de,De);Q(r,e.domain,l),N(r,Re,C),N(r,Le,L),Q(u,e.domain,l),N(u,Re,C),N(u,Le,L),Q(ae,e.domain,T),N(ae,De,T),N(ae,yt,T),Q(ie,e.domain,T),Q(ie,s,T),N(ie,De,T);const k=[[pt,ht],[Rt,Dt],[Pt,Ot],[Nt,Ut],[Ft,zt],[jt,Bt],[Ht,Vt],[Wt,qt]];for(let A=0;A<k.length;A++){const[$,x]=k[A],E=N(T,$);N(F,$,E),N(E,x,T);const X=Ie(Et);Q(E,s,X);const ce=Ie();Q(E,n),Q(X,s,X),Q(X,n,ce),Q(ce,s,X),Q(ce,n,ce),N(X,x,T),N(ce,x,T)}return N(i,kt,I),N(i,Fn,$o),{start:i,tokens:Hs}}function Mo(e,s,n){let o=n.length,i=0,a=[],l=[];for(;i<o;){let r=e,u=null,g=null,f=0,p=null,v=-1;for(;i<o&&!(u=r.go(n[i].t));)l.push(n[i++]);for(;i<o&&(g=u||r.go(n[i].t));)u=null,r=g,r.accepts()?(v=0,p=r):v>=0&&v++,i++,f++;if(v<0)i-=f,i<o&&(l.push(n[i]),i++);else{l.length>0&&(a.push(_n(bs,s,l)),l=[]),i-=v,f-=v;const c=p.t,m=n.slice(i-f,i);a.push(_n(c,s,m))}}return l.length>0&&a.push(_n(bs,s,l)),a}function _n(e,s,n){const o=n[0].s,i=n[n.length-1].e,a=s.slice(o,i);return new e(a,n)}const _e={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function xo(){_e.scanner=wo(_e.customSchemes);for(let e=0;e<_e.tokenQueue.length;e++)_e.tokenQueue[e][1]({scanner:_e.scanner});_e.parser=So(_e.scanner.tokens);for(let e=0;e<_e.pluginQueue.length;e++)_e.pluginQueue[e][1]({scanner:_e.scanner,parser:_e.parser});return _e.initialized=!0,_e}function qs(e){return _e.initialized||xo(),Mo(_e.parser.start,e,Vs(_e.scanner.start,e))}qs.scan=Vs;function Gs(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Eo(e){return e.replace(/"/g,"&quot;")}function To(e){const s=[];for(const n in e){let o=e[n]+"";s.push(`${n}="${Eo(o)}"`)}return s.join(" ")}function Io({tagName:e,attributes:s,content:n}){return`<${e} ${To(s)}>${Gs(n)}</${e}>`}function Ks(e,s={}){s=new Vn(s,Io);const n=qs(e),o=[];for(let i=0;i<n.length;i++){const a=n[i];a.t==="nl"&&s.get("nl2br")?o.push(`<br>
`):!a.isLink||!s.check(a)?o.push(Gs(a.toString())):o.push(s.render(a))}return o.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(s){return Ks(this,s)}});const Lo={},Ao={class:"admin-badge",title:"Admin"};function Ro(e,s){return d(),h("span",Ao,"âœ“")}const Wn=me(Lo,[["render",Ro]]),Do={class:"image-message"},Po=["src","alt"],Oo={key:0,class:"image-message-caption"},No=ne({__name:"ImageMessage",props:{message:{}},setup(e){const s=e,n=j(()=>{const l=s.message.content?.trim();return!l||l===s.message.attachment_filename?"":l}),o=y(!1);function i(){o.value=!0}function a(){s.message.attachment_url&&window.open(s.message.attachment_url,"_blank","noopener,noreferrer")}return(l,r)=>(d(),h("div",Do,[t("img",{class:"image-message-thumb",src:e.message.attachment_url,alt:e.message.attachment_filename||"image",loading:"lazy",onClick:a,onError:i},null,40,Po),n.value?(d(),h("div",Oo,M(n.value),1)):O("",!0)]))}}),Uo=me(No,[["__scopeId","data-v-71beba71"]]),Fo={class:"file-message"},zo=["href","download"],jo={class:"file-message-info"},Bo={class:"file-message-name"},Ho={key:0,class:"file-message-caption"},Vo=ne({__name:"FileMessage",props:{message:{}},setup(e){const s=e,n=j(()=>s.message.attachment_filename||"File"),o=j(()=>{const i=s.message.content?.trim();return!i||i===s.message.attachment_filename?"":i});return(i,a)=>(d(),h("div",Fo,[t("a",{class:"file-message-card",href:e.message.attachment_url,target:"_blank",rel:"noopener noreferrer",download:e.message.attachment_filename},[a[0]||(a[0]=t("div",{class:"file-message-icon"},"ğŸ“„",-1)),t("div",jo,[t("div",Bo,M(n.value),1),o.value?(d(),h("div",Ho,M(o.value),1)):O("",!0)])],8,zo)]))}}),Wo=me(Vo,[["__scopeId","data-v-6ead7a7d"]]);function qo(e){const{delay:s=500,scrollThreshold:n=5,onLongPress:o,onCancel:i}=e,a=y(!1);let l=null,r=0,u=0,g=!1;function f(){l&&(clearTimeout(l),l=null)}function p(b){r=b.clientX,u=b.clientY,g=!1,a.value=!0,f(),l=setTimeout(()=>{g=!0,o(b)},s)}function v(b){if(!l)return;const L=b.clientX-r,C=b.clientY-u;(Math.abs(L)>n||Math.abs(C)>n)&&m()}function c(){f(),a.value=!1}function m(){f(),a.value=!1,g||i?.()}return{isPressed:a,onPointerDown:p,onPointerUp:c,onPointerMove:v}}const Go=["data-message-id"],Ko={key:0,class:"selection-checkbox"},Yo=["checked"],Xo={key:1,class:"msg-sender-name"},Jo={class:"msg-content-wrap"},Qo={key:0,class:"msg-bubble sticker-bubble"},Zo=["src","alt"],el={class:"msg-time"},tl={key:0,class:"msg-edited-label"},nl={key:1,class:"msg-bubble"},sl={key:0,class:"msg-forwarded-label"},al={class:"msg-reply-quote-name"},il={class:"msg-reply-quote-text"},ol={class:"voice-player"},ll={class:"voice-dur"},rl={class:"msg-time"},cl={key:0,class:"msg-edited-label"},ul={key:2,class:"msg-bubble"},dl={key:0,class:"msg-forwarded-label"},vl={class:"msg-reply-quote-name"},ml={class:"msg-reply-quote-text"},fl={class:"msg-time"},pl={key:0,class:"msg-edited-label"},hl={key:3,class:"msg-bubble"},gl={key:0,class:"msg-forwarded-label"},yl={class:"msg-reply-quote-name"},bl={class:"msg-reply-quote-text"},kl=["innerHTML"],_l={class:"msg-time"},wl={key:0,class:"msg-edited-label"},Cl={key:4,class:"reaction-chips"},$l=["onClick"],Sl={class:"reaction-emoji"},Ml={class:"reaction-count"},xl=ne({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:s}){const n=e,o=s,i=Je(),a=Me(),l=Xe(),r=j(()=>i.isSelected(n.message.id)),u=j(()=>l.deletingMessages.has(n.message.id)),g=nt("lastSentMessageId",y(null)),f=j(()=>n.isMine&&n.message.id===g.value),{onPointerDown:p,onPointerUp:v,onPointerMove:c}=qo({delay:500,onLongPress(H){L(H.clientX,H.clientY)}}),m={onPointerdown:p,onPointerup:v,onPointermove:c};function b(H){if(i.selectionMode){i.toggleMessage(n.message.id);return}L(H.clientX,H.clientY)}function L(H,K){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:a.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:H,y:K}}))}function C(){i.selectionMode&&i.toggleMessage(n.message.id)}const I=Ae(),W=wt(),U=j(()=>{if(!W.readReceiptsEnabled)return null;const H=a.activeChat;if(!H)return null;const K=H.id;if(H.type==="direct"&&H.other_user_id===I.user?.id)return{text:"âœ“âœ“",cls:"read"};if(H.type==="direct")return l.isMessageRead(K,n.message.id,H.other_user_id)?{text:"âœ“âœ“",cls:"read"}:{text:"âœ“",cls:"sent"};const ue=l.getReadCount(K,n.message.id);return ue>0?{text:`âœ“âœ“ ${ue}`,cls:"read"}:{text:"âœ“",cls:"sent"}}),T=j(()=>{if(!n.message.forwarded_from_chat_id)return null;const H=n.message.forwarded_from_user_id;if(H&&H===I.user?.id)return null;const K=n.message.forwarded_from_display_name;return K?`Forwarded from ${K}`:"Forwarded"}),F=nt("stickers",y([])),ae=j(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const H=F.value.find(K=>K.id===n.message.sticker_id);if(H)return H.url}return""}),pe=j(()=>n.message.attachment_url||""),de=y(!1),ie=y(0),k=y(0),A=y(n.message.duration_seconds||0);let $=null,x=null;function E(){return $||($=new Audio(pe.value),$.addEventListener("loadedmetadata",()=>{$&&isFinite($.duration)&&(A.value=$.duration)}),$.addEventListener("ended",()=>{de.value=!1,ie.value=0,k.value=0,ce()})),$}function X(){if($&&de.value){k.value=$.currentTime;const H=$.duration;ie.value=H&&isFinite(H)?$.currentTime/H*100:0,x=requestAnimationFrame(X)}}function ce(){x!==null&&(cancelAnimationFrame(x),x=null)}function S(){const H=E();de.value?(H.pause(),de.value=!1,ce()):(H.play(),de.value=!0,x=requestAnimationFrame(X))}function R(H){const K=E(),xe=H.currentTarget.getBoundingClientRect(),$t=Math.max(0,Math.min(1,(H.clientX-xe.left)/xe.width)),it=K.duration;it&&isFinite(it)&&(K.currentTime=$t*it,k.value=K.currentTime,ie.value=$t*100)}const q=j(()=>{const H=A.value;return de.value||k.value>0?V(Math.floor(k.value))+" / "+V(Math.floor(H)):V(Math.floor(H))});Pe(pe,()=>{$&&($.pause(),de.value=!1,ce(),$=null,ie.value=0,k.value=0)}),ze(()=>{$&&($.pause(),$=null),ce()});const B=j(()=>(n.message.attachment_mime_type||"").startsWith("image/")),ee=j(()=>{const H=n.message.reply_to_type;if(H==="sticker")return"ğŸ¨ Sticker";if(H==="voice")return"ğŸ¤ Voice message";if(H==="file")return"ğŸ“ File";const K=n.message.reply_to_content||"";return K.length>80?K.slice(0,80)+"...":K}),oe=j(()=>Ks(n.message.content||"",{defaultProtocol:"https",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(K,ue,xe)=>ue||`<span class="mention" data-u="${xe}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${xe}'}))">@${xe}</span>`));function G(H){if(!H)return"";const K=new Date(H.endsWith("Z")?H:H+"Z"),ue=new Date;return K.toDateString()===ue.toDateString()?K.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):K.toLocaleDateString([],{month:"short",day:"numeric"})}function V(H){const K=Math.floor(H/60),ue=H%60;return`${K}:${String(ue).padStart(2,"0")}`}function se(H){const K=H.target.getBoundingClientRect();o("openEmojiPicker",n.message.id,K.left,K.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(H=>{o("mentionClick",H.detail)})),(H,K)=>(d(),h("div",ba({class:["msg-row",[e.isMine?"mine":"theirs",{selected:r.value,"msg-deleting":u.value,"msg-new":f.value}]],"data-message-id":e.message.id,onContextmenu:le(b,["prevent"])},m,{onClick:C}),[_(i).selectionMode?(d(),h("div",Ko,[t("input",{type:"checkbox",checked:r.value,tabindex:"-1"},null,8,Yo)])):O("",!0),!e.isMine&&e.message.message_type!=="sticker"?(d(),h("div",Xo,[ke(M(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(d(),Y(Wn,{key:0})):O("",!0)])):O("",!0),t("div",Jo,[e.message.message_type==="sticker"?(d(),h("div",Qo,[t("img",{class:"sticker-img",src:ae.value,alt:e.message.sticker_label||"sticker"},null,8,Zo),t("div",el,[e.message.is_edited?(d(),h("span",tl,"(edited)")):O("",!0),ke(" "+M(G(e.message.created_at)),1),e.isMine&&U.value?(d(),h("span",{key:1,class:ve(["msg-read-check",U.value.cls])},M(U.value.text),3)):O("",!0)])])):e.message.message_type==="voice"?(d(),h("div",nl,[T.value?(d(),h("div",sl,M(T.value),1)):O("",!0),e.message.reply_to_message_id?(d(),h("div",{key:1,class:"msg-reply-quote",onClick:K[0]||(K[0]=le(ue=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[K[3]||(K[3]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",al,M(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",il,M(ee.value),1)])])):O("",!0),t("div",ol,[t("button",{class:"voice-play-btn",onClick:le(S,["stop"])},M(de.value?"â¸":"â–¶"),1),t("div",{class:"voice-track",onClick:le(R,["stop"])},[t("div",{class:"voice-progress",style:at({width:ie.value+"%"})},null,4)]),t("span",ll,M(q.value),1)]),t("div",rl,[e.message.is_edited?(d(),h("span",cl,"(edited)")):O("",!0),ke(" "+M(G(e.message.created_at)),1),e.isMine&&U.value?(d(),h("span",{key:1,class:ve(["msg-read-check",U.value.cls])},M(U.value.text),3)):O("",!0)])])):e.message.message_type==="file"?(d(),h("div",ul,[T.value?(d(),h("div",dl,M(T.value),1)):O("",!0),e.message.reply_to_message_id?(d(),h("div",{key:1,class:"msg-reply-quote",onClick:K[1]||(K[1]=le(ue=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[K[4]||(K[4]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",vl,M(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",ml,M(ee.value),1)])])):O("",!0),B.value?(d(),Y(Uo,{key:2,message:e.message},null,8,["message"])):(d(),Y(Wo,{key:3,message:e.message},null,8,["message"])),t("div",fl,[e.message.is_edited?(d(),h("span",pl,"(edited)")):O("",!0),ke(" "+M(G(e.message.created_at)),1),e.isMine&&U.value?(d(),h("span",{key:1,class:ve(["msg-read-check",U.value.cls])},M(U.value.text),3)):O("",!0)])])):(d(),h("div",hl,[T.value?(d(),h("div",gl,M(T.value),1)):O("",!0),e.message.reply_to_message_id?(d(),h("div",{key:1,class:"msg-reply-quote",onClick:K[2]||(K[2]=le(ue=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[K[5]||(K[5]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",yl,M(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",bl,M(ee.value),1)])])):O("",!0),t("span",{class:"msg-text",innerHTML:oe.value},null,8,kl),t("div",_l,[e.message.is_edited?(d(),h("span",wl,"(edited)")):O("",!0),ke(" "+M(G(e.message.created_at)),1),e.isMine&&U.value?(d(),h("span",{key:1,class:ve(["msg-read-check",U.value.cls])},M(U.value.text),3)):O("",!0)])])),t("button",{class:"reaction-add-btn",onClick:le(se,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(d(),h("div",Cl,[(d(!0),h(re,null,ye(e.message.reactions,ue=>(d(),h("button",{key:ue.emoji,class:ve(["reaction-chip",{"reaction-mine":ue.me}]),onClick:le(xe=>o("toggleReaction",e.message.id,ue.emoji),["stop"])},[t("span",Sl,M(ue.emoji),1),t("span",Ml,M(ue.count),1)],10,$l))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:le(se,["stop"])},"+")])):O("",!0)])],16,Go))}}),El={class:"composer-wrapper"},Tl={key:0,class:"reply-preview"},Il={class:"reply-preview-content"},Ll={class:"reply-preview-sender"},Al={class:"reply-preview-text"},Rl={key:1,class:"reply-preview edit-preview"},Dl={class:"reply-preview-content"},Pl={class:"reply-preview-text"},Ol={class:"composer"},Nl=["onKeydown"],Ul=ne({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","toggleEmojiPanel","openAttachmentMenu","startRecording","typing","editMessage"],setup(e,{expose:s,emit:n}){const o=e,i=n,a=y(""),l=y(null),r=y(null),u=y(null);let g=0;const f=j(()=>a.value.trim().length>0);function p(){const T=a.value.trim();T&&(u.value?(i("editMessage",u.value.messageId,T),u.value=null):r.value?(i("send",T,{...r.value}),r.value=null):i("send",T),a.value="",U())}function v(T){const F=l.value;if(!F){a.value+=T;return}const ae=F.selectionStart??a.value.length,pe=F.selectionEnd??a.value.length;a.value=a.value.slice(0,ae)+T+a.value.slice(pe),Se(()=>{const de=ae+T.length;F.selectionStart=de,F.selectionEnd=de,F.focus(),U()})}function c(){r.value=null,l.value?.focus()}function m(){u.value=null,a.value="",U(),l.value?.focus()}function b(){r.value?c():u.value&&m()}function L(T){const F=T.detail;F&&(u.value=null,r.value={messageId:F.messageId,senderName:F.senderName||"Unknown",snippet:(F.text||"").slice(0,100)},Se(()=>l.value?.focus()))}function C(T){const F=T.detail;F&&(r.value=null,u.value={messageId:F.messageId,snippet:(F.text||"").slice(0,100),fullText:F.text||""},a.value=u.value.fullText,Se(()=>{U(),l.value?.focus()}))}function I(T){T.preventDefault(),T.stopPropagation();const F=l.value;F&&F.selectionStart!==F.selectionEnd&&window.dispatchEvent(new CustomEvent("show-text-format-menu",{detail:{x:T.clientX,y:T.clientY,target:F}}))}function W(){U();const T=Date.now();T-g>2e3&&a.value.trim().length>0&&(g=T,i("typing"))}function U(){const T=l.value;T&&(T.style.height="auto",T.style.height=Math.min(T.scrollHeight,120)+"px")}return Ce(()=>{l.value?.focus(),window.addEventListener("reply-to-message",L),window.addEventListener("edit-message",C)}),ze(()=>{window.removeEventListener("reply-to-message",L),window.removeEventListener("edit-message",C)}),Pe(()=>o.replyTo,T=>{T&&l.value?.focus()}),s({focus:()=>l.value?.focus(),insertText:v}),(T,F)=>(d(),h("div",El,[r.value?(d(),h("div",Tl,[F[4]||(F[4]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",Il,[t("span",Ll,M(r.value.senderName),1),t("span",Al,M(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:c},"âœ•")])):O("",!0),u.value?(d(),h("div",Rl,[F[6]||(F[6]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",Dl,[F[5]||(F[5]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",Pl,M(u.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:m},"âœ•")])):O("",!0),t("div",Ol,[t("button",{class:"icon-btn composer-btn","aria-label":"Attach file",title:"Attach file",onClick:F[0]||(F[0]=ae=>i("openAttachmentMenu"))},[z(_($i),{size:22})]),fe(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":F[1]||(F[1]=ae=>a.value=ae),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[Lt(le(p,["exact","prevent"]),["enter"]),Lt(b,["escape"])],onInput:W,onContextmenu:I},null,40,Nl),[[be,a.value]]),t("button",{class:"icon-btn composer-btn","aria-label":"Emoji",title:"Emoji",onClick:F[2]||(F[2]=ae=>i("toggleEmojiPanel"))},[z(_(Ii),{size:22})]),f.value?(d(),h("button",{key:1,class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:p},[z(_(xi),{size:22})])):(d(),h("button",{key:0,class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:F[3]||(F[3]=ae=>i("startRecording"))},[z(_(Ps),{size:22})]))])]))}}),Fl=me(Ul,[["__scopeId","data-v-f741d27a"]]),zl={class:"sticker-grid"},jl=["title","onClick"],Bl=["src","alt"],Hl={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Vl=ne({__name:"StickerPicker",emits:["select"],setup(e,{emit:s}){const n=s,o=nt("stickers",y([])),i=j(()=>o.value);return(a,l)=>(d(),h("div",zl,[(d(!0),h(re,null,ye(i.value,r=>(d(),h("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:u=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,Bl)],8,jl))),128)),i.value.length===0?(d(),h("div",Hl," No stickers available ")):O("",!0)]))}}),Wl={},ql={class:"msgs-loading"};function Gl(e,s){return d(),h("div",ql,"Loading...")}const ks=me(Wl,[["render",Gl]]),Kl=["onClick"],Yl=ne({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:s}){const n=s,o=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(i,a)=>e.visible?(d(),h("div",{key:0,class:"emoji-picker",style:at({left:e.x+"px",top:e.y+"px"}),onClick:a[0]||(a[0]=le(()=>{},["stop"]))},[(d(),h(re,null,ye(o,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},M(l),9,Kl)),64))],4)):O("",!0)}}),Xl=ne({__name:"MessageContextMenu",setup(e){const{showToast:s}=Te(),n=Ae(),o=Xe(),i=Je(),a=y(!1),l=y(0),r=y(0),u=y(null),g=y(null),f=y(""),p=y(""),v=y(""),c=y(null),m=y(!1),b=j(()=>!c.value||!n.user?!1:c.value===n.user.id),L=j(()=>!g.value||!u.value?null:`${window.location.origin}/c/${g.value}/${u.value}`),C=j(()=>!g.value||!u.value?!1:o.pinnedByChat[g.value]?.message?.id===u.value);function I(x){m.value=!!x.detail.areaOnly,u.value=x.detail.messageId??null,g.value=x.detail.chatId,f.value=x.detail.text||"",p.value=x.detail.messageType||"text",v.value=x.detail.senderName||"",c.value=x.detail.senderId??null,l.value=x.detail.x,r.value=x.detail.y,a.value=!0,requestAnimationFrame(()=>{const E=document.querySelector(".msg-context-menu");if(!E)return;const X=E.getBoundingClientRect();X.right>window.innerWidth&&(l.value=window.innerWidth-X.width-8),X.bottom>window.innerHeight&&(r.value=window.innerHeight-X.height-8)})}function W(){a.value&&(a.value=!1,u.value=null,g.value=null,f.value="",p.value="",v.value="",c.value=null,m.value=!1)}Ce(()=>{window.addEventListener("show-message-context-menu",I),document.addEventListener("click",W)}),ze(()=>{window.removeEventListener("show-message-context-menu",I),document.removeEventListener("click",W)});function U(){a.value=!1}function T(){U(),!(!u.value||!g.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:u.value,chatId:g.value,senderName:v.value,text:f.value}}))}function F(){U(),!(!u.value||!g.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:u.value,chatId:g.value,text:f.value}}))}async function ae(){U();try{await navigator.clipboard.writeText(f.value),s("Copied to clipboard")}catch{s("Failed to copy text")}}async function pe(){if(U(),!!L.value)try{await navigator.clipboard.writeText(L.value),s("Link copied")}catch{s("Failed to copy link")}}function de(){U(),!(!u.value||!g.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[u.value],chatId:g.value}}))}function ie(){U(),!(!u.value||!g.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:u.value,chatId:g.value}}))}function k(){if(U(),!u.value||!g.value)return;const x=C.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(x,{detail:{messageId:u.value,chatId:g.value}}))}function A(){U(),g.value&&i.enterSelectionMode(g.value)}function $(){U(),!(!u.value||!g.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:u.value,chatId:g.value}}))}return(x,E)=>(d(),Y(Cs,{to:"body"},[a.value?(d(),h("div",{key:0,class:"msg-context-menu",style:at({left:l.value+"px",top:r.value+"px"}),onClick:E[0]||(E[0]=le(()=>{},["stop"])),onContextmenu:E[1]||(E[1]=le(()=>{},["prevent"]))},[m.value?(d(),h("button",{key:0,class:"ctx-item",onClick:A},"Select Messages")):(d(),h(re,{key:1},[t("button",{class:"ctx-item",onClick:T}," Reply "),b.value&&p.value==="text"?(d(),h("button",{key:0,class:"ctx-item",onClick:F}," Edit ")):O("",!0),t("button",{class:"ctx-item",onClick:k},M(C.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:ae}," Copy text "),L.value?(d(),h("button",{key:1,class:"ctx-item",onClick:pe}," Copy link ")):O("",!0),t("button",{class:"ctx-item",onClick:de}," Forward "),t("button",{class:"ctx-item",onClick:ie}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:$}," Delete ")],64))],36)):O("",!0)]))}}),Jl=me(Xl,[["__scopeId","data-v-e4c122b4"]]),Ql={key:0,class:"selection-bar"},Zl={class:"selection-bar-count"},er={class:"selection-bar-actions"},tr=["disabled"],nr=["disabled"],sr=ne({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:s}){const n=s,o=Je();return(i,a)=>(d(),Y(Ln,{name:"slide-down"},{default:ln(()=>[_(o).selectionMode?(d(),h("div",Ql,[t("button",{class:"selection-bar-btn cancel-btn",onClick:a[0]||(a[0]=l=>_(o).exitSelectionMode())}," Cancel "),t("span",Zl,M(_(o).selectedCount)+" selected",1),t("div",er,[t("button",{class:"selection-bar-btn forward-btn",disabled:_(o).selectedCount===0,onClick:a[1]||(a[1]=l=>n("forward"))}," Forward ("+M(_(o).selectedCount)+") ",9,tr),t("button",{class:"selection-bar-btn delete-btn",disabled:_(o).selectedCount===0,onClick:a[2]||(a[2]=l=>n("delete"))}," Delete ("+M(_(o).selectedCount)+") ",9,nr)])])):O("",!0)]),_:1}))}}),ar=me(sr,[["__scopeId","data-v-9ba988f2"]]),ir=ne({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const n=s;function o(){n("close")}return(i,a)=>(d(),Y(Cs,{to:"body"},[z(Ln,{name:"bottom-sheet"},{default:ln(()=>[e.visible?(d(),h("div",{key:0,class:"bottom-sheet-backdrop",onClick:le(o,["self"])},[t("div",{class:"bottom-sheet",onClick:a[0]||(a[0]=le(()=>{},["stop"]))},[a[1]||(a[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),$s(i.$slots,"default",{},void 0,!0)])])):O("",!0)]),_:3})]))}}),or=me(ir,[["__scopeId","data-v-9712ffdf"]]),lr={class:"modal"},rr={class:"modal-header"},cr={class:"modal-body"},ur={class:"forward-chat-list"},dr={key:0,class:"empty-state-small"},vr=["onClick"],mr={class:"forward-chat-info"},fr={class:"forward-chat-name"},pr={class:"forward-chat-type"},hr={key:0,class:"forward-check"},gr={class:"modal-actions"},yr=["disabled"],br=ne({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:s}){const n=e,o=s,i=Me(),a=Xe(),{showToast:l}=Te(),r=y(""),u=y(null),g=y(!1),f=j(()=>{const b=r.value.toLowerCase().trim(),L=i.sortedChats;return b?L.filter(C=>p(C).toLowerCase().includes(b)):L});function p(b){return b.type==="direct"?b.other_user_id?b.other_display_name||b.other_username||b.title||"Direct Chat":"Saved Messages":b.title||b.name||"Unnamed Chat"}function v(b){if(b.type==="direct")return b.other_avatar_url??void 0}function c(){}async function m(){if(u.value!==null){g.value=!0;try{await a.forwardMessages(u.value,n.fromChatId,n.messageIds),l("Message forwarded!"),o("forwarded",u.value)}catch{l("Failed to forward message")}finally{g.value=!1}}}return(b,L)=>(d(),h("div",{class:"modal-backdrop",onClick:L[2]||(L[2]=le(C=>o("close"),["self"]))},[t("div",lr,[t("div",rr,[L[3]||(L[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:L[0]||(L[0]=C=>o("close"))},"âœ•")]),t("div",cr,[fe(t("input",{"onUpdate:modelValue":L[1]||(L[1]=C=>r.value=C),class:"search-input",type:"search",placeholder:"Search chats...",onInput:c},null,544),[[be,r.value]]),t("div",ur,[f.value.length===0?(d(),h("div",dr,"No chats found.")):O("",!0),(d(!0),h(re,null,ye(f.value,C=>(d(),h("div",{key:C.id,class:ve(["forward-chat-item",{selected:u.value===C.id}]),onClick:I=>u.value=C.id},[z(we,{name:p(C),url:v(C),size:"sm"},null,8,["name","url"]),t("div",mr,[t("div",fr,M(p(C)),1),t("div",pr,M(C.type),1)]),u.value===C.id?(d(),h("span",hr,"âœ“")):O("",!0)],10,vr))),128))]),t("div",gr,[t("button",{class:"btn btn-primary",disabled:u.value===null||g.value,onClick:m},M(g.value?"Forwarding...":"Forward"),9,yr)])])])]))}}),kr=me(br,[["__scopeId","data-v-4e477e89"]]),_r={class:"modal modal-sm"},wr={class:"modal-header"},Cr={class:"modal-body"},$r={class:"delete-confirm-text"},Sr={key:0,class:"delete-checkbox-label"},Mr={class:"modal-actions"},xr=ne({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:s}){const n=s,o=y(!1);function i(){n("confirm",o.value)}return(a,l)=>(d(),h("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=le(r=>n("close"),["self"]))},[t("div",_r,[t("div",wr,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",Cr,[t("p",$r," Are you sure you want to delete "+M(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(d(),h("label",Sr,[fe(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>o.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[ka,o.value]]),l[5]||(l[5]=ke(" Delete for everyone ",-1))])):O("",!0)]),t("div",Mr,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:i},"Delete")])])]))}}),Er=me(xr,[["__scopeId","data-v-388dbae2"]]),Ct=st("channel",()=>{const e=y(null),s=y([]),n=y(!1),o=j(()=>s.value.length),i=j(()=>s.value.filter(p=>p.role==="admin"||p.role==="owner").length),a=j(()=>{const p=Ae();return p.user?s.value.find(c=>c.id===p.user.id)?.role??null:null}),l=j(()=>a.value==="owner"),r=j(()=>a.value==="admin"||a.value==="owner");async function u(p){n.value=!0;try{e.value=await Ms(p)}catch(v){console.error("Failed to load channel detail",v)}finally{n.value=!1}}async function g(p){try{s.value=await Ha(p)}catch(v){console.error("Failed to load channel members",v)}}async function f(p,v){try{e.value=await Va(p,v)}catch(c){throw console.error("Failed to update channel",c),c}}return{detail:e,members:s,loading:n,memberCount:o,adminCount:i,myRole:a,isOwner:l,isAdmin:r,loadDetail:u,loadMembers:g,updateChannel:f}}),Tr=st("invites",()=>{const e=y([]),s=y(!1);async function n(a){s.value=!0;try{e.value=await Ma(a)}catch(l){console.error("Failed to load invites",l)}finally{s.value=!1}}async function o(a){try{const l=await xa(a);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function i(a){const l=[...e.value];e.value=e.value.filter(r=>r.token!==a);try{await Ea(a)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:s,loadInvites:n,createInvite:o,revokeInvite:i}}),Ir={class:"invite-links-view"},Lr={class:"view-header"},Ar={style:{padding:"0 1rem .5rem"}},Rr=["disabled"],Dr={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},Pr={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},Or={key:2,class:"invite-list",style:{padding:"0 1rem"}},Nr={class:"invite-item-info"},Ur={class:"invite-token"},Fr={class:"invite-date"},zr={class:"invite-item-actions"},jr=["onClick"],Br=["onClick"],Hr=ne({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,o=s,i=Tr(),{showToast:a}=Te(),l=y(!1);function r(p){return new Date(p).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function u(p){const v=`${window.location.origin}/join/${p}`;navigator.clipboard&&navigator.clipboard.writeText(v).then(()=>a("Link copied!"))}async function g(){l.value=!0;try{await i.createInvite(n.chatId),a("Invite link created")}catch{a("Failed to create invite")}finally{l.value=!1}}async function f(p){try{await i.revokeInvite(p),a("Invite revoked")}catch{a("Failed to revoke invite")}}return Ce(()=>i.loadInvites(n.chatId)),(p,v)=>(d(),h("div",Ir,[t("div",Lr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:v[0]||(v[0]=c=>o("back"))},[z(_(Fe),{size:20,"stroke-width":2})]),v[1]||(v[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",Ar,[t("button",{class:"btn btn-sm btn-outline",onClick:g,disabled:l.value},M(l.value?"Creating...":"Create Invite Link"),9,Rr)]),_(i).loading?(d(),h("div",Dr," Loading... ")):_(i).invites.length===0?(d(),h("div",Pr," No active invite links ")):(d(),h("div",Or,[(d(!0),h(re,null,ye(_(i).invites,c=>(d(),h("div",{key:c.id,class:"invite-item"},[t("div",Nr,[t("code",Ur,M(c.token),1),t("span",Fr,M(r(c.created_at)),1)]),t("div",zr,[t("button",{class:"icon-btn",title:"Copy link",onClick:m=>u(c.token)},[z(_(Rs),{size:16,"stroke-width":2})],8,jr),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:m=>f(c.token)}," Revoke ",8,Br)])]))),128))]))]))}}),Vr=me(Hr,[["__scopeId","data-v-97b82dd0"]]);async function Wr(e,s){await J.post(`/chats/${e}/avatar`,{file_id:s})}async function qr(e,s){return(await J.post(`/chats/${e}/members/${s}/promote`)).data}async function Gr(e,s){return(await J.post(`/chats/${e}/members/${s}/demote`)).data}const Kr={class:"admins-view"},Yr={class:"view-header"},Xr={class:"search-bar"},Jr={key:0,class:"member-empty"},Qr={key:1,class:"member-list"},Zr=["onClick"],ec={class:"member-info"},tc={class:"member-name"},nc={class:"role-badge"},sc={class:"view-footer"},ac={key:0,class:"member-empty"},ic={key:1,class:"member-list"},oc={class:"member-info"},lc={class:"member-name"},rc=["onClick"],cc={key:2,class:"view-footer"},uc=ne({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,o=s,i=Ct(),a=y(!1),l=y(""),r=j(()=>i.members.filter(v=>v.role==="admin"||v.role==="owner")),u=j(()=>i.members.filter(v=>v.role==="member")),g=j(()=>{const v=l.value.toLowerCase().trim();return v?u.value.filter(c=>c.username.toLowerCase().includes(v)||c.display_name&&c.display_name.toLowerCase().includes(v)):u.value});async function f(v){try{await qr(n.chatId,v);const c=i.members.find(m=>m.id===v);c&&(c.role="admin"),a.value=!1,l.value=""}catch{}}async function p(v){try{await Gr(n.chatId,v);const c=i.members.find(m=>m.id===v);c&&(c.role="member")}catch{}}return(v,c)=>(d(),h("div",Kr,[t("div",Yr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=m=>o("back"))},[z(_(Fe),{size:20,"stroke-width":2})]),c[4]||(c[4]=t("span",{class:"view-title"},"Administrators",-1))]),a.value?(d(),h(re,{key:0},[t("div",Xr,[fe(t("input",{"onUpdate:modelValue":c[1]||(c[1]=m=>l.value=m),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[be,l.value]])]),g.value.length===0?(d(),h("div",Jr,M(l.value?"No members found":"No members to promote"),1)):(d(),h("div",Qr,[(d(!0),h(re,null,ye(g.value,m=>(d(),h("div",{key:m.id,class:"member-item member-item--selectable",onClick:b=>f(m.id)},[z(we,{name:m.display_name||m.username,url:m.avatar_url,size:"md"},null,8,["name","url"]),t("div",ec,[t("span",tc,M(m.display_name||m.username),1),t("span",nc,M(m.role),1)])],8,Zr))),128))])),t("div",sc,[t("button",{class:"btn btn--secondary",onClick:c[2]||(c[2]=m=>a.value=!1)},"Cancel")])],64)):(d(),h(re,{key:1},[r.value.length===0?(d(),h("div",ac," No administrators found ")):(d(),h("div",ic,[(d(!0),h(re,null,ye(r.value,m=>(d(),h("div",{key:m.id,class:"member-item"},[z(we,{name:m.display_name||m.username,url:m.avatar_url,size:"md"},null,8,["name","url"]),t("div",oc,[t("span",lc,M(m.display_name||m.username),1),t("span",{class:ve(["role-badge",`role-badge--${m.role}`])},M(m.role),3)]),_(i).isOwner&&m.role==="admin"?(d(),h("button",{key:0,class:"btn btn--small btn--danger",onClick:b=>p(m.id)}," Demote ",8,rc)):O("",!0)]))),128))])),_(i).isOwner?(d(),h("div",cc,[t("button",{class:"btn btn--primary",onClick:c[3]||(c[3]=m=>a.value=!0)},"Add Admin")])):O("",!0)],64))]))}}),dc=me(uc,[["__scopeId","data-v-2bd7c861"]]),vc={class:"subscribers-view"},mc={class:"view-header"},fc={class:"search-bar"},pc={key:0,class:"member-empty"},hc={key:1,class:"member-list"},gc={class:"member-info"},yc={class:"member-name"},bc=ne({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=s,o=Ct(),i=y(""),a=j(()=>{const l=i.value.toLowerCase().trim();return l?o.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):o.members});return(l,r)=>(d(),h("div",vc,[t("div",mc,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=u=>n("back"))},[z(_(Fe),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",fc,[fe(t("input",{"onUpdate:modelValue":r[1]||(r[1]=u=>i.value=u),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[be,i.value]])]),a.value.length===0?(d(),h("div",pc,M(i.value?"No members found":"No subscribers"),1)):(d(),h("div",hc,[(d(!0),h(re,null,ye(a.value,u=>(d(),h("div",{key:u.id,class:"member-item"},[z(we,{name:u.display_name||u.username,url:u.avatar_url,size:"md"},null,8,["name","url"]),t("div",gc,[t("span",yc,M(u.display_name||u.username),1),t("span",{class:ve(["role-badge",`role-badge--${u.role}`])},M(u.role),3)])]))),128))]))]))}}),kc=me(bc,[["__scopeId","data-v-f99a8a5f"]]),_c={class:"modal profile-modal"},wc={class:"profile-modal-body profile-modal-body--scrollable"},Cc={class:"profile-avatar-section profile-avatar-upload-section"},$c={class:"profile-avatar-overlay"},Sc={class:"profile-info-list"},Mc={class:"form-group"},xc={class:"form-label"},Ec=["placeholder"],Tc={class:"form-group"},Ic=["placeholder"],Lc={key:0,class:"form-group"},Ac={class:"form-label"},Rc={class:"type-selector"},Dc={class:"type-option"},Pc={class:"type-option"},Oc={class:"profile-edit-actions"},Nc=["disabled"],Uc=ne({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:s}){const n=e,o=s,i=Ct(),{showToast:a}=Te(),l=y(""),r=y(""),u=y(void 0),g=y("public"),f=y(!1),p=y(null),v=j(()=>i.detail?.type==="group"),c=j(()=>v.value?"Group":"Channel");Ce(()=>{i.detail&&(l.value=i.detail.title||"",r.value=i.detail.description||"",u.value=i.detail.avatar_url??void 0,g.value=i.detail.public_name?"public":"private")});async function m(){const L=p.value?.files?.[0];if(L){try{const C=await At(L);await Wr(n.chatId,C.id),u.value=URL.createObjectURL(L),a("Avatar updated!")}catch{a("Avatar upload failed")}p.value&&(p.value.value="")}}async function b(){if(!l.value.trim()){a(`${c.value} name is required`);return}f.value=!0;try{await i.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),a(`${c.value} updated!`),o("saved"),o("close")}catch{a(`Failed to update ${c.value.toLowerCase()}`)}finally{f.value=!1}}return(L,C)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:C[7]||(C[7]=le(I=>o("close"),["self"]))},[t("div",_c,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:C[0]||(C[0]=I=>o("close"))},[z(_(qe),{size:20,"stroke-width":2})]),t("div",wc,[t("div",Cc,[t("div",{class:"profile-avatar-upload-wrap",onClick:C[1]||(C[1]=I=>p.value?.click())},[z(we,{name:l.value||c.value,url:u.value,size:"xxl"},null,8,["name","url"]),t("div",$c,[z(_(Ls),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:p,type:"file",accept:"image/*",class:"hidden",onChange:m},null,544)]),t("div",Sc,[t("div",Mc,[t("label",xc,M(c.value)+" name",1),fe(t("input",{"onUpdate:modelValue":C[2]||(C[2]=I=>l.value=I),class:"form-input",type:"text",maxlength:"128",placeholder:`${c.value} name`},null,8,Ec),[[be,l.value]])]),t("div",Tc,[C[8]||(C[8]=t("label",{class:"form-label"},"Description",-1)),fe(t("textarea",{"onUpdate:modelValue":C[3]||(C[3]=I=>r.value=I),class:"form-input",maxlength:"500",rows:"4",placeholder:`${c.value} description...`},null,8,Ic),[[be,r.value]])]),_(i).isOwner?(d(),h("div",Lc,[t("label",Ac,M(c.value)+" type",1),t("div",Rc,[t("label",Dc,[fe(t("input",{"onUpdate:modelValue":C[4]||(C[4]=I=>g.value=I),type:"radio",value:"public",name:"chatType"},null,512),[[ss,g.value]]),C[9]||(C[9]=t("span",{class:"type-option-label"},"Public",-1)),C[10]||(C[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",Pc,[fe(t("input",{"onUpdate:modelValue":C[5]||(C[5]=I=>g.value=I),type:"radio",value:"private",name:"chatType"},null,512),[[ss,g.value]]),C[11]||(C[11]=t("span",{class:"type-option-label"},"Private",-1)),C[12]||(C[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):O("",!0)]),t("div",Oc,[t("button",{class:"btn btn-primary",disabled:f.value,onClick:b},M(f.value?"Saving...":"Save"),9,Nc),t("button",{class:"btn btn-ghost",onClick:C[6]||(C[6]=I=>o("close"))},"Cancel")])])])]))}}),Fc=me(Uc,[["__scopeId","data-v-6ec12915"]]),zc={class:"danger-zone"},jc={class:"view-header"},Bc={class:"danger-zone-body"},Hc={class:"modal modal-sm"},Vc={class:"modal-header"},Wc={class:"modal-actions"},qc=["disabled"],Gc=ne({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:s}){const n=e,o=s,i=Me(),a=Ct(),{showToast:l}=Te(),r=y(!1),u=y(!1);async function g(){try{await i.leave(n.chatId),o("left")}catch{l("Failed to leave channel")}}async function f(){u.value=!0;try{await xs(n.chatId),i.chats=i.chats.filter(p=>p.id!==n.chatId),i.activeChatId===n.chatId&&i.setActiveChat(null),r.value=!1,o("deleted")}catch{l("Failed to delete channel")}finally{u.value=!1}}return(p,v)=>(d(),h("div",zc,[t("div",jc,[t("button",{class:"icon-btn","aria-label":"Back",onClick:v[0]||(v[0]=c=>o("back"))},[z(_(Fe),{size:20,"stroke-width":2})]),v[5]||(v[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",Bc,[t("button",{class:"btn btn-danger-outline",onClick:g},[z(_(Dn),{size:18,"stroke-width":1.8}),v[6]||(v[6]=ke(" Leave Channel ",-1))]),_(a).isOwner?(d(),h("button",{key:0,class:"btn btn-danger",onClick:v[1]||(v[1]=c=>r.value=!0)},[z(_(Os),{size:18,"stroke-width":1.8}),v[7]||(v[7]=ke(" Delete Channel ",-1))])):O("",!0)]),r.value?(d(),h("div",{key:0,class:"modal-backdrop",onClick:v[4]||(v[4]=le(c=>r.value=!1,["self"]))},[t("div",Hc,[t("div",Vc,[v[8]||(v[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:v[2]||(v[2]=c=>r.value=!1)},[z(_(qe),{size:20,"stroke-width":2})])]),v[9]||(v[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",Wc,[t("button",{class:"btn btn-ghost",onClick:v[3]||(v[3]=c=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:u.value,onClick:f},M(u.value?"Deleting...":"Delete"),9,qc)])])])):O("",!0)]))}}),Kc=me(Gc,[["__scopeId","data-v-997b5e56"]]),Yc={class:"modal profile-modal"},Xc={class:"profile-modal-body"},Jc={key:5,class:"profile-loading"},Qc={class:"profile-avatar-section"},Zc={class:"profile-name"},eu={class:"profile-status"},tu={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},nu={class:"profile-info-item"},su={class:"profile-info-value"},au={class:"channel-info-menu"},iu={class:"channel-info-menu-count"},ou={class:"channel-info-menu-count"},lu={key:7,class:"profile-loading"},ru=ne({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:s}){const n=e,o=s,i=Ct(),a=y("main"),l=j(()=>Number(n.chatId)),r=j(()=>i.detail?.type==="group");function u(){a.value="main",i.loadDetail(l.value)}return Ce(async()=>{await Promise.all([i.loadDetail(l.value),i.loadMembers(l.value)])}),(g,f)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:f[14]||(f[14]=le(p=>o("close"),["self"]))},[t("div",Yc,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:f[0]||(f[0]=p=>o("close"))},[z(_(qe),{size:20,"stroke-width":2})]),t("div",Xc,[a.value==="invites"?(d(),Y(Vr,{key:0,"chat-id":l.value,onBack:f[1]||(f[1]=p=>a.value="main")},null,8,["chat-id"])):a.value==="admins"?(d(),Y(dc,{key:1,"chat-id":l.value,onBack:f[2]||(f[2]=p=>a.value="main")},null,8,["chat-id"])):a.value==="subscribers"?(d(),Y(kc,{key:2,"chat-id":l.value,onBack:f[3]||(f[3]=p=>a.value="main")},null,8,["chat-id"])):a.value==="edit"?(d(),Y(Fc,{key:3,"chat-id":l.value,onClose:f[4]||(f[4]=p=>a.value="main"),onSaved:u},null,8,["chat-id"])):a.value==="danger"?(d(),Y(Kc,{key:4,"chat-id":l.value,onBack:f[5]||(f[5]=p=>a.value="main"),onLeft:f[6]||(f[6]=p=>o("close")),onDeleted:f[7]||(f[7]=p=>o("close"))},null,8,["chat-id"])):_(i).loading?(d(),h("div",Jc,[...f[15]||(f[15]=[t("p",null,"Loading...",-1)])])):_(i).detail?(d(),h(re,{key:6},[t("div",Qc,[z(we,{name:_(i).detail.title||"Channel",url:_(i).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",Zc,M(_(i).detail.title),1),t("div",eu,M(_(i).memberCount)+" "+M(r.value?_(i).memberCount===1?"member":"members":_(i).memberCount===1?"subscriber":"subscribers"),1),_(i).detail.description?(d(),h("div",tu,[t("div",nu,[f[16]||(f[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",su,M(_(i).detail.description),1)])])):O("",!0),f[19]||(f[19]=t("div",{class:"profile-divider"},null,-1)),t("div",au,[t("button",{class:"channel-info-menu-item",onClick:f[8]||(f[8]=p=>a.value="invites")},[z(_(ki),{size:20,"stroke-width":1.8}),f[17]||(f[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:f[9]||(f[9]=p=>a.value="admins")},[z(_(Ti),{size:20,"stroke-width":1.8}),f[18]||(f[18]=t("span",null,"Administrators",-1)),t("span",iu,M(_(i).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:f[10]||(f[10]=p=>a.value="subscribers")},[z(_(On),{size:20,"stroke-width":1.8}),t("span",null,M(r.value?"Members":"Subscribers"),1),t("span",ou,M(_(i).memberCount),1)]),_(i).isOwner||_(i).isAdmin?(d(),h("button",{key:0,class:"channel-info-menu-item",onClick:f[11]||(f[11]=p=>a.value="edit")},[z(_(Pn),{size:20,"stroke-width":1.8}),t("span",null,M(r.value?"Edit Group":"Edit Channel"),1)])):O("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:f[12]||(f[12]=p=>a.value="danger")},[z(_(Dn),{size:20,"stroke-width":1.8}),t("span",null,M(r.value?"Leave Group":"Leave Channel"),1)]),_(i).isOwner?(d(),h("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:f[13]||(f[13]=p=>a.value="danger")},[z(_(Os),{size:20,"stroke-width":1.8}),t("span",null,M(r.value?"Delete Group":"Delete Channel"),1)])):O("",!0)])],64)):(d(),h("div",lu,[...f[20]||(f[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),cu=me(ru,[["__scopeId","data-v-d1526322"]]),uu={class:"search-bar"},du={class:"search-bar-header"},vu={key:0,class:"search-loading"},mu={key:1,class:"search-empty"},fu=["onClick"],pu={class:"search-result-sender"},hu=["innerHTML"],gu={class:"search-result-date"},yu={key:0,class:"search-loading"},bu=ne({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:s}){const n=e,o=s,i=y(null),a=y(null),l=y(""),r=y([]),u=y(!1),g=y(!1),f=y(!0);let p=null;Ce(()=>{Se(()=>i.value?.focus())}),Pe(l,I=>{if(p&&clearTimeout(p),!I.trim()){r.value=[],g.value=!1,f.value=!0;return}p=setTimeout(()=>v(I.trim()),300)});async function v(I){u.value=!0,g.value=!0,f.value=!0;try{const W=await is(n.chatId,I,{limit:20});r.value=W,W.length<20&&(f.value=!1)}catch{r.value=[]}finally{u.value=!1}}async function c(){if(u.value||!f.value||r.value.length===0)return;const I=Math.min(...r.value.map(W=>W.id));u.value=!0;try{const W=await is(n.chatId,l.value.trim(),{limit:20,before_id:I});W.length<20&&(f.value=!1),r.value=[...r.value,...W]}catch{}finally{u.value=!1}}function m(){if(!a.value)return;const I=a.value;I.scrollTop+I.clientHeight>=I.scrollHeight-40&&c()}function b(I,W){if(!W)return L(I);const U=L(I),T=L(W),F=new RegExp(T.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return U.replace(F,"<mark>$&</mark>")}function L(I){return I.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function C(I){if(!I)return"";const W=new Date(I.endsWith("Z")?I:I+"Z"),U=new Date;return W.toDateString()===U.toDateString()?W.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):W.toLocaleDateString([],{month:"short",day:"numeric"})+" "+W.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return(I,W)=>(d(),h("div",uu,[t("div",du,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:W[0]||(W[0]=U=>o("close"))},"â†"),fe(t("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":W[1]||(W[1]=U=>l.value=U),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:W[2]||(W[2]=Lt(U=>o("close"),["escape"]))},null,544),[[be,l.value]]),l.value?(d(),h("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:W[3]||(W[3]=U=>l.value="")},"âœ•")):O("",!0)]),u.value&&r.value.length===0?(d(),h("div",vu,"Searching...")):g.value&&r.value.length===0&&!u.value?(d(),h("div",mu,"No messages found")):r.value.length>0?(d(),h("div",{key:2,ref_key:"resultsRef",ref:a,class:"search-results",onScroll:m},[(d(!0),h(re,null,ye(r.value,U=>(d(),h("div",{key:U.id,class:"search-result-item",onClick:T=>o("jumpToMessage",U.id)},[t("div",pu,M(U.sender_display_name||U.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:b(U.content||"",l.value)},null,8,hu),t("div",gu,M(C(U.created_at)),1)],8,fu))),128)),u.value?(d(),h("div",yu,"Loading more...")):O("",!0)],544)):O("",!0)]))}}),ku=["accept"],_u=ne({__name:"AttachmentMenu",props:{visible:{type:Boolean}},emits:["file-selected","close"],setup(e,{emit:s}){const n=s,o=y(null),i=y(""),a=y("media");function l(u){a.value=u,i.value=u==="media"?"image/*,video/*":"*/*",setTimeout(()=>{o.value?.click()},0)}function r(u){const g=u.target,f=g.files?.[0];f&&n("file-selected",f,a.value),g.value="",n("close")}return(u,g)=>e.visible?(d(),h("div",{key:0,class:"attachment-menu",onClick:g[2]||(g[2]=le(()=>{},["stop"]))},[t("button",{class:"attachment-option",onClick:g[0]||(g[0]=f=>l("media"))},[z(_(Rn),{size:20}),g[3]||(g[3]=t("span",null,"Photo or Video",-1))]),t("button",{class:"attachment-option",onClick:g[1]||(g[1]=f=>l("document"))},[z(_(An),{size:20}),g[4]||(g[4]=t("span",null,"Document",-1))]),t("input",{ref_key:"fileInput",ref:o,type:"file",hidden:"",accept:i.value,onChange:r},null,40,ku)])):O("",!0)}}),wu=me(_u,[["__scopeId","data-v-a9e355ea"]]),Cu={class:"modal"},$u={class:"modal-header"},Su={class:"modal-title"},Mu={class:"modal-body"},xu={key:0,class:"attachment-error"},Eu={class:"attachment-preview-area"},Tu=["src","alt"],Iu={key:1,class:"attachment-file-icon"},Lu={class:"file-name"},Au={class:"file-size"},Ru={class:"modal-actions"},Du=["disabled"],Pu=50*1024*1024,Ou=ne({__name:"AttachmentPreview",props:{file:{}},emits:["send","cancel"],setup(e,{emit:s}){const n=e,o=s,i=y(""),a=y(""),l=j(()=>n.file.type.startsWith("image/")),r=j(()=>l.value?"Send Image":n.file.type.startsWith("video/")?"Send Video":n.file.type.startsWith("audio/")?"Send Audio":"Send File"),u=j(()=>n.file.size>Pu?"File is too large. Maximum size is 50MB.":null),g=j(()=>{const p=n.file.size;return p<1024?`${p} B`:p<1024*1024?`${(p/1024).toFixed(1)} KB`:`${(p/(1024*1024)).toFixed(1)} MB`});function f(){u.value||o("send",n.file,i.value)}return Ce(()=>{l.value&&(a.value=URL.createObjectURL(n.file))}),ze(()=>{a.value&&URL.revokeObjectURL(a.value)}),(p,v)=>(d(),h("div",{class:"modal-backdrop",onClick:v[3]||(v[3]=le(c=>o("cancel"),["self"]))},[t("div",Cu,[t("div",$u,[t("h2",Su,M(r.value),1),t("button",{class:"icon-btn",onClick:v[0]||(v[0]=c=>o("cancel"))},"âœ•")]),t("div",Mu,[u.value?(d(),h("div",xu,M(u.value),1)):(d(),h(re,{key:1},[t("div",Eu,[l.value?(d(),h("img",{key:0,src:a.value,alt:e.file.name,class:"attachment-thumbnail"},null,8,Tu)):(d(),h("div",Iu,[v[4]||(v[4]=t("span",{class:"file-icon"},"ğŸ“„",-1)),t("span",Lu,M(e.file.name),1),t("span",Au,M(g.value),1)]))]),fe(t("input",{"onUpdate:modelValue":v[1]||(v[1]=c=>i.value=c),class:"caption-input",type:"text",placeholder:"Add a caption...",onKeydown:Lt(f,["enter"])},null,544),[[be,i.value]])],64))]),t("div",Ru,[t("button",{class:"btn btn-ghost",onClick:v[2]||(v[2]=c=>o("cancel"))},"Cancel"),t("button",{class:"btn btn-primary",disabled:!!u.value,onClick:f},"Send",8,Du)])])]))}}),Nu=me(Ou,[["__scopeId","data-v-80e7f118"]]);function Uu(e){const{chatId:s,verticalThreshold:n=8}=e,o=y(!1);let i=0,a=!1,l=!1,r=null;function u(c){const m=c?.closest?.("[data-message-id]");if(!m)return null;const b=m.getAttribute("data-message-id");return b!=null?Number(b):null}function g(c,m){const b=document.elementFromPoint(c,m),L=u(b);if(L!=null)return L;const C=document.querySelectorAll("[data-message-id]");let I=null,W=1/0;for(const U of C){const T=U.getBoundingClientRect(),F=T.top+T.height/2,ae=Math.abs(m-F);ae<W&&(W=ae,I=U)}if(I){const U=I.getAttribute("data-message-id");return U!=null?Number(U):null}return null}function f(c){if(c.button!==0)return;const m=c.target;!m.closest("[data-message-id]")||s()==null||(i=c.clientY,a=!0,l=!1,r=u(m))}function p(c){if(!a)return;if(!l){if(Math.abs(c.clientY-i)<n)return;l=!0;const L=Je(),C=s();if(C==null){a=!1;return}L.selectionMode?r!=null&&L.addMessage(r):L.enterSelectionMode(C,r??void 0),o.value=!0}c.preventDefault();const m=g(c.clientX,c.clientY);m!=null&&Je().addMessage(m)}function v(){a&&(a=!1,l=!1,o.value=!1)}return{isDragSelecting:o,onMouseDown:f,onMouseMove:p,onMouseUp:v}}const Fu={class:"chat-panel"},zu={key:1,class:"chat-view"},ju={key:2,class:"channel-readonly-bar"},Bu={key:0,class:"date-sep"},Hu={key:4,class:"sticker-picker"},Vu={key:8,class:"recording-bar"},Wu={class:"rec-time"},qu=ne({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:s}){const n=_a(()=>wa(()=>import("./EmojiPickerPanel-CJCePGDx.js"),__vite__mapDeps([0,1,2,3,4]))),o=s,i=Ae(),a=Me(),l=Xe(),{showToast:r}=Te(),u=no(),g=nt("stickers",y([])),f=nt("sendTyping",()=>{}),p=nt("pendingScrollMessageId",y(null)),v=y(null),c=y(null),m=y(!1);let b=null;const L=y(!1),C=y(!1),I=y(null),W=y(!1),U=y("member"),T=y(!1),F=y(!1),ae=y(!1),pe=y(null),de=y("media"),ie=y(null);vt("lastSentMessageId",ie);const k=y(!0),A=y(0);let $=null;function x(){if(!v.value)return!0;const D=v.value;return D.scrollTop+D.clientHeight>=D.scrollHeight-100}function E(){$||($=setTimeout(()=>{$=null,k.value=x(),k.value&&(A.value=0)},100))}function X(D){if(!v.value)return null;const w=v.value.querySelectorAll("[data-message-id]");let P=null,te=1/0;for(const he of w){const $e=he.getBoundingClientRect();if(D>=$e.top-15&&D<=$e.bottom+15){const Ke=($e.top+$e.bottom)/2,ns=Math.abs(D-Ke);ns<te&&(te=ns,P=he)}}return P}function ce(D){if(D.target.closest(".msg-row"))return;D.preventDefault();const P=X(D.clientY);if(P){const te=Number(P.dataset.messageId),he=Ge.value.find($e=>$e.id===te);if(he){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:he.id,chatId:a.activeChatId,text:he.content||"",messageType:he.message_type,senderId:he.sender_id,senderName:he.sender_display_name||he.sender_username||"",x:D.clientX,y:D.clientY}}));return}}window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{areaOnly:!0,chatId:a.activeChatId,x:D.clientX,y:D.clientY}}))}function S(){et(),A.value=0,k.value=!0}const R=y(!1),q=y(0),B=y(0),ee=y(null),oe=Je(),{isDragSelecting:G,onMouseDown:V,onMouseMove:se,onMouseUp:H}=Uu({chatId:()=>a.activeChatId}),K=y(!1),ue=y(null),xe=y(""),$t=j(()=>!ue.value||!i.user?!1:Ge.value.find(w=>w.id===ue.value)?.sender_id===i.user.id),it=j(()=>$t.value?Ge.value.find(w=>w.id===ue.value)?.message_type==="text":!1),qn=j(()=>!ue.value||!a.activeChatId?!1:l.pinnedByChat[a.activeChatId]?.message?.id===ue.value),cn=j(()=>!a.activeChatId||l.pinnedDismissed.has(a.activeChatId)?null:l.pinnedByChat[a.activeChatId]||null),ot=y(!1),lt=y([]),rt=y(!1),Qe=y([]),un=y(!1),Ze=y(null),Gn=j(()=>a.activeChat?.type==="channel"&&U.value==="member"),Ge=j(()=>a.activeChatId?l.getMessages(a.activeChatId):[]),Xs=j(()=>{const D=[];let w="";for(const P of Ge.value){const te=Js(P.created_at);te!==w&&(D.push({type:"date",label:te}),w=te),D.push({type:"msg",msg:P})}return D});function Js(D){if(!D)return"";const w=new Date(D.endsWith("Z")?D:D+"Z"),P=new Date;if(w.toDateString()===P.toDateString())return"Today";const te=new Date(P);return te.setDate(P.getDate()-1),w.toDateString()===te.toDateString()?"Yesterday":w.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Qs(){dn(),!(!c.value||!v.value)&&(b=new IntersectionObserver(async D=>{if(!D[0]?.isIntersecting)return;const P=a.activeChatId;if(!P||m.value||l.loadingChat===P)return;m.value=!0;const te=v.value,he=te?te.scrollHeight:0;try{if((await l.loadOlder(P)).length>0&&te){await Se();const Ke=te.scrollHeight;te.scrollTop+=Ke-he}}finally{m.value=!1}},{root:v.value,threshold:0}),b.observe(c.value))}function dn(){b&&(b.disconnect(),b=null)}Pe(()=>a.activeChatId,async D=>{if(L.value=!1,C.value=!1,U.value="member",A.value=0,k.value=!0,dn(),!D)return;await Promise.all([l.loadMessages(D),l.loadPinnedMessage(D),l.loadReadReceipts(D)]),await Se(),et(),await Se(),Qs();const w=a.activeChat;if(w&&(w.type==="channel"||w.type==="group"))try{const P=await Ms(D);U.value=P.my_role||"member"}catch{}});function et(){v.value&&(v.value.scrollTop=v.value.scrollHeight)}function Zs(){a.activeChatId&&f(a.activeChatId)}async function ea(D,w){if(!(!a.activeChatId||!D.trim())){Ze.value=null;try{const P=w?{reply_to_message_id:w.messageId}:void 0,te=await l.sendMessage(a.activeChatId,D.trim(),"text",P);i.user&&(te.sender_id=i.user.id,te.sender_username=i.user.username,te.sender_display_name=i.user.display_name),ie.value=te.id,setTimeout(()=>{ie.value===te.id&&(ie.value=null)},500),await Se(),et(),a.loadChats()}catch{r("Failed to send message")}}}async function ta(D,w){if(!(!a.activeChatId||!w.trim()))try{await l.editMessage(a.activeChatId,D,w.trim())}catch{r("Failed to edit message")}}async function na(D){if(a.activeChatId){L.value=!1;try{const w=await l.sendMessage(a.activeChatId,"","sticker",{sticker_id:D}),P=g.value.find(te=>te.id===D);P&&(w.sticker_url=P.url,w.sticker_label=P.label),ie.value=w.id,setTimeout(()=>{ie.value===w.id&&(ie.value=null)},500),await Se(),et(),a.loadChats()}catch{r("Failed to send sticker")}}}function sa(D,w,P){ee.value=D,q.value=w,B.value=P,R.value=!0}function aa(D){ee.value&&a.activeChatId&&l.toggleReaction(a.activeChatId,ee.value,D),R.value=!1,ee.value=null}function ia(D,w){a.activeChatId&&l.toggleReaction(a.activeChatId,D,w)}function oa(){R.value=!1,ee.value=null}function la(D){if(!D){C.value=!1;return}I.value?.insertText(D)}async function ra(){try{await u.startRecording(),W.value=!0}catch{W.value=!1,r("Microphone access denied")}}async function ca(){try{const D=await u.stopRecording();W.value=!1,await ga(D)}catch{W.value=!1}}function ua(){u.cancelRecording(),W.value=!1}function Kn(D){const{messageIds:w}=D.detail;lt.value=w,ot.value=!0}function Yn(D){const{messageId:w,chatId:P}=D.detail;P&&oe.enterSelectionMode(P,w)}async function Xn(D,w){try{await l.pinMsg(D,w)}catch{r("Failed to pin message")}}async function Jn(D,w){try{await l.unpinMsg(D,w)}catch{r("Failed to unpin message")}}function Qn(D){const{messageId:w,chatId:P}=D.detail;w&&P&&Xn(P,w)}function Zn(D){const{messageId:w,chatId:P}=D.detail;w&&P&&Jn(P,w)}function vn(D){const{messageId:w,chatId:P}=D.detail;if(!w||!P)return;Qe.value=[w];const te=Ge.value.find(he=>he.id===w);un.value=!!(te&&te.sender_id===i.user?.id),rt.value=!0}function da(){lt.value=[...oe.selectedMessageIds],ot.value=!0}function va(){Qe.value=[...oe.selectedMessageIds],un.value=Qe.value.every(D=>{const w=Ge.value.find(P=>P.id===D);return w&&w.sender_id===i.user?.id}),rt.value=!0}function es(){ot.value=!1,lt.value=[],oe.exitSelectionMode()}async function ma(D){rt.value=!1;const w=a.activeChatId;if(w){for(const P of Qe.value)try{await l.deleteMessage(w,P,D)}catch{r("Failed to delete message")}Qe.value=[],oe.exitSelectionMode()}}function Be(D){K.value=!1;const w=ue.value,P=a.activeChatId;if(!(!w||!P))switch(D){case"reply":{const te=Ge.value.find(he=>he.id===w);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:w,senderName:te?.sender_display_name||te?.sender_username||"Unknown",text:te?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:w,chatId:P,text:xe.value}}));break}case"copy":navigator.clipboard.writeText(xe.value).then(()=>r("Copied to clipboard"),()=>r("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${P}/${w}`).then(()=>r("Link copied"),()=>r("Failed to copy link"));break;case"forward":lt.value=[w],ot.value=!0;break;case"select":oe.enterSelectionMode(P,w);break;case"delete":vn(new CustomEvent("",{detail:{messageId:w,chatId:P}}));break;case"pin":Xn(P,w);break;case"unpin":Jn(P,w);break}}async function St(D){if(!v.value)return;const w=a.activeChatId;if(!w)return;let P=v.value.querySelector(`[data-message-id="${D}"]`);if(!P)try{const te=Math.max(0,D-25),he=await Tt(w,{after_id:te,limit:50});if(!he.find(Ke=>Ke.id===D)){r("Message not found");return}l.messagesByChat[w]=he,he.length>0&&(l.lastMsgId[w]=Math.max(...he.map(Ke=>Ke.id))),await Se(),P=v.value?.querySelector(`[data-message-id="${D}"]`)}catch{r("Message not found");return}P&&(P.scrollIntoView({behavior:"smooth",block:"center"}),P.classList.add("highlight-message"),setTimeout(()=>P.classList.remove("highlight-message"),2e3))}function fa(D){F.value=!1,St(D)}function ts(D){if(D.key==="Escape"){if(C.value){C.value=!1,D.stopPropagation();return}if(F.value){F.value=!1,D.stopPropagation();return}T.value&&(T.value=!1,D.stopPropagation())}}Ce(()=>{window.addEventListener("forward-messages",Kn),window.addEventListener("select-message",Yn),window.addEventListener("delete-message",vn),window.addEventListener("pin-message",Qn),window.addEventListener("unpin-message",Zn),document.addEventListener("keydown",ts)}),ze(()=>{dn(),window.removeEventListener("forward-messages",Kn),window.removeEventListener("select-message",Yn),window.removeEventListener("delete-message",vn),window.removeEventListener("pin-message",Qn),window.removeEventListener("unpin-message",Zn),document.removeEventListener("keydown",ts)}),Pe(()=>p.value,async D=>{D&&(await Se(),setTimeout(()=>{St(D),p.value=null},300))}),Pe(()=>a.activeChatId,()=>{oe.exitSelectionMode(),Ze.value=null,F.value=!1});function pa(D,w){de.value=w,pe.value=D,ae.value=!1}async function ha(D,w){if(a.activeChatId){pe.value=null;try{const P=await At(D),te=D.type.startsWith("image/")?"image":"file",he={file_id:P.id};Ze.value&&(he.reply_to_message_id=Ze.value.id);const $e=await l.sendMessage(a.activeChatId,w,te,he);i.user&&($e.sender_id=i.user.id,$e.sender_username=i.user.username,$e.sender_display_name=i.user.display_name),Ze.value=null,ie.value=$e.id,setTimeout(()=>{ie.value===$e.id&&(ie.value=null)},500),await Se(),et(),a.loadChats()}catch{r("Failed to send attachment")}}}async function ga(D){if(a.activeChatId)try{const w=await At(D);await l.sendMessage(a.activeChatId,"","voice",{file_id:w.id,duration_seconds:u.seconds.value}),await l.loadMessages(a.activeChatId),await Se(),et(),a.loadChats()}catch{r("Failed to upload voice message")}}return(D,w)=>(d(),h("main",Fu,[_(a).activeChatId?(d(),h("div",zu,[z(ar,{onForward:da,onDelete:va}),F.value&&_(a).activeChatId?(d(),Y(bu,{key:0,"chat-id":_(a).activeChatId,onClose:w[1]||(w[1]=P=>F.value=!1),onJumpToMessage:fa},null,8,["chat-id"])):O("",!0),fe(z(mo,{onBack:w[2]||(w[2]=P=>o("back")),onOpenUserProfile:w[3]||(w[3]=P=>o("openUserProfile",P)),onOpenChannelInfo:w[4]||(w[4]=P=>T.value=!0),onOpenSearch:w[5]||(w[5]=P=>F.value=!0)},null,512),[[as,!_(oe).selectionMode&&!F.value]]),cn.value&&!_(oe).selectionMode?(d(),Y(oo,{key:1,message:cn.value.message,onClick:w[6]||(w[6]=P=>St(cn.value.message.id)),onDismiss:w[7]||(w[7]=P=>_(l).dismissPin(_(a).activeChatId))},null,8,["message"])):O("",!0),Gn.value?(d(),h("div",ju,[...w[30]||(w[30]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):O("",!0),A.value>0?(d(),h("button",{key:3,class:"new-messages-pill",onClick:S},M(A.value)+" new message"+M(A.value>1?"s":"")+" â†“ ",1)):O("",!0),t("div",{ref_key:"msgListRef",ref:v,class:ve(["msg-list",{"drag-selecting":_(G)}]),onClick:oa,onScroll:E,onContextmenu:ce,onMousedown:w[9]||(w[9]=(...P)=>_(V)&&_(V)(...P)),onMousemove:w[10]||(w[10]=(...P)=>_(se)&&_(se)(...P)),onMouseup:w[11]||(w[11]=(...P)=>_(H)&&_(H)(...P))},[_(l).loadingChat===_(a).activeChatId?(d(),Y(ks,{key:0})):(d(),h(re,{key:1},[w[31]||(w[31]=t("div",{class:"msg-list-spacer"},null,-1)),t("div",{ref_key:"olderSentinelRef",ref:c,class:"older-sentinel"},[m.value?(d(),Y(ks,{key:0})):O("",!0)],512),(d(!0),h(re,null,ye(Xs.value,P=>(d(),h(re,{key:P.type==="date"?"date-"+P.label:"msg-"+P.msg.id},[P.type==="date"?(d(),h("div",Bu,[t("span",null,M(P.label),1)])):(d(),Y(xl,{key:1,message:P.msg,"is-mine":P.msg.sender_id===_(i).user?.id,onMentionClick:w[8]||(w[8]=te=>o("openUserProfile",te)),onOpenEmojiPicker:sa,onToggleReaction:ia,onReplyClick:St},null,8,["message","is-mine"]))],64))),128))],64))],34),z(Yl,{visible:R.value,x:q.value,y:B.value,onSelect:aa,onClose:w[12]||(w[12]=P=>R.value=!1)},null,8,["visible","x","y"]),L.value?(d(),h("div",Hu,[z(Vl,{onSelect:na})])):O("",!0),C.value?(d(),Y(_(n),{key:5,onSelect:la})):O("",!0),Gn.value?O("",!0):fe((d(),Y(Fl,{key:6,ref_key:"composerRef",ref:I,"sticker-picker-open":L.value,"reply-to":Ze.value,onSend:ea,onEditMessage:ta,onToggleStickers:w[13]||(w[13]=P=>L.value=!L.value),onToggleEmojiPanel:w[14]||(w[14]=P=>C.value=!C.value),onStartRecording:ra,onTyping:Zs,onOpenAttachmentMenu:w[15]||(w[15]=P=>ae.value=!ae.value)},null,8,["sticker-picker-open","reply-to"])),[[as,!W.value]]),z(wu,{visible:ae.value,onFileSelected:pa,onClose:w[16]||(w[16]=P=>ae.value=!1)},null,8,["visible"]),pe.value?(d(),Y(Nu,{key:7,file:pe.value,onSend:ha,onCancel:w[17]||(w[17]=P=>pe.value=null)},null,8,["file"])):O("",!0),W.value?(d(),h("div",Vu,[w[32]||(w[32]=t("span",{class:"rec-dot"},null,-1)),t("span",Wu,M(_(u).formatTime(_(u).seconds.value)),1),w[33]||(w[33]=t("span",{class:"rec-label"},"Recording...",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:ua},"âœ•"),t("button",{class:"icon-btn rec-send",title:"Send",onClick:ca},"â¤")])):O("",!0),z(Jl),z(or,{visible:K.value,onClose:w[26]||(w[26]=P=>K.value=!1)},{default:ln(()=>[t("button",{class:"ctx-item",onClick:w[18]||(w[18]=P=>Be("reply"))},"Reply"),it.value?(d(),h("button",{key:0,class:"ctx-item",onClick:w[19]||(w[19]=P=>Be("edit"))},"Edit")):O("",!0),t("button",{class:"ctx-item",onClick:w[20]||(w[20]=P=>Be(qn.value?"unpin":"pin"))},M(qn.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:w[21]||(w[21]=P=>Be("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:w[22]||(w[22]=P=>Be("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:w[23]||(w[23]=P=>Be("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:w[24]||(w[24]=P=>Be("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:w[25]||(w[25]=P=>Be("delete"))},"Delete")]),_:1},8,["visible"]),ot.value?(d(),Y(kr,{key:9,"message-ids":lt.value,"from-chat-id":_(a).activeChatId,onClose:es,onForwarded:es},null,8,["message-ids","from-chat-id"])):O("",!0),rt.value?(d(),Y(Er,{key:10,"message-count":Qe.value.length,"can-delete-for-everyone":un.value,onClose:w[27]||(w[27]=P=>rt.value=!1),onConfirm:ma},null,8,["message-count","can-delete-for-everyone"])):O("",!0),T.value?(d(),Y(cu,{key:11,"chat-id":String(_(a).activeChatId),onClose:w[28]||(w[28]=P=>T.value=!1)},null,8,["chat-id"])):O("",!0)])):(d(),h("div",{key:0,class:"empty-chat",onContextmenu:w[0]||(w[0]=le(()=>{},["prevent"]))},[...w[29]||(w[29]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])],32))]))}}),Gu=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Saved Messages",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function Ku(e){return Gu.filter(s=>s.visible(e))}const Yu=["disabled"],Xu={class:"menu-item__label"},Ju={key:1,class:"menu-item__badge"},Qu=ne({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:s}){const n=s;return(o,i)=>(d(),h("button",{class:ve(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:i[0]||(i[0]=a=>n("click"))},[e.icon?(d(),Y(je(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):O("",!0),t("span",Xu,M(e.label),1),e.badge?(d(),h("span",Ju,M(e.badge),1)):O("",!0),$s(o.$slots,"right",{},void 0,!0),e.chevron?(d(),Y(je(_(pi)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):O("",!0)],10,Yu))}}),_s=me(Qu,[["__scopeId","data-v-682bc042"]]),Zu={class:"drawer-profile"},ed={class:"drawer-profile-bottom"},td={class:"drawer-profile-info"},nd={class:"drawer-display-name"},sd={class:"drawer-username"},ad={class:"drawer-nav"},id={key:0,class:"drawer-divider"},od=["onClick"],ld={class:"menu-item__label"},rd=["aria-checked"],cd=ne({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:s}){const n=s,o=Ss(),i=Ae(),a=wt(),l={user:Ns,users:On,megaphone:Ds,bookmark:fi,settings:Ei,moon:Ci,download:hi,"log-out":Dn,star:Ai},r=j(()=>({isAuthenticated:!!i.user,isDesktop:!0})),u=j(()=>Ku(r.value)),g={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const p=a.theme==="dark"?"light":"dark";a.applyTheme(p),a.saveSettings({theme:p})},openDownload:()=>n("openDownload"),logout:()=>{i.logout(),o.push("/login")}};function f(p){p&&g[p]&&g[p]()}return(p,v)=>(d(),h("div",{class:ve(["drawer",{open:e.open}])},[t("div",Zu,[z(we,{name:_(i).user?.display_name||_(i).user?.username||"?",url:_(i).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",ed,[t("div",td,[t("div",nd,M(_(i).user?.display_name||_(i).user?.username||"---"),1),t("div",sd,"@"+M(_(i).user?.username||"---"),1)]),t("button",{class:"icon-btn drawer-edit-btn","aria-label":"Edit profile",onClick:v[0]||(v[0]=c=>n("openProfile"))},[z(_(Pn),{size:18,"stroke-width":2})])])]),t("nav",ad,[(d(!0),h(re,null,ye(u.value,c=>(d(),h(re,{key:c.id},[c.separator?(d(),h("div",id)):O("",!0),c.rightSlot==="toggle"?(d(),h("div",{key:1,class:"menu-item menu-item--toggle",onClick:m=>f(c.action)},[(d(),Y(je(l[c.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",ld,M(c.label),1),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":_(a).theme==="dark"}]),role:"switch","aria-checked":_(a).theme==="dark"},[...v[1]||(v[1]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,rd)],8,od)):c.id==="logout"?(d(),Y(_s,{key:2,icon:l[c.icon],label:c.label,danger:"",onClick:m=>f(c.action)},null,8,["icon","label","onClick"])):(d(),Y(_s,{key:3,icon:l[c.icon],label:c.label,onClick:m=>f(c.action)},null,8,["icon","label","onClick"]))],64))),128))]),v[2]||(v[2]=t("div",{class:"drawer-footer"},"BeHappy v2",-1))],2))}}),ud=me(cd,[["__scopeId","data-v-db35de32"]]),dd={class:"modal"},vd={class:"modal-header"},md={class:"modal-body"},fd={key:0,class:"chat-type-cards"},pd={class:"chat-type-icon"},hd={class:"chat-type-icon"},gd={class:"chat-type-icon"},yd={key:1,class:"new-chat-form"},bd={class:"user-pick-list"},kd={key:0,class:"empty-state-small"},_d={key:1,class:"empty-state-small"},wd=["onClick"],Cd={class:"user-pick-name"},$d={class:"user-pick-handle"},Sd={key:2,class:"new-chat-form"},Md={class:"form-group"},xd={class:"form-group"},Ed={class:"form-group"},Td={class:"user-pick-list"},Id=["onClick"],Ld={class:"user-pick-name"},Ad={class:"user-pick-handle"},Rd={class:"modal-actions"},Dd=["disabled"],Pd={key:3,class:"new-chat-form"},Od={class:"form-group"},Nd={class:"form-group"},Ud={class:"form-group"},Fd={class:"modal-actions"},zd=["disabled"],jd=ne({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:s}){const n=e,o=s,i=Ae(),{showToast:a}=Te(),l=y(n.initialStep),r=y(!1),u=y(""),g=y([]),f=y(!1);let p=null;const v=y(""),c=y(""),m=y(""),b=y([]),L=y(new Set);let C=null;const I=y(""),W=y(""),U=y("");Ce(()=>{T("")});async function T($){f.value=!0;try{const x=await os($);g.value=x.filter(E=>E.id!==i.user?.id)}catch{g.value=[]}finally{f.value=!1}}function F(){p&&clearTimeout(p),p=setTimeout(()=>T(u.value),300)}async function ae($){try{b.value=await os($)}catch{b.value=[]}}function pe(){C&&clearTimeout(C),C=setTimeout(()=>ae(m.value),300)}function de($){L.value.has($)?L.value.delete($):L.value.add($)}async function ie($){r.value=!0;try{const x=await mt({type:"direct",member_ids:[$]});o("chatCreated",x.id)}catch{a("Failed to start conversation")}finally{r.value=!1}}async function k(){if(!v.value.trim()){a("Group name is required");return}r.value=!0;try{const $=await mt({type:"group",title:v.value.trim(),description:c.value.trim(),member_ids:Array.from(L.value)});a("Group created!"),o("chatCreated",$.id)}catch{a("Failed to create group")}finally{r.value=!1}}async function A(){if(!I.value.trim()){a("Channel name is required");return}r.value=!0;try{const $=await mt({type:"channel",title:I.value.trim(),description:U.value.trim(),public_name:W.value.trim()||void 0,member_ids:[]});a("Channel created!"),o("chatCreated",$.id)}catch{a("Failed to create channel")}finally{r.value=!1}}return($,x)=>(d(),h("div",{class:"modal-backdrop",onClick:x[14]||(x[14]=le(E=>o("close"),["self"]))},[t("div",dd,[t("div",vd,[x[15]||(x[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:x[0]||(x[0]=E=>o("close"))},[z(_(qe),{size:20})])]),t("div",md,[l.value==="select"?(d(),h("div",fd,[t("button",{class:"chat-type-card",onClick:x[1]||(x[1]=E=>l.value="direct")},[t("span",pd,[z(_(Ns),{size:24})]),x[16]||(x[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:x[2]||(x[2]=E=>l.value="group")},[t("span",hd,[z(_(On),{size:24})]),x[17]||(x[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:x[3]||(x[3]=E=>l.value="channel")},[t("span",gd,[z(_(Ds),{size:24})]),x[18]||(x[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):O("",!0),l.value==="direct"?(d(),h("div",yd,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:x[4]||(x[4]=E=>l.value="select")},[z(_(Fe),{size:16}),x[19]||(x[19]=ke(" Back ",-1))]),fe(t("input",{"onUpdate:modelValue":x[5]||(x[5]=E=>u.value=E),class:"search-input",type:"search",placeholder:"Search users...",onInput:F},null,544),[[be,u.value]]),t("div",bd,[f.value?(d(),h("div",kd,"Loading users...")):g.value.length===0?(d(),h("div",_d,"No users found.")):(d(!0),h(re,{key:2},ye(g.value,E=>(d(),h("div",{key:E.id,class:"user-pick-item",onClick:X=>ie(E.id)},[z(we,{name:E.display_name||E.username,url:E.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Cd,M(E.display_name||E.username),1),t("div",$d,"@"+M(E.username),1)])],8,wd))),128))])])):O("",!0),l.value==="group"?(d(),h("div",Sd,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:x[6]||(x[6]=E=>l.value="select")},[z(_(Fe),{size:16}),x[20]||(x[20]=ke(" Back ",-1))]),t("div",Md,[x[21]||(x[21]=t("label",{class:"form-label"},"Group name",-1)),fe(t("input",{"onUpdate:modelValue":x[7]||(x[7]=E=>v.value=E),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[be,v.value]])]),t("div",xd,[x[22]||(x[22]=t("label",{class:"form-label"},"Description (optional)",-1)),fe(t("textarea",{"onUpdate:modelValue":x[8]||(x[8]=E=>c.value=E),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[be,c.value]])]),t("div",Ed,[x[23]||(x[23]=t("label",{class:"form-label"},"Add members",-1)),fe(t("input",{"onUpdate:modelValue":x[9]||(x[9]=E=>m.value=E),class:"search-input",type:"search",placeholder:"Search users...",onInput:pe},null,544),[[be,m.value]]),t("div",Td,[(d(!0),h(re,null,ye(b.value,E=>(d(),h("div",{key:E.id,class:ve(["user-pick-item",{selected:L.value.has(E.id)}]),onClick:X=>de(E.id)},[z(we,{name:E.display_name||E.username,url:E.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Ld,[L.value.has(E.id)?(d(),Y(_(As),{key:0,size:14,style:{"margin-right":"4px"}})):O("",!0),ke(M(E.display_name||E.username),1)]),t("div",Ad,"@"+M(E.username),1)])],10,Id))),128))])]),t("div",Rd,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:k}," Create Group ",8,Dd)])])):O("",!0),l.value==="channel"?(d(),h("div",Pd,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:x[10]||(x[10]=E=>l.value="select")},[z(_(Fe),{size:16}),x[24]||(x[24]=ke(" Back ",-1))]),t("div",Od,[x[25]||(x[25]=t("label",{class:"form-label"},"Channel name",-1)),fe(t("input",{"onUpdate:modelValue":x[11]||(x[11]=E=>I.value=E),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[be,I.value]])]),t("div",Nd,[x[26]||(x[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),fe(t("input",{"onUpdate:modelValue":x[12]||(x[12]=E=>W.value=E),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[be,W.value]]),x[27]||(x[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",Ud,[x[28]||(x[28]=t("label",{class:"form-label"},"Description (optional)",-1)),fe(t("textarea",{"onUpdate:modelValue":x[13]||(x[13]=E=>U.value=E),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[be,U.value]])]),t("div",Fd,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:A}," Create Channel ",8,zd)])])):O("",!0)])])]))}}),Bd={class:"profile-info-list"},Hd=["onClick"],Vd={class:"profile-info-item__content"},Wd={class:"profile-info-item__value"},qd={class:"profile-info-item__label"},Gd=ne({__name:"ProfileInfoList",props:{username:{},bio:{},userId:{}},setup(e){const s=e,n=y(null),o=j(()=>{const a=[];return s.username&&a.push({icon:mi,label:"Username",value:`@${s.username}`,copyable:!0}),s.bio&&a.push({icon:An,label:"Bio",value:s.bio}),s.userId!=null&&a.push({icon:yi,label:"User ID",value:String(s.userId),copyable:!0}),a});async function i(a){try{await navigator.clipboard.writeText(a.replace(/^@/,""));const l=o.value.find(r=>r.value===a)?.label??null;n.value=l,setTimeout(()=>{n.value=null},1500)}catch{}}return(a,l)=>(d(),h("div",Bd,[(d(!0),h(re,null,ye(o.value,r=>(d(),h("div",{key:r.label,class:ve(["profile-info-item",{"profile-info-item--copyable":r.copyable}]),onClick:u=>r.copyable?i(r.value):void 0},[(d(),Y(je(r.icon),{class:"profile-info-item__icon",size:20,"stroke-width":1.8})),t("div",Vd,[t("span",Wd,M(r.value),1),t("span",qd,M(r.label),1)]),r.copyable?(d(),Y(je(n.value===r.label?_(As):_(Rs)),{key:0,class:"profile-info-item__copy",size:16,"stroke-width":1.8})):O("",!0)],10,Hd))),128))]))}}),Ys=me(Gd,[["__scopeId","data-v-bc174e9a"]]),Kd={class:"profile-media-tabs"},Yd={class:"profile-media-tabs__header"},Xd=["onClick"],Jd={key:0,class:"profile-media-tabs__count"},Qd={key:0,class:"profile-media-tabs__content"},Zd={class:"profile-media-tabs__empty"},ev={class:"profile-media-tabs__empty-text"},tv=ne({__name:"ProfileMediaTabs",setup(e){const s=[{key:"media",label:"Media",count:0,emptyIcon:Rn},{key:"files",label:"Files",count:0,emptyIcon:An},{key:"links",label:"Links",count:0,emptyIcon:bi},{key:"voice",label:"Voice",count:0,emptyIcon:Ps}],n=y("media"),o=j(()=>s.findIndex(l=>l.key===n.value)),i=j(()=>s[o.value]??s[0]),a=j(()=>({width:`${100/s.length}%`,transform:`translateX(${o.value*100}%)`}));return(l,r)=>(d(),h("div",Kd,[t("div",Yd,[(d(),h(re,null,ye(s,u=>t("button",{key:u.key,class:ve(["profile-media-tabs__tab",{"profile-media-tabs__tab--active":n.value===u.key}]),onClick:g=>n.value=u.key},[ke(M(u.label)+" ",1),u.count!==void 0?(d(),h("span",Jd,M(u.count),1)):O("",!0)],10,Xd)),64)),t("div",{class:"profile-media-tabs__indicator",style:at(a.value)},null,4)]),i.value?(d(),h("div",Qd,[t("div",Zd,[(d(),Y(je(i.value.emptyIcon),{size:40,"stroke-width":1.2,class:"profile-media-tabs__empty-icon"})),t("span",ev," No "+M(i.value.label.toLowerCase())+" yet ",1)])])):O("",!0)]))}}),nv=me(tv,[["__scopeId","data-v-bb3b131e"]]),sv={class:"modal profile-modal profile-modal--self"},av={key:"view"},iv={class:"profile-header"},ov={class:"profile-header__content"},lv={class:"profile-header__info"},rv={class:"profile-name"},cv={class:"profile-modal-body"},uv={key:"edit"},dv={class:"profile-edit-header"},vv={class:"profile-modal-body profile-modal-body--scrollable"},mv={class:"profile-avatar-section profile-avatar-upload-section"},fv={class:"profile-avatar-overlay"},pv={class:"profile-info-list"},hv={class:"form-group"},gv={class:"form-group"},yv={key:0,class:"form-hint form-error"},bv={class:"form-group"},kv=ne({__name:"ProfileModal",emits:["close"],setup(e,{emit:s}){const n=s,o=Ae(),i=Me(),{showToast:a}=Te(),l=y("view"),r=y("profile-slide-left"),u=y(""),g=y(""),f=y(""),p=y(""),v=y(null),c=j(()=>o.user?i.isUserOnline(o.user.id):!1),m=j(()=>{if(c.value)return"online";if(!o.user)return"offline";const U=i.getUserPresence(o.user.id);return U?.lastSeenAt?Nn(U.lastSeenAt):U?.lastSeenBucket?`last seen ${U.lastSeenBucket}`:"offline"});function b(){o.user&&(u.value=o.user.display_name||"",g.value=o.user.username,f.value=o.user.bio||""),p.value=""}function L(){b(),r.value="profile-slide-left",l.value="edit"}function C(){r.value="profile-slide-right",l.value="view"}async function I(){const U=v.value?.files?.[0];if(U){try{const T=await At(U),F=await oi(T.id);o.updateUser({avatar_url:F.avatar_url}),a("Avatar updated!")}catch{a("Upload failed")}v.value&&(v.value.value="")}}async function W(){if(p.value="",!o.user)return;const U={display_name:u.value.trim(),bio:f.value.trim()};g.value.trim()&&g.value.trim()!==o.user.username&&(U.username=g.value.trim());try{const T=await ii(o.user.id,U);o.updateUser({display_name:T.display_name,username:T.username}),a("Profile saved!"),n("close")}catch(T){T.response?.status===409?p.value="Username already taken":a("Save failed")}}return(U,T)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:T[5]||(T[5]=le(F=>n("close"),["self"]))},[t("div",sv,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:T[0]||(T[0]=F=>n("close"))},[z(_(qe),{size:20,"stroke-width":2})]),l.value==="view"?(d(),h("button",{key:0,class:"icon-btn profile-edit-btn","aria-label":"Edit profile",onClick:L},[z(_(Pn),{size:18,"stroke-width":2})])):O("",!0),z(Ln,{name:r.value,mode:"out-in"},{default:ln(()=>[l.value==="view"?(d(),h("div",av,[t("div",iv,[T[6]||(T[6]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",ov,[z(we,{name:_(o).user?.display_name||_(o).user?.username||"?",url:_(o).user?.avatar_url,online:c.value,size:"xxl"},null,8,["name","url","online"]),t("div",lv,[t("div",rv,[ke(M(_(o).user?.display_name||_(o).user?.username||"?")+" ",1),_(o).user?.is_admin?(d(),Y(Wn,{key:0})):O("",!0)]),t("div",{class:ve(["profile-status",{"profile-status--online":c.value}])},M(m.value),3)])])]),t("div",cv,[z(Ys,{username:_(o).user?.username,bio:_(o).user?.bio,"user-id":_(o).user?.id},null,8,["username","bio","user-id"]),z(nv)])])):(d(),h("div",uv,[t("div",dv,[t("button",{class:"icon-btn","aria-label":"Back",onClick:C},[z(_(Fe),{size:20,"stroke-width":2})]),T[7]||(T[7]=t("span",{class:"profile-edit-header__title"},"Edit Profile",-1))]),t("div",vv,[t("div",mv,[t("div",{class:"profile-avatar-upload-wrap",onClick:T[1]||(T[1]=F=>v.value?.click())},[z(we,{name:u.value||_(o).user?.username||"?",url:_(o).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",fv,[z(_(Ls),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:v,type:"file",accept:"image/*",class:"hidden",onChange:I},null,544)]),t("div",pv,[t("div",hv,[T[8]||(T[8]=t("label",{class:"form-label"},"Display name",-1)),fe(t("input",{"onUpdate:modelValue":T[2]||(T[2]=F=>u.value=F),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[be,u.value]])]),t("div",gv,[T[9]||(T[9]=t("label",{class:"form-label"},"Username",-1)),fe(t("input",{"onUpdate:modelValue":T[3]||(T[3]=F=>g.value=F),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[be,g.value]]),p.value?(d(),h("small",yv,M(p.value),1)):O("",!0)]),t("div",bv,[T[10]||(T[10]=t("label",{class:"form-label"},"Bio",-1)),fe(t("textarea",{"onUpdate:modelValue":T[4]||(T[4]=F=>f.value=F),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[be,f.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:W},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:C},"Cancel")])])]))]),_:1},8,["name"])])]))}}),_v=me(kv,[["__scopeId","data-v-59263597"]]),wv={class:"profile-actions"},Cv=["disabled","onClick"],$v={class:"profile-action-btn__circle"},Sv={class:"profile-action-btn__label"},Mv=ne({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:s}){const n=e,o=s,i=j(()=>{const a=[{icon:wi,label:"Message",event:"message"}];return n.showMute!==!1&&a.push({icon:Is,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&a.push({icon:gi,label:"More",event:"more"}),a});return(a,l)=>(d(),h("div",wv,[(d(!0),h(re,null,ye(i.value,r=>(d(),h("button",{key:r.label,class:ve(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:u=>o(r.event)},[t("span",$v,[(d(),Y(je(r.icon),{size:22,"stroke-width":1.8}))]),t("span",Sv,M(r.label),1)],10,Cv))),128))]))}}),xv=me(Mv,[["__scopeId","data-v-a16c1098"]]),Ev={class:"modal profile-modal"},Tv={key:0,class:"profile-modal-body"},Iv={class:"profile-header"},Lv={class:"profile-header__content"},Av={class:"profile-header__info"},Rv={class:"profile-name"},Dv={class:"profile-modal-body"},Pv={class:"profile-media-tabs"},Ov=["onClick"],Nv={class:"profile-media-empty"},Uv={key:2,class:"profile-modal-body"},Fv=ne({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:s}){const n=e,o=s,i=Me(),{showToast:a}=Te(),l=y(null),r=y(!0),u=y(!1),g=["Media","Files","Links"],f=y("Media"),p=j(()=>l.value?i.isUserOnline(l.value.id):!1),v=j(()=>{if(p.value)return"online";if(!l.value)return"offline";const m=i.getUserPresence(l.value.id);return m?.lastSeenAt?Nn(m.lastSeenAt):m?.lastSeenBucket?`last seen ${m.lastSeenBucket}`:"offline"});Ce(async()=>{try{l.value=await Ts(n.username)}catch{l.value=null}finally{r.value=!1}});function c(){u.value=!u.value,a(u.value?"User muted":"User unmuted")}return(m,b)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:b[2]||(b[2]=le(L=>o("close"),["self"]))},[t("div",Ev,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:b[0]||(b[0]=L=>o("close"))},[z(_(qe),{size:20,"stroke-width":2})]),r.value?(d(),h("div",Tv,[...b[3]||(b[3]=[t("div",{class:"profile-loading"},[t("p",null,"Loading...")],-1)])])):l.value?(d(),h(re,{key:1},[t("div",Iv,[b[4]||(b[4]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",Lv,[z(we,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:p.value,size:"xxl"},null,8,["name","url","online"]),t("div",Av,[t("div",Rv,[ke(M(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(d(),Y(Wn,{key:0})):O("",!0)]),t("div",{class:ve(["profile-status",{"profile-status--online":p.value}])},M(v.value),3)])])]),t("div",Dv,[z(xv,{muted:u.value,"show-more":!1,onMessage:b[1]||(b[1]=L=>o("message",l.value.username)),onMute:c},null,8,["muted"]),b[5]||(b[5]=t("div",{class:"profile-divider"},null,-1)),z(Ys,{username:l.value.username,bio:l.value.bio,"user-id":l.value.id},null,8,["username","bio","user-id"]),t("div",Pv,[(d(),h(re,null,ye(g,L=>t("button",{key:L,class:ve(["profile-media-tab",{"profile-media-tab--active":f.value===L}]),onClick:C=>f.value=L},M(L),11,Ov)),64))]),t("div",Nv,[z(_(Rn),{size:32,"stroke-width":1.5}),t("span",null,"No "+M(f.value.toLowerCase())+" yet",1)])])],64)):(d(),h("div",Uv,[...b[6]||(b[6]=[t("div",{class:"profile-loading"},[t("p",null,"User not found")],-1)])]))])]))}}),zv=me(Fv,[["__scopeId","data-v-1e27c432"]]),jv={class:"modal",style:{"max-width":"420px"}},Bv={class:"modal-header"},Hv={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},Vv=ne({__name:"DownloadModal",emits:["close"],setup(e,{emit:s}){const n=s,o=navigator.userAgent.toLowerCase(),i=o.includes("win"),a=o.includes("mac")&&!o.includes("iphone")&&!o.includes("ipad"),l=j(()=>i?"Windows":a?"macOS":null);function r(){i?window.location.href="/downloads/windows/BeHappySetup.exe":a&&(window.location.href="/downloads/macos/BeHappy.dmg")}return(u,g)=>(d(),h("div",{class:"modal-backdrop",onClick:g[1]||(g[1]=le(f=>n("close"),["self"]))},[t("div",jv,[t("div",Bv,[g[2]||(g[2]=t("h2",{class:"modal-title"},"Download BeHappy",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:g[0]||(g[0]=f=>n("close"))},[z(_(qe),{size:20})])]),t("div",Hv,[l.value?(d(),h("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+M(l.value),1)):O("",!0),g[3]||(g[3]=Ca('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/BeHappySetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/BeHappy.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),Wv={class:"modal",style:{"max-width":"400px"}},qv={class:"modal-header"},Gv={class:"modal-body",style:{"text-align":"center"}},Kv={key:0},Yv={style:{"font-size":"1.25rem","font-weight":"700"}},Xv={style:{color:"var(--text-muted)","margin-top":".5rem"}},Jv={class:"profile-avatar-section"},Qv={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},Zv={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},em={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},tm={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},nm=["disabled"],sm=ne({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:s}){const n=e,o=s,{showToast:i}=Te(),a=y(null),l=y(!0),r=y(!1),u=y(""),g=y("");Ce(async()=>{if(!n.token){u.value="Invalid Link",g.value="No invite token provided.",l.value=!1;return}try{a.value=await Ta(n.token)}catch(p){p.response?.status===410?(u.value="Invite Revoked",g.value="This invite link has been revoked."):(u.value="Invite Not Found",g.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function f(){r.value=!0;try{const p=await Ia(n.token);i(p.already_member?"You are already a member":"Joined successfully!"),o("joined",p.chat_id)}catch(p){i(p.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(p,v)=>(d(),h("div",{class:"modal-backdrop",onClick:v[2]||(v[2]=le(c=>o("close"),["self"]))},[t("div",Wv,[t("div",qv,[v[3]||(v[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:v[0]||(v[0]=c=>o("close"))},"âœ•")]),t("div",Gv,[l.value?(d(),h("p",Kv,"Loading invite preview...")):g.value?(d(),h(re,{key:1},[t("h2",Yv,M(u.value),1),t("p",Xv,M(g.value),1)],64)):a.value?(d(),h(re,{key:2},[t("div",Jv,[z(we,{name:a.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",Qv,M(a.value.title||a.value.type||"Chat"),1),a.value.description?(d(),h("p",Zv,M(a.value.description),1)):O("",!0),a.value.member_count?(d(),h("p",em,M(a.value.member_count)+" members ",1)):O("",!0),t("div",tm,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:f},M(r.value?"Joining...":"Join"),9,nm),t("button",{class:"btn btn-ghost",onClick:v[1]||(v[1]=c=>o("close"))},"Cancel")])],64)):O("",!0)])])]))}}),am={class:"modal modal-wide settings-modal"},im={class:"modal-header"},om={class:"modal-body"},lm={class:"settings-profile-header"},rm={class:"settings-profile-info"},cm={class:"settings-display-name"},um={class:"settings-username"},dm={class:"settings-group"},vm={class:"settings-section-title"},mm={class:"menu-item menu-item--setting"},fm={class:"settings-group"},pm={class:"settings-section-title"},hm=["aria-checked"],gm={class:"settings-group"},ym={class:"settings-section-title"},bm={class:"menu-item menu-item--setting"},km={class:"settings-group"},_m={class:"settings-section-title"},wm={class:"menu-item menu-item--setting"},Cm=["aria-checked"],$m={class:"settings-actions"},Sm=ne({__name:"SettingsView",emits:["close"],setup(e,{emit:s}){const n=s,o=Ae(),i=wt(),{showToast:a}=Te(),l=y("light"),r=y(!0),u=y("en"),g=y("everyone"),f=y(!0);Pe(r,async v=>{v&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(r.value=!1,a("Notifications blocked by browser"))}),Ce(()=>{l.value=i.theme,r.value=i.notificationsEnabled,u.value=i.language,g.value=i.lastSeenVisibility,f.value=i.readReceiptsEnabled});async function p(){try{await i.saveSettings({theme:l.value,notifications_enabled:r.value,language:u.value,last_seen_visibility:g.value,read_receipts_enabled:f.value}),a("Settings saved"),n("close")}catch{a("Failed to save settings")}}return(v,c)=>(d(),h("div",{class:"modal-backdrop",onClick:c[8]||(c[8]=le(m=>n("close"),["self"]))},[t("div",am,[t("div",im,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=m=>n("close"))},[z(_(Fe),{size:20,"stroke-width":2})]),c[9]||(c[9]=t("span",{class:"modal-title"},"Settings",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[1]||(c[1]=m=>n("close"))},[z(_(qe),{size:20,"stroke-width":2})])]),t("div",om,[t("div",lm,[z(we,{name:_(o).user?.display_name||_(o).user?.username||"?",url:_(o).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",rm,[t("div",cm,M(_(o).user?.display_name||_(o).user?.username||"---"),1),t("div",um,"@"+M(_(o).user?.username||"---"),1)])]),c[24]||(c[24]=t("div",{class:"settings-divider"},null,-1)),t("div",dm,[t("div",vm,[z(_(vs),{size:18,"stroke-width":1.8}),c[10]||(c[10]=t("span",null,"Appearance",-1))]),t("div",mm,[z(_(vs),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[12]||(c[12]=t("span",{class:"menu-item__label"},"Theme",-1)),fe(t("select",{"onUpdate:modelValue":c[2]||(c[2]=m=>l.value=m),class:"form-input form-select settings-select"},[...c[11]||(c[11]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[mn,l.value]])])]),c[25]||(c[25]=t("div",{class:"settings-divider"},null,-1)),t("div",fm,[t("div",pm,[z(_(cs),{size:18,"stroke-width":1.8}),c[13]||(c[13]=t("span",null,"Notifications",-1))]),t("div",{class:"menu-item menu-item--toggle",onClick:c[3]||(c[3]=m=>r.value=!r.value)},[z(_(cs),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[15]||(c[15]=t("span",{class:"menu-item__label"},"Notifications",-1)),t("span",{class:ve(["toggle-status",{"toggle-status--on":r.value}])},M(r.value?"Enabled":"Disabled"),3),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":r.value}]),role:"switch","aria-checked":r.value},[...c[14]||(c[14]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,hm)])]),c[26]||(c[26]=t("div",{class:"settings-divider"},null,-1)),t("div",gm,[t("div",ym,[z(_(ds),{size:18,"stroke-width":1.8}),c[16]||(c[16]=t("span",null,"Language",-1))]),t("div",bm,[z(_(ds),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[18]||(c[18]=t("span",{class:"menu-item__label"},"Language",-1)),fe(t("select",{"onUpdate:modelValue":c[4]||(c[4]=m=>u.value=m),class:"form-input form-select settings-select"},[...c[17]||(c[17]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[mn,u.value]])])]),c[27]||(c[27]=t("div",{class:"settings-divider"},null,-1)),t("div",km,[t("div",_m,[z(_(fn),{size:18,"stroke-width":1.8}),c[19]||(c[19]=t("span",null,"Privacy",-1))]),t("div",wm,[(d(),Y(je(g.value==="nobody"?_(us):_(fn)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[21]||(c[21]=t("span",{class:"menu-item__label"},"Last Seen & Online",-1)),fe(t("select",{"onUpdate:modelValue":c[5]||(c[5]=m=>g.value=m),class:"form-input form-select settings-select"},[...c[20]||(c[20]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[mn,g.value]])]),t("div",{class:"menu-item menu-item--toggle",onClick:c[6]||(c[6]=m=>f.value=!f.value)},[(d(),Y(je(f.value?_(fn):_(us)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[23]||(c[23]=t("span",{class:"menu-item__label"},"Read Receipts",-1)),t("span",{class:ve(["toggle-status",{"toggle-status--on":f.value}])},M(f.value?"Enabled":"Disabled"),3),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":f.value}]),role:"switch","aria-checked":f.value},[...c[22]||(c[22]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Cm)])]),c[28]||(c[28]=t("div",{class:"settings-divider"},null,-1)),t("div",$m,[t("button",{class:"btn btn-primary",onClick:p},"Save Settings"),t("button",{class:"btn btn-ghost",onClick:c[7]||(c[7]=m=>n("close"))},"Cancel")])])])]))}}),Mm=me(Sm,[["__scopeId","data-v-3b2634a6"]]),xm=ne({__name:"ContextMenu",setup(e){const s=Me(),{showToast:n}=Te(),{showConfirm:o}=$a(),i=y(!1),a=y(0),l=y(0),r=y(null),u=j(()=>r.value?s.chats.find(b=>b.id===r.value)??null:null);function g(b){r.value=b.detail.chatId,a.value=b.detail.x,l.value=b.detail.y,i.value=!0}function f(){i.value&&(i.value=!1,r.value=null)}Ce(()=>{window.addEventListener("show-context-menu",g),document.addEventListener("click",f)}),ze(()=>{window.removeEventListener("show-context-menu",g),document.removeEventListener("click",f)});async function p(){if(r.value){i.value=!1;try{await s.toggleFavorite(r.value)}catch{n("Failed to update favorite")}}}async function v(){if(r.value){i.value=!1;try{await s.toggleMute(r.value)}catch{n("Failed to update mute")}}}async function c(){if(!(!r.value||(i.value=!1,!await o({title:"Leave Chat",message:"Leave this chat?",confirmLabel:"Leave",danger:!0}))))try{await s.leave(r.value),n("Left chat")}catch{n("Failed to leave chat")}}async function m(){if(!(!r.value||(i.value=!1,!await o({title:"Delete Chat",message:"Delete this chat? All messages will be permanently removed.",confirmLabel:"Delete",danger:!0}))))try{await s.deleteChat(r.value),n("Chat deleted")}catch{n("Failed to delete chat")}}return(b,L)=>i.value?(d(),h("div",{key:0,class:"context-menu",style:at({left:a.value+"px",top:l.value+"px"})},[t("button",{class:"ctx-item",onClick:p},M(u.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:v},M(u.value?.is_muted?"Unmute":"Mute"),1),u.value&&u.value.type!=="direct"?(d(),h("button",{key:0,class:"ctx-item ctx-leave",onClick:c}," Leave chat ")):O("",!0),t("button",{class:"ctx-item ctx-delete",onClick:m}," Delete chat ")],4)):O("",!0)}}),ws=240,Em=.5,Tm=ne({__name:"MessengerView",setup(e){const s=Sa(),n=Ss(),o=Ae(),i=Me(),a=wt(),l=Je(),{showToast:r}=Te(),{connect:u,disconnect:g,sendTyping:f}=ai();vt("sendTyping",f);const p=y(!1),v=y(!1),c=y("select"),m=y(!1),b=y(!1),L=y(!1),C=y(null),I=y(null),W=y([]),U=y(null);vt("stickers",W),vt("pendingScrollMessageId",U),Ce(async()=>{await a.loadSettings();try{W.value=await li()}catch{}await i.loadChats(),u(),T()}),ze(()=>{g()}),Pe(()=>s.path,()=>{T()}),Pe(()=>i.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function T(){const G=s.path;if(G.startsWith("/@")){const V=s.params.username;V&&(C.value=V)}else if(G.startsWith("/u/")){const V=s.params.id;if(V)try{const se=await Es(parseInt(V));C.value=se.username}catch{r("User not found")}}else if(G.startsWith("/dm/")){const V=s.params.id;V&&await F(V)}else if(G.startsWith("/c/")){const V=s.params.chatIdOrName||s.params.name,se=s.params.messageId?parseInt(s.params.messageId):null;if(V)if(/^\d+$/.test(V)){const K=parseInt(V);se?await pe(K,se):i.setActiveChat(K)}else await ae(V)}}async function F(G){try{let V;if(G.startsWith("@")){const H=G.substring(1);V=(await Ts(H)).id}else V=parseInt(G);const se=await mt({type:"direct",member_ids:[V]});await i.loadChats(),i.setActiveChat(se.id)}catch{r("Failed to open conversation")}}async function ae(G){try{const V=await Aa(G);i.chats.find(H=>H.id===V.id)?i.setActiveChat(V.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function pe(G,V){if(!i.chats.find(H=>H.id===G)){r("Chat not found");return}i.setActiveChat(G),await Se(),U.value=V}const de=parseInt(localStorage.getItem("sidebar-width")||"360",10);de>=ws&&document.documentElement.style.setProperty("--sidebar-width",de+"px");function ie(G){G.preventDefault();const V=G.currentTarget;V.setPointerCapture(G.pointerId);const se=K=>{const ue=window.innerWidth*Em,xe=Math.min(ue,Math.max(ws,K.clientX));document.documentElement.style.setProperty("--sidebar-width",xe+"px")},H=()=>{V.removeEventListener("pointermove",se),V.removeEventListener("pointerup",H);const K=getComputedStyle(document.documentElement).getPropertyValue("--sidebar-width").trim();localStorage.setItem("sidebar-width",parseInt(K,10).toString())};V.addEventListener("pointermove",se),V.addEventListener("pointerup",H)}function k(G){i.setActiveChat(G),n.replace("/app")}function A(){i.setActiveChat(null)}function $(){p.value=!1,m.value=!0}function x(){p.value=!1,b.value=!0}function E(){p.value=!1,c.value="group",v.value=!0}function X(){p.value=!1,c.value="channel",v.value=!0}async function ce(){if(p.value=!1,!!o.user)try{const G=await mt({type:"direct",member_ids:[o.user.id]});await i.loadChats(),i.setActiveChat(G.id)}catch{r("Failed to open Saved Messages")}}function S(G){C.value=G}async function R(G){C.value=null,await F("@"+G)}async function q(G){v.value=!1,await i.loadChats(),i.setActiveChat(G)}async function B(G){I.value=null,await i.loadChats(),i.setActiveChat(G)}function ee(G){const V=G.target?.closest("a");if(!V)return;const se=V.getAttribute("href");if(!se)return;let H;try{H=new URL(se,window.location.origin)}catch{return}if(H.origin!==window.location.origin){G.preventDefault(),G.stopPropagation(),window.open(H.href,"_blank");return}G.preventDefault(),G.stopPropagation();const K=H.pathname,ue=K.match(/^\/join\/([^/]+)$/);if(ue){I.value=ue[1]??null;return}if(K.startsWith("/@")||K.startsWith("/u/")||K.startsWith("/dm/")||K.startsWith("/c/")){n.push(K);return}n.push(K)}function oe(G){if(G.key==="Escape"){if(I.value){I.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if(C.value){C.value=null;return}if(v.value){v.value=!1;return}if(m.value){m.value=!1;return}if(b.value){b.value=!1;return}if(L.value){L.value=!1;return}if(p.value){p.value=!1;return}if(i.activeChatId!==null){A();return}}}return Ce(()=>{document.addEventListener("keydown",oe),document.addEventListener("click",ee,!0)}),ze(()=>{document.removeEventListener("keydown",oe),document.removeEventListener("click",ee,!0)}),(G,V)=>(d(),h("div",{class:ve(["layout",{"chat-open":!!_(i).activeChatId}])},[z(ud,{open:p.value,onClose:V[0]||(V[0]=se=>p.value=!1),onOpenProfile:$,onOpenSettings:x,onOpenNewGroup:E,onOpenNewChannel:X,onOpenFavorites:ce,onOpenDownload:V[1]||(V[1]=se=>L.value=!0)},null,8,["open"]),t("div",{class:ve(["drawer-overlay",{visible:p.value}]),onClick:V[2]||(V[2]=se=>p.value=!1)},null,2),z(to,{onOpenDrawer:V[3]||(V[3]=se=>p.value=!0),onOpenNewChat:V[4]||(V[4]=se=>{c.value="select",v.value=!0}),onSelectChat:k}),t("div",{class:"resize-handle",onPointerdown:ie},null,32),z(qu,{onBack:A,onOpenUserProfile:S}),v.value?(d(),Y(jd,{key:0,"initial-step":c.value,onClose:V[5]||(V[5]=se=>v.value=!1),onChatCreated:q},null,8,["initial-step"])):O("",!0),m.value?(d(),Y(_v,{key:1,onClose:V[6]||(V[6]=se=>m.value=!1)})):O("",!0),b.value?(d(),Y(Mm,{key:2,onClose:V[7]||(V[7]=se=>b.value=!1)})):O("",!0),C.value?(d(),Y(zv,{key:3,username:C.value,onClose:V[8]||(V[8]=se=>C.value=null),onMessage:R},null,8,["username"])):O("",!0),L.value?(d(),Y(Vv,{key:4,onClose:V[9]||(V[9]=se=>L.value=!1)})):O("",!0),I.value?(d(),Y(sm,{key:5,token:I.value,onClose:V[10]||(V[10]=se=>I.value=null),onJoined:B},null,8,["token"])):O("",!0),z(xm)],2))}}),Am=Object.freeze(Object.defineProperty({__proto__:null,default:Tm},Symbol.toStringTag,{value:"Module"}));export{Am as M,me as _};
