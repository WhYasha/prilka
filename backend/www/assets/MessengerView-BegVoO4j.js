import{k as R,l as _e,r as y,m as O,n as ke,u as fe,p as Oe,d as j,o as u,c as h,a as e,t as L,w as Z,q as Fe,s as Q,g as P,b as E,f as ne,x,e as H,v as ee,F as J,y as te,z as V,A as Ie,B as xe,C as Lt,D as se,E as ye,G as Ze,H as ce,I as le,T as st,h as Be,J as at,K as ot,L as it,M as Le,N as Ue,j as lt,O as Je,P as Ut,Q as Ft}from"./index-C_KFx2Pb.js";import{_ as oe,l as rt,c as ct,r as ut}from"./invites-B5FYYFgj.js";async function Et(){const{data:t}=await R.get("/chats");return t}async function dt(t){const{data:a}=await R.get(`/chats/${t}`);return a}async function Pt(t){const{data:a}=await R.get(`/chats/by-name/${encodeURIComponent(t)}`);return a}async function Te(t){const{data:a}=await R.post("/chats",t);return a}async function Nt(t){await R.post(`/chats/${t}/favorite`)}async function At(t){await R.delete(`/chats/${t}/favorite`)}async function zt(t,a){await R.post(`/chats/${t}/mute`,{})}async function Ot(t){await R.delete(`/chats/${t}/mute`)}async function Bt(t){await R.delete(`/chats/${t}/leave`)}async function Rt(t){await R.post(`/chats/${t}/read`)}async function Vt(t){await R.post(`/chats/${t}/pin`)}async function jt(t){await R.delete(`/chats/${t}/pin`)}async function qt(t){await R.post(`/chats/${t}/archive`)}async function Ht(t){await R.delete(`/chats/${t}/archive`)}async function Wt(t){const{data:a}=await R.get(`/chats/${t}/members`);return a}async function Gt(t){await R.delete(`/chats/${t}`)}async function Xt(t,a){const{data:o}=await R.patch(`/chats/${t}`,a);return o}const ie=_e("chats",()=>{const t=y([]),a=y(null),o=y({}),i=y(new Set),s=O(()=>t.value.find(g=>g.id===a.value)??null),l=O(()=>[...t.value].sort((g,I)=>{if(g.is_pinned&&!I.is_pinned)return-1;if(!g.is_pinned&&I.is_pinned)return 1;if(g.is_favorite&&!I.is_favorite)return-1;if(!g.is_favorite&&I.is_favorite)return 1;const M=g.last_at||g.updated_at||"";return(I.last_at||I.updated_at||"").localeCompare(M)}));async function n(){try{t.value=await Et()}catch(g){console.error("Failed to load chats",g)}}function r(g){if(a.value=g,g!==null){const I=t.value.find(M=>M.id===g);I&&I.unread_count>0&&(I.unread_count=0,Rt(g).catch(()=>{}))}}async function b(g){const I=t.value.find(M=>M.id===g);if(I)try{I.is_favorite?await At(g):await Nt(g),I.is_favorite=!I.is_favorite}catch(M){throw console.error("Failed to toggle favorite",M),M}}async function d(g){const I=t.value.find(M=>M.id===g);if(I)try{I.is_muted?await Ot(g):await zt(g),I.is_muted=!I.is_muted}catch(M){throw console.error("Failed to toggle mute",M),M}}async function C(g){const I=t.value.find(M=>M.id===g);if(I)try{I.is_pinned?await jt(g):await Vt(g),I.is_pinned=!I.is_pinned}catch(M){throw console.error("Failed to toggle pin",M),M}}async function v(g){const I=t.value.find(M=>M.id===g);if(I)try{I.is_archived?await Ht(g):await qt(g),I.is_archived=!I.is_archived}catch(M){throw console.error("Failed to toggle archive",M),M}}async function c(g){await Bt(g),t.value=t.value.filter(I=>I.id!==g),a.value===g&&(a.value=null)}function w(g,I,M){const N=t.value.find(B=>B.id===g);N&&(N.last_message=I,N.last_at=M)}function k(g){const I=t.value.find(M=>M.id===g);I&&(I.unread_count=(I.unread_count||0)+1)}function f(g,I,M){o.value[g]||(o.value[g]={});const N=o.value[g][I];N&&clearTimeout(N.timer);const B=setTimeout(()=>{T(g,I)},3e3);o.value[g][I]={username:M,timer:B}}function T(g,I){if(o.value[g]){const M=o.value[g][I];M&&(clearTimeout(M.timer),delete o.value[g][I])}}function p(g){const I=o.value[g];return I?Object.values(I).map(M=>M.username):[]}function S(g){i.value=new Set([...i.value,g])}function _(g){const I=new Set(i.value);I.delete(g),i.value=I}function m(g){return i.value.has(g)}return{chats:t,activeChatId:a,activeChat:s,sortedChats:l,typingUsers:o,loadChats:n,setActiveChat:r,toggleFavorite:b,toggleMute:d,togglePin:C,toggleArchive:v,leave:c,updateChatLastMessage:w,incrementUnread:k,setTyping:f,clearTyping:T,getTypingUsernames:p,onlineUsers:i,setUserOnline:S,setUserOffline:_,isUserOnline:m}});async function Yt(){const{data:t}=await R.get("/settings");return t}async function Zt(t){await R.put("/settings",t)}const Ee=_e("settings",()=>{const t=y(localStorage.getItem("theme")||"light"),a=y(!0),o=y("en");function i(n){t.value=n,document.body.setAttribute("data-theme",n),localStorage.setItem("theme",n)}async function s(){try{const n=await Yt();i(n.theme||"light"),a.value=n.notifications_enabled,o.value=n.language||"en"}catch(n){console.error("Failed to load settings",n)}}async function l(n){await Zt(n),n.theme&&i(n.theme),n.notifications_enabled!==void 0&&(a.value=n.notifications_enabled),n.language&&(o.value=n.language)}return document.body.setAttribute("data-theme",t.value),{theme:t,notificationsEnabled:a,language:o,applyTheme:i,loadSettings:s,saveSettings:l}}),Pe=_e("selection",()=>{const t=y(new Set),a=y(!1),o=y(null),i=O(()=>t.value.size);function s(d,C){a.value=!0,o.value=d,t.value=new Set(C!=null?[C]:[])}function l(){a.value=!1,o.value=null,t.value=new Set}function n(d){const C=new Set(t.value);C.has(d)?C.delete(d):C.add(d),t.value=C,C.size===0&&l()}function r(){t.value=new Set}function b(d){return t.value.has(d)}return{selectedMessageIds:t,selectionMode:a,currentChatId:o,selectedCount:i,enterSelectionMode:s,exitSelectionMode:l,toggleMessage:n,clearSelection:r,isSelected:b}});async function De(t,a){const{data:o}=await R.get(`/chats/${t}/messages`,{params:a});return o}async function Jt(t,a){const{data:o}=await R.post(`/chats/${t}/messages`,a);return o}async function Qt(t,a){await R.delete(`/chats/${t}/messages/${a}`)}async function Kt(t,a,o){const{data:i}=await R.put(`/chats/${t}/messages/${a}`,{content:o});return i}async function en(t,a){const{data:o}=await R.post(`/chats/${t}/messages/forward`,a);return o}async function tn(t,a,o){const{data:i}=await R.post(`/chats/${t}/messages/${a}/reactions`,{emoji:o});return i}async function nn(t,a){if(!a.length)return{};const{data:o}=await R.get(`/chats/${t}/reactions`,{params:{message_ids:a.join(",")}});return o}const Re=_e("messages",()=>{const t=y({}),a=y({}),o=y(null);async function i(p){const S=t.value[p];if(!S||S.length===0)return;const _=S.map(m=>m.id);try{const m=await nn(p,_);for(const g of S)g.reactions=m[String(g.id)]||void 0}catch(m){console.error("Failed to load reactions",m)}}async function s(p){o.value=p;try{const S=await De(p,{limit:50});t.value[p]=S,S.length>0&&(a.value[p]=Math.max(...S.map(_=>_.id))),await i(p)}catch(S){throw console.error("Failed to load messages",S),S}finally{o.value=null}}async function l(p){const S=a.value[p]||0;if(S===0)return[];try{const _=await De(p,{after_id:S,limit:50});if(_.length>0){t.value[p]||(t.value[p]=[]);const m=new Set(t.value[p].map(I=>I.id)),g=_.filter(I=>!m.has(I.id));t.value[p].push(...g),a.value[p]=Math.max(..._.map(I=>I.id)),await i(p)}return _}catch(_){return console.error("Failed to load newer messages",_),[]}}async function n(p){const S=t.value[p];if(!S||S.length===0)return[];const _=S[0];if(!_)return[];try{const m=await De(p,{before:_.created_at,limit:50});if(m.length>0){const g=new Set(S.map(M=>M.id)),I=m.filter(M=>!g.has(M.id));t.value[p]=[...I,...S],await i(p)}return m}catch(m){return console.error("Failed to load older messages",m),[]}}async function r(p,S,_){try{const m=await tn(p,S,_);b(p,S,m.action,_,!0)}catch(m){console.error("Failed to toggle reaction",m)}}function b(p,S,_,m,g){const I=t.value[p];if(!I)return;const M=I.find(B=>B.id===S);if(!M)return;M.reactions||(M.reactions=[]);const N=M.reactions.find(B=>B.emoji===m);_==="added"?N?(N.count++,g&&(N.me=!0)):M.reactions.push({emoji:m,count:1,me:g}):N&&(N.count--,g&&(N.me=!1),N.count<=0&&(M.reactions=M.reactions.filter(B=>B.emoji!==m))),M.reactions.length===0&&(M.reactions=void 0)}async function d(p,S,_="text",m){const g=await Jt(p,{content:S,type:_,...m});return t.value[p]||(t.value[p]=[]),t.value[p].push(g),a.value[p]=Math.max(a.value[p]||0,g.id),g}function C(p,S){t.value[p]||(t.value[p]=[]),t.value[p].find(m=>m.id===S.id)||(t.value[p].push(S),a.value[p]=Math.max(a.value[p]||0,S.id))}async function v(p,S){try{await Qt(p,S),c(p,S)}catch(_){throw console.error("Failed to delete message",_),_}}function c(p,S){const _=t.value[p];_&&(t.value[p]=_.filter(m=>m.id!==S))}async function w(p,S,_){try{const m=await Kt(p,S,_);k(p,S,m.content,m.updated_at)}catch(m){throw console.error("Failed to edit message",m),m}}function k(p,S,_,m){const g=t.value[p];if(!g)return;const I=g.find(M=>M.id===S);I&&(I.content=_,I.is_edited=!0,m&&(I.updated_at=m))}async function f(p,S,_){try{const m=await en(p,{from_chat_id:S,message_ids:_});for(const g of m)C(p,g);return m}catch(m){throw console.error("Failed to forward messages",m),m}}function T(p){return t.value[p]||[]}return{messagesByChat:t,lastMsgId:a,loadingChat:o,loadMessages:s,loadNewer:l,loadOlder:n,sendMessage:d,pushMessage:C,getMessages:T,toggleReaction:r,applyReactionUpdate:b,deleteMessage:v,removeMessage:c,editMessage:w,applyMessageUpdate:k,forwardMessages:f}});function sn(t,a,o){if(!document.hidden||t.sender_id===o.user?.id||!Ee().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||a.chats.find(b=>b.id===t.chat_id)?.is_muted)return;const l=t.sender_display_name||t.sender_username||"Someone",n=t.message_type==="text"?t.content?.length>100?t.content.substring(0,100)+"...":t.content:`sent a ${t.message_type==="sticker"?"sticker":t.message_type==="voice"?"voice message":"file"}`,r=new Notification(l,{body:n,tag:`chat-${t.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),a.setActiveChat(t.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function an(){const t=y(!1);let a=null,o=null,i=null,s=1e3,l=!1;function n(){const f=localStorage.getItem("access_token");return f?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws?token=${encodeURIComponent(f)}`:null}function r(){if(a&&(a.readyState===WebSocket.OPEN||a.readyState===WebSocket.CONNECTING))return;const f=n();f&&(l=!1,a=new WebSocket(f),a.onopen=()=>{t.value=!0,s=1e3;const T=localStorage.getItem("access_token");T&&a.send(JSON.stringify({type:"auth",token:T}));const p=ie();for(const S of p.chats)a.send(JSON.stringify({type:"subscribe",chat_id:S.id}));d()},a.onmessage=T=>{try{const p=JSON.parse(T.data);b(p)}catch{}},a.onclose=()=>{t.value=!1,C(),l||v()},a.onerror=()=>{})}function b(f){const T=Re(),p=ie(),S=fe();switch(f.type){case"message":{const _=f;T.pushMessage(_.chat_id,_),p.updateChatLastMessage(_.chat_id,_.content||(_.message_type==="sticker"?"Sticker":"Attachment"),_.created_at),_.chat_id!==p.activeChatId&&_.sender_id!==S.user?.id&&p.incrementUnread(_.chat_id),p.clearTyping(_.chat_id,_.sender_id),sn(_,p,S);break}case"typing":{const _=f.chat_id,m=f.user_id;if(m!==S.user?.id){const g=f.username||"Someone";p.setTyping(_,m,g)}break}case"pong":break;case"presence":{const _=f.user_id,m=f.status;m==="online"?p.setUserOnline(_):m==="offline"&&p.setUserOffline(_);break}case"message_deleted":{const _=f.chat_id,m=f.message_id;T.removeMessage(_,m);break}case"message_updated":{const _=f.chat_id,m=f.message_id,g=f.content,I=f.updated_at;T.applyMessageUpdate(_,m,g,I);break}case"reaction":{const _=f.chat_id,m=f.message_id,g=f.user_id,I=f.emoji,M=f.action;T.applyReactionUpdate(_,m,M,I,g===S.user?.id);break}}}function d(){C(),i=setInterval(()=>{a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"ping"}))},25e3)}function C(){i&&(clearInterval(i),i=null)}function v(){o||(o=setTimeout(()=>{o=null,r(),s=Math.min(s*2,3e4)},s))}function c(f){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"subscribe",chat_id:f}))}function w(f){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"typing",chat_id:f}))}function k(){l=!0,C(),o&&(clearTimeout(o),o=null),a&&(a.close(),a=null),t.value=!1}return ke(()=>{k()}),{connected:t,connect:r,disconnect:k,subscribeToChat:c,sendTyping:w}}async function on(t){const{data:a}=await R.get(`/users/${t}`);return a}async function vt(t){const{data:a}=await R.get(`/users/by-username/${encodeURIComponent(t)}`);return a}async function Qe(t){const{data:a}=await R.get("/users/search",{params:{q:t}});return a}async function ln(t,a){const{data:o}=await R.put(`/users/${t}`,a);return o}async function rn(t){const{data:a}=await R.put("/users/me/avatar",{file_id:t});return a}async function cn(){const{data:t}=await R.get("/stickers");return t}const un=t=>{for(const a in t)if(a.startsWith("aria-")||a==="role"||a==="title")return!0;return!1};const Ke=t=>t==="";const dn=(...t)=>t.filter((a,o,i)=>!!a&&a.trim()!==""&&i.indexOf(a)===o).join(" ").trim();const et=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const vn=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,o,i)=>i?i.toUpperCase():o.toLowerCase());const mn=t=>{const a=vn(t);return a.charAt(0).toUpperCase()+a.slice(1)};var $e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const fn=({name:t,iconNode:a,absoluteStrokeWidth:o,"absolute-stroke-width":i,strokeWidth:s,"stroke-width":l,size:n=$e.width,color:r=$e.stroke,...b},{slots:d})=>Oe("svg",{...$e,...b,width:n,height:n,stroke:r,"stroke-width":Ke(o)||Ke(i)||o===!0||i===!0?Number(s||l||$e["stroke-width"])*24/Number(n):s||l||$e["stroke-width"],class:dn("lucide",b.class,...t?[`lucide-${et(mn(t))}-icon`,`lucide-${et(t)}`]:["lucide-icon"]),...!d.default&&!un(b)&&{"aria-hidden":"true"}},[...a.map(C=>Oe(...C)),...d.default?[d.default()]:[]]);const W=(t,a)=>(o,{slots:i,attrs:s})=>Oe(fn,{...s,...o,iconNode:a,name:t},i);const be=W("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const pn=W("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const gn=W("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const mt=W("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const hn=W("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const yn=W("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const bn=W("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const kn=W("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const wn=W("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const _n=W("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const Ve=W("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const ft=W("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const Cn=W("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const $n=W("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const xn=W("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const Mn=W("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Sn=W("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const In=W("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Tn=W("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const Dn=W("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const pt=W("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const gt=W("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const je=W("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const pe=W("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ln={class:"swipe-actions swipe-actions-left"},Un={class:"chat-item-info"},Fn={class:"chat-item-top"},En={class:"chat-item-name"},Pn={key:0,class:"pin-icon",title:"Pinned"},Nn={key:1,class:"ci-channel"},An={key:2,class:"ci-group"},zn={key:3,class:"mute-icon",title:"Muted"},On={class:"chat-item-time"},Bn={class:"chat-item-bottom"},Rn={class:"chat-item-preview"},Vn=["title"],jn={class:"swipe-actions swipe-actions-right"},tt=70,qn=j({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(t,{emit:a}){const o=t,i=ie(),s=O(()=>o.chat.type!=="direct"||!o.chat.other_user_id?null:i.isUserOnline(o.chat.other_user_id)||null),l=O(()=>(o.chat.unread_count??0)>0),n=a,r=O(()=>{const f=o.chat;return f.type==="channel"||f.type==="group"?f.title||f.name||"Untitled":f.other_display_name||f.other_username||f.title||f.name||"Chat"});function b(f){if(!f)return"";const T=new Date(f.endsWith("Z")?f:f+"Z"),p=new Date;return T.toDateString()===p.toDateString()?T.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):T.toLocaleDateString([],{month:"short",day:"numeric"})}const d=y(0);let C=0,v=!1;function c(f){C=f.touches[0].clientX,v=!0}function w(f){if(!v)return;const T=f.touches[0].clientX-C;d.value=Math.max(-tt,Math.min(tt,T))}function k(){v=!1,d.value=0}return(f,T)=>(u(),h("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:c,onTouchmove:w,onTouchend:k},[e("div",Ln,[e("button",{class:"swipe-action swipe-pin",onClick:T[0]||(T[0]=p=>n("togglePin"))},L(t.chat.is_pinned?"Unpin":"Pin"),1)]),e("div",{class:Q(["chat-item",{active:t.active,"chat-item-unread":l.value}]),style:Fe({transform:`translateX(${d.value}px)`}),onClick:T[2]||(T[2]=p=>n("select")),onContextmenu:T[3]||(T[3]=Z(p=>n("contextmenu",p),["prevent"]))},[P(oe,{name:r.value,url:t.chat.other_avatar_url,size:"sm",online:s.value},null,8,["name","url","online"]),e("div",Un,[e("div",Fn,[e("span",En,[t.chat.is_pinned?(u(),h("span",Pn,"ðŸ“Œ")):E("",!0),t.chat.type==="channel"?(u(),h("span",Nn)):t.chat.type==="group"?(u(),h("span",An)):E("",!0),ne(" "+L(r.value)+" ",1),t.chat.is_muted?(u(),h("span",zn,"ðŸ””")):E("",!0)]),e("span",On,L(b(t.chat.last_at||t.chat.updated_at)),1)]),e("div",Bn,[e("span",Rn,L(t.chat.last_message||""),1),t.chat.unread_count>0?(u(),h("span",{key:0,class:Q(["unread-badge",{"unread-badge-muted":t.chat.is_muted}])},L(t.chat.unread_count>99?"99+":t.chat.unread_count),3)):E("",!0)])]),e("button",{class:Q(["star-btn",{"star-active":t.chat.is_favorite}]),title:t.chat.is_favorite?"Unstar":"Star",onClick:T[1]||(T[1]=Z(p=>n("toggleFavorite"),["stop"]))},"â˜…",10,Vn)],38),e("div",jn,[e("button",{class:"swipe-action swipe-mute",onClick:T[4]||(T[4]=p=>n("toggleMute"))},L(t.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),K=(t,a)=>{const o=t.__vccOpts||t;for(const[i,s]of a)o[i]=s;return o},ze=K(qn,[["__scopeId","data-v-455ebfed"]]),Hn={class:"sidebar"},Wn={class:"sidebar-header"},Gn={class:"search-wrap"},Xn={class:"chat-list"},Yn={key:0,class:"empty-state-small"},Zn={key:0,class:"chat-section-label"},Jn={key:1,class:"chat-section-label"},Qn={key:2,class:"chat-section-label"},Kn=j({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(t,{emit:a}){const o=a,i=ie(),s=y(""),l=O(()=>{const c=s.value.toLowerCase(),w=i.sortedChats.filter(k=>!k.is_archived);return c?w.filter(k=>{const f=d(k).toLowerCase(),T=(k.other_username||"").toLowerCase();return f.includes(c)||T.includes(c)}):w}),n=O(()=>l.value.filter(c=>c.is_pinned&&!c.is_favorite)),r=O(()=>l.value.filter(c=>c.is_favorite&&!c.is_pinned)),b=O(()=>l.value.filter(c=>!c.is_favorite&&!c.is_pinned));function d(c){return c.type==="channel"||c.type==="group"?c.title||c.name||"Untitled":c.other_display_name||c.other_username||c.title||c.name||"Chat"}const C=y(null);Ie("contextChatId",C);function v(c,w){c.preventDefault(),C.value=w,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:c.clientX,y:c.clientY,chatId:w}}))}return(c,w)=>(u(),h("aside",Hn,[e("header",Wn,[e("button",{class:"icon-btn","aria-label":"Menu",onClick:w[0]||(w[0]=k=>o("openDrawer"))},[P(x(Cn),{size:20})]),e("div",Gn,[H(e("input",{"onUpdate:modelValue":w[1]||(w[1]=k=>s.value=k),class:"search-input",type:"search",placeholder:"Search chats..."},null,512),[[ee,s.value]])]),e("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:w[2]||(w[2]=k=>o("openNewChat"))},[P(x(Tn),{size:20})])]),e("div",Xn,[l.value.length===0?(u(),h("div",Yn,[...w[3]||(w[3]=[ne(" No conversations yet.",-1),e("br",null,null,-1),ne("Click the pencil icon to start one. ",-1)])])):(u(),h(J,{key:1},[n.value.length>0?(u(),h("div",Zn,"Pinned")):E("",!0),(u(!0),h(J,null,te(n.value,k=>(u(),V(ze,{key:k.id,chat:k,active:k.id===x(i).activeChatId,onSelect:f=>o("selectChat",k.id),onToggleFavorite:f=>x(i).toggleFavorite(k.id),onTogglePin:f=>x(i).togglePin(k.id),onToggleMute:f=>x(i).toggleMute(k.id),onToggleArchive:f=>x(i).toggleArchive(k.id),onContextmenu:f=>v(f,k.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(u(),h("div",Jn,"Starred")):E("",!0),(u(!0),h(J,null,te(r.value,k=>(u(),V(ze,{key:k.id,chat:k,active:k.id===x(i).activeChatId,onSelect:f=>o("selectChat",k.id),onToggleFavorite:f=>x(i).toggleFavorite(k.id),onTogglePin:f=>x(i).togglePin(k.id),onToggleMute:f=>x(i).toggleMute(k.id),onToggleArchive:f=>x(i).toggleArchive(k.id),onContextmenu:f=>v(f,k.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(n.value.length>0||r.value.length>0)&&b.value.length>0?(u(),h("div",Qn," All chats ")):E("",!0),(u(!0),h(J,null,te(b.value,k=>(u(),V(ze,{key:k.id,chat:k,active:k.id===x(i).activeChatId,onSelect:f=>o("selectChat",k.id),onToggleFavorite:f=>x(i).toggleFavorite(k.id),onTogglePin:f=>x(i).togglePin(k.id),onToggleMute:f=>x(i).toggleMute(k.id),onToggleArchive:f=>x(i).toggleArchive(k.id),onContextmenu:f=>v(f,k.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function es(){const t=y(!1),a=y(0);let o=null,i=[],s=null;async function l(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const C=await navigator.mediaDevices.getUserMedia({audio:!0});i=[],a.value=0,o=new MediaRecorder(C),o.ondataavailable=v=>{v.data.size&&i.push(v.data)},o.start(),t.value=!0,s=setInterval(()=>{a.value++},1e3)}function n(){return new Promise((C,v)=>{if(!o||o.state!=="recording"){v(new Error("Not recording"));return}o.onstop=()=>{o?.stream&&o.stream.getTracks().forEach(T=>T.stop()),b(),t.value=!1;const c=o?.mimeType||"audio/webm",w=c.includes("ogg")?"ogg":"webm",k=new Blob(i,{type:c}),f=new File([k],`voice.${w}`,{type:c});C(f)},o.stop()})}function r(){o&&o.state==="recording"&&(o.onstop=()=>{o?.stream&&o.stream.getTracks().forEach(C=>C.stop())},o.stop()),b(),t.value=!1,a.value=0}function b(){s&&(clearInterval(s),s=null)}function d(C){const v=Math.floor(C/60),c=C%60;return`${v}:${String(c).padStart(2,"0")}`}return{isRecording:t,seconds:a,startRecording:l,stopRecording:n,cancelRecording:r,formatTime:d}}async function qe(t){const a=new FormData;a.append("file",t);const{data:o}=await R.post("/files",a);return o}const ts={class:"chat-header"},ns={class:"chat-header-name"},ss=j({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo"],setup(t,{emit:a}){const o=a,i=ie(),s=O(()=>i.activeChat),l=O(()=>{const v=s.value;return v?v.type==="channel"||v.type==="group"?v.title||v.name||"Untitled":v.other_display_name||v.other_username||v.title||v.name||"Chat":"---"}),n=O(()=>s.value?i.getTypingUsernames(s.value.id):[]),r=O(()=>n.value.length>0),b=O(()=>{const v=s.value;return!v||v.type!=="direct"||!v.other_user_id?!1:i.isUserOnline(v.other_user_id)}),d=O(()=>{if(n.value.length===1)return`${n.value[0]} is typing...`;if(n.value.length>1)return`${n.value.length} people typing...`;const v=s.value;if(!v)return"";if(v.type==="channel"){const c=v.member_count??0;return`${c} subscriber${c!==1?"s":""}`}if(v.type==="group"){const c=v.member_count??0;return`${c} member${c!==1?"s":""}`}return b.value?"online":v.other_username?"@"+v.other_username:""});function C(){const v=s.value;v&&(v.type==="channel"||v.type==="group"?o("openChannelInfo"):v.type==="direct"&&v.other_username&&o("openUserProfile",v.other_username))}return(v,c)=>(u(),h("header",ts,[e("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:c[0]||(c[0]=w=>o("back"))},"â†"),P(oe,{class:"chat-header-avatar",name:l.value,url:s.value?.other_avatar_url,online:b.value,onClick:C},null,8,["name","url","online"]),e("div",{class:"chat-header-info",onClick:C},[e("div",ns,L(l.value),1),e("div",{class:Q(["chat-header-sub",{"typing-text":r.value,"online-text":b.value&&!r.value}])},L(d.value),3)])]))}}),as={},os={class:"admin-badge",title:"Admin"};function is(t,a){return u(),h("span",os,"âœ“")}const ht=K(as,[["render",is]]);function ls(t){const{delay:a=500,scrollThreshold:o=5,onLongPress:i,onCancel:s}=t,l=y(!1);let n=null,r=0,b=0,d=!1;function C(){n&&(clearTimeout(n),n=null)}function v(f){r=f.clientX,b=f.clientY,d=!1,l.value=!0,C(),n=setTimeout(()=>{d=!0,i(f)},a)}function c(f){if(!n)return;const T=f.clientX-r,p=f.clientY-b;(Math.abs(T)>o||Math.abs(p)>o)&&k()}function w(){C(),l.value=!1}function k(){C(),l.value=!1,d||s?.()}return{isPressed:l,onPointerDown:v,onPointerUp:w,onPointerMove:c}}const rs=["data-message-id"],cs={key:0,class:"selection-checkbox"},us=["checked"],ds={key:1,class:"msg-sender-name"},vs={class:"msg-content-wrap"},ms={class:"msg-reply-quote-name"},fs={class:"msg-reply-quote-text"},ps={key:1,class:"msg-bubble sticker-bubble"},gs=["src","alt"],hs={key:2,class:"msg-bubble"},ys={class:"voice-player"},bs=["src"],ks={key:0,class:"voice-dur"},ws=["innerHTML"],_s={key:4,class:"reaction-chips"},Cs=["onClick"],$s={class:"reaction-emoji"},xs={class:"reaction-count"},Ms={class:"msg-time"},Ss={key:0,class:"msg-edited-label"},Is=j({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(t,{emit:a}){const o=t,i=a,s=Pe(),l=ie(),n=O(()=>s.isSelected(o.message.id)),{onPointerDown:r,onPointerUp:b,onPointerMove:d}=ls({delay:500,onLongPress(M){c(M.clientX,M.clientY)}}),C={onPointerdown:r,onPointerup:b,onPointermove:d};function v(M){if(s.selectionMode){s.toggleMessage(o.message.id);return}c(M.clientX,M.clientY)}function c(M,N){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:o.message.id,chatId:l.activeChatId,text:o.message.content||"",messageType:o.message.message_type,senderId:o.message.sender_id,senderName:o.message.sender_display_name||o.message.sender_username||"",x:M,y:N}}))}function w(){s.selectionMode&&s.toggleMessage(o.message.id)}const k=xe("stickers",y([])),f=O(()=>{if(o.message.sticker_url)return o.message.sticker_url;if(o.message.sticker_id){const M=k.value.find(N=>N.id===o.message.sticker_id);if(M)return M.url}return""}),T=O(()=>o.message.attachment_url||""),p=O(()=>{const M=o.message.reply_to_type;if(M==="sticker")return"ðŸŽ¨ Sticker";if(M==="voice")return"ðŸŽ¤ Voice message";if(M==="file")return"ðŸ“Ž File";const N=o.message.reply_to_content||"";return N.length>80?N.slice(0,80)+"...":N}),S=O(()=>_(o.message.content||"").replace(/@(\w{1,30})/g,`<span class="mention" data-u="$1" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'$1'}))">@$1</span>`));function _(M){return M.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function m(M){if(!M)return"";const N=new Date(M.endsWith("Z")?M:M+"Z"),B=new Date;return N.toDateString()===B.toDateString()?N.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):N.toLocaleDateString([],{month:"short",day:"numeric"})}function g(M){const N=Math.floor(M/60),B=M%60;return`${N}:${String(B).padStart(2,"0")}`}function I(M){const N=M.target.getBoundingClientRect();i("openEmojiPicker",o.message.id,N.left,N.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(M=>{i("mentionClick",M.detail)})),(M,N)=>(u(),h("div",Lt({class:["msg-row",[t.isMine?"mine":"theirs",{selected:n.value}]],"data-message-id":t.message.id,onContextmenu:Z(v,["prevent"])},C,{onClick:w}),[x(s).selectionMode?(u(),h("div",cs,[e("input",{type:"checkbox",checked:n.value,tabindex:"-1"},null,8,us)])):E("",!0),!t.isMine&&t.message.message_type!=="sticker"?(u(),h("div",ds,[ne(L(t.message.sender_display_name||t.message.sender_username)+" ",1),t.message.sender_is_admin?(u(),V(ht,{key:0})):E("",!0)])):E("",!0),e("div",vs,[t.message.reply_to_message_id?(u(),h("div",{key:0,class:"msg-reply-quote",onClick:N[0]||(N[0]=Z(B=>i("replyClick",t.message.reply_to_message_id),["stop"]))},[N[1]||(N[1]=e("div",{class:"msg-reply-quote-bar"},null,-1)),e("div",null,[e("div",ms,L(t.message.reply_to_sender_name||t.message.reply_to_sender_username||"Unknown"),1),e("div",fs,L(p.value),1)])])):E("",!0),t.message.message_type==="sticker"?(u(),h("div",ps,[e("img",{class:"sticker-img",src:f.value,alt:t.message.sticker_label||"sticker"},null,8,gs)])):t.message.message_type==="voice"?(u(),h("div",hs,[e("div",ys,[e("audio",{controls:"",src:T.value},null,8,bs),t.message.duration_seconds?(u(),h("span",ks,L(g(t.message.duration_seconds)),1)):E("",!0)])])):(u(),h("div",{key:3,class:"msg-bubble",innerHTML:S.value},null,8,ws)),e("button",{class:"reaction-add-btn",onClick:Z(I,["stop"])},"â˜º"),t.message.reactions&&t.message.reactions.length?(u(),h("div",_s,[(u(!0),h(J,null,te(t.message.reactions,B=>(u(),h("button",{key:B.emoji,class:Q(["reaction-chip",{"reaction-mine":B.me}]),onClick:Z(ae=>i("toggleReaction",t.message.id,B.emoji),["stop"])},[e("span",$s,L(B.emoji),1),e("span",xs,L(B.count),1)],10,Cs))),128)),e("button",{class:"reaction-chip reaction-add-chip",onClick:Z(I,["stop"])},"+")])):E("",!0)]),e("div",Ms,[t.message.is_edited?(u(),h("span",Ss,"(edited)")):E("",!0),ne(" "+L(m(t.message.created_at)),1)])],16,rs))}}),Ts={class:"composer-wrapper"},Ds={key:0,class:"reply-preview"},Ls={class:"reply-preview-content"},Us={class:"reply-preview-sender"},Fs={class:"reply-preview-text"},Es={key:1,class:"reply-preview edit-preview"},Ps={class:"reply-preview-content"},Ns={class:"reply-preview-text"},As={class:"composer"},zs=["onKeydown"],Os=j({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(t,{expose:a,emit:o}){const i=t,s=o,l=y(""),n=y(null),r=y(null),b=y(null);let d=0;function C(){const S=l.value.trim();S&&(b.value?(s("editMessage",b.value.messageId,S),b.value=null):r.value?(s("send",S,{...r.value}),r.value=null):s("send",S),l.value="",p())}function v(){r.value=null,n.value?.focus()}function c(){b.value=null,l.value="",p(),n.value?.focus()}function w(){r.value?v():b.value&&c()}function k(S){const _=S.detail;_&&(b.value=null,r.value={messageId:_.messageId,senderName:_.senderName||"Unknown",snippet:(_.text||"").slice(0,100)},ce(()=>n.value?.focus()))}function f(S){const _=S.detail;_&&(r.value=null,b.value={messageId:_.messageId,snippet:(_.text||"").slice(0,100),fullText:_.text||""},l.value=b.value.fullText,ce(()=>{p(),n.value?.focus()}))}function T(){p();const S=Date.now();S-d>2e3&&l.value.trim().length>0&&(d=S,s("typing"))}function p(){const S=n.value;S&&(S.style.height="auto",S.style.height=Math.min(S.scrollHeight,120)+"px")}return se(()=>{n.value?.focus(),window.addEventListener("reply-to-message",k),window.addEventListener("edit-message",f)}),ke(()=>{window.removeEventListener("reply-to-message",k),window.removeEventListener("edit-message",f)}),ye(()=>i.replyTo,S=>{S&&n.value?.focus()}),a({focus:()=>n.value?.focus()}),(S,_)=>(u(),h("div",Ts,[r.value?(u(),h("div",Ds,[_[3]||(_[3]=e("div",{class:"reply-preview-bar"},null,-1)),e("div",Ls,[e("span",Us,L(r.value.senderName),1),e("span",Fs,L(r.value.snippet),1)]),e("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:v},"âœ•")])):E("",!0),b.value?(u(),h("div",Es,[_[5]||(_[5]=e("div",{class:"reply-preview-bar edit-bar"},null,-1)),e("div",Ps,[_[4]||(_[4]=e("span",{class:"reply-preview-sender"},"Editing message",-1)),e("span",Ns,L(b.value.snippet),1)]),e("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:c},"âœ•")])):E("",!0),e("div",As,[e("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:_[0]||(_[0]=m=>s("toggleStickers"))},"ðŸŒ"),H(e("textarea",{ref_key:"inputRef",ref:n,"onUpdate:modelValue":_[1]||(_[1]=m=>l.value=m),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[Ze(Z(C,["exact","prevent"]),["enter"]),Ze(w,["escape"])],onInput:T},null,40,zs),[[ee,l.value]]),e("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:_[2]||(_[2]=m=>s("startRecording"))},"ðŸŽ¤"),e("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:C},"âž¤")])]))}}),Bs=K(Os,[["__scopeId","data-v-df4ad9ba"]]),Rs={class:"sticker-grid"},Vs=["title","onClick"],js=["src","alt"],qs={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Hs=j({__name:"StickerPicker",emits:["select"],setup(t,{emit:a}){const o=a,i=xe("stickers",y([])),s=O(()=>i.value);return(l,n)=>(u(),h("div",Rs,[(u(!0),h(J,null,te(s.value,r=>(u(),h("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:b=>o("select",r.id)},[e("img",{src:r.url,alt:r.label},null,8,js)],8,Vs))),128)),s.value.length===0?(u(),h("div",qs," No stickers available ")):E("",!0)]))}}),Ws={},Gs={class:"msgs-loading"};function Xs(t,a){return u(),h("div",Gs,"Loading...")}const Ys=K(Ws,[["render",Xs]]),Zs={class:"invite-manage",style:{padding:"0 1rem .5rem"}},Js={class:"invite-link-wrap"},Qs=["value"],Ks=j({__name:"InviteSection",props:{chatId:{}},setup(t){const a=t,{showToast:o}=le(),i=y("Loading..."),s=y("");async function l(){try{const b=await rt(a.chatId);if(b.length>0){const d=b[0];s.value=d.token,i.value=`${window.location.origin}/join/${d.token}`}else{const d=await ct(a.chatId);s.value=d.token,i.value=`${window.location.origin}/join/${d.token}`}}catch{i.value="Failed to generate invite"}}function n(){i.value&&navigator.clipboard&&navigator.clipboard.writeText(i.value).then(()=>o("Link copied!"))}async function r(){if(s.value)try{await ut(s.value),o("Invite revoked"),await l()}catch{o("Failed to revoke invite")}}return se(l),(b,d)=>(u(),h("div",Zs,[d[0]||(d[0]=e("div",{class:"invite-manage-title"},"Invite Link",-1)),e("div",Js,[e("input",{class:"form-input invite-link-input",value:i.value,type:"text",readonly:""},null,8,Qs),e("button",{class:"btn btn-sm btn-outline",title:"Copy link",onClick:n}," ðŸ“‹ ")]),e("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:r}," Revoke link ")]))}}),ea=["onClick"],ta=j({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(t,{emit:a}){const o=a,i=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸŽ‰","ðŸ‘","ðŸ¤”","ðŸ˜","ðŸ˜¡","ðŸ‘Ž","ðŸ‘€","ðŸš€","âœ…","âŒ","ðŸ’¯","ðŸŒŸ","ðŸ˜Š","ðŸ¤¯","ðŸ¥³","ðŸ¥²","ðŸ¤—"];return(s,l)=>t.visible?(u(),h("div",{key:0,class:"emoji-picker",style:Fe({left:t.x+"px",top:t.y+"px"}),onClick:l[0]||(l[0]=Z(()=>{},["stop"]))},[(u(),h(J,null,te(i,n=>e("button",{key:n,class:"emoji-pick-btn",onClick:r=>o("select",n)},L(n),9,ea)),64))],4)):E("",!0)}}),na=j({__name:"MessageContextMenu",setup(t){const{showToast:a}=le(),o=fe(),i=y(!1),s=y(0),l=y(0),n=y(null),r=y(null),b=y(""),d=y(""),C=y(""),v=y(null),c=O(()=>!v.value||!o.user?!1:v.value===o.user.id),w=O(()=>!r.value||!n.value?null:`${window.location.origin}/c/${r.value}/${n.value}`);function k(N){n.value=N.detail.messageId,r.value=N.detail.chatId,b.value=N.detail.text||"",d.value=N.detail.messageType||"text",C.value=N.detail.senderName||"",v.value=N.detail.senderId??null,s.value=N.detail.x,l.value=N.detail.y,i.value=!0,requestAnimationFrame(()=>{const B=document.querySelector(".msg-context-menu");if(!B)return;const ae=B.getBoundingClientRect();ae.right>window.innerWidth&&(s.value=window.innerWidth-ae.width-8),ae.bottom>window.innerHeight&&(l.value=window.innerHeight-ae.height-8)})}function f(){i.value&&(i.value=!1,n.value=null,r.value=null,b.value="",d.value="",C.value="",v.value=null)}se(()=>{window.addEventListener("show-message-context-menu",k),document.addEventListener("click",f)}),ke(()=>{window.removeEventListener("show-message-context-menu",k),document.removeEventListener("click",f)});function T(){i.value=!1}function p(){T(),!(!n.value||!r.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:n.value,chatId:r.value,senderName:C.value,text:b.value}}))}function S(){T(),!(!n.value||!r.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:n.value,chatId:r.value,text:b.value}}))}async function _(){T();try{await navigator.clipboard.writeText(b.value),a("Copied to clipboard")}catch{a("Failed to copy text")}}async function m(){if(T(),!!w.value)try{await navigator.clipboard.writeText(w.value),a("Link copied")}catch{a("Failed to copy link")}}function g(){T(),!(!n.value||!r.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[n.value],chatId:r.value}}))}function I(){T(),!(!n.value||!r.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:n.value,chatId:r.value}}))}function M(){T(),!(!n.value||!r.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:n.value,chatId:r.value}}))}return(N,B)=>(u(),V(st,{to:"body"},[i.value?(u(),h("div",{key:0,class:"msg-context-menu",style:Fe({left:s.value+"px",top:l.value+"px"}),onClick:B[0]||(B[0]=Z(()=>{},["stop"])),onContextmenu:B[1]||(B[1]=Z(()=>{},["prevent"]))},[e("button",{class:"ctx-item",onClick:p}," Reply "),c.value&&d.value==="text"?(u(),h("button",{key:0,class:"ctx-item",onClick:S}," Edit ")):E("",!0),B[2]||(B[2]=e("button",{class:"ctx-item",disabled:"","aria-label":"Coming soon â€” requires V14 migration"}," Pin ",-1)),e("button",{class:"ctx-item",onClick:_}," Copy text "),w.value?(u(),h("button",{key:1,class:"ctx-item",onClick:m}," Copy link ")):E("",!0),e("button",{class:"ctx-item",onClick:g}," Forward "),e("button",{class:"ctx-item",onClick:I}," Select "),e("button",{class:"ctx-item ctx-delete",onClick:M}," Delete ")],36)):E("",!0)]))}}),sa=K(na,[["__scopeId","data-v-4a1c2352"]]),aa={key:0,class:"selection-bar"},oa={class:"selection-bar-count"},ia={class:"selection-bar-actions"},la=["disabled"],ra=["disabled"],ca=j({__name:"SelectionBar",emits:["forward","delete"],setup(t,{emit:a}){const o=a,i=Pe();return(s,l)=>(u(),V(at,{name:"slide-down"},{default:Be(()=>[x(i).selectionMode?(u(),h("div",aa,[e("button",{class:"selection-bar-btn cancel-btn",onClick:l[0]||(l[0]=n=>x(i).exitSelectionMode())}," Cancel "),e("span",oa,L(x(i).selectedCount)+" selected",1),e("div",ia,[e("button",{class:"selection-bar-btn forward-btn",disabled:x(i).selectedCount===0,onClick:l[1]||(l[1]=n=>o("forward"))}," Forward ("+L(x(i).selectedCount)+") ",9,la),e("button",{class:"selection-bar-btn delete-btn",disabled:x(i).selectedCount===0,onClick:l[2]||(l[2]=n=>o("delete"))}," Delete ("+L(x(i).selectedCount)+") ",9,ra)])])):E("",!0)]),_:1}))}}),ua=K(ca,[["__scopeId","data-v-9ba988f2"]]),da=j({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(t,{emit:a}){const o=a;function i(){o("close")}return(s,l)=>(u(),V(st,{to:"body"},[P(at,{name:"bottom-sheet"},{default:Be(()=>[t.visible?(u(),h("div",{key:0,class:"bottom-sheet-backdrop",onClick:Z(i,["self"])},[e("div",{class:"bottom-sheet",onClick:l[0]||(l[0]=Z(()=>{},["stop"]))},[l[1]||(l[1]=e("div",{class:"bottom-sheet-handle"},null,-1)),ot(s.$slots,"default",{},void 0,!0)])])):E("",!0)]),_:3})]))}}),va=K(da,[["__scopeId","data-v-2c2a0a15"]]),ma={class:"modal"},fa={class:"modal-header"},pa={class:"modal-body"},ga={class:"forward-chat-list"},ha={key:0,class:"empty-state-small"},ya=["onClick"],ba={class:"forward-chat-info"},ka={class:"forward-chat-name"},wa={class:"forward-chat-type"},_a={key:0,class:"forward-check"},Ca={class:"modal-actions"},$a=["disabled"],xa=j({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(t,{emit:a}){const o=t,i=a,s=ie(),l=Re(),{showToast:n}=le(),r=y(""),b=y(null),d=y(!1),C=O(()=>{const f=r.value.toLowerCase().trim(),T=s.sortedChats;return f?T.filter(p=>v(p).toLowerCase().includes(f)):T});function v(f){return f.type==="direct"?f.other_display_name||f.other_username||f.title||"Direct Chat":f.title||f.name||"Unnamed Chat"}function c(f){if(f.type==="direct")return f.other_avatar_url??void 0}function w(){}async function k(){if(b.value!==null){d.value=!0;try{await l.forwardMessages(b.value,o.fromChatId,o.messageIds),n("Message forwarded!"),i("forwarded",b.value)}catch{n("Failed to forward message")}finally{d.value=!1}}}return(f,T)=>(u(),h("div",{class:"modal-backdrop",onClick:T[2]||(T[2]=Z(p=>i("close"),["self"]))},[e("div",ma,[e("div",fa,[T[3]||(T[3]=e("h2",{class:"modal-title"},"Forward Message",-1)),e("button",{class:"icon-btn",onClick:T[0]||(T[0]=p=>i("close"))},"âœ•")]),e("div",pa,[H(e("input",{"onUpdate:modelValue":T[1]||(T[1]=p=>r.value=p),class:"search-input",type:"search",placeholder:"Search chats...",onInput:w},null,544),[[ee,r.value]]),e("div",ga,[C.value.length===0?(u(),h("div",ha,"No chats found.")):E("",!0),(u(!0),h(J,null,te(C.value,p=>(u(),h("div",{key:p.id,class:Q(["forward-chat-item",{selected:b.value===p.id}]),onClick:S=>b.value=p.id},[P(oe,{name:v(p),url:c(p),size:"sm"},null,8,["name","url"]),e("div",ba,[e("div",ka,L(v(p)),1),e("div",wa,L(p.type),1)]),b.value===p.id?(u(),h("span",_a,"âœ“")):E("",!0)],10,ya))),128))]),e("div",Ca,[e("button",{class:"btn btn-primary",disabled:b.value===null||d.value,onClick:k},L(d.value?"Forwarding...":"Forward"),9,$a)])])])]))}}),Ma=K(xa,[["__scopeId","data-v-ce3f4600"]]),Sa={class:"modal modal-sm"},Ia={class:"modal-header"},Ta={class:"modal-body"},Da={class:"delete-confirm-text"},La={key:0,class:"delete-checkbox-label"},Ua={class:"modal-actions"},Fa=j({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:a}){const o=a,i=y(!1);function s(){o("confirm",i.value)}return(l,n)=>(u(),h("div",{class:"modal-backdrop",onClick:n[3]||(n[3]=Z(r=>o("close"),["self"]))},[e("div",Sa,[e("div",Ia,[n[4]||(n[4]=e("h2",{class:"modal-title"},"Delete Message",-1)),e("button",{class:"icon-btn",onClick:n[0]||(n[0]=r=>o("close"))},"âœ•")]),e("div",Ta,[e("p",Da," Are you sure you want to delete "+L(t.messageCount>1?`these ${t.messageCount} messages`:"this message")+"? ",1),t.canDeleteForEveryone?(u(),h("label",La,[H(e("input",{"onUpdate:modelValue":n[1]||(n[1]=r=>i.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[it,i.value]]),n[5]||(n[5]=ne(" Delete for everyone ",-1))])):E("",!0)]),e("div",Ua,[e("button",{class:"btn btn-ghost",onClick:n[2]||(n[2]=r=>o("close"))},"Cancel"),e("button",{class:"btn btn-danger",onClick:s},"Delete")])])]))}}),Ea=K(Fa,[["__scopeId","data-v-388dbae2"]]),Me=_e("channel",()=>{const t=y(null),a=y([]),o=y(!1),i=O(()=>a.value.length),s=O(()=>a.value.filter(v=>v.role==="admin"||v.role==="owner").length),l=O(()=>{const v=fe();return v.user?a.value.find(w=>w.id===v.user.id)?.role??null:null}),n=O(()=>l.value==="owner"),r=O(()=>l.value==="admin"||l.value==="owner");async function b(v){o.value=!0;try{t.value=await dt(v)}catch(c){console.error("Failed to load channel detail",c)}finally{o.value=!1}}async function d(v){try{a.value=await Wt(v)}catch(c){console.error("Failed to load channel members",c)}}async function C(v,c){try{t.value=await Xt(v,c)}catch(w){throw console.error("Failed to update channel",w),w}}return{detail:t,members:a,loading:o,memberCount:i,adminCount:s,myRole:l,isOwner:n,isAdmin:r,loadDetail:b,loadMembers:d,updateChannel:C}}),Pa=_e("invites",()=>{const t=y([]),a=y(!1);async function o(l){a.value=!0;try{t.value=await rt(l)}catch(n){console.error("Failed to load invites",n)}finally{a.value=!1}}async function i(l){try{const n=await ct(l);return t.value.push(n),n}catch(n){throw console.error("Failed to create invite",n),n}}async function s(l){const n=[...t.value];t.value=t.value.filter(r=>r.token!==l);try{await ut(l)}catch(r){throw console.error("Failed to revoke invite",r),t.value=n,r}}return{invites:t,loading:a,loadInvites:o,createInvite:i,revokeInvite:s}}),Na={class:"invite-links-view"},Aa={class:"view-header"},za={style:{padding:"0 1rem .5rem"}},Oa=["disabled"],Ba={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},Ra={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},Va={key:2,class:"invite-list",style:{padding:"0 1rem"}},ja={class:"invite-item-info"},qa={class:"invite-token"},Ha={class:"invite-date"},Wa={class:"invite-item-actions"},Ga=["onClick"],Xa=["onClick"],Ya=j({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(t,{emit:a}){const o=t,i=a,s=Pa(),{showToast:l}=le(),n=y(!1);function r(v){return new Date(v).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function b(v){const c=`${window.location.origin}/join/${v}`;navigator.clipboard&&navigator.clipboard.writeText(c).then(()=>l("Link copied!"))}async function d(){n.value=!0;try{await s.createInvite(o.chatId),l("Invite link created")}catch{l("Failed to create invite")}finally{n.value=!1}}async function C(v){try{await s.revokeInvite(v),l("Invite revoked")}catch{l("Failed to revoke invite")}}return se(()=>s.loadInvites(o.chatId)),(v,c)=>(u(),h("div",Na,[e("div",Aa,[e("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=w=>i("back"))},[P(x(be),{size:20,"stroke-width":2})]),c[1]||(c[1]=e("span",{class:"view-title"},"Invite Links",-1))]),e("div",za,[e("button",{class:"btn btn-sm btn-outline",onClick:d,disabled:n.value},L(n.value?"Creating...":"Create Invite Link"),9,Oa)]),x(s).loading?(u(),h("div",Ba," Loading... ")):x(s).invites.length===0?(u(),h("div",Ra," No active invite links ")):(u(),h("div",Va,[(u(!0),h(J,null,te(x(s).invites,w=>(u(),h("div",{key:w.id,class:"invite-item"},[e("div",ja,[e("code",qa,L(w.token),1),e("span",Ha,L(r(w.created_at)),1)]),e("div",Wa,[e("button",{class:"icon-btn",title:"Copy link",onClick:k=>b(w.token)},[P(x(bn),{size:16,"stroke-width":2})],8,Ga),e("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:k=>C(w.token)}," Revoke ",8,Xa)])]))),128))]))]))}}),Za=K(Ya,[["__scopeId","data-v-97b82dd0"]]),Ja={class:"admins-view"},Qa={class:"view-header"},Ka={key:0,class:"member-empty"},eo={key:1,class:"member-list"},to={class:"member-info"},no={class:"member-name"},so=j({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(t,{emit:a}){const o=a,i=Me(),s=O(()=>i.members.filter(l=>l.role==="admin"||l.role==="owner"));return(l,n)=>(u(),h("div",Ja,[e("div",Qa,[e("button",{class:"icon-btn","aria-label":"Back",onClick:n[0]||(n[0]=r=>o("back"))},[P(x(be),{size:20,"stroke-width":2})]),n[1]||(n[1]=e("span",{class:"view-title"},"Administrators",-1))]),s.value.length===0?(u(),h("div",Ka," No administrators found ")):(u(),h("div",eo,[(u(!0),h(J,null,te(s.value,r=>(u(),h("div",{key:r.id,class:"member-item"},[P(oe,{name:r.display_name||r.username,url:r.avatar_url,size:"md"},null,8,["name","url"]),e("div",to,[e("span",no,L(r.display_name||r.username),1),e("span",{class:Q(["role-badge",`role-badge--${r.role}`])},L(r.role),3)])]))),128))]))]))}}),ao=K(so,[["__scopeId","data-v-8b39733e"]]),oo={class:"subscribers-view"},io={class:"view-header"},lo={class:"search-bar"},ro={key:0,class:"member-empty"},co={key:1,class:"member-list"},uo={class:"member-info"},vo={class:"member-name"},mo=j({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(t,{emit:a}){const o=a,i=Me(),s=y(""),l=O(()=>{const n=s.value.toLowerCase().trim();return n?i.members.filter(r=>r.username.toLowerCase().includes(n)||r.display_name&&r.display_name.toLowerCase().includes(n)):i.members});return(n,r)=>(u(),h("div",oo,[e("div",io,[e("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=b=>o("back"))},[P(x(be),{size:20,"stroke-width":2})]),r[2]||(r[2]=e("span",{class:"view-title"},"Subscribers",-1))]),e("div",lo,[H(e("input",{"onUpdate:modelValue":r[1]||(r[1]=b=>s.value=b),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ee,s.value]])]),l.value.length===0?(u(),h("div",ro,L(s.value?"No members found":"No subscribers"),1)):(u(),h("div",co,[(u(!0),h(J,null,te(l.value,b=>(u(),h("div",{key:b.id,class:"member-item"},[P(oe,{name:b.display_name||b.username,url:b.avatar_url,size:"md"},null,8,["name","url"]),e("div",uo,[e("span",vo,L(b.display_name||b.username),1),e("span",{class:Q(["role-badge",`role-badge--${b.role}`])},L(b.role),3)])]))),128))]))]))}}),fo=K(mo,[["__scopeId","data-v-f99a8a5f"]]);async function po(t,a){await R.post(`/chats/${t}/avatar`,{file_id:a})}const go={class:"modal profile-modal"},ho={class:"profile-modal-body profile-modal-body--scrollable"},yo={class:"profile-avatar-section profile-avatar-upload-section"},bo={class:"profile-avatar-overlay"},ko={class:"profile-info-list"},wo={class:"form-group"},_o={class:"form-group"},Co={class:"profile-edit-actions"},$o=["disabled"],xo=j({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(t,{emit:a}){const o=t,i=a,s=Me(),{showToast:l}=le(),n=y(""),r=y(""),b=y(void 0),d=y(!1),C=y(null);se(()=>{s.detail&&(n.value=s.detail.title||"",r.value=s.detail.description||"",b.value=s.detail.avatar_url??void 0)});async function v(){const w=C.value?.files?.[0];if(w){try{const k=await qe(w);await po(o.chatId,k.id),b.value=URL.createObjectURL(w),l("Avatar updated!")}catch{l("Avatar upload failed")}C.value&&(C.value.value="")}}async function c(){if(!n.value.trim()){l("Channel name is required");return}d.value=!0;try{await s.updateChannel(o.chatId,{title:n.value.trim(),description:r.value.trim()}),l("Channel updated!"),i("saved"),i("close")}catch{l("Failed to update channel")}finally{d.value=!1}}return(w,k)=>(u(),h("div",{class:"modal-backdrop profile-backdrop",onClick:k[5]||(k[5]=Z(f=>i("close"),["self"]))},[e("div",go,[e("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:k[0]||(k[0]=f=>i("close"))},[P(x(pe),{size:20,"stroke-width":2})]),e("div",ho,[e("div",yo,[e("div",{class:"profile-avatar-upload-wrap",onClick:k[1]||(k[1]=f=>C.value?.click())},[P(oe,{name:n.value||"Channel",url:b.value,size:"xxl"},null,8,["name","url"]),e("div",bo,[P(x(mt),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),e("input",{ref_key:"fileInput",ref:C,type:"file",accept:"image/*",class:"hidden",onChange:v},null,544)]),e("div",ko,[e("div",wo,[k[6]||(k[6]=e("label",{class:"form-label"},"Channel name",-1)),H(e("input",{"onUpdate:modelValue":k[2]||(k[2]=f=>n.value=f),class:"form-input",type:"text",maxlength:"128",placeholder:"Channel name"},null,512),[[ee,n.value]])]),e("div",_o,[k[7]||(k[7]=e("label",{class:"form-label"},"Description",-1)),H(e("textarea",{"onUpdate:modelValue":k[3]||(k[3]=f=>r.value=f),class:"form-input",maxlength:"500",rows:"4",placeholder:"Channel description..."},null,512),[[ee,r.value]])])]),e("div",Co,[e("button",{class:"btn btn-primary",disabled:d.value,onClick:c},L(d.value?"Saving...":"Save"),9,$o),e("button",{class:"btn btn-ghost",onClick:k[4]||(k[4]=f=>i("close"))},"Cancel")])])])]))}}),Mo={class:"danger-zone"},So={class:"view-header"},Io={class:"danger-zone-body"},To={class:"modal modal-sm"},Do={class:"modal-header"},Lo={class:"modal-actions"},Uo=["disabled"],Fo=j({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(t,{emit:a}){const o=t,i=a,s=ie(),l=Me(),{showToast:n}=le(),r=y(!1),b=y(!1);async function d(){try{await s.leave(o.chatId),i("left")}catch{n("Failed to leave channel")}}async function C(){b.value=!0;try{await Gt(o.chatId),s.chats=s.chats.filter(v=>v.id!==o.chatId),s.activeChatId===o.chatId&&s.setActiveChat(null),r.value=!1,i("deleted")}catch{n("Failed to delete channel")}finally{b.value=!1}}return(v,c)=>(u(),h("div",Mo,[e("div",So,[e("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=w=>i("back"))},[P(x(be),{size:20,"stroke-width":2})]),c[5]||(c[5]=e("span",{class:"view-title"},"Danger Zone",-1))]),e("div",Io,[e("button",{class:"btn btn-danger-outline",onClick:d},[P(x(Ve),{size:18,"stroke-width":1.8}),c[6]||(c[6]=ne(" Leave Channel ",-1))]),x(l).isOwner?(u(),h("button",{key:0,class:"btn btn-danger",onClick:c[1]||(c[1]=w=>r.value=!0)},[P(x(pt),{size:18,"stroke-width":1.8}),c[7]||(c[7]=ne(" Delete Channel ",-1))])):E("",!0)]),r.value?(u(),h("div",{key:0,class:"modal-backdrop",onClick:c[4]||(c[4]=Z(w=>r.value=!1,["self"]))},[e("div",To,[e("div",Do,[c[8]||(c[8]=e("h2",{class:"modal-title"},"Delete Channel",-1)),e("button",{class:"icon-btn","aria-label":"Close",onClick:c[2]||(c[2]=w=>r.value=!1)},[P(x(pe),{size:20,"stroke-width":2})])]),c[9]||(c[9]=e("div",{class:"modal-body"},[e("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),e("div",Lo,[e("button",{class:"btn btn-ghost",onClick:c[3]||(c[3]=w=>r.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",disabled:b.value,onClick:C},L(b.value?"Deleting...":"Delete"),9,Uo)])])])):E("",!0)]))}}),Eo=K(Fo,[["__scopeId","data-v-997b5e56"]]),Po={class:"modal profile-modal"},No={class:"profile-modal-body"},Ao={key:5,class:"profile-loading"},zo={class:"profile-avatar-section"},Oo={class:"profile-name"},Bo={class:"profile-status"},Ro={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},Vo={class:"profile-info-item"},jo={class:"profile-info-value"},qo={class:"channel-info-menu"},Ho={class:"channel-info-menu-count"},Wo={class:"channel-info-menu-count"},Go={key:7,class:"profile-loading"},Xo=j({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(t,{emit:a}){const o=t,i=a,s=Me(),l=y("main"),n=O(()=>Number(o.chatId));function r(){l.value="main",s.loadDetail(n.value)}return se(async()=>{await Promise.all([s.loadDetail(n.value),s.loadMembers(n.value)])}),(b,d)=>(u(),h("div",{class:"modal-backdrop profile-backdrop",onClick:d[14]||(d[14]=Z(C=>i("close"),["self"]))},[e("div",Po,[e("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:d[0]||(d[0]=C=>i("close"))},[P(x(pe),{size:20,"stroke-width":2})]),e("div",No,[l.value==="invites"?(u(),V(Za,{key:0,"chat-id":n.value,onBack:d[1]||(d[1]=C=>l.value="main")},null,8,["chat-id"])):l.value==="admins"?(u(),V(ao,{key:1,"chat-id":n.value,onBack:d[2]||(d[2]=C=>l.value="main")},null,8,["chat-id"])):l.value==="subscribers"?(u(),V(fo,{key:2,"chat-id":n.value,onBack:d[3]||(d[3]=C=>l.value="main")},null,8,["chat-id"])):l.value==="edit"?(u(),V(xo,{key:3,"chat-id":n.value,onClose:d[4]||(d[4]=C=>l.value="main"),onSaved:r},null,8,["chat-id"])):l.value==="danger"?(u(),V(Eo,{key:4,"chat-id":n.value,onBack:d[5]||(d[5]=C=>l.value="main"),onLeft:d[6]||(d[6]=C=>i("close")),onDeleted:d[7]||(d[7]=C=>i("close"))},null,8,["chat-id"])):x(s).loading?(u(),h("div",Ao,[...d[15]||(d[15]=[e("p",null,"Loading...",-1)])])):x(s).detail?(u(),h(J,{key:6},[e("div",zo,[P(oe,{name:x(s).detail.title||"Channel",url:x(s).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),e("div",Oo,L(x(s).detail.title),1),e("div",Bo,L(x(s).memberCount)+" "+L(x(s).memberCount===1?"subscriber":"subscribers"),1),x(s).detail.description?(u(),h("div",Ro,[e("div",Vo,[d[16]||(d[16]=e("div",{class:"profile-info-label"},"Description",-1)),e("div",jo,L(x(s).detail.description),1)])])):E("",!0),d[23]||(d[23]=e("div",{class:"profile-divider"},null,-1)),e("div",qo,[e("button",{class:"channel-info-menu-item",onClick:d[8]||(d[8]=C=>l.value="invites")},[P(x(_n),{size:20,"stroke-width":1.8}),d[17]||(d[17]=e("span",null,"Invite Links",-1))]),e("button",{class:"channel-info-menu-item",onClick:d[9]||(d[9]=C=>l.value="admins")},[P(x(In),{size:20,"stroke-width":1.8}),d[18]||(d[18]=e("span",null,"Administrators",-1)),e("span",Ho,L(x(s).adminCount),1)]),e("button",{class:"channel-info-menu-item",onClick:d[10]||(d[10]=C=>l.value="subscribers")},[P(x(je),{size:20,"stroke-width":1.8}),d[19]||(d[19]=e("span",null,"Subscribers",-1)),e("span",Wo,L(x(s).memberCount),1)]),x(s).isOwner||x(s).isAdmin?(u(),h("button",{key:0,class:"channel-info-menu-item",onClick:d[11]||(d[11]=C=>l.value="edit")},[P(x(Mn),{size:20,"stroke-width":1.8}),d[20]||(d[20]=e("span",null,"Edit Channel",-1))])):E("",!0),e("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:d[12]||(d[12]=C=>l.value="danger")},[P(x(Ve),{size:20,"stroke-width":1.8}),d[21]||(d[21]=e("span",null,"Leave Channel",-1))]),x(s).isOwner?(u(),h("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:d[13]||(d[13]=C=>l.value="danger")},[P(x(pt),{size:20,"stroke-width":1.8}),d[22]||(d[22]=e("span",null,"Delete Channel",-1))])):E("",!0)])],64)):(u(),h("div",Go,[...d[24]||(d[24]=[e("p",null,"Channel not found",-1)])]))])])]))}}),Yo=K(Xo,[["__scopeId","data-v-9c7df294"]]),Zo={class:"chat-panel"},Jo={key:0,class:"empty-chat"},Qo={key:1,class:"chat-view"},Ko={key:0,class:"channel-readonly-bar"},ei={key:0,class:"date-sep"},ti={key:1,class:"sticker-picker"},ni={key:3,class:"recording-bar"},si={class:"rec-time"},ai=j({__name:"ChatPanel",emits:["back","openUserProfile"],setup(t,{emit:a}){const o=a,i=fe(),s=ie(),l=Re(),{showToast:n}=le(),r=es(),b=xe("stickers",y([])),d=xe("sendTyping",()=>{}),C=xe("pendingScrollMessageId",y(null)),v=y(null),c=y(!1),w=y(!1),k=y("member"),f=y(!1),T=y(!1),p=y(!1),S=y(0),_=y(0),m=y(null),g=Pe(),I=y(!1),M=y(null),N=y(""),B=O(()=>!M.value||!i.user?!1:ve.value.find($=>$.id===M.value)?.sender_id===i.user.id),ae=O(()=>B.value?ve.value.find($=>$.id===M.value)?.message_type==="text":!1),ue=y(!1),de=y([]),X=y(!1),D=y([]),A=y(!1),ge=y(null);let we=null;const Se=O(()=>s.activeChat?.type==="channel"&&k.value==="member"),ve=O(()=>s.activeChatId?l.getMessages(s.activeChatId):[]),q=O(()=>{const U=[];let $="";for(const F of ve.value){const G=z(F.created_at);G!==$&&(U.push({type:"date",label:G}),$=G),U.push({type:"msg",msg:F})}return U});function z(U){if(!U)return"";const $=new Date(U.endsWith("Z")?U:U+"Z"),F=new Date;if($.toDateString()===F.toDateString())return"Today";const G=new Date(F);return G.setDate(F.getDate()-1),$.toDateString()===G.toDateString()?"Yesterday":$.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}ye(()=>s.activeChatId,async U=>{if(c.value=!1,k.value="member",f.value=!1,we&&(clearInterval(we),we=null),!U)return;await l.loadMessages(U),await ce(),Y();const $=s.activeChat;if($&&($.type==="channel"||$.type==="group"))try{const F=await dt(U);k.value=F.my_role||"member",f.value=k.value==="owner"||k.value==="admin"}catch{}we=setInterval(()=>{s.activeChatId===U&&l.loadNewer(U).then(F=>{F.length>0&&re()})},2500)});function Y(){v.value&&(v.value.scrollTop=v.value.scrollHeight)}function re(){if(!v.value)return;const U=v.value;U.scrollHeight-U.scrollTop-U.clientHeight<80&&ce(()=>{U.scrollTop=U.scrollHeight})}function Ce(){s.activeChatId&&d(s.activeChatId)}async function yt(U,$){if(!(!s.activeChatId||!U.trim())){ge.value=null;try{const F=$?{reply_to_message_id:$.messageId}:void 0,G=await l.sendMessage(s.activeChatId,U.trim(),"text",F);i.user&&(G.sender_id=i.user.id,G.sender_username=i.user.username,G.sender_display_name=i.user.display_name),await ce(),Y(),s.loadChats()}catch{n("Failed to send message")}}}async function bt(U,$){if(!(!s.activeChatId||!$.trim()))try{await l.editMessage(s.activeChatId,U,$.trim())}catch{n("Failed to edit message")}}async function kt(U){if(s.activeChatId){c.value=!1;try{const $=await l.sendMessage(s.activeChatId,"","sticker",{sticker_id:U}),F=b.value.find(G=>G.id===U);F&&($.sticker_url=F.url,$.sticker_label=F.label),await ce(),Y(),s.loadChats()}catch{n("Failed to send sticker")}}}function wt(U,$,F){m.value=U,S.value=$,_.value=F,p.value=!0}function _t(U){m.value&&s.activeChatId&&l.toggleReaction(s.activeChatId,m.value,U),p.value=!1,m.value=null}function Ct(U,$){s.activeChatId&&l.toggleReaction(s.activeChatId,U,$)}function $t(){p.value=!1,m.value=null}async function xt(){try{await r.startRecording(),w.value=!0;const U=await r.stopRecording();w.value=!1,await Dt(U)}catch{w.value=!1,n("Microphone access denied")}}function Mt(){r.cancelRecording(),w.value=!1}function He(U){const{messageIds:$}=U.detail;de.value=$,ue.value=!0}function We(U){const{messageId:$,chatId:F}=U.detail;F&&g.enterSelectionMode(F,$)}function Ne(U){const{messageId:$,chatId:F}=U.detail;if(!$||!F)return;D.value=[$];const G=ve.value.find(me=>me.id===$);A.value=!!(G&&G.sender_id===i.user?.id),X.value=!0}function St(){de.value=[...g.selectedMessageIds],ue.value=!0}function It(){D.value=[...g.selectedMessageIds],A.value=D.value.every(U=>{const $=ve.value.find(F=>F.id===U);return $&&$.sender_id===i.user?.id}),X.value=!0}function Ge(){ue.value=!1,de.value=[],g.exitSelectionMode()}async function Tt(U){X.value=!1;const $=s.activeChatId;if($){for(const F of D.value)try{await l.deleteMessage($,F)}catch{n("Failed to delete message")}D.value=[],g.exitSelectionMode()}}function he(U){I.value=!1;const $=M.value,F=s.activeChatId;if(!(!$||!F))switch(U){case"reply":{const G=ve.value.find(me=>me.id===$);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:$,senderName:G?.sender_display_name||G?.sender_username||"Unknown",text:G?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:$,chatId:F,text:N.value}}));break}case"copy":navigator.clipboard.writeText(N.value).then(()=>n("Copied to clipboard"),()=>n("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${F}/${$}`).then(()=>n("Link copied"),()=>n("Failed to copy link"));break;case"forward":de.value=[$],ue.value=!0;break;case"select":g.enterSelectionMode(F,$);break;case"delete":Ne(new CustomEvent("",{detail:{messageId:$,chatId:F}}));break}}async function Xe(U){if(!v.value)return;const $=s.activeChatId;if(!$)return;let F=v.value.querySelector(`[data-message-id="${U}"]`);if(!F)try{const G=Math.max(0,U-25),me=await De($,{after_id:G,limit:50});if(!me.find(Ae=>Ae.id===U)){n("Message not found");return}l.messagesByChat[$]=me,me.length>0&&(l.lastMsgId[$]=Math.max(...me.map(Ae=>Ae.id))),await ce(),F=v.value?.querySelector(`[data-message-id="${U}"]`)}catch{n("Message not found");return}F&&(F.scrollIntoView({behavior:"smooth",block:"center"}),F.classList.add("highlight-message"),setTimeout(()=>F.classList.remove("highlight-message"),2e3))}function Ye(U){U.key==="Escape"&&T.value&&(T.value=!1,U.stopPropagation())}se(()=>{window.addEventListener("forward-messages",He),window.addEventListener("select-message",We),window.addEventListener("delete-message",Ne),document.addEventListener("keydown",Ye)}),ke(()=>{window.removeEventListener("forward-messages",He),window.removeEventListener("select-message",We),window.removeEventListener("delete-message",Ne),document.removeEventListener("keydown",Ye)}),ye(()=>C.value,async U=>{U&&(await ce(),setTimeout(()=>{Xe(U),C.value=null},300))}),ye(()=>s.activeChatId,()=>{g.exitSelectionMode(),ge.value=null});async function Dt(U){if(s.activeChatId)try{const $=await qe(U);await l.sendMessage(s.activeChatId,"","voice",{file_id:$.id,duration_seconds:r.seconds.value}),await l.loadMessages(s.activeChatId),await ce(),Y(),s.loadChats()}catch{n("Failed to upload voice message")}}return(U,$)=>(u(),h("main",Zo,[x(s).activeChatId?(u(),h("div",Qo,[P(ua,{onForward:St,onDelete:It}),H(P(ss,{onBack:$[0]||($[0]=F=>o("back")),onOpenUserProfile:$[1]||($[1]=F=>o("openUserProfile",F)),onOpenChannelInfo:$[2]||($[2]=F=>T.value=!0)},null,512),[[Le,!x(g).selectionMode]]),Se.value?(u(),h("div",Ko,[...$[17]||($[17]=[e("span",{class:"readonly-icon"},"ðŸ”’",-1),e("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):E("",!0),e("div",{ref_key:"msgListRef",ref:v,class:"msg-list",onClick:$t},[x(l).loadingChat===x(s).activeChatId?(u(),V(Ys,{key:0})):(u(!0),h(J,{key:1},te(q.value,F=>(u(),h(J,{key:F.type==="date"?"date-"+F.label:"msg-"+F.msg.id},[F.type==="date"?(u(),h("div",ei,[e("span",null,L(F.label),1)])):(u(),V(Is,{key:1,message:F.msg,"is-mine":F.msg.sender_id===x(i).user?.id,onMentionClick:$[3]||($[3]=G=>o("openUserProfile",G)),onOpenEmojiPicker:wt,onToggleReaction:Ct,onReplyClick:Xe},null,8,["message","is-mine"]))],64))),128))],512),P(ta,{visible:p.value,x:S.value,y:_.value,onSelect:_t,onClose:$[4]||($[4]=F=>p.value=!1)},null,8,["visible","x","y"]),c.value?(u(),h("div",ti,[P(Hs,{onSelect:kt})])):E("",!0),Se.value?E("",!0):H((u(),V(Bs,{key:2,"sticker-picker-open":c.value,"reply-to":ge.value,onSend:yt,onEditMessage:bt,onToggleStickers:$[5]||($[5]=F=>c.value=!c.value),onStartRecording:xt,onTyping:Ce},null,8,["sticker-picker-open","reply-to"])),[[Le,!w.value]]),w.value?(u(),h("div",ni,[$[18]||($[18]=e("span",{class:"rec-dot"},null,-1)),e("span",si,L(x(r).formatTime(x(r).seconds.value)),1),$[19]||($[19]=e("span",{class:"rec-label"},"Recording... tap mic to stop",-1)),e("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:Mt},"âœ•")])):E("",!0),f.value?(u(),V(Ks,{key:4,"chat-id":x(s).activeChatId},null,8,["chat-id"])):E("",!0),P(sa),P(va,{visible:I.value,onClose:$[13]||($[13]=F=>I.value=!1)},{default:Be(()=>[e("button",{class:"ctx-item",onClick:$[6]||($[6]=F=>he("reply"))},"Reply"),ae.value?(u(),h("button",{key:0,class:"ctx-item",onClick:$[7]||($[7]=F=>he("edit"))},"Edit")):E("",!0),$[20]||($[20]=e("button",{class:"ctx-item",disabled:"","aria-label":"Coming soon â€” requires V14 migration"},"Pin",-1)),e("button",{class:"ctx-item",onClick:$[8]||($[8]=F=>he("copy"))},"Copy text"),e("button",{class:"ctx-item",onClick:$[9]||($[9]=F=>he("copyLink"))},"Copy link"),e("button",{class:"ctx-item",onClick:$[10]||($[10]=F=>he("forward"))},"Forward"),e("button",{class:"ctx-item",onClick:$[11]||($[11]=F=>he("select"))},"Select"),e("button",{class:"ctx-item ctx-delete",onClick:$[12]||($[12]=F=>he("delete"))},"Delete")]),_:1},8,["visible"]),ue.value?(u(),V(Ma,{key:5,"message-ids":de.value,"from-chat-id":x(s).activeChatId,onClose:Ge,onForwarded:Ge},null,8,["message-ids","from-chat-id"])):E("",!0),X.value?(u(),V(Ea,{key:6,"message-count":D.value.length,"can-delete-for-everyone":A.value,onClose:$[14]||($[14]=F=>X.value=!1),onConfirm:Tt},null,8,["message-count","can-delete-for-everyone"])):E("",!0),T.value?(u(),V(Yo,{key:7,"chat-id":String(x(s).activeChatId),onClose:$[15]||($[15]=F=>T.value=!1)},null,8,["chat-id"])):E("",!0)])):(u(),h("div",Jo,[...$[16]||($[16]=[e("div",{class:"empty-chat-icon"},"ðŸ’¬",-1),e("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),oi=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Favorites",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:t=>t.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:t=>t.isAuthenticated,rightSlot:"none",separator:!0}];function ii(t){return oi.filter(a=>a.visible(t))}const li=["disabled"],ri={class:"menu-item__label"},ci={key:1,class:"menu-item__badge"},ui=j({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(t,{emit:a}){const o=a;return(i,s)=>(u(),h("button",{class:Q(["menu-item",{"menu-item--danger":t.danger,"menu-item--disabled":t.disabled}]),disabled:t.disabled,onClick:s[0]||(s[0]=l=>o("click"))},[t.icon?(u(),V(Ue(t.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):E("",!0),e("span",ri,L(t.label),1),t.badge?(u(),h("span",ci,L(t.badge),1)):E("",!0),ot(i.$slots,"right",{},void 0),t.chevron?(u(),V(Ue(x(yn)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):E("",!0)],10,li))}}),nt=K(ui,[["__scopeId","data-v-682bc042"]]),di={class:"drawer-header"},vi={class:"drawer-avatar-wrap"},mi={class:"drawer-user-info"},fi={class:"drawer-display-name"},pi={class:"drawer-username"},gi={class:"drawer-nav"},hi={key:0,class:"drawer-divider"},yi=["onClick"],bi={class:"menu-item__label"},ki=["aria-checked"],wi=j({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(t,{emit:a}){const o=a,i=lt(),s=fe(),l=Ee(),n={user:gt,users:je,megaphone:ft,bookmark:gn,settings:Sn,moon:xn,download:kn,"log-out":Ve,star:Dn},r=O(()=>({isAuthenticated:!!s.user,isDesktop:!0})),b=O(()=>ii(r.value)),d={openProfile:()=>o("openProfile"),createGroup:()=>o("openNewGroup"),createChannel:()=>o("openNewChannel"),openFavorites:()=>o("openFavorites"),openSettings:()=>o("openSettings"),toggleNightMode:()=>{const v=l.theme==="dark"?"light":"dark";l.applyTheme(v),l.saveSettings({theme:v})},openDownload:()=>o("openDownload"),logout:()=>{s.logout(),i.push("/login")}};function C(v){v&&d[v]&&d[v]()}return(v,c)=>(u(),h("div",{class:Q(["drawer",{open:t.open}])},[e("div",di,[e("button",{class:"icon-btn","aria-label":"Close menu",onClick:c[0]||(c[0]=w=>o("close"))},[P(x(pe),{size:20,"stroke-width":2})]),c[1]||(c[1]=e("span",{class:"drawer-title"},"Menu",-1))]),e("div",vi,[P(oe,{name:x(s).user?.display_name||x(s).user?.username||"?",url:x(s).user?.avatar_url,size:"lg"},null,8,["name","url"]),e("div",mi,[e("div",fi,L(x(s).user?.display_name||x(s).user?.username||"---"),1),e("div",pi,"@"+L(x(s).user?.username||"---"),1)])]),e("nav",gi,[(u(!0),h(J,null,te(b.value,w=>(u(),h(J,{key:w.id},[w.separator?(u(),h("div",hi)):E("",!0),w.rightSlot==="toggle"?(u(),h("div",{key:1,class:"menu-item menu-item--toggle",onClick:k=>C(w.action)},[(u(),V(Ue(n[w.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),e("span",bi,L(w.label),1),e("span",{class:Q(["toggle-switch",{"toggle-switch--on":x(l).theme==="dark"}]),role:"switch","aria-checked":x(l).theme==="dark"},[...c[2]||(c[2]=[e("span",{class:"toggle-switch__thumb"},null,-1)])],10,ki)],8,yi)):w.id==="logout"?(u(),V(nt,{key:2,icon:n[w.icon],label:w.label,danger:"",onClick:k=>C(w.action)},null,8,["icon","label","onClick"])):(u(),V(nt,{key:3,icon:n[w.icon],label:w.label,onClick:k=>C(w.action)},null,8,["icon","label","onClick"]))],64))),128))]),c[3]||(c[3]=e("div",{class:"drawer-footer"},"Simple Messenger v2",-1))],2))}}),_i=K(wi,[["__scopeId","data-v-de7cf394"]]),Ci={class:"modal"},$i={class:"modal-header"},xi={class:"modal-body"},Mi={key:0,class:"chat-type-cards"},Si={class:"chat-type-icon"},Ii={class:"chat-type-icon"},Ti={class:"chat-type-icon"},Di={key:1,class:"new-chat-form"},Li={class:"user-pick-list"},Ui={key:0,class:"empty-state-small"},Fi={key:1,class:"empty-state-small"},Ei=["onClick"],Pi={class:"user-pick-name"},Ni={class:"user-pick-handle"},Ai={key:2,class:"new-chat-form"},zi={class:"form-group"},Oi={class:"form-group"},Bi={class:"form-group"},Ri={class:"user-pick-list"},Vi=["onClick"],ji={class:"user-pick-name"},qi={class:"user-pick-handle"},Hi={class:"modal-actions"},Wi=["disabled"],Gi={key:3,class:"new-chat-form"},Xi={class:"form-group"},Yi={class:"form-group"},Zi={class:"form-group"},Ji={class:"modal-actions"},Qi=["disabled"],Ki=j({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(t,{emit:a}){const o=t,i=a,s=fe(),{showToast:l}=le(),n=y(o.initialStep),r=y(!1),b=y(""),d=y([]),C=y(!1);let v=null;const c=y(""),w=y(""),k=y(""),f=y([]),T=y(new Set);let p=null;const S=y(""),_=y(""),m=y("");se(()=>{g("")});async function g(X){C.value=!0;try{const D=await Qe(X);d.value=D.filter(A=>A.id!==s.user?.id)}catch{d.value=[]}finally{C.value=!1}}function I(){v&&clearTimeout(v),v=setTimeout(()=>g(b.value),300)}async function M(X){try{f.value=await Qe(X)}catch{f.value=[]}}function N(){p&&clearTimeout(p),p=setTimeout(()=>M(k.value),300)}function B(X){T.value.has(X)?T.value.delete(X):T.value.add(X)}async function ae(X){r.value=!0;try{const D=await Te({type:"direct",member_ids:[X]});i("chatCreated",D.id)}catch{l("Failed to start conversation")}finally{r.value=!1}}async function ue(){if(!c.value.trim()){l("Group name is required");return}r.value=!0;try{const X=await Te({type:"group",title:c.value.trim(),description:w.value.trim(),member_ids:Array.from(T.value)});l("Group created!"),i("chatCreated",X.id)}catch{l("Failed to create group")}finally{r.value=!1}}async function de(){if(!S.value.trim()){l("Channel name is required");return}r.value=!0;try{const X=await Te({type:"channel",title:S.value.trim(),description:m.value.trim(),public_name:_.value.trim()||void 0,member_ids:[]});l("Channel created!"),i("chatCreated",X.id)}catch{l("Failed to create channel")}finally{r.value=!1}}return(X,D)=>(u(),h("div",{class:"modal-backdrop",onClick:D[14]||(D[14]=Z(A=>i("close"),["self"]))},[e("div",Ci,[e("div",$i,[D[15]||(D[15]=e("h2",{class:"modal-title"},"New Conversation",-1)),e("button",{class:"icon-btn",onClick:D[0]||(D[0]=A=>i("close"))},[P(x(pe),{size:20})])]),e("div",xi,[n.value==="select"?(u(),h("div",Mi,[e("button",{class:"chat-type-card",onClick:D[1]||(D[1]=A=>n.value="direct")},[e("span",Si,[P(x(gt),{size:24})]),D[16]||(D[16]=e("div",null,[e("div",{class:"chat-type-label"},"Direct Chat"),e("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),e("button",{class:"chat-type-card",onClick:D[2]||(D[2]=A=>n.value="group")},[e("span",Ii,[P(x(je),{size:24})]),D[17]||(D[17]=e("div",null,[e("div",{class:"chat-type-label"},"Group Chat"),e("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),e("button",{class:"chat-type-card",onClick:D[3]||(D[3]=A=>n.value="channel")},[e("span",Ti,[P(x(ft),{size:24})]),D[18]||(D[18]=e("div",null,[e("div",{class:"chat-type-label"},"Channel"),e("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):E("",!0),n.value==="direct"?(u(),h("div",Di,[e("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:D[4]||(D[4]=A=>n.value="select")},[P(x(be),{size:16}),D[19]||(D[19]=ne(" Back ",-1))]),H(e("input",{"onUpdate:modelValue":D[5]||(D[5]=A=>b.value=A),class:"search-input",type:"search",placeholder:"Search users...",onInput:I},null,544),[[ee,b.value]]),e("div",Li,[C.value?(u(),h("div",Ui,"Loading users...")):d.value.length===0?(u(),h("div",Fi,"No users found.")):(u(!0),h(J,{key:2},te(d.value,A=>(u(),h("div",{key:A.id,class:"user-pick-item",onClick:ge=>ae(A.id)},[P(oe,{name:A.display_name||A.username,url:A.avatar_url,size:"sm"},null,8,["name","url"]),e("div",null,[e("div",Pi,L(A.display_name||A.username),1),e("div",Ni,"@"+L(A.username),1)])],8,Ei))),128))])])):E("",!0),n.value==="group"?(u(),h("div",Ai,[e("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:D[6]||(D[6]=A=>n.value="select")},[P(x(be),{size:16}),D[20]||(D[20]=ne(" Back ",-1))]),e("div",zi,[D[21]||(D[21]=e("label",{class:"form-label"},"Group name",-1)),H(e("input",{"onUpdate:modelValue":D[7]||(D[7]=A=>c.value=A),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[ee,c.value]])]),e("div",Oi,[D[22]||(D[22]=e("label",{class:"form-label"},"Description (optional)",-1)),H(e("textarea",{"onUpdate:modelValue":D[8]||(D[8]=A=>w.value=A),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[ee,w.value]])]),e("div",Bi,[D[23]||(D[23]=e("label",{class:"form-label"},"Add members",-1)),H(e("input",{"onUpdate:modelValue":D[9]||(D[9]=A=>k.value=A),class:"search-input",type:"search",placeholder:"Search users...",onInput:N},null,544),[[ee,k.value]]),e("div",Ri,[(u(!0),h(J,null,te(f.value,A=>(u(),h("div",{key:A.id,class:Q(["user-pick-item",{selected:T.value.has(A.id)}]),onClick:ge=>B(A.id)},[P(oe,{name:A.display_name||A.username,url:A.avatar_url,size:"sm"},null,8,["name","url"]),e("div",null,[e("div",ji,[T.value.has(A.id)?(u(),V(x(hn),{key:0,size:14,style:{"margin-right":"4px"}})):E("",!0),ne(L(A.display_name||A.username),1)]),e("div",qi,"@"+L(A.username),1)])],10,Vi))),128))])]),e("div",Hi,[e("button",{class:"btn btn-primary",disabled:r.value,onClick:ue}," Create Group ",8,Wi)])])):E("",!0),n.value==="channel"?(u(),h("div",Gi,[e("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:D[10]||(D[10]=A=>n.value="select")},[P(x(be),{size:16}),D[24]||(D[24]=ne(" Back ",-1))]),e("div",Xi,[D[25]||(D[25]=e("label",{class:"form-label"},"Channel name",-1)),H(e("input",{"onUpdate:modelValue":D[11]||(D[11]=A=>S.value=A),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[ee,S.value]])]),e("div",Yi,[D[26]||(D[26]=e("label",{class:"form-label"},"Public link name (optional)",-1)),H(e("input",{"onUpdate:modelValue":D[12]||(D[12]=A=>_.value=A),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[ee,_.value]]),D[27]||(D[27]=e("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),e("div",Zi,[D[28]||(D[28]=e("label",{class:"form-label"},"Description (optional)",-1)),H(e("textarea",{"onUpdate:modelValue":D[13]||(D[13]=A=>m.value=A),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[ee,m.value]])]),e("div",Ji,[e("button",{class:"btn btn-primary",disabled:r.value,onClick:de}," Create Channel ",8,Qi)])])):E("",!0)])])]))}}),el={class:"modal profile-modal profile-modal--self"},tl={class:"profile-tabs"},nl={class:"profile-modal-body profile-modal-body--scrollable"},sl={class:"profile-avatar-section profile-avatar-upload-section"},al={class:"profile-avatar-overlay"},ol={class:"profile-name"},il={key:0,class:"profile-status profile-status--online"},ll={class:"profile-info-list"},rl={class:"form-group"},cl={class:"form-group"},ul={key:0,class:"form-hint form-error"},dl={class:"form-group"},vl={class:"profile-info-item"},ml={class:"profile-info-value"},fl={class:"profile-edit-actions"},pl={class:"profile-info-list"},gl={class:"form-group form-inline"},hl={class:"form-group form-inline"},yl={class:"toggle"},bl={class:"form-group form-inline"},kl=j({__name:"ProfileModal",props:{initialTab:{default:"profile"}},emits:["close"],setup(t,{emit:a}){const o=t,i=a,s=fe(),l=Ee(),{showToast:n}=le(),r=y(o.initialTab),b=y(""),d=y(""),C=y(""),v=y(""),c=y(null),w=y("light"),k=y(!0),f=y("en");ye(k,async _=>{_&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(k.value=!1,n("Notifications blocked by browser"))}),se(async()=>{s.user&&(b.value=s.user.display_name||"",d.value=s.user.username,C.value=s.user.bio||""),w.value=l.theme,k.value=l.notificationsEnabled,f.value=l.language});async function T(){const _=c.value?.files?.[0];if(_){try{const m=await qe(_),g=await rn(m.id);s.updateUser({avatar_url:g.avatar_url}),n("Avatar updated!")}catch{n("Upload failed")}c.value&&(c.value.value="")}}async function p(){if(v.value="",!s.user)return;const _={display_name:b.value.trim(),bio:C.value.trim()};d.value.trim()&&d.value.trim()!==s.user.username&&(_.username=d.value.trim());try{const m=await ln(s.user.id,_);s.updateUser({display_name:m.display_name,username:m.username}),n("Profile saved!"),i("close")}catch(m){m.response?.status===409?v.value="Username already taken":n("Save failed")}}async function S(){try{await l.saveSettings({theme:w.value,notifications_enabled:k.value,language:f.value}),n("Settings saved!"),i("close")}catch{n("Settings save failed")}}return(_,m)=>(u(),h("div",{class:"modal-backdrop profile-backdrop",onClick:m[11]||(m[11]=Z(g=>i("close"),["self"]))},[e("div",el,[e("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:m[0]||(m[0]=g=>i("close"))},[P(x(pe),{size:20,"stroke-width":2})]),e("div",tl,[e("button",{class:Q(["profile-tab",{active:r.value==="profile"}]),onClick:m[1]||(m[1]=g=>r.value="profile")},"Profile",2),e("button",{class:Q(["profile-tab",{active:r.value==="settings"}]),onClick:m[2]||(m[2]=g=>r.value="settings")},"Settings",2)]),e("div",nl,[H(e("div",null,[e("div",sl,[e("div",{class:"profile-avatar-upload-wrap",onClick:m[3]||(m[3]=g=>c.value?.click())},[P(oe,{name:b.value||x(s).user?.username||"?",url:x(s).user?.avatar_url,size:"xxl"},null,8,["name","url"]),e("div",al,[P(x(mt),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),e("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",class:"hidden",onChange:T},null,544)]),e("div",ol,L(b.value||x(s).user?.username||"?"),1),x(s).user?(u(),h("div",il," online ")):E("",!0),m[16]||(m[16]=e("div",{class:"profile-divider"},null,-1)),e("div",ll,[e("div",rl,[m[12]||(m[12]=e("label",{class:"form-label"},"Display name",-1)),H(e("input",{"onUpdate:modelValue":m[4]||(m[4]=g=>b.value=g),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[ee,b.value]])]),e("div",cl,[m[13]||(m[13]=e("label",{class:"form-label"},"Username",-1)),H(e("input",{"onUpdate:modelValue":m[5]||(m[5]=g=>d.value=g),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[ee,d.value]]),v.value?(u(),h("small",ul,L(v.value),1)):E("",!0)]),e("div",dl,[m[14]||(m[14]=e("label",{class:"form-label"},"Bio",-1)),H(e("textarea",{"onUpdate:modelValue":m[6]||(m[6]=g=>C.value=g),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[ee,C.value]])]),e("div",vl,[m[15]||(m[15]=e("div",{class:"profile-info-label"},"User ID",-1)),e("div",ml,L(x(s).user?.id),1)])]),e("div",fl,[e("button",{class:"btn btn-primary",onClick:p},"Save Profile"),e("button",{class:"btn btn-ghost",onClick:m[7]||(m[7]=g=>i("close"))},"Cancel")])],512),[[Le,r.value==="profile"]]),H(e("div",null,[e("div",pl,[e("div",gl,[m[18]||(m[18]=e("label",{class:"form-label"},"Theme",-1)),H(e("select",{"onUpdate:modelValue":m[8]||(m[8]=g=>w.value=g),class:"form-input form-select"},[...m[17]||(m[17]=[e("option",{value:"light"},"Light",-1),e("option",{value:"dark"},"Dark",-1)])],512),[[Je,w.value]])]),e("div",hl,[m[20]||(m[20]=e("label",{class:"form-label"},"Notifications",-1)),e("label",yl,[H(e("input",{"onUpdate:modelValue":m[9]||(m[9]=g=>k.value=g),type:"checkbox"},null,512),[[it,k.value]]),m[19]||(m[19]=e("span",{class:"toggle-slider"},null,-1))])]),e("div",bl,[m[22]||(m[22]=e("label",{class:"form-label"},"Language",-1)),H(e("select",{"onUpdate:modelValue":m[10]||(m[10]=g=>f.value=g),class:"form-input form-select"},[...m[21]||(m[21]=[e("option",{value:"en"},"English",-1),e("option",{value:"ru"},"Ð ÑƒÑÑÐºÐ¸Ð¹",-1),e("option",{value:"de"},"Deutsch",-1)])],512),[[Je,f.value]])])]),e("div",{class:"profile-edit-actions"},[e("button",{class:"btn btn-primary",onClick:S},"Save Settings")])],512),[[Le,r.value==="settings"]])])])]))}}),wl={class:"profile-actions"},_l=["disabled","onClick"],Cl={class:"profile-action-btn__circle"},$l={class:"profile-action-btn__label"},xl=j({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(t,{emit:a}){const o=t,i=a,s=O(()=>{const l=[{icon:$n,label:"Message",event:"message"}];return o.showMute!==!1&&l.push({icon:pn,label:o.muted?"Unmute":"Mute",event:"mute"}),o.showMore!==!1&&l.push({icon:wn,label:"More",event:"more"}),l});return(l,n)=>(u(),h("div",wl,[(u(!0),h(J,null,te(s.value,r=>(u(),h("button",{key:r.label,class:Q(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:b=>i(r.event)},[e("span",Cl,[(u(),V(Ue(r.icon),{size:22,"stroke-width":1.8}))]),e("span",$l,L(r.label),1)],10,_l))),128))]))}}),Ml=K(xl,[["__scopeId","data-v-b5376905"]]),Sl={class:"modal profile-modal"},Il={class:"profile-modal-body"},Tl={key:0,class:"profile-loading"},Dl={class:"profile-avatar-section"},Ll={class:"profile-name"},Ul={class:"profile-info-list"},Fl={class:"profile-info-item"},El={class:"profile-info-value"},Pl={key:0,class:"profile-info-item"},Nl={class:"profile-info-value"},Al={class:"profile-info-item"},zl={class:"profile-info-value"},Ol={key:2,class:"profile-loading"},Bl=j({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(t,{emit:a}){const o=t,i=a,s=ie(),{showToast:l}=le(),n=y(null),r=y(!0),b=y(!1),d=O(()=>n.value?s.isUserOnline(n.value.id):!1);se(async()=>{try{n.value=await vt(o.username)}catch{n.value=null}finally{r.value=!1}});function C(){b.value=!b.value,l(b.value?"User muted":"User unmuted")}return(v,c)=>(u(),h("div",{class:"modal-backdrop profile-backdrop",onClick:c[2]||(c[2]=Z(w=>i("close"),["self"]))},[e("div",Sl,[e("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:c[0]||(c[0]=w=>i("close"))},[P(x(pe),{size:20,"stroke-width":2})]),e("div",Il,[r.value?(u(),h("div",Tl,[...c[3]||(c[3]=[e("p",null,"Loading...",-1)])])):n.value?(u(),h(J,{key:1},[e("div",Dl,[P(oe,{name:n.value.display_name||n.value.username,url:n.value.avatar_url,online:d.value,size:"xxl"},null,8,["name","url","online"])]),e("div",Ll,[ne(L(n.value.display_name||n.value.username)+" ",1),n.value.is_admin?(u(),V(ht,{key:0})):E("",!0)]),e("div",{class:Q(["profile-status",{"profile-status--online":d.value}])},L(d.value?"online":"offline"),3),P(Ml,{muted:b.value,"show-more":!1,onMessage:c[1]||(c[1]=w=>i("message",n.value.username)),onMute:C},null,8,["muted"]),c[7]||(c[7]=e("div",{class:"profile-divider"},null,-1)),e("div",Ul,[e("div",Fl,[c[4]||(c[4]=e("div",{class:"profile-info-label"},"Username",-1)),e("div",El,"@"+L(n.value.username),1)]),n.value.bio?(u(),h("div",Pl,[c[5]||(c[5]=e("div",{class:"profile-info-label"},"Bio",-1)),e("div",Nl,L(n.value.bio),1)])):E("",!0),e("div",Al,[c[6]||(c[6]=e("div",{class:"profile-info-label"},"User ID",-1)),e("div",zl,L(n.value.id),1)])])],64)):(u(),h("div",Ol,[...c[8]||(c[8]=[e("p",null,"User not found",-1)])]))])])]))}}),Rl={class:"modal",style:{"max-width":"420px"}},Vl={class:"modal-header"},jl={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},ql=j({__name:"DownloadModal",emits:["close"],setup(t,{emit:a}){const o=a,i=navigator.userAgent.toLowerCase(),s=i.includes("win"),l=i.includes("mac")&&!i.includes("iphone")&&!i.includes("ipad"),n=O(()=>s?"Windows":l?"macOS":null);function r(){s?window.location.href="/downloads/windows/MessengerSetup.exe":l&&(window.location.href="/downloads/macos/Messenger.dmg")}return(b,d)=>(u(),h("div",{class:"modal-backdrop",onClick:d[1]||(d[1]=Z(C=>o("close"),["self"]))},[e("div",Rl,[e("div",Vl,[d[2]||(d[2]=e("h2",{class:"modal-title"},"Download Simple Messenger",-1)),e("button",{class:"icon-btn","aria-label":"Close",onClick:d[0]||(d[0]=C=>o("close"))},[P(x(pe),{size:20})])]),e("div",jl,[n.value?(u(),h("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+L(n.value),1)):E("",!0),d[3]||(d[3]=Ut('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/MessengerSetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/Messenger.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),Hl=j({__name:"ContextMenu",setup(t){const a=ie(),{showToast:o}=le(),i=y(!1),s=y(0),l=y(0),n=y(null),r=O(()=>n.value?a.chats.find(w=>w.id===n.value)??null:null);function b(w){n.value=w.detail.chatId,s.value=w.detail.x,l.value=w.detail.y,i.value=!0}function d(){i.value&&(i.value=!1,n.value=null)}se(()=>{window.addEventListener("show-context-menu",b),document.addEventListener("click",d)}),ke(()=>{window.removeEventListener("show-context-menu",b),document.removeEventListener("click",d)});async function C(){if(n.value){i.value=!1;try{await a.toggleFavorite(n.value)}catch{o("Failed to update favorite")}}}async function v(){if(n.value){i.value=!1;try{await a.toggleMute(n.value)}catch{o("Failed to update mute")}}}async function c(){if(n.value&&(i.value=!1,!!confirm("Leave this chat?")))try{await a.leave(n.value),o("Left chat")}catch{o("Failed to leave chat")}}return(w,k)=>i.value?(u(),h("div",{key:0,class:"context-menu",style:Fe({left:s.value+"px",top:l.value+"px"})},[e("button",{class:"ctx-item",onClick:C},L(r.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),e("button",{class:"ctx-item",onClick:v},L(r.value?.is_muted?"Unmute":"Mute"),1),r.value&&r.value.type!=="direct"?(u(),h("button",{key:0,class:"ctx-item ctx-leave",onClick:c}," Leave chat ")):E("",!0)],4)):E("",!0)}}),Yl=j({__name:"MessengerView",setup(t){const a=Ft(),o=lt(),i=fe(),s=ie(),l=Ee(),n=Pe(),{showToast:r}=le(),{connect:b,disconnect:d,sendTyping:C}=an();Ie("sendTyping",C);const v=y(!1),c=y(!1),w=y("select"),k=y(!1),f=y("profile"),T=y(!1),p=y(null),S=y([]),_=y(null);Ie("stickers",S),Ie("pendingScrollMessageId",_);let m=null;se(async()=>{await l.loadSettings();try{S.value=await cn()}catch{}await s.loadChats(),b(),m=setInterval(()=>s.loadChats(),5e3),g()}),ke(()=>{d(),m&&(clearInterval(m),m=null)}),ye(()=>a.path,()=>{g()}),ye(()=>s.activeChatId,()=>{n.selectionMode&&n.exitSelectionMode()});async function g(){const q=a.path;if(q.startsWith("/@")){const z=a.params.username;z&&(p.value=z)}else if(q.startsWith("/u/")){const z=a.params.id;if(z)try{const Y=await on(parseInt(z));p.value=Y.username}catch{r("User not found")}}else if(q.startsWith("/dm/")){const z=a.params.id;z&&await I(z)}else if(q.startsWith("/c/")){const z=a.params.chatIdOrName||a.params.name,Y=a.params.messageId?parseInt(a.params.messageId):null;if(z)if(/^\d+$/.test(z)){const Ce=parseInt(z);Y?await N(Ce,Y):s.setActiveChat(Ce)}else await M(z)}}async function I(q){try{let z;if(q.startsWith("@")){const re=q.substring(1);if(i.user?.username===re){p.value=re;return}z=(await vt(re)).id}else if(z=parseInt(q),i.user?.id===z){r("Cannot open DM with yourself");return}const Y=await Te({type:"direct",member_ids:[z]});await s.loadChats(),s.setActiveChat(Y.id)}catch{r("Failed to open conversation")}}async function M(q){try{const z=await Pt(q);s.chats.find(re=>re.id===z.id)?s.setActiveChat(z.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function N(q,z){if(!s.chats.find(re=>re.id===q)){r("Chat not found");return}s.setActiveChat(q),await ce(),_.value=z}function B(q){s.setActiveChat(q),o.replace("/app")}function ae(){s.setActiveChat(null)}function ue(){v.value=!1,f.value="profile",k.value=!0}function de(){v.value=!1,f.value="settings",k.value=!0}function X(){v.value=!1,w.value="group",c.value=!0}function D(){v.value=!1,w.value="channel",c.value=!0}function A(){v.value=!1}function ge(q){p.value=q}async function we(q){p.value=null,await I("@"+q)}async function Se(q){c.value=!1,await s.loadChats(),s.setActiveChat(q)}function ve(q){if(q.key==="Escape"){if(n.selectionMode){n.exitSelectionMode();return}if(p.value){p.value=null;return}if(c.value){c.value=!1;return}if(k.value){k.value=!1;return}if(T.value){T.value=!1;return}if(v.value){v.value=!1;return}if(s.activeChatId!==null){ae();return}}}return se(()=>document.addEventListener("keydown",ve)),ke(()=>document.removeEventListener("keydown",ve)),(q,z)=>(u(),h("div",{class:Q(["layout",{"chat-open":!!x(s).activeChatId}])},[P(_i,{open:v.value,onClose:z[0]||(z[0]=Y=>v.value=!1),onOpenProfile:ue,onOpenSettings:de,onOpenNewGroup:X,onOpenNewChannel:D,onOpenFavorites:A,onOpenDownload:z[1]||(z[1]=Y=>T.value=!0)},null,8,["open"]),e("div",{class:Q(["drawer-overlay",{visible:v.value}]),onClick:z[2]||(z[2]=Y=>v.value=!1)},null,2),P(Kn,{onOpenDrawer:z[3]||(z[3]=Y=>v.value=!0),onOpenNewChat:z[4]||(z[4]=Y=>{w.value="select",c.value=!0}),onSelectChat:B}),P(ai,{onBack:ae,onOpenUserProfile:ge}),c.value?(u(),V(Ki,{key:0,"initial-step":w.value,onClose:z[5]||(z[5]=Y=>c.value=!1),onChatCreated:Se},null,8,["initial-step"])):E("",!0),k.value?(u(),V(kl,{key:1,"initial-tab":f.value,onClose:z[6]||(z[6]=Y=>k.value=!1)},null,8,["initial-tab"])):E("",!0),p.value?(u(),V(Bl,{key:2,username:p.value,onClose:z[7]||(z[7]=Y=>p.value=null),onMessage:we},null,8,["username"])):E("",!0),T.value?(u(),V(ql,{key:3,onClose:z[8]||(z[8]=Y=>T.value=!1)})):E("",!0),P(Hl)],2))}});export{Yl as default};
