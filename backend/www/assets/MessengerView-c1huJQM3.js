import{l as Y,m as Qe,r as y,p as W,q as ea,s as We,u as Le,x as un,d as se,o as v,c as h,a as t,t as x,w as ue,y as vt,n as ve,h as z,b as k,z as Q,e as P,g as ke,f as de,v as ye,F as ce,A as ge,B as nt,C as Oe,D as Je,E as ta,G as we,H as dn,I as Ce,T as is,J as Se,i as kn,K as os,L as ls,M as na,N as Fn,O as zn,P as qe,k as rs,Q as sa,R as en,S as aa,U as ia}from"./index-D5p25GEP.js";import{_ as _e,l as oa,c as la,r as ra,p as ca,j as ua}from"./invites-Di0IEaRo.js";async function da(){const{data:e}=await Y.get("/chats");return e}async function cs(e){const{data:s}=await Y.get(`/chats/${e}`);return s}async function va(e){const{data:s}=await Y.get(`/chats/by-name/${encodeURIComponent(e)}`);return s}async function st(e){const{data:s}=await Y.post("/chats",e);return s}async function ma(e){await Y.post(`/chats/${e}/favorite`)}async function fa(e){await Y.delete(`/chats/${e}/favorite`)}async function pa(e,s){await Y.post(`/chats/${e}/mute`,{})}async function ha(e){await Y.delete(`/chats/${e}/mute`)}async function ga(e){await Y.delete(`/chats/${e}/leave`)}async function ya(e){await Y.post(`/chats/${e}/read`)}async function ba(e){await Y.post(`/chats/${e}/pin`)}async function ka(e){await Y.delete(`/chats/${e}/pin`)}async function wa(e){await Y.post(`/chats/${e}/archive`)}async function _a(e){await Y.delete(`/chats/${e}/archive`)}async function Ca(e){const{data:s}=await Y.get(`/chats/${e}`);return s.members??[]}async function us(e){await Y.delete(`/chats/${e}`)}async function $a(e,s){const{data:n}=await Y.patch(`/chats/${e}`,s);return n}async function Sa(e){const{data:s}=await Y.get(`/chats/${e}/read-receipts`);return s}const Ee=Qe("chats",()=>{const e=y([]),s=y(null),n=y({}),i=y(new Set),a=y({}),o=W(()=>e.value.find(T=>T.id===s.value)??null),l=W(()=>[...e.value].sort((T,M)=>{if(T.is_pinned&&!M.is_pinned)return-1;if(!T.is_pinned&&M.is_pinned)return 1;if(T.is_favorite&&!M.is_favorite)return-1;if(!T.is_favorite&&M.is_favorite)return 1;const I=T.last_at||T.updated_at||"";return(M.last_at||M.updated_at||"").localeCompare(I)}));async function r(){try{e.value=await da()}catch(T){console.error("Failed to load chats",T)}}function d(T){if(s.value=T,T!==null){const M=e.value.find(I=>I.id===T);M&&M.unread_count>0&&(M.unread_count=0,ya(T).catch(()=>{}))}}async function b(T){const M=e.value.find(I=>I.id===T);if(M)try{M.is_favorite?await fa(T):await ma(T),M.is_favorite=!M.is_favorite}catch(I){throw console.error("Failed to toggle favorite",I),I}}async function f(T){const M=e.value.find(I=>I.id===T);if(M)try{M.is_muted?await ha(T):await pa(T),M.is_muted=!M.is_muted}catch(I){throw console.error("Failed to toggle mute",I),I}}async function p(T){const M=e.value.find(I=>I.id===T);if(M)try{M.is_pinned?await ka(T):await ba(T),M.is_pinned=!M.is_pinned}catch(I){throw console.error("Failed to toggle pin",I),I}}async function m(T){const M=e.value.find(I=>I.id===T);if(M)try{M.is_archived?await _a(T):await wa(T),M.is_archived=!M.is_archived}catch(I){throw console.error("Failed to toggle archive",I),I}}async function c(T){await ga(T),e.value=e.value.filter(M=>M.id!==T),s.value===T&&(s.value=null)}async function u(T){await us(T),e.value=e.value.filter(M=>M.id!==T),s.value===T&&(s.value=null)}function g(T,M,I){const J=e.value.find(H=>H.id===T);J&&(J.last_message=M,J.last_at=I)}function E(T){const M=e.value.find(I=>I.id===T);M&&(M.unread_count=(M.unread_count||0)+1)}function $(T,M,I){n.value[T]||(n.value[T]={});const J=n.value[T][M];J&&clearTimeout(J.timer);const H=setTimeout(()=>{_(T,M)},3e3);n.value[T][M]={username:I,timer:H}}function _(T,M){if(n.value[T]){const I=n.value[T][M];I&&(clearTimeout(I.timer),delete n.value[T][M])}}function D(T){const M=n.value[T];return M?Object.values(M).map(I=>I.username):[]}function q(T){i.value=new Set([...i.value,T]),a.value={...a.value,[T]:{isOnline:!0}}}function K(T,M,I){const J=new Set(i.value);J.delete(T),i.value=J,a.value={...a.value,[T]:{isOnline:!1,lastSeenAt:M,lastSeenBucket:I}}}function U(T,M){if(M.isOnline)i.value=new Set([...i.value,T]);else{const I=new Set(i.value);I.delete(T),i.value=I}a.value={...a.value,[T]:M}}function te(T){return a.value[T]}function le(T){return i.value.has(T)}return{chats:e,activeChatId:s,activeChat:o,sortedChats:l,typingUsers:n,loadChats:r,setActiveChat:d,toggleFavorite:b,toggleMute:f,togglePin:p,toggleArchive:m,leave:c,deleteChat:u,updateChatLastMessage:g,incrementUnread:E,setTyping:$,clearTyping:_,getTypingUsernames:D,onlineUsers:i,userPresenceDetails:a,setUserOnline:q,setUserOffline:K,setUserPresence:U,getUserPresence:te,isUserOnline:le}});async function Ma(){const{data:e}=await Y.get("/settings");return e}async function xa(e){await Y.put("/settings",e)}const mt=Qe("settings",()=>{const e=y(localStorage.getItem("theme")||"light"),s=y(!0),n=y("en"),i=y("everyone"),a=y(!0);function o(d){e.value=d,document.body.setAttribute("data-theme",d),localStorage.setItem("theme",d)}async function l(){try{const d=await Ma();o(d.theme||"light"),s.value=d.notifications_enabled,n.value=d.language||"en",i.value=d.last_seen_visibility||"everyone",a.value=d.read_receipts_enabled!==!1}catch(d){console.error("Failed to load settings",d)}}async function r(d){await xa(d),d.theme&&o(d.theme),d.notifications_enabled!==void 0&&(s.value=d.notifications_enabled),d.language&&(n.value=d.language),d.last_seen_visibility&&(i.value=d.last_seen_visibility),d.read_receipts_enabled!==void 0&&(a.value=d.read_receipts_enabled)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:s,language:n,lastSeenVisibility:i,readReceiptsEnabled:a,applyTheme:o,loadSettings:l,saveSettings:r}}),Jt=Qe("selection",()=>{const e=y(new Set),s=y(!1),n=y(null),i=W(()=>e.value.size);function a(b,f){s.value=!0,n.value=b,e.value=new Set(f!=null?[f]:[])}function o(){s.value=!1,n.value=null,e.value=new Set}function l(b){const f=new Set(e.value);f.has(b)?f.delete(b):f.add(b),e.value=f,f.size===0&&o()}function r(){e.value=new Set}function d(b){return e.value.has(b)}return{selectedMessageIds:e,selectionMode:s,currentChatId:n,selectedCount:i,enterSelectionMode:a,exitSelectionMode:o,toggleMessage:l,clearSelection:r,isSelected:d}});async function kt(e,s){const{data:n}=await Y.get(`/chats/${e}/messages`,{params:s});return n}async function Ta(e,s){const{data:n}=await Y.post(`/chats/${e}/messages`,s);return n}async function Ea(e,s,n=!1){await Y.delete(`/chats/${e}/messages/${s}`,n?{data:{for_everyone:!0}}:void 0)}async function La(e,s,n){const{data:i}=await Y.put(`/chats/${e}/messages/${s}`,{content:n});return i}async function Ia(e,s){const{data:n}=await Y.post(`/chats/${e}/messages/forward`,s);return n}async function Aa(e,s){const{data:n}=await Y.post(`/chats/${e}/messages/${s}/pin`);return n}async function Ra(e,s){await Y.delete(`/chats/${e}/messages/${s}/pin`)}async function Da(e){const{data:s}=await Y.get(`/chats/${e}/pinned-message`);return s}async function Hn(e,s,n){const{data:i}=await Y.get(`/chats/${e}/messages/search`,{params:{q:s,...n}});return i}async function Oa(e,s,n){const{data:i}=await Y.post(`/chats/${e}/messages/${s}/reactions`,{emoji:n});return i}async function Pa(e,s){if(!s.length)return{};const{data:n}=await Y.get(`/chats/${e}/reactions`,{params:{message_ids:s.join(",")}});return n}const ft=Qe("messages",()=>{const e=y({}),s=y({}),n=y(null),i=y({}),a=y(new Set),o=ea(new Set);function l(S){return o.add(S),new Promise(A=>setTimeout(A,600))}function r(S){return o.has(S)}async function d(S){const A=e.value[S];if(!A||A.length===0)return;const V=A.map(F=>F.id);try{const F=await Pa(S,V);for(const ne of A)ne.reactions=F[String(ne.id)]||void 0}catch(F){console.error("Failed to load reactions",F)}}async function b(S){n.value=S;try{const A=await kt(S,{limit:50});e.value[S]=A,A.length>0&&(s.value[S]=Math.max(...A.map(V=>V.id))),await d(S)}catch(A){throw console.error("Failed to load messages",A),A}finally{n.value=null}}async function f(S){const A=s.value[S]||0;if(A===0)return[];try{const V=await kt(S,{after_id:A,limit:50});if(V.length>0){e.value[S]||(e.value[S]=[]);const F=new Set(e.value[S].map(ae=>ae.id)),ne=V.filter(ae=>!F.has(ae.id));e.value[S].push(...ne),s.value[S]=Math.max(...V.map(ae=>ae.id)),await d(S)}return V}catch(V){return console.error("Failed to load newer messages",V),[]}}async function p(S){const A=e.value[S];if(!A||A.length===0)return[];const V=A[0];if(!V)return[];try{const F=await kt(S,{before:V.created_at,limit:50});if(F.length>0){const ne=new Set(A.map(oe=>oe.id)),ae=F.filter(oe=>!ne.has(oe.id));e.value[S]=[...ae,...A],await d(S)}return F}catch(F){return console.error("Failed to load older messages",F),[]}}async function m(S,A,V){try{const F=await Oa(S,A,V);c(S,A,F.action,V,!0)}catch(F){console.error("Failed to toggle reaction",F)}}function c(S,A,V,F,ne){const ae=e.value[S];if(!ae)return;const oe=ae.find(C=>C.id===A);if(!oe)return;oe.reactions||(oe.reactions=[]);const G=oe.reactions.find(C=>C.emoji===F);V==="added"?G?(G.count++,ne&&(G.me=!0)):oe.reactions.push({emoji:F,count:1,me:ne}):G&&(G.count--,ne&&(G.me=!1),G.count<=0&&(oe.reactions=oe.reactions.filter(C=>C.emoji!==F))),oe.reactions.length===0&&(oe.reactions=void 0)}async function u(S,A,V="text",F){const ne=await Ta(S,{content:A,type:V,...F});e.value[S]||(e.value[S]=[]),g(S,ne);const ae=e.value[S].findIndex(oe=>oe.id===ne.id);return ae!==-1?e.value[S][ae]=ne:e.value[S].push(ne),s.value[S]=Math.max(s.value[S]||0,ne.id),ne}function g(S,A){if(!A.reply_to_message_id||A.reply_to_sender_username||A.reply_to_sender_name)return;const V=e.value[S];if(!V)return;const F=V.find(ne=>ne.id===A.reply_to_message_id);F&&(A.reply_to_sender_username=F.sender_username,A.reply_to_sender_name=F.sender_display_name||F.sender_username,!A.reply_to_content&&F.content&&(A.reply_to_content=F.content),!A.reply_to_type&&F.message_type&&(A.reply_to_type=F.message_type))}function E(S,A){e.value[S]||(e.value[S]=[]),e.value[S].find(F=>F.id===A.id)||(g(S,A),e.value[S].push(A),s.value[S]=Math.max(s.value[S]||0,A.id))}async function $(S,A,V=!1){try{await l(A),await Ea(S,A,V),_(S,A)}catch(F){throw console.error("Failed to delete message",F),F}finally{o.delete(A)}}function _(S,A){const V=e.value[S];V&&(e.value[S]=V.filter(F=>F.id!==A))}async function D(S,A,V){try{const F=await La(S,A,V);q(S,A,F.content,F.updated_at)}catch(F){throw console.error("Failed to edit message",F),F}}function q(S,A,V,F){const ne=e.value[S];if(!ne)return;const ae=ne.find(oe=>oe.id===A);ae&&(ae.content=V,ae.is_edited=!0,F&&(ae.updated_at=F))}async function K(S,A,V){try{const F=await Ia(S,{from_chat_id:A,message_ids:V});for(const ne of F)E(S,ne);return F}catch(F){throw console.error("Failed to forward messages",F),F}}async function U(S){try{const A=await Da(S);A&&A.message?i.value[S]={message:A.message,pinnedAt:A.pinned_at,pinnedBy:A.pinned_by}:i.value[S]=null}catch(A){console.error("Failed to load pinned message",A),i.value[S]=null}}async function te(S,A){try{const V=await Aa(S,A);i.value[S]={message:V.message,pinnedAt:V.pinned_at,pinnedBy:V.pinned_by},a.value.delete(S)}catch(V){throw console.error("Failed to pin message",V),V}}async function le(S,A){try{await Ra(S,A),i.value[S]=null}catch(V){throw console.error("Failed to unpin message",V),V}}function T(S,A,V,F){i.value[S]={message:F,pinnedAt:new Date().toISOString(),pinnedBy:V},a.value.delete(S)}function M(S){i.value[S]=null}function I(S){a.value.add(S)}function J(S){return e.value[S]||[]}const H=y({});function R(S,A,V){H.value[S]||(H.value[S]={});const F=H.value[S][A]||0;V>F&&(H.value[S][A]=V)}async function j(S){try{const A=await Sa(S);H.value[S]||(H.value[S]={});for(const V of A)H.value[S][V.user_id]=V.last_read_msg_id}catch(A){console.error("Failed to load read receipts",A)}}function he(S,A,V){const F=H.value[S];return F?V?(F[V]||0)>=A:Object.values(F).some(ne=>ne>=A):!1}function pe(S,A){const V=H.value[S];return V?Object.values(V).filter(F=>F>=A).length:0}return{messagesByChat:e,lastMsgId:s,loadingChat:n,loadMessages:b,loadNewer:f,loadOlder:p,sendMessage:u,pushMessage:E,getMessages:J,toggleReaction:m,applyReactionUpdate:c,deleteMessage:$,removeMessage:_,editMessage:D,applyMessageUpdate:q,forwardMessages:K,pinnedByChat:i,pinnedDismissed:a,loadPinnedMessage:U,pinMsg:te,unpinMsg:le,applyMessagePinned:T,applyMessageUnpinned:M,dismissPin:I,deletingMessages:o,markForDeletion:l,isDeleting:r,readReceipts:H,applyReadReceipt:R,loadReadReceipts:j,isMessageRead:he,getReadCount:pe}});function Na(e,s,n){if(!document.hidden||e.sender_id===n.user?.id||!mt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||s.chats.find(d=>d.id===e.chat_id)?.is_muted)return;const o=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(o,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),s.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function Ua(){const e=y(!1);let s=null,n=null,i=null,a=1e3,o=!1,l=null,r=!document.hidden&&document.hasFocus(),d=!1;function b(U){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"presence_update",status:U}))}function f(){const U=!document.hidden&&document.hasFocus();U&&!r?(l&&(clearTimeout(l),l=null),r=!0,b("active")):!U&&r&&(l||(l=setTimeout(()=>{l=null,r=!1,b("away")},3e3)))}function p(){d||(d=!0,document.addEventListener("visibilitychange",f),window.addEventListener("focus",f),window.addEventListener("blur",f))}function m(){d&&(d=!1,document.removeEventListener("visibilitychange",f),window.removeEventListener("focus",f),window.removeEventListener("blur",f),l&&(clearTimeout(l),l=null))}function c(){const U=localStorage.getItem("access_token");return U?`wss://ws.behappy.rest/ws?token=${encodeURIComponent(U)}`:null}function u(){if(s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING))return;const U=c();U&&(o=!1,s=new WebSocket(U),s.onopen=()=>{e.value=!0,a=1e3,r=!document.hidden&&document.hasFocus();const te=localStorage.getItem("access_token");te&&s.send(JSON.stringify({type:"auth",token:te,active:r}));const le=Ee();for(const T of le.chats)s.send(JSON.stringify({type:"subscribe",chat_id:T.id}));E(),p()},s.onmessage=te=>{try{const le=JSON.parse(te.data);g(le)}catch{}},s.onclose=()=>{e.value=!1,$(),o||_()},s.onerror=()=>{})}function g(U){const te=ft(),le=Ee(),T=Le();switch(U.type){case"message":{const M=U;te.pushMessage(M.chat_id,M),le.updateChatLastMessage(M.chat_id,M.content||(M.message_type==="sticker"?"Sticker":"Attachment"),M.created_at),M.chat_id!==le.activeChatId&&M.sender_id!==T.user?.id&&le.incrementUnread(M.chat_id),le.clearTyping(M.chat_id,M.sender_id),Na(M,le,T);break}case"typing":{const M=U.chat_id,I=U.user_id;if(I!==T.user?.id){const J=U.username||"Someone";le.setTyping(M,I,J)}break}case"pong":break;case"presence":{const M=U.user_id,I=U.status,J=U.last_seen_at,H=U.last_seen_bucket;if(I==="online")le.setUserOnline(M);else if(I==="offline"){const R=J||new Date().toISOString();le.setUserOffline(M,R,H)}break}case"message_deleted":{const M=U.chat_id,I=U.message_id;te.removeMessage(M,I);break}case"message_updated":{const M=U.chat_id,I=U.message_id,J=U.content,H=U.updated_at;te.applyMessageUpdate(M,I,J,H);break}case"message_pinned":{const M=U.chat_id,I=U.message_id,J=U.pinned_by,H=U.message;te.applyMessagePinned(M,I,J,H);break}case"message_unpinned":{const M=U.chat_id;te.applyMessageUnpinned(M);break}case"reaction":{const M=U.chat_id,I=U.message_id,J=U.user_id,H=U.emoji,R=U.action;te.applyReactionUpdate(M,I,R,H,J===T.user?.id);break}case"read_receipt":{const M=U.chat_id,I=U.user_id,J=U.last_read_msg_id;te.applyReadReceipt(M,I,J);break}}}function E(){$(),i=setInterval(()=>{s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},25e3)}function $(){i&&(clearInterval(i),i=null)}function _(){n||(n=setTimeout(()=>{n=null,u(),a=Math.min(a*2,3e4)},a))}function D(U){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"subscribe",chat_id:U}))}function q(U){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"typing",chat_id:U}))}function K(){o=!0,$(),m(),n&&(clearTimeout(n),n=null),s&&(s.close(),s=null),e.value=!1}return We(()=>{K()}),{connected:e,connect:u,disconnect:K,subscribeToChat:D,sendTyping:q}}async function ds(e){const{data:s}=await Y.get(`/users/${e}`);return s}async function vs(e){const{data:s}=await Y.get(`/users/by-username/${encodeURIComponent(e)}`);return s}async function Bn(e){const{data:s}=await Y.get("/users/search",{params:{q:e}});return s}async function Fa(e,s){const{data:n}=await Y.put(`/users/${e}`,s);return n}async function za(e){const{data:s}=await Y.put("/users/me/avatar",{file_id:e});return s}async function Ha(){const{data:e}=await Y.get("/stickers");return e}const Ba=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};const jn=e=>e==="";const ja=(...e)=>e.filter((s,n,i)=>!!s&&s.trim()!==""&&i.indexOf(s)===n).join(" ").trim();const Vn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const Va=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,n,i)=>i?i.toUpperCase():n.toLowerCase());const Wa=e=>{const s=Va(e);return s.charAt(0).toUpperCase()+s.slice(1)};var Ze={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const qa=({name:e,iconNode:s,absoluteStrokeWidth:n,"absolute-stroke-width":i,strokeWidth:a,"stroke-width":o,size:l=Ze.width,color:r=Ze.stroke,...d},{slots:b})=>un("svg",{...Ze,...d,width:l,height:l,stroke:r,"stroke-width":jn(n)||jn(i)||n===!0||i===!0?Number(a||o||Ze["stroke-width"])*24/Number(l):a||o||Ze["stroke-width"],class:ja("lucide",d.class,...e?[`lucide-${Vn(Wa(e))}-icon`,`lucide-${Vn(e)}`]:["lucide-icon"]),...!b.default&&!Ba(d)&&{"aria-hidden":"true"}},[...s.map(f=>un(...f)),...b.default?[b.default()]:[]]);const ee=(e,s)=>(n,{slots:i,attrs:a})=>un(qa,{...a,...n,iconNode:s,name:e},i);const Ve=ee("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Ga=ee("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);const ms=ee("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const Wn=ee("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);const Ka=ee("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const fs=ee("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const ps=ee("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const Ja=ee("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const hs=ee("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Qa=ee("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const Ya=ee("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const qn=ee("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const tn=ee("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Xa=ee("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Gn=ee("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const Za=ee("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);const ei=ee("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const ti=ee("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const wn=ee("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const _n=ee("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const ni=ee("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const si=ee("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const ai=ee("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const Kn=ee("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);const gs=ee("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const ii=ee("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);const oi=ee("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);const li=ee("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const ri=ee("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const ci=ee("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const ui=ee("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const ys=ee("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const bs=ee("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const Qt=ee("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const Fe=ee("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),di={class:"swipe-actions swipe-actions-left"},vi={class:"chat-item-info"},mi={class:"chat-item-top"},fi={class:"chat-item-name"},pi={class:"chat-item-time"},hi={class:"chat-item-bottom"},gi={class:"chat-item-preview"},yi=["title"],bi={class:"swipe-actions swipe-actions-right"},Jn=70,ki=se({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:s}){const n=e,i=Ee(),a=Le(),o=W(()=>n.chat.type==="direct"&&!n.chat.other_user_id),l=W(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:i.isUserOnline(n.chat.other_user_id)||null),r=W(()=>(n.chat.unread_count??0)>0),d=s,b=W(()=>{const $=n.chat;return o.value?"Saved Messages":$.type==="channel"||$.type==="group"?$.title||$.name||"Untitled":$.other_display_name||$.other_username||$.title||$.name||"Chat"});function f($){if(!$)return"";const _=new Date($.endsWith("Z")?$:$+"Z"),D=new Date;return _.toDateString()===D.toDateString()?_.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):_.toLocaleDateString([],{month:"short",day:"numeric"})}const p=y(0);let m=0,c=!1;function u($){m=$.touches[0].clientX,c=!0}function g($){if(!c)return;const _=$.touches[0].clientX-m;p.value=Math.max(-Jn,Math.min(Jn,_))}function E(){c=!1,p.value=0}return($,_)=>(v(),h("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:u,onTouchmove:g,onTouchend:E},[t("div",di,[t("button",{class:"swipe-action swipe-pin",onClick:_[0]||(_[0]=D=>d("togglePin"))},x(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:ve(["chat-item",{active:e.active,"chat-item-unread":r.value}]),style:vt({transform:`translateX(${p.value}px)`}),onClick:_[2]||(_[2]=D=>d("select")),onContextmenu:_[3]||(_[3]=ue(D=>d("contextmenu",D),["prevent"]))},[z(_e,{name:b.value,url:o.value?k(a).user?.avatar_url||null:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"md",online:l.value},null,8,["name","url","online"]),t("div",vi,[t("div",mi,[t("span",fi,[e.chat.type==="channel"?(v(),Q(k(_n),{key:0,class:"chat-type-icon",size:14,"stroke-width":2})):e.chat.type==="group"?(v(),Q(k(Qt),{key:1,class:"chat-type-icon",size:14,"stroke-width":2})):P("",!0),ke(" "+x(b.value)+" ",1),e.chat.is_pinned?(v(),Q(k(ii),{key:2,class:"status-icon",size:14,"stroke-width":1.8,title:"Pinned"})):P("",!0),e.chat.is_muted?(v(),Q(k(ms),{key:3,class:"status-icon status-icon-muted",size:14,"stroke-width":1.8,title:"Muted"})):P("",!0)]),t("span",pi,x(f(e.chat.last_at||e.chat.updated_at)),1)]),t("div",hi,[t("span",gi,x(e.chat.last_message||""),1),e.chat.unread_count>0?(v(),h("span",{key:0,class:ve(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},x(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):P("",!0)])]),t("button",{class:ve(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:_[1]||(_[1]=ue(D=>d("toggleFavorite"),["stop"]))},"â˜…",10,yi)],38),t("div",bi,[t("button",{class:"swipe-action swipe-mute",onClick:_[4]||(_[4]=D=>d("toggleMute"))},x(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),fe=(e,s)=>{const n=e.__vccOpts||e;for(const[i,a]of s)n[i]=a;return n},nn=fe(ki,[["__scopeId","data-v-e3cb05e4"]]),wi={class:"sidebar"},_i={class:"sidebar-header"},Ci={class:"search-wrap"},$i={class:"chat-list"},Si={key:0,class:"empty-state-small"},Mi={key:0,class:"chat-section-label"},xi={key:1,class:"chat-section-label"},Ti={key:2,class:"chat-section-label"},Ei=se({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:s}){const n=s,i=Ee(),a=y(""),o=W(()=>{const m=a.value.toLowerCase(),c=i.sortedChats.filter(u=>!u.is_archived);return m?c.filter(u=>{const g=b(u).toLowerCase(),E=(u.other_username||"").toLowerCase();return g.includes(m)||E.includes(m)}):c}),l=W(()=>o.value.filter(m=>m.is_pinned&&!m.is_favorite)),r=W(()=>o.value.filter(m=>m.is_favorite&&!m.is_pinned)),d=W(()=>o.value.filter(m=>!m.is_favorite&&!m.is_pinned));function b(m){return m.type==="channel"||m.type==="group"?m.title||m.name||"Untitled":m.type==="direct"&&!m.other_user_id?"Saved Messages":m.other_display_name||m.other_username||m.title||m.name||"Chat"}const f=y(null);nt("contextChatId",f);function p(m,c){m.preventDefault(),f.value=c,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:m.clientX,y:m.clientY,chatId:c}}))}return(m,c)=>(v(),h("aside",wi,[t("header",_i,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:c[0]||(c[0]=u=>n("openDrawer"))},[z(k(ni),{size:20})]),t("div",Ci,[z(k(oi),{size:16,class:"search-icon"}),de(t("input",{"onUpdate:modelValue":c[1]||(c[1]=u=>a.value=u),class:"search-input",type:"search",placeholder:"Search"},null,512),[[ye,a.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:c[2]||(c[2]=u=>n("openNewChat"))},[z(k(ci),{size:20})])]),t("div",$i,[o.value.length===0?(v(),h("div",Si,[...c[3]||(c[3]=[ke(" No conversations yet.",-1),t("br",null,null,-1),ke("Click the pencil icon to start one. ",-1)])])):(v(),h(ce,{key:1},[l.value.length>0?(v(),h("div",Mi,"Pinned")):P("",!0),(v(!0),h(ce,null,ge(l.value,u=>(v(),Q(nn,{key:u.id,chat:u,active:u.id===k(i).activeChatId,onSelect:g=>n("selectChat",u.id),onToggleFavorite:g=>k(i).toggleFavorite(u.id),onTogglePin:g=>k(i).togglePin(u.id),onToggleMute:g=>k(i).toggleMute(u.id),onToggleArchive:g=>k(i).toggleArchive(u.id),onContextmenu:g=>p(g,u.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(v(),h("div",xi,"Starred")):P("",!0),(v(!0),h(ce,null,ge(r.value,u=>(v(),Q(nn,{key:u.id,chat:u,active:u.id===k(i).activeChatId,onSelect:g=>n("selectChat",u.id),onToggleFavorite:g=>k(i).toggleFavorite(u.id),onTogglePin:g=>k(i).togglePin(u.id),onToggleMute:g=>k(i).toggleMute(u.id),onToggleArchive:g=>k(i).toggleArchive(u.id),onContextmenu:g=>p(g,u.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&d.value.length>0?(v(),h("div",Ti," All chats ")):P("",!0),(v(!0),h(ce,null,ge(d.value,u=>(v(),Q(nn,{key:u.id,chat:u,active:u.id===k(i).activeChatId,onSelect:g=>n("selectChat",u.id),onToggleFavorite:g=>k(i).toggleFavorite(u.id),onTogglePin:g=>k(i).togglePin(u.id),onToggleMute:g=>k(i).toggleMute(u.id),onToggleArchive:g=>k(i).toggleArchive(u.id),onContextmenu:g=>p(g,u.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function Li(){const e=y(!1),s=y(0);let n=null,i=[],a=null;async function o(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const f=await navigator.mediaDevices.getUserMedia({audio:!0});i=[],s.value=0,n=new MediaRecorder(f),n.ondataavailable=p=>{p.data.size&&i.push(p.data)},n.start(),e.value=!0,a=setInterval(()=>{s.value++},1e3)}function l(){return new Promise((f,p)=>{if(!n||n.state!=="recording"){p(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(E=>E.stop()),d(),e.value=!1;const m=n?.mimeType||"audio/webm",c=m.includes("ogg")?"ogg":"webm",u=new Blob(i,{type:m}),g=new File([u],`voice.${c}`,{type:m});f(g)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(f=>f.stop())},n.stop()),d(),e.value=!1,s.value=0}function d(){a&&(clearInterval(a),a=null)}function b(f){const p=Math.floor(f/60),m=f%60;return`${p}:${String(m).padStart(2,"0")}`}return{isRecording:e,seconds:s,startRecording:o,stopRecording:l,cancelRecording:r,formatTime:b}}async function Cn(e){const s=new FormData;s.append("file",e);const{data:n}=await Y.post("/files",s);return n}const Ii={class:"pin-bar-content"},Ai={class:"pin-bar-sender"},Ri={class:"pin-bar-text"},Di=se({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const s=e,n=W(()=>s.message.sender_display_name||s.message.sender_username||"Unknown"),i=W(()=>{const a=s.message;switch(a.message_type){case"sticker":return a.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return a.content||""}});return(a,o)=>(v(),h("div",{class:"pin-bar",onClick:o[1]||(o[1]=l=>a.$emit("click"))},[o[2]||(o[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",Ii,[t("span",Ai,x(n.value),1),t("span",Ri,x(i.value),1)]),t("button",{class:"pin-bar-close",onClick:o[0]||(o[0]=ue(l=>a.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}});function ks(e){const s=new Date(e),i=new Date().getTime()-s.getTime(),a=Math.floor(i/1e3),o=Math.floor(a/60),l=Math.floor(o/60),r=Math.floor(l/24);if(o<1)return"last seen just now";if(o<60)return`last seen ${o} minute${o!==1?"s":""} ago`;if(l<24)return`last seen ${l} hour${l!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const d=s.toLocaleString("en",{month:"short"}),b=s.getDate();return`last seen ${d} ${b}`}const Oi={class:"chat-header"},Pi={class:"chat-header-name"},Ni={key:0,class:"typing-dots"},Ui=se({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:s}){const n=s,i=Ee(),a=Le(),o=W(()=>i.activeChat),l=W(()=>{const u=o.value;return u?.type==="direct"&&!u.other_user_id}),r=W(()=>{const u=o.value;return u?l.value?"Saved Messages":u.type==="channel"||u.type==="group"?u.title||u.name||"Untitled":u.other_display_name||u.other_username||u.title||u.name||"Chat":"---"}),d=W(()=>{const u=o.value;if(u)return l.value?a.user?.avatar_url:u.type==="direct"?u.other_avatar_url:u.avatar_url}),b=W(()=>o.value?i.getTypingUsernames(o.value.id):[]),f=W(()=>b.value.length>0),p=W(()=>{const u=o.value;return!u||u.type!=="direct"||!u.other_user_id?!1:i.isUserOnline(u.other_user_id)}),m=W(()=>{if(b.value.length===1)return`${b.value[0]} is typing`;if(b.value.length>1)return`${b.value.length} people typing`;const u=o.value;if(!u)return"";if(l.value)return"personal storage";if(u.type==="channel"){const g=u.member_count??0;return`${g} subscriber${g!==1?"s":""}`}if(u.type==="group"){const g=u.member_count??0;return`${g} member${g!==1?"s":""}`}if(p.value)return"online";if(u.type==="direct"&&u.other_user_id){const g=i.getUserPresence(u.other_user_id);if(g){if(g.lastSeenAt)return ks(g.lastSeenAt);if(g.lastSeenBucket)return`last seen ${g.lastSeenBucket}`}}return u.other_username?"@"+u.other_username:""});Oe(()=>o.value?.id,()=>{const u=o.value;if(!u||u.type!=="direct"||!u.other_user_id)return;const g=u.other_user_id;i.getUserPresence(g)||ds(g).then(E=>{E.last_activity&&i.setUserPresence(g,{isOnline:i.isUserOnline(g),lastSeenAt:E.last_activity})}).catch(()=>{})},{immediate:!0});function c(){const u=o.value;u&&(u.type==="channel"||u.type==="group"?n("openChannelInfo"):u.type==="direct"&&u.other_username&&n("openUserProfile",u.other_username))}return(u,g)=>(v(),h("header",Oi,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:g[0]||(g[0]=E=>n("back"))},"â†"),z(_e,{class:"chat-header-avatar",name:r.value,url:d.value,online:p.value,size:"sm",onClick:c},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:c},[t("div",Pi,x(r.value),1),m.value?(v(),h("div",{key:0,class:ve(["chat-header-sub",{"typing-text":f.value,"online-text":p.value&&!f.value}])},[ke(x(m.value),1),f.value?(v(),h("span",Ni,[...g[2]||(g[2]=[t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1)])])):P("",!0)],2)):P("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:g[1]||(g[1]=E=>n("openSearch"))},"ğŸ”")]))}}),Fi=fe(Ui,[["__scopeId","data-v-16a49ec4"]]),zi="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Hi="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",vn="numeric",mn="ascii",fn="alpha",at="asciinumeric",tt="alphanumeric",pn="domain",ws="emoji",Bi="scheme",ji="slashscheme",sn="whitespace";function Vi(e,s){return e in s||(s[e]=[]),s[e]}function Ge(e,s,n){s[vn]&&(s[at]=!0,s[tt]=!0),s[mn]&&(s[at]=!0,s[fn]=!0),s[at]&&(s[tt]=!0),s[fn]&&(s[tt]=!0),s[tt]&&(s[pn]=!0),s[ws]&&(s[pn]=!0);for(const i in s){const a=Vi(i,n);a.indexOf(e)<0&&a.push(e)}}function Wi(e,s){const n={};for(const i in s)s[i].indexOf(e)>=0&&(n[i]=!0);return n}function $e(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}$e.groups={};$e.prototype={accepts(){return!!this.t},go(e){const s=this,n=s.j[e];if(n)return n;for(let i=0;i<s.jr.length;i++){const a=s.jr[i][0],o=s.jr[i][1];if(o&&a.test(e))return o}return s.jd},has(e,s=!1){return s?e in this.j:!!this.go(e)},ta(e,s,n,i){for(let a=0;a<e.length;a++)this.tt(e[a],s,n,i)},tr(e,s,n,i){i=i||$e.groups;let a;return s&&s.j?a=s:(a=new $e(s),n&&i&&Ge(s,n,i)),this.jr.push([e,a]),a},ts(e,s,n,i){let a=this;const o=e.length;if(!o)return a;for(let l=0;l<o-1;l++)a=a.tt(e[l]);return a.tt(e[o-1],s,n,i)},tt(e,s,n,i){i=i||$e.groups;const a=this;if(s&&s.j)return a.j[e]=s,s;const o=s;let l,r=a.go(e);if(r?(l=new $e,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new $e,o){if(i)if(l.t&&typeof l.t=="string"){const d=Object.assign(Wi(l.t,i),n);Ge(o,d,i)}else n&&Ge(o,n,i);l.t=o}return a.j[e]=l,l}};const X=(e,s,n,i,a)=>e.ta(s,n,i,a),me=(e,s,n,i,a)=>e.tr(s,n,i,a),Qn=(e,s,n,i,a)=>e.ts(s,n,i,a),L=(e,s,n,i,a)=>e.tt(s,n,i,a),Ue="WORD",hn="UWORD",_s="ASCIINUMERICAL",Cs="ALPHANUMERICAL",ut="LOCALHOST",gn="TLD",yn="UTLD",wt="SCHEME",Ke="SLASH_SCHEME",$n="NUM",bn="WS",Sn="NL",it="OPENBRACE",ot="CLOSEBRACE",_t="OPENBRACKET",Ct="CLOSEBRACKET",$t="OPENPAREN",St="CLOSEPAREN",Mt="OPENANGLEBRACKET",xt="CLOSEANGLEBRACKET",Tt="FULLWIDTHLEFTPAREN",Et="FULLWIDTHRIGHTPAREN",Lt="LEFTCORNERBRACKET",It="RIGHTCORNERBRACKET",At="LEFTWHITECORNERBRACKET",Rt="RIGHTWHITECORNERBRACKET",Dt="FULLWIDTHLESSTHAN",Ot="FULLWIDTHGREATERTHAN",Pt="AMPERSAND",Nt="APOSTROPHE",Ut="ASTERISK",Be="AT",Ft="BACKSLASH",zt="BACKTICK",Ht="CARET",je="COLON",Mn="COMMA",Bt="DOLLAR",Re="DOT",jt="EQUALS",xn="EXCLAMATION",Te="HYPHEN",lt="PERCENT",Vt="PIPE",Wt="PLUS",qt="POUND",rt="QUERY",Tn="QUOTE",$s="FULLWIDTHMIDDLEDOT",En="SEMI",De="SLASH",ct="TILDE",Gt="UNDERSCORE",Ss="EMOJI",Kt="SYM";var Ms=Object.freeze({__proto__:null,ALPHANUMERICAL:Cs,AMPERSAND:Pt,APOSTROPHE:Nt,ASCIINUMERICAL:_s,ASTERISK:Ut,AT:Be,BACKSLASH:Ft,BACKTICK:zt,CARET:Ht,CLOSEANGLEBRACKET:xt,CLOSEBRACE:ot,CLOSEBRACKET:Ct,CLOSEPAREN:St,COLON:je,COMMA:Mn,DOLLAR:Bt,DOT:Re,EMOJI:Ss,EQUALS:jt,EXCLAMATION:xn,FULLWIDTHGREATERTHAN:Ot,FULLWIDTHLEFTPAREN:Tt,FULLWIDTHLESSTHAN:Dt,FULLWIDTHMIDDLEDOT:$s,FULLWIDTHRIGHTPAREN:Et,HYPHEN:Te,LEFTCORNERBRACKET:Lt,LEFTWHITECORNERBRACKET:At,LOCALHOST:ut,NL:Sn,NUM:$n,OPENANGLEBRACKET:Mt,OPENBRACE:it,OPENBRACKET:_t,OPENPAREN:$t,PERCENT:lt,PIPE:Vt,PLUS:Wt,POUND:qt,QUERY:rt,QUOTE:Tn,RIGHTCORNERBRACKET:It,RIGHTWHITECORNERBRACKET:Rt,SCHEME:wt,SEMI:En,SLASH:De,SLASH_SCHEME:Ke,SYM:Kt,TILDE:ct,TLD:gn,UNDERSCORE:Gt,UTLD:yn,UWORD:hn,WORD:Ue,WS:bn});const Pe=/[a-z]/,et=new RegExp("\\p{L}","u"),an=new RegExp("\\p{Emoji}","u"),Ne=/\d/,on=/\s/,Yn="\r",ln=`
`,qi="ï¸",Gi="â€",rn="ï¿¼";let gt=null,yt=null;function Ki(e=[]){const s={};$e.groups=s;const n=new $e;gt==null&&(gt=Xn(zi)),yt==null&&(yt=Xn(Hi)),L(n,"'",Nt),L(n,"{",it),L(n,"}",ot),L(n,"[",_t),L(n,"]",Ct),L(n,"(",$t),L(n,")",St),L(n,"<",Mt),L(n,">",xt),L(n,"ï¼ˆ",Tt),L(n,"ï¼‰",Et),L(n,"ã€Œ",Lt),L(n,"ã€",It),L(n,"ã€",At),L(n,"ã€",Rt),L(n,"ï¼œ",Dt),L(n,"ï¼",Ot),L(n,"&",Pt),L(n,"*",Ut),L(n,"@",Be),L(n,"`",zt),L(n,"^",Ht),L(n,":",je),L(n,",",Mn),L(n,"$",Bt),L(n,".",Re),L(n,"=",jt),L(n,"!",xn),L(n,"-",Te),L(n,"%",lt),L(n,"|",Vt),L(n,"+",Wt),L(n,"#",qt),L(n,"?",rt),L(n,'"',Tn),L(n,"/",De),L(n,";",En),L(n,"~",ct),L(n,"_",Gt),L(n,"\\",Ft),L(n,"ãƒ»",$s);const i=me(n,Ne,$n,{[vn]:!0});me(i,Ne,i);const a=me(i,Pe,_s,{[at]:!0}),o=me(i,et,Cs,{[tt]:!0}),l=me(n,Pe,Ue,{[mn]:!0});me(l,Ne,a),me(l,Pe,l),me(a,Ne,a),me(a,Pe,a);const r=me(n,et,hn,{[fn]:!0});me(r,Pe),me(r,Ne,o),me(r,et,r),me(o,Ne,o),me(o,Pe),me(o,et,o);const d=L(n,ln,Sn,{[sn]:!0}),b=L(n,Yn,bn,{[sn]:!0}),f=me(n,on,bn,{[sn]:!0});L(n,rn,f),L(b,ln,d),L(b,rn,f),me(b,on,f),L(f,Yn),L(f,ln),me(f,on,f),L(f,rn,f);const p=me(n,an,Ss,{[ws]:!0});L(p,"#"),me(p,an,p),L(p,qi,p);const m=L(p,Gi);L(m,"#"),me(m,an,p);const c=[[Pe,l],[Ne,a]],u=[[Pe,null],[et,r],[Ne,o]];for(let g=0;g<gt.length;g++)He(n,gt[g],gn,Ue,c);for(let g=0;g<yt.length;g++)He(n,yt[g],yn,hn,u);Ge(gn,{tld:!0,ascii:!0},s),Ge(yn,{utld:!0,alpha:!0},s),He(n,"file",wt,Ue,c),He(n,"mailto",wt,Ue,c),He(n,"http",Ke,Ue,c),He(n,"https",Ke,Ue,c),He(n,"ftp",Ke,Ue,c),He(n,"ftps",Ke,Ue,c),Ge(wt,{scheme:!0,ascii:!0},s),Ge(Ke,{slashscheme:!0,ascii:!0},s),e=e.sort((g,E)=>g[0]>E[0]?1:-1);for(let g=0;g<e.length;g++){const E=e[g][0],_=e[g][1]?{[Bi]:!0}:{[ji]:!0};E.indexOf("-")>=0?_[pn]=!0:Pe.test(E)?Ne.test(E)?_[at]=!0:_[mn]=!0:_[vn]=!0,Qn(n,E,E,_)}return Qn(n,"localhost",ut,{ascii:!0}),n.jd=new $e(Kt),{start:n,tokens:Object.assign({groups:s},Ms)}}function xs(e,s){const n=Ji(s.replace(/[A-Z]/g,r=>r.toLowerCase())),i=n.length,a=[];let o=0,l=0;for(;l<i;){let r=e,d=null,b=0,f=null,p=-1,m=-1;for(;l<i&&(d=r.go(n[l]));)r=d,r.accepts()?(p=0,m=0,f=r):p>=0&&(p+=n[l].length,m++),b+=n[l].length,o+=n[l].length,l++;o-=p,l-=m,b-=p,a.push({t:f.t,v:s.slice(o-b,o),s:o-b,e:o})}return a}function Ji(e){const s=[],n=e.length;let i=0;for(;i<n;){let a=e.charCodeAt(i),o,l=a<55296||a>56319||i+1===n||(o=e.charCodeAt(i+1))<56320||o>57343?e[i]:e.slice(i,i+2);s.push(l),i+=l.length}return s}function He(e,s,n,i,a){let o;const l=s.length;for(let r=0;r<l-1;r++){const d=s[r];e.j[d]?o=e.j[d]:(o=new $e(i),o.jr=a.slice(),e.j[d]=o),e=o}return o=new $e(n),o.jr=a.slice(),e.j[s[l-1]]=o,o}function Xn(e){const s=[],n=[];let i=0,a="0123456789";for(;i<e.length;){let o=0;for(;a.indexOf(e[i+o])>=0;)o++;if(o>0){s.push(n.join(""));for(let l=parseInt(e.substring(i,i+o),10);l>0;l--)n.pop();i+=o}else n.push(e[i]),i++}return s}const dt={defaultProtocol:"http",events:null,format:Zn,formatHref:Zn,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Ln(e,s=null){let n=Object.assign({},dt);e&&(n=Object.assign(n,e instanceof Ln?e.o:e));const i=n.ignoreTags,a=[];for(let o=0;o<i.length;o++)a.push(i[o].toUpperCase());this.o=n,s&&(this.defaultRender=s),this.ignoreTags=a}Ln.prototype={o:dt,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,s,n){const i=s!=null;let a=this.o[e];return a&&(typeof a=="object"?(a=n.t in a?a[n.t]:dt[e],typeof a=="function"&&i&&(a=a(s,n))):typeof a=="function"&&i&&(a=a(s,n.t,n)),a)},getObj(e,s,n){let i=this.o[e];return typeof i=="function"&&s!=null&&(i=i(s,n.t,n)),i},render(e){const s=e.render(this);return(this.get("render",null,e)||this.defaultRender)(s,e.t,e)}};function Zn(e){return e}function Ts(e,s){this.t="token",this.v=e,this.tk=s}Ts.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const s=this.toString(),n=e.get("truncate",s,this),i=e.get("format",s,this);return n&&i.length>n?i.substring(0,n)+"â€¦":i},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=dt.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const s=this,n=this.toHref(e.get("defaultProtocol")),i=e.get("formatHref",n,this),a=e.get("tagName",n,s),o=this.toFormattedString(e),l={},r=e.get("className",n,s),d=e.get("target",n,s),b=e.get("rel",n,s),f=e.getObj("attributes",n,s),p=e.getObj("events",n,s);return l.href=i,r&&(l.class=r),d&&(l.target=d),b&&(l.rel=b),f&&Object.assign(l,f),{tagName:a,attributes:l,content:o,eventListeners:p}}};function Yt(e,s){class n extends Ts{constructor(a,o){super(a,o),this.t=e}}for(const i in s)n.prototype[i]=s[i];return n.t=e,n}const es=Yt("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),ts=Yt("text"),Qi=Yt("nl"),bt=Yt("url",{isLink:!0,toHref(e=dt.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==ut&&e[1].t===je}}),xe=e=>new $e(e);function Yi({groups:e}){const s=e.domain.concat([Pt,Ut,Be,Ft,zt,Ht,Bt,jt,Te,$n,lt,Vt,Wt,qt,De,Kt,ct,Gt]),n=[Nt,je,Mn,Re,xn,lt,rt,Tn,En,Mt,xt,it,ot,Ct,_t,$t,St,Tt,Et,Lt,It,At,Rt,Dt,Ot],i=[Pt,Nt,Ut,Ft,zt,Ht,Bt,jt,Te,it,ot,lt,Vt,Wt,qt,rt,De,Kt,ct,Gt],a=xe(),o=L(a,ct);X(o,i,o),X(o,e.domain,o);const l=xe(),r=xe(),d=xe();X(a,e.domain,l),X(a,e.scheme,r),X(a,e.slashscheme,d),X(l,i,o),X(l,e.domain,l);const b=L(l,Be);L(o,Be,b),L(r,Be,b),L(d,Be,b);const f=L(o,Re);X(f,i,o),X(f,e.domain,o);const p=xe();X(b,e.domain,p),X(p,e.domain,p);const m=L(p,Re);X(m,e.domain,p);const c=xe(es);X(m,e.tld,c),X(m,e.utld,c),L(b,ut,c);const u=L(p,Te);L(u,Te,u),X(u,e.domain,p),X(c,e.domain,p),L(c,Re,m),L(c,Te,u);const g=L(c,je);X(g,e.numeric,es);const E=L(l,Te),$=L(l,Re);L(E,Te,E),X(E,e.domain,l),X($,i,o),X($,e.domain,l);const _=xe(bt);X($,e.tld,_),X($,e.utld,_),X(_,e.domain,l),X(_,i,o),L(_,Re,$),L(_,Te,E),L(_,Be,b);const D=L(_,je),q=xe(bt);X(D,e.numeric,q);const K=xe(bt),U=xe();X(K,s,K),X(K,n,U),X(U,s,K),X(U,n,U),L(_,De,K),L(q,De,K);const te=L(r,je),le=L(d,je),T=L(le,De),M=L(T,De);X(r,e.domain,l),L(r,Re,$),L(r,Te,E),X(d,e.domain,l),L(d,Re,$),L(d,Te,E),X(te,e.domain,K),L(te,De,K),L(te,rt,K),X(M,e.domain,K),X(M,s,K),L(M,De,K);const I=[[it,ot],[_t,Ct],[$t,St],[Mt,xt],[Tt,Et],[Lt,It],[At,Rt],[Dt,Ot]];for(let J=0;J<I.length;J++){const[H,R]=I[J],j=L(K,H);L(U,H,j),L(j,R,K);const he=xe(bt);X(j,s,he);const pe=xe();X(j,n),X(he,s,he),X(he,n,pe),X(pe,s,he),X(pe,n,pe),L(he,R,K),L(pe,R,K)}return L(a,ut,_),L(a,Sn,Qi),{start:a,tokens:Ms}}function Xi(e,s,n){let i=n.length,a=0,o=[],l=[];for(;a<i;){let r=e,d=null,b=null,f=0,p=null,m=-1;for(;a<i&&!(d=r.go(n[a].t));)l.push(n[a++]);for(;a<i&&(b=d||r.go(n[a].t));)d=null,r=b,r.accepts()?(m=0,p=r):m>=0&&m++,a++,f++;if(m<0)a-=f,a<i&&(l.push(n[a]),a++);else{l.length>0&&(o.push(cn(ts,s,l)),l=[]),a-=m,f-=m;const c=p.t,u=n.slice(a-f,a);o.push(cn(c,s,u))}}return l.length>0&&o.push(cn(ts,s,l)),o}function cn(e,s,n){const i=n[0].s,a=n[n.length-1].e,o=s.slice(i,a);return new e(o,n)}const be={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Zi(){be.scanner=Ki(be.customSchemes);for(let e=0;e<be.tokenQueue.length;e++)be.tokenQueue[e][1]({scanner:be.scanner});be.parser=Yi(be.scanner.tokens);for(let e=0;e<be.pluginQueue.length;e++)be.pluginQueue[e][1]({scanner:be.scanner,parser:be.parser});return be.initialized=!0,be}function Es(e){return be.initialized||Zi(),Xi(be.parser.start,e,xs(be.scanner.start,e))}Es.scan=xs;function Ls(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function eo(e){return e.replace(/"/g,"&quot;")}function to(e){const s=[];for(const n in e){let i=e[n]+"";s.push(`${n}="${eo(i)}"`)}return s.join(" ")}function no({tagName:e,attributes:s,content:n}){return`<${e} ${to(s)}>${Ls(n)}</${e}>`}function Is(e,s={}){s=new Ln(s,no);const n=Es(e),i=[];for(let a=0;a<n.length;a++){const o=n[a];o.t==="nl"&&s.get("nl2br")?i.push(`<br>
`):!o.isLink||!s.check(o)?i.push(Ls(o.toString())):i.push(s.render(o))}return i.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(s){return Is(this,s)}});const so={},ao={class:"admin-badge",title:"Admin"};function io(e,s){return v(),h("span",ao,"âœ“")}const As=fe(so,[["render",io]]);function oo(e){const{delay:s=500,scrollThreshold:n=5,onLongPress:i,onCancel:a}=e,o=y(!1);let l=null,r=0,d=0,b=!1;function f(){l&&(clearTimeout(l),l=null)}function p(g){r=g.clientX,d=g.clientY,b=!1,o.value=!0,f(),l=setTimeout(()=>{b=!0,i(g)},s)}function m(g){if(!l)return;const E=g.clientX-r,$=g.clientY-d;(Math.abs(E)>n||Math.abs($)>n)&&u()}function c(){f(),o.value=!1}function u(){f(),o.value=!1,b||a?.()}return{isPressed:o,onPointerDown:p,onPointerUp:c,onPointerMove:m}}const lo=["data-message-id"],ro={key:0,class:"selection-checkbox"},co=["checked"],uo={key:1,class:"msg-sender-name"},vo={class:"msg-content-wrap"},mo={key:0,class:"msg-bubble sticker-bubble"},fo=["src","alt"],po={class:"msg-time"},ho={key:0,class:"msg-edited-label"},go={key:1,class:"msg-bubble"},yo={key:0,class:"msg-forwarded-label"},bo={class:"msg-reply-quote-name"},ko={class:"msg-reply-quote-text"},wo={class:"voice-player"},_o={class:"voice-dur"},Co={class:"msg-time"},$o={key:0,class:"msg-edited-label"},So={key:2,class:"msg-bubble"},Mo={key:0,class:"msg-forwarded-label"},xo={class:"msg-reply-quote-name"},To={class:"msg-reply-quote-text"},Eo=["innerHTML"],Lo={class:"msg-time"},Io={key:0,class:"msg-edited-label"},Ao={key:3,class:"reaction-chips"},Ro=["onClick"],Do={class:"reaction-emoji"},Oo={class:"reaction-count"},Po=se({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:s}){const n=e,i=s,a=Jt(),o=Ee(),l=ft(),r=W(()=>a.isSelected(n.message.id)),d=W(()=>l.deletingMessages.has(n.message.id)),b=Je("lastSentMessageId",y(null)),f=W(()=>n.isMine&&n.message.id===b.value),{onPointerDown:p,onPointerUp:m,onPointerMove:c}=oo({delay:500,onLongPress(C){E(C.clientX,C.clientY)}}),u={onPointerdown:p,onPointerup:m,onPointermove:c};function g(C){if(a.selectionMode){a.toggleMessage(n.message.id);return}E(C.clientX,C.clientY)}function E(C,B){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:o.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:C,y:B}}))}function $(){a.selectionMode&&a.toggleMessage(n.message.id)}const _=Le(),D=mt(),q=W(()=>{if(!D.readReceiptsEnabled)return null;const C=o.activeChat;if(!C)return null;const B=C.id;if(C.type==="direct"&&C.other_user_id===_.user?.id)return{text:"âœ“âœ“",cls:"read"};if(C.type==="direct")return l.isMessageRead(B,n.message.id,C.other_user_id)?{text:"âœ“âœ“",cls:"read"}:{text:"âœ“",cls:"sent"};const Z=l.getReadCount(B,n.message.id);return Z>0?{text:`âœ“âœ“ ${Z}`,cls:"read"}:{text:"âœ“",cls:"sent"}}),K=W(()=>{if(!n.message.forwarded_from_chat_id)return null;const C=n.message.forwarded_from_user_id;if(C&&C===_.user?.id)return null;const B=n.message.forwarded_from_display_name;return B?`Forwarded from ${B}`:"Forwarded"}),U=Je("stickers",y([])),te=W(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const C=U.value.find(B=>B.id===n.message.sticker_id);if(C)return C.url}return""}),le=W(()=>n.message.attachment_url||""),T=y(!1),M=y(0),I=y(0),J=y(n.message.duration_seconds||0);let H=null,R=null;function j(){return H||(H=new Audio(le.value),H.addEventListener("loadedmetadata",()=>{H&&isFinite(H.duration)&&(J.value=H.duration)}),H.addEventListener("ended",()=>{T.value=!1,M.value=0,I.value=0,pe()})),H}function he(){if(H&&T.value){I.value=H.currentTime;const C=H.duration;M.value=C&&isFinite(C)?H.currentTime/C*100:0,R=requestAnimationFrame(he)}}function pe(){R!==null&&(cancelAnimationFrame(R),R=null)}function S(){const C=j();T.value?(C.pause(),T.value=!1,pe()):(C.play(),T.value=!0,R=requestAnimationFrame(he))}function A(C){const B=j(),re=C.currentTarget.getBoundingClientRect(),Ie=Math.max(0,Math.min(1,(C.clientX-re.left)/re.width)),Me=B.duration;Me&&isFinite(Me)&&(B.currentTime=Ie*Me,I.value=B.currentTime,M.value=Ie*100)}const V=W(()=>{const C=J.value;return T.value||I.value>0?oe(Math.floor(I.value))+" / "+oe(Math.floor(C)):oe(Math.floor(C))});Oe(le,()=>{H&&(H.pause(),T.value=!1,pe(),H=null,M.value=0,I.value=0)}),We(()=>{H&&(H.pause(),H=null),pe()});const F=W(()=>{const C=n.message.reply_to_type;if(C==="sticker")return"ğŸ¨ Sticker";if(C==="voice")return"ğŸ¤ Voice message";if(C==="file")return"ğŸ“ File";const B=n.message.reply_to_content||"";return B.length>80?B.slice(0,80)+"...":B}),ne=W(()=>Is(n.message.content||"",{defaultProtocol:"https",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(B,Z,re)=>Z||`<span class="mention" data-u="${re}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${re}'}))">@${re}</span>`));function ae(C){if(!C)return"";const B=new Date(C.endsWith("Z")?C:C+"Z"),Z=new Date;return B.toDateString()===Z.toDateString()?B.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):B.toLocaleDateString([],{month:"short",day:"numeric"})}function oe(C){const B=Math.floor(C/60),Z=C%60;return`${B}:${String(Z).padStart(2,"0")}`}function G(C){const B=C.target.getBoundingClientRect();i("openEmojiPicker",n.message.id,B.left,B.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(C=>{i("mentionClick",C.detail)})),(C,B)=>(v(),h("div",ta({class:["msg-row",[e.isMine?"mine":"theirs",{selected:r.value,"msg-deleting":d.value,"msg-new":f.value}]],"data-message-id":e.message.id,onContextmenu:ue(g,["prevent"])},u,{onClick:$}),[k(a).selectionMode?(v(),h("div",ro,[t("input",{type:"checkbox",checked:r.value,tabindex:"-1"},null,8,co)])):P("",!0),!e.isMine&&e.message.message_type!=="sticker"?(v(),h("div",uo,[ke(x(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(v(),Q(As,{key:0})):P("",!0)])):P("",!0),t("div",vo,[e.message.message_type==="sticker"?(v(),h("div",mo,[t("img",{class:"sticker-img",src:te.value,alt:e.message.sticker_label||"sticker"},null,8,fo),t("div",po,[e.message.is_edited?(v(),h("span",ho,"(edited)")):P("",!0),ke(" "+x(ae(e.message.created_at)),1),e.isMine&&q.value?(v(),h("span",{key:1,class:ve(["msg-read-check",q.value.cls])},x(q.value.text),3)):P("",!0)])])):e.message.message_type==="voice"?(v(),h("div",go,[K.value?(v(),h("div",yo,x(K.value),1)):P("",!0),e.message.reply_to_message_id?(v(),h("div",{key:1,class:"msg-reply-quote",onClick:B[0]||(B[0]=ue(Z=>i("replyClick",e.message.reply_to_message_id),["stop"]))},[B[2]||(B[2]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",bo,x(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",ko,x(F.value),1)])])):P("",!0),t("div",wo,[t("button",{class:"voice-play-btn",onClick:ue(S,["stop"])},x(T.value?"â¸":"â–¶"),1),t("div",{class:"voice-track",onClick:ue(A,["stop"])},[t("div",{class:"voice-progress",style:vt({width:M.value+"%"})},null,4)]),t("span",_o,x(V.value),1)]),t("div",Co,[e.message.is_edited?(v(),h("span",$o,"(edited)")):P("",!0),ke(" "+x(ae(e.message.created_at)),1),e.isMine&&q.value?(v(),h("span",{key:1,class:ve(["msg-read-check",q.value.cls])},x(q.value.text),3)):P("",!0)])])):(v(),h("div",So,[K.value?(v(),h("div",Mo,x(K.value),1)):P("",!0),e.message.reply_to_message_id?(v(),h("div",{key:1,class:"msg-reply-quote",onClick:B[1]||(B[1]=ue(Z=>i("replyClick",e.message.reply_to_message_id),["stop"]))},[B[3]||(B[3]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",xo,x(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",To,x(F.value),1)])])):P("",!0),t("div",{class:"msg-text",innerHTML:ne.value},null,8,Eo),t("div",Lo,[e.message.is_edited?(v(),h("span",Io,"(edited)")):P("",!0),ke(" "+x(ae(e.message.created_at)),1),e.isMine&&q.value?(v(),h("span",{key:1,class:ve(["msg-read-check",q.value.cls])},x(q.value.text),3)):P("",!0)])])),t("button",{class:"reaction-add-btn",onClick:ue(G,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(v(),h("div",Ao,[(v(!0),h(ce,null,ge(e.message.reactions,Z=>(v(),h("button",{key:Z.emoji,class:ve(["reaction-chip",{"reaction-mine":Z.me}]),onClick:ue(re=>i("toggleReaction",e.message.id,Z.emoji),["stop"])},[t("span",Do,x(Z.emoji),1),t("span",Oo,x(Z.count),1)],10,Ro))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:ue(G,["stop"])},"+")])):P("",!0)])],16,lo))}}),No={class:"composer-wrapper"},Uo={key:0,class:"reply-preview"},Fo={class:"reply-preview-content"},zo={class:"reply-preview-sender"},Ho={class:"reply-preview-text"},Bo={key:1,class:"reply-preview edit-preview"},jo={class:"reply-preview-content"},Vo={class:"reply-preview-text"},Wo={class:"composer"},qo=["onKeydown"],Go=se({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(e,{expose:s,emit:n}){const i=e,a=n,o=y(""),l=y(null),r=y(null),d=y(null);let b=0;function f(){const _=o.value.trim();_&&(d.value?(a("editMessage",d.value.messageId,_),d.value=null):r.value?(a("send",_,{...r.value}),r.value=null):a("send",_),o.value="",$())}function p(){r.value=null,l.value?.focus()}function m(){d.value=null,o.value="",$(),l.value?.focus()}function c(){r.value?p():d.value&&m()}function u(_){const D=_.detail;D&&(d.value=null,r.value={messageId:D.messageId,senderName:D.senderName||"Unknown",snippet:(D.text||"").slice(0,100)},Ce(()=>l.value?.focus()))}function g(_){const D=_.detail;D&&(r.value=null,d.value={messageId:D.messageId,snippet:(D.text||"").slice(0,100),fullText:D.text||""},o.value=d.value.fullText,Ce(()=>{$(),l.value?.focus()}))}function E(){$();const _=Date.now();_-b>2e3&&o.value.trim().length>0&&(b=_,a("typing"))}function $(){const _=l.value;_&&(_.style.height="auto",_.style.height=Math.min(_.scrollHeight,120)+"px")}return we(()=>{l.value?.focus(),window.addEventListener("reply-to-message",u),window.addEventListener("edit-message",g)}),We(()=>{window.removeEventListener("reply-to-message",u),window.removeEventListener("edit-message",g)}),Oe(()=>i.replyTo,_=>{_&&l.value?.focus()}),s({focus:()=>l.value?.focus()}),(_,D)=>(v(),h("div",No,[r.value?(v(),h("div",Uo,[D[3]||(D[3]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",Fo,[t("span",zo,x(r.value.senderName),1),t("span",Ho,x(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:p},"âœ•")])):P("",!0),d.value?(v(),h("div",Bo,[D[5]||(D[5]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",jo,[D[4]||(D[4]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",Vo,x(d.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:m},"âœ•")])):P("",!0),t("div",Wo,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:D[0]||(D[0]=q=>a("toggleStickers"))},"ğŸŒ"),de(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":D[1]||(D[1]=q=>o.value=q),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[dn(ue(f,["exact","prevent"]),["enter"]),dn(c,["escape"])],onInput:E},null,40,qo),[[ye,o.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:D[2]||(D[2]=q=>a("startRecording"))},"ğŸ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:f},"â¤")])]))}}),Ko=fe(Go,[["__scopeId","data-v-df4ad9ba"]]),Jo={class:"sticker-grid"},Qo=["title","onClick"],Yo=["src","alt"],Xo={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Zo=se({__name:"StickerPicker",emits:["select"],setup(e,{emit:s}){const n=s,i=Je("stickers",y([])),a=W(()=>i.value);return(o,l)=>(v(),h("div",Jo,[(v(!0),h(ce,null,ge(a.value,r=>(v(),h("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:d=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,Yo)],8,Qo))),128)),a.value.length===0?(v(),h("div",Xo," No stickers available ")):P("",!0)]))}}),el={},tl={class:"msgs-loading"};function nl(e,s){return v(),h("div",tl,"Loading...")}const ns=fe(el,[["render",nl]]),sl=["onClick"],al=se({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:s}){const n=s,i=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(a,o)=>e.visible?(v(),h("div",{key:0,class:"emoji-picker",style:vt({left:e.x+"px",top:e.y+"px"}),onClick:o[0]||(o[0]=ue(()=>{},["stop"]))},[(v(),h(ce,null,ge(i,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},x(l),9,sl)),64))],4)):P("",!0)}}),il=se({__name:"MessageContextMenu",setup(e){const{showToast:s}=Se(),n=Le(),i=ft(),a=y(!1),o=y(0),l=y(0),r=y(null),d=y(null),b=y(""),f=y(""),p=y(""),m=y(null),c=W(()=>!m.value||!n.user?!1:m.value===n.user.id),u=W(()=>!d.value||!r.value?null:`${window.location.origin}/c/${d.value}/${r.value}`),g=W(()=>!d.value||!r.value?!1:i.pinnedByChat[d.value]?.message?.id===r.value);function E(I){r.value=I.detail.messageId,d.value=I.detail.chatId,b.value=I.detail.text||"",f.value=I.detail.messageType||"text",p.value=I.detail.senderName||"",m.value=I.detail.senderId??null,o.value=I.detail.x,l.value=I.detail.y,a.value=!0,requestAnimationFrame(()=>{const J=document.querySelector(".msg-context-menu");if(!J)return;const H=J.getBoundingClientRect();H.right>window.innerWidth&&(o.value=window.innerWidth-H.width-8),H.bottom>window.innerHeight&&(l.value=window.innerHeight-H.height-8)})}function $(){a.value&&(a.value=!1,r.value=null,d.value=null,b.value="",f.value="",p.value="",m.value=null)}we(()=>{window.addEventListener("show-message-context-menu",E),document.addEventListener("click",$)}),We(()=>{window.removeEventListener("show-message-context-menu",E),document.removeEventListener("click",$)});function _(){a.value=!1}function D(){_(),!(!r.value||!d.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:r.value,chatId:d.value,senderName:p.value,text:b.value}}))}function q(){_(),!(!r.value||!d.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:r.value,chatId:d.value,text:b.value}}))}async function K(){_();try{await navigator.clipboard.writeText(b.value),s("Copied to clipboard")}catch{s("Failed to copy text")}}async function U(){if(_(),!!u.value)try{await navigator.clipboard.writeText(u.value),s("Link copied")}catch{s("Failed to copy link")}}function te(){_(),!(!r.value||!d.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[r.value],chatId:d.value}}))}function le(){_(),!(!r.value||!d.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:r.value,chatId:d.value}}))}function T(){if(_(),!r.value||!d.value)return;const I=g.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(I,{detail:{messageId:r.value,chatId:d.value}}))}function M(){_(),!(!r.value||!d.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:r.value,chatId:d.value}}))}return(I,J)=>(v(),Q(is,{to:"body"},[a.value?(v(),h("div",{key:0,class:"msg-context-menu",style:vt({left:o.value+"px",top:l.value+"px"}),onClick:J[0]||(J[0]=ue(()=>{},["stop"])),onContextmenu:J[1]||(J[1]=ue(()=>{},["prevent"]))},[t("button",{class:"ctx-item",onClick:D}," Reply "),c.value&&f.value==="text"?(v(),h("button",{key:0,class:"ctx-item",onClick:q}," Edit ")):P("",!0),t("button",{class:"ctx-item",onClick:T},x(g.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:K}," Copy text "),u.value?(v(),h("button",{key:1,class:"ctx-item",onClick:U}," Copy link ")):P("",!0),t("button",{class:"ctx-item",onClick:te}," Forward "),t("button",{class:"ctx-item",onClick:le}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:M}," Delete ")],36)):P("",!0)]))}}),ol=fe(il,[["__scopeId","data-v-9e4a9a9d"]]),ll={key:0,class:"selection-bar"},rl={class:"selection-bar-count"},cl={class:"selection-bar-actions"},ul=["disabled"],dl=["disabled"],vl=se({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:s}){const n=s,i=Jt();return(a,o)=>(v(),Q(os,{name:"slide-down"},{default:kn(()=>[k(i).selectionMode?(v(),h("div",ll,[t("button",{class:"selection-bar-btn cancel-btn",onClick:o[0]||(o[0]=l=>k(i).exitSelectionMode())}," Cancel "),t("span",rl,x(k(i).selectedCount)+" selected",1),t("div",cl,[t("button",{class:"selection-bar-btn forward-btn",disabled:k(i).selectedCount===0,onClick:o[1]||(o[1]=l=>n("forward"))}," Forward ("+x(k(i).selectedCount)+") ",9,ul),t("button",{class:"selection-bar-btn delete-btn",disabled:k(i).selectedCount===0,onClick:o[2]||(o[2]=l=>n("delete"))}," Delete ("+x(k(i).selectedCount)+") ",9,dl)])])):P("",!0)]),_:1}))}}),ml=fe(vl,[["__scopeId","data-v-9ba988f2"]]),fl=se({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const n=s;function i(){n("close")}return(a,o)=>(v(),Q(is,{to:"body"},[z(os,{name:"bottom-sheet"},{default:kn(()=>[e.visible?(v(),h("div",{key:0,class:"bottom-sheet-backdrop",onClick:ue(i,["self"])},[t("div",{class:"bottom-sheet",onClick:o[0]||(o[0]=ue(()=>{},["stop"]))},[o[1]||(o[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),ls(a.$slots,"default",{},void 0,!0)])])):P("",!0)]),_:3})]))}}),pl=fe(fl,[["__scopeId","data-v-9712ffdf"]]),hl={class:"modal"},gl={class:"modal-header"},yl={class:"modal-body"},bl={class:"forward-chat-list"},kl={key:0,class:"empty-state-small"},wl=["onClick"],_l={class:"forward-chat-info"},Cl={class:"forward-chat-name"},$l={class:"forward-chat-type"},Sl={key:0,class:"forward-check"},Ml={class:"modal-actions"},xl=["disabled"],Tl=se({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:s}){const n=e,i=s,a=Ee(),o=ft(),{showToast:l}=Se(),r=y(""),d=y(null),b=y(!1),f=W(()=>{const g=r.value.toLowerCase().trim(),E=a.sortedChats;return g?E.filter($=>p($).toLowerCase().includes(g)):E});function p(g){return g.type==="direct"?g.other_user_id?g.other_display_name||g.other_username||g.title||"Direct Chat":"Saved Messages":g.title||g.name||"Unnamed Chat"}function m(g){if(g.type==="direct")return g.other_avatar_url??void 0}function c(){}async function u(){if(d.value!==null){b.value=!0;try{await o.forwardMessages(d.value,n.fromChatId,n.messageIds),l("Message forwarded!"),i("forwarded",d.value)}catch{l("Failed to forward message")}finally{b.value=!1}}}return(g,E)=>(v(),h("div",{class:"modal-backdrop",onClick:E[2]||(E[2]=ue($=>i("close"),["self"]))},[t("div",hl,[t("div",gl,[E[3]||(E[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:E[0]||(E[0]=$=>i("close"))},"âœ•")]),t("div",yl,[de(t("input",{"onUpdate:modelValue":E[1]||(E[1]=$=>r.value=$),class:"search-input",type:"search",placeholder:"Search chats...",onInput:c},null,544),[[ye,r.value]]),t("div",bl,[f.value.length===0?(v(),h("div",kl,"No chats found.")):P("",!0),(v(!0),h(ce,null,ge(f.value,$=>(v(),h("div",{key:$.id,class:ve(["forward-chat-item",{selected:d.value===$.id}]),onClick:_=>d.value=$.id},[z(_e,{name:p($),url:m($),size:"sm"},null,8,["name","url"]),t("div",_l,[t("div",Cl,x(p($)),1),t("div",$l,x($.type),1)]),d.value===$.id?(v(),h("span",Sl,"âœ“")):P("",!0)],10,wl))),128))]),t("div",Ml,[t("button",{class:"btn btn-primary",disabled:d.value===null||b.value,onClick:u},x(b.value?"Forwarding...":"Forward"),9,xl)])])])]))}}),El=fe(Tl,[["__scopeId","data-v-4e477e89"]]),Ll={class:"modal modal-sm"},Il={class:"modal-header"},Al={class:"modal-body"},Rl={class:"delete-confirm-text"},Dl={key:0,class:"delete-checkbox-label"},Ol={class:"modal-actions"},Pl=se({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:s}){const n=s,i=y(!1);function a(){n("confirm",i.value)}return(o,l)=>(v(),h("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=ue(r=>n("close"),["self"]))},[t("div",Ll,[t("div",Il,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",Al,[t("p",Rl," Are you sure you want to delete "+x(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(v(),h("label",Dl,[de(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>i.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[na,i.value]]),l[5]||(l[5]=ke(" Delete for everyone ",-1))])):P("",!0)]),t("div",Ol,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:a},"Delete")])])]))}}),Nl=fe(Pl,[["__scopeId","data-v-388dbae2"]]),pt=Qe("channel",()=>{const e=y(null),s=y([]),n=y(!1),i=W(()=>s.value.length),a=W(()=>s.value.filter(p=>p.role==="admin"||p.role==="owner").length),o=W(()=>{const p=Le();return p.user?s.value.find(c=>c.id===p.user.id)?.role??null:null}),l=W(()=>o.value==="owner"),r=W(()=>o.value==="admin"||o.value==="owner");async function d(p){n.value=!0;try{e.value=await cs(p)}catch(m){console.error("Failed to load channel detail",m)}finally{n.value=!1}}async function b(p){try{s.value=await Ca(p)}catch(m){console.error("Failed to load channel members",m)}}async function f(p,m){try{e.value=await $a(p,m)}catch(c){throw console.error("Failed to update channel",c),c}}return{detail:e,members:s,loading:n,memberCount:i,adminCount:a,myRole:o,isOwner:l,isAdmin:r,loadDetail:d,loadMembers:b,updateChannel:f}}),Ul=Qe("invites",()=>{const e=y([]),s=y(!1);async function n(o){s.value=!0;try{e.value=await oa(o)}catch(l){console.error("Failed to load invites",l)}finally{s.value=!1}}async function i(o){try{const l=await la(o);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function a(o){const l=[...e.value];e.value=e.value.filter(r=>r.token!==o);try{await ra(o)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:s,loadInvites:n,createInvite:i,revokeInvite:a}}),Fl={class:"invite-links-view"},zl={class:"view-header"},Hl={style:{padding:"0 1rem .5rem"}},Bl=["disabled"],jl={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},Vl={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},Wl={key:2,class:"invite-list",style:{padding:"0 1rem"}},ql={class:"invite-item-info"},Gl={class:"invite-token"},Kl={class:"invite-date"},Jl={class:"invite-item-actions"},Ql=["onClick"],Yl=["onClick"],Xl=se({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,i=s,a=Ul(),{showToast:o}=Se(),l=y(!1);function r(p){return new Date(p).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function d(p){const m=`${window.location.origin}/join/${p}`;navigator.clipboard&&navigator.clipboard.writeText(m).then(()=>o("Link copied!"))}async function b(){l.value=!0;try{await a.createInvite(n.chatId),o("Invite link created")}catch{o("Failed to create invite")}finally{l.value=!1}}async function f(p){try{await a.revokeInvite(p),o("Invite revoked")}catch{o("Failed to revoke invite")}}return we(()=>a.loadInvites(n.chatId)),(p,m)=>(v(),h("div",Fl,[t("div",zl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:m[0]||(m[0]=c=>i("back"))},[z(k(Ve),{size:20,"stroke-width":2})]),m[1]||(m[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",Hl,[t("button",{class:"btn btn-sm btn-outline",onClick:b,disabled:l.value},x(l.value?"Creating...":"Create Invite Link"),9,Bl)]),k(a).loading?(v(),h("div",jl," Loading... ")):k(a).invites.length===0?(v(),h("div",Vl," No active invite links ")):(v(),h("div",Wl,[(v(!0),h(ce,null,ge(k(a).invites,c=>(v(),h("div",{key:c.id,class:"invite-item"},[t("div",ql,[t("code",Gl,x(c.token),1),t("span",Kl,x(r(c.created_at)),1)]),t("div",Jl,[t("button",{class:"icon-btn",title:"Copy link",onClick:u=>d(c.token)},[z(k(hs),{size:16,"stroke-width":2})],8,Ql),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:u=>f(c.token)}," Revoke ",8,Yl)])]))),128))]))]))}}),Zl=fe(Xl,[["__scopeId","data-v-97b82dd0"]]);async function er(e,s){await Y.post(`/chats/${e}/avatar`,{file_id:s})}async function tr(e,s){return(await Y.post(`/chats/${e}/members/${s}/promote`)).data}async function nr(e,s){return(await Y.post(`/chats/${e}/members/${s}/demote`)).data}const sr={class:"admins-view"},ar={class:"view-header"},ir={class:"search-bar"},or={key:0,class:"member-empty"},lr={key:1,class:"member-list"},rr=["onClick"],cr={class:"member-info"},ur={class:"member-name"},dr={class:"role-badge"},vr={class:"view-footer"},mr={key:0,class:"member-empty"},fr={key:1,class:"member-list"},pr={class:"member-info"},hr={class:"member-name"},gr=["onClick"],yr={key:2,class:"view-footer"},br=se({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,i=s,a=pt(),o=y(!1),l=y(""),r=W(()=>a.members.filter(m=>m.role==="admin"||m.role==="owner")),d=W(()=>a.members.filter(m=>m.role==="member")),b=W(()=>{const m=l.value.toLowerCase().trim();return m?d.value.filter(c=>c.username.toLowerCase().includes(m)||c.display_name&&c.display_name.toLowerCase().includes(m)):d.value});async function f(m){try{await tr(n.chatId,m);const c=a.members.find(u=>u.id===m);c&&(c.role="admin"),o.value=!1,l.value=""}catch{}}async function p(m){try{await nr(n.chatId,m);const c=a.members.find(u=>u.id===m);c&&(c.role="member")}catch{}}return(m,c)=>(v(),h("div",sr,[t("div",ar,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=u=>i("back"))},[z(k(Ve),{size:20,"stroke-width":2})]),c[4]||(c[4]=t("span",{class:"view-title"},"Administrators",-1))]),o.value?(v(),h(ce,{key:0},[t("div",ir,[de(t("input",{"onUpdate:modelValue":c[1]||(c[1]=u=>l.value=u),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ye,l.value]])]),b.value.length===0?(v(),h("div",or,x(l.value?"No members found":"No members to promote"),1)):(v(),h("div",lr,[(v(!0),h(ce,null,ge(b.value,u=>(v(),h("div",{key:u.id,class:"member-item member-item--selectable",onClick:g=>f(u.id)},[z(_e,{name:u.display_name||u.username,url:u.avatar_url,size:"md"},null,8,["name","url"]),t("div",cr,[t("span",ur,x(u.display_name||u.username),1),t("span",dr,x(u.role),1)])],8,rr))),128))])),t("div",vr,[t("button",{class:"btn btn--secondary",onClick:c[2]||(c[2]=u=>o.value=!1)},"Cancel")])],64)):(v(),h(ce,{key:1},[r.value.length===0?(v(),h("div",mr," No administrators found ")):(v(),h("div",fr,[(v(!0),h(ce,null,ge(r.value,u=>(v(),h("div",{key:u.id,class:"member-item"},[z(_e,{name:u.display_name||u.username,url:u.avatar_url,size:"md"},null,8,["name","url"]),t("div",pr,[t("span",hr,x(u.display_name||u.username),1),t("span",{class:ve(["role-badge",`role-badge--${u.role}`])},x(u.role),3)]),k(a).isOwner&&u.role==="admin"?(v(),h("button",{key:0,class:"btn btn--small btn--danger",onClick:g=>p(u.id)}," Demote ",8,gr)):P("",!0)]))),128))])),k(a).isOwner?(v(),h("div",yr,[t("button",{class:"btn btn--primary",onClick:c[3]||(c[3]=u=>o.value=!0)},"Add Admin")])):P("",!0)],64))]))}}),kr=fe(br,[["__scopeId","data-v-2bd7c861"]]),wr={class:"subscribers-view"},_r={class:"view-header"},Cr={class:"search-bar"},$r={key:0,class:"member-empty"},Sr={key:1,class:"member-list"},Mr={class:"member-info"},xr={class:"member-name"},Tr=se({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=s,i=pt(),a=y(""),o=W(()=>{const l=a.value.toLowerCase().trim();return l?i.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):i.members});return(l,r)=>(v(),h("div",wr,[t("div",_r,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=d=>n("back"))},[z(k(Ve),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",Cr,[de(t("input",{"onUpdate:modelValue":r[1]||(r[1]=d=>a.value=d),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ye,a.value]])]),o.value.length===0?(v(),h("div",$r,x(a.value?"No members found":"No subscribers"),1)):(v(),h("div",Sr,[(v(!0),h(ce,null,ge(o.value,d=>(v(),h("div",{key:d.id,class:"member-item"},[z(_e,{name:d.display_name||d.username,url:d.avatar_url,size:"md"},null,8,["name","url"]),t("div",Mr,[t("span",xr,x(d.display_name||d.username),1),t("span",{class:ve(["role-badge",`role-badge--${d.role}`])},x(d.role),3)])]))),128))]))]))}}),Er=fe(Tr,[["__scopeId","data-v-f99a8a5f"]]),Lr={class:"modal profile-modal"},Ir={class:"profile-modal-body profile-modal-body--scrollable"},Ar={class:"profile-avatar-section profile-avatar-upload-section"},Rr={class:"profile-avatar-overlay"},Dr={class:"profile-info-list"},Or={class:"form-group"},Pr={class:"form-label"},Nr=["placeholder"],Ur={class:"form-group"},Fr=["placeholder"],zr={key:0,class:"form-group"},Hr={class:"form-label"},Br={class:"type-selector"},jr={class:"type-option"},Vr={class:"type-option"},Wr={class:"profile-edit-actions"},qr=["disabled"],Gr=se({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:s}){const n=e,i=s,a=pt(),{showToast:o}=Se(),l=y(""),r=y(""),d=y(void 0),b=y("public"),f=y(!1),p=y(null),m=W(()=>a.detail?.type==="group"),c=W(()=>m.value?"Group":"Channel");we(()=>{a.detail&&(l.value=a.detail.title||"",r.value=a.detail.description||"",d.value=a.detail.avatar_url??void 0,b.value=a.detail.public_name?"public":"private")});async function u(){const E=p.value?.files?.[0];if(E){try{const $=await Cn(E);await er(n.chatId,$.id),d.value=URL.createObjectURL(E),o("Avatar updated!")}catch{o("Avatar upload failed")}p.value&&(p.value.value="")}}async function g(){if(!l.value.trim()){o(`${c.value} name is required`);return}f.value=!0;try{await a.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),o(`${c.value} updated!`),i("saved"),i("close")}catch{o(`Failed to update ${c.value.toLowerCase()}`)}finally{f.value=!1}}return(E,$)=>(v(),h("div",{class:"modal-backdrop profile-backdrop",onClick:$[7]||($[7]=ue(_=>i("close"),["self"]))},[t("div",Lr,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:$[0]||($[0]=_=>i("close"))},[z(k(Fe),{size:20,"stroke-width":2})]),t("div",Ir,[t("div",Ar,[t("div",{class:"profile-avatar-upload-wrap",onClick:$[1]||($[1]=_=>p.value?.click())},[z(_e,{name:l.value||c.value,url:d.value,size:"xxl"},null,8,["name","url"]),t("div",Rr,[z(k(fs),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:p,type:"file",accept:"image/*",class:"hidden",onChange:u},null,544)]),t("div",Dr,[t("div",Or,[t("label",Pr,x(c.value)+" name",1),de(t("input",{"onUpdate:modelValue":$[2]||($[2]=_=>l.value=_),class:"form-input",type:"text",maxlength:"128",placeholder:`${c.value} name`},null,8,Nr),[[ye,l.value]])]),t("div",Ur,[$[8]||($[8]=t("label",{class:"form-label"},"Description",-1)),de(t("textarea",{"onUpdate:modelValue":$[3]||($[3]=_=>r.value=_),class:"form-input",maxlength:"500",rows:"4",placeholder:`${c.value} description...`},null,8,Fr),[[ye,r.value]])]),k(a).isOwner?(v(),h("div",zr,[t("label",Hr,x(c.value)+" type",1),t("div",Br,[t("label",jr,[de(t("input",{"onUpdate:modelValue":$[4]||($[4]=_=>b.value=_),type:"radio",value:"public",name:"chatType"},null,512),[[Fn,b.value]]),$[9]||($[9]=t("span",{class:"type-option-label"},"Public",-1)),$[10]||($[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",Vr,[de(t("input",{"onUpdate:modelValue":$[5]||($[5]=_=>b.value=_),type:"radio",value:"private",name:"chatType"},null,512),[[Fn,b.value]]),$[11]||($[11]=t("span",{class:"type-option-label"},"Private",-1)),$[12]||($[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):P("",!0)]),t("div",Wr,[t("button",{class:"btn btn-primary",disabled:f.value,onClick:g},x(f.value?"Saving...":"Save"),9,qr),t("button",{class:"btn btn-ghost",onClick:$[6]||($[6]=_=>i("close"))},"Cancel")])])])]))}}),Kr=fe(Gr,[["__scopeId","data-v-6ec12915"]]),Jr={class:"danger-zone"},Qr={class:"view-header"},Yr={class:"danger-zone-body"},Xr={class:"modal modal-sm"},Zr={class:"modal-header"},ec={class:"modal-actions"},tc=["disabled"],nc=se({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:s}){const n=e,i=s,a=Ee(),o=pt(),{showToast:l}=Se(),r=y(!1),d=y(!1);async function b(){try{await a.leave(n.chatId),i("left")}catch{l("Failed to leave channel")}}async function f(){d.value=!0;try{await us(n.chatId),a.chats=a.chats.filter(p=>p.id!==n.chatId),a.activeChatId===n.chatId&&a.setActiveChat(null),r.value=!1,i("deleted")}catch{l("Failed to delete channel")}finally{d.value=!1}}return(p,m)=>(v(),h("div",Jr,[t("div",Qr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:m[0]||(m[0]=c=>i("back"))},[z(k(Ve),{size:20,"stroke-width":2})]),m[5]||(m[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",Yr,[t("button",{class:"btn btn-danger-outline",onClick:b},[z(k(wn),{size:18,"stroke-width":1.8}),m[6]||(m[6]=ke(" Leave Channel ",-1))]),k(o).isOwner?(v(),h("button",{key:0,class:"btn btn-danger",onClick:m[1]||(m[1]=c=>r.value=!0)},[z(k(ys),{size:18,"stroke-width":1.8}),m[7]||(m[7]=ke(" Delete Channel ",-1))])):P("",!0)]),r.value?(v(),h("div",{key:0,class:"modal-backdrop",onClick:m[4]||(m[4]=ue(c=>r.value=!1,["self"]))},[t("div",Xr,[t("div",Zr,[m[8]||(m[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:m[2]||(m[2]=c=>r.value=!1)},[z(k(Fe),{size:20,"stroke-width":2})])]),m[9]||(m[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",ec,[t("button",{class:"btn btn-ghost",onClick:m[3]||(m[3]=c=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:d.value,onClick:f},x(d.value?"Deleting...":"Delete"),9,tc)])])])):P("",!0)]))}}),sc=fe(nc,[["__scopeId","data-v-997b5e56"]]),ac={class:"modal profile-modal"},ic={class:"profile-modal-body"},oc={key:5,class:"profile-loading"},lc={class:"profile-avatar-section"},rc={class:"profile-name"},cc={class:"profile-status"},uc={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},dc={class:"profile-info-item"},vc={class:"profile-info-value"},mc={class:"channel-info-menu"},fc={class:"channel-info-menu-count"},pc={class:"channel-info-menu-count"},hc={key:7,class:"profile-loading"},gc=se({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:s}){const n=e,i=s,a=pt(),o=y("main"),l=W(()=>Number(n.chatId)),r=W(()=>a.detail?.type==="group");function d(){o.value="main",a.loadDetail(l.value)}return we(async()=>{await Promise.all([a.loadDetail(l.value),a.loadMembers(l.value)])}),(b,f)=>(v(),h("div",{class:"modal-backdrop profile-backdrop",onClick:f[14]||(f[14]=ue(p=>i("close"),["self"]))},[t("div",ac,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:f[0]||(f[0]=p=>i("close"))},[z(k(Fe),{size:20,"stroke-width":2})]),t("div",ic,[o.value==="invites"?(v(),Q(Zl,{key:0,"chat-id":l.value,onBack:f[1]||(f[1]=p=>o.value="main")},null,8,["chat-id"])):o.value==="admins"?(v(),Q(kr,{key:1,"chat-id":l.value,onBack:f[2]||(f[2]=p=>o.value="main")},null,8,["chat-id"])):o.value==="subscribers"?(v(),Q(Er,{key:2,"chat-id":l.value,onBack:f[3]||(f[3]=p=>o.value="main")},null,8,["chat-id"])):o.value==="edit"?(v(),Q(Kr,{key:3,"chat-id":l.value,onClose:f[4]||(f[4]=p=>o.value="main"),onSaved:d},null,8,["chat-id"])):o.value==="danger"?(v(),Q(sc,{key:4,"chat-id":l.value,onBack:f[5]||(f[5]=p=>o.value="main"),onLeft:f[6]||(f[6]=p=>i("close")),onDeleted:f[7]||(f[7]=p=>i("close"))},null,8,["chat-id"])):k(a).loading?(v(),h("div",oc,[...f[15]||(f[15]=[t("p",null,"Loading...",-1)])])):k(a).detail?(v(),h(ce,{key:6},[t("div",lc,[z(_e,{name:k(a).detail.title||"Channel",url:k(a).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",rc,x(k(a).detail.title),1),t("div",cc,x(k(a).memberCount)+" "+x(r.value?k(a).memberCount===1?"member":"members":k(a).memberCount===1?"subscriber":"subscribers"),1),k(a).detail.description?(v(),h("div",uc,[t("div",dc,[f[16]||(f[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",vc,x(k(a).detail.description),1)])])):P("",!0),f[19]||(f[19]=t("div",{class:"profile-divider"},null,-1)),t("div",mc,[t("button",{class:"channel-info-menu-item",onClick:f[8]||(f[8]=p=>o.value="invites")},[z(k(ti),{size:20,"stroke-width":1.8}),f[17]||(f[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:f[9]||(f[9]=p=>o.value="admins")},[z(k(ri),{size:20,"stroke-width":1.8}),f[18]||(f[18]=t("span",null,"Administrators",-1)),t("span",fc,x(k(a).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:f[10]||(f[10]=p=>o.value="subscribers")},[z(k(Qt),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Members":"Subscribers"),1),t("span",pc,x(k(a).memberCount),1)]),k(a).isOwner||k(a).isAdmin?(v(),h("button",{key:0,class:"channel-info-menu-item",onClick:f[11]||(f[11]=p=>o.value="edit")},[z(k(gs),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Edit Group":"Edit Channel"),1)])):P("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:f[12]||(f[12]=p=>o.value="danger")},[z(k(wn),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Leave Group":"Leave Channel"),1)]),k(a).isOwner?(v(),h("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:f[13]||(f[13]=p=>o.value="danger")},[z(k(ys),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Delete Group":"Delete Channel"),1)])):P("",!0)])],64)):(v(),h("div",hc,[...f[20]||(f[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),yc=fe(gc,[["__scopeId","data-v-d1526322"]]),bc={class:"search-bar"},kc={class:"search-bar-header"},wc={key:0,class:"search-loading"},_c={key:1,class:"search-empty"},Cc=["onClick"],$c={class:"search-result-sender"},Sc=["innerHTML"],Mc={class:"search-result-date"},xc={key:0,class:"search-loading"},Tc=se({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:s}){const n=e,i=s,a=y(null),o=y(null),l=y(""),r=y([]),d=y(!1),b=y(!1),f=y(!0);let p=null;we(()=>{Ce(()=>a.value?.focus())}),Oe(l,_=>{if(p&&clearTimeout(p),!_.trim()){r.value=[],b.value=!1,f.value=!0;return}p=setTimeout(()=>m(_.trim()),300)});async function m(_){d.value=!0,b.value=!0,f.value=!0;try{const D=await Hn(n.chatId,_,{limit:20});r.value=D,D.length<20&&(f.value=!1)}catch{r.value=[]}finally{d.value=!1}}async function c(){if(d.value||!f.value||r.value.length===0)return;const _=Math.min(...r.value.map(D=>D.id));d.value=!0;try{const D=await Hn(n.chatId,l.value.trim(),{limit:20,before_id:_});D.length<20&&(f.value=!1),r.value=[...r.value,...D]}catch{}finally{d.value=!1}}function u(){if(!o.value)return;const _=o.value;_.scrollTop+_.clientHeight>=_.scrollHeight-40&&c()}function g(_,D){if(!D)return E(_);const q=E(_),K=E(D),U=new RegExp(K.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return q.replace(U,"<mark>$&</mark>")}function E(_){return _.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function $(_){if(!_)return"";const D=new Date(_.endsWith("Z")?_:_+"Z"),q=new Date;return D.toDateString()===q.toDateString()?D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):D.toLocaleDateString([],{month:"short",day:"numeric"})+" "+D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return(_,D)=>(v(),h("div",bc,[t("div",kc,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:D[0]||(D[0]=q=>i("close"))},"â†"),de(t("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":D[1]||(D[1]=q=>l.value=q),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:D[2]||(D[2]=dn(q=>i("close"),["escape"]))},null,544),[[ye,l.value]]),l.value?(v(),h("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:D[3]||(D[3]=q=>l.value="")},"âœ•")):P("",!0)]),d.value&&r.value.length===0?(v(),h("div",wc,"Searching...")):b.value&&r.value.length===0&&!d.value?(v(),h("div",_c,"No messages found")):r.value.length>0?(v(),h("div",{key:2,ref_key:"resultsRef",ref:o,class:"search-results",onScroll:u},[(v(!0),h(ce,null,ge(r.value,q=>(v(),h("div",{key:q.id,class:"search-result-item",onClick:K=>i("jumpToMessage",q.id)},[t("div",$c,x(q.sender_display_name||q.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:g(q.content||"",l.value)},null,8,Sc),t("div",Mc,x($(q.created_at)),1)],8,Cc))),128)),d.value?(v(),h("div",xc,"Loading more...")):P("",!0)],544)):P("",!0)]))}}),Ec={class:"chat-panel"},Lc={key:0,class:"empty-chat"},Ic={key:1,class:"chat-view"},Ac={key:2,class:"channel-readonly-bar"},Rc={key:0,class:"date-sep"},Dc={key:4,class:"sticker-picker"},Oc={key:6,class:"recording-bar"},Pc={class:"rec-time"},Nc=se({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:s}){const n=s,i=Le(),a=Ee(),o=ft(),{showToast:l}=Se(),r=Li(),d=Je("stickers",y([])),b=Je("sendTyping",()=>{}),f=Je("pendingScrollMessageId",y(null)),p=y(null),m=y(null),c=y(!1);let u=null;const g=y(!1),E=y(!1),$=y("member"),_=y(!1),D=y(!1),q=y(null);nt("lastSentMessageId",q);const K=y(!0),U=y(0);let te=null;function le(){if(!p.value)return!0;const N=p.value;return N.scrollTop+N.clientHeight>=N.scrollHeight-100}function T(){te||(te=setTimeout(()=>{te=null,K.value=le(),K.value&&(U.value=0)},100))}function M(){Ye(),U.value=0,K.value=!0}const I=y(!1),J=y(0),H=y(0),R=y(null),j=Jt(),he=y(!1),pe=y(null),S=y(""),A=W(()=>!pe.value||!i.user?!1:Me.value.find(w=>w.id===pe.value)?.sender_id===i.user.id),V=W(()=>A.value?Me.value.find(w=>w.id===pe.value)?.message_type==="text":!1),F=W(()=>!pe.value||!a.activeChatId?!1:o.pinnedByChat[a.activeChatId]?.message?.id===pe.value),ne=W(()=>!a.activeChatId||o.pinnedDismissed.has(a.activeChatId)?null:o.pinnedByChat[a.activeChatId]||null),ae=y(!1),oe=y([]),G=y(!1),C=y([]),B=y(!1),Z=y(null);let re=null;const Ie=W(()=>a.activeChat?.type==="channel"&&$.value==="member"),Me=W(()=>a.activeChatId?o.getMessages(a.activeChatId):[]),Rs=W(()=>{const N=[];let w="";for(const O of Me.value){const ie=Ds(O.created_at);ie!==w&&(N.push({type:"date",label:ie}),w=ie),N.push({type:"msg",msg:O})}return N});function Ds(N){if(!N)return"";const w=new Date(N.endsWith("Z")?N:N+"Z"),O=new Date;if(w.toDateString()===O.toDateString())return"Today";const ie=new Date(O);return ie.setDate(O.getDate()-1),w.toDateString()===ie.toDateString()?"Yesterday":w.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Os(){Xt(),!(!m.value||!p.value)&&(u=new IntersectionObserver(async N=>{if(!N[0]?.isIntersecting)return;const O=a.activeChatId;if(!O||c.value||o.loadingChat===O)return;c.value=!0;const ie=p.value,Ae=ie?ie.scrollHeight:0;try{if((await o.loadOlder(O)).length>0&&ie){await Ce();const Xe=ie.scrollHeight;ie.scrollTop+=Xe-Ae}}finally{c.value=!1}},{root:p.value,threshold:0}),u.observe(m.value))}function Xt(){u&&(u.disconnect(),u=null)}Oe(()=>a.activeChatId,async N=>{if(g.value=!1,$.value="member",U.value=0,K.value=!0,Xt(),re&&(clearInterval(re),re=null),!N)return;await Promise.all([o.loadMessages(N),o.loadPinnedMessage(N),o.loadReadReceipts(N)]),await Ce(),Ye(),await Ce(),Os();const w=a.activeChat;if(w&&(w.type==="channel"||w.type==="group"))try{const O=await cs(N);$.value=O.my_role||"member"}catch{}re=setInterval(()=>{a.activeChatId===N&&o.loadNewer(N).then(O=>{O.length>0&&Ps(O.length)})},2500)});function Ye(){p.value&&(p.value.scrollTop=p.value.scrollHeight)}function Ps(N=1){if(!p.value)return;const w=p.value;w.scrollHeight-w.scrollTop-w.clientHeight<100?Ce(()=>{w.scrollTop=w.scrollHeight}):U.value+=N}function Ns(){a.activeChatId&&b(a.activeChatId)}async function Us(N,w){if(!(!a.activeChatId||!N.trim())){Z.value=null;try{const O=w?{reply_to_message_id:w.messageId}:void 0,ie=await o.sendMessage(a.activeChatId,N.trim(),"text",O);i.user&&(ie.sender_id=i.user.id,ie.sender_username=i.user.username,ie.sender_display_name=i.user.display_name),q.value=ie.id,setTimeout(()=>{q.value===ie.id&&(q.value=null)},500),await Ce(),Ye(),a.loadChats()}catch{l("Failed to send message")}}}async function Fs(N,w){if(!(!a.activeChatId||!w.trim()))try{await o.editMessage(a.activeChatId,N,w.trim())}catch{l("Failed to edit message")}}async function zs(N){if(a.activeChatId){g.value=!1;try{const w=await o.sendMessage(a.activeChatId,"","sticker",{sticker_id:N}),O=d.value.find(ie=>ie.id===N);O&&(w.sticker_url=O.url,w.sticker_label=O.label),q.value=w.id,setTimeout(()=>{q.value===w.id&&(q.value=null)},500),await Ce(),Ye(),a.loadChats()}catch{l("Failed to send sticker")}}}function Hs(N,w,O){R.value=N,J.value=w,H.value=O,I.value=!0}function Bs(N){R.value&&a.activeChatId&&o.toggleReaction(a.activeChatId,R.value,N),I.value=!1,R.value=null}function js(N,w){a.activeChatId&&o.toggleReaction(a.activeChatId,N,w)}function Vs(){I.value=!1,R.value=null}async function Ws(){try{await r.startRecording(),E.value=!0}catch{E.value=!1,l("Microphone access denied")}}async function qs(){try{const N=await r.stopRecording();E.value=!1,await Xs(N)}catch{E.value=!1}}function Gs(){r.cancelRecording(),E.value=!1}function In(N){const{messageIds:w}=N.detail;oe.value=w,ae.value=!0}function An(N){const{messageId:w,chatId:O}=N.detail;O&&j.enterSelectionMode(O,w)}async function Rn(N,w){try{await o.pinMsg(N,w)}catch{l("Failed to pin message")}}async function Dn(N,w){try{await o.unpinMsg(N,w)}catch{l("Failed to unpin message")}}function On(N){const{messageId:w,chatId:O}=N.detail;w&&O&&Rn(O,w)}function Pn(N){const{messageId:w,chatId:O}=N.detail;w&&O&&Dn(O,w)}function Zt(N){const{messageId:w,chatId:O}=N.detail;if(!w||!O)return;C.value=[w];const ie=Me.value.find(Ae=>Ae.id===w);B.value=!!(ie&&ie.sender_id===i.user?.id),G.value=!0}function Ks(){oe.value=[...j.selectedMessageIds],ae.value=!0}function Js(){C.value=[...j.selectedMessageIds],B.value=C.value.every(N=>{const w=Me.value.find(O=>O.id===N);return w&&w.sender_id===i.user?.id}),G.value=!0}function Nn(){ae.value=!1,oe.value=[],j.exitSelectionMode()}async function Qs(N){G.value=!1;const w=a.activeChatId;if(w){for(const O of C.value)try{await o.deleteMessage(w,O,N)}catch{l("Failed to delete message")}C.value=[],j.exitSelectionMode()}}function ze(N){he.value=!1;const w=pe.value,O=a.activeChatId;if(!(!w||!O))switch(N){case"reply":{const ie=Me.value.find(Ae=>Ae.id===w);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:w,senderName:ie?.sender_display_name||ie?.sender_username||"Unknown",text:ie?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:w,chatId:O,text:S.value}}));break}case"copy":navigator.clipboard.writeText(S.value).then(()=>l("Copied to clipboard"),()=>l("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${O}/${w}`).then(()=>l("Link copied"),()=>l("Failed to copy link"));break;case"forward":oe.value=[w],ae.value=!0;break;case"select":j.enterSelectionMode(O,w);break;case"delete":Zt(new CustomEvent("",{detail:{messageId:w,chatId:O}}));break;case"pin":Rn(O,w);break;case"unpin":Dn(O,w);break}}async function ht(N){if(!p.value)return;const w=a.activeChatId;if(!w)return;let O=p.value.querySelector(`[data-message-id="${N}"]`);if(!O)try{const ie=Math.max(0,N-25),Ae=await kt(w,{after_id:ie,limit:50});if(!Ae.find(Xe=>Xe.id===N)){l("Message not found");return}o.messagesByChat[w]=Ae,Ae.length>0&&(o.lastMsgId[w]=Math.max(...Ae.map(Xe=>Xe.id))),await Ce(),O=p.value?.querySelector(`[data-message-id="${N}"]`)}catch{l("Message not found");return}O&&(O.scrollIntoView({behavior:"smooth",block:"center"}),O.classList.add("highlight-message"),setTimeout(()=>O.classList.remove("highlight-message"),2e3))}function Ys(N){D.value=!1,ht(N)}function Un(N){if(N.key==="Escape"){if(D.value){D.value=!1,N.stopPropagation();return}_.value&&(_.value=!1,N.stopPropagation())}}we(()=>{window.addEventListener("forward-messages",In),window.addEventListener("select-message",An),window.addEventListener("delete-message",Zt),window.addEventListener("pin-message",On),window.addEventListener("unpin-message",Pn),document.addEventListener("keydown",Un)}),We(()=>{Xt(),window.removeEventListener("forward-messages",In),window.removeEventListener("select-message",An),window.removeEventListener("delete-message",Zt),window.removeEventListener("pin-message",On),window.removeEventListener("unpin-message",Pn),document.removeEventListener("keydown",Un)}),Oe(()=>f.value,async N=>{N&&(await Ce(),setTimeout(()=>{ht(N),f.value=null},300))}),Oe(()=>a.activeChatId,()=>{j.exitSelectionMode(),Z.value=null,D.value=!1});async function Xs(N){if(a.activeChatId)try{const w=await Cn(N);await o.sendMessage(a.activeChatId,"","voice",{file_id:w.id,duration_seconds:r.seconds.value}),await o.loadMessages(a.activeChatId),await Ce(),Ye(),a.loadChats()}catch{l("Failed to upload voice message")}}return(N,w)=>(v(),h("main",Ec,[k(a).activeChatId?(v(),h("div",Ic,[z(ml,{onForward:Ks,onDelete:Js}),D.value&&k(a).activeChatId?(v(),Q(Tc,{key:0,"chat-id":k(a).activeChatId,onClose:w[0]||(w[0]=O=>D.value=!1),onJumpToMessage:Ys},null,8,["chat-id"])):P("",!0),de(z(Fi,{onBack:w[1]||(w[1]=O=>n("back")),onOpenUserProfile:w[2]||(w[2]=O=>n("openUserProfile",O)),onOpenChannelInfo:w[3]||(w[3]=O=>_.value=!0),onOpenSearch:w[4]||(w[4]=O=>D.value=!0)},null,512),[[zn,!k(j).selectionMode&&!D.value]]),ne.value&&!k(j).selectionMode?(v(),Q(Di,{key:1,message:ne.value.message,onClick:w[5]||(w[5]=O=>ht(ne.value.message.id)),onDismiss:w[6]||(w[6]=O=>k(o).dismissPin(k(a).activeChatId))},null,8,["message"])):P("",!0),Ie.value?(v(),h("div",Ac,[...w[22]||(w[22]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):P("",!0),U.value>0?(v(),h("button",{key:3,class:"new-messages-pill",onClick:M},x(U.value)+" new message"+x(U.value>1?"s":"")+" â†“ ",1)):P("",!0),t("div",{ref_key:"msgListRef",ref:p,class:"msg-list",onClick:Vs,onScroll:T},[k(o).loadingChat===k(a).activeChatId?(v(),Q(ns,{key:0})):(v(),h(ce,{key:1},[t("div",{ref_key:"olderSentinelRef",ref:m,class:"older-sentinel"},[c.value?(v(),Q(ns,{key:0})):P("",!0)],512),(v(!0),h(ce,null,ge(Rs.value,O=>(v(),h(ce,{key:O.type==="date"?"date-"+O.label:"msg-"+O.msg.id},[O.type==="date"?(v(),h("div",Rc,[t("span",null,x(O.label),1)])):(v(),Q(Po,{key:1,message:O.msg,"is-mine":O.msg.sender_id===k(i).user?.id,onMentionClick:w[7]||(w[7]=ie=>n("openUserProfile",ie)),onOpenEmojiPicker:Hs,onToggleReaction:js,onReplyClick:ht},null,8,["message","is-mine"]))],64))),128))],64))],544),z(al,{visible:I.value,x:J.value,y:H.value,onSelect:Bs,onClose:w[8]||(w[8]=O=>I.value=!1)},null,8,["visible","x","y"]),g.value?(v(),h("div",Dc,[z(Zo,{onSelect:zs})])):P("",!0),Ie.value?P("",!0):de((v(),Q(Ko,{key:5,"sticker-picker-open":g.value,"reply-to":Z.value,onSend:Us,onEditMessage:Fs,onToggleStickers:w[9]||(w[9]=O=>g.value=!g.value),onStartRecording:Ws,onTyping:Ns},null,8,["sticker-picker-open","reply-to"])),[[zn,!E.value]]),E.value?(v(),h("div",Oc,[w[23]||(w[23]=t("span",{class:"rec-dot"},null,-1)),t("span",Pc,x(k(r).formatTime(k(r).seconds.value)),1),w[24]||(w[24]=t("span",{class:"rec-label"},"Recording...",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:Gs},"âœ•"),t("button",{class:"icon-btn rec-send",title:"Send",onClick:qs},"â¤")])):P("",!0),z(ol),z(pl,{visible:he.value,onClose:w[18]||(w[18]=O=>he.value=!1)},{default:kn(()=>[t("button",{class:"ctx-item",onClick:w[10]||(w[10]=O=>ze("reply"))},"Reply"),V.value?(v(),h("button",{key:0,class:"ctx-item",onClick:w[11]||(w[11]=O=>ze("edit"))},"Edit")):P("",!0),t("button",{class:"ctx-item",onClick:w[12]||(w[12]=O=>ze(F.value?"unpin":"pin"))},x(F.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:w[13]||(w[13]=O=>ze("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:w[14]||(w[14]=O=>ze("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:w[15]||(w[15]=O=>ze("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:w[16]||(w[16]=O=>ze("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:w[17]||(w[17]=O=>ze("delete"))},"Delete")]),_:1},8,["visible"]),ae.value?(v(),Q(El,{key:7,"message-ids":oe.value,"from-chat-id":k(a).activeChatId,onClose:Nn,onForwarded:Nn},null,8,["message-ids","from-chat-id"])):P("",!0),G.value?(v(),Q(Nl,{key:8,"message-count":C.value.length,"can-delete-for-everyone":B.value,onClose:w[19]||(w[19]=O=>G.value=!1),onConfirm:Qs},null,8,["message-count","can-delete-for-everyone"])):P("",!0),_.value?(v(),Q(yc,{key:9,"chat-id":String(k(a).activeChatId),onClose:w[20]||(w[20]=O=>_.value=!1)},null,8,["chat-id"])):P("",!0)])):(v(),h("div",Lc,[...w[21]||(w[21]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),Uc=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Saved Messages",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function Fc(e){return Uc.filter(s=>s.visible(e))}const zc=["disabled"],Hc={class:"menu-item__label"},Bc={key:1,class:"menu-item__badge"},jc=se({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:s}){const n=s;return(i,a)=>(v(),h("button",{class:ve(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:a[0]||(a[0]=o=>n("click"))},[e.icon?(v(),Q(qe(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):P("",!0),t("span",Hc,x(e.label),1),e.badge?(v(),h("span",Bc,x(e.badge),1)):P("",!0),ls(i.$slots,"right",{},void 0),e.chevron?(v(),Q(qe(k(Ja)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):P("",!0)],10,zc))}}),ss=fe(jc,[["__scopeId","data-v-682bc042"]]),Vc={class:"drawer-header"},Wc={class:"drawer-profile"},qc={class:"drawer-profile-bottom"},Gc={class:"drawer-profile-info"},Kc={class:"drawer-display-name"},Jc={class:"drawer-username"},Qc={class:"drawer-nav"},Yc={key:0,class:"drawer-divider"},Xc=["onClick"],Zc={class:"menu-item__label"},eu=["aria-checked"],tu=se({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:s}){const n=s,i=rs(),a=Le(),o=mt(),l={user:bs,users:Qt,megaphone:_n,bookmark:Ka,settings:li,moon:ai,download:Qa,"log-out":wn,star:ui},r=W(()=>({isAuthenticated:!!a.user,isDesktop:!0})),d=W(()=>Fc(r.value)),b={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const p=o.theme==="dark"?"light":"dark";o.applyTheme(p),o.saveSettings({theme:p})},openDownload:()=>n("openDownload"),logout:()=>{a.logout(),i.push("/login")}};function f(p){p&&b[p]&&b[p]()}return(p,m)=>(v(),h("div",{class:ve(["drawer",{open:e.open}])},[t("div",Vc,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:m[0]||(m[0]=c=>n("close"))},[z(k(Fe),{size:20,"stroke-width":2})]),m[2]||(m[2]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",Wc,[z(_e,{name:k(a).user?.display_name||k(a).user?.username||"?",url:k(a).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",qc,[t("div",Gc,[t("div",Kc,x(k(a).user?.display_name||k(a).user?.username||"---"),1),t("div",Jc,"@"+x(k(a).user?.username||"---"),1)]),t("button",{class:"icon-btn drawer-edit-btn","aria-label":"Edit profile",onClick:m[1]||(m[1]=c=>n("openProfile"))},[z(k(gs),{size:18,"stroke-width":2})])])]),t("nav",Qc,[(v(!0),h(ce,null,ge(d.value,c=>(v(),h(ce,{key:c.id},[c.separator?(v(),h("div",Yc)):P("",!0),c.rightSlot==="toggle"?(v(),h("div",{key:1,class:"menu-item menu-item--toggle",onClick:u=>f(c.action)},[(v(),Q(qe(l[c.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",Zc,x(c.label),1),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":k(o).theme==="dark"}]),role:"switch","aria-checked":k(o).theme==="dark"},[...m[3]||(m[3]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,eu)],8,Xc)):c.id==="logout"?(v(),Q(ss,{key:2,icon:l[c.icon],label:c.label,danger:"",onClick:u=>f(c.action)},null,8,["icon","label","onClick"])):(v(),Q(ss,{key:3,icon:l[c.icon],label:c.label,onClick:u=>f(c.action)},null,8,["icon","label","onClick"]))],64))),128))]),m[4]||(m[4]=t("div",{class:"drawer-footer"},"BeHappy v2",-1))],2))}}),nu=fe(tu,[["__scopeId","data-v-db1ed91e"]]),su={class:"modal"},au={class:"modal-header"},iu={class:"modal-body"},ou={key:0,class:"chat-type-cards"},lu={class:"chat-type-icon"},ru={class:"chat-type-icon"},cu={class:"chat-type-icon"},uu={key:1,class:"new-chat-form"},du={class:"user-pick-list"},vu={key:0,class:"empty-state-small"},mu={key:1,class:"empty-state-small"},fu=["onClick"],pu={class:"user-pick-name"},hu={class:"user-pick-handle"},gu={key:2,class:"new-chat-form"},yu={class:"form-group"},bu={class:"form-group"},ku={class:"form-group"},wu={class:"user-pick-list"},_u=["onClick"],Cu={class:"user-pick-name"},$u={class:"user-pick-handle"},Su={class:"modal-actions"},Mu=["disabled"],xu={key:3,class:"new-chat-form"},Tu={class:"form-group"},Eu={class:"form-group"},Lu={class:"form-group"},Iu={class:"modal-actions"},Au=["disabled"],Ru=se({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:s}){const n=e,i=s,a=Le(),{showToast:o}=Se(),l=y(n.initialStep),r=y(!1),d=y(""),b=y([]),f=y(!1);let p=null;const m=y(""),c=y(""),u=y(""),g=y([]),E=y(new Set);let $=null;const _=y(""),D=y(""),q=y("");we(()=>{K("")});async function K(H){f.value=!0;try{const R=await Bn(H);b.value=R.filter(j=>j.id!==a.user?.id)}catch{b.value=[]}finally{f.value=!1}}function U(){p&&clearTimeout(p),p=setTimeout(()=>K(d.value),300)}async function te(H){try{g.value=await Bn(H)}catch{g.value=[]}}function le(){$&&clearTimeout($),$=setTimeout(()=>te(u.value),300)}function T(H){E.value.has(H)?E.value.delete(H):E.value.add(H)}async function M(H){r.value=!0;try{const R=await st({type:"direct",member_ids:[H]});i("chatCreated",R.id)}catch{o("Failed to start conversation")}finally{r.value=!1}}async function I(){if(!m.value.trim()){o("Group name is required");return}r.value=!0;try{const H=await st({type:"group",title:m.value.trim(),description:c.value.trim(),member_ids:Array.from(E.value)});o("Group created!"),i("chatCreated",H.id)}catch{o("Failed to create group")}finally{r.value=!1}}async function J(){if(!_.value.trim()){o("Channel name is required");return}r.value=!0;try{const H=await st({type:"channel",title:_.value.trim(),description:q.value.trim(),public_name:D.value.trim()||void 0,member_ids:[]});o("Channel created!"),i("chatCreated",H.id)}catch{o("Failed to create channel")}finally{r.value=!1}}return(H,R)=>(v(),h("div",{class:"modal-backdrop",onClick:R[14]||(R[14]=ue(j=>i("close"),["self"]))},[t("div",su,[t("div",au,[R[15]||(R[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:R[0]||(R[0]=j=>i("close"))},[z(k(Fe),{size:20})])]),t("div",iu,[l.value==="select"?(v(),h("div",ou,[t("button",{class:"chat-type-card",onClick:R[1]||(R[1]=j=>l.value="direct")},[t("span",lu,[z(k(bs),{size:24})]),R[16]||(R[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:R[2]||(R[2]=j=>l.value="group")},[t("span",ru,[z(k(Qt),{size:24})]),R[17]||(R[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:R[3]||(R[3]=j=>l.value="channel")},[t("span",cu,[z(k(_n),{size:24})]),R[18]||(R[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):P("",!0),l.value==="direct"?(v(),h("div",uu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:R[4]||(R[4]=j=>l.value="select")},[z(k(Ve),{size:16}),R[19]||(R[19]=ke(" Back ",-1))]),de(t("input",{"onUpdate:modelValue":R[5]||(R[5]=j=>d.value=j),class:"search-input",type:"search",placeholder:"Search users...",onInput:U},null,544),[[ye,d.value]]),t("div",du,[f.value?(v(),h("div",vu,"Loading users...")):b.value.length===0?(v(),h("div",mu,"No users found.")):(v(!0),h(ce,{key:2},ge(b.value,j=>(v(),h("div",{key:j.id,class:"user-pick-item",onClick:he=>M(j.id)},[z(_e,{name:j.display_name||j.username,url:j.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",pu,x(j.display_name||j.username),1),t("div",hu,"@"+x(j.username),1)])],8,fu))),128))])])):P("",!0),l.value==="group"?(v(),h("div",gu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:R[6]||(R[6]=j=>l.value="select")},[z(k(Ve),{size:16}),R[20]||(R[20]=ke(" Back ",-1))]),t("div",yu,[R[21]||(R[21]=t("label",{class:"form-label"},"Group name",-1)),de(t("input",{"onUpdate:modelValue":R[7]||(R[7]=j=>m.value=j),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[ye,m.value]])]),t("div",bu,[R[22]||(R[22]=t("label",{class:"form-label"},"Description (optional)",-1)),de(t("textarea",{"onUpdate:modelValue":R[8]||(R[8]=j=>c.value=j),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[ye,c.value]])]),t("div",ku,[R[23]||(R[23]=t("label",{class:"form-label"},"Add members",-1)),de(t("input",{"onUpdate:modelValue":R[9]||(R[9]=j=>u.value=j),class:"search-input",type:"search",placeholder:"Search users...",onInput:le},null,544),[[ye,u.value]]),t("div",wu,[(v(!0),h(ce,null,ge(g.value,j=>(v(),h("div",{key:j.id,class:ve(["user-pick-item",{selected:E.value.has(j.id)}]),onClick:he=>T(j.id)},[z(_e,{name:j.display_name||j.username,url:j.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Cu,[E.value.has(j.id)?(v(),Q(k(ps),{key:0,size:14,style:{"margin-right":"4px"}})):P("",!0),ke(x(j.display_name||j.username),1)]),t("div",$u,"@"+x(j.username),1)])],10,_u))),128))])]),t("div",Su,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:I}," Create Group ",8,Mu)])])):P("",!0),l.value==="channel"?(v(),h("div",xu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:R[10]||(R[10]=j=>l.value="select")},[z(k(Ve),{size:16}),R[24]||(R[24]=ke(" Back ",-1))]),t("div",Tu,[R[25]||(R[25]=t("label",{class:"form-label"},"Channel name",-1)),de(t("input",{"onUpdate:modelValue":R[11]||(R[11]=j=>_.value=j),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[ye,_.value]])]),t("div",Eu,[R[26]||(R[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),de(t("input",{"onUpdate:modelValue":R[12]||(R[12]=j=>D.value=j),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[ye,D.value]]),R[27]||(R[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",Lu,[R[28]||(R[28]=t("label",{class:"form-label"},"Description (optional)",-1)),de(t("textarea",{"onUpdate:modelValue":R[13]||(R[13]=j=>q.value=j),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[ye,q.value]])]),t("div",Iu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:J}," Create Channel ",8,Au)])])):P("",!0)])])]))}}),Du={class:"modal profile-modal profile-modal--self"},Ou={class:"profile-modal-body profile-modal-body--scrollable"},Pu={class:"profile-avatar-section profile-avatar-upload-section"},Nu={class:"profile-avatar-overlay"},Uu={class:"profile-name"},Fu={key:0,class:"profile-status profile-status--online"},zu={class:"profile-info-list"},Hu={class:"form-group"},Bu={class:"form-group"},ju={key:0,class:"form-hint form-error"},Vu={class:"form-group"},Wu={class:"profile-info-item"},qu={class:"profile-info-value"},Gu={class:"profile-edit-actions"},Ku=se({__name:"ProfileModal",emits:["close"],setup(e,{emit:s}){const n=s,i=Le(),{showToast:a}=Se(),o=y(""),l=y(""),r=y(""),d=y(""),b=y(null);we(async()=>{i.user&&(o.value=i.user.display_name||"",l.value=i.user.username,r.value=i.user.bio||"")});async function f(){const m=b.value?.files?.[0];if(m){try{const c=await Cn(m),u=await za(c.id);i.updateUser({avatar_url:u.avatar_url}),a("Avatar updated!")}catch{a("Upload failed")}b.value&&(b.value.value="")}}async function p(){if(d.value="",!i.user)return;const m={display_name:o.value.trim(),bio:r.value.trim()};l.value.trim()&&l.value.trim()!==i.user.username&&(m.username=l.value.trim());try{const c=await Fa(i.user.id,m);i.updateUser({display_name:c.display_name,username:c.username}),a("Profile saved!"),n("close")}catch(c){c.response?.status===409?d.value="Username already taken":a("Save failed")}}return(m,c)=>(v(),h("div",{class:"modal-backdrop profile-backdrop",onClick:c[6]||(c[6]=ue(u=>n("close"),["self"]))},[t("div",Du,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:c[0]||(c[0]=u=>n("close"))},[z(k(Fe),{size:20,"stroke-width":2})]),t("div",Ou,[t("div",Pu,[t("div",{class:"profile-avatar-upload-wrap",onClick:c[1]||(c[1]=u=>b.value?.click())},[z(_e,{name:o.value||k(i).user?.username||"?",url:k(i).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",Nu,[z(k(fs),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:b,type:"file",accept:"image/*",class:"hidden",onChange:f},null,544)]),t("div",Uu,x(o.value||k(i).user?.username||"?"),1),k(i).user?(v(),h("div",Fu," online ")):P("",!0),c[11]||(c[11]=t("div",{class:"profile-divider"},null,-1)),t("div",zu,[t("div",Hu,[c[7]||(c[7]=t("label",{class:"form-label"},"Display name",-1)),de(t("input",{"onUpdate:modelValue":c[2]||(c[2]=u=>o.value=u),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[ye,o.value]])]),t("div",Bu,[c[8]||(c[8]=t("label",{class:"form-label"},"Username",-1)),de(t("input",{"onUpdate:modelValue":c[3]||(c[3]=u=>l.value=u),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[ye,l.value]]),d.value?(v(),h("small",ju,x(d.value),1)):P("",!0)]),t("div",Vu,[c[9]||(c[9]=t("label",{class:"form-label"},"Bio",-1)),de(t("textarea",{"onUpdate:modelValue":c[4]||(c[4]=u=>r.value=u),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[ye,r.value]])]),t("div",Wu,[c[10]||(c[10]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",qu,x(k(i).user?.id),1)])]),t("div",Gu,[t("button",{class:"btn btn-primary",onClick:p},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:c[5]||(c[5]=u=>n("close"))},"Cancel")])])])]))}}),Ju={class:"profile-actions"},Qu=["disabled","onClick"],Yu={class:"profile-action-btn__circle"},Xu={class:"profile-action-btn__label"},Zu=se({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:s}){const n=e,i=s,a=W(()=>{const o=[{icon:si,label:"Message",event:"message"}];return n.showMute!==!1&&o.push({icon:ms,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&o.push({icon:Ya,label:"More",event:"more"}),o});return(o,l)=>(v(),h("div",Ju,[(v(!0),h(ce,null,ge(a.value,r=>(v(),h("button",{key:r.label,class:ve(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:d=>i(r.event)},[t("span",Yu,[(v(),Q(qe(r.icon),{size:22,"stroke-width":1.8}))]),t("span",Xu,x(r.label),1)],10,Qu))),128))]))}}),ed=fe(Zu,[["__scopeId","data-v-a16c1098"]]),td={class:"profile-info-list"},nd=["onClick"],sd={class:"profile-info-item__content"},ad={class:"profile-info-item__value"},id={class:"profile-info-item__label"},od=se({__name:"ProfileInfoList",props:{username:{},bio:{},userId:{}},setup(e){const s=e,n=y(null),i=W(()=>{const o=[];return s.username&&o.push({icon:Ga,label:"Username",value:`@${s.username}`,copyable:!0}),s.bio&&o.push({icon:Xa,label:"Bio",value:s.bio}),s.userId!=null&&o.push({icon:Za,label:"User ID",value:String(s.userId),copyable:!0}),o});async function a(o){try{await navigator.clipboard.writeText(o.replace(/^@/,""));const l=i.value.find(r=>r.value===o)?.label??null;n.value=l,setTimeout(()=>{n.value=null},1500)}catch{}}return(o,l)=>(v(),h("div",td,[(v(!0),h(ce,null,ge(i.value,r=>(v(),h("div",{key:r.label,class:ve(["profile-info-item",{"profile-info-item--copyable":r.copyable}]),onClick:d=>r.copyable?a(r.value):void 0},[(v(),Q(qe(r.icon),{class:"profile-info-item__icon",size:20,"stroke-width":1.8})),t("div",sd,[t("span",ad,x(r.value),1),t("span",id,x(r.label),1)]),r.copyable?(v(),Q(qe(n.value===r.label?k(ps):k(hs)),{key:0,class:"profile-info-item__copy",size:16,"stroke-width":1.8})):P("",!0)],10,nd))),128))]))}}),ld=fe(od,[["__scopeId","data-v-bc174e9a"]]),rd={class:"modal profile-modal"},cd={key:0,class:"profile-modal-body"},ud={class:"profile-header"},dd={class:"profile-header__content"},vd={class:"profile-header__info"},md={class:"profile-name"},fd={class:"profile-modal-body"},pd={class:"profile-media-tabs"},hd=["onClick"],gd={class:"profile-media-empty"},yd={key:2,class:"profile-modal-body"},bd=se({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:s}){const n=e,i=s,a=Ee(),{showToast:o}=Se(),l=y(null),r=y(!0),d=y(!1),b=["Media","Files","Links"],f=y("Media"),p=W(()=>l.value?a.isUserOnline(l.value.id):!1),m=W(()=>{if(p.value)return"online";if(!l.value)return"offline";const u=a.getUserPresence(l.value.id);return u?.lastSeenAt?ks(u.lastSeenAt):u?.lastSeenBucket?`last seen ${u.lastSeenBucket}`:"offline"});we(async()=>{try{l.value=await vs(n.username)}catch{l.value=null}finally{r.value=!1}});function c(){d.value=!d.value,o(d.value?"User muted":"User unmuted")}return(u,g)=>(v(),h("div",{class:"modal-backdrop profile-backdrop",onClick:g[2]||(g[2]=ue(E=>i("close"),["self"]))},[t("div",rd,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:g[0]||(g[0]=E=>i("close"))},[z(k(Fe),{size:20,"stroke-width":2})]),r.value?(v(),h("div",cd,[...g[3]||(g[3]=[t("div",{class:"profile-loading"},[t("p",null,"Loading...")],-1)])])):l.value?(v(),h(ce,{key:1},[t("div",ud,[g[4]||(g[4]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",dd,[z(_e,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:p.value,size:"xxl"},null,8,["name","url","online"]),t("div",vd,[t("div",md,[ke(x(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(v(),Q(As,{key:0})):P("",!0)]),t("div",{class:ve(["profile-status",{"profile-status--online":p.value}])},x(m.value),3)])])]),t("div",fd,[z(ed,{muted:d.value,"show-more":!1,onMessage:g[1]||(g[1]=E=>i("message",l.value.username)),onMute:c},null,8,["muted"]),g[5]||(g[5]=t("div",{class:"profile-divider"},null,-1)),z(ld,{username:l.value.username,bio:l.value.bio,"user-id":l.value.id},null,8,["username","bio","user-id"]),t("div",pd,[(v(),h(ce,null,ge(b,E=>t("button",{key:E,class:ve(["profile-media-tab",{"profile-media-tab--active":f.value===E}]),onClick:$=>f.value=E},x(E),11,hd)),64))]),t("div",gd,[z(k(ei),{size:32,"stroke-width":1.5}),t("span",null,"No "+x(f.value.toLowerCase())+" yet",1)])])],64)):(v(),h("div",yd,[...g[6]||(g[6]=[t("div",{class:"profile-loading"},[t("p",null,"User not found")],-1)])]))])]))}}),kd=fe(bd,[["__scopeId","data-v-1e27c432"]]),wd={class:"modal",style:{"max-width":"420px"}},_d={class:"modal-header"},Cd={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},$d=se({__name:"DownloadModal",emits:["close"],setup(e,{emit:s}){const n=s,i=navigator.userAgent.toLowerCase(),a=i.includes("win"),o=i.includes("mac")&&!i.includes("iphone")&&!i.includes("ipad"),l=W(()=>a?"Windows":o?"macOS":null);function r(){a?window.location.href="/downloads/windows/BeHappySetup.exe":o&&(window.location.href="/downloads/macos/BeHappy.dmg")}return(d,b)=>(v(),h("div",{class:"modal-backdrop",onClick:b[1]||(b[1]=ue(f=>n("close"),["self"]))},[t("div",wd,[t("div",_d,[b[2]||(b[2]=t("h2",{class:"modal-title"},"Download BeHappy",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:b[0]||(b[0]=f=>n("close"))},[z(k(Fe),{size:20})])]),t("div",Cd,[l.value?(v(),h("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+x(l.value),1)):P("",!0),b[3]||(b[3]=sa('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/BeHappySetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/BeHappy.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),Sd={class:"modal",style:{"max-width":"400px"}},Md={class:"modal-header"},xd={class:"modal-body",style:{"text-align":"center"}},Td={key:0},Ed={style:{"font-size":"1.25rem","font-weight":"700"}},Ld={style:{color:"var(--text-muted)","margin-top":".5rem"}},Id={class:"profile-avatar-section"},Ad={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},Rd={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},Dd={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},Od={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},Pd=["disabled"],Nd=se({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:s}){const n=e,i=s,{showToast:a}=Se(),o=y(null),l=y(!0),r=y(!1),d=y(""),b=y("");we(async()=>{if(!n.token){d.value="Invalid Link",b.value="No invite token provided.",l.value=!1;return}try{o.value=await ca(n.token)}catch(p){p.response?.status===410?(d.value="Invite Revoked",b.value="This invite link has been revoked."):(d.value="Invite Not Found",b.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function f(){r.value=!0;try{const p=await ua(n.token);a(p.already_member?"You are already a member":"Joined successfully!"),i("joined",p.chat_id)}catch(p){a(p.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(p,m)=>(v(),h("div",{class:"modal-backdrop",onClick:m[2]||(m[2]=ue(c=>i("close"),["self"]))},[t("div",Sd,[t("div",Md,[m[3]||(m[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:m[0]||(m[0]=c=>i("close"))},"âœ•")]),t("div",xd,[l.value?(v(),h("p",Td,"Loading invite preview...")):b.value?(v(),h(ce,{key:1},[t("h2",Ed,x(d.value),1),t("p",Ld,x(b.value),1)],64)):o.value?(v(),h(ce,{key:2},[t("div",Id,[z(_e,{name:o.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",Ad,x(o.value.title||o.value.type||"Chat"),1),o.value.description?(v(),h("p",Rd,x(o.value.description),1)):P("",!0),o.value.member_count?(v(),h("p",Dd,x(o.value.member_count)+" members ",1)):P("",!0),t("div",Od,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:f},x(r.value?"Joining...":"Join"),9,Pd),t("button",{class:"btn btn-ghost",onClick:m[1]||(m[1]=c=>i("close"))},"Cancel")])],64)):P("",!0)])])]))}}),Ud={class:"modal modal-wide settings-modal"},Fd={class:"modal-header"},zd={class:"modal-body"},Hd={class:"settings-profile-header"},Bd={class:"settings-profile-info"},jd={class:"settings-display-name"},Vd={class:"settings-username"},Wd={class:"settings-group"},qd={class:"settings-section-title"},Gd={class:"menu-item menu-item--setting"},Kd={class:"settings-group"},Jd={class:"settings-section-title"},Qd=["aria-checked"],Yd={class:"settings-group"},Xd={class:"settings-section-title"},Zd={class:"menu-item menu-item--setting"},ev={class:"settings-group"},tv={class:"settings-section-title"},nv={class:"menu-item menu-item--setting"},sv=["aria-checked"],av={class:"settings-actions"},iv=se({__name:"SettingsView",emits:["close"],setup(e,{emit:s}){const n=s,i=Le(),a=mt(),{showToast:o}=Se(),l=y("light"),r=y(!0),d=y("en"),b=y("everyone"),f=y(!0);Oe(r,async m=>{m&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(r.value=!1,o("Notifications blocked by browser"))}),we(()=>{l.value=a.theme,r.value=a.notificationsEnabled,d.value=a.language,b.value=a.lastSeenVisibility,f.value=a.readReceiptsEnabled});async function p(){try{await a.saveSettings({theme:l.value,notifications_enabled:r.value,language:d.value,last_seen_visibility:b.value,read_receipts_enabled:f.value}),o("Settings saved"),n("close")}catch{o("Failed to save settings")}}return(m,c)=>(v(),h("div",{class:"modal-backdrop",onClick:c[8]||(c[8]=ue(u=>n("close"),["self"]))},[t("div",Ud,[t("div",Fd,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=u=>n("close"))},[z(k(Ve),{size:20,"stroke-width":2})]),c[9]||(c[9]=t("span",{class:"modal-title"},"Settings",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[1]||(c[1]=u=>n("close"))},[z(k(Fe),{size:20,"stroke-width":2})])]),t("div",zd,[t("div",Hd,[z(_e,{name:k(i).user?.display_name||k(i).user?.username||"?",url:k(i).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",Bd,[t("div",jd,x(k(i).user?.display_name||k(i).user?.username||"---"),1),t("div",Vd,"@"+x(k(i).user?.username||"---"),1)])]),c[24]||(c[24]=t("div",{class:"settings-divider"},null,-1)),t("div",Wd,[t("div",qd,[z(k(Kn),{size:18,"stroke-width":1.8}),c[10]||(c[10]=t("span",null,"Appearance",-1))]),t("div",Gd,[z(k(Kn),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[12]||(c[12]=t("span",{class:"menu-item__label"},"Theme",-1)),de(t("select",{"onUpdate:modelValue":c[2]||(c[2]=u=>l.value=u),class:"form-input form-select settings-select"},[...c[11]||(c[11]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[en,l.value]])])]),c[25]||(c[25]=t("div",{class:"settings-divider"},null,-1)),t("div",Kd,[t("div",Jd,[z(k(Wn),{size:18,"stroke-width":1.8}),c[13]||(c[13]=t("span",null,"Notifications",-1))]),t("div",{class:"menu-item menu-item--toggle",onClick:c[3]||(c[3]=u=>r.value=!r.value)},[z(k(Wn),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[15]||(c[15]=t("span",{class:"menu-item__label"},"Notifications",-1)),t("span",{class:ve(["toggle-status",{"toggle-status--on":r.value}])},x(r.value?"Enabled":"Disabled"),3),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":r.value}]),role:"switch","aria-checked":r.value},[...c[14]||(c[14]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Qd)])]),c[26]||(c[26]=t("div",{class:"settings-divider"},null,-1)),t("div",Yd,[t("div",Xd,[z(k(Gn),{size:18,"stroke-width":1.8}),c[16]||(c[16]=t("span",null,"Language",-1))]),t("div",Zd,[z(k(Gn),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[18]||(c[18]=t("span",{class:"menu-item__label"},"Language",-1)),de(t("select",{"onUpdate:modelValue":c[4]||(c[4]=u=>d.value=u),class:"form-input form-select settings-select"},[...c[17]||(c[17]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[en,d.value]])])]),c[27]||(c[27]=t("div",{class:"settings-divider"},null,-1)),t("div",ev,[t("div",tv,[z(k(tn),{size:18,"stroke-width":1.8}),c[19]||(c[19]=t("span",null,"Privacy",-1))]),t("div",nv,[(v(),Q(qe(b.value==="nobody"?k(qn):k(tn)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[21]||(c[21]=t("span",{class:"menu-item__label"},"Last Seen & Online",-1)),de(t("select",{"onUpdate:modelValue":c[5]||(c[5]=u=>b.value=u),class:"form-input form-select settings-select"},[...c[20]||(c[20]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[en,b.value]])]),t("div",{class:"menu-item menu-item--toggle",onClick:c[6]||(c[6]=u=>f.value=!f.value)},[(v(),Q(qe(f.value?k(tn):k(qn)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[23]||(c[23]=t("span",{class:"menu-item__label"},"Read Receipts",-1)),t("span",{class:ve(["toggle-status",{"toggle-status--on":f.value}])},x(f.value?"Enabled":"Disabled"),3),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":f.value}]),role:"switch","aria-checked":f.value},[...c[22]||(c[22]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,sv)])]),c[28]||(c[28]=t("div",{class:"settings-divider"},null,-1)),t("div",av,[t("button",{class:"btn btn-primary",onClick:p},"Save Settings"),t("button",{class:"btn btn-ghost",onClick:c[7]||(c[7]=u=>n("close"))},"Cancel")])])])]))}}),ov=fe(iv,[["__scopeId","data-v-3b2634a6"]]),lv=se({__name:"ContextMenu",setup(e){const s=Ee(),{showToast:n}=Se(),{showConfirm:i}=aa(),a=y(!1),o=y(0),l=y(0),r=y(null),d=W(()=>r.value?s.chats.find(g=>g.id===r.value)??null:null);function b(g){r.value=g.detail.chatId,o.value=g.detail.x,l.value=g.detail.y,a.value=!0}function f(){a.value&&(a.value=!1,r.value=null)}we(()=>{window.addEventListener("show-context-menu",b),document.addEventListener("click",f)}),We(()=>{window.removeEventListener("show-context-menu",b),document.removeEventListener("click",f)});async function p(){if(r.value){a.value=!1;try{await s.toggleFavorite(r.value)}catch{n("Failed to update favorite")}}}async function m(){if(r.value){a.value=!1;try{await s.toggleMute(r.value)}catch{n("Failed to update mute")}}}async function c(){if(!(!r.value||(a.value=!1,!await i({title:"Leave Chat",message:"Leave this chat?",confirmLabel:"Leave",danger:!0}))))try{await s.leave(r.value),n("Left chat")}catch{n("Failed to leave chat")}}async function u(){if(!(!r.value||(a.value=!1,!await i({title:"Delete Chat",message:"Delete this chat? All messages will be permanently removed.",confirmLabel:"Delete",danger:!0}))))try{await s.deleteChat(r.value),n("Chat deleted")}catch{n("Failed to delete chat")}}return(g,E)=>a.value?(v(),h("div",{key:0,class:"context-menu",style:vt({left:o.value+"px",top:l.value+"px"})},[t("button",{class:"ctx-item",onClick:p},x(d.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:m},x(d.value?.is_muted?"Unmute":"Mute"),1),d.value&&d.value.type!=="direct"?(v(),h("button",{key:0,class:"ctx-item ctx-leave",onClick:c}," Leave chat ")):P("",!0),t("button",{class:"ctx-item ctx-delete",onClick:u}," Delete chat ")],4)):P("",!0)}}),as=240,rv=.5,dv=se({__name:"MessengerView",setup(e){const s=ia(),n=rs(),i=Le(),a=Ee(),o=mt(),l=Jt(),{showToast:r}=Se(),{connect:d,disconnect:b,sendTyping:f}=Ua();nt("sendTyping",f);const p=y(!1),m=y(!1),c=y("select"),u=y(!1),g=y(!1),E=y(!1),$=y(null),_=y(null),D=y([]),q=y(null);nt("stickers",D),nt("pendingScrollMessageId",q);let K=null;we(async()=>{await o.loadSettings();try{D.value=await Ha()}catch{}await a.loadChats(),d(),K=setInterval(()=>a.loadChats(),5e3),U()}),We(()=>{b(),K&&(clearInterval(K),K=null)}),Oe(()=>s.path,()=>{U()}),Oe(()=>a.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function U(){const G=s.path;if(G.startsWith("/@")){const C=s.params.username;C&&($.value=C)}else if(G.startsWith("/u/")){const C=s.params.id;if(C)try{const B=await ds(parseInt(C));$.value=B.username}catch{r("User not found")}}else if(G.startsWith("/dm/")){const C=s.params.id;C&&await te(C)}else if(G.startsWith("/c/")){const C=s.params.chatIdOrName||s.params.name,B=s.params.messageId?parseInt(s.params.messageId):null;if(C)if(/^\d+$/.test(C)){const re=parseInt(C);B?await T(re,B):a.setActiveChat(re)}else await le(C)}}async function te(G){try{let C;if(G.startsWith("@")){const Z=G.substring(1);C=(await vs(Z)).id}else C=parseInt(G);const B=await st({type:"direct",member_ids:[C]});await a.loadChats(),a.setActiveChat(B.id)}catch{r("Failed to open conversation")}}async function le(G){try{const C=await va(G);a.chats.find(Z=>Z.id===C.id)?a.setActiveChat(C.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function T(G,C){if(!a.chats.find(Z=>Z.id===G)){r("Chat not found");return}a.setActiveChat(G),await Ce(),q.value=C}const M=parseInt(localStorage.getItem("sidebar-width")||"360",10);M>=as&&document.documentElement.style.setProperty("--sidebar-width",M+"px");function I(G){G.preventDefault();const C=G.currentTarget;C.setPointerCapture(G.pointerId);const B=re=>{const Ie=window.innerWidth*rv,Me=Math.min(Ie,Math.max(as,re.clientX));document.documentElement.style.setProperty("--sidebar-width",Me+"px")},Z=()=>{C.removeEventListener("pointermove",B),C.removeEventListener("pointerup",Z);const re=getComputedStyle(document.documentElement).getPropertyValue("--sidebar-width").trim();localStorage.setItem("sidebar-width",parseInt(re,10).toString())};C.addEventListener("pointermove",B),C.addEventListener("pointerup",Z)}function J(G){a.setActiveChat(G),n.replace("/app")}function H(){a.setActiveChat(null)}function R(){p.value=!1,u.value=!0}function j(){p.value=!1,g.value=!0}function he(){p.value=!1,c.value="group",m.value=!0}function pe(){p.value=!1,c.value="channel",m.value=!0}async function S(){if(p.value=!1,!!i.user)try{const G=await st({type:"direct",member_ids:[i.user.id]});await a.loadChats(),a.setActiveChat(G.id)}catch{r("Failed to open Saved Messages")}}function A(G){$.value=G}async function V(G){$.value=null,await te("@"+G)}async function F(G){m.value=!1,await a.loadChats(),a.setActiveChat(G)}async function ne(G){_.value=null,await a.loadChats(),a.setActiveChat(G)}function ae(G){const C=G.target?.closest("a");if(!C)return;const B=C.getAttribute("href");if(!B)return;let Z;try{Z=new URL(B,window.location.origin)}catch{return}if(Z.origin!==window.location.origin){G.preventDefault(),G.stopPropagation(),window.open(Z.href,"_blank");return}G.preventDefault(),G.stopPropagation();const re=Z.pathname,Ie=re.match(/^\/join\/([^/]+)$/);if(Ie){_.value=Ie[1]??null;return}if(re.startsWith("/@")||re.startsWith("/u/")||re.startsWith("/dm/")||re.startsWith("/c/")){n.push(re);return}n.push(re)}function oe(G){if(G.key==="Escape"){if(_.value){_.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if($.value){$.value=null;return}if(m.value){m.value=!1;return}if(u.value){u.value=!1;return}if(g.value){g.value=!1;return}if(E.value){E.value=!1;return}if(p.value){p.value=!1;return}if(a.activeChatId!==null){H();return}}}return we(()=>{document.addEventListener("keydown",oe),document.addEventListener("click",ae,!0)}),We(()=>{document.removeEventListener("keydown",oe),document.removeEventListener("click",ae,!0)}),(G,C)=>(v(),h("div",{class:ve(["layout",{"chat-open":!!k(a).activeChatId}])},[z(nu,{open:p.value,onClose:C[0]||(C[0]=B=>p.value=!1),onOpenProfile:R,onOpenSettings:j,onOpenNewGroup:he,onOpenNewChannel:pe,onOpenFavorites:S,onOpenDownload:C[1]||(C[1]=B=>E.value=!0)},null,8,["open"]),t("div",{class:ve(["drawer-overlay",{visible:p.value}]),onClick:C[2]||(C[2]=B=>p.value=!1)},null,2),z(Ei,{onOpenDrawer:C[3]||(C[3]=B=>p.value=!0),onOpenNewChat:C[4]||(C[4]=B=>{c.value="select",m.value=!0}),onSelectChat:J}),t("div",{class:"resize-handle",onPointerdown:I},null,32),z(Nc,{onBack:H,onOpenUserProfile:A}),m.value?(v(),Q(Ru,{key:0,"initial-step":c.value,onClose:C[5]||(C[5]=B=>m.value=!1),onChatCreated:F},null,8,["initial-step"])):P("",!0),u.value?(v(),Q(Ku,{key:1,onClose:C[6]||(C[6]=B=>u.value=!1)})):P("",!0),g.value?(v(),Q(ov,{key:2,onClose:C[7]||(C[7]=B=>g.value=!1)})):P("",!0),$.value?(v(),Q(kd,{key:3,username:$.value,onClose:C[8]||(C[8]=B=>$.value=null),onMessage:V},null,8,["username"])):P("",!0),E.value?(v(),Q($d,{key:4,onClose:C[9]||(C[9]=B=>E.value=!1)})):P("",!0),_.value?(v(),Q(Nd,{key:5,token:_.value,onClose:C[10]||(C[10]=B=>_.value=null),onJoined:ne},null,8,["token"])):P("",!0),z(lv)],2))}});export{dv as default};
