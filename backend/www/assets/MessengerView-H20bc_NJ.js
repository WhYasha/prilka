import{l as Q,m as Xe,r as y,p as V,q as ra,s as qe,u as Le,x as pn,d as se,o as d,c as h,a as t,t as x,w as ce,y as Ze,n as de,h as U,b as k,z as Y,e as P,g as ye,f as me,v as ge,F as ie,A as he,B as it,C as Oe,D as Qe,E as ca,G as _e,H as hn,I as $e,T as fs,J as xe,i as Xt,K as Sn,L as ps,M as ua,N as Kn,O as Yn,P as ze,k as hs,Q as da,R as on,S as va,U as ma}from"./index-CsSFc4Ra.js";import{_ as we,l as fa,c as pa,r as ha,p as ga,j as ya}from"./invites-BbgfKKo5.js";async function ba(){const{data:e}=await Q.get("/chats");return e}async function gs(e){const{data:s}=await Q.get(`/chats/${e}`);return s}async function ka(e){const{data:s}=await Q.get(`/chats/by-name/${encodeURIComponent(e)}`);return s}async function ot(e){const{data:s}=await Q.post("/chats",e);return s}async function wa(e){await Q.post(`/chats/${e}/favorite`)}async function _a(e){await Q.delete(`/chats/${e}/favorite`)}async function Ca(e,s){await Q.post(`/chats/${e}/mute`,{})}async function $a(e){await Q.delete(`/chats/${e}/mute`)}async function Sa(e){await Q.delete(`/chats/${e}/leave`)}async function Ma(e){await Q.post(`/chats/${e}/read`)}async function xa(e){await Q.post(`/chats/${e}/pin`)}async function Ta(e){await Q.delete(`/chats/${e}/pin`)}async function Ea(e){await Q.post(`/chats/${e}/archive`)}async function Ia(e){await Q.delete(`/chats/${e}/archive`)}async function La(e){const{data:s}=await Q.get(`/chats/${e}`);return s.members??[]}async function ys(e){await Q.delete(`/chats/${e}`)}async function Aa(e,s){const{data:n}=await Q.patch(`/chats/${e}`,s);return n}async function Ra(e){const{data:s}=await Q.get(`/chats/${e}/read-receipts`);return s}const Me=Xe("chats",()=>{const e=y([]),s=y(null),n=y({}),i=y(new Set),a=y({}),o=V(()=>e.value.find(E=>E.id===s.value)??null),l=V(()=>[...e.value].sort((E,M)=>{if(E.is_pinned&&!M.is_pinned)return-1;if(!E.is_pinned&&M.is_pinned)return 1;if(E.is_favorite&&!M.is_favorite)return-1;if(!E.is_favorite&&M.is_favorite)return 1;const B=E.last_at||E.updated_at||"";return(M.last_at||M.updated_at||"").localeCompare(B)}));async function r(){try{e.value=await ba()}catch(E){console.error("Failed to load chats",E)}}function u(E){if(s.value=E,E!==null){const M=e.value.find(B=>B.id===E);M&&M.unread_count>0&&(M.unread_count=0,Ma(E).catch(()=>{}))}}async function b(E){const M=e.value.find(B=>B.id===E);if(M)try{M.is_favorite?await _a(E):await wa(E),M.is_favorite=!M.is_favorite}catch(B){throw console.error("Failed to toggle favorite",B),B}}async function p(E){const M=e.value.find(B=>B.id===E);if(M)try{M.is_muted?await $a(E):await Ca(E),M.is_muted=!M.is_muted}catch(B){throw console.error("Failed to toggle mute",B),B}}async function v(E){const M=e.value.find(B=>B.id===E);if(M)try{M.is_pinned?await Ta(E):await xa(E),M.is_pinned=!M.is_pinned}catch(B){throw console.error("Failed to toggle pin",B),B}}async function f(E){const M=e.value.find(B=>B.id===E);if(M)try{M.is_archived?await Ia(E):await Ea(E),M.is_archived=!M.is_archived}catch(B){throw console.error("Failed to toggle archive",B),B}}async function c(E){await Sa(E),e.value=e.value.filter(M=>M.id!==E),s.value===E&&(s.value=null)}async function m(E){await ys(E),e.value=e.value.filter(M=>M.id!==E),s.value===E&&(s.value=null)}function g(E,M,B){const J=e.value.find(W=>W.id===E);J&&(J.last_message=M,J.last_at=B)}function T(E){const M=e.value.find(B=>B.id===E);M&&(M.unread_count=(M.unread_count||0)+1)}function C(E,M,B){n.value[E]||(n.value[E]={});const J=n.value[E][M];J&&clearTimeout(J.timer);const W=setTimeout(()=>{_(E,M)},3e3);n.value[E][M]={username:B,timer:W}}function _(E,M){if(n.value[E]){const B=n.value[E][M];B&&(clearTimeout(B.timer),delete n.value[E][M])}}function D(E){const M=n.value[E];return M?Object.values(M).map(B=>B.username):[]}function F(E){i.value=new Set([...i.value,E]),a.value={...a.value,[E]:{isOnline:!0}}}function z(E,M,B){const J=new Set(i.value);J.delete(E),i.value=J,a.value={...a.value,[E]:{isOnline:!1,lastSeenAt:M,lastSeenBucket:B}}}function N(E,M){if(M.isOnline)i.value=new Set([...i.value,E]);else{const B=new Set(i.value);B.delete(E),i.value=B}a.value={...a.value,[E]:M}}function ne(E){return a.value[E]}function re(E){return i.value.has(E)}return{chats:e,activeChatId:s,activeChat:o,sortedChats:l,typingUsers:n,loadChats:r,setActiveChat:u,toggleFavorite:b,toggleMute:p,togglePin:v,toggleArchive:f,leave:c,deleteChat:m,updateChatLastMessage:g,incrementUnread:T,setTyping:C,clearTyping:_,getTypingUsernames:D,onlineUsers:i,userPresenceDetails:a,setUserOnline:F,setUserOffline:z,setUserPresence:N,getUserPresence:ne,isUserOnline:re}});async function Da(){const{data:e}=await Q.get("/settings");return e}async function Oa(e){await Q.put("/settings",e)}const pt=Xe("settings",()=>{const e=y(localStorage.getItem("theme")||"light"),s=y(!0),n=y("en"),i=y("everyone"),a=y(!0);function o(u){e.value=u,document.body.setAttribute("data-theme",u),localStorage.setItem("theme",u)}async function l(){try{const u=await Da();o(u.theme||"light"),s.value=u.notifications_enabled,n.value=u.language||"en",i.value=u.last_seen_visibility||"everyone",a.value=u.read_receipts_enabled!==!1}catch(u){console.error("Failed to load settings",u)}}async function r(u){await Oa(u),u.theme&&o(u.theme),u.notifications_enabled!==void 0&&(s.value=u.notifications_enabled),u.language&&(n.value=u.language),u.last_seen_visibility&&(i.value=u.last_seen_visibility),u.read_receipts_enabled!==void 0&&(a.value=u.read_receipts_enabled)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:s,language:n,lastSeenVisibility:i,readReceiptsEnabled:a,applyTheme:o,loadSettings:l,saveSettings:r}}),Ke=Xe("selection",()=>{const e=y(new Set),s=y(!1),n=y(null),i=V(()=>e.value.size);function a(p,v){s.value=!0,n.value=p,e.value=new Set(v!=null?[v]:[])}function o(){s.value=!1,n.value=null,e.value=new Set}function l(p){const v=new Set(e.value);v.has(p)?v.delete(p):v.add(p),e.value=v,v.size===0&&o()}function r(p){if(!s.value||e.value.has(p))return;const v=new Set(e.value);v.add(p),e.value=v}function u(){e.value=new Set}function b(p){return e.value.has(p)}return{selectedMessageIds:e,selectionMode:s,currentChatId:n,selectedCount:i,enterSelectionMode:a,exitSelectionMode:o,toggleMessage:l,addMessage:r,clearSelection:u,isSelected:b}});async function Ct(e,s){const{data:n}=await Q.get(`/chats/${e}/messages`,{params:s});return n}async function Pa(e,s){const{data:n}=await Q.post(`/chats/${e}/messages`,s);return n}async function Na(e,s,n=!1){await Q.delete(`/chats/${e}/messages/${s}`,n?{data:{for_everyone:!0}}:void 0)}async function Ua(e,s,n){const{data:i}=await Q.put(`/chats/${e}/messages/${s}`,{content:n});return i}async function Fa(e,s){const{data:n}=await Q.post(`/chats/${e}/messages/forward`,s);return n}async function za(e,s){const{data:n}=await Q.post(`/chats/${e}/messages/${s}/pin`);return n}async function Ba(e,s){await Q.delete(`/chats/${e}/messages/${s}/pin`)}async function Ha(e){const{data:s}=await Q.get(`/chats/${e}/pinned-message`);return s}async function Jn(e,s,n){const{data:i}=await Q.get(`/chats/${e}/messages/search`,{params:{q:s,...n}});return i}async function ja(e,s,n){const{data:i}=await Q.post(`/chats/${e}/messages/${s}/reactions`,{emoji:n});return i}async function Va(e,s){if(!s.length)return{};const{data:n}=await Q.get(`/chats/${e}/reactions`,{params:{message_ids:s.join(",")}});return n}const ht=Xe("messages",()=>{const e=y({}),s=y({}),n=y(null),i=y({}),a=y(new Set),o=ra(new Set);function l(S){return o.add(S),new Promise(A=>setTimeout(A,600))}function r(S){return o.has(S)}async function u(S){const A=e.value[S];if(!A||A.length===0)return;const q=A.map(H=>H.id);try{const H=await Va(S,q);for(const ee of A)ee.reactions=H[String(ee.id)]||void 0}catch(H){console.error("Failed to load reactions",H)}}async function b(S){n.value=S;try{const A=await Ct(S,{limit:50});e.value[S]=A,A.length>0&&(s.value[S]=Math.max(...A.map(q=>q.id))),await u(S)}catch(A){throw console.error("Failed to load messages",A),A}finally{n.value=null}}async function p(S){const A=s.value[S]||0;if(A===0)return[];try{const q=await Ct(S,{after_id:A,limit:50});if(q.length>0){e.value[S]||(e.value[S]=[]);const H=new Set(e.value[S].map(ue=>ue.id)),ee=q.filter(ue=>!H.has(ue.id));e.value[S].push(...ee),s.value[S]=Math.max(...q.map(ue=>ue.id)),await u(S)}return q}catch(q){return console.error("Failed to load newer messages",q),[]}}async function v(S){const A=e.value[S];if(!A||A.length===0)return[];const q=A[0];if(!q)return[];try{const H=await Ct(S,{before:q.created_at,limit:50});if(H.length>0){const ee=new Set(A.map(ve=>ve.id)),ue=H.filter(ve=>!ee.has(ve.id));e.value[S]=[...ue,...A],await u(S)}return H}catch(H){return console.error("Failed to load older messages",H),[]}}async function f(S,A,q){try{const H=await ja(S,A,q);c(S,A,H.action,q,!0)}catch(H){console.error("Failed to toggle reaction",H)}}function c(S,A,q,H,ee){const ue=e.value[S];if(!ue)return;const ve=ue.find($=>$.id===A);if(!ve)return;ve.reactions||(ve.reactions=[]);const K=ve.reactions.find($=>$.emoji===H);q==="added"?K?(K.count++,ee&&(K.me=!0)):ve.reactions.push({emoji:H,count:1,me:ee}):K&&(K.count--,ee&&(K.me=!1),K.count<=0&&(ve.reactions=ve.reactions.filter($=>$.emoji!==H))),ve.reactions.length===0&&(ve.reactions=void 0)}async function m(S,A,q="text",H){const ee=await Pa(S,{content:A,type:q,...H});e.value[S]||(e.value[S]=[]),g(S,ee);const ue=e.value[S].findIndex(ve=>ve.id===ee.id);return ue!==-1?e.value[S][ue]=ee:e.value[S].push(ee),s.value[S]=Math.max(s.value[S]||0,ee.id),ee}function g(S,A){if(!A.reply_to_message_id||A.reply_to_sender_username||A.reply_to_sender_name)return;const q=e.value[S];if(!q)return;const H=q.find(ee=>ee.id===A.reply_to_message_id);H&&(A.reply_to_sender_username=H.sender_username,A.reply_to_sender_name=H.sender_display_name||H.sender_username,!A.reply_to_content&&H.content&&(A.reply_to_content=H.content),!A.reply_to_type&&H.message_type&&(A.reply_to_type=H.message_type))}function T(S,A){e.value[S]||(e.value[S]=[]),e.value[S].find(H=>H.id===A.id)||(g(S,A),e.value[S].push(A),s.value[S]=Math.max(s.value[S]||0,A.id))}async function C(S,A,q=!1){try{await l(A),await Na(S,A,q),_(S,A)}catch(H){throw console.error("Failed to delete message",H),H}finally{o.delete(A)}}function _(S,A){const q=e.value[S];q&&(e.value[S]=q.filter(H=>H.id!==A))}async function D(S,A,q){try{const H=await Ua(S,A,q);F(S,A,H.content,H.updated_at)}catch(H){throw console.error("Failed to edit message",H),H}}function F(S,A,q,H){const ee=e.value[S];if(!ee)return;const ue=ee.find(ve=>ve.id===A);ue&&(ue.content=q,ue.is_edited=!0,H&&(ue.updated_at=H))}async function z(S,A,q){try{const H=await Fa(S,{from_chat_id:A,message_ids:q});for(const ee of H)T(S,ee);return H}catch(H){throw console.error("Failed to forward messages",H),H}}async function N(S){try{const A=await Ha(S);A&&A.message?i.value[S]={message:A.message,pinnedAt:A.pinned_at,pinnedBy:A.pinned_by}:i.value[S]=null}catch(A){console.error("Failed to load pinned message",A),i.value[S]=null}}async function ne(S,A){try{const q=await za(S,A);i.value[S]={message:q.message,pinnedAt:q.pinned_at,pinnedBy:q.pinned_by},a.value.delete(S)}catch(q){throw console.error("Failed to pin message",q),q}}async function re(S,A){try{await Ba(S,A),i.value[S]=null}catch(q){throw console.error("Failed to unpin message",q),q}}function E(S,A,q,H){i.value[S]={message:H,pinnedAt:new Date().toISOString(),pinnedBy:q},a.value.delete(S)}function M(S){i.value[S]=null}function B(S){a.value.add(S)}function J(S){return e.value[S]||[]}const W=y({});function I(S,A,q){W.value[S]||(W.value[S]={});const H=W.value[S][A]||0;q>H&&(W.value[S][A]=q)}async function j(S){try{const A=await Ra(S);W.value[S]||(W.value[S]={});for(const q of A)W.value[S][q.user_id]=q.last_read_msg_id}catch(A){console.error("Failed to load read receipts",A)}}function oe(S,A,q){const H=W.value[S];return H?q?(H[q]||0)>=A:Object.values(H).some(ee=>ee>=A):!1}function be(S,A){const q=W.value[S];return q?Object.values(q).filter(H=>H>=A).length:0}return{messagesByChat:e,lastMsgId:s,loadingChat:n,loadMessages:b,loadNewer:p,loadOlder:v,sendMessage:m,pushMessage:T,getMessages:J,toggleReaction:f,applyReactionUpdate:c,deleteMessage:C,removeMessage:_,editMessage:D,applyMessageUpdate:F,forwardMessages:z,pinnedByChat:i,pinnedDismissed:a,loadPinnedMessage:N,pinMsg:ne,unpinMsg:re,applyMessagePinned:E,applyMessageUnpinned:M,dismissPin:B,deletingMessages:o,markForDeletion:l,isDeleting:r,readReceipts:W,applyReadReceipt:I,loadReadReceipts:j,isMessageRead:oe,getReadCount:be}});function Wa(e,s,n){if(!document.hidden||e.sender_id===n.user?.id||!pt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||s.chats.find(u=>u.id===e.chat_id)?.is_muted)return;const o=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(o,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),s.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function qa(){const e=y(!1);let s=null,n=null,i=null,a=1e3,o=!1,l=null,r=!document.hidden&&document.hasFocus(),u=!1;function b(N){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"presence_update",status:N}))}function p(){const N=!document.hidden&&document.hasFocus();N&&!r?(l&&(clearTimeout(l),l=null),r=!0,b("active")):!N&&r&&(l||(l=setTimeout(()=>{l=null,r=!1,b("away")},3e3)))}function v(){u||(u=!0,document.addEventListener("visibilitychange",p),window.addEventListener("focus",p),window.addEventListener("blur",p))}function f(){u&&(u=!1,document.removeEventListener("visibilitychange",p),window.removeEventListener("focus",p),window.removeEventListener("blur",p),l&&(clearTimeout(l),l=null))}function c(){const N=localStorage.getItem("access_token");return N?`wss://ws.behappy.rest/ws?token=${encodeURIComponent(N)}`:null}function m(){if(s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING))return;const N=c();N&&(o=!1,s=new WebSocket(N),s.onopen=()=>{e.value=!0,a=1e3,r=!document.hidden&&document.hasFocus();const ne=localStorage.getItem("access_token");ne&&s.send(JSON.stringify({type:"auth",token:ne,active:r}));const re=Me();for(const E of re.chats)s.send(JSON.stringify({type:"subscribe",chat_id:E.id}));T(),v()},s.onmessage=ne=>{try{const re=JSON.parse(ne.data);g(re)}catch{}},s.onclose=()=>{e.value=!1,C(),o||_()},s.onerror=()=>{})}function g(N){const ne=ht(),re=Me(),E=Le();switch(N.type){case"message":{const M=N;ne.pushMessage(M.chat_id,M),re.updateChatLastMessage(M.chat_id,M.content||(M.message_type==="sticker"?"Sticker":"Attachment"),M.created_at),M.chat_id!==re.activeChatId&&M.sender_id!==E.user?.id&&re.incrementUnread(M.chat_id),re.clearTyping(M.chat_id,M.sender_id),Wa(M,re,E);break}case"typing":{const M=N.chat_id,B=N.user_id;if(B!==E.user?.id){const J=N.username||"Someone";re.setTyping(M,B,J)}break}case"pong":break;case"presence":{const M=N.user_id,B=N.status,J=N.last_seen_at,W=N.last_seen_bucket;if(B==="online")re.setUserOnline(M);else if(B==="offline"){const I=J||new Date().toISOString();re.setUserOffline(M,I,W)}break}case"message_deleted":{const M=N.chat_id,B=N.message_id;ne.removeMessage(M,B);break}case"message_updated":{const M=N.chat_id,B=N.message_id,J=N.content,W=N.updated_at;ne.applyMessageUpdate(M,B,J,W);break}case"message_pinned":{const M=N.chat_id,B=N.message_id,J=N.pinned_by,W=N.message;ne.applyMessagePinned(M,B,J,W);break}case"message_unpinned":{const M=N.chat_id;ne.applyMessageUnpinned(M);break}case"reaction":{const M=N.chat_id,B=N.message_id,J=N.user_id,W=N.emoji,I=N.action;ne.applyReactionUpdate(M,B,I,W,J===E.user?.id);break}case"read_receipt":{const M=N.chat_id,B=N.user_id,J=N.last_read_msg_id;ne.applyReadReceipt(M,B,J);break}}}function T(){C(),i=setInterval(()=>{s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},25e3)}function C(){i&&(clearInterval(i),i=null)}function _(){n||(n=setTimeout(()=>{n=null,m(),a=Math.min(a*2,3e4)},a))}function D(N){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"subscribe",chat_id:N}))}function F(N){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"typing",chat_id:N}))}function z(){o=!0,C(),f(),n&&(clearTimeout(n),n=null),s&&(s.close(),s=null),e.value=!1}return qe(()=>{z()}),{connected:e,connect:m,disconnect:z,subscribeToChat:D,sendTyping:F}}async function bs(e){const{data:s}=await Q.get(`/users/${e}`);return s}async function ks(e){const{data:s}=await Q.get(`/users/by-username/${encodeURIComponent(e)}`);return s}async function Qn(e){const{data:s}=await Q.get("/users/search",{params:{q:e}});return s}async function Ga(e,s){const{data:n}=await Q.put(`/users/${e}`,s);return n}async function Ka(e){const{data:s}=await Q.put("/users/me/avatar",{file_id:e});return s}async function Ya(){const{data:e}=await Q.get("/stickers");return e}const Ja=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};const Xn=e=>e==="";const Qa=(...e)=>e.filter((s,n,i)=>!!s&&s.trim()!==""&&i.indexOf(s)===n).join(" ").trim();const Zn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const Xa=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,n,i)=>i?i.toUpperCase():n.toLowerCase());const Za=e=>{const s=Xa(e);return s.charAt(0).toUpperCase()+s.slice(1)};var nt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const ei=({name:e,iconNode:s,absoluteStrokeWidth:n,"absolute-stroke-width":i,strokeWidth:a,"stroke-width":o,size:l=nt.width,color:r=nt.stroke,...u},{slots:b})=>pn("svg",{...nt,...u,width:l,height:l,stroke:r,"stroke-width":Xn(n)||Xn(i)||n===!0||i===!0?Number(a||o||nt["stroke-width"])*24/Number(l):a||o||nt["stroke-width"],class:Qa("lucide",u.class,...e?[`lucide-${Zn(Za(e))}-icon`,`lucide-${Zn(e)}`]:["lucide-icon"]),...!b.default&&!Ja(u)&&{"aria-hidden":"true"}},[...s.map(p=>pn(...p)),...b.default?[b.default()]:[]]);const te=(e,s)=>(n,{slots:i,attrs:a})=>pn(ei,{...a,...n,iconNode:s,name:e},i);const Fe=te("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const ti=te("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);const ws=te("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const es=te("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);const ni=te("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const _s=te("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Cs=te("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const si=te("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const $s=te("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const ai=te("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const ii=te("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const ts=te("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const ln=te("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Ss=te("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const ns=te("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const oi=te("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);const Ms=te("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const li=te("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const ri=te("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const Mn=te("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const xn=te("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const ci=te("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const ui=te("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const di=te("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);const vi=te("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const ss=te("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);const Tn=te("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const mi=te("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);const fi=te("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);const pi=te("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const hi=te("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const gi=te("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const yi=te("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const xs=te("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const Ts=te("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const Zt=te("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const Be=te("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),bi={class:"swipe-actions swipe-actions-left"},ki={class:"chat-item-info"},wi={class:"chat-item-top"},_i={class:"chat-item-name"},Ci={class:"chat-item-time"},$i={class:"chat-item-bottom"},Si={class:"chat-item-preview"},Mi=["title"],xi={class:"swipe-actions swipe-actions-right"},as=70,Ti=se({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:s}){const n=e,i=Me(),a=Le(),o=V(()=>n.chat.type==="direct"&&!n.chat.other_user_id),l=V(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:i.isUserOnline(n.chat.other_user_id)||null),r=V(()=>(n.chat.unread_count??0)>0),u=s,b=V(()=>{const C=n.chat;return o.value?"Saved Messages":C.type==="channel"||C.type==="group"?C.title||C.name||"Untitled":C.other_display_name||C.other_username||C.title||C.name||"Chat"});function p(C){if(!C)return"";const _=new Date(C.endsWith("Z")?C:C+"Z"),D=new Date;return _.toDateString()===D.toDateString()?_.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):_.toLocaleDateString([],{month:"short",day:"numeric"})}const v=y(0);let f=0,c=!1;function m(C){f=C.touches[0].clientX,c=!0}function g(C){if(!c)return;const _=C.touches[0].clientX-f;v.value=Math.max(-as,Math.min(as,_))}function T(){c=!1,v.value=0}return(C,_)=>(d(),h("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:m,onTouchmove:g,onTouchend:T},[t("div",bi,[t("button",{class:"swipe-action swipe-pin",onClick:_[0]||(_[0]=D=>u("togglePin"))},x(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:de(["chat-item",{active:e.active,"chat-item-unread":r.value}]),style:Ze({transform:`translateX(${v.value}px)`}),onClick:_[2]||(_[2]=D=>u("select")),onContextmenu:_[3]||(_[3]=ce(D=>u("contextmenu",D),["prevent"]))},[U(we,{name:b.value,url:o.value?k(a).user?.avatar_url||null:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"md",online:l.value},null,8,["name","url","online"]),t("div",ki,[t("div",wi,[t("span",_i,[e.chat.type==="channel"?(d(),Y(k(xn),{key:0,class:"chat-type-icon",size:14,"stroke-width":2})):e.chat.type==="group"?(d(),Y(k(Zt),{key:1,class:"chat-type-icon",size:14,"stroke-width":2})):P("",!0),ye(" "+x(b.value)+" ",1),e.chat.is_pinned?(d(),Y(k(mi),{key:2,class:"status-icon",size:14,"stroke-width":1.8,title:"Pinned"})):P("",!0),e.chat.is_muted?(d(),Y(k(ws),{key:3,class:"status-icon status-icon-muted",size:14,"stroke-width":1.8,title:"Muted"})):P("",!0)]),t("span",Ci,x(p(e.chat.last_at||e.chat.updated_at)),1)]),t("div",$i,[t("span",Si,x(e.chat.last_message||""),1),e.chat.unread_count>0?(d(),h("span",{key:0,class:de(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},x(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):P("",!0)])]),t("button",{class:de(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:_[1]||(_[1]=ce(D=>u("toggleFavorite"),["stop"]))},"â˜…",10,Mi)],38),t("div",xi,[t("button",{class:"swipe-action swipe-mute",onClick:_[4]||(_[4]=D=>u("toggleMute"))},x(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),fe=(e,s)=>{const n=e.__vccOpts||e;for(const[i,a]of s)n[i]=a;return n},rn=fe(Ti,[["__scopeId","data-v-e3cb05e4"]]),Ei={class:"sidebar"},Ii={class:"sidebar-header"},Li={class:"search-wrap"},Ai={class:"chat-list"},Ri={key:0,class:"empty-state-small"},Di={key:0,class:"chat-section-label"},Oi={key:1,class:"chat-section-label"},Pi={key:2,class:"chat-section-label"},Ni=se({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:s}){const n=s,i=Me(),a=y(""),o=V(()=>{const f=a.value.toLowerCase(),c=i.sortedChats.filter(m=>!m.is_archived);return f?c.filter(m=>{const g=b(m).toLowerCase(),T=(m.other_username||"").toLowerCase();return g.includes(f)||T.includes(f)}):c}),l=V(()=>o.value.filter(f=>f.is_pinned&&!f.is_favorite)),r=V(()=>o.value.filter(f=>f.is_favorite&&!f.is_pinned)),u=V(()=>o.value.filter(f=>!f.is_favorite&&!f.is_pinned));function b(f){return f.type==="channel"||f.type==="group"?f.title||f.name||"Untitled":f.type==="direct"&&!f.other_user_id?"Saved Messages":f.other_display_name||f.other_username||f.title||f.name||"Chat"}const p=y(null);it("contextChatId",p);function v(f,c){f.preventDefault(),p.value=c,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:f.clientX,y:f.clientY,chatId:c}}))}return(f,c)=>(d(),h("aside",Ei,[t("header",Ii,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:c[0]||(c[0]=m=>n("openDrawer"))},[U(k(ci),{size:20})]),t("div",Li,[U(k(fi),{size:16,class:"search-icon"}),me(t("input",{"onUpdate:modelValue":c[1]||(c[1]=m=>a.value=m),class:"search-input",type:"search",placeholder:"Search"},null,512),[[ge,a.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:c[2]||(c[2]=m=>n("openNewChat"))},[U(k(gi),{size:20})])]),t("div",Ai,[o.value.length===0?(d(),h("div",Ri,[...c[3]||(c[3]=[ye(" No conversations yet.",-1),t("br",null,null,-1),ye("Click the pencil icon to start one. ",-1)])])):(d(),h(ie,{key:1},[l.value.length>0?(d(),h("div",Di,"Pinned")):P("",!0),(d(!0),h(ie,null,he(l.value,m=>(d(),Y(rn,{key:m.id,chat:m,active:m.id===k(i).activeChatId,onSelect:g=>n("selectChat",m.id),onToggleFavorite:g=>k(i).toggleFavorite(m.id),onTogglePin:g=>k(i).togglePin(m.id),onToggleMute:g=>k(i).toggleMute(m.id),onToggleArchive:g=>k(i).toggleArchive(m.id),onContextmenu:g=>v(g,m.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(d(),h("div",Oi,"Starred")):P("",!0),(d(!0),h(ie,null,he(r.value,m=>(d(),Y(rn,{key:m.id,chat:m,active:m.id===k(i).activeChatId,onSelect:g=>n("selectChat",m.id),onToggleFavorite:g=>k(i).toggleFavorite(m.id),onTogglePin:g=>k(i).togglePin(m.id),onToggleMute:g=>k(i).toggleMute(m.id),onToggleArchive:g=>k(i).toggleArchive(m.id),onContextmenu:g=>v(g,m.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&u.value.length>0?(d(),h("div",Pi," All chats ")):P("",!0),(d(!0),h(ie,null,he(u.value,m=>(d(),Y(rn,{key:m.id,chat:m,active:m.id===k(i).activeChatId,onSelect:g=>n("selectChat",m.id),onToggleFavorite:g=>k(i).toggleFavorite(m.id),onTogglePin:g=>k(i).togglePin(m.id),onToggleMute:g=>k(i).toggleMute(m.id),onToggleArchive:g=>k(i).toggleArchive(m.id),onContextmenu:g=>v(g,m.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function Ui(){const e=y(!1),s=y(0);let n=null,i=[],a=null;async function o(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const p=await navigator.mediaDevices.getUserMedia({audio:!0});i=[],s.value=0,n=new MediaRecorder(p),n.ondataavailable=v=>{v.data.size&&i.push(v.data)},n.start(),e.value=!0,a=setInterval(()=>{s.value++},1e3)}function l(){return new Promise((p,v)=>{if(!n||n.state!=="recording"){v(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(T=>T.stop()),u(),e.value=!1;const f=n?.mimeType||"audio/webm",c=f.includes("ogg")?"ogg":"webm",m=new Blob(i,{type:f}),g=new File([m],`voice.${c}`,{type:f});p(g)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(p=>p.stop())},n.stop()),u(),e.value=!1,s.value=0}function u(){a&&(clearInterval(a),a=null)}function b(p){const v=Math.floor(p/60),f=p%60;return`${v}:${String(f).padStart(2,"0")}`}return{isRecording:e,seconds:s,startRecording:o,stopRecording:l,cancelRecording:r,formatTime:b}}async function En(e){const s=new FormData;s.append("file",e);const{data:n}=await Q.post("/files",s);return n}const Fi={class:"pin-bar-content"},zi={class:"pin-bar-sender"},Bi={class:"pin-bar-text"},Hi=se({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const s=e,n=V(()=>s.message.sender_display_name||s.message.sender_username||"Unknown"),i=V(()=>{const a=s.message;switch(a.message_type){case"sticker":return a.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return a.content||""}});return(a,o)=>(d(),h("div",{class:"pin-bar",onClick:o[1]||(o[1]=l=>a.$emit("click"))},[o[2]||(o[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",Fi,[t("span",zi,x(n.value),1),t("span",Bi,x(i.value),1)]),t("button",{class:"pin-bar-close",onClick:o[0]||(o[0]=ce(l=>a.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}});function In(e){const s=new Date(e),i=new Date().getTime()-s.getTime(),a=Math.floor(i/1e3),o=Math.floor(a/60),l=Math.floor(o/60),r=Math.floor(l/24);if(o<1)return"last seen just now";if(o<60)return`last seen ${o} minute${o!==1?"s":""} ago`;if(l<24)return`last seen ${l} hour${l!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const u=s.toLocaleString("en",{month:"short"}),b=s.getDate();return`last seen ${u} ${b}`}const ji={class:"chat-header"},Vi={class:"chat-header-name"},Wi={key:0,class:"typing-dots"},qi=se({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:s}){const n=s,i=Me(),a=Le(),o=V(()=>i.activeChat),l=V(()=>{const m=o.value;return m?.type==="direct"&&!m.other_user_id}),r=V(()=>{const m=o.value;return m?l.value?"Saved Messages":m.type==="channel"||m.type==="group"?m.title||m.name||"Untitled":m.other_display_name||m.other_username||m.title||m.name||"Chat":"---"}),u=V(()=>{const m=o.value;if(m)return l.value?a.user?.avatar_url:m.type==="direct"?m.other_avatar_url:m.avatar_url}),b=V(()=>o.value?i.getTypingUsernames(o.value.id):[]),p=V(()=>b.value.length>0),v=V(()=>{const m=o.value;return!m||m.type!=="direct"||!m.other_user_id?!1:i.isUserOnline(m.other_user_id)}),f=V(()=>{if(b.value.length===1)return`${b.value[0]} is typing`;if(b.value.length>1)return`${b.value.length} people typing`;const m=o.value;if(!m)return"";if(l.value)return"personal storage";if(m.type==="channel"){const g=m.member_count??0;return`${g} subscriber${g!==1?"s":""}`}if(m.type==="group"){const g=m.member_count??0;return`${g} member${g!==1?"s":""}`}if(v.value)return"online";if(m.type==="direct"&&m.other_user_id){const g=i.getUserPresence(m.other_user_id);if(g){if(g.lastSeenAt)return In(g.lastSeenAt);if(g.lastSeenBucket)return`last seen ${g.lastSeenBucket}`}}return m.other_username?"@"+m.other_username:""});Oe(()=>o.value?.id,()=>{const m=o.value;if(!m||m.type!=="direct"||!m.other_user_id)return;const g=m.other_user_id;i.getUserPresence(g)||bs(g).then(T=>{T.last_activity&&i.setUserPresence(g,{isOnline:i.isUserOnline(g),lastSeenAt:T.last_activity})}).catch(()=>{})},{immediate:!0});function c(){const m=o.value;m&&(m.type==="channel"||m.type==="group"?n("openChannelInfo"):m.type==="direct"&&m.other_username&&n("openUserProfile",m.other_username))}return(m,g)=>(d(),h("header",ji,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:g[0]||(g[0]=T=>n("back"))},"â†"),U(we,{class:"chat-header-avatar",name:r.value,url:u.value,online:v.value,size:"sm",onClick:c},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:c},[t("div",Vi,x(r.value),1),f.value?(d(),h("div",{key:0,class:de(["chat-header-sub",{"typing-text":p.value,"online-text":v.value&&!p.value}])},[ye(x(f.value),1),p.value?(d(),h("span",Wi,[...g[2]||(g[2]=[t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1)])])):P("",!0)],2)):P("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:g[1]||(g[1]=T=>n("openSearch"))},"ğŸ”")]))}}),Gi=fe(qi,[["__scopeId","data-v-16a49ec4"]]),Ki="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Yi="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",gn="numeric",yn="ascii",bn="alpha",lt="asciinumeric",at="alphanumeric",kn="domain",Es="emoji",Ji="scheme",Qi="slashscheme",cn="whitespace";function Xi(e,s){return e in s||(s[e]=[]),s[e]}function Ge(e,s,n){s[gn]&&(s[lt]=!0,s[at]=!0),s[yn]&&(s[lt]=!0,s[bn]=!0),s[lt]&&(s[at]=!0),s[bn]&&(s[at]=!0),s[at]&&(s[kn]=!0),s[Es]&&(s[kn]=!0);for(const i in s){const a=Xi(i,n);a.indexOf(e)<0&&a.push(e)}}function Zi(e,s){const n={};for(const i in s)s[i].indexOf(e)>=0&&(n[i]=!0);return n}function Se(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}Se.groups={};Se.prototype={accepts(){return!!this.t},go(e){const s=this,n=s.j[e];if(n)return n;for(let i=0;i<s.jr.length;i++){const a=s.jr[i][0],o=s.jr[i][1];if(o&&a.test(e))return o}return s.jd},has(e,s=!1){return s?e in this.j:!!this.go(e)},ta(e,s,n,i){for(let a=0;a<e.length;a++)this.tt(e[a],s,n,i)},tr(e,s,n,i){i=i||Se.groups;let a;return s&&s.j?a=s:(a=new Se(s),n&&i&&Ge(s,n,i)),this.jr.push([e,a]),a},ts(e,s,n,i){let a=this;const o=e.length;if(!o)return a;for(let l=0;l<o-1;l++)a=a.tt(e[l]);return a.tt(e[o-1],s,n,i)},tt(e,s,n,i){i=i||Se.groups;const a=this;if(s&&s.j)return a.j[e]=s,s;const o=s;let l,r=a.go(e);if(r?(l=new Se,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new Se,o){if(i)if(l.t&&typeof l.t=="string"){const u=Object.assign(Zi(l.t,i),n);Ge(o,u,i)}else n&&Ge(o,n,i);l.t=o}return a.j[e]=l,l}};const X=(e,s,n,i,a)=>e.ta(s,n,i,a),pe=(e,s,n,i,a)=>e.tr(s,n,i,a),is=(e,s,n,i,a)=>e.ts(s,n,i,a),L=(e,s,n,i,a)=>e.tt(s,n,i,a),Ue="WORD",wn="UWORD",Is="ASCIINUMERICAL",Ls="ALPHANUMERICAL",mt="LOCALHOST",_n="TLD",Cn="UTLD",$t="SCHEME",Je="SLASH_SCHEME",Ln="NUM",$n="WS",An="NL",rt="OPENBRACE",ct="CLOSEBRACE",St="OPENBRACKET",Mt="CLOSEBRACKET",xt="OPENPAREN",Tt="CLOSEPAREN",Et="OPENANGLEBRACKET",It="CLOSEANGLEBRACKET",Lt="FULLWIDTHLEFTPAREN",At="FULLWIDTHRIGHTPAREN",Rt="LEFTCORNERBRACKET",Dt="RIGHTCORNERBRACKET",Ot="LEFTWHITECORNERBRACKET",Pt="RIGHTWHITECORNERBRACKET",Nt="FULLWIDTHLESSTHAN",Ut="FULLWIDTHGREATERTHAN",Ft="AMPERSAND",zt="APOSTROPHE",Bt="ASTERISK",Ve="AT",Ht="BACKSLASH",jt="BACKTICK",Vt="CARET",We="COLON",Rn="COMMA",Wt="DOLLAR",Re="DOT",qt="EQUALS",Dn="EXCLAMATION",Ie="HYPHEN",ut="PERCENT",Gt="PIPE",Kt="PLUS",Yt="POUND",dt="QUERY",On="QUOTE",As="FULLWIDTHMIDDLEDOT",Pn="SEMI",De="SLASH",vt="TILDE",Jt="UNDERSCORE",Rs="EMOJI",Qt="SYM";var Ds=Object.freeze({__proto__:null,ALPHANUMERICAL:Ls,AMPERSAND:Ft,APOSTROPHE:zt,ASCIINUMERICAL:Is,ASTERISK:Bt,AT:Ve,BACKSLASH:Ht,BACKTICK:jt,CARET:Vt,CLOSEANGLEBRACKET:It,CLOSEBRACE:ct,CLOSEBRACKET:Mt,CLOSEPAREN:Tt,COLON:We,COMMA:Rn,DOLLAR:Wt,DOT:Re,EMOJI:Rs,EQUALS:qt,EXCLAMATION:Dn,FULLWIDTHGREATERTHAN:Ut,FULLWIDTHLEFTPAREN:Lt,FULLWIDTHLESSTHAN:Nt,FULLWIDTHMIDDLEDOT:As,FULLWIDTHRIGHTPAREN:At,HYPHEN:Ie,LEFTCORNERBRACKET:Rt,LEFTWHITECORNERBRACKET:Ot,LOCALHOST:mt,NL:An,NUM:Ln,OPENANGLEBRACKET:Et,OPENBRACE:rt,OPENBRACKET:St,OPENPAREN:xt,PERCENT:ut,PIPE:Gt,PLUS:Kt,POUND:Yt,QUERY:dt,QUOTE:On,RIGHTCORNERBRACKET:Dt,RIGHTWHITECORNERBRACKET:Pt,SCHEME:$t,SEMI:Pn,SLASH:De,SLASH_SCHEME:Je,SYM:Qt,TILDE:vt,TLD:_n,UNDERSCORE:Jt,UTLD:Cn,UWORD:wn,WORD:Ue,WS:$n});const Pe=/[a-z]/,st=new RegExp("\\p{L}","u"),un=new RegExp("\\p{Emoji}","u"),Ne=/\d/,dn=/\s/,os="\r",vn=`
`,eo="ï¸",to="â€",mn="ï¿¼";let kt=null,wt=null;function no(e=[]){const s={};Se.groups=s;const n=new Se;kt==null&&(kt=ls(Ki)),wt==null&&(wt=ls(Yi)),L(n,"'",zt),L(n,"{",rt),L(n,"}",ct),L(n,"[",St),L(n,"]",Mt),L(n,"(",xt),L(n,")",Tt),L(n,"<",Et),L(n,">",It),L(n,"ï¼ˆ",Lt),L(n,"ï¼‰",At),L(n,"ã€Œ",Rt),L(n,"ã€",Dt),L(n,"ã€",Ot),L(n,"ã€",Pt),L(n,"ï¼œ",Nt),L(n,"ï¼",Ut),L(n,"&",Ft),L(n,"*",Bt),L(n,"@",Ve),L(n,"`",jt),L(n,"^",Vt),L(n,":",We),L(n,",",Rn),L(n,"$",Wt),L(n,".",Re),L(n,"=",qt),L(n,"!",Dn),L(n,"-",Ie),L(n,"%",ut),L(n,"|",Gt),L(n,"+",Kt),L(n,"#",Yt),L(n,"?",dt),L(n,'"',On),L(n,"/",De),L(n,";",Pn),L(n,"~",vt),L(n,"_",Jt),L(n,"\\",Ht),L(n,"ãƒ»",As);const i=pe(n,Ne,Ln,{[gn]:!0});pe(i,Ne,i);const a=pe(i,Pe,Is,{[lt]:!0}),o=pe(i,st,Ls,{[at]:!0}),l=pe(n,Pe,Ue,{[yn]:!0});pe(l,Ne,a),pe(l,Pe,l),pe(a,Ne,a),pe(a,Pe,a);const r=pe(n,st,wn,{[bn]:!0});pe(r,Pe),pe(r,Ne,o),pe(r,st,r),pe(o,Ne,o),pe(o,Pe),pe(o,st,o);const u=L(n,vn,An,{[cn]:!0}),b=L(n,os,$n,{[cn]:!0}),p=pe(n,dn,$n,{[cn]:!0});L(n,mn,p),L(b,vn,u),L(b,mn,p),pe(b,dn,p),L(p,os),L(p,vn),pe(p,dn,p),L(p,mn,p);const v=pe(n,un,Rs,{[Es]:!0});L(v,"#"),pe(v,un,v),L(v,eo,v);const f=L(v,to);L(f,"#"),pe(f,un,v);const c=[[Pe,l],[Ne,a]],m=[[Pe,null],[st,r],[Ne,o]];for(let g=0;g<kt.length;g++)je(n,kt[g],_n,Ue,c);for(let g=0;g<wt.length;g++)je(n,wt[g],Cn,wn,m);Ge(_n,{tld:!0,ascii:!0},s),Ge(Cn,{utld:!0,alpha:!0},s),je(n,"file",$t,Ue,c),je(n,"mailto",$t,Ue,c),je(n,"http",Je,Ue,c),je(n,"https",Je,Ue,c),je(n,"ftp",Je,Ue,c),je(n,"ftps",Je,Ue,c),Ge($t,{scheme:!0,ascii:!0},s),Ge(Je,{slashscheme:!0,ascii:!0},s),e=e.sort((g,T)=>g[0]>T[0]?1:-1);for(let g=0;g<e.length;g++){const T=e[g][0],_=e[g][1]?{[Ji]:!0}:{[Qi]:!0};T.indexOf("-")>=0?_[kn]=!0:Pe.test(T)?Ne.test(T)?_[lt]=!0:_[yn]=!0:_[gn]=!0,is(n,T,T,_)}return is(n,"localhost",mt,{ascii:!0}),n.jd=new Se(Qt),{start:n,tokens:Object.assign({groups:s},Ds)}}function Os(e,s){const n=so(s.replace(/[A-Z]/g,r=>r.toLowerCase())),i=n.length,a=[];let o=0,l=0;for(;l<i;){let r=e,u=null,b=0,p=null,v=-1,f=-1;for(;l<i&&(u=r.go(n[l]));)r=u,r.accepts()?(v=0,f=0,p=r):v>=0&&(v+=n[l].length,f++),b+=n[l].length,o+=n[l].length,l++;o-=v,l-=f,b-=v,a.push({t:p.t,v:s.slice(o-b,o),s:o-b,e:o})}return a}function so(e){const s=[],n=e.length;let i=0;for(;i<n;){let a=e.charCodeAt(i),o,l=a<55296||a>56319||i+1===n||(o=e.charCodeAt(i+1))<56320||o>57343?e[i]:e.slice(i,i+2);s.push(l),i+=l.length}return s}function je(e,s,n,i,a){let o;const l=s.length;for(let r=0;r<l-1;r++){const u=s[r];e.j[u]?o=e.j[u]:(o=new Se(i),o.jr=a.slice(),e.j[u]=o),e=o}return o=new Se(n),o.jr=a.slice(),e.j[s[l-1]]=o,o}function ls(e){const s=[],n=[];let i=0,a="0123456789";for(;i<e.length;){let o=0;for(;a.indexOf(e[i+o])>=0;)o++;if(o>0){s.push(n.join(""));for(let l=parseInt(e.substring(i,i+o),10);l>0;l--)n.pop();i+=o}else n.push(e[i]),i++}return s}const ft={defaultProtocol:"http",events:null,format:rs,formatHref:rs,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Nn(e,s=null){let n=Object.assign({},ft);e&&(n=Object.assign(n,e instanceof Nn?e.o:e));const i=n.ignoreTags,a=[];for(let o=0;o<i.length;o++)a.push(i[o].toUpperCase());this.o=n,s&&(this.defaultRender=s),this.ignoreTags=a}Nn.prototype={o:ft,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,s,n){const i=s!=null;let a=this.o[e];return a&&(typeof a=="object"?(a=n.t in a?a[n.t]:ft[e],typeof a=="function"&&i&&(a=a(s,n))):typeof a=="function"&&i&&(a=a(s,n.t,n)),a)},getObj(e,s,n){let i=this.o[e];return typeof i=="function"&&s!=null&&(i=i(s,n.t,n)),i},render(e){const s=e.render(this);return(this.get("render",null,e)||this.defaultRender)(s,e.t,e)}};function rs(e){return e}function Ps(e,s){this.t="token",this.v=e,this.tk=s}Ps.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const s=this.toString(),n=e.get("truncate",s,this),i=e.get("format",s,this);return n&&i.length>n?i.substring(0,n)+"â€¦":i},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=ft.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const s=this,n=this.toHref(e.get("defaultProtocol")),i=e.get("formatHref",n,this),a=e.get("tagName",n,s),o=this.toFormattedString(e),l={},r=e.get("className",n,s),u=e.get("target",n,s),b=e.get("rel",n,s),p=e.getObj("attributes",n,s),v=e.getObj("events",n,s);return l.href=i,r&&(l.class=r),u&&(l.target=u),b&&(l.rel=b),p&&Object.assign(l,p),{tagName:a,attributes:l,content:o,eventListeners:v}}};function en(e,s){class n extends Ps{constructor(a,o){super(a,o),this.t=e}}for(const i in s)n.prototype[i]=s[i];return n.t=e,n}const cs=en("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),us=en("text"),ao=en("nl"),_t=en("url",{isLink:!0,toHref(e=ft.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==mt&&e[1].t===We}}),Ee=e=>new Se(e);function io({groups:e}){const s=e.domain.concat([Ft,Bt,Ve,Ht,jt,Vt,Wt,qt,Ie,Ln,ut,Gt,Kt,Yt,De,Qt,vt,Jt]),n=[zt,We,Rn,Re,Dn,ut,dt,On,Pn,Et,It,rt,ct,Mt,St,xt,Tt,Lt,At,Rt,Dt,Ot,Pt,Nt,Ut],i=[Ft,zt,Bt,Ht,jt,Vt,Wt,qt,Ie,rt,ct,ut,Gt,Kt,Yt,dt,De,Qt,vt,Jt],a=Ee(),o=L(a,vt);X(o,i,o),X(o,e.domain,o);const l=Ee(),r=Ee(),u=Ee();X(a,e.domain,l),X(a,e.scheme,r),X(a,e.slashscheme,u),X(l,i,o),X(l,e.domain,l);const b=L(l,Ve);L(o,Ve,b),L(r,Ve,b),L(u,Ve,b);const p=L(o,Re);X(p,i,o),X(p,e.domain,o);const v=Ee();X(b,e.domain,v),X(v,e.domain,v);const f=L(v,Re);X(f,e.domain,v);const c=Ee(cs);X(f,e.tld,c),X(f,e.utld,c),L(b,mt,c);const m=L(v,Ie);L(m,Ie,m),X(m,e.domain,v),X(c,e.domain,v),L(c,Re,f),L(c,Ie,m);const g=L(c,We);X(g,e.numeric,cs);const T=L(l,Ie),C=L(l,Re);L(T,Ie,T),X(T,e.domain,l),X(C,i,o),X(C,e.domain,l);const _=Ee(_t);X(C,e.tld,_),X(C,e.utld,_),X(_,e.domain,l),X(_,i,o),L(_,Re,C),L(_,Ie,T),L(_,Ve,b);const D=L(_,We),F=Ee(_t);X(D,e.numeric,F);const z=Ee(_t),N=Ee();X(z,s,z),X(z,n,N),X(N,s,z),X(N,n,N),L(_,De,z),L(F,De,z);const ne=L(r,We),re=L(u,We),E=L(re,De),M=L(E,De);X(r,e.domain,l),L(r,Re,C),L(r,Ie,T),X(u,e.domain,l),L(u,Re,C),L(u,Ie,T),X(ne,e.domain,z),L(ne,De,z),L(ne,dt,z),X(M,e.domain,z),X(M,s,z),L(M,De,z);const B=[[rt,ct],[St,Mt],[xt,Tt],[Et,It],[Lt,At],[Rt,Dt],[Ot,Pt],[Nt,Ut]];for(let J=0;J<B.length;J++){const[W,I]=B[J],j=L(z,W);L(N,W,j),L(j,I,z);const oe=Ee(_t);X(j,s,oe);const be=Ee();X(j,n),X(oe,s,oe),X(oe,n,be),X(be,s,oe),X(be,n,be),L(oe,I,z),L(be,I,z)}return L(a,mt,_),L(a,An,ao),{start:a,tokens:Ds}}function oo(e,s,n){let i=n.length,a=0,o=[],l=[];for(;a<i;){let r=e,u=null,b=null,p=0,v=null,f=-1;for(;a<i&&!(u=r.go(n[a].t));)l.push(n[a++]);for(;a<i&&(b=u||r.go(n[a].t));)u=null,r=b,r.accepts()?(f=0,v=r):f>=0&&f++,a++,p++;if(f<0)a-=p,a<i&&(l.push(n[a]),a++);else{l.length>0&&(o.push(fn(us,s,l)),l=[]),a-=f,p-=f;const c=v.t,m=n.slice(a-p,a);o.push(fn(c,s,m))}}return l.length>0&&o.push(fn(us,s,l)),o}function fn(e,s,n){const i=n[0].s,a=n[n.length-1].e,o=s.slice(i,a);return new e(o,n)}const ke={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function lo(){ke.scanner=no(ke.customSchemes);for(let e=0;e<ke.tokenQueue.length;e++)ke.tokenQueue[e][1]({scanner:ke.scanner});ke.parser=io(ke.scanner.tokens);for(let e=0;e<ke.pluginQueue.length;e++)ke.pluginQueue[e][1]({scanner:ke.scanner,parser:ke.parser});return ke.initialized=!0,ke}function Ns(e){return ke.initialized||lo(),oo(ke.parser.start,e,Os(ke.scanner.start,e))}Ns.scan=Os;function Us(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function ro(e){return e.replace(/"/g,"&quot;")}function co(e){const s=[];for(const n in e){let i=e[n]+"";s.push(`${n}="${ro(i)}"`)}return s.join(" ")}function uo({tagName:e,attributes:s,content:n}){return`<${e} ${co(s)}>${Us(n)}</${e}>`}function Fs(e,s={}){s=new Nn(s,uo);const n=Ns(e),i=[];for(let a=0;a<n.length;a++){const o=n[a];o.t==="nl"&&s.get("nl2br")?i.push(`<br>
`):!o.isLink||!s.check(o)?i.push(Us(o.toString())):i.push(s.render(o))}return i.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(s){return Fs(this,s)}});const vo={},mo={class:"admin-badge",title:"Admin"};function fo(e,s){return d(),h("span",mo,"âœ“")}const Un=fe(vo,[["render",fo]]);function po(e){const{delay:s=500,scrollThreshold:n=5,onLongPress:i,onCancel:a}=e,o=y(!1);let l=null,r=0,u=0,b=!1;function p(){l&&(clearTimeout(l),l=null)}function v(g){r=g.clientX,u=g.clientY,b=!1,o.value=!0,p(),l=setTimeout(()=>{b=!0,i(g)},s)}function f(g){if(!l)return;const T=g.clientX-r,C=g.clientY-u;(Math.abs(T)>n||Math.abs(C)>n)&&m()}function c(){p(),o.value=!1}function m(){p(),o.value=!1,b||a?.()}return{isPressed:o,onPointerDown:v,onPointerUp:c,onPointerMove:f}}const ho=["data-message-id"],go={key:0,class:"selection-checkbox"},yo=["checked"],bo={key:1,class:"msg-sender-name"},ko={class:"msg-content-wrap"},wo={key:0,class:"msg-bubble sticker-bubble"},_o=["src","alt"],Co={class:"msg-time"},$o={key:0,class:"msg-edited-label"},So={key:1,class:"msg-bubble"},Mo={key:0,class:"msg-forwarded-label"},xo={class:"msg-reply-quote-name"},To={class:"msg-reply-quote-text"},Eo={class:"voice-player"},Io={class:"voice-dur"},Lo={class:"msg-time"},Ao={key:0,class:"msg-edited-label"},Ro={key:2,class:"msg-bubble"},Do={key:0,class:"msg-forwarded-label"},Oo={class:"msg-reply-quote-name"},Po={class:"msg-reply-quote-text"},No=["innerHTML"],Uo={class:"msg-time"},Fo={key:0,class:"msg-edited-label"},zo={key:3,class:"reaction-chips"},Bo=["onClick"],Ho={class:"reaction-emoji"},jo={class:"reaction-count"},Vo=se({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:s}){const n=e,i=s,a=Ke(),o=Me(),l=ht(),r=V(()=>a.isSelected(n.message.id)),u=V(()=>l.deletingMessages.has(n.message.id)),b=Qe("lastSentMessageId",y(null)),p=V(()=>n.isMine&&n.message.id===b.value),{onPointerDown:v,onPointerUp:f,onPointerMove:c}=po({delay:500,onLongPress($){T($.clientX,$.clientY)}}),m={onPointerdown:v,onPointerup:f,onPointermove:c};function g($){if(a.selectionMode){a.toggleMessage(n.message.id);return}T($.clientX,$.clientY)}function T($,G){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:o.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:$,y:G}}))}function C(){a.selectionMode&&a.toggleMessage(n.message.id)}const _=Le(),D=pt(),F=V(()=>{if(!D.readReceiptsEnabled)return null;const $=o.activeChat;if(!$)return null;const G=$.id;if($.type==="direct"&&$.other_user_id===_.user?.id)return{text:"âœ“âœ“",cls:"read"};if($.type==="direct")return l.isMessageRead(G,n.message.id,$.other_user_id)?{text:"âœ“âœ“",cls:"read"}:{text:"âœ“",cls:"sent"};const Z=l.getReadCount(G,n.message.id);return Z>0?{text:`âœ“âœ“ ${Z}`,cls:"read"}:{text:"âœ“",cls:"sent"}}),z=V(()=>{if(!n.message.forwarded_from_chat_id)return null;const $=n.message.forwarded_from_user_id;if($&&$===_.user?.id)return null;const G=n.message.forwarded_from_display_name;return G?`Forwarded from ${G}`:"Forwarded"}),N=Qe("stickers",y([])),ne=V(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const $=N.value.find(G=>G.id===n.message.sticker_id);if($)return $.url}return""}),re=V(()=>n.message.attachment_url||""),E=y(!1),M=y(0),B=y(0),J=y(n.message.duration_seconds||0);let W=null,I=null;function j(){return W||(W=new Audio(re.value),W.addEventListener("loadedmetadata",()=>{W&&isFinite(W.duration)&&(J.value=W.duration)}),W.addEventListener("ended",()=>{E.value=!1,M.value=0,B.value=0,be()})),W}function oe(){if(W&&E.value){B.value=W.currentTime;const $=W.duration;M.value=$&&isFinite($)?W.currentTime/$*100:0,I=requestAnimationFrame(oe)}}function be(){I!==null&&(cancelAnimationFrame(I),I=null)}function S(){const $=j();E.value?($.pause(),E.value=!1,be()):($.play(),E.value=!0,I=requestAnimationFrame(oe))}function A($){const G=j(),le=$.currentTarget.getBoundingClientRect(),Ce=Math.max(0,Math.min(1,($.clientX-le.left)/le.width)),Te=G.duration;Te&&isFinite(Te)&&(G.currentTime=Ce*Te,B.value=G.currentTime,M.value=Ce*100)}const q=V(()=>{const $=J.value;return E.value||B.value>0?ve(Math.floor(B.value))+" / "+ve(Math.floor($)):ve(Math.floor($))});Oe(re,()=>{W&&(W.pause(),E.value=!1,be(),W=null,M.value=0,B.value=0)}),qe(()=>{W&&(W.pause(),W=null),be()});const H=V(()=>{const $=n.message.reply_to_type;if($==="sticker")return"ğŸ¨ Sticker";if($==="voice")return"ğŸ¤ Voice message";if($==="file")return"ğŸ“ File";const G=n.message.reply_to_content||"";return G.length>80?G.slice(0,80)+"...":G}),ee=V(()=>Fs(n.message.content||"",{defaultProtocol:"https",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(G,Z,le)=>Z||`<span class="mention" data-u="${le}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${le}'}))">@${le}</span>`));function ue($){if(!$)return"";const G=new Date($.endsWith("Z")?$:$+"Z"),Z=new Date;return G.toDateString()===Z.toDateString()?G.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):G.toLocaleDateString([],{month:"short",day:"numeric"})}function ve($){const G=Math.floor($/60),Z=$%60;return`${G}:${String(Z).padStart(2,"0")}`}function K($){const G=$.target.getBoundingClientRect();i("openEmojiPicker",n.message.id,G.left,G.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",($=>{i("mentionClick",$.detail)})),($,G)=>(d(),h("div",ca({class:["msg-row",[e.isMine?"mine":"theirs",{selected:r.value,"msg-deleting":u.value,"msg-new":p.value}]],"data-message-id":e.message.id,onContextmenu:ce(g,["prevent"])},m,{onClick:C}),[k(a).selectionMode?(d(),h("div",go,[t("input",{type:"checkbox",checked:r.value,tabindex:"-1"},null,8,yo)])):P("",!0),!e.isMine&&e.message.message_type!=="sticker"?(d(),h("div",bo,[ye(x(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(d(),Y(Un,{key:0})):P("",!0)])):P("",!0),t("div",ko,[e.message.message_type==="sticker"?(d(),h("div",wo,[t("img",{class:"sticker-img",src:ne.value,alt:e.message.sticker_label||"sticker"},null,8,_o),t("div",Co,[e.message.is_edited?(d(),h("span",$o,"(edited)")):P("",!0),ye(" "+x(ue(e.message.created_at)),1),e.isMine&&F.value?(d(),h("span",{key:1,class:de(["msg-read-check",F.value.cls])},x(F.value.text),3)):P("",!0)])])):e.message.message_type==="voice"?(d(),h("div",So,[z.value?(d(),h("div",Mo,x(z.value),1)):P("",!0),e.message.reply_to_message_id?(d(),h("div",{key:1,class:"msg-reply-quote",onClick:G[0]||(G[0]=ce(Z=>i("replyClick",e.message.reply_to_message_id),["stop"]))},[G[2]||(G[2]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",xo,x(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",To,x(H.value),1)])])):P("",!0),t("div",Eo,[t("button",{class:"voice-play-btn",onClick:ce(S,["stop"])},x(E.value?"â¸":"â–¶"),1),t("div",{class:"voice-track",onClick:ce(A,["stop"])},[t("div",{class:"voice-progress",style:Ze({width:M.value+"%"})},null,4)]),t("span",Io,x(q.value),1)]),t("div",Lo,[e.message.is_edited?(d(),h("span",Ao,"(edited)")):P("",!0),ye(" "+x(ue(e.message.created_at)),1),e.isMine&&F.value?(d(),h("span",{key:1,class:de(["msg-read-check",F.value.cls])},x(F.value.text),3)):P("",!0)])])):(d(),h("div",Ro,[z.value?(d(),h("div",Do,x(z.value),1)):P("",!0),e.message.reply_to_message_id?(d(),h("div",{key:1,class:"msg-reply-quote",onClick:G[1]||(G[1]=ce(Z=>i("replyClick",e.message.reply_to_message_id),["stop"]))},[G[3]||(G[3]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",Oo,x(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",Po,x(H.value),1)])])):P("",!0),t("span",{class:"msg-text",innerHTML:ee.value},null,8,No),t("div",Uo,[e.message.is_edited?(d(),h("span",Fo,"(edited)")):P("",!0),ye(" "+x(ue(e.message.created_at)),1),e.isMine&&F.value?(d(),h("span",{key:1,class:de(["msg-read-check",F.value.cls])},x(F.value.text),3)):P("",!0)])])),t("button",{class:"reaction-add-btn",onClick:ce(K,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(d(),h("div",zo,[(d(!0),h(ie,null,he(e.message.reactions,Z=>(d(),h("button",{key:Z.emoji,class:de(["reaction-chip",{"reaction-mine":Z.me}]),onClick:ce(le=>i("toggleReaction",e.message.id,Z.emoji),["stop"])},[t("span",Ho,x(Z.emoji),1),t("span",jo,x(Z.count),1)],10,Bo))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:ce(K,["stop"])},"+")])):P("",!0)])],16,ho))}}),Wo={class:"composer-wrapper"},qo={key:0,class:"reply-preview"},Go={class:"reply-preview-content"},Ko={class:"reply-preview-sender"},Yo={class:"reply-preview-text"},Jo={key:1,class:"reply-preview edit-preview"},Qo={class:"reply-preview-content"},Xo={class:"reply-preview-text"},Zo={class:"composer"},el=["onKeydown"],tl=se({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(e,{expose:s,emit:n}){const i=e,a=n,o=y(""),l=y(null),r=y(null),u=y(null);let b=0;function p(){const _=o.value.trim();_&&(u.value?(a("editMessage",u.value.messageId,_),u.value=null):r.value?(a("send",_,{...r.value}),r.value=null):a("send",_),o.value="",C())}function v(){r.value=null,l.value?.focus()}function f(){u.value=null,o.value="",C(),l.value?.focus()}function c(){r.value?v():u.value&&f()}function m(_){const D=_.detail;D&&(u.value=null,r.value={messageId:D.messageId,senderName:D.senderName||"Unknown",snippet:(D.text||"").slice(0,100)},$e(()=>l.value?.focus()))}function g(_){const D=_.detail;D&&(r.value=null,u.value={messageId:D.messageId,snippet:(D.text||"").slice(0,100),fullText:D.text||""},o.value=u.value.fullText,$e(()=>{C(),l.value?.focus()}))}function T(){C();const _=Date.now();_-b>2e3&&o.value.trim().length>0&&(b=_,a("typing"))}function C(){const _=l.value;_&&(_.style.height="auto",_.style.height=Math.min(_.scrollHeight,120)+"px")}return _e(()=>{l.value?.focus(),window.addEventListener("reply-to-message",m),window.addEventListener("edit-message",g)}),qe(()=>{window.removeEventListener("reply-to-message",m),window.removeEventListener("edit-message",g)}),Oe(()=>i.replyTo,_=>{_&&l.value?.focus()}),s({focus:()=>l.value?.focus()}),(_,D)=>(d(),h("div",Wo,[r.value?(d(),h("div",qo,[D[3]||(D[3]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",Go,[t("span",Ko,x(r.value.senderName),1),t("span",Yo,x(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:v},"âœ•")])):P("",!0),u.value?(d(),h("div",Jo,[D[5]||(D[5]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",Qo,[D[4]||(D[4]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",Xo,x(u.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:f},"âœ•")])):P("",!0),t("div",Zo,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:D[0]||(D[0]=F=>a("toggleStickers"))},"ğŸŒ"),me(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":D[1]||(D[1]=F=>o.value=F),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[hn(ce(p,["exact","prevent"]),["enter"]),hn(c,["escape"])],onInput:T},null,40,el),[[ge,o.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:D[2]||(D[2]=F=>a("startRecording"))},"ğŸ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:p},"â¤")])]))}}),nl=fe(tl,[["__scopeId","data-v-df4ad9ba"]]),sl={class:"sticker-grid"},al=["title","onClick"],il=["src","alt"],ol={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},ll=se({__name:"StickerPicker",emits:["select"],setup(e,{emit:s}){const n=s,i=Qe("stickers",y([])),a=V(()=>i.value);return(o,l)=>(d(),h("div",sl,[(d(!0),h(ie,null,he(a.value,r=>(d(),h("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:u=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,il)],8,al))),128)),a.value.length===0?(d(),h("div",ol," No stickers available ")):P("",!0)]))}}),rl={},cl={class:"msgs-loading"};function ul(e,s){return d(),h("div",cl,"Loading...")}const ds=fe(rl,[["render",ul]]),dl=["onClick"],vl=se({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:s}){const n=s,i=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(a,o)=>e.visible?(d(),h("div",{key:0,class:"emoji-picker",style:Ze({left:e.x+"px",top:e.y+"px"}),onClick:o[0]||(o[0]=ce(()=>{},["stop"]))},[(d(),h(ie,null,he(i,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},x(l),9,dl)),64))],4)):P("",!0)}}),ml=se({__name:"MessageContextMenu",setup(e){const{showToast:s}=xe(),n=Le(),i=ht(),a=Ke(),o=y(!1),l=y(0),r=y(0),u=y(null),b=y(null),p=y(""),v=y(""),f=y(""),c=y(null),m=y(!1),g=V(()=>!c.value||!n.user?!1:c.value===n.user.id),T=V(()=>!b.value||!u.value?null:`${window.location.origin}/c/${b.value}/${u.value}`),C=V(()=>!b.value||!u.value?!1:i.pinnedByChat[b.value]?.message?.id===u.value);function _(I){m.value=!!I.detail.areaOnly,u.value=I.detail.messageId??null,b.value=I.detail.chatId,p.value=I.detail.text||"",v.value=I.detail.messageType||"text",f.value=I.detail.senderName||"",c.value=I.detail.senderId??null,l.value=I.detail.x,r.value=I.detail.y,o.value=!0,requestAnimationFrame(()=>{const j=document.querySelector(".msg-context-menu");if(!j)return;const oe=j.getBoundingClientRect();oe.right>window.innerWidth&&(l.value=window.innerWidth-oe.width-8),oe.bottom>window.innerHeight&&(r.value=window.innerHeight-oe.height-8)})}function D(){o.value&&(o.value=!1,u.value=null,b.value=null,p.value="",v.value="",f.value="",c.value=null,m.value=!1)}_e(()=>{window.addEventListener("show-message-context-menu",_),document.addEventListener("click",D)}),qe(()=>{window.removeEventListener("show-message-context-menu",_),document.removeEventListener("click",D)});function F(){o.value=!1}function z(){F(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:u.value,chatId:b.value,senderName:f.value,text:p.value}}))}function N(){F(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:u.value,chatId:b.value,text:p.value}}))}async function ne(){F();try{await navigator.clipboard.writeText(p.value),s("Copied to clipboard")}catch{s("Failed to copy text")}}async function re(){if(F(),!!T.value)try{await navigator.clipboard.writeText(T.value),s("Link copied")}catch{s("Failed to copy link")}}function E(){F(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[u.value],chatId:b.value}}))}function M(){F(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:u.value,chatId:b.value}}))}function B(){if(F(),!u.value||!b.value)return;const I=C.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(I,{detail:{messageId:u.value,chatId:b.value}}))}function J(){F(),b.value&&a.enterSelectionMode(b.value)}function W(){F(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:u.value,chatId:b.value}}))}return(I,j)=>(d(),Y(fs,{to:"body"},[o.value?(d(),h("div",{key:0,class:"msg-context-menu",style:Ze({left:l.value+"px",top:r.value+"px"}),onClick:j[0]||(j[0]=ce(()=>{},["stop"])),onContextmenu:j[1]||(j[1]=ce(()=>{},["prevent"]))},[m.value?(d(),h("button",{key:0,class:"ctx-item",onClick:J},"Select Messages")):(d(),h(ie,{key:1},[t("button",{class:"ctx-item",onClick:z}," Reply "),g.value&&v.value==="text"?(d(),h("button",{key:0,class:"ctx-item",onClick:N}," Edit ")):P("",!0),t("button",{class:"ctx-item",onClick:B},x(C.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:ne}," Copy text "),T.value?(d(),h("button",{key:1,class:"ctx-item",onClick:re}," Copy link ")):P("",!0),t("button",{class:"ctx-item",onClick:E}," Forward "),t("button",{class:"ctx-item",onClick:M}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:W}," Delete ")],64))],36)):P("",!0)]))}}),fl=fe(ml,[["__scopeId","data-v-e4c122b4"]]),pl={key:0,class:"selection-bar"},hl={class:"selection-bar-count"},gl={class:"selection-bar-actions"},yl=["disabled"],bl=["disabled"],kl=se({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:s}){const n=s,i=Ke();return(a,o)=>(d(),Y(Sn,{name:"slide-down"},{default:Xt(()=>[k(i).selectionMode?(d(),h("div",pl,[t("button",{class:"selection-bar-btn cancel-btn",onClick:o[0]||(o[0]=l=>k(i).exitSelectionMode())}," Cancel "),t("span",hl,x(k(i).selectedCount)+" selected",1),t("div",gl,[t("button",{class:"selection-bar-btn forward-btn",disabled:k(i).selectedCount===0,onClick:o[1]||(o[1]=l=>n("forward"))}," Forward ("+x(k(i).selectedCount)+") ",9,yl),t("button",{class:"selection-bar-btn delete-btn",disabled:k(i).selectedCount===0,onClick:o[2]||(o[2]=l=>n("delete"))}," Delete ("+x(k(i).selectedCount)+") ",9,bl)])])):P("",!0)]),_:1}))}}),wl=fe(kl,[["__scopeId","data-v-9ba988f2"]]),_l=se({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const n=s;function i(){n("close")}return(a,o)=>(d(),Y(fs,{to:"body"},[U(Sn,{name:"bottom-sheet"},{default:Xt(()=>[e.visible?(d(),h("div",{key:0,class:"bottom-sheet-backdrop",onClick:ce(i,["self"])},[t("div",{class:"bottom-sheet",onClick:o[0]||(o[0]=ce(()=>{},["stop"]))},[o[1]||(o[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),ps(a.$slots,"default",{},void 0,!0)])])):P("",!0)]),_:3})]))}}),Cl=fe(_l,[["__scopeId","data-v-9712ffdf"]]),$l={class:"modal"},Sl={class:"modal-header"},Ml={class:"modal-body"},xl={class:"forward-chat-list"},Tl={key:0,class:"empty-state-small"},El=["onClick"],Il={class:"forward-chat-info"},Ll={class:"forward-chat-name"},Al={class:"forward-chat-type"},Rl={key:0,class:"forward-check"},Dl={class:"modal-actions"},Ol=["disabled"],Pl=se({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:s}){const n=e,i=s,a=Me(),o=ht(),{showToast:l}=xe(),r=y(""),u=y(null),b=y(!1),p=V(()=>{const g=r.value.toLowerCase().trim(),T=a.sortedChats;return g?T.filter(C=>v(C).toLowerCase().includes(g)):T});function v(g){return g.type==="direct"?g.other_user_id?g.other_display_name||g.other_username||g.title||"Direct Chat":"Saved Messages":g.title||g.name||"Unnamed Chat"}function f(g){if(g.type==="direct")return g.other_avatar_url??void 0}function c(){}async function m(){if(u.value!==null){b.value=!0;try{await o.forwardMessages(u.value,n.fromChatId,n.messageIds),l("Message forwarded!"),i("forwarded",u.value)}catch{l("Failed to forward message")}finally{b.value=!1}}}return(g,T)=>(d(),h("div",{class:"modal-backdrop",onClick:T[2]||(T[2]=ce(C=>i("close"),["self"]))},[t("div",$l,[t("div",Sl,[T[3]||(T[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:T[0]||(T[0]=C=>i("close"))},"âœ•")]),t("div",Ml,[me(t("input",{"onUpdate:modelValue":T[1]||(T[1]=C=>r.value=C),class:"search-input",type:"search",placeholder:"Search chats...",onInput:c},null,544),[[ge,r.value]]),t("div",xl,[p.value.length===0?(d(),h("div",Tl,"No chats found.")):P("",!0),(d(!0),h(ie,null,he(p.value,C=>(d(),h("div",{key:C.id,class:de(["forward-chat-item",{selected:u.value===C.id}]),onClick:_=>u.value=C.id},[U(we,{name:v(C),url:f(C),size:"sm"},null,8,["name","url"]),t("div",Il,[t("div",Ll,x(v(C)),1),t("div",Al,x(C.type),1)]),u.value===C.id?(d(),h("span",Rl,"âœ“")):P("",!0)],10,El))),128))]),t("div",Dl,[t("button",{class:"btn btn-primary",disabled:u.value===null||b.value,onClick:m},x(b.value?"Forwarding...":"Forward"),9,Ol)])])])]))}}),Nl=fe(Pl,[["__scopeId","data-v-4e477e89"]]),Ul={class:"modal modal-sm"},Fl={class:"modal-header"},zl={class:"modal-body"},Bl={class:"delete-confirm-text"},Hl={key:0,class:"delete-checkbox-label"},jl={class:"modal-actions"},Vl=se({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:s}){const n=s,i=y(!1);function a(){n("confirm",i.value)}return(o,l)=>(d(),h("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=ce(r=>n("close"),["self"]))},[t("div",Ul,[t("div",Fl,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",zl,[t("p",Bl," Are you sure you want to delete "+x(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(d(),h("label",Hl,[me(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>i.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[ua,i.value]]),l[5]||(l[5]=ye(" Delete for everyone ",-1))])):P("",!0)]),t("div",jl,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:a},"Delete")])])]))}}),Wl=fe(Vl,[["__scopeId","data-v-388dbae2"]]),gt=Xe("channel",()=>{const e=y(null),s=y([]),n=y(!1),i=V(()=>s.value.length),a=V(()=>s.value.filter(v=>v.role==="admin"||v.role==="owner").length),o=V(()=>{const v=Le();return v.user?s.value.find(c=>c.id===v.user.id)?.role??null:null}),l=V(()=>o.value==="owner"),r=V(()=>o.value==="admin"||o.value==="owner");async function u(v){n.value=!0;try{e.value=await gs(v)}catch(f){console.error("Failed to load channel detail",f)}finally{n.value=!1}}async function b(v){try{s.value=await La(v)}catch(f){console.error("Failed to load channel members",f)}}async function p(v,f){try{e.value=await Aa(v,f)}catch(c){throw console.error("Failed to update channel",c),c}}return{detail:e,members:s,loading:n,memberCount:i,adminCount:a,myRole:o,isOwner:l,isAdmin:r,loadDetail:u,loadMembers:b,updateChannel:p}}),ql=Xe("invites",()=>{const e=y([]),s=y(!1);async function n(o){s.value=!0;try{e.value=await fa(o)}catch(l){console.error("Failed to load invites",l)}finally{s.value=!1}}async function i(o){try{const l=await pa(o);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function a(o){const l=[...e.value];e.value=e.value.filter(r=>r.token!==o);try{await ha(o)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:s,loadInvites:n,createInvite:i,revokeInvite:a}}),Gl={class:"invite-links-view"},Kl={class:"view-header"},Yl={style:{padding:"0 1rem .5rem"}},Jl=["disabled"],Ql={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},Xl={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},Zl={key:2,class:"invite-list",style:{padding:"0 1rem"}},er={class:"invite-item-info"},tr={class:"invite-token"},nr={class:"invite-date"},sr={class:"invite-item-actions"},ar=["onClick"],ir=["onClick"],or=se({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,i=s,a=ql(),{showToast:o}=xe(),l=y(!1);function r(v){return new Date(v).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function u(v){const f=`${window.location.origin}/join/${v}`;navigator.clipboard&&navigator.clipboard.writeText(f).then(()=>o("Link copied!"))}async function b(){l.value=!0;try{await a.createInvite(n.chatId),o("Invite link created")}catch{o("Failed to create invite")}finally{l.value=!1}}async function p(v){try{await a.revokeInvite(v),o("Invite revoked")}catch{o("Failed to revoke invite")}}return _e(()=>a.loadInvites(n.chatId)),(v,f)=>(d(),h("div",Gl,[t("div",Kl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:f[0]||(f[0]=c=>i("back"))},[U(k(Fe),{size:20,"stroke-width":2})]),f[1]||(f[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",Yl,[t("button",{class:"btn btn-sm btn-outline",onClick:b,disabled:l.value},x(l.value?"Creating...":"Create Invite Link"),9,Jl)]),k(a).loading?(d(),h("div",Ql," Loading... ")):k(a).invites.length===0?(d(),h("div",Xl," No active invite links ")):(d(),h("div",Zl,[(d(!0),h(ie,null,he(k(a).invites,c=>(d(),h("div",{key:c.id,class:"invite-item"},[t("div",er,[t("code",tr,x(c.token),1),t("span",nr,x(r(c.created_at)),1)]),t("div",sr,[t("button",{class:"icon-btn",title:"Copy link",onClick:m=>u(c.token)},[U(k($s),{size:16,"stroke-width":2})],8,ar),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:m=>p(c.token)}," Revoke ",8,ir)])]))),128))]))]))}}),lr=fe(or,[["__scopeId","data-v-97b82dd0"]]);async function rr(e,s){await Q.post(`/chats/${e}/avatar`,{file_id:s})}async function cr(e,s){return(await Q.post(`/chats/${e}/members/${s}/promote`)).data}async function ur(e,s){return(await Q.post(`/chats/${e}/members/${s}/demote`)).data}const dr={class:"admins-view"},vr={class:"view-header"},mr={class:"search-bar"},fr={key:0,class:"member-empty"},pr={key:1,class:"member-list"},hr=["onClick"],gr={class:"member-info"},yr={class:"member-name"},br={class:"role-badge"},kr={class:"view-footer"},wr={key:0,class:"member-empty"},_r={key:1,class:"member-list"},Cr={class:"member-info"},$r={class:"member-name"},Sr=["onClick"],Mr={key:2,class:"view-footer"},xr=se({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,i=s,a=gt(),o=y(!1),l=y(""),r=V(()=>a.members.filter(f=>f.role==="admin"||f.role==="owner")),u=V(()=>a.members.filter(f=>f.role==="member")),b=V(()=>{const f=l.value.toLowerCase().trim();return f?u.value.filter(c=>c.username.toLowerCase().includes(f)||c.display_name&&c.display_name.toLowerCase().includes(f)):u.value});async function p(f){try{await cr(n.chatId,f);const c=a.members.find(m=>m.id===f);c&&(c.role="admin"),o.value=!1,l.value=""}catch{}}async function v(f){try{await ur(n.chatId,f);const c=a.members.find(m=>m.id===f);c&&(c.role="member")}catch{}}return(f,c)=>(d(),h("div",dr,[t("div",vr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=m=>i("back"))},[U(k(Fe),{size:20,"stroke-width":2})]),c[4]||(c[4]=t("span",{class:"view-title"},"Administrators",-1))]),o.value?(d(),h(ie,{key:0},[t("div",mr,[me(t("input",{"onUpdate:modelValue":c[1]||(c[1]=m=>l.value=m),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ge,l.value]])]),b.value.length===0?(d(),h("div",fr,x(l.value?"No members found":"No members to promote"),1)):(d(),h("div",pr,[(d(!0),h(ie,null,he(b.value,m=>(d(),h("div",{key:m.id,class:"member-item member-item--selectable",onClick:g=>p(m.id)},[U(we,{name:m.display_name||m.username,url:m.avatar_url,size:"md"},null,8,["name","url"]),t("div",gr,[t("span",yr,x(m.display_name||m.username),1),t("span",br,x(m.role),1)])],8,hr))),128))])),t("div",kr,[t("button",{class:"btn btn--secondary",onClick:c[2]||(c[2]=m=>o.value=!1)},"Cancel")])],64)):(d(),h(ie,{key:1},[r.value.length===0?(d(),h("div",wr," No administrators found ")):(d(),h("div",_r,[(d(!0),h(ie,null,he(r.value,m=>(d(),h("div",{key:m.id,class:"member-item"},[U(we,{name:m.display_name||m.username,url:m.avatar_url,size:"md"},null,8,["name","url"]),t("div",Cr,[t("span",$r,x(m.display_name||m.username),1),t("span",{class:de(["role-badge",`role-badge--${m.role}`])},x(m.role),3)]),k(a).isOwner&&m.role==="admin"?(d(),h("button",{key:0,class:"btn btn--small btn--danger",onClick:g=>v(m.id)}," Demote ",8,Sr)):P("",!0)]))),128))])),k(a).isOwner?(d(),h("div",Mr,[t("button",{class:"btn btn--primary",onClick:c[3]||(c[3]=m=>o.value=!0)},"Add Admin")])):P("",!0)],64))]))}}),Tr=fe(xr,[["__scopeId","data-v-2bd7c861"]]),Er={class:"subscribers-view"},Ir={class:"view-header"},Lr={class:"search-bar"},Ar={key:0,class:"member-empty"},Rr={key:1,class:"member-list"},Dr={class:"member-info"},Or={class:"member-name"},Pr=se({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=s,i=gt(),a=y(""),o=V(()=>{const l=a.value.toLowerCase().trim();return l?i.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):i.members});return(l,r)=>(d(),h("div",Er,[t("div",Ir,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=u=>n("back"))},[U(k(Fe),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",Lr,[me(t("input",{"onUpdate:modelValue":r[1]||(r[1]=u=>a.value=u),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ge,a.value]])]),o.value.length===0?(d(),h("div",Ar,x(a.value?"No members found":"No subscribers"),1)):(d(),h("div",Rr,[(d(!0),h(ie,null,he(o.value,u=>(d(),h("div",{key:u.id,class:"member-item"},[U(we,{name:u.display_name||u.username,url:u.avatar_url,size:"md"},null,8,["name","url"]),t("div",Dr,[t("span",Or,x(u.display_name||u.username),1),t("span",{class:de(["role-badge",`role-badge--${u.role}`])},x(u.role),3)])]))),128))]))]))}}),Nr=fe(Pr,[["__scopeId","data-v-f99a8a5f"]]),Ur={class:"modal profile-modal"},Fr={class:"profile-modal-body profile-modal-body--scrollable"},zr={class:"profile-avatar-section profile-avatar-upload-section"},Br={class:"profile-avatar-overlay"},Hr={class:"profile-info-list"},jr={class:"form-group"},Vr={class:"form-label"},Wr=["placeholder"],qr={class:"form-group"},Gr=["placeholder"],Kr={key:0,class:"form-group"},Yr={class:"form-label"},Jr={class:"type-selector"},Qr={class:"type-option"},Xr={class:"type-option"},Zr={class:"profile-edit-actions"},ec=["disabled"],tc=se({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:s}){const n=e,i=s,a=gt(),{showToast:o}=xe(),l=y(""),r=y(""),u=y(void 0),b=y("public"),p=y(!1),v=y(null),f=V(()=>a.detail?.type==="group"),c=V(()=>f.value?"Group":"Channel");_e(()=>{a.detail&&(l.value=a.detail.title||"",r.value=a.detail.description||"",u.value=a.detail.avatar_url??void 0,b.value=a.detail.public_name?"public":"private")});async function m(){const T=v.value?.files?.[0];if(T){try{const C=await En(T);await rr(n.chatId,C.id),u.value=URL.createObjectURL(T),o("Avatar updated!")}catch{o("Avatar upload failed")}v.value&&(v.value.value="")}}async function g(){if(!l.value.trim()){o(`${c.value} name is required`);return}p.value=!0;try{await a.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),o(`${c.value} updated!`),i("saved"),i("close")}catch{o(`Failed to update ${c.value.toLowerCase()}`)}finally{p.value=!1}}return(T,C)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:C[7]||(C[7]=ce(_=>i("close"),["self"]))},[t("div",Ur,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:C[0]||(C[0]=_=>i("close"))},[U(k(Be),{size:20,"stroke-width":2})]),t("div",Fr,[t("div",zr,[t("div",{class:"profile-avatar-upload-wrap",onClick:C[1]||(C[1]=_=>v.value?.click())},[U(we,{name:l.value||c.value,url:u.value,size:"xxl"},null,8,["name","url"]),t("div",Br,[U(k(_s),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:v,type:"file",accept:"image/*",class:"hidden",onChange:m},null,544)]),t("div",Hr,[t("div",jr,[t("label",Vr,x(c.value)+" name",1),me(t("input",{"onUpdate:modelValue":C[2]||(C[2]=_=>l.value=_),class:"form-input",type:"text",maxlength:"128",placeholder:`${c.value} name`},null,8,Wr),[[ge,l.value]])]),t("div",qr,[C[8]||(C[8]=t("label",{class:"form-label"},"Description",-1)),me(t("textarea",{"onUpdate:modelValue":C[3]||(C[3]=_=>r.value=_),class:"form-input",maxlength:"500",rows:"4",placeholder:`${c.value} description...`},null,8,Gr),[[ge,r.value]])]),k(a).isOwner?(d(),h("div",Kr,[t("label",Yr,x(c.value)+" type",1),t("div",Jr,[t("label",Qr,[me(t("input",{"onUpdate:modelValue":C[4]||(C[4]=_=>b.value=_),type:"radio",value:"public",name:"chatType"},null,512),[[Kn,b.value]]),C[9]||(C[9]=t("span",{class:"type-option-label"},"Public",-1)),C[10]||(C[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",Xr,[me(t("input",{"onUpdate:modelValue":C[5]||(C[5]=_=>b.value=_),type:"radio",value:"private",name:"chatType"},null,512),[[Kn,b.value]]),C[11]||(C[11]=t("span",{class:"type-option-label"},"Private",-1)),C[12]||(C[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):P("",!0)]),t("div",Zr,[t("button",{class:"btn btn-primary",disabled:p.value,onClick:g},x(p.value?"Saving...":"Save"),9,ec),t("button",{class:"btn btn-ghost",onClick:C[6]||(C[6]=_=>i("close"))},"Cancel")])])])]))}}),nc=fe(tc,[["__scopeId","data-v-6ec12915"]]),sc={class:"danger-zone"},ac={class:"view-header"},ic={class:"danger-zone-body"},oc={class:"modal modal-sm"},lc={class:"modal-header"},rc={class:"modal-actions"},cc=["disabled"],uc=se({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:s}){const n=e,i=s,a=Me(),o=gt(),{showToast:l}=xe(),r=y(!1),u=y(!1);async function b(){try{await a.leave(n.chatId),i("left")}catch{l("Failed to leave channel")}}async function p(){u.value=!0;try{await ys(n.chatId),a.chats=a.chats.filter(v=>v.id!==n.chatId),a.activeChatId===n.chatId&&a.setActiveChat(null),r.value=!1,i("deleted")}catch{l("Failed to delete channel")}finally{u.value=!1}}return(v,f)=>(d(),h("div",sc,[t("div",ac,[t("button",{class:"icon-btn","aria-label":"Back",onClick:f[0]||(f[0]=c=>i("back"))},[U(k(Fe),{size:20,"stroke-width":2})]),f[5]||(f[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",ic,[t("button",{class:"btn btn-danger-outline",onClick:b},[U(k(Mn),{size:18,"stroke-width":1.8}),f[6]||(f[6]=ye(" Leave Channel ",-1))]),k(o).isOwner?(d(),h("button",{key:0,class:"btn btn-danger",onClick:f[1]||(f[1]=c=>r.value=!0)},[U(k(xs),{size:18,"stroke-width":1.8}),f[7]||(f[7]=ye(" Delete Channel ",-1))])):P("",!0)]),r.value?(d(),h("div",{key:0,class:"modal-backdrop",onClick:f[4]||(f[4]=ce(c=>r.value=!1,["self"]))},[t("div",oc,[t("div",lc,[f[8]||(f[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:f[2]||(f[2]=c=>r.value=!1)},[U(k(Be),{size:20,"stroke-width":2})])]),f[9]||(f[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",rc,[t("button",{class:"btn btn-ghost",onClick:f[3]||(f[3]=c=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:u.value,onClick:p},x(u.value?"Deleting...":"Delete"),9,cc)])])])):P("",!0)]))}}),dc=fe(uc,[["__scopeId","data-v-997b5e56"]]),vc={class:"modal profile-modal"},mc={class:"profile-modal-body"},fc={key:5,class:"profile-loading"},pc={class:"profile-avatar-section"},hc={class:"profile-name"},gc={class:"profile-status"},yc={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},bc={class:"profile-info-item"},kc={class:"profile-info-value"},wc={class:"channel-info-menu"},_c={class:"channel-info-menu-count"},Cc={class:"channel-info-menu-count"},$c={key:7,class:"profile-loading"},Sc=se({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:s}){const n=e,i=s,a=gt(),o=y("main"),l=V(()=>Number(n.chatId)),r=V(()=>a.detail?.type==="group");function u(){o.value="main",a.loadDetail(l.value)}return _e(async()=>{await Promise.all([a.loadDetail(l.value),a.loadMembers(l.value)])}),(b,p)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:p[14]||(p[14]=ce(v=>i("close"),["self"]))},[t("div",vc,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:p[0]||(p[0]=v=>i("close"))},[U(k(Be),{size:20,"stroke-width":2})]),t("div",mc,[o.value==="invites"?(d(),Y(lr,{key:0,"chat-id":l.value,onBack:p[1]||(p[1]=v=>o.value="main")},null,8,["chat-id"])):o.value==="admins"?(d(),Y(Tr,{key:1,"chat-id":l.value,onBack:p[2]||(p[2]=v=>o.value="main")},null,8,["chat-id"])):o.value==="subscribers"?(d(),Y(Nr,{key:2,"chat-id":l.value,onBack:p[3]||(p[3]=v=>o.value="main")},null,8,["chat-id"])):o.value==="edit"?(d(),Y(nc,{key:3,"chat-id":l.value,onClose:p[4]||(p[4]=v=>o.value="main"),onSaved:u},null,8,["chat-id"])):o.value==="danger"?(d(),Y(dc,{key:4,"chat-id":l.value,onBack:p[5]||(p[5]=v=>o.value="main"),onLeft:p[6]||(p[6]=v=>i("close")),onDeleted:p[7]||(p[7]=v=>i("close"))},null,8,["chat-id"])):k(a).loading?(d(),h("div",fc,[...p[15]||(p[15]=[t("p",null,"Loading...",-1)])])):k(a).detail?(d(),h(ie,{key:6},[t("div",pc,[U(we,{name:k(a).detail.title||"Channel",url:k(a).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",hc,x(k(a).detail.title),1),t("div",gc,x(k(a).memberCount)+" "+x(r.value?k(a).memberCount===1?"member":"members":k(a).memberCount===1?"subscriber":"subscribers"),1),k(a).detail.description?(d(),h("div",yc,[t("div",bc,[p[16]||(p[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",kc,x(k(a).detail.description),1)])])):P("",!0),p[19]||(p[19]=t("div",{class:"profile-divider"},null,-1)),t("div",wc,[t("button",{class:"channel-info-menu-item",onClick:p[8]||(p[8]=v=>o.value="invites")},[U(k(ri),{size:20,"stroke-width":1.8}),p[17]||(p[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:p[9]||(p[9]=v=>o.value="admins")},[U(k(hi),{size:20,"stroke-width":1.8}),p[18]||(p[18]=t("span",null,"Administrators",-1)),t("span",_c,x(k(a).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:p[10]||(p[10]=v=>o.value="subscribers")},[U(k(Zt),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Members":"Subscribers"),1),t("span",Cc,x(k(a).memberCount),1)]),k(a).isOwner||k(a).isAdmin?(d(),h("button",{key:0,class:"channel-info-menu-item",onClick:p[11]||(p[11]=v=>o.value="edit")},[U(k(Tn),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Edit Group":"Edit Channel"),1)])):P("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[12]||(p[12]=v=>o.value="danger")},[U(k(Mn),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Leave Group":"Leave Channel"),1)]),k(a).isOwner?(d(),h("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[13]||(p[13]=v=>o.value="danger")},[U(k(xs),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Delete Group":"Delete Channel"),1)])):P("",!0)])],64)):(d(),h("div",$c,[...p[20]||(p[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),Mc=fe(Sc,[["__scopeId","data-v-d1526322"]]),xc={class:"search-bar"},Tc={class:"search-bar-header"},Ec={key:0,class:"search-loading"},Ic={key:1,class:"search-empty"},Lc=["onClick"],Ac={class:"search-result-sender"},Rc=["innerHTML"],Dc={class:"search-result-date"},Oc={key:0,class:"search-loading"},Pc=se({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:s}){const n=e,i=s,a=y(null),o=y(null),l=y(""),r=y([]),u=y(!1),b=y(!1),p=y(!0);let v=null;_e(()=>{$e(()=>a.value?.focus())}),Oe(l,_=>{if(v&&clearTimeout(v),!_.trim()){r.value=[],b.value=!1,p.value=!0;return}v=setTimeout(()=>f(_.trim()),300)});async function f(_){u.value=!0,b.value=!0,p.value=!0;try{const D=await Jn(n.chatId,_,{limit:20});r.value=D,D.length<20&&(p.value=!1)}catch{r.value=[]}finally{u.value=!1}}async function c(){if(u.value||!p.value||r.value.length===0)return;const _=Math.min(...r.value.map(D=>D.id));u.value=!0;try{const D=await Jn(n.chatId,l.value.trim(),{limit:20,before_id:_});D.length<20&&(p.value=!1),r.value=[...r.value,...D]}catch{}finally{u.value=!1}}function m(){if(!o.value)return;const _=o.value;_.scrollTop+_.clientHeight>=_.scrollHeight-40&&c()}function g(_,D){if(!D)return T(_);const F=T(_),z=T(D),N=new RegExp(z.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return F.replace(N,"<mark>$&</mark>")}function T(_){return _.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function C(_){if(!_)return"";const D=new Date(_.endsWith("Z")?_:_+"Z"),F=new Date;return D.toDateString()===F.toDateString()?D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):D.toLocaleDateString([],{month:"short",day:"numeric"})+" "+D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return(_,D)=>(d(),h("div",xc,[t("div",Tc,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:D[0]||(D[0]=F=>i("close"))},"â†"),me(t("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":D[1]||(D[1]=F=>l.value=F),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:D[2]||(D[2]=hn(F=>i("close"),["escape"]))},null,544),[[ge,l.value]]),l.value?(d(),h("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:D[3]||(D[3]=F=>l.value="")},"âœ•")):P("",!0)]),u.value&&r.value.length===0?(d(),h("div",Ec,"Searching...")):b.value&&r.value.length===0&&!u.value?(d(),h("div",Ic,"No messages found")):r.value.length>0?(d(),h("div",{key:2,ref_key:"resultsRef",ref:o,class:"search-results",onScroll:m},[(d(!0),h(ie,null,he(r.value,F=>(d(),h("div",{key:F.id,class:"search-result-item",onClick:z=>i("jumpToMessage",F.id)},[t("div",Ac,x(F.sender_display_name||F.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:g(F.content||"",l.value)},null,8,Rc),t("div",Dc,x(C(F.created_at)),1)],8,Lc))),128)),u.value?(d(),h("div",Oc,"Loading more...")):P("",!0)],544)):P("",!0)]))}});function Nc(e){const{chatId:s,verticalThreshold:n=8}=e,i=y(!1);let a=0,o=!1,l=!1;function r(v){const f=v?.closest?.("[data-message-id]");if(!f)return null;const c=f.getAttribute("data-message-id");return c!=null?Number(c):null}function u(v){v.button!==0||!v.target.closest("[data-message-id]")||s()==null||(a=v.clientY,o=!0,l=!1)}function b(v){if(!o)return;if(!l){if(Math.abs(v.clientY-a)<n)return;l=!0;const g=Ke(),T=s();if(T==null){o=!1;return}g.selectionMode||g.enterSelectionMode(T),i.value=!0}v.preventDefault();const f=document.elementFromPoint(v.clientX,v.clientY),c=r(f);c!=null&&Ke().addMessage(c)}function p(){o&&(o=!1,l=!1,i.value=!1)}return{isDragSelecting:i,onMouseDown:u,onMouseMove:b,onMouseUp:p}}const Uc={class:"chat-panel"},Fc={key:1,class:"chat-view"},zc={key:2,class:"channel-readonly-bar"},Bc={key:0,class:"date-sep"},Hc={key:4,class:"sticker-picker"},jc={key:6,class:"recording-bar"},Vc={class:"rec-time"},Wc=se({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:s}){const n=s,i=Le(),a=Me(),o=ht(),{showToast:l}=xe(),r=Ui(),u=Qe("stickers",y([])),b=Qe("sendTyping",()=>{}),p=Qe("pendingScrollMessageId",y(null)),v=y(null),f=y(null),c=y(!1);let m=null;const g=y(!1),T=y(!1),C=y("member"),_=y(!1),D=y(!1),F=y(null);it("lastSentMessageId",F);const z=y(!0),N=y(0);let ne=null;function re(){if(!v.value)return!0;const O=v.value;return O.scrollTop+O.clientHeight>=O.scrollHeight-100}function E(){ne||(ne=setTimeout(()=>{ne=null,z.value=re(),z.value&&(N.value=0)},100))}function M(O){O.target.closest(".msg-row")||(O.preventDefault(),window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{areaOnly:!0,chatId:a.activeChatId,x:O.clientX,y:O.clientY}})))}function B(){et(),N.value=0,z.value=!0}const J=y(!1),W=y(0),I=y(0),j=y(null),oe=Ke(),{isDragSelecting:be,onMouseDown:S,onMouseMove:A,onMouseUp:q}=Nc({chatId:()=>a.activeChatId}),H=y(!1),ee=y(null),ue=y(""),ve=V(()=>!ee.value||!i.user?!1:Ye.value.find(w=>w.id===ee.value)?.sender_id===i.user.id),K=V(()=>ve.value?Ye.value.find(w=>w.id===ee.value)?.message_type==="text":!1),$=V(()=>!ee.value||!a.activeChatId?!1:o.pinnedByChat[a.activeChatId]?.message?.id===ee.value),G=V(()=>!a.activeChatId||o.pinnedDismissed.has(a.activeChatId)?null:o.pinnedByChat[a.activeChatId]||null),Z=y(!1),le=y([]),Ce=y(!1),Te=y([]),tn=y(!1),nn=y(null);let yt=null;const Fn=V(()=>a.activeChat?.type==="channel"&&C.value==="member"),Ye=V(()=>a.activeChatId?o.getMessages(a.activeChatId):[]),Bs=V(()=>{const O=[];let w="";for(const R of Ye.value){const ae=Hs(R.created_at);ae!==w&&(O.push({type:"date",label:ae}),w=ae),O.push({type:"msg",msg:R})}return O});function Hs(O){if(!O)return"";const w=new Date(O.endsWith("Z")?O:O+"Z"),R=new Date;if(w.toDateString()===R.toDateString())return"Today";const ae=new Date(R);return ae.setDate(R.getDate()-1),w.toDateString()===ae.toDateString()?"Yesterday":w.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function js(){sn(),!(!f.value||!v.value)&&(m=new IntersectionObserver(async O=>{if(!O[0]?.isIntersecting)return;const R=a.activeChatId;if(!R||c.value||o.loadingChat===R)return;c.value=!0;const ae=v.value,Ae=ae?ae.scrollHeight:0;try{if((await o.loadOlder(R)).length>0&&ae){await $e();const tt=ae.scrollHeight;ae.scrollTop+=tt-Ae}}finally{c.value=!1}},{root:v.value,threshold:0}),m.observe(f.value))}function sn(){m&&(m.disconnect(),m=null)}Oe(()=>a.activeChatId,async O=>{if(g.value=!1,C.value="member",N.value=0,z.value=!0,sn(),yt&&(clearInterval(yt),yt=null),!O)return;await Promise.all([o.loadMessages(O),o.loadPinnedMessage(O),o.loadReadReceipts(O)]),await $e(),et(),await $e(),js();const w=a.activeChat;if(w&&(w.type==="channel"||w.type==="group"))try{const R=await gs(O);C.value=R.my_role||"member"}catch{}yt=setInterval(()=>{a.activeChatId===O&&o.loadNewer(O).then(R=>{R.length>0&&Vs(R.length)})},2500)});function et(){v.value&&(v.value.scrollTop=v.value.scrollHeight)}function Vs(O=1){if(!v.value)return;const w=v.value;w.scrollHeight-w.scrollTop-w.clientHeight<100?$e(()=>{w.scrollTop=w.scrollHeight}):N.value+=O}function Ws(){a.activeChatId&&b(a.activeChatId)}async function qs(O,w){if(!(!a.activeChatId||!O.trim())){nn.value=null;try{const R=w?{reply_to_message_id:w.messageId}:void 0,ae=await o.sendMessage(a.activeChatId,O.trim(),"text",R);i.user&&(ae.sender_id=i.user.id,ae.sender_username=i.user.username,ae.sender_display_name=i.user.display_name),F.value=ae.id,setTimeout(()=>{F.value===ae.id&&(F.value=null)},500),await $e(),et(),a.loadChats()}catch{l("Failed to send message")}}}async function Gs(O,w){if(!(!a.activeChatId||!w.trim()))try{await o.editMessage(a.activeChatId,O,w.trim())}catch{l("Failed to edit message")}}async function Ks(O){if(a.activeChatId){g.value=!1;try{const w=await o.sendMessage(a.activeChatId,"","sticker",{sticker_id:O}),R=u.value.find(ae=>ae.id===O);R&&(w.sticker_url=R.url,w.sticker_label=R.label),F.value=w.id,setTimeout(()=>{F.value===w.id&&(F.value=null)},500),await $e(),et(),a.loadChats()}catch{l("Failed to send sticker")}}}function Ys(O,w,R){j.value=O,W.value=w,I.value=R,J.value=!0}function Js(O){j.value&&a.activeChatId&&o.toggleReaction(a.activeChatId,j.value,O),J.value=!1,j.value=null}function Qs(O,w){a.activeChatId&&o.toggleReaction(a.activeChatId,O,w)}function Xs(){J.value=!1,j.value=null}async function Zs(){try{await r.startRecording(),T.value=!0}catch{T.value=!1,l("Microphone access denied")}}async function ea(){try{const O=await r.stopRecording();T.value=!1,await oa(O)}catch{T.value=!1}}function ta(){r.cancelRecording(),T.value=!1}function zn(O){const{messageIds:w}=O.detail;le.value=w,Z.value=!0}function Bn(O){const{messageId:w,chatId:R}=O.detail;R&&oe.enterSelectionMode(R,w)}async function Hn(O,w){try{await o.pinMsg(O,w)}catch{l("Failed to pin message")}}async function jn(O,w){try{await o.unpinMsg(O,w)}catch{l("Failed to unpin message")}}function Vn(O){const{messageId:w,chatId:R}=O.detail;w&&R&&Hn(R,w)}function Wn(O){const{messageId:w,chatId:R}=O.detail;w&&R&&jn(R,w)}function an(O){const{messageId:w,chatId:R}=O.detail;if(!w||!R)return;Te.value=[w];const ae=Ye.value.find(Ae=>Ae.id===w);tn.value=!!(ae&&ae.sender_id===i.user?.id),Ce.value=!0}function na(){le.value=[...oe.selectedMessageIds],Z.value=!0}function sa(){Te.value=[...oe.selectedMessageIds],tn.value=Te.value.every(O=>{const w=Ye.value.find(R=>R.id===O);return w&&w.sender_id===i.user?.id}),Ce.value=!0}function qn(){Z.value=!1,le.value=[],oe.exitSelectionMode()}async function aa(O){Ce.value=!1;const w=a.activeChatId;if(w){for(const R of Te.value)try{await o.deleteMessage(w,R,O)}catch{l("Failed to delete message")}Te.value=[],oe.exitSelectionMode()}}function He(O){H.value=!1;const w=ee.value,R=a.activeChatId;if(!(!w||!R))switch(O){case"reply":{const ae=Ye.value.find(Ae=>Ae.id===w);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:w,senderName:ae?.sender_display_name||ae?.sender_username||"Unknown",text:ae?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:w,chatId:R,text:ue.value}}));break}case"copy":navigator.clipboard.writeText(ue.value).then(()=>l("Copied to clipboard"),()=>l("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${R}/${w}`).then(()=>l("Link copied"),()=>l("Failed to copy link"));break;case"forward":le.value=[w],Z.value=!0;break;case"select":oe.enterSelectionMode(R,w);break;case"delete":an(new CustomEvent("",{detail:{messageId:w,chatId:R}}));break;case"pin":Hn(R,w);break;case"unpin":jn(R,w);break}}async function bt(O){if(!v.value)return;const w=a.activeChatId;if(!w)return;let R=v.value.querySelector(`[data-message-id="${O}"]`);if(!R)try{const ae=Math.max(0,O-25),Ae=await Ct(w,{after_id:ae,limit:50});if(!Ae.find(tt=>tt.id===O)){l("Message not found");return}o.messagesByChat[w]=Ae,Ae.length>0&&(o.lastMsgId[w]=Math.max(...Ae.map(tt=>tt.id))),await $e(),R=v.value?.querySelector(`[data-message-id="${O}"]`)}catch{l("Message not found");return}R&&(R.scrollIntoView({behavior:"smooth",block:"center"}),R.classList.add("highlight-message"),setTimeout(()=>R.classList.remove("highlight-message"),2e3))}function ia(O){D.value=!1,bt(O)}function Gn(O){if(O.key==="Escape"){if(D.value){D.value=!1,O.stopPropagation();return}_.value&&(_.value=!1,O.stopPropagation())}}_e(()=>{window.addEventListener("forward-messages",zn),window.addEventListener("select-message",Bn),window.addEventListener("delete-message",an),window.addEventListener("pin-message",Vn),window.addEventListener("unpin-message",Wn),document.addEventListener("keydown",Gn)}),qe(()=>{sn(),window.removeEventListener("forward-messages",zn),window.removeEventListener("select-message",Bn),window.removeEventListener("delete-message",an),window.removeEventListener("pin-message",Vn),window.removeEventListener("unpin-message",Wn),document.removeEventListener("keydown",Gn)}),Oe(()=>p.value,async O=>{O&&(await $e(),setTimeout(()=>{bt(O),p.value=null},300))}),Oe(()=>a.activeChatId,()=>{oe.exitSelectionMode(),nn.value=null,D.value=!1});async function oa(O){if(a.activeChatId)try{const w=await En(O);await o.sendMessage(a.activeChatId,"","voice",{file_id:w.id,duration_seconds:r.seconds.value}),await o.loadMessages(a.activeChatId),await $e(),et(),a.loadChats()}catch{l("Failed to upload voice message")}}return(O,w)=>(d(),h("main",Uc,[k(a).activeChatId?(d(),h("div",Fc,[U(wl,{onForward:na,onDelete:sa}),D.value&&k(a).activeChatId?(d(),Y(Pc,{key:0,"chat-id":k(a).activeChatId,onClose:w[1]||(w[1]=R=>D.value=!1),onJumpToMessage:ia},null,8,["chat-id"])):P("",!0),me(U(Gi,{onBack:w[2]||(w[2]=R=>n("back")),onOpenUserProfile:w[3]||(w[3]=R=>n("openUserProfile",R)),onOpenChannelInfo:w[4]||(w[4]=R=>_.value=!0),onOpenSearch:w[5]||(w[5]=R=>D.value=!0)},null,512),[[Yn,!k(oe).selectionMode&&!D.value]]),G.value&&!k(oe).selectionMode?(d(),Y(Hi,{key:1,message:G.value.message,onClick:w[6]||(w[6]=R=>bt(G.value.message.id)),onDismiss:w[7]||(w[7]=R=>k(o).dismissPin(k(a).activeChatId))},null,8,["message"])):P("",!0),Fn.value?(d(),h("div",zc,[...w[26]||(w[26]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):P("",!0),N.value>0?(d(),h("button",{key:3,class:"new-messages-pill",onClick:B},x(N.value)+" new message"+x(N.value>1?"s":"")+" â†“ ",1)):P("",!0),t("div",{ref_key:"msgListRef",ref:v,class:de(["msg-list",{"drag-selecting":k(be)}]),onClick:Xs,onScroll:E,onContextmenu:M,onMousedown:w[9]||(w[9]=(...R)=>k(S)&&k(S)(...R)),onMousemove:w[10]||(w[10]=(...R)=>k(A)&&k(A)(...R)),onMouseup:w[11]||(w[11]=(...R)=>k(q)&&k(q)(...R))},[k(o).loadingChat===k(a).activeChatId?(d(),Y(ds,{key:0})):(d(),h(ie,{key:1},[t("div",{ref_key:"olderSentinelRef",ref:f,class:"older-sentinel"},[c.value?(d(),Y(ds,{key:0})):P("",!0)],512),(d(!0),h(ie,null,he(Bs.value,R=>(d(),h(ie,{key:R.type==="date"?"date-"+R.label:"msg-"+R.msg.id},[R.type==="date"?(d(),h("div",Bc,[t("span",null,x(R.label),1)])):(d(),Y(Vo,{key:1,message:R.msg,"is-mine":R.msg.sender_id===k(i).user?.id,onMentionClick:w[8]||(w[8]=ae=>n("openUserProfile",ae)),onOpenEmojiPicker:Ys,onToggleReaction:Qs,onReplyClick:bt},null,8,["message","is-mine"]))],64))),128))],64))],34),U(vl,{visible:J.value,x:W.value,y:I.value,onSelect:Js,onClose:w[12]||(w[12]=R=>J.value=!1)},null,8,["visible","x","y"]),g.value?(d(),h("div",Hc,[U(ll,{onSelect:Ks})])):P("",!0),Fn.value?P("",!0):me((d(),Y(nl,{key:5,"sticker-picker-open":g.value,"reply-to":nn.value,onSend:qs,onEditMessage:Gs,onToggleStickers:w[13]||(w[13]=R=>g.value=!g.value),onStartRecording:Zs,onTyping:Ws},null,8,["sticker-picker-open","reply-to"])),[[Yn,!T.value]]),T.value?(d(),h("div",jc,[w[27]||(w[27]=t("span",{class:"rec-dot"},null,-1)),t("span",Vc,x(k(r).formatTime(k(r).seconds.value)),1),w[28]||(w[28]=t("span",{class:"rec-label"},"Recording...",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:ta},"âœ•"),t("button",{class:"icon-btn rec-send",title:"Send",onClick:ea},"â¤")])):P("",!0),U(fl),U(Cl,{visible:H.value,onClose:w[22]||(w[22]=R=>H.value=!1)},{default:Xt(()=>[t("button",{class:"ctx-item",onClick:w[14]||(w[14]=R=>He("reply"))},"Reply"),K.value?(d(),h("button",{key:0,class:"ctx-item",onClick:w[15]||(w[15]=R=>He("edit"))},"Edit")):P("",!0),t("button",{class:"ctx-item",onClick:w[16]||(w[16]=R=>He($.value?"unpin":"pin"))},x($.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:w[17]||(w[17]=R=>He("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:w[18]||(w[18]=R=>He("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:w[19]||(w[19]=R=>He("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:w[20]||(w[20]=R=>He("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:w[21]||(w[21]=R=>He("delete"))},"Delete")]),_:1},8,["visible"]),Z.value?(d(),Y(Nl,{key:7,"message-ids":le.value,"from-chat-id":k(a).activeChatId,onClose:qn,onForwarded:qn},null,8,["message-ids","from-chat-id"])):P("",!0),Ce.value?(d(),Y(Wl,{key:8,"message-count":Te.value.length,"can-delete-for-everyone":tn.value,onClose:w[23]||(w[23]=R=>Ce.value=!1),onConfirm:aa},null,8,["message-count","can-delete-for-everyone"])):P("",!0),_.value?(d(),Y(Mc,{key:9,"chat-id":String(k(a).activeChatId),onClose:w[24]||(w[24]=R=>_.value=!1)},null,8,["chat-id"])):P("",!0)])):(d(),h("div",{key:0,class:"empty-chat",onContextmenu:w[0]||(w[0]=ce(()=>{},["prevent"]))},[...w[25]||(w[25]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])],32))]))}}),qc=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Saved Messages",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function Gc(e){return qc.filter(s=>s.visible(e))}const Kc=["disabled"],Yc={class:"menu-item__label"},Jc={key:1,class:"menu-item__badge"},Qc=se({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:s}){const n=s;return(i,a)=>(d(),h("button",{class:de(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:a[0]||(a[0]=o=>n("click"))},[e.icon?(d(),Y(ze(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):P("",!0),t("span",Yc,x(e.label),1),e.badge?(d(),h("span",Jc,x(e.badge),1)):P("",!0),ps(i.$slots,"right",{},void 0),e.chevron?(d(),Y(ze(k(si)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):P("",!0)],10,Kc))}}),vs=fe(Qc,[["__scopeId","data-v-682bc042"]]),Xc={class:"drawer-header"},Zc={class:"drawer-profile"},eu={class:"drawer-profile-bottom"},tu={class:"drawer-profile-info"},nu={class:"drawer-display-name"},su={class:"drawer-username"},au={class:"drawer-nav"},iu={key:0,class:"drawer-divider"},ou=["onClick"],lu={class:"menu-item__label"},ru=["aria-checked"],cu=se({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:s}){const n=s,i=hs(),a=Le(),o=pt(),l={user:Ts,users:Zt,megaphone:xn,bookmark:ni,settings:pi,moon:vi,download:ai,"log-out":Mn,star:yi},r=V(()=>({isAuthenticated:!!a.user,isDesktop:!0})),u=V(()=>Gc(r.value)),b={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const v=o.theme==="dark"?"light":"dark";o.applyTheme(v),o.saveSettings({theme:v})},openDownload:()=>n("openDownload"),logout:()=>{a.logout(),i.push("/login")}};function p(v){v&&b[v]&&b[v]()}return(v,f)=>(d(),h("div",{class:de(["drawer",{open:e.open}])},[t("div",Xc,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:f[0]||(f[0]=c=>n("close"))},[U(k(Be),{size:20,"stroke-width":2})]),f[2]||(f[2]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",Zc,[U(we,{name:k(a).user?.display_name||k(a).user?.username||"?",url:k(a).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",eu,[t("div",tu,[t("div",nu,x(k(a).user?.display_name||k(a).user?.username||"---"),1),t("div",su,"@"+x(k(a).user?.username||"---"),1)]),t("button",{class:"icon-btn drawer-edit-btn","aria-label":"Edit profile",onClick:f[1]||(f[1]=c=>n("openProfile"))},[U(k(Tn),{size:18,"stroke-width":2})])])]),t("nav",au,[(d(!0),h(ie,null,he(u.value,c=>(d(),h(ie,{key:c.id},[c.separator?(d(),h("div",iu)):P("",!0),c.rightSlot==="toggle"?(d(),h("div",{key:1,class:"menu-item menu-item--toggle",onClick:m=>p(c.action)},[(d(),Y(ze(l[c.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",lu,x(c.label),1),t("span",{class:de(["toggle-switch",{"toggle-switch--on":k(o).theme==="dark"}]),role:"switch","aria-checked":k(o).theme==="dark"},[...f[3]||(f[3]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,ru)],8,ou)):c.id==="logout"?(d(),Y(vs,{key:2,icon:l[c.icon],label:c.label,danger:"",onClick:m=>p(c.action)},null,8,["icon","label","onClick"])):(d(),Y(vs,{key:3,icon:l[c.icon],label:c.label,onClick:m=>p(c.action)},null,8,["icon","label","onClick"]))],64))),128))]),f[4]||(f[4]=t("div",{class:"drawer-footer"},"BeHappy v2",-1))],2))}}),uu=fe(cu,[["__scopeId","data-v-db1ed91e"]]),du={class:"modal"},vu={class:"modal-header"},mu={class:"modal-body"},fu={key:0,class:"chat-type-cards"},pu={class:"chat-type-icon"},hu={class:"chat-type-icon"},gu={class:"chat-type-icon"},yu={key:1,class:"new-chat-form"},bu={class:"user-pick-list"},ku={key:0,class:"empty-state-small"},wu={key:1,class:"empty-state-small"},_u=["onClick"],Cu={class:"user-pick-name"},$u={class:"user-pick-handle"},Su={key:2,class:"new-chat-form"},Mu={class:"form-group"},xu={class:"form-group"},Tu={class:"form-group"},Eu={class:"user-pick-list"},Iu=["onClick"],Lu={class:"user-pick-name"},Au={class:"user-pick-handle"},Ru={class:"modal-actions"},Du=["disabled"],Ou={key:3,class:"new-chat-form"},Pu={class:"form-group"},Nu={class:"form-group"},Uu={class:"form-group"},Fu={class:"modal-actions"},zu=["disabled"],Bu=se({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:s}){const n=e,i=s,a=Le(),{showToast:o}=xe(),l=y(n.initialStep),r=y(!1),u=y(""),b=y([]),p=y(!1);let v=null;const f=y(""),c=y(""),m=y(""),g=y([]),T=y(new Set);let C=null;const _=y(""),D=y(""),F=y("");_e(()=>{z("")});async function z(W){p.value=!0;try{const I=await Qn(W);b.value=I.filter(j=>j.id!==a.user?.id)}catch{b.value=[]}finally{p.value=!1}}function N(){v&&clearTimeout(v),v=setTimeout(()=>z(u.value),300)}async function ne(W){try{g.value=await Qn(W)}catch{g.value=[]}}function re(){C&&clearTimeout(C),C=setTimeout(()=>ne(m.value),300)}function E(W){T.value.has(W)?T.value.delete(W):T.value.add(W)}async function M(W){r.value=!0;try{const I=await ot({type:"direct",member_ids:[W]});i("chatCreated",I.id)}catch{o("Failed to start conversation")}finally{r.value=!1}}async function B(){if(!f.value.trim()){o("Group name is required");return}r.value=!0;try{const W=await ot({type:"group",title:f.value.trim(),description:c.value.trim(),member_ids:Array.from(T.value)});o("Group created!"),i("chatCreated",W.id)}catch{o("Failed to create group")}finally{r.value=!1}}async function J(){if(!_.value.trim()){o("Channel name is required");return}r.value=!0;try{const W=await ot({type:"channel",title:_.value.trim(),description:F.value.trim(),public_name:D.value.trim()||void 0,member_ids:[]});o("Channel created!"),i("chatCreated",W.id)}catch{o("Failed to create channel")}finally{r.value=!1}}return(W,I)=>(d(),h("div",{class:"modal-backdrop",onClick:I[14]||(I[14]=ce(j=>i("close"),["self"]))},[t("div",du,[t("div",vu,[I[15]||(I[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:I[0]||(I[0]=j=>i("close"))},[U(k(Be),{size:20})])]),t("div",mu,[l.value==="select"?(d(),h("div",fu,[t("button",{class:"chat-type-card",onClick:I[1]||(I[1]=j=>l.value="direct")},[t("span",pu,[U(k(Ts),{size:24})]),I[16]||(I[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:I[2]||(I[2]=j=>l.value="group")},[t("span",hu,[U(k(Zt),{size:24})]),I[17]||(I[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:I[3]||(I[3]=j=>l.value="channel")},[t("span",gu,[U(k(xn),{size:24})]),I[18]||(I[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):P("",!0),l.value==="direct"?(d(),h("div",yu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:I[4]||(I[4]=j=>l.value="select")},[U(k(Fe),{size:16}),I[19]||(I[19]=ye(" Back ",-1))]),me(t("input",{"onUpdate:modelValue":I[5]||(I[5]=j=>u.value=j),class:"search-input",type:"search",placeholder:"Search users...",onInput:N},null,544),[[ge,u.value]]),t("div",bu,[p.value?(d(),h("div",ku,"Loading users...")):b.value.length===0?(d(),h("div",wu,"No users found.")):(d(!0),h(ie,{key:2},he(b.value,j=>(d(),h("div",{key:j.id,class:"user-pick-item",onClick:oe=>M(j.id)},[U(we,{name:j.display_name||j.username,url:j.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Cu,x(j.display_name||j.username),1),t("div",$u,"@"+x(j.username),1)])],8,_u))),128))])])):P("",!0),l.value==="group"?(d(),h("div",Su,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:I[6]||(I[6]=j=>l.value="select")},[U(k(Fe),{size:16}),I[20]||(I[20]=ye(" Back ",-1))]),t("div",Mu,[I[21]||(I[21]=t("label",{class:"form-label"},"Group name",-1)),me(t("input",{"onUpdate:modelValue":I[7]||(I[7]=j=>f.value=j),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[ge,f.value]])]),t("div",xu,[I[22]||(I[22]=t("label",{class:"form-label"},"Description (optional)",-1)),me(t("textarea",{"onUpdate:modelValue":I[8]||(I[8]=j=>c.value=j),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[ge,c.value]])]),t("div",Tu,[I[23]||(I[23]=t("label",{class:"form-label"},"Add members",-1)),me(t("input",{"onUpdate:modelValue":I[9]||(I[9]=j=>m.value=j),class:"search-input",type:"search",placeholder:"Search users...",onInput:re},null,544),[[ge,m.value]]),t("div",Eu,[(d(!0),h(ie,null,he(g.value,j=>(d(),h("div",{key:j.id,class:de(["user-pick-item",{selected:T.value.has(j.id)}]),onClick:oe=>E(j.id)},[U(we,{name:j.display_name||j.username,url:j.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Lu,[T.value.has(j.id)?(d(),Y(k(Cs),{key:0,size:14,style:{"margin-right":"4px"}})):P("",!0),ye(x(j.display_name||j.username),1)]),t("div",Au,"@"+x(j.username),1)])],10,Iu))),128))])]),t("div",Ru,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:B}," Create Group ",8,Du)])])):P("",!0),l.value==="channel"?(d(),h("div",Ou,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:I[10]||(I[10]=j=>l.value="select")},[U(k(Fe),{size:16}),I[24]||(I[24]=ye(" Back ",-1))]),t("div",Pu,[I[25]||(I[25]=t("label",{class:"form-label"},"Channel name",-1)),me(t("input",{"onUpdate:modelValue":I[11]||(I[11]=j=>_.value=j),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[ge,_.value]])]),t("div",Nu,[I[26]||(I[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),me(t("input",{"onUpdate:modelValue":I[12]||(I[12]=j=>D.value=j),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[ge,D.value]]),I[27]||(I[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",Uu,[I[28]||(I[28]=t("label",{class:"form-label"},"Description (optional)",-1)),me(t("textarea",{"onUpdate:modelValue":I[13]||(I[13]=j=>F.value=j),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[ge,F.value]])]),t("div",Fu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:J}," Create Channel ",8,zu)])])):P("",!0)])])]))}}),Hu={class:"profile-info-list"},ju=["onClick"],Vu={class:"profile-info-item__content"},Wu={class:"profile-info-item__value"},qu={class:"profile-info-item__label"},Gu=se({__name:"ProfileInfoList",props:{username:{},bio:{},userId:{}},setup(e){const s=e,n=y(null),i=V(()=>{const o=[];return s.username&&o.push({icon:ti,label:"Username",value:`@${s.username}`,copyable:!0}),s.bio&&o.push({icon:Ss,label:"Bio",value:s.bio}),s.userId!=null&&o.push({icon:oi,label:"User ID",value:String(s.userId),copyable:!0}),o});async function a(o){try{await navigator.clipboard.writeText(o.replace(/^@/,""));const l=i.value.find(r=>r.value===o)?.label??null;n.value=l,setTimeout(()=>{n.value=null},1500)}catch{}}return(o,l)=>(d(),h("div",Hu,[(d(!0),h(ie,null,he(i.value,r=>(d(),h("div",{key:r.label,class:de(["profile-info-item",{"profile-info-item--copyable":r.copyable}]),onClick:u=>r.copyable?a(r.value):void 0},[(d(),Y(ze(r.icon),{class:"profile-info-item__icon",size:20,"stroke-width":1.8})),t("div",Vu,[t("span",Wu,x(r.value),1),t("span",qu,x(r.label),1)]),r.copyable?(d(),Y(ze(n.value===r.label?k(Cs):k($s)),{key:0,class:"profile-info-item__copy",size:16,"stroke-width":1.8})):P("",!0)],10,ju))),128))]))}}),zs=fe(Gu,[["__scopeId","data-v-bc174e9a"]]),Ku={class:"profile-media-tabs"},Yu={class:"profile-media-tabs__header"},Ju=["onClick"],Qu={key:0,class:"profile-media-tabs__count"},Xu={key:0,class:"profile-media-tabs__content"},Zu={class:"profile-media-tabs__empty"},ed={class:"profile-media-tabs__empty-text"},td=se({__name:"ProfileMediaTabs",setup(e){const s=[{key:"media",label:"Media",count:0,emptyIcon:Ms},{key:"files",label:"Files",count:0,emptyIcon:Ss},{key:"links",label:"Links",count:0,emptyIcon:li},{key:"voice",label:"Voice",count:0,emptyIcon:di}],n=y("media"),i=V(()=>s.findIndex(l=>l.key===n.value)),a=V(()=>s[i.value]??s[0]),o=V(()=>({width:`${100/s.length}%`,transform:`translateX(${i.value*100}%)`}));return(l,r)=>(d(),h("div",Ku,[t("div",Yu,[(d(),h(ie,null,he(s,u=>t("button",{key:u.key,class:de(["profile-media-tabs__tab",{"profile-media-tabs__tab--active":n.value===u.key}]),onClick:b=>n.value=u.key},[ye(x(u.label)+" ",1),u.count!==void 0?(d(),h("span",Qu,x(u.count),1)):P("",!0)],10,Ju)),64)),t("div",{class:"profile-media-tabs__indicator",style:Ze(o.value)},null,4)]),a.value?(d(),h("div",Xu,[t("div",Zu,[(d(),Y(ze(a.value.emptyIcon),{size:40,"stroke-width":1.2,class:"profile-media-tabs__empty-icon"})),t("span",ed," No "+x(a.value.label.toLowerCase())+" yet ",1)])])):P("",!0)]))}}),nd=fe(td,[["__scopeId","data-v-bb3b131e"]]),sd={class:"modal profile-modal profile-modal--self"},ad={key:"view"},id={class:"profile-header"},od={class:"profile-header__content"},ld={class:"profile-header__info"},rd={class:"profile-name"},cd={class:"profile-modal-body"},ud={key:"edit"},dd={class:"profile-edit-header"},vd={class:"profile-modal-body profile-modal-body--scrollable"},md={class:"profile-avatar-section profile-avatar-upload-section"},fd={class:"profile-avatar-overlay"},pd={class:"profile-info-list"},hd={class:"form-group"},gd={class:"form-group"},yd={key:0,class:"form-hint form-error"},bd={class:"form-group"},kd=se({__name:"ProfileModal",emits:["close"],setup(e,{emit:s}){const n=s,i=Le(),a=Me(),{showToast:o}=xe(),l=y("view"),r=y("profile-slide-left"),u=y(""),b=y(""),p=y(""),v=y(""),f=y(null),c=V(()=>i.user?a.isUserOnline(i.user.id):!1),m=V(()=>{if(c.value)return"online";if(!i.user)return"offline";const F=a.getUserPresence(i.user.id);return F?.lastSeenAt?In(F.lastSeenAt):F?.lastSeenBucket?`last seen ${F.lastSeenBucket}`:"offline"});function g(){i.user&&(u.value=i.user.display_name||"",b.value=i.user.username,p.value=i.user.bio||""),v.value=""}function T(){g(),r.value="profile-slide-left",l.value="edit"}function C(){r.value="profile-slide-right",l.value="view"}async function _(){const F=f.value?.files?.[0];if(F){try{const z=await En(F),N=await Ka(z.id);i.updateUser({avatar_url:N.avatar_url}),o("Avatar updated!")}catch{o("Upload failed")}f.value&&(f.value.value="")}}async function D(){if(v.value="",!i.user)return;const F={display_name:u.value.trim(),bio:p.value.trim()};b.value.trim()&&b.value.trim()!==i.user.username&&(F.username=b.value.trim());try{const z=await Ga(i.user.id,F);i.updateUser({display_name:z.display_name,username:z.username}),o("Profile saved!"),n("close")}catch(z){z.response?.status===409?v.value="Username already taken":o("Save failed")}}return(F,z)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:z[5]||(z[5]=ce(N=>n("close"),["self"]))},[t("div",sd,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:z[0]||(z[0]=N=>n("close"))},[U(k(Be),{size:20,"stroke-width":2})]),l.value==="view"?(d(),h("button",{key:0,class:"icon-btn profile-edit-btn","aria-label":"Edit profile",onClick:T},[U(k(Tn),{size:18,"stroke-width":2})])):P("",!0),U(Sn,{name:r.value,mode:"out-in"},{default:Xt(()=>[l.value==="view"?(d(),h("div",ad,[t("div",id,[z[6]||(z[6]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",od,[U(we,{name:k(i).user?.display_name||k(i).user?.username||"?",url:k(i).user?.avatar_url,online:c.value,size:"xxl"},null,8,["name","url","online"]),t("div",ld,[t("div",rd,[ye(x(k(i).user?.display_name||k(i).user?.username||"?")+" ",1),k(i).user?.is_admin?(d(),Y(Un,{key:0})):P("",!0)]),t("div",{class:de(["profile-status",{"profile-status--online":c.value}])},x(m.value),3)])])]),t("div",cd,[U(zs,{username:k(i).user?.username,bio:k(i).user?.bio,"user-id":k(i).user?.id},null,8,["username","bio","user-id"]),U(nd)])])):(d(),h("div",ud,[t("div",dd,[t("button",{class:"icon-btn","aria-label":"Back",onClick:C},[U(k(Fe),{size:20,"stroke-width":2})]),z[7]||(z[7]=t("span",{class:"profile-edit-header__title"},"Edit Profile",-1))]),t("div",vd,[t("div",md,[t("div",{class:"profile-avatar-upload-wrap",onClick:z[1]||(z[1]=N=>f.value?.click())},[U(we,{name:u.value||k(i).user?.username||"?",url:k(i).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",fd,[U(k(_s),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",class:"hidden",onChange:_},null,544)]),t("div",pd,[t("div",hd,[z[8]||(z[8]=t("label",{class:"form-label"},"Display name",-1)),me(t("input",{"onUpdate:modelValue":z[2]||(z[2]=N=>u.value=N),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[ge,u.value]])]),t("div",gd,[z[9]||(z[9]=t("label",{class:"form-label"},"Username",-1)),me(t("input",{"onUpdate:modelValue":z[3]||(z[3]=N=>b.value=N),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[ge,b.value]]),v.value?(d(),h("small",yd,x(v.value),1)):P("",!0)]),t("div",bd,[z[10]||(z[10]=t("label",{class:"form-label"},"Bio",-1)),me(t("textarea",{"onUpdate:modelValue":z[4]||(z[4]=N=>p.value=N),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[ge,p.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:D},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:C},"Cancel")])])]))]),_:1},8,["name"])])]))}}),wd=fe(kd,[["__scopeId","data-v-59263597"]]),_d={class:"profile-actions"},Cd=["disabled","onClick"],$d={class:"profile-action-btn__circle"},Sd={class:"profile-action-btn__label"},Md=se({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:s}){const n=e,i=s,a=V(()=>{const o=[{icon:ui,label:"Message",event:"message"}];return n.showMute!==!1&&o.push({icon:ws,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&o.push({icon:ii,label:"More",event:"more"}),o});return(o,l)=>(d(),h("div",_d,[(d(!0),h(ie,null,he(a.value,r=>(d(),h("button",{key:r.label,class:de(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:u=>i(r.event)},[t("span",$d,[(d(),Y(ze(r.icon),{size:22,"stroke-width":1.8}))]),t("span",Sd,x(r.label),1)],10,Cd))),128))]))}}),xd=fe(Md,[["__scopeId","data-v-a16c1098"]]),Td={class:"modal profile-modal"},Ed={key:0,class:"profile-modal-body"},Id={class:"profile-header"},Ld={class:"profile-header__content"},Ad={class:"profile-header__info"},Rd={class:"profile-name"},Dd={class:"profile-modal-body"},Od={class:"profile-media-tabs"},Pd=["onClick"],Nd={class:"profile-media-empty"},Ud={key:2,class:"profile-modal-body"},Fd=se({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:s}){const n=e,i=s,a=Me(),{showToast:o}=xe(),l=y(null),r=y(!0),u=y(!1),b=["Media","Files","Links"],p=y("Media"),v=V(()=>l.value?a.isUserOnline(l.value.id):!1),f=V(()=>{if(v.value)return"online";if(!l.value)return"offline";const m=a.getUserPresence(l.value.id);return m?.lastSeenAt?In(m.lastSeenAt):m?.lastSeenBucket?`last seen ${m.lastSeenBucket}`:"offline"});_e(async()=>{try{l.value=await ks(n.username)}catch{l.value=null}finally{r.value=!1}});function c(){u.value=!u.value,o(u.value?"User muted":"User unmuted")}return(m,g)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:g[2]||(g[2]=ce(T=>i("close"),["self"]))},[t("div",Td,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:g[0]||(g[0]=T=>i("close"))},[U(k(Be),{size:20,"stroke-width":2})]),r.value?(d(),h("div",Ed,[...g[3]||(g[3]=[t("div",{class:"profile-loading"},[t("p",null,"Loading...")],-1)])])):l.value?(d(),h(ie,{key:1},[t("div",Id,[g[4]||(g[4]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",Ld,[U(we,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:v.value,size:"xxl"},null,8,["name","url","online"]),t("div",Ad,[t("div",Rd,[ye(x(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(d(),Y(Un,{key:0})):P("",!0)]),t("div",{class:de(["profile-status",{"profile-status--online":v.value}])},x(f.value),3)])])]),t("div",Dd,[U(xd,{muted:u.value,"show-more":!1,onMessage:g[1]||(g[1]=T=>i("message",l.value.username)),onMute:c},null,8,["muted"]),g[5]||(g[5]=t("div",{class:"profile-divider"},null,-1)),U(zs,{username:l.value.username,bio:l.value.bio,"user-id":l.value.id},null,8,["username","bio","user-id"]),t("div",Od,[(d(),h(ie,null,he(b,T=>t("button",{key:T,class:de(["profile-media-tab",{"profile-media-tab--active":p.value===T}]),onClick:C=>p.value=T},x(T),11,Pd)),64))]),t("div",Nd,[U(k(Ms),{size:32,"stroke-width":1.5}),t("span",null,"No "+x(p.value.toLowerCase())+" yet",1)])])],64)):(d(),h("div",Ud,[...g[6]||(g[6]=[t("div",{class:"profile-loading"},[t("p",null,"User not found")],-1)])]))])]))}}),zd=fe(Fd,[["__scopeId","data-v-1e27c432"]]),Bd={class:"modal",style:{"max-width":"420px"}},Hd={class:"modal-header"},jd={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},Vd=se({__name:"DownloadModal",emits:["close"],setup(e,{emit:s}){const n=s,i=navigator.userAgent.toLowerCase(),a=i.includes("win"),o=i.includes("mac")&&!i.includes("iphone")&&!i.includes("ipad"),l=V(()=>a?"Windows":o?"macOS":null);function r(){a?window.location.href="/downloads/windows/BeHappySetup.exe":o&&(window.location.href="/downloads/macos/BeHappy.dmg")}return(u,b)=>(d(),h("div",{class:"modal-backdrop",onClick:b[1]||(b[1]=ce(p=>n("close"),["self"]))},[t("div",Bd,[t("div",Hd,[b[2]||(b[2]=t("h2",{class:"modal-title"},"Download BeHappy",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:b[0]||(b[0]=p=>n("close"))},[U(k(Be),{size:20})])]),t("div",jd,[l.value?(d(),h("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+x(l.value),1)):P("",!0),b[3]||(b[3]=da('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/BeHappySetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/BeHappy.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),Wd={class:"modal",style:{"max-width":"400px"}},qd={class:"modal-header"},Gd={class:"modal-body",style:{"text-align":"center"}},Kd={key:0},Yd={style:{"font-size":"1.25rem","font-weight":"700"}},Jd={style:{color:"var(--text-muted)","margin-top":".5rem"}},Qd={class:"profile-avatar-section"},Xd={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},Zd={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},ev={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},tv={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},nv=["disabled"],sv=se({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:s}){const n=e,i=s,{showToast:a}=xe(),o=y(null),l=y(!0),r=y(!1),u=y(""),b=y("");_e(async()=>{if(!n.token){u.value="Invalid Link",b.value="No invite token provided.",l.value=!1;return}try{o.value=await ga(n.token)}catch(v){v.response?.status===410?(u.value="Invite Revoked",b.value="This invite link has been revoked."):(u.value="Invite Not Found",b.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function p(){r.value=!0;try{const v=await ya(n.token);a(v.already_member?"You are already a member":"Joined successfully!"),i("joined",v.chat_id)}catch(v){a(v.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(v,f)=>(d(),h("div",{class:"modal-backdrop",onClick:f[2]||(f[2]=ce(c=>i("close"),["self"]))},[t("div",Wd,[t("div",qd,[f[3]||(f[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:f[0]||(f[0]=c=>i("close"))},"âœ•")]),t("div",Gd,[l.value?(d(),h("p",Kd,"Loading invite preview...")):b.value?(d(),h(ie,{key:1},[t("h2",Yd,x(u.value),1),t("p",Jd,x(b.value),1)],64)):o.value?(d(),h(ie,{key:2},[t("div",Qd,[U(we,{name:o.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",Xd,x(o.value.title||o.value.type||"Chat"),1),o.value.description?(d(),h("p",Zd,x(o.value.description),1)):P("",!0),o.value.member_count?(d(),h("p",ev,x(o.value.member_count)+" members ",1)):P("",!0),t("div",tv,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:p},x(r.value?"Joining...":"Join"),9,nv),t("button",{class:"btn btn-ghost",onClick:f[1]||(f[1]=c=>i("close"))},"Cancel")])],64)):P("",!0)])])]))}}),av={class:"modal modal-wide settings-modal"},iv={class:"modal-header"},ov={class:"modal-body"},lv={class:"settings-profile-header"},rv={class:"settings-profile-info"},cv={class:"settings-display-name"},uv={class:"settings-username"},dv={class:"settings-group"},vv={class:"settings-section-title"},mv={class:"menu-item menu-item--setting"},fv={class:"settings-group"},pv={class:"settings-section-title"},hv=["aria-checked"],gv={class:"settings-group"},yv={class:"settings-section-title"},bv={class:"menu-item menu-item--setting"},kv={class:"settings-group"},wv={class:"settings-section-title"},_v={class:"menu-item menu-item--setting"},Cv=["aria-checked"],$v={class:"settings-actions"},Sv=se({__name:"SettingsView",emits:["close"],setup(e,{emit:s}){const n=s,i=Le(),a=pt(),{showToast:o}=xe(),l=y("light"),r=y(!0),u=y("en"),b=y("everyone"),p=y(!0);Oe(r,async f=>{f&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(r.value=!1,o("Notifications blocked by browser"))}),_e(()=>{l.value=a.theme,r.value=a.notificationsEnabled,u.value=a.language,b.value=a.lastSeenVisibility,p.value=a.readReceiptsEnabled});async function v(){try{await a.saveSettings({theme:l.value,notifications_enabled:r.value,language:u.value,last_seen_visibility:b.value,read_receipts_enabled:p.value}),o("Settings saved"),n("close")}catch{o("Failed to save settings")}}return(f,c)=>(d(),h("div",{class:"modal-backdrop",onClick:c[8]||(c[8]=ce(m=>n("close"),["self"]))},[t("div",av,[t("div",iv,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=m=>n("close"))},[U(k(Fe),{size:20,"stroke-width":2})]),c[9]||(c[9]=t("span",{class:"modal-title"},"Settings",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[1]||(c[1]=m=>n("close"))},[U(k(Be),{size:20,"stroke-width":2})])]),t("div",ov,[t("div",lv,[U(we,{name:k(i).user?.display_name||k(i).user?.username||"?",url:k(i).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",rv,[t("div",cv,x(k(i).user?.display_name||k(i).user?.username||"---"),1),t("div",uv,"@"+x(k(i).user?.username||"---"),1)])]),c[24]||(c[24]=t("div",{class:"settings-divider"},null,-1)),t("div",dv,[t("div",vv,[U(k(ss),{size:18,"stroke-width":1.8}),c[10]||(c[10]=t("span",null,"Appearance",-1))]),t("div",mv,[U(k(ss),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[12]||(c[12]=t("span",{class:"menu-item__label"},"Theme",-1)),me(t("select",{"onUpdate:modelValue":c[2]||(c[2]=m=>l.value=m),class:"form-input form-select settings-select"},[...c[11]||(c[11]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[on,l.value]])])]),c[25]||(c[25]=t("div",{class:"settings-divider"},null,-1)),t("div",fv,[t("div",pv,[U(k(es),{size:18,"stroke-width":1.8}),c[13]||(c[13]=t("span",null,"Notifications",-1))]),t("div",{class:"menu-item menu-item--toggle",onClick:c[3]||(c[3]=m=>r.value=!r.value)},[U(k(es),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[15]||(c[15]=t("span",{class:"menu-item__label"},"Notifications",-1)),t("span",{class:de(["toggle-status",{"toggle-status--on":r.value}])},x(r.value?"Enabled":"Disabled"),3),t("span",{class:de(["toggle-switch",{"toggle-switch--on":r.value}]),role:"switch","aria-checked":r.value},[...c[14]||(c[14]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,hv)])]),c[26]||(c[26]=t("div",{class:"settings-divider"},null,-1)),t("div",gv,[t("div",yv,[U(k(ns),{size:18,"stroke-width":1.8}),c[16]||(c[16]=t("span",null,"Language",-1))]),t("div",bv,[U(k(ns),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[18]||(c[18]=t("span",{class:"menu-item__label"},"Language",-1)),me(t("select",{"onUpdate:modelValue":c[4]||(c[4]=m=>u.value=m),class:"form-input form-select settings-select"},[...c[17]||(c[17]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[on,u.value]])])]),c[27]||(c[27]=t("div",{class:"settings-divider"},null,-1)),t("div",kv,[t("div",wv,[U(k(ln),{size:18,"stroke-width":1.8}),c[19]||(c[19]=t("span",null,"Privacy",-1))]),t("div",_v,[(d(),Y(ze(b.value==="nobody"?k(ts):k(ln)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[21]||(c[21]=t("span",{class:"menu-item__label"},"Last Seen & Online",-1)),me(t("select",{"onUpdate:modelValue":c[5]||(c[5]=m=>b.value=m),class:"form-input form-select settings-select"},[...c[20]||(c[20]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[on,b.value]])]),t("div",{class:"menu-item menu-item--toggle",onClick:c[6]||(c[6]=m=>p.value=!p.value)},[(d(),Y(ze(p.value?k(ln):k(ts)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[23]||(c[23]=t("span",{class:"menu-item__label"},"Read Receipts",-1)),t("span",{class:de(["toggle-status",{"toggle-status--on":p.value}])},x(p.value?"Enabled":"Disabled"),3),t("span",{class:de(["toggle-switch",{"toggle-switch--on":p.value}]),role:"switch","aria-checked":p.value},[...c[22]||(c[22]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Cv)])]),c[28]||(c[28]=t("div",{class:"settings-divider"},null,-1)),t("div",$v,[t("button",{class:"btn btn-primary",onClick:v},"Save Settings"),t("button",{class:"btn btn-ghost",onClick:c[7]||(c[7]=m=>n("close"))},"Cancel")])])])]))}}),Mv=fe(Sv,[["__scopeId","data-v-3b2634a6"]]),xv=se({__name:"ContextMenu",setup(e){const s=Me(),{showToast:n}=xe(),{showConfirm:i}=va(),a=y(!1),o=y(0),l=y(0),r=y(null),u=V(()=>r.value?s.chats.find(g=>g.id===r.value)??null:null);function b(g){r.value=g.detail.chatId,o.value=g.detail.x,l.value=g.detail.y,a.value=!0}function p(){a.value&&(a.value=!1,r.value=null)}_e(()=>{window.addEventListener("show-context-menu",b),document.addEventListener("click",p)}),qe(()=>{window.removeEventListener("show-context-menu",b),document.removeEventListener("click",p)});async function v(){if(r.value){a.value=!1;try{await s.toggleFavorite(r.value)}catch{n("Failed to update favorite")}}}async function f(){if(r.value){a.value=!1;try{await s.toggleMute(r.value)}catch{n("Failed to update mute")}}}async function c(){if(!(!r.value||(a.value=!1,!await i({title:"Leave Chat",message:"Leave this chat?",confirmLabel:"Leave",danger:!0}))))try{await s.leave(r.value),n("Left chat")}catch{n("Failed to leave chat")}}async function m(){if(!(!r.value||(a.value=!1,!await i({title:"Delete Chat",message:"Delete this chat? All messages will be permanently removed.",confirmLabel:"Delete",danger:!0}))))try{await s.deleteChat(r.value),n("Chat deleted")}catch{n("Failed to delete chat")}}return(g,T)=>a.value?(d(),h("div",{key:0,class:"context-menu",style:Ze({left:o.value+"px",top:l.value+"px"})},[t("button",{class:"ctx-item",onClick:v},x(u.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:f},x(u.value?.is_muted?"Unmute":"Mute"),1),u.value&&u.value.type!=="direct"?(d(),h("button",{key:0,class:"ctx-item ctx-leave",onClick:c}," Leave chat ")):P("",!0),t("button",{class:"ctx-item ctx-delete",onClick:m}," Delete chat ")],4)):P("",!0)}}),ms=240,Tv=.5,Lv=se({__name:"MessengerView",setup(e){const s=ma(),n=hs(),i=Le(),a=Me(),o=pt(),l=Ke(),{showToast:r}=xe(),{connect:u,disconnect:b,sendTyping:p}=qa();it("sendTyping",p);const v=y(!1),f=y(!1),c=y("select"),m=y(!1),g=y(!1),T=y(!1),C=y(null),_=y(null),D=y([]),F=y(null);it("stickers",D),it("pendingScrollMessageId",F);let z=null;_e(async()=>{await o.loadSettings();try{D.value=await Ya()}catch{}await a.loadChats(),u(),z=setInterval(()=>a.loadChats(),5e3),N()}),qe(()=>{b(),z&&(clearInterval(z),z=null)}),Oe(()=>s.path,()=>{N()}),Oe(()=>a.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function N(){const K=s.path;if(K.startsWith("/@")){const $=s.params.username;$&&(C.value=$)}else if(K.startsWith("/u/")){const $=s.params.id;if($)try{const G=await bs(parseInt($));C.value=G.username}catch{r("User not found")}}else if(K.startsWith("/dm/")){const $=s.params.id;$&&await ne($)}else if(K.startsWith("/c/")){const $=s.params.chatIdOrName||s.params.name,G=s.params.messageId?parseInt(s.params.messageId):null;if($)if(/^\d+$/.test($)){const le=parseInt($);G?await E(le,G):a.setActiveChat(le)}else await re($)}}async function ne(K){try{let $;if(K.startsWith("@")){const Z=K.substring(1);$=(await ks(Z)).id}else $=parseInt(K);const G=await ot({type:"direct",member_ids:[$]});await a.loadChats(),a.setActiveChat(G.id)}catch{r("Failed to open conversation")}}async function re(K){try{const $=await ka(K);a.chats.find(Z=>Z.id===$.id)?a.setActiveChat($.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function E(K,$){if(!a.chats.find(Z=>Z.id===K)){r("Chat not found");return}a.setActiveChat(K),await $e(),F.value=$}const M=parseInt(localStorage.getItem("sidebar-width")||"360",10);M>=ms&&document.documentElement.style.setProperty("--sidebar-width",M+"px");function B(K){K.preventDefault();const $=K.currentTarget;$.setPointerCapture(K.pointerId);const G=le=>{const Ce=window.innerWidth*Tv,Te=Math.min(Ce,Math.max(ms,le.clientX));document.documentElement.style.setProperty("--sidebar-width",Te+"px")},Z=()=>{$.removeEventListener("pointermove",G),$.removeEventListener("pointerup",Z);const le=getComputedStyle(document.documentElement).getPropertyValue("--sidebar-width").trim();localStorage.setItem("sidebar-width",parseInt(le,10).toString())};$.addEventListener("pointermove",G),$.addEventListener("pointerup",Z)}function J(K){a.setActiveChat(K),n.replace("/app")}function W(){a.setActiveChat(null)}function I(){v.value=!1,m.value=!0}function j(){v.value=!1,g.value=!0}function oe(){v.value=!1,c.value="group",f.value=!0}function be(){v.value=!1,c.value="channel",f.value=!0}async function S(){if(v.value=!1,!!i.user)try{const K=await ot({type:"direct",member_ids:[i.user.id]});await a.loadChats(),a.setActiveChat(K.id)}catch{r("Failed to open Saved Messages")}}function A(K){C.value=K}async function q(K){C.value=null,await ne("@"+K)}async function H(K){f.value=!1,await a.loadChats(),a.setActiveChat(K)}async function ee(K){_.value=null,await a.loadChats(),a.setActiveChat(K)}function ue(K){const $=K.target?.closest("a");if(!$)return;const G=$.getAttribute("href");if(!G)return;let Z;try{Z=new URL(G,window.location.origin)}catch{return}if(Z.origin!==window.location.origin){K.preventDefault(),K.stopPropagation(),window.open(Z.href,"_blank");return}K.preventDefault(),K.stopPropagation();const le=Z.pathname,Ce=le.match(/^\/join\/([^/]+)$/);if(Ce){_.value=Ce[1]??null;return}if(le.startsWith("/@")||le.startsWith("/u/")||le.startsWith("/dm/")||le.startsWith("/c/")){n.push(le);return}n.push(le)}function ve(K){if(K.key==="Escape"){if(_.value){_.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if(C.value){C.value=null;return}if(f.value){f.value=!1;return}if(m.value){m.value=!1;return}if(g.value){g.value=!1;return}if(T.value){T.value=!1;return}if(v.value){v.value=!1;return}if(a.activeChatId!==null){W();return}}}return _e(()=>{document.addEventListener("keydown",ve),document.addEventListener("click",ue,!0)}),qe(()=>{document.removeEventListener("keydown",ve),document.removeEventListener("click",ue,!0)}),(K,$)=>(d(),h("div",{class:de(["layout",{"chat-open":!!k(a).activeChatId}])},[U(uu,{open:v.value,onClose:$[0]||($[0]=G=>v.value=!1),onOpenProfile:I,onOpenSettings:j,onOpenNewGroup:oe,onOpenNewChannel:be,onOpenFavorites:S,onOpenDownload:$[1]||($[1]=G=>T.value=!0)},null,8,["open"]),t("div",{class:de(["drawer-overlay",{visible:v.value}]),onClick:$[2]||($[2]=G=>v.value=!1)},null,2),U(Ni,{onOpenDrawer:$[3]||($[3]=G=>v.value=!0),onOpenNewChat:$[4]||($[4]=G=>{c.value="select",f.value=!0}),onSelectChat:J}),t("div",{class:"resize-handle",onPointerdown:B},null,32),U(Wc,{onBack:W,onOpenUserProfile:A}),f.value?(d(),Y(Bu,{key:0,"initial-step":c.value,onClose:$[5]||($[5]=G=>f.value=!1),onChatCreated:H},null,8,["initial-step"])):P("",!0),m.value?(d(),Y(wd,{key:1,onClose:$[6]||($[6]=G=>m.value=!1)})):P("",!0),g.value?(d(),Y(Mv,{key:2,onClose:$[7]||($[7]=G=>g.value=!1)})):P("",!0),C.value?(d(),Y(zd,{key:3,username:C.value,onClose:$[8]||($[8]=G=>C.value=null),onMessage:q},null,8,["username"])):P("",!0),T.value?(d(),Y(Vd,{key:4,onClose:$[9]||($[9]=G=>T.value=!1)})):P("",!0),_.value?(d(),Y(sv,{key:5,token:_.value,onClose:$[10]||($[10]=G=>_.value=null),onJoined:ee},null,8,["token"])):P("",!0),U(xv)],2))}});export{Lv as default};
