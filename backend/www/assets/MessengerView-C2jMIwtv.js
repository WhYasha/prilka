import{l as J,m as tt,r as y,p as V,q as da,s as Ge,u as Le,x as gn,d as ae,o as d,c as h,a as t,t as x,w as ce,y as nt,n as ue,h as z,b as k,z as Y,e as N,g as ke,f as me,v as be,F as oe,A as ye,B as lt,C as Oe,D as et,E as va,G as Ce,H as yn,I as Se,T as gs,J as Te,i as en,K as xn,L as ys,M as ma,N as Xn,O as Qn,P as ze,k as bs,Q as fa,R as rn,S as pa,U as ha}from"./index-CdteRl7k.js";import{_ as _e,l as ga,c as ya,r as ba,p as ka,j as wa}from"./invites-Bge7QQZO.js";async function _a(){const{data:e}=await J.get("/chats");return e}async function ks(e){const{data:s}=await J.get(`/chats/${e}`);return s}async function Ca(e){const{data:s}=await J.get(`/chats/by-name/${encodeURIComponent(e)}`);return s}async function rt(e){const{data:s}=await J.post("/chats",e);return s}async function $a(e){await J.post(`/chats/${e}/favorite`)}async function Sa(e){await J.delete(`/chats/${e}/favorite`)}async function Ma(e,s){await J.post(`/chats/${e}/mute`,{})}async function xa(e){await J.delete(`/chats/${e}/mute`)}async function Ta(e){await J.delete(`/chats/${e}/leave`)}async function ws(e){await J.post(`/chats/${e}/read`)}async function Ea(e){await J.post(`/chats/${e}/pin`)}async function Ia(e){await J.delete(`/chats/${e}/pin`)}async function La(e){await J.post(`/chats/${e}/archive`)}async function Aa(e){await J.delete(`/chats/${e}/archive`)}async function Ra(e){const{data:s}=await J.get(`/chats/${e}`);return s.members??[]}async function _s(e){await J.delete(`/chats/${e}`)}async function Da(e,s){const{data:n}=await J.patch(`/chats/${e}`,s);return n}async function Oa(e){const{data:s}=await J.get(`/chats/${e}/read-receipts`);return s}const xe=tt("chats",()=>{const e=y([]),s=y(null),n=y({}),i=y(new Set),a=y({}),o=V(()=>e.value.find(E=>E.id===s.value)??null),l=V(()=>[...e.value].sort((E,S)=>{if(E.is_pinned&&!S.is_pinned)return-1;if(!E.is_pinned&&S.is_pinned)return 1;if(E.is_favorite&&!S.is_favorite)return-1;if(!E.is_favorite&&S.is_favorite)return 1;const B=E.last_at||E.updated_at||"";return(S.last_at||S.updated_at||"").localeCompare(B)}));async function r(){try{e.value=await _a()}catch(E){console.error("Failed to load chats",E)}}function u(E){if(s.value=E,E!==null){const S=e.value.find(B=>B.id===E);S&&(S.unread_count=0,ws(E).catch(()=>{}))}}async function b(E){const S=e.value.find(B=>B.id===E);if(S)try{S.is_favorite?await Sa(E):await $a(E),S.is_favorite=!S.is_favorite}catch(B){throw console.error("Failed to toggle favorite",B),B}}async function p(E){const S=e.value.find(B=>B.id===E);if(S)try{S.is_muted?await xa(E):await Ma(E),S.is_muted=!S.is_muted}catch(B){throw console.error("Failed to toggle mute",B),B}}async function m(E){const S=e.value.find(B=>B.id===E);if(S)try{S.is_pinned?await Ia(E):await Ea(E),S.is_pinned=!S.is_pinned}catch(B){throw console.error("Failed to toggle pin",B),B}}async function f(E){const S=e.value.find(B=>B.id===E);if(S)try{S.is_archived?await Aa(E):await La(E),S.is_archived=!S.is_archived}catch(B){throw console.error("Failed to toggle archive",B),B}}async function c(E){await Ta(E),e.value=e.value.filter(S=>S.id!==E),s.value===E&&(s.value=null)}async function v(E){await _s(E),e.value=e.value.filter(S=>S.id!==E),s.value===E&&(s.value=null)}function g(E,S,B){const Q=e.value.find(j=>j.id===E);Q&&(Q.last_message=S,Q.last_at=B)}function T(E){const S=e.value.find(B=>B.id===E);S&&(S.unread_count=(S.unread_count||0)+1)}function C(E,S,B){n.value[E]||(n.value[E]={});const Q=n.value[E][S];Q&&clearTimeout(Q.timer);const j=setTimeout(()=>{_(E,S)},3e3);n.value[E][S]={username:B,timer:j}}function _(E,S){if(n.value[E]){const B=n.value[E][S];B&&(clearTimeout(B.timer),delete n.value[E][S])}}function O(E){const S=n.value[E];return S?Object.values(S).map(B=>B.username):[]}function U(E){i.value=new Set([...i.value,E]),a.value={...a.value,[E]:{isOnline:!0}}}function F(E,S,B){const Q=new Set(i.value);Q.delete(E),i.value=Q,a.value={...a.value,[E]:{isOnline:!1,lastSeenAt:S,lastSeenBucket:B}}}function P(E,S){if(S.isOnline)i.value=new Set([...i.value,E]);else{const B=new Set(i.value);B.delete(E),i.value=B}a.value={...a.value,[E]:S}}function Z(E){return a.value[E]}function re(E){return i.value.has(E)}return{chats:e,activeChatId:s,activeChat:o,sortedChats:l,typingUsers:n,loadChats:r,setActiveChat:u,toggleFavorite:b,toggleMute:p,togglePin:m,toggleArchive:f,leave:c,deleteChat:v,updateChatLastMessage:g,incrementUnread:T,setTyping:C,clearTyping:_,getTypingUsernames:O,onlineUsers:i,userPresenceDetails:a,setUserOnline:U,setUserOffline:F,setUserPresence:P,getUserPresence:Z,isUserOnline:re}});async function Pa(){const{data:e}=await J.get("/settings");return e}async function Na(e){await J.put("/settings",e)}const gt=tt("settings",()=>{const e=y(localStorage.getItem("theme")||"light"),s=y(!0),n=y("en"),i=y("everyone"),a=y(!0);function o(u){e.value=u,document.body.setAttribute("data-theme",u),localStorage.setItem("theme",u)}async function l(){try{const u=await Pa();o(u.theme||"light"),s.value=u.notifications_enabled,n.value=u.language||"en",i.value=u.last_seen_visibility||"everyone",a.value=u.read_receipts_enabled!==!1}catch(u){console.error("Failed to load settings",u)}}async function r(u){await Na(u),u.theme&&o(u.theme),u.notifications_enabled!==void 0&&(s.value=u.notifications_enabled),u.language&&(n.value=u.language),u.last_seen_visibility&&(i.value=u.last_seen_visibility),u.read_receipts_enabled!==void 0&&(a.value=u.read_receipts_enabled)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:s,language:n,lastSeenVisibility:i,readReceiptsEnabled:a,applyTheme:o,loadSettings:l,saveSettings:r}}),Xe=tt("selection",()=>{const e=y(new Set),s=y(!1),n=y(null),i=V(()=>e.value.size);function a(p,m){s.value=!0,n.value=p,e.value=new Set(m!=null?[m]:[])}function o(){s.value=!1,n.value=null,e.value=new Set}function l(p){const m=new Set(e.value);m.has(p)?m.delete(p):m.add(p),e.value=m,m.size===0&&o()}function r(p){if(!s.value||e.value.has(p))return;const m=new Set(e.value);m.add(p),e.value=m}function u(){e.value=new Set}function b(p){return e.value.has(p)}return{selectedMessageIds:e,selectionMode:s,currentChatId:n,selectedCount:i,enterSelectionMode:a,exitSelectionMode:o,toggleMessage:l,addMessage:r,clearSelection:u,isSelected:b}});async function St(e,s){const{data:n}=await J.get(`/chats/${e}/messages`,{params:s});return n}async function Ua(e,s){const{data:n}=await J.post(`/chats/${e}/messages`,s);return n}async function Fa(e,s,n=!1){await J.delete(`/chats/${e}/messages/${s}`,n?{data:{for_everyone:!0}}:void 0)}async function za(e,s,n){const{data:i}=await J.put(`/chats/${e}/messages/${s}`,{content:n});return i}async function Ba(e,s){const{data:n}=await J.post(`/chats/${e}/messages/forward`,s);return n}async function Ha(e,s){const{data:n}=await J.post(`/chats/${e}/messages/${s}/pin`);return n}async function ja(e,s){await J.delete(`/chats/${e}/messages/${s}/pin`)}async function Va(e){const{data:s}=await J.get(`/chats/${e}/pinned-message`);return s}async function Zn(e,s,n){const{data:i}=await J.get(`/chats/${e}/messages/search`,{params:{q:s,...n}});return i}async function Wa(e,s,n){const{data:i}=await J.post(`/chats/${e}/messages/${s}/reactions`,{emoji:n});return i}async function qa(e,s){if(!s.length)return{};const{data:n}=await J.get(`/chats/${e}/reactions`,{params:{message_ids:s.join(",")}});return n}const yt=tt("messages",()=>{const e=y({}),s=y({}),n=y(null),i=y({}),a=y(new Set),o=da(new Set);function l(M){return o.add(M),new Promise(D=>setTimeout(D,600))}function r(M){return o.has(M)}async function u(M){const D=e.value[M];if(!D||D.length===0)return;const q=D.map(H=>H.id);try{const H=await qa(M,q);for(const se of D)se.reactions=H[String(se.id)]||void 0}catch(H){console.error("Failed to load reactions",H)}}async function b(M){n.value=M;try{const D=await St(M,{limit:50});e.value[M]=D,D.length>0&&(s.value[M]=Math.max(...D.map(q=>q.id))),await u(M)}catch(D){throw console.error("Failed to load messages",D),D}finally{n.value=null}}async function p(M){const D=s.value[M]||0;if(D===0)return[];try{const q=await St(M,{after_id:D,limit:50});if(q.length>0){e.value[M]||(e.value[M]=[]);const H=new Set(e.value[M].map(ie=>ie.id)),se=q.filter(ie=>!H.has(ie.id));e.value[M].push(...se),s.value[M]=Math.max(...q.map(ie=>ie.id)),await u(M)}return q}catch(q){return console.error("Failed to load newer messages",q),[]}}async function m(M){const D=e.value[M];if(!D||D.length===0)return[];const q=D[0];if(!q)return[];try{const H=await St(M,{before:q.created_at,limit:50});if(H.length>0){const se=new Set(D.map(de=>de.id)),ie=H.filter(de=>!se.has(de.id));e.value[M]=[...ie,...D],await u(M)}return H}catch(H){return console.error("Failed to load older messages",H),[]}}async function f(M,D,q){try{const H=await Wa(M,D,q);c(M,D,H.action,q,!0)}catch(H){console.error("Failed to toggle reaction",H)}}function c(M,D,q,H,se){const ie=e.value[M];if(!ie)return;const de=ie.find($=>$.id===D);if(!de)return;de.reactions||(de.reactions=[]);const K=de.reactions.find($=>$.emoji===H);q==="added"?K?(K.count++,se&&(K.me=!0)):de.reactions.push({emoji:H,count:1,me:se}):K&&(K.count--,se&&(K.me=!1),K.count<=0&&(de.reactions=de.reactions.filter($=>$.emoji!==H))),de.reactions.length===0&&(de.reactions=void 0)}async function v(M,D,q="text",H){const se=await Ua(M,{content:D,type:q,...H});e.value[M]||(e.value[M]=[]),g(M,se);const ie=e.value[M].findIndex(de=>de.id===se.id);return ie!==-1?e.value[M][ie]=se:e.value[M].push(se),s.value[M]=Math.max(s.value[M]||0,se.id),se}function g(M,D){if(!D.reply_to_message_id||D.reply_to_sender_username||D.reply_to_sender_name)return;const q=e.value[M];if(!q)return;const H=q.find(se=>se.id===D.reply_to_message_id);H&&(D.reply_to_sender_username=H.sender_username,D.reply_to_sender_name=H.sender_display_name||H.sender_username,!D.reply_to_content&&H.content&&(D.reply_to_content=H.content),!D.reply_to_type&&H.message_type&&(D.reply_to_type=H.message_type))}function T(M,D){e.value[M]||(e.value[M]=[]),e.value[M].find(H=>H.id===D.id)||(g(M,D),e.value[M].push(D),s.value[M]=Math.max(s.value[M]||0,D.id))}async function C(M,D,q=!1){try{await l(D),await Fa(M,D,q),_(M,D)}catch(H){throw console.error("Failed to delete message",H),H}finally{o.delete(D)}}function _(M,D){const q=e.value[M];q&&(e.value[M]=q.filter(H=>H.id!==D))}async function O(M,D,q){try{const H=await za(M,D,q);U(M,D,H.content,H.updated_at)}catch(H){throw console.error("Failed to edit message",H),H}}function U(M,D,q,H){const se=e.value[M];if(!se)return;const ie=se.find(de=>de.id===D);ie&&(ie.content=q,ie.is_edited=!0,H&&(ie.updated_at=H))}async function F(M,D,q){try{const H=await Ba(M,{from_chat_id:D,message_ids:q});for(const se of H)T(M,se);return H}catch(H){throw console.error("Failed to forward messages",H),H}}async function P(M){try{const D=await Va(M);D&&D.message?i.value[M]={message:D.message,pinnedAt:D.pinned_at,pinnedBy:D.pinned_by}:i.value[M]=null}catch(D){console.error("Failed to load pinned message",D),i.value[M]=null}}async function Z(M,D){try{const q=await Ha(M,D);i.value[M]={message:q.message,pinnedAt:q.pinned_at,pinnedBy:q.pinned_by},a.value.delete(M)}catch(q){throw console.error("Failed to pin message",q),q}}async function re(M,D){try{await ja(M,D),i.value[M]=null}catch(q){throw console.error("Failed to unpin message",q),q}}function E(M,D,q,H){i.value[M]={message:H,pinnedAt:new Date().toISOString(),pinnedBy:q},a.value.delete(M)}function S(M){i.value[M]=null}function B(M){a.value.add(M)}function Q(M){return e.value[M]||[]}const j=y({});function I(M,D,q){j.value[M]||(j.value[M]={});const H=j.value[M][D]||0;q>H&&(j.value[M][D]=q)}async function W(M){try{const D=await Oa(M);j.value[M]||(j.value[M]={});for(const q of D)j.value[M][q.user_id]=q.last_read_msg_id}catch(D){console.error("Failed to load read receipts",D)}}function ve(M,D,q){const H=j.value[M];return H?q?(H[q]||0)>=D:Object.values(H).some(se=>se>=D):!1}function fe(M,D){const q=j.value[M];return q?Object.values(q).filter(H=>H>=D).length:0}return{messagesByChat:e,lastMsgId:s,loadingChat:n,loadMessages:b,loadNewer:p,loadOlder:m,sendMessage:v,pushMessage:T,getMessages:Q,toggleReaction:f,applyReactionUpdate:c,deleteMessage:C,removeMessage:_,editMessage:O,applyMessageUpdate:U,forwardMessages:F,pinnedByChat:i,pinnedDismissed:a,loadPinnedMessage:P,pinMsg:Z,unpinMsg:re,applyMessagePinned:E,applyMessageUnpinned:S,dismissPin:B,deletingMessages:o,markForDeletion:l,isDeleting:r,readReceipts:j,applyReadReceipt:I,loadReadReceipts:W,isMessageRead:ve,getReadCount:fe}});function Ga(e,s,n){if(!document.hidden||e.sender_id===n.user?.id||!gt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||s.chats.find(u=>u.id===e.chat_id)?.is_muted)return;const o=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(o,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),s.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function Ka(){const e=y(!1);let s=null,n=null,i=null,a=1e3,o=!1,l=null,r=!document.hidden&&document.hasFocus(),u=!1;function b(P){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"presence_update",status:P}))}function p(){const P=!document.hidden&&document.hasFocus();P&&!r?(l&&(clearTimeout(l),l=null),r=!0,b("active")):!P&&r&&(l||(l=setTimeout(()=>{l=null,r=!1,b("away")},3e3)))}function m(){u||(u=!0,document.addEventListener("visibilitychange",p),window.addEventListener("focus",p),window.addEventListener("blur",p))}function f(){u&&(u=!1,document.removeEventListener("visibilitychange",p),window.removeEventListener("focus",p),window.removeEventListener("blur",p),l&&(clearTimeout(l),l=null))}function c(){const P=localStorage.getItem("access_token");return P?`wss://ws.behappy.rest/ws?token=${encodeURIComponent(P)}`:null}function v(){if(s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING))return;const P=c();P&&(o=!1,s=new WebSocket(P),s.onopen=()=>{e.value=!0,a=1e3,r=!document.hidden&&document.hasFocus();const Z=localStorage.getItem("access_token");Z&&s.send(JSON.stringify({type:"auth",token:Z,active:r}));const re=xe();for(const E of re.chats)s.send(JSON.stringify({type:"subscribe",chat_id:E.id}));T(),m()},s.onmessage=Z=>{try{const re=JSON.parse(Z.data);g(re)}catch{}},s.onclose=()=>{e.value=!1,C(),o||_()},s.onerror=()=>{})}function g(P){const Z=yt(),re=xe(),E=Le();switch(P.type){case"message":{const S=P;Z.pushMessage(S.chat_id,S),re.updateChatLastMessage(S.chat_id,S.content||(S.message_type==="sticker"?"Sticker":"Attachment"),S.created_at),S.sender_id!==E.user?.id&&(S.chat_id===re.activeChatId?ws(S.chat_id).catch(()=>{}):re.incrementUnread(S.chat_id)),re.clearTyping(S.chat_id,S.sender_id),Ga(S,re,E);break}case"typing":{const S=P.chat_id,B=P.user_id;if(B!==E.user?.id){const Q=P.username||"Someone";re.setTyping(S,B,Q)}break}case"pong":break;case"presence":{const S=P.user_id,B=P.status,Q=P.last_seen_at,j=P.last_seen_bucket;if(B==="online")re.setUserOnline(S);else if(B==="offline"){const I=Q||new Date().toISOString();re.setUserOffline(S,I,j)}break}case"message_deleted":{const S=P.chat_id,B=P.message_id;Z.removeMessage(S,B);break}case"message_updated":{const S=P.chat_id,B=P.message_id,Q=P.content,j=P.updated_at;Z.applyMessageUpdate(S,B,Q,j);break}case"message_pinned":{const S=P.chat_id,B=P.message_id,Q=P.pinned_by,j=P.message;Z.applyMessagePinned(S,B,Q,j);break}case"message_unpinned":{const S=P.chat_id;Z.applyMessageUnpinned(S);break}case"reaction":{const S=P.chat_id,B=P.message_id,Q=P.user_id,j=P.emoji,I=P.action;Z.applyReactionUpdate(S,B,I,j,Q===E.user?.id);break}case"read_receipt":{const S=P.chat_id,B=P.user_id,Q=P.last_read_msg_id;Z.applyReadReceipt(S,B,Q);break}}}function T(){C(),i=setInterval(()=>{s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},25e3)}function C(){i&&(clearInterval(i),i=null)}function _(){n||(n=setTimeout(()=>{n=null,v(),a=Math.min(a*2,3e4)},a))}function O(P){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"subscribe",chat_id:P}))}function U(P){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"typing",chat_id:P}))}function F(){o=!0,C(),f(),n&&(clearTimeout(n),n=null),s&&(s.close(),s=null),e.value=!1}return Ge(()=>{F()}),{connected:e,connect:v,disconnect:F,subscribeToChat:O,sendTyping:U}}async function Cs(e){const{data:s}=await J.get(`/users/${e}`);return s}async function $s(e){const{data:s}=await J.get(`/users/by-username/${encodeURIComponent(e)}`);return s}async function es(e){const{data:s}=await J.get("/users/search",{params:{q:e}});return s}async function Ya(e,s){const{data:n}=await J.put(`/users/${e}`,s);return n}async function Ja(e){const{data:s}=await J.put("/users/me/avatar",{file_id:e});return s}async function Xa(){const{data:e}=await J.get("/stickers");return e}const Qa=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};const ts=e=>e==="";const Za=(...e)=>e.filter((s,n,i)=>!!s&&s.trim()!==""&&i.indexOf(s)===n).join(" ").trim();const ns=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const ei=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,n,i)=>i?i.toUpperCase():n.toLowerCase());const ti=e=>{const s=ei(e);return s.charAt(0).toUpperCase()+s.slice(1)};var at={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const ni=({name:e,iconNode:s,absoluteStrokeWidth:n,"absolute-stroke-width":i,strokeWidth:a,"stroke-width":o,size:l=at.width,color:r=at.stroke,...u},{slots:b})=>gn("svg",{...at,...u,width:l,height:l,stroke:r,"stroke-width":ts(n)||ts(i)||n===!0||i===!0?Number(a||o||at["stroke-width"])*24/Number(l):a||o||at["stroke-width"],class:Za("lucide",u.class,...e?[`lucide-${ns(ti(e))}-icon`,`lucide-${ns(e)}`]:["lucide-icon"]),...!b.default&&!Qa(u)&&{"aria-hidden":"true"}},[...s.map(p=>gn(...p)),...b.default?[b.default()]:[]]);const te=(e,s)=>(n,{slots:i,attrs:a})=>gn(ni,{...a,...n,iconNode:s,name:e},i);const Fe=te("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const si=te("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);const Ss=te("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const ss=te("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);const ai=te("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const Ms=te("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const xs=te("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const ii=te("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Ts=te("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const oi=te("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const li=te("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const as=te("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const cn=te("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Es=te("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const is=te("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const ri=te("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);const Is=te("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const ci=te("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const ui=te("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const Tn=te("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const En=te("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const di=te("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const vi=te("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const mi=te("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);const fi=te("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const os=te("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);const In=te("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const pi=te("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);const hi=te("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);const gi=te("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const yi=te("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const bi=te("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const ki=te("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const Ls=te("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const As=te("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const tn=te("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const Be=te("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),wi={class:"swipe-actions swipe-actions-left"},_i={class:"chat-item-info"},Ci={class:"chat-item-top"},$i={class:"chat-item-name"},Si={class:"chat-item-time"},Mi={class:"chat-item-bottom"},xi={class:"chat-item-preview"},Ti=["title"],Ei={class:"swipe-actions swipe-actions-right"},ls=70,Ii=ae({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:s}){const n=e,i=xe(),a=Le(),o=V(()=>n.chat.type==="direct"&&!n.chat.other_user_id),l=V(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:i.isUserOnline(n.chat.other_user_id)||null),r=V(()=>(n.chat.unread_count??0)>0),u=s,b=V(()=>{const C=n.chat;return o.value?"Saved Messages":C.type==="channel"||C.type==="group"?C.title||C.name||"Untitled":C.other_display_name||C.other_username||C.title||C.name||"Chat"});function p(C){if(!C)return"";const _=new Date(C.endsWith("Z")?C:C+"Z"),O=new Date;return _.toDateString()===O.toDateString()?_.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):_.toLocaleDateString([],{month:"short",day:"numeric"})}const m=y(0);let f=0,c=!1;function v(C){f=C.touches[0].clientX,c=!0}function g(C){if(!c)return;const _=C.touches[0].clientX-f;m.value=Math.max(-ls,Math.min(ls,_))}function T(){c=!1,m.value=0}return(C,_)=>(d(),h("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:v,onTouchmove:g,onTouchend:T},[t("div",wi,[t("button",{class:"swipe-action swipe-pin",onClick:_[0]||(_[0]=O=>u("togglePin"))},x(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:ue(["chat-item",{active:e.active,"chat-item-unread":r.value}]),style:nt({transform:`translateX(${m.value}px)`}),onClick:_[2]||(_[2]=O=>u("select")),onContextmenu:_[3]||(_[3]=ce(O=>u("contextmenu",O),["prevent"]))},[z(_e,{name:b.value,url:o.value?k(a).user?.avatar_url||null:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"md",online:l.value},null,8,["name","url","online"]),t("div",_i,[t("div",Ci,[t("span",$i,[e.chat.type==="channel"?(d(),Y(k(En),{key:0,class:"chat-type-icon",size:14,"stroke-width":2})):e.chat.type==="group"?(d(),Y(k(tn),{key:1,class:"chat-type-icon",size:14,"stroke-width":2})):N("",!0),ke(" "+x(b.value)+" ",1),e.chat.is_pinned?(d(),Y(k(pi),{key:2,class:"status-icon",size:14,"stroke-width":1.8,title:"Pinned"})):N("",!0),e.chat.is_muted?(d(),Y(k(Ss),{key:3,class:"status-icon status-icon-muted",size:14,"stroke-width":1.8,title:"Muted"})):N("",!0)]),t("span",Si,x(p(e.chat.last_at||e.chat.updated_at)),1)]),t("div",Mi,[t("span",xi,x(e.chat.last_message||""),1),e.chat.unread_count>0?(d(),h("span",{key:0,class:ue(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},x(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):N("",!0)])]),t("button",{class:ue(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:_[1]||(_[1]=ce(O=>u("toggleFavorite"),["stop"]))},"â˜…",10,Ti)],38),t("div",Ei,[t("button",{class:"swipe-action swipe-mute",onClick:_[4]||(_[4]=O=>u("toggleMute"))},x(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),pe=(e,s)=>{const n=e.__vccOpts||e;for(const[i,a]of s)n[i]=a;return n},un=pe(Ii,[["__scopeId","data-v-e3cb05e4"]]),Li={class:"sidebar"},Ai={class:"sidebar-header"},Ri={class:"search-wrap"},Di={class:"chat-list"},Oi={key:0,class:"empty-state-small"},Pi={key:0,class:"chat-section-label"},Ni={key:1,class:"chat-section-label"},Ui={key:2,class:"chat-section-label"},Fi=ae({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:s}){const n=s,i=xe(),a=y(""),o=V(()=>{const f=a.value.toLowerCase(),c=i.sortedChats.filter(v=>!v.is_archived);return f?c.filter(v=>{const g=b(v).toLowerCase(),T=(v.other_username||"").toLowerCase();return g.includes(f)||T.includes(f)}):c}),l=V(()=>o.value.filter(f=>f.is_pinned&&!f.is_favorite)),r=V(()=>o.value.filter(f=>f.is_favorite&&!f.is_pinned)),u=V(()=>o.value.filter(f=>!f.is_favorite&&!f.is_pinned));function b(f){return f.type==="channel"||f.type==="group"?f.title||f.name||"Untitled":f.type==="direct"&&!f.other_user_id?"Saved Messages":f.other_display_name||f.other_username||f.title||f.name||"Chat"}const p=y(null);lt("contextChatId",p);function m(f,c){f.preventDefault(),p.value=c,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:f.clientX,y:f.clientY,chatId:c}}))}return(f,c)=>(d(),h("aside",Li,[t("header",Ai,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:c[0]||(c[0]=v=>n("openDrawer"))},[z(k(di),{size:20})]),t("div",Ri,[z(k(hi),{size:16,class:"search-icon"}),me(t("input",{"onUpdate:modelValue":c[1]||(c[1]=v=>a.value=v),class:"search-input",type:"search",placeholder:"Search"},null,512),[[be,a.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:c[2]||(c[2]=v=>n("openNewChat"))},[z(k(bi),{size:20})])]),t("div",Di,[o.value.length===0?(d(),h("div",Oi,[...c[3]||(c[3]=[ke(" No conversations yet.",-1),t("br",null,null,-1),ke("Click the pencil icon to start one. ",-1)])])):(d(),h(oe,{key:1},[l.value.length>0?(d(),h("div",Pi,"Pinned")):N("",!0),(d(!0),h(oe,null,ye(l.value,v=>(d(),Y(un,{key:v.id,chat:v,active:v.id===k(i).activeChatId,onSelect:g=>n("selectChat",v.id),onToggleFavorite:g=>k(i).toggleFavorite(v.id),onTogglePin:g=>k(i).togglePin(v.id),onToggleMute:g=>k(i).toggleMute(v.id),onToggleArchive:g=>k(i).toggleArchive(v.id),onContextmenu:g=>m(g,v.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(d(),h("div",Ni,"Starred")):N("",!0),(d(!0),h(oe,null,ye(r.value,v=>(d(),Y(un,{key:v.id,chat:v,active:v.id===k(i).activeChatId,onSelect:g=>n("selectChat",v.id),onToggleFavorite:g=>k(i).toggleFavorite(v.id),onTogglePin:g=>k(i).togglePin(v.id),onToggleMute:g=>k(i).toggleMute(v.id),onToggleArchive:g=>k(i).toggleArchive(v.id),onContextmenu:g=>m(g,v.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&u.value.length>0?(d(),h("div",Ui," All chats ")):N("",!0),(d(!0),h(oe,null,ye(u.value,v=>(d(),Y(un,{key:v.id,chat:v,active:v.id===k(i).activeChatId,onSelect:g=>n("selectChat",v.id),onToggleFavorite:g=>k(i).toggleFavorite(v.id),onTogglePin:g=>k(i).togglePin(v.id),onToggleMute:g=>k(i).toggleMute(v.id),onToggleArchive:g=>k(i).toggleArchive(v.id),onContextmenu:g=>m(g,v.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function zi(){const e=y(!1),s=y(0);let n=null,i=[],a=null;async function o(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const p=await navigator.mediaDevices.getUserMedia({audio:!0});i=[],s.value=0,n=new MediaRecorder(p),n.ondataavailable=m=>{m.data.size&&i.push(m.data)},n.start(),e.value=!0,a=setInterval(()=>{s.value++},1e3)}function l(){return new Promise((p,m)=>{if(!n||n.state!=="recording"){m(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(T=>T.stop()),u(),e.value=!1;const f=n?.mimeType||"audio/webm",c=f.includes("ogg")?"ogg":"webm",v=new Blob(i,{type:f}),g=new File([v],`voice.${c}`,{type:f});p(g)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(p=>p.stop())},n.stop()),u(),e.value=!1,s.value=0}function u(){a&&(clearInterval(a),a=null)}function b(p){const m=Math.floor(p/60),f=p%60;return`${m}:${String(f).padStart(2,"0")}`}return{isRecording:e,seconds:s,startRecording:o,stopRecording:l,cancelRecording:r,formatTime:b}}async function Ln(e){const s=new FormData;s.append("file",e);const{data:n}=await J.post("/files",s);return n}const Bi={class:"pin-bar-content"},Hi={class:"pin-bar-sender"},ji={class:"pin-bar-text"},Vi=ae({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const s=e,n=V(()=>s.message.sender_display_name||s.message.sender_username||"Unknown"),i=V(()=>{const a=s.message;switch(a.message_type){case"sticker":return a.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return a.content||""}});return(a,o)=>(d(),h("div",{class:"pin-bar",onClick:o[1]||(o[1]=l=>a.$emit("click"))},[o[2]||(o[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",Bi,[t("span",Hi,x(n.value),1),t("span",ji,x(i.value),1)]),t("button",{class:"pin-bar-close",onClick:o[0]||(o[0]=ce(l=>a.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}});function An(e){const s=new Date(e),i=new Date().getTime()-s.getTime(),a=Math.floor(i/1e3),o=Math.floor(a/60),l=Math.floor(o/60),r=Math.floor(l/24);if(o<1)return"last seen just now";if(o<60)return`last seen ${o} minute${o!==1?"s":""} ago`;if(l<24)return`last seen ${l} hour${l!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const u=s.toLocaleString("en",{month:"short"}),b=s.getDate();return`last seen ${u} ${b}`}const Wi={class:"chat-header"},qi={class:"chat-header-name"},Gi={key:0,class:"typing-dots"},Ki=ae({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:s}){const n=s,i=xe(),a=Le(),o=V(()=>i.activeChat),l=V(()=>{const v=o.value;return v?.type==="direct"&&!v.other_user_id}),r=V(()=>{const v=o.value;return v?l.value?"Saved Messages":v.type==="channel"||v.type==="group"?v.title||v.name||"Untitled":v.other_display_name||v.other_username||v.title||v.name||"Chat":"---"}),u=V(()=>{const v=o.value;if(v)return l.value?a.user?.avatar_url:v.type==="direct"?v.other_avatar_url:v.avatar_url}),b=V(()=>o.value?i.getTypingUsernames(o.value.id):[]),p=V(()=>b.value.length>0),m=V(()=>{const v=o.value;return!v||v.type!=="direct"||!v.other_user_id?!1:i.isUserOnline(v.other_user_id)}),f=V(()=>{if(b.value.length===1)return`${b.value[0]} is typing`;if(b.value.length>1)return`${b.value.length} people typing`;const v=o.value;if(!v)return"";if(l.value)return"personal storage";if(v.type==="channel"){const g=v.member_count??0;return`${g} subscriber${g!==1?"s":""}`}if(v.type==="group"){const g=v.member_count??0;return`${g} member${g!==1?"s":""}`}if(m.value)return"online";if(v.type==="direct"&&v.other_user_id){const g=i.getUserPresence(v.other_user_id);if(g){if(g.lastSeenAt)return An(g.lastSeenAt);if(g.lastSeenBucket)return`last seen ${g.lastSeenBucket}`}}return v.other_username?"@"+v.other_username:""});Oe(()=>o.value?.id,()=>{const v=o.value;if(!v||v.type!=="direct"||!v.other_user_id)return;const g=v.other_user_id;i.getUserPresence(g)||Cs(g).then(T=>{T.last_activity&&i.setUserPresence(g,{isOnline:i.isUserOnline(g),lastSeenAt:T.last_activity})}).catch(()=>{})},{immediate:!0});function c(){const v=o.value;v&&(v.type==="channel"||v.type==="group"?n("openChannelInfo"):v.type==="direct"&&v.other_username&&n("openUserProfile",v.other_username))}return(v,g)=>(d(),h("header",Wi,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:g[0]||(g[0]=T=>n("back"))},"â†"),z(_e,{class:"chat-header-avatar",name:r.value,url:u.value,online:m.value,size:"sm",onClick:c},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:c},[t("div",qi,x(r.value),1),f.value?(d(),h("div",{key:0,class:ue(["chat-header-sub",{"typing-text":p.value,"online-text":m.value&&!p.value}])},[ke(x(f.value),1),p.value?(d(),h("span",Gi,[...g[2]||(g[2]=[t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1)])])):N("",!0)],2)):N("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:g[1]||(g[1]=T=>n("openSearch"))},"ğŸ”")]))}}),Yi=pe(Ki,[["__scopeId","data-v-16a49ec4"]]),Ji="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Xi="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",bn="numeric",kn="ascii",wn="alpha",ct="asciinumeric",ot="alphanumeric",_n="domain",Rs="emoji",Qi="scheme",Zi="slashscheme",dn="whitespace";function eo(e,s){return e in s||(s[e]=[]),s[e]}function Je(e,s,n){s[bn]&&(s[ct]=!0,s[ot]=!0),s[kn]&&(s[ct]=!0,s[wn]=!0),s[ct]&&(s[ot]=!0),s[wn]&&(s[ot]=!0),s[ot]&&(s[_n]=!0),s[Rs]&&(s[_n]=!0);for(const i in s){const a=eo(i,n);a.indexOf(e)<0&&a.push(e)}}function to(e,s){const n={};for(const i in s)s[i].indexOf(e)>=0&&(n[i]=!0);return n}function Me(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}Me.groups={};Me.prototype={accepts(){return!!this.t},go(e){const s=this,n=s.j[e];if(n)return n;for(let i=0;i<s.jr.length;i++){const a=s.jr[i][0],o=s.jr[i][1];if(o&&a.test(e))return o}return s.jd},has(e,s=!1){return s?e in this.j:!!this.go(e)},ta(e,s,n,i){for(let a=0;a<e.length;a++)this.tt(e[a],s,n,i)},tr(e,s,n,i){i=i||Me.groups;let a;return s&&s.j?a=s:(a=new Me(s),n&&i&&Je(s,n,i)),this.jr.push([e,a]),a},ts(e,s,n,i){let a=this;const o=e.length;if(!o)return a;for(let l=0;l<o-1;l++)a=a.tt(e[l]);return a.tt(e[o-1],s,n,i)},tt(e,s,n,i){i=i||Me.groups;const a=this;if(s&&s.j)return a.j[e]=s,s;const o=s;let l,r=a.go(e);if(r?(l=new Me,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new Me,o){if(i)if(l.t&&typeof l.t=="string"){const u=Object.assign(to(l.t,i),n);Je(o,u,i)}else n&&Je(o,n,i);l.t=o}return a.j[e]=l,l}};const X=(e,s,n,i,a)=>e.ta(s,n,i,a),he=(e,s,n,i,a)=>e.tr(s,n,i,a),rs=(e,s,n,i,a)=>e.ts(s,n,i,a),R=(e,s,n,i,a)=>e.tt(s,n,i,a),Ue="WORD",Cn="UWORD",Ds="ASCIINUMERICAL",Os="ALPHANUMERICAL",pt="LOCALHOST",$n="TLD",Sn="UTLD",Mt="SCHEME",Ze="SLASH_SCHEME",Rn="NUM",Mn="WS",Dn="NL",ut="OPENBRACE",dt="CLOSEBRACE",xt="OPENBRACKET",Tt="CLOSEBRACKET",Et="OPENPAREN",It="CLOSEPAREN",Lt="OPENANGLEBRACKET",At="CLOSEANGLEBRACKET",Rt="FULLWIDTHLEFTPAREN",Dt="FULLWIDTHRIGHTPAREN",Ot="LEFTCORNERBRACKET",Pt="RIGHTCORNERBRACKET",Nt="LEFTWHITECORNERBRACKET",Ut="RIGHTWHITECORNERBRACKET",Ft="FULLWIDTHLESSTHAN",zt="FULLWIDTHGREATERTHAN",Bt="AMPERSAND",Ht="APOSTROPHE",jt="ASTERISK",We="AT",Vt="BACKSLASH",Wt="BACKTICK",qt="CARET",qe="COLON",On="COMMA",Gt="DOLLAR",Re="DOT",Kt="EQUALS",Pn="EXCLAMATION",Ie="HYPHEN",vt="PERCENT",Yt="PIPE",Jt="PLUS",Xt="POUND",mt="QUERY",Nn="QUOTE",Ps="FULLWIDTHMIDDLEDOT",Un="SEMI",De="SLASH",ft="TILDE",Qt="UNDERSCORE",Ns="EMOJI",Zt="SYM";var Us=Object.freeze({__proto__:null,ALPHANUMERICAL:Os,AMPERSAND:Bt,APOSTROPHE:Ht,ASCIINUMERICAL:Ds,ASTERISK:jt,AT:We,BACKSLASH:Vt,BACKTICK:Wt,CARET:qt,CLOSEANGLEBRACKET:At,CLOSEBRACE:dt,CLOSEBRACKET:Tt,CLOSEPAREN:It,COLON:qe,COMMA:On,DOLLAR:Gt,DOT:Re,EMOJI:Ns,EQUALS:Kt,EXCLAMATION:Pn,FULLWIDTHGREATERTHAN:zt,FULLWIDTHLEFTPAREN:Rt,FULLWIDTHLESSTHAN:Ft,FULLWIDTHMIDDLEDOT:Ps,FULLWIDTHRIGHTPAREN:Dt,HYPHEN:Ie,LEFTCORNERBRACKET:Ot,LEFTWHITECORNERBRACKET:Nt,LOCALHOST:pt,NL:Dn,NUM:Rn,OPENANGLEBRACKET:Lt,OPENBRACE:ut,OPENBRACKET:xt,OPENPAREN:Et,PERCENT:vt,PIPE:Yt,PLUS:Jt,POUND:Xt,QUERY:mt,QUOTE:Nn,RIGHTCORNERBRACKET:Pt,RIGHTWHITECORNERBRACKET:Ut,SCHEME:Mt,SEMI:Un,SLASH:De,SLASH_SCHEME:Ze,SYM:Zt,TILDE:ft,TLD:$n,UNDERSCORE:Qt,UTLD:Sn,UWORD:Cn,WORD:Ue,WS:Mn});const Pe=/[a-z]/,it=new RegExp("\\p{L}","u"),vn=new RegExp("\\p{Emoji}","u"),Ne=/\d/,mn=/\s/,cs="\r",fn=`
`,no="ï¸",so="â€",pn="ï¿¼";let _t=null,Ct=null;function ao(e=[]){const s={};Me.groups=s;const n=new Me;_t==null&&(_t=us(Ji)),Ct==null&&(Ct=us(Xi)),R(n,"'",Ht),R(n,"{",ut),R(n,"}",dt),R(n,"[",xt),R(n,"]",Tt),R(n,"(",Et),R(n,")",It),R(n,"<",Lt),R(n,">",At),R(n,"ï¼ˆ",Rt),R(n,"ï¼‰",Dt),R(n,"ã€Œ",Ot),R(n,"ã€",Pt),R(n,"ã€",Nt),R(n,"ã€",Ut),R(n,"ï¼œ",Ft),R(n,"ï¼",zt),R(n,"&",Bt),R(n,"*",jt),R(n,"@",We),R(n,"`",Wt),R(n,"^",qt),R(n,":",qe),R(n,",",On),R(n,"$",Gt),R(n,".",Re),R(n,"=",Kt),R(n,"!",Pn),R(n,"-",Ie),R(n,"%",vt),R(n,"|",Yt),R(n,"+",Jt),R(n,"#",Xt),R(n,"?",mt),R(n,'"',Nn),R(n,"/",De),R(n,";",Un),R(n,"~",ft),R(n,"_",Qt),R(n,"\\",Vt),R(n,"ãƒ»",Ps);const i=he(n,Ne,Rn,{[bn]:!0});he(i,Ne,i);const a=he(i,Pe,Ds,{[ct]:!0}),o=he(i,it,Os,{[ot]:!0}),l=he(n,Pe,Ue,{[kn]:!0});he(l,Ne,a),he(l,Pe,l),he(a,Ne,a),he(a,Pe,a);const r=he(n,it,Cn,{[wn]:!0});he(r,Pe),he(r,Ne,o),he(r,it,r),he(o,Ne,o),he(o,Pe),he(o,it,o);const u=R(n,fn,Dn,{[dn]:!0}),b=R(n,cs,Mn,{[dn]:!0}),p=he(n,mn,Mn,{[dn]:!0});R(n,pn,p),R(b,fn,u),R(b,pn,p),he(b,mn,p),R(p,cs),R(p,fn),he(p,mn,p),R(p,pn,p);const m=he(n,vn,Ns,{[Rs]:!0});R(m,"#"),he(m,vn,m),R(m,no,m);const f=R(m,so);R(f,"#"),he(f,vn,m);const c=[[Pe,l],[Ne,a]],v=[[Pe,null],[it,r],[Ne,o]];for(let g=0;g<_t.length;g++)Ve(n,_t[g],$n,Ue,c);for(let g=0;g<Ct.length;g++)Ve(n,Ct[g],Sn,Cn,v);Je($n,{tld:!0,ascii:!0},s),Je(Sn,{utld:!0,alpha:!0},s),Ve(n,"file",Mt,Ue,c),Ve(n,"mailto",Mt,Ue,c),Ve(n,"http",Ze,Ue,c),Ve(n,"https",Ze,Ue,c),Ve(n,"ftp",Ze,Ue,c),Ve(n,"ftps",Ze,Ue,c),Je(Mt,{scheme:!0,ascii:!0},s),Je(Ze,{slashscheme:!0,ascii:!0},s),e=e.sort((g,T)=>g[0]>T[0]?1:-1);for(let g=0;g<e.length;g++){const T=e[g][0],_=e[g][1]?{[Qi]:!0}:{[Zi]:!0};T.indexOf("-")>=0?_[_n]=!0:Pe.test(T)?Ne.test(T)?_[ct]=!0:_[kn]=!0:_[bn]=!0,rs(n,T,T,_)}return rs(n,"localhost",pt,{ascii:!0}),n.jd=new Me(Zt),{start:n,tokens:Object.assign({groups:s},Us)}}function Fs(e,s){const n=io(s.replace(/[A-Z]/g,r=>r.toLowerCase())),i=n.length,a=[];let o=0,l=0;for(;l<i;){let r=e,u=null,b=0,p=null,m=-1,f=-1;for(;l<i&&(u=r.go(n[l]));)r=u,r.accepts()?(m=0,f=0,p=r):m>=0&&(m+=n[l].length,f++),b+=n[l].length,o+=n[l].length,l++;o-=m,l-=f,b-=m,a.push({t:p.t,v:s.slice(o-b,o),s:o-b,e:o})}return a}function io(e){const s=[],n=e.length;let i=0;for(;i<n;){let a=e.charCodeAt(i),o,l=a<55296||a>56319||i+1===n||(o=e.charCodeAt(i+1))<56320||o>57343?e[i]:e.slice(i,i+2);s.push(l),i+=l.length}return s}function Ve(e,s,n,i,a){let o;const l=s.length;for(let r=0;r<l-1;r++){const u=s[r];e.j[u]?o=e.j[u]:(o=new Me(i),o.jr=a.slice(),e.j[u]=o),e=o}return o=new Me(n),o.jr=a.slice(),e.j[s[l-1]]=o,o}function us(e){const s=[],n=[];let i=0,a="0123456789";for(;i<e.length;){let o=0;for(;a.indexOf(e[i+o])>=0;)o++;if(o>0){s.push(n.join(""));for(let l=parseInt(e.substring(i,i+o),10);l>0;l--)n.pop();i+=o}else n.push(e[i]),i++}return s}const ht={defaultProtocol:"http",events:null,format:ds,formatHref:ds,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Fn(e,s=null){let n=Object.assign({},ht);e&&(n=Object.assign(n,e instanceof Fn?e.o:e));const i=n.ignoreTags,a=[];for(let o=0;o<i.length;o++)a.push(i[o].toUpperCase());this.o=n,s&&(this.defaultRender=s),this.ignoreTags=a}Fn.prototype={o:ht,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,s,n){const i=s!=null;let a=this.o[e];return a&&(typeof a=="object"?(a=n.t in a?a[n.t]:ht[e],typeof a=="function"&&i&&(a=a(s,n))):typeof a=="function"&&i&&(a=a(s,n.t,n)),a)},getObj(e,s,n){let i=this.o[e];return typeof i=="function"&&s!=null&&(i=i(s,n.t,n)),i},render(e){const s=e.render(this);return(this.get("render",null,e)||this.defaultRender)(s,e.t,e)}};function ds(e){return e}function zs(e,s){this.t="token",this.v=e,this.tk=s}zs.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const s=this.toString(),n=e.get("truncate",s,this),i=e.get("format",s,this);return n&&i.length>n?i.substring(0,n)+"â€¦":i},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=ht.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const s=this,n=this.toHref(e.get("defaultProtocol")),i=e.get("formatHref",n,this),a=e.get("tagName",n,s),o=this.toFormattedString(e),l={},r=e.get("className",n,s),u=e.get("target",n,s),b=e.get("rel",n,s),p=e.getObj("attributes",n,s),m=e.getObj("events",n,s);return l.href=i,r&&(l.class=r),u&&(l.target=u),b&&(l.rel=b),p&&Object.assign(l,p),{tagName:a,attributes:l,content:o,eventListeners:m}}};function nn(e,s){class n extends zs{constructor(a,o){super(a,o),this.t=e}}for(const i in s)n.prototype[i]=s[i];return n.t=e,n}const vs=nn("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),ms=nn("text"),oo=nn("nl"),$t=nn("url",{isLink:!0,toHref(e=ht.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==pt&&e[1].t===qe}}),Ee=e=>new Me(e);function lo({groups:e}){const s=e.domain.concat([Bt,jt,We,Vt,Wt,qt,Gt,Kt,Ie,Rn,vt,Yt,Jt,Xt,De,Zt,ft,Qt]),n=[Ht,qe,On,Re,Pn,vt,mt,Nn,Un,Lt,At,ut,dt,Tt,xt,Et,It,Rt,Dt,Ot,Pt,Nt,Ut,Ft,zt],i=[Bt,Ht,jt,Vt,Wt,qt,Gt,Kt,Ie,ut,dt,vt,Yt,Jt,Xt,mt,De,Zt,ft,Qt],a=Ee(),o=R(a,ft);X(o,i,o),X(o,e.domain,o);const l=Ee(),r=Ee(),u=Ee();X(a,e.domain,l),X(a,e.scheme,r),X(a,e.slashscheme,u),X(l,i,o),X(l,e.domain,l);const b=R(l,We);R(o,We,b),R(r,We,b),R(u,We,b);const p=R(o,Re);X(p,i,o),X(p,e.domain,o);const m=Ee();X(b,e.domain,m),X(m,e.domain,m);const f=R(m,Re);X(f,e.domain,m);const c=Ee(vs);X(f,e.tld,c),X(f,e.utld,c),R(b,pt,c);const v=R(m,Ie);R(v,Ie,v),X(v,e.domain,m),X(c,e.domain,m),R(c,Re,f),R(c,Ie,v);const g=R(c,qe);X(g,e.numeric,vs);const T=R(l,Ie),C=R(l,Re);R(T,Ie,T),X(T,e.domain,l),X(C,i,o),X(C,e.domain,l);const _=Ee($t);X(C,e.tld,_),X(C,e.utld,_),X(_,e.domain,l),X(_,i,o),R(_,Re,C),R(_,Ie,T),R(_,We,b);const O=R(_,qe),U=Ee($t);X(O,e.numeric,U);const F=Ee($t),P=Ee();X(F,s,F),X(F,n,P),X(P,s,F),X(P,n,P),R(_,De,F),R(U,De,F);const Z=R(r,qe),re=R(u,qe),E=R(re,De),S=R(E,De);X(r,e.domain,l),R(r,Re,C),R(r,Ie,T),X(u,e.domain,l),R(u,Re,C),R(u,Ie,T),X(Z,e.domain,F),R(Z,De,F),R(Z,mt,F),X(S,e.domain,F),X(S,s,F),R(S,De,F);const B=[[ut,dt],[xt,Tt],[Et,It],[Lt,At],[Rt,Dt],[Ot,Pt],[Nt,Ut],[Ft,zt]];for(let Q=0;Q<B.length;Q++){const[j,I]=B[Q],W=R(F,j);R(P,j,W),R(W,I,F);const ve=Ee($t);X(W,s,ve);const fe=Ee();X(W,n),X(ve,s,ve),X(ve,n,fe),X(fe,s,ve),X(fe,n,fe),R(ve,I,F),R(fe,I,F)}return R(a,pt,_),R(a,Dn,oo),{start:a,tokens:Us}}function ro(e,s,n){let i=n.length,a=0,o=[],l=[];for(;a<i;){let r=e,u=null,b=null,p=0,m=null,f=-1;for(;a<i&&!(u=r.go(n[a].t));)l.push(n[a++]);for(;a<i&&(b=u||r.go(n[a].t));)u=null,r=b,r.accepts()?(f=0,m=r):f>=0&&f++,a++,p++;if(f<0)a-=p,a<i&&(l.push(n[a]),a++);else{l.length>0&&(o.push(hn(ms,s,l)),l=[]),a-=f,p-=f;const c=m.t,v=n.slice(a-p,a);o.push(hn(c,s,v))}}return l.length>0&&o.push(hn(ms,s,l)),o}function hn(e,s,n){const i=n[0].s,a=n[n.length-1].e,o=s.slice(i,a);return new e(o,n)}const we={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function co(){we.scanner=ao(we.customSchemes);for(let e=0;e<we.tokenQueue.length;e++)we.tokenQueue[e][1]({scanner:we.scanner});we.parser=lo(we.scanner.tokens);for(let e=0;e<we.pluginQueue.length;e++)we.pluginQueue[e][1]({scanner:we.scanner,parser:we.parser});return we.initialized=!0,we}function Bs(e){return we.initialized||co(),ro(we.parser.start,e,Fs(we.scanner.start,e))}Bs.scan=Fs;function Hs(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function uo(e){return e.replace(/"/g,"&quot;")}function vo(e){const s=[];for(const n in e){let i=e[n]+"";s.push(`${n}="${uo(i)}"`)}return s.join(" ")}function mo({tagName:e,attributes:s,content:n}){return`<${e} ${vo(s)}>${Hs(n)}</${e}>`}function js(e,s={}){s=new Fn(s,mo);const n=Bs(e),i=[];for(let a=0;a<n.length;a++){const o=n[a];o.t==="nl"&&s.get("nl2br")?i.push(`<br>
`):!o.isLink||!s.check(o)?i.push(Hs(o.toString())):i.push(s.render(o))}return i.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(s){return js(this,s)}});const fo={},po={class:"admin-badge",title:"Admin"};function ho(e,s){return d(),h("span",po,"âœ“")}const zn=pe(fo,[["render",ho]]);function go(e){const{delay:s=500,scrollThreshold:n=5,onLongPress:i,onCancel:a}=e,o=y(!1);let l=null,r=0,u=0,b=!1;function p(){l&&(clearTimeout(l),l=null)}function m(g){r=g.clientX,u=g.clientY,b=!1,o.value=!0,p(),l=setTimeout(()=>{b=!0,i(g)},s)}function f(g){if(!l)return;const T=g.clientX-r,C=g.clientY-u;(Math.abs(T)>n||Math.abs(C)>n)&&v()}function c(){p(),o.value=!1}function v(){p(),o.value=!1,b||a?.()}return{isPressed:o,onPointerDown:m,onPointerUp:c,onPointerMove:f}}const yo=["data-message-id"],bo={key:0,class:"selection-checkbox"},ko=["checked"],wo={key:1,class:"msg-sender-name"},_o={class:"msg-content-wrap"},Co={key:0,class:"msg-bubble sticker-bubble"},$o=["src","alt"],So={class:"msg-time"},Mo={key:0,class:"msg-edited-label"},xo={key:1,class:"msg-bubble"},To={key:0,class:"msg-forwarded-label"},Eo={class:"msg-reply-quote-name"},Io={class:"msg-reply-quote-text"},Lo={class:"voice-player"},Ao={class:"voice-dur"},Ro={class:"msg-time"},Do={key:0,class:"msg-edited-label"},Oo={key:2,class:"msg-bubble"},Po={key:0,class:"msg-forwarded-label"},No={class:"msg-reply-quote-name"},Uo={class:"msg-reply-quote-text"},Fo=["innerHTML"],zo={class:"msg-time"},Bo={key:0,class:"msg-edited-label"},Ho={key:3,class:"reaction-chips"},jo=["onClick"],Vo={class:"reaction-emoji"},Wo={class:"reaction-count"},qo=ae({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:s}){const n=e,i=s,a=Xe(),o=xe(),l=yt(),r=V(()=>a.isSelected(n.message.id)),u=V(()=>l.deletingMessages.has(n.message.id)),b=et("lastSentMessageId",y(null)),p=V(()=>n.isMine&&n.message.id===b.value),{onPointerDown:m,onPointerUp:f,onPointerMove:c}=go({delay:500,onLongPress($){T($.clientX,$.clientY)}}),v={onPointerdown:m,onPointerup:f,onPointermove:c};function g($){if(a.selectionMode){a.toggleMessage(n.message.id);return}T($.clientX,$.clientY)}function T($,G){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:o.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:$,y:G}}))}function C(){a.selectionMode&&a.toggleMessage(n.message.id)}const _=Le(),O=gt(),U=V(()=>{if(!O.readReceiptsEnabled)return null;const $=o.activeChat;if(!$)return null;const G=$.id;if($.type==="direct"&&$.other_user_id===_.user?.id)return{text:"âœ“âœ“",cls:"read"};if($.type==="direct")return l.isMessageRead(G,n.message.id,$.other_user_id)?{text:"âœ“âœ“",cls:"read"}:{text:"âœ“",cls:"sent"};const ee=l.getReadCount(G,n.message.id);return ee>0?{text:`âœ“âœ“ ${ee}`,cls:"read"}:{text:"âœ“",cls:"sent"}}),F=V(()=>{if(!n.message.forwarded_from_chat_id)return null;const $=n.message.forwarded_from_user_id;if($&&$===_.user?.id)return null;const G=n.message.forwarded_from_display_name;return G?`Forwarded from ${G}`:"Forwarded"}),P=et("stickers",y([])),Z=V(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const $=P.value.find(G=>G.id===n.message.sticker_id);if($)return $.url}return""}),re=V(()=>n.message.attachment_url||""),E=y(!1),S=y(0),B=y(0),Q=y(n.message.duration_seconds||0);let j=null,I=null;function W(){return j||(j=new Audio(re.value),j.addEventListener("loadedmetadata",()=>{j&&isFinite(j.duration)&&(Q.value=j.duration)}),j.addEventListener("ended",()=>{E.value=!1,S.value=0,B.value=0,fe()})),j}function ve(){if(j&&E.value){B.value=j.currentTime;const $=j.duration;S.value=$&&isFinite($)?j.currentTime/$*100:0,I=requestAnimationFrame(ve)}}function fe(){I!==null&&(cancelAnimationFrame(I),I=null)}function M(){const $=W();E.value?($.pause(),E.value=!1,fe()):($.play(),E.value=!0,I=requestAnimationFrame(ve))}function D($){const G=W(),le=$.currentTarget.getBoundingClientRect(),$e=Math.max(0,Math.min(1,($.clientX-le.left)/le.width)),Ae=G.duration;Ae&&isFinite(Ae)&&(G.currentTime=$e*Ae,B.value=G.currentTime,S.value=$e*100)}const q=V(()=>{const $=Q.value;return E.value||B.value>0?de(Math.floor(B.value))+" / "+de(Math.floor($)):de(Math.floor($))});Oe(re,()=>{j&&(j.pause(),E.value=!1,fe(),j=null,S.value=0,B.value=0)}),Ge(()=>{j&&(j.pause(),j=null),fe()});const H=V(()=>{const $=n.message.reply_to_type;if($==="sticker")return"ğŸ¨ Sticker";if($==="voice")return"ğŸ¤ Voice message";if($==="file")return"ğŸ“ File";const G=n.message.reply_to_content||"";return G.length>80?G.slice(0,80)+"...":G}),se=V(()=>js(n.message.content||"",{defaultProtocol:"https",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(G,ee,le)=>ee||`<span class="mention" data-u="${le}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${le}'}))">@${le}</span>`));function ie($){if(!$)return"";const G=new Date($.endsWith("Z")?$:$+"Z"),ee=new Date;return G.toDateString()===ee.toDateString()?G.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):G.toLocaleDateString([],{month:"short",day:"numeric"})}function de($){const G=Math.floor($/60),ee=$%60;return`${G}:${String(ee).padStart(2,"0")}`}function K($){const G=$.target.getBoundingClientRect();i("openEmojiPicker",n.message.id,G.left,G.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",($=>{i("mentionClick",$.detail)})),($,G)=>(d(),h("div",va({class:["msg-row",[e.isMine?"mine":"theirs",{selected:r.value,"msg-deleting":u.value,"msg-new":p.value}]],"data-message-id":e.message.id,onContextmenu:ce(g,["prevent"])},v,{onClick:C}),[k(a).selectionMode?(d(),h("div",bo,[t("input",{type:"checkbox",checked:r.value,tabindex:"-1"},null,8,ko)])):N("",!0),!e.isMine&&e.message.message_type!=="sticker"?(d(),h("div",wo,[ke(x(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(d(),Y(zn,{key:0})):N("",!0)])):N("",!0),t("div",_o,[e.message.message_type==="sticker"?(d(),h("div",Co,[t("img",{class:"sticker-img",src:Z.value,alt:e.message.sticker_label||"sticker"},null,8,$o),t("div",So,[e.message.is_edited?(d(),h("span",Mo,"(edited)")):N("",!0),ke(" "+x(ie(e.message.created_at)),1),e.isMine&&U.value?(d(),h("span",{key:1,class:ue(["msg-read-check",U.value.cls])},x(U.value.text),3)):N("",!0)])])):e.message.message_type==="voice"?(d(),h("div",xo,[F.value?(d(),h("div",To,x(F.value),1)):N("",!0),e.message.reply_to_message_id?(d(),h("div",{key:1,class:"msg-reply-quote",onClick:G[0]||(G[0]=ce(ee=>i("replyClick",e.message.reply_to_message_id),["stop"]))},[G[2]||(G[2]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",Eo,x(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",Io,x(H.value),1)])])):N("",!0),t("div",Lo,[t("button",{class:"voice-play-btn",onClick:ce(M,["stop"])},x(E.value?"â¸":"â–¶"),1),t("div",{class:"voice-track",onClick:ce(D,["stop"])},[t("div",{class:"voice-progress",style:nt({width:S.value+"%"})},null,4)]),t("span",Ao,x(q.value),1)]),t("div",Ro,[e.message.is_edited?(d(),h("span",Do,"(edited)")):N("",!0),ke(" "+x(ie(e.message.created_at)),1),e.isMine&&U.value?(d(),h("span",{key:1,class:ue(["msg-read-check",U.value.cls])},x(U.value.text),3)):N("",!0)])])):(d(),h("div",Oo,[F.value?(d(),h("div",Po,x(F.value),1)):N("",!0),e.message.reply_to_message_id?(d(),h("div",{key:1,class:"msg-reply-quote",onClick:G[1]||(G[1]=ce(ee=>i("replyClick",e.message.reply_to_message_id),["stop"]))},[G[3]||(G[3]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",No,x(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",Uo,x(H.value),1)])])):N("",!0),t("span",{class:"msg-text",innerHTML:se.value},null,8,Fo),t("div",zo,[e.message.is_edited?(d(),h("span",Bo,"(edited)")):N("",!0),ke(" "+x(ie(e.message.created_at)),1),e.isMine&&U.value?(d(),h("span",{key:1,class:ue(["msg-read-check",U.value.cls])},x(U.value.text),3)):N("",!0)])])),t("button",{class:"reaction-add-btn",onClick:ce(K,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(d(),h("div",Ho,[(d(!0),h(oe,null,ye(e.message.reactions,ee=>(d(),h("button",{key:ee.emoji,class:ue(["reaction-chip",{"reaction-mine":ee.me}]),onClick:ce(le=>i("toggleReaction",e.message.id,ee.emoji),["stop"])},[t("span",Vo,x(ee.emoji),1),t("span",Wo,x(ee.count),1)],10,jo))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:ce(K,["stop"])},"+")])):N("",!0)])],16,yo))}}),Go={class:"composer-wrapper"},Ko={key:0,class:"reply-preview"},Yo={class:"reply-preview-content"},Jo={class:"reply-preview-sender"},Xo={class:"reply-preview-text"},Qo={key:1,class:"reply-preview edit-preview"},Zo={class:"reply-preview-content"},el={class:"reply-preview-text"},tl={class:"composer"},nl=["onKeydown"],sl=ae({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(e,{expose:s,emit:n}){const i=e,a=n,o=y(""),l=y(null),r=y(null),u=y(null);let b=0;function p(){const _=o.value.trim();_&&(u.value?(a("editMessage",u.value.messageId,_),u.value=null):r.value?(a("send",_,{...r.value}),r.value=null):a("send",_),o.value="",C())}function m(){r.value=null,l.value?.focus()}function f(){u.value=null,o.value="",C(),l.value?.focus()}function c(){r.value?m():u.value&&f()}function v(_){const O=_.detail;O&&(u.value=null,r.value={messageId:O.messageId,senderName:O.senderName||"Unknown",snippet:(O.text||"").slice(0,100)},Se(()=>l.value?.focus()))}function g(_){const O=_.detail;O&&(r.value=null,u.value={messageId:O.messageId,snippet:(O.text||"").slice(0,100),fullText:O.text||""},o.value=u.value.fullText,Se(()=>{C(),l.value?.focus()}))}function T(){C();const _=Date.now();_-b>2e3&&o.value.trim().length>0&&(b=_,a("typing"))}function C(){const _=l.value;_&&(_.style.height="auto",_.style.height=Math.min(_.scrollHeight,120)+"px")}return Ce(()=>{l.value?.focus(),window.addEventListener("reply-to-message",v),window.addEventListener("edit-message",g)}),Ge(()=>{window.removeEventListener("reply-to-message",v),window.removeEventListener("edit-message",g)}),Oe(()=>i.replyTo,_=>{_&&l.value?.focus()}),s({focus:()=>l.value?.focus()}),(_,O)=>(d(),h("div",Go,[r.value?(d(),h("div",Ko,[O[3]||(O[3]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",Yo,[t("span",Jo,x(r.value.senderName),1),t("span",Xo,x(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:m},"âœ•")])):N("",!0),u.value?(d(),h("div",Qo,[O[5]||(O[5]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",Zo,[O[4]||(O[4]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",el,x(u.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:f},"âœ•")])):N("",!0),t("div",tl,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:O[0]||(O[0]=U=>a("toggleStickers"))},"ğŸŒ"),me(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":O[1]||(O[1]=U=>o.value=U),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[yn(ce(p,["exact","prevent"]),["enter"]),yn(c,["escape"])],onInput:T},null,40,nl),[[be,o.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:O[2]||(O[2]=U=>a("startRecording"))},"ğŸ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:p},"â¤")])]))}}),al=pe(sl,[["__scopeId","data-v-df4ad9ba"]]),il={class:"sticker-grid"},ol=["title","onClick"],ll=["src","alt"],rl={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},cl=ae({__name:"StickerPicker",emits:["select"],setup(e,{emit:s}){const n=s,i=et("stickers",y([])),a=V(()=>i.value);return(o,l)=>(d(),h("div",il,[(d(!0),h(oe,null,ye(a.value,r=>(d(),h("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:u=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,ll)],8,ol))),128)),a.value.length===0?(d(),h("div",rl," No stickers available ")):N("",!0)]))}}),ul={},dl={class:"msgs-loading"};function vl(e,s){return d(),h("div",dl,"Loading...")}const fs=pe(ul,[["render",vl]]),ml=["onClick"],fl=ae({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:s}){const n=s,i=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(a,o)=>e.visible?(d(),h("div",{key:0,class:"emoji-picker",style:nt({left:e.x+"px",top:e.y+"px"}),onClick:o[0]||(o[0]=ce(()=>{},["stop"]))},[(d(),h(oe,null,ye(i,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},x(l),9,ml)),64))],4)):N("",!0)}}),pl=ae({__name:"MessageContextMenu",setup(e){const{showToast:s}=Te(),n=Le(),i=yt(),a=Xe(),o=y(!1),l=y(0),r=y(0),u=y(null),b=y(null),p=y(""),m=y(""),f=y(""),c=y(null),v=y(!1),g=V(()=>!c.value||!n.user?!1:c.value===n.user.id),T=V(()=>!b.value||!u.value?null:`${window.location.origin}/c/${b.value}/${u.value}`),C=V(()=>!b.value||!u.value?!1:i.pinnedByChat[b.value]?.message?.id===u.value);function _(I){v.value=!!I.detail.areaOnly,u.value=I.detail.messageId??null,b.value=I.detail.chatId,p.value=I.detail.text||"",m.value=I.detail.messageType||"text",f.value=I.detail.senderName||"",c.value=I.detail.senderId??null,l.value=I.detail.x,r.value=I.detail.y,o.value=!0,requestAnimationFrame(()=>{const W=document.querySelector(".msg-context-menu");if(!W)return;const ve=W.getBoundingClientRect();ve.right>window.innerWidth&&(l.value=window.innerWidth-ve.width-8),ve.bottom>window.innerHeight&&(r.value=window.innerHeight-ve.height-8)})}function O(){o.value&&(o.value=!1,u.value=null,b.value=null,p.value="",m.value="",f.value="",c.value=null,v.value=!1)}Ce(()=>{window.addEventListener("show-message-context-menu",_),document.addEventListener("click",O)}),Ge(()=>{window.removeEventListener("show-message-context-menu",_),document.removeEventListener("click",O)});function U(){o.value=!1}function F(){U(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:u.value,chatId:b.value,senderName:f.value,text:p.value}}))}function P(){U(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:u.value,chatId:b.value,text:p.value}}))}async function Z(){U();try{await navigator.clipboard.writeText(p.value),s("Copied to clipboard")}catch{s("Failed to copy text")}}async function re(){if(U(),!!T.value)try{await navigator.clipboard.writeText(T.value),s("Link copied")}catch{s("Failed to copy link")}}function E(){U(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[u.value],chatId:b.value}}))}function S(){U(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:u.value,chatId:b.value}}))}function B(){if(U(),!u.value||!b.value)return;const I=C.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(I,{detail:{messageId:u.value,chatId:b.value}}))}function Q(){U(),b.value&&a.enterSelectionMode(b.value)}function j(){U(),!(!u.value||!b.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:u.value,chatId:b.value}}))}return(I,W)=>(d(),Y(gs,{to:"body"},[o.value?(d(),h("div",{key:0,class:"msg-context-menu",style:nt({left:l.value+"px",top:r.value+"px"}),onClick:W[0]||(W[0]=ce(()=>{},["stop"])),onContextmenu:W[1]||(W[1]=ce(()=>{},["prevent"]))},[v.value?(d(),h("button",{key:0,class:"ctx-item",onClick:Q},"Select Messages")):(d(),h(oe,{key:1},[t("button",{class:"ctx-item",onClick:F}," Reply "),g.value&&m.value==="text"?(d(),h("button",{key:0,class:"ctx-item",onClick:P}," Edit ")):N("",!0),t("button",{class:"ctx-item",onClick:B},x(C.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:Z}," Copy text "),T.value?(d(),h("button",{key:1,class:"ctx-item",onClick:re}," Copy link ")):N("",!0),t("button",{class:"ctx-item",onClick:E}," Forward "),t("button",{class:"ctx-item",onClick:S}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:j}," Delete ")],64))],36)):N("",!0)]))}}),hl=pe(pl,[["__scopeId","data-v-e4c122b4"]]),gl={key:0,class:"selection-bar"},yl={class:"selection-bar-count"},bl={class:"selection-bar-actions"},kl=["disabled"],wl=["disabled"],_l=ae({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:s}){const n=s,i=Xe();return(a,o)=>(d(),Y(xn,{name:"slide-down"},{default:en(()=>[k(i).selectionMode?(d(),h("div",gl,[t("button",{class:"selection-bar-btn cancel-btn",onClick:o[0]||(o[0]=l=>k(i).exitSelectionMode())}," Cancel "),t("span",yl,x(k(i).selectedCount)+" selected",1),t("div",bl,[t("button",{class:"selection-bar-btn forward-btn",disabled:k(i).selectedCount===0,onClick:o[1]||(o[1]=l=>n("forward"))}," Forward ("+x(k(i).selectedCount)+") ",9,kl),t("button",{class:"selection-bar-btn delete-btn",disabled:k(i).selectedCount===0,onClick:o[2]||(o[2]=l=>n("delete"))}," Delete ("+x(k(i).selectedCount)+") ",9,wl)])])):N("",!0)]),_:1}))}}),Cl=pe(_l,[["__scopeId","data-v-9ba988f2"]]),$l=ae({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const n=s;function i(){n("close")}return(a,o)=>(d(),Y(gs,{to:"body"},[z(xn,{name:"bottom-sheet"},{default:en(()=>[e.visible?(d(),h("div",{key:0,class:"bottom-sheet-backdrop",onClick:ce(i,["self"])},[t("div",{class:"bottom-sheet",onClick:o[0]||(o[0]=ce(()=>{},["stop"]))},[o[1]||(o[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),ys(a.$slots,"default",{},void 0,!0)])])):N("",!0)]),_:3})]))}}),Sl=pe($l,[["__scopeId","data-v-9712ffdf"]]),Ml={class:"modal"},xl={class:"modal-header"},Tl={class:"modal-body"},El={class:"forward-chat-list"},Il={key:0,class:"empty-state-small"},Ll=["onClick"],Al={class:"forward-chat-info"},Rl={class:"forward-chat-name"},Dl={class:"forward-chat-type"},Ol={key:0,class:"forward-check"},Pl={class:"modal-actions"},Nl=["disabled"],Ul=ae({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:s}){const n=e,i=s,a=xe(),o=yt(),{showToast:l}=Te(),r=y(""),u=y(null),b=y(!1),p=V(()=>{const g=r.value.toLowerCase().trim(),T=a.sortedChats;return g?T.filter(C=>m(C).toLowerCase().includes(g)):T});function m(g){return g.type==="direct"?g.other_user_id?g.other_display_name||g.other_username||g.title||"Direct Chat":"Saved Messages":g.title||g.name||"Unnamed Chat"}function f(g){if(g.type==="direct")return g.other_avatar_url??void 0}function c(){}async function v(){if(u.value!==null){b.value=!0;try{await o.forwardMessages(u.value,n.fromChatId,n.messageIds),l("Message forwarded!"),i("forwarded",u.value)}catch{l("Failed to forward message")}finally{b.value=!1}}}return(g,T)=>(d(),h("div",{class:"modal-backdrop",onClick:T[2]||(T[2]=ce(C=>i("close"),["self"]))},[t("div",Ml,[t("div",xl,[T[3]||(T[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:T[0]||(T[0]=C=>i("close"))},"âœ•")]),t("div",Tl,[me(t("input",{"onUpdate:modelValue":T[1]||(T[1]=C=>r.value=C),class:"search-input",type:"search",placeholder:"Search chats...",onInput:c},null,544),[[be,r.value]]),t("div",El,[p.value.length===0?(d(),h("div",Il,"No chats found.")):N("",!0),(d(!0),h(oe,null,ye(p.value,C=>(d(),h("div",{key:C.id,class:ue(["forward-chat-item",{selected:u.value===C.id}]),onClick:_=>u.value=C.id},[z(_e,{name:m(C),url:f(C),size:"sm"},null,8,["name","url"]),t("div",Al,[t("div",Rl,x(m(C)),1),t("div",Dl,x(C.type),1)]),u.value===C.id?(d(),h("span",Ol,"âœ“")):N("",!0)],10,Ll))),128))]),t("div",Pl,[t("button",{class:"btn btn-primary",disabled:u.value===null||b.value,onClick:v},x(b.value?"Forwarding...":"Forward"),9,Nl)])])])]))}}),Fl=pe(Ul,[["__scopeId","data-v-4e477e89"]]),zl={class:"modal modal-sm"},Bl={class:"modal-header"},Hl={class:"modal-body"},jl={class:"delete-confirm-text"},Vl={key:0,class:"delete-checkbox-label"},Wl={class:"modal-actions"},ql=ae({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:s}){const n=s,i=y(!1);function a(){n("confirm",i.value)}return(o,l)=>(d(),h("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=ce(r=>n("close"),["self"]))},[t("div",zl,[t("div",Bl,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",Hl,[t("p",jl," Are you sure you want to delete "+x(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(d(),h("label",Vl,[me(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>i.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[ma,i.value]]),l[5]||(l[5]=ke(" Delete for everyone ",-1))])):N("",!0)]),t("div",Wl,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:a},"Delete")])])]))}}),Gl=pe(ql,[["__scopeId","data-v-388dbae2"]]),bt=tt("channel",()=>{const e=y(null),s=y([]),n=y(!1),i=V(()=>s.value.length),a=V(()=>s.value.filter(m=>m.role==="admin"||m.role==="owner").length),o=V(()=>{const m=Le();return m.user?s.value.find(c=>c.id===m.user.id)?.role??null:null}),l=V(()=>o.value==="owner"),r=V(()=>o.value==="admin"||o.value==="owner");async function u(m){n.value=!0;try{e.value=await ks(m)}catch(f){console.error("Failed to load channel detail",f)}finally{n.value=!1}}async function b(m){try{s.value=await Ra(m)}catch(f){console.error("Failed to load channel members",f)}}async function p(m,f){try{e.value=await Da(m,f)}catch(c){throw console.error("Failed to update channel",c),c}}return{detail:e,members:s,loading:n,memberCount:i,adminCount:a,myRole:o,isOwner:l,isAdmin:r,loadDetail:u,loadMembers:b,updateChannel:p}}),Kl=tt("invites",()=>{const e=y([]),s=y(!1);async function n(o){s.value=!0;try{e.value=await ga(o)}catch(l){console.error("Failed to load invites",l)}finally{s.value=!1}}async function i(o){try{const l=await ya(o);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function a(o){const l=[...e.value];e.value=e.value.filter(r=>r.token!==o);try{await ba(o)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:s,loadInvites:n,createInvite:i,revokeInvite:a}}),Yl={class:"invite-links-view"},Jl={class:"view-header"},Xl={style:{padding:"0 1rem .5rem"}},Ql=["disabled"],Zl={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},er={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},tr={key:2,class:"invite-list",style:{padding:"0 1rem"}},nr={class:"invite-item-info"},sr={class:"invite-token"},ar={class:"invite-date"},ir={class:"invite-item-actions"},or=["onClick"],lr=["onClick"],rr=ae({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,i=s,a=Kl(),{showToast:o}=Te(),l=y(!1);function r(m){return new Date(m).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function u(m){const f=`${window.location.origin}/join/${m}`;navigator.clipboard&&navigator.clipboard.writeText(f).then(()=>o("Link copied!"))}async function b(){l.value=!0;try{await a.createInvite(n.chatId),o("Invite link created")}catch{o("Failed to create invite")}finally{l.value=!1}}async function p(m){try{await a.revokeInvite(m),o("Invite revoked")}catch{o("Failed to revoke invite")}}return Ce(()=>a.loadInvites(n.chatId)),(m,f)=>(d(),h("div",Yl,[t("div",Jl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:f[0]||(f[0]=c=>i("back"))},[z(k(Fe),{size:20,"stroke-width":2})]),f[1]||(f[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",Xl,[t("button",{class:"btn btn-sm btn-outline",onClick:b,disabled:l.value},x(l.value?"Creating...":"Create Invite Link"),9,Ql)]),k(a).loading?(d(),h("div",Zl," Loading... ")):k(a).invites.length===0?(d(),h("div",er," No active invite links ")):(d(),h("div",tr,[(d(!0),h(oe,null,ye(k(a).invites,c=>(d(),h("div",{key:c.id,class:"invite-item"},[t("div",nr,[t("code",sr,x(c.token),1),t("span",ar,x(r(c.created_at)),1)]),t("div",ir,[t("button",{class:"icon-btn",title:"Copy link",onClick:v=>u(c.token)},[z(k(Ts),{size:16,"stroke-width":2})],8,or),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:v=>p(c.token)}," Revoke ",8,lr)])]))),128))]))]))}}),cr=pe(rr,[["__scopeId","data-v-97b82dd0"]]);async function ur(e,s){await J.post(`/chats/${e}/avatar`,{file_id:s})}async function dr(e,s){return(await J.post(`/chats/${e}/members/${s}/promote`)).data}async function vr(e,s){return(await J.post(`/chats/${e}/members/${s}/demote`)).data}const mr={class:"admins-view"},fr={class:"view-header"},pr={class:"search-bar"},hr={key:0,class:"member-empty"},gr={key:1,class:"member-list"},yr=["onClick"],br={class:"member-info"},kr={class:"member-name"},wr={class:"role-badge"},_r={class:"view-footer"},Cr={key:0,class:"member-empty"},$r={key:1,class:"member-list"},Sr={class:"member-info"},Mr={class:"member-name"},xr=["onClick"],Tr={key:2,class:"view-footer"},Er=ae({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,i=s,a=bt(),o=y(!1),l=y(""),r=V(()=>a.members.filter(f=>f.role==="admin"||f.role==="owner")),u=V(()=>a.members.filter(f=>f.role==="member")),b=V(()=>{const f=l.value.toLowerCase().trim();return f?u.value.filter(c=>c.username.toLowerCase().includes(f)||c.display_name&&c.display_name.toLowerCase().includes(f)):u.value});async function p(f){try{await dr(n.chatId,f);const c=a.members.find(v=>v.id===f);c&&(c.role="admin"),o.value=!1,l.value=""}catch{}}async function m(f){try{await vr(n.chatId,f);const c=a.members.find(v=>v.id===f);c&&(c.role="member")}catch{}}return(f,c)=>(d(),h("div",mr,[t("div",fr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=v=>i("back"))},[z(k(Fe),{size:20,"stroke-width":2})]),c[4]||(c[4]=t("span",{class:"view-title"},"Administrators",-1))]),o.value?(d(),h(oe,{key:0},[t("div",pr,[me(t("input",{"onUpdate:modelValue":c[1]||(c[1]=v=>l.value=v),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[be,l.value]])]),b.value.length===0?(d(),h("div",hr,x(l.value?"No members found":"No members to promote"),1)):(d(),h("div",gr,[(d(!0),h(oe,null,ye(b.value,v=>(d(),h("div",{key:v.id,class:"member-item member-item--selectable",onClick:g=>p(v.id)},[z(_e,{name:v.display_name||v.username,url:v.avatar_url,size:"md"},null,8,["name","url"]),t("div",br,[t("span",kr,x(v.display_name||v.username),1),t("span",wr,x(v.role),1)])],8,yr))),128))])),t("div",_r,[t("button",{class:"btn btn--secondary",onClick:c[2]||(c[2]=v=>o.value=!1)},"Cancel")])],64)):(d(),h(oe,{key:1},[r.value.length===0?(d(),h("div",Cr," No administrators found ")):(d(),h("div",$r,[(d(!0),h(oe,null,ye(r.value,v=>(d(),h("div",{key:v.id,class:"member-item"},[z(_e,{name:v.display_name||v.username,url:v.avatar_url,size:"md"},null,8,["name","url"]),t("div",Sr,[t("span",Mr,x(v.display_name||v.username),1),t("span",{class:ue(["role-badge",`role-badge--${v.role}`])},x(v.role),3)]),k(a).isOwner&&v.role==="admin"?(d(),h("button",{key:0,class:"btn btn--small btn--danger",onClick:g=>m(v.id)}," Demote ",8,xr)):N("",!0)]))),128))])),k(a).isOwner?(d(),h("div",Tr,[t("button",{class:"btn btn--primary",onClick:c[3]||(c[3]=v=>o.value=!0)},"Add Admin")])):N("",!0)],64))]))}}),Ir=pe(Er,[["__scopeId","data-v-2bd7c861"]]),Lr={class:"subscribers-view"},Ar={class:"view-header"},Rr={class:"search-bar"},Dr={key:0,class:"member-empty"},Or={key:1,class:"member-list"},Pr={class:"member-info"},Nr={class:"member-name"},Ur=ae({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=s,i=bt(),a=y(""),o=V(()=>{const l=a.value.toLowerCase().trim();return l?i.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):i.members});return(l,r)=>(d(),h("div",Lr,[t("div",Ar,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=u=>n("back"))},[z(k(Fe),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",Rr,[me(t("input",{"onUpdate:modelValue":r[1]||(r[1]=u=>a.value=u),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[be,a.value]])]),o.value.length===0?(d(),h("div",Dr,x(a.value?"No members found":"No subscribers"),1)):(d(),h("div",Or,[(d(!0),h(oe,null,ye(o.value,u=>(d(),h("div",{key:u.id,class:"member-item"},[z(_e,{name:u.display_name||u.username,url:u.avatar_url,size:"md"},null,8,["name","url"]),t("div",Pr,[t("span",Nr,x(u.display_name||u.username),1),t("span",{class:ue(["role-badge",`role-badge--${u.role}`])},x(u.role),3)])]))),128))]))]))}}),Fr=pe(Ur,[["__scopeId","data-v-f99a8a5f"]]),zr={class:"modal profile-modal"},Br={class:"profile-modal-body profile-modal-body--scrollable"},Hr={class:"profile-avatar-section profile-avatar-upload-section"},jr={class:"profile-avatar-overlay"},Vr={class:"profile-info-list"},Wr={class:"form-group"},qr={class:"form-label"},Gr=["placeholder"],Kr={class:"form-group"},Yr=["placeholder"],Jr={key:0,class:"form-group"},Xr={class:"form-label"},Qr={class:"type-selector"},Zr={class:"type-option"},ec={class:"type-option"},tc={class:"profile-edit-actions"},nc=["disabled"],sc=ae({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:s}){const n=e,i=s,a=bt(),{showToast:o}=Te(),l=y(""),r=y(""),u=y(void 0),b=y("public"),p=y(!1),m=y(null),f=V(()=>a.detail?.type==="group"),c=V(()=>f.value?"Group":"Channel");Ce(()=>{a.detail&&(l.value=a.detail.title||"",r.value=a.detail.description||"",u.value=a.detail.avatar_url??void 0,b.value=a.detail.public_name?"public":"private")});async function v(){const T=m.value?.files?.[0];if(T){try{const C=await Ln(T);await ur(n.chatId,C.id),u.value=URL.createObjectURL(T),o("Avatar updated!")}catch{o("Avatar upload failed")}m.value&&(m.value.value="")}}async function g(){if(!l.value.trim()){o(`${c.value} name is required`);return}p.value=!0;try{await a.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),o(`${c.value} updated!`),i("saved"),i("close")}catch{o(`Failed to update ${c.value.toLowerCase()}`)}finally{p.value=!1}}return(T,C)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:C[7]||(C[7]=ce(_=>i("close"),["self"]))},[t("div",zr,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:C[0]||(C[0]=_=>i("close"))},[z(k(Be),{size:20,"stroke-width":2})]),t("div",Br,[t("div",Hr,[t("div",{class:"profile-avatar-upload-wrap",onClick:C[1]||(C[1]=_=>m.value?.click())},[z(_e,{name:l.value||c.value,url:u.value,size:"xxl"},null,8,["name","url"]),t("div",jr,[z(k(Ms),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:m,type:"file",accept:"image/*",class:"hidden",onChange:v},null,544)]),t("div",Vr,[t("div",Wr,[t("label",qr,x(c.value)+" name",1),me(t("input",{"onUpdate:modelValue":C[2]||(C[2]=_=>l.value=_),class:"form-input",type:"text",maxlength:"128",placeholder:`${c.value} name`},null,8,Gr),[[be,l.value]])]),t("div",Kr,[C[8]||(C[8]=t("label",{class:"form-label"},"Description",-1)),me(t("textarea",{"onUpdate:modelValue":C[3]||(C[3]=_=>r.value=_),class:"form-input",maxlength:"500",rows:"4",placeholder:`${c.value} description...`},null,8,Yr),[[be,r.value]])]),k(a).isOwner?(d(),h("div",Jr,[t("label",Xr,x(c.value)+" type",1),t("div",Qr,[t("label",Zr,[me(t("input",{"onUpdate:modelValue":C[4]||(C[4]=_=>b.value=_),type:"radio",value:"public",name:"chatType"},null,512),[[Xn,b.value]]),C[9]||(C[9]=t("span",{class:"type-option-label"},"Public",-1)),C[10]||(C[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",ec,[me(t("input",{"onUpdate:modelValue":C[5]||(C[5]=_=>b.value=_),type:"radio",value:"private",name:"chatType"},null,512),[[Xn,b.value]]),C[11]||(C[11]=t("span",{class:"type-option-label"},"Private",-1)),C[12]||(C[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):N("",!0)]),t("div",tc,[t("button",{class:"btn btn-primary",disabled:p.value,onClick:g},x(p.value?"Saving...":"Save"),9,nc),t("button",{class:"btn btn-ghost",onClick:C[6]||(C[6]=_=>i("close"))},"Cancel")])])])]))}}),ac=pe(sc,[["__scopeId","data-v-6ec12915"]]),ic={class:"danger-zone"},oc={class:"view-header"},lc={class:"danger-zone-body"},rc={class:"modal modal-sm"},cc={class:"modal-header"},uc={class:"modal-actions"},dc=["disabled"],vc=ae({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:s}){const n=e,i=s,a=xe(),o=bt(),{showToast:l}=Te(),r=y(!1),u=y(!1);async function b(){try{await a.leave(n.chatId),i("left")}catch{l("Failed to leave channel")}}async function p(){u.value=!0;try{await _s(n.chatId),a.chats=a.chats.filter(m=>m.id!==n.chatId),a.activeChatId===n.chatId&&a.setActiveChat(null),r.value=!1,i("deleted")}catch{l("Failed to delete channel")}finally{u.value=!1}}return(m,f)=>(d(),h("div",ic,[t("div",oc,[t("button",{class:"icon-btn","aria-label":"Back",onClick:f[0]||(f[0]=c=>i("back"))},[z(k(Fe),{size:20,"stroke-width":2})]),f[5]||(f[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",lc,[t("button",{class:"btn btn-danger-outline",onClick:b},[z(k(Tn),{size:18,"stroke-width":1.8}),f[6]||(f[6]=ke(" Leave Channel ",-1))]),k(o).isOwner?(d(),h("button",{key:0,class:"btn btn-danger",onClick:f[1]||(f[1]=c=>r.value=!0)},[z(k(Ls),{size:18,"stroke-width":1.8}),f[7]||(f[7]=ke(" Delete Channel ",-1))])):N("",!0)]),r.value?(d(),h("div",{key:0,class:"modal-backdrop",onClick:f[4]||(f[4]=ce(c=>r.value=!1,["self"]))},[t("div",rc,[t("div",cc,[f[8]||(f[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:f[2]||(f[2]=c=>r.value=!1)},[z(k(Be),{size:20,"stroke-width":2})])]),f[9]||(f[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",uc,[t("button",{class:"btn btn-ghost",onClick:f[3]||(f[3]=c=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:u.value,onClick:p},x(u.value?"Deleting...":"Delete"),9,dc)])])])):N("",!0)]))}}),mc=pe(vc,[["__scopeId","data-v-997b5e56"]]),fc={class:"modal profile-modal"},pc={class:"profile-modal-body"},hc={key:5,class:"profile-loading"},gc={class:"profile-avatar-section"},yc={class:"profile-name"},bc={class:"profile-status"},kc={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},wc={class:"profile-info-item"},_c={class:"profile-info-value"},Cc={class:"channel-info-menu"},$c={class:"channel-info-menu-count"},Sc={class:"channel-info-menu-count"},Mc={key:7,class:"profile-loading"},xc=ae({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:s}){const n=e,i=s,a=bt(),o=y("main"),l=V(()=>Number(n.chatId)),r=V(()=>a.detail?.type==="group");function u(){o.value="main",a.loadDetail(l.value)}return Ce(async()=>{await Promise.all([a.loadDetail(l.value),a.loadMembers(l.value)])}),(b,p)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:p[14]||(p[14]=ce(m=>i("close"),["self"]))},[t("div",fc,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:p[0]||(p[0]=m=>i("close"))},[z(k(Be),{size:20,"stroke-width":2})]),t("div",pc,[o.value==="invites"?(d(),Y(cr,{key:0,"chat-id":l.value,onBack:p[1]||(p[1]=m=>o.value="main")},null,8,["chat-id"])):o.value==="admins"?(d(),Y(Ir,{key:1,"chat-id":l.value,onBack:p[2]||(p[2]=m=>o.value="main")},null,8,["chat-id"])):o.value==="subscribers"?(d(),Y(Fr,{key:2,"chat-id":l.value,onBack:p[3]||(p[3]=m=>o.value="main")},null,8,["chat-id"])):o.value==="edit"?(d(),Y(ac,{key:3,"chat-id":l.value,onClose:p[4]||(p[4]=m=>o.value="main"),onSaved:u},null,8,["chat-id"])):o.value==="danger"?(d(),Y(mc,{key:4,"chat-id":l.value,onBack:p[5]||(p[5]=m=>o.value="main"),onLeft:p[6]||(p[6]=m=>i("close")),onDeleted:p[7]||(p[7]=m=>i("close"))},null,8,["chat-id"])):k(a).loading?(d(),h("div",hc,[...p[15]||(p[15]=[t("p",null,"Loading...",-1)])])):k(a).detail?(d(),h(oe,{key:6},[t("div",gc,[z(_e,{name:k(a).detail.title||"Channel",url:k(a).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",yc,x(k(a).detail.title),1),t("div",bc,x(k(a).memberCount)+" "+x(r.value?k(a).memberCount===1?"member":"members":k(a).memberCount===1?"subscriber":"subscribers"),1),k(a).detail.description?(d(),h("div",kc,[t("div",wc,[p[16]||(p[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",_c,x(k(a).detail.description),1)])])):N("",!0),p[19]||(p[19]=t("div",{class:"profile-divider"},null,-1)),t("div",Cc,[t("button",{class:"channel-info-menu-item",onClick:p[8]||(p[8]=m=>o.value="invites")},[z(k(ui),{size:20,"stroke-width":1.8}),p[17]||(p[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:p[9]||(p[9]=m=>o.value="admins")},[z(k(yi),{size:20,"stroke-width":1.8}),p[18]||(p[18]=t("span",null,"Administrators",-1)),t("span",$c,x(k(a).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:p[10]||(p[10]=m=>o.value="subscribers")},[z(k(tn),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Members":"Subscribers"),1),t("span",Sc,x(k(a).memberCount),1)]),k(a).isOwner||k(a).isAdmin?(d(),h("button",{key:0,class:"channel-info-menu-item",onClick:p[11]||(p[11]=m=>o.value="edit")},[z(k(In),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Edit Group":"Edit Channel"),1)])):N("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[12]||(p[12]=m=>o.value="danger")},[z(k(Tn),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Leave Group":"Leave Channel"),1)]),k(a).isOwner?(d(),h("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[13]||(p[13]=m=>o.value="danger")},[z(k(Ls),{size:20,"stroke-width":1.8}),t("span",null,x(r.value?"Delete Group":"Delete Channel"),1)])):N("",!0)])],64)):(d(),h("div",Mc,[...p[20]||(p[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),Tc=pe(xc,[["__scopeId","data-v-d1526322"]]),Ec={class:"search-bar"},Ic={class:"search-bar-header"},Lc={key:0,class:"search-loading"},Ac={key:1,class:"search-empty"},Rc=["onClick"],Dc={class:"search-result-sender"},Oc=["innerHTML"],Pc={class:"search-result-date"},Nc={key:0,class:"search-loading"},Uc=ae({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:s}){const n=e,i=s,a=y(null),o=y(null),l=y(""),r=y([]),u=y(!1),b=y(!1),p=y(!0);let m=null;Ce(()=>{Se(()=>a.value?.focus())}),Oe(l,_=>{if(m&&clearTimeout(m),!_.trim()){r.value=[],b.value=!1,p.value=!0;return}m=setTimeout(()=>f(_.trim()),300)});async function f(_){u.value=!0,b.value=!0,p.value=!0;try{const O=await Zn(n.chatId,_,{limit:20});r.value=O,O.length<20&&(p.value=!1)}catch{r.value=[]}finally{u.value=!1}}async function c(){if(u.value||!p.value||r.value.length===0)return;const _=Math.min(...r.value.map(O=>O.id));u.value=!0;try{const O=await Zn(n.chatId,l.value.trim(),{limit:20,before_id:_});O.length<20&&(p.value=!1),r.value=[...r.value,...O]}catch{}finally{u.value=!1}}function v(){if(!o.value)return;const _=o.value;_.scrollTop+_.clientHeight>=_.scrollHeight-40&&c()}function g(_,O){if(!O)return T(_);const U=T(_),F=T(O),P=new RegExp(F.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return U.replace(P,"<mark>$&</mark>")}function T(_){return _.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function C(_){if(!_)return"";const O=new Date(_.endsWith("Z")?_:_+"Z"),U=new Date;return O.toDateString()===U.toDateString()?O.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):O.toLocaleDateString([],{month:"short",day:"numeric"})+" "+O.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return(_,O)=>(d(),h("div",Ec,[t("div",Ic,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:O[0]||(O[0]=U=>i("close"))},"â†"),me(t("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":O[1]||(O[1]=U=>l.value=U),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:O[2]||(O[2]=yn(U=>i("close"),["escape"]))},null,544),[[be,l.value]]),l.value?(d(),h("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:O[3]||(O[3]=U=>l.value="")},"âœ•")):N("",!0)]),u.value&&r.value.length===0?(d(),h("div",Lc,"Searching...")):b.value&&r.value.length===0&&!u.value?(d(),h("div",Ac,"No messages found")):r.value.length>0?(d(),h("div",{key:2,ref_key:"resultsRef",ref:o,class:"search-results",onScroll:v},[(d(!0),h(oe,null,ye(r.value,U=>(d(),h("div",{key:U.id,class:"search-result-item",onClick:F=>i("jumpToMessage",U.id)},[t("div",Dc,x(U.sender_display_name||U.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:g(U.content||"",l.value)},null,8,Oc),t("div",Pc,x(C(U.created_at)),1)],8,Rc))),128)),u.value?(d(),h("div",Nc,"Loading more...")):N("",!0)],544)):N("",!0)]))}});function Fc(e){const{chatId:s,verticalThreshold:n=8}=e,i=y(!1);let a=0,o=!1,l=!1,r=null;function u(c){const v=c?.closest?.("[data-message-id]");if(!v)return null;const g=v.getAttribute("data-message-id");return g!=null?Number(g):null}function b(c,v){const g=document.elementFromPoint(c,v),T=u(g);if(T!=null)return T;const C=document.querySelectorAll("[data-message-id]");let _=null,O=1/0;for(const U of C){const F=U.getBoundingClientRect(),P=F.top+F.height/2,Z=Math.abs(v-P);Z<O&&(O=Z,_=U)}if(_){const U=_.getAttribute("data-message-id");return U!=null?Number(U):null}return null}function p(c){if(c.button!==0)return;const v=c.target;!v.closest("[data-message-id]")||s()==null||(a=c.clientY,o=!0,l=!1,r=u(v))}function m(c){if(!o)return;if(!l){if(Math.abs(c.clientY-a)<n)return;l=!0;const T=Xe(),C=s();if(C==null){o=!1;return}T.selectionMode?r!=null&&T.addMessage(r):T.enterSelectionMode(C,r??void 0),i.value=!0}c.preventDefault();const v=b(c.clientX,c.clientY);v!=null&&Xe().addMessage(v)}function f(){o&&(o=!1,l=!1,i.value=!1)}return{isDragSelecting:i,onMouseDown:p,onMouseMove:m,onMouseUp:f}}const zc={class:"chat-panel"},Bc={key:1,class:"chat-view"},Hc={key:2,class:"channel-readonly-bar"},jc={key:0,class:"date-sep"},Vc={key:4,class:"sticker-picker"},Wc={key:6,class:"recording-bar"},qc={class:"rec-time"},Gc=ae({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:s}){const n=s,i=Le(),a=xe(),o=yt(),{showToast:l}=Te(),r=zi(),u=et("stickers",y([])),b=et("sendTyping",()=>{}),p=et("pendingScrollMessageId",y(null)),m=y(null),f=y(null),c=y(!1);let v=null;const g=y(!1),T=y(!1),C=y("member"),_=y(!1),O=y(!1),U=y(null);lt("lastSentMessageId",U);const F=y(!0),P=y(0);let Z=null;function re(){if(!m.value)return!0;const A=m.value;return A.scrollTop+A.clientHeight>=A.scrollHeight-100}function E(){Z||(Z=setTimeout(()=>{Z=null,F.value=re(),F.value&&(P.value=0)},100))}function S(A){if(!m.value)return null;const w=m.value.querySelectorAll("[data-message-id]");let L=null,ne=1/0;for(const ge of w){const je=ge.getBoundingClientRect();if(A>=je.top-15&&A<=je.bottom+15){const Ye=(je.top+je.bottom)/2,Jn=Math.abs(A-Ye);Jn<ne&&(ne=Jn,L=ge)}}return L}function B(A){if(A.target.closest(".msg-row"))return;A.preventDefault();const L=S(A.clientY);if(L){const ne=Number(L.dataset.messageId),ge=Ke.value.find(je=>je.id===ne);if(ge){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:ge.id,chatId:a.activeChatId,text:ge.content||"",messageType:ge.message_type,senderId:ge.sender_id,senderName:ge.sender_display_name||ge.sender_username||"",x:A.clientX,y:A.clientY}}));return}}window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{areaOnly:!0,chatId:a.activeChatId,x:A.clientX,y:A.clientY}}))}function Q(){st(),P.value=0,F.value=!0}const j=y(!1),I=y(0),W=y(0),ve=y(null),fe=Xe(),{isDragSelecting:M,onMouseDown:D,onMouseMove:q,onMouseUp:H}=Fc({chatId:()=>a.activeChatId}),se=y(!1),ie=y(null),de=y(""),K=V(()=>!ie.value||!i.user?!1:Ke.value.find(w=>w.id===ie.value)?.sender_id===i.user.id),$=V(()=>K.value?Ke.value.find(w=>w.id===ie.value)?.message_type==="text":!1),G=V(()=>!ie.value||!a.activeChatId?!1:o.pinnedByChat[a.activeChatId]?.message?.id===ie.value),ee=V(()=>!a.activeChatId||o.pinnedDismissed.has(a.activeChatId)?null:o.pinnedByChat[a.activeChatId]||null),le=y(!1),$e=y([]),Ae=y(!1),Qe=y([]),sn=y(!1),an=y(null);let kt=null;const Bn=V(()=>a.activeChat?.type==="channel"&&C.value==="member"),Ke=V(()=>a.activeChatId?o.getMessages(a.activeChatId):[]),Ws=V(()=>{const A=[];let w="";for(const L of Ke.value){const ne=qs(L.created_at);ne!==w&&(A.push({type:"date",label:ne}),w=ne),A.push({type:"msg",msg:L})}return A});function qs(A){if(!A)return"";const w=new Date(A.endsWith("Z")?A:A+"Z"),L=new Date;if(w.toDateString()===L.toDateString())return"Today";const ne=new Date(L);return ne.setDate(L.getDate()-1),w.toDateString()===ne.toDateString()?"Yesterday":w.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Gs(){on(),!(!f.value||!m.value)&&(v=new IntersectionObserver(async A=>{if(!A[0]?.isIntersecting)return;const L=a.activeChatId;if(!L||c.value||o.loadingChat===L)return;c.value=!0;const ne=m.value,ge=ne?ne.scrollHeight:0;try{if((await o.loadOlder(L)).length>0&&ne){await Se();const Ye=ne.scrollHeight;ne.scrollTop+=Ye-ge}}finally{c.value=!1}},{root:m.value,threshold:0}),v.observe(f.value))}function on(){v&&(v.disconnect(),v=null)}Oe(()=>a.activeChatId,async A=>{if(g.value=!1,C.value="member",P.value=0,F.value=!0,on(),kt&&(clearInterval(kt),kt=null),!A)return;await Promise.all([o.loadMessages(A),o.loadPinnedMessage(A),o.loadReadReceipts(A)]),await Se(),st(),await Se(),Gs();const w=a.activeChat;if(w&&(w.type==="channel"||w.type==="group"))try{const L=await ks(A);C.value=L.my_role||"member"}catch{}kt=setInterval(()=>{a.activeChatId===A&&o.loadNewer(A).then(L=>{L.length>0&&Ks(L.length)})},2500)});function st(){m.value&&(m.value.scrollTop=m.value.scrollHeight)}function Ks(A=1){if(!m.value)return;const w=m.value;w.scrollHeight-w.scrollTop-w.clientHeight<100?Se(()=>{w.scrollTop=w.scrollHeight}):P.value+=A}function Ys(){a.activeChatId&&b(a.activeChatId)}async function Js(A,w){if(!(!a.activeChatId||!A.trim())){an.value=null;try{const L=w?{reply_to_message_id:w.messageId}:void 0,ne=await o.sendMessage(a.activeChatId,A.trim(),"text",L);i.user&&(ne.sender_id=i.user.id,ne.sender_username=i.user.username,ne.sender_display_name=i.user.display_name),U.value=ne.id,setTimeout(()=>{U.value===ne.id&&(U.value=null)},500),await Se(),st(),a.loadChats()}catch{l("Failed to send message")}}}async function Xs(A,w){if(!(!a.activeChatId||!w.trim()))try{await o.editMessage(a.activeChatId,A,w.trim())}catch{l("Failed to edit message")}}async function Qs(A){if(a.activeChatId){g.value=!1;try{const w=await o.sendMessage(a.activeChatId,"","sticker",{sticker_id:A}),L=u.value.find(ne=>ne.id===A);L&&(w.sticker_url=L.url,w.sticker_label=L.label),U.value=w.id,setTimeout(()=>{U.value===w.id&&(U.value=null)},500),await Se(),st(),a.loadChats()}catch{l("Failed to send sticker")}}}function Zs(A,w,L){ve.value=A,I.value=w,W.value=L,j.value=!0}function ea(A){ve.value&&a.activeChatId&&o.toggleReaction(a.activeChatId,ve.value,A),j.value=!1,ve.value=null}function ta(A,w){a.activeChatId&&o.toggleReaction(a.activeChatId,A,w)}function na(){j.value=!1,ve.value=null}async function sa(){try{await r.startRecording(),T.value=!0}catch{T.value=!1,l("Microphone access denied")}}async function aa(){try{const A=await r.stopRecording();T.value=!1,await ua(A)}catch{T.value=!1}}function ia(){r.cancelRecording(),T.value=!1}function Hn(A){const{messageIds:w}=A.detail;$e.value=w,le.value=!0}function jn(A){const{messageId:w,chatId:L}=A.detail;L&&fe.enterSelectionMode(L,w)}async function Vn(A,w){try{await o.pinMsg(A,w)}catch{l("Failed to pin message")}}async function Wn(A,w){try{await o.unpinMsg(A,w)}catch{l("Failed to unpin message")}}function qn(A){const{messageId:w,chatId:L}=A.detail;w&&L&&Vn(L,w)}function Gn(A){const{messageId:w,chatId:L}=A.detail;w&&L&&Wn(L,w)}function ln(A){const{messageId:w,chatId:L}=A.detail;if(!w||!L)return;Qe.value=[w];const ne=Ke.value.find(ge=>ge.id===w);sn.value=!!(ne&&ne.sender_id===i.user?.id),Ae.value=!0}function oa(){$e.value=[...fe.selectedMessageIds],le.value=!0}function la(){Qe.value=[...fe.selectedMessageIds],sn.value=Qe.value.every(A=>{const w=Ke.value.find(L=>L.id===A);return w&&w.sender_id===i.user?.id}),Ae.value=!0}function Kn(){le.value=!1,$e.value=[],fe.exitSelectionMode()}async function ra(A){Ae.value=!1;const w=a.activeChatId;if(w){for(const L of Qe.value)try{await o.deleteMessage(w,L,A)}catch{l("Failed to delete message")}Qe.value=[],fe.exitSelectionMode()}}function He(A){se.value=!1;const w=ie.value,L=a.activeChatId;if(!(!w||!L))switch(A){case"reply":{const ne=Ke.value.find(ge=>ge.id===w);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:w,senderName:ne?.sender_display_name||ne?.sender_username||"Unknown",text:ne?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:w,chatId:L,text:de.value}}));break}case"copy":navigator.clipboard.writeText(de.value).then(()=>l("Copied to clipboard"),()=>l("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${L}/${w}`).then(()=>l("Link copied"),()=>l("Failed to copy link"));break;case"forward":$e.value=[w],le.value=!0;break;case"select":fe.enterSelectionMode(L,w);break;case"delete":ln(new CustomEvent("",{detail:{messageId:w,chatId:L}}));break;case"pin":Vn(L,w);break;case"unpin":Wn(L,w);break}}async function wt(A){if(!m.value)return;const w=a.activeChatId;if(!w)return;let L=m.value.querySelector(`[data-message-id="${A}"]`);if(!L)try{const ne=Math.max(0,A-25),ge=await St(w,{after_id:ne,limit:50});if(!ge.find(Ye=>Ye.id===A)){l("Message not found");return}o.messagesByChat[w]=ge,ge.length>0&&(o.lastMsgId[w]=Math.max(...ge.map(Ye=>Ye.id))),await Se(),L=m.value?.querySelector(`[data-message-id="${A}"]`)}catch{l("Message not found");return}L&&(L.scrollIntoView({behavior:"smooth",block:"center"}),L.classList.add("highlight-message"),setTimeout(()=>L.classList.remove("highlight-message"),2e3))}function ca(A){O.value=!1,wt(A)}function Yn(A){if(A.key==="Escape"){if(O.value){O.value=!1,A.stopPropagation();return}_.value&&(_.value=!1,A.stopPropagation())}}Ce(()=>{window.addEventListener("forward-messages",Hn),window.addEventListener("select-message",jn),window.addEventListener("delete-message",ln),window.addEventListener("pin-message",qn),window.addEventListener("unpin-message",Gn),document.addEventListener("keydown",Yn)}),Ge(()=>{on(),window.removeEventListener("forward-messages",Hn),window.removeEventListener("select-message",jn),window.removeEventListener("delete-message",ln),window.removeEventListener("pin-message",qn),window.removeEventListener("unpin-message",Gn),document.removeEventListener("keydown",Yn)}),Oe(()=>p.value,async A=>{A&&(await Se(),setTimeout(()=>{wt(A),p.value=null},300))}),Oe(()=>a.activeChatId,()=>{fe.exitSelectionMode(),an.value=null,O.value=!1});async function ua(A){if(a.activeChatId)try{const w=await Ln(A);await o.sendMessage(a.activeChatId,"","voice",{file_id:w.id,duration_seconds:r.seconds.value}),await o.loadMessages(a.activeChatId),await Se(),st(),a.loadChats()}catch{l("Failed to upload voice message")}}return(A,w)=>(d(),h("main",zc,[k(a).activeChatId?(d(),h("div",Bc,[z(Cl,{onForward:oa,onDelete:la}),O.value&&k(a).activeChatId?(d(),Y(Uc,{key:0,"chat-id":k(a).activeChatId,onClose:w[1]||(w[1]=L=>O.value=!1),onJumpToMessage:ca},null,8,["chat-id"])):N("",!0),me(z(Yi,{onBack:w[2]||(w[2]=L=>n("back")),onOpenUserProfile:w[3]||(w[3]=L=>n("openUserProfile",L)),onOpenChannelInfo:w[4]||(w[4]=L=>_.value=!0),onOpenSearch:w[5]||(w[5]=L=>O.value=!0)},null,512),[[Qn,!k(fe).selectionMode&&!O.value]]),ee.value&&!k(fe).selectionMode?(d(),Y(Vi,{key:1,message:ee.value.message,onClick:w[6]||(w[6]=L=>wt(ee.value.message.id)),onDismiss:w[7]||(w[7]=L=>k(o).dismissPin(k(a).activeChatId))},null,8,["message"])):N("",!0),Bn.value?(d(),h("div",Hc,[...w[26]||(w[26]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):N("",!0),P.value>0?(d(),h("button",{key:3,class:"new-messages-pill",onClick:Q},x(P.value)+" new message"+x(P.value>1?"s":"")+" â†“ ",1)):N("",!0),t("div",{ref_key:"msgListRef",ref:m,class:ue(["msg-list",{"drag-selecting":k(M)}]),onClick:na,onScroll:E,onContextmenu:B,onMousedown:w[9]||(w[9]=(...L)=>k(D)&&k(D)(...L)),onMousemove:w[10]||(w[10]=(...L)=>k(q)&&k(q)(...L)),onMouseup:w[11]||(w[11]=(...L)=>k(H)&&k(H)(...L))},[k(o).loadingChat===k(a).activeChatId?(d(),Y(fs,{key:0})):(d(),h(oe,{key:1},[w[27]||(w[27]=t("div",{class:"msg-list-spacer"},null,-1)),t("div",{ref_key:"olderSentinelRef",ref:f,class:"older-sentinel"},[c.value?(d(),Y(fs,{key:0})):N("",!0)],512),(d(!0),h(oe,null,ye(Ws.value,L=>(d(),h(oe,{key:L.type==="date"?"date-"+L.label:"msg-"+L.msg.id},[L.type==="date"?(d(),h("div",jc,[t("span",null,x(L.label),1)])):(d(),Y(qo,{key:1,message:L.msg,"is-mine":L.msg.sender_id===k(i).user?.id,onMentionClick:w[8]||(w[8]=ne=>n("openUserProfile",ne)),onOpenEmojiPicker:Zs,onToggleReaction:ta,onReplyClick:wt},null,8,["message","is-mine"]))],64))),128))],64))],34),z(fl,{visible:j.value,x:I.value,y:W.value,onSelect:ea,onClose:w[12]||(w[12]=L=>j.value=!1)},null,8,["visible","x","y"]),g.value?(d(),h("div",Vc,[z(cl,{onSelect:Qs})])):N("",!0),Bn.value?N("",!0):me((d(),Y(al,{key:5,"sticker-picker-open":g.value,"reply-to":an.value,onSend:Js,onEditMessage:Xs,onToggleStickers:w[13]||(w[13]=L=>g.value=!g.value),onStartRecording:sa,onTyping:Ys},null,8,["sticker-picker-open","reply-to"])),[[Qn,!T.value]]),T.value?(d(),h("div",Wc,[w[28]||(w[28]=t("span",{class:"rec-dot"},null,-1)),t("span",qc,x(k(r).formatTime(k(r).seconds.value)),1),w[29]||(w[29]=t("span",{class:"rec-label"},"Recording...",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:ia},"âœ•"),t("button",{class:"icon-btn rec-send",title:"Send",onClick:aa},"â¤")])):N("",!0),z(hl),z(Sl,{visible:se.value,onClose:w[22]||(w[22]=L=>se.value=!1)},{default:en(()=>[t("button",{class:"ctx-item",onClick:w[14]||(w[14]=L=>He("reply"))},"Reply"),$.value?(d(),h("button",{key:0,class:"ctx-item",onClick:w[15]||(w[15]=L=>He("edit"))},"Edit")):N("",!0),t("button",{class:"ctx-item",onClick:w[16]||(w[16]=L=>He(G.value?"unpin":"pin"))},x(G.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:w[17]||(w[17]=L=>He("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:w[18]||(w[18]=L=>He("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:w[19]||(w[19]=L=>He("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:w[20]||(w[20]=L=>He("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:w[21]||(w[21]=L=>He("delete"))},"Delete")]),_:1},8,["visible"]),le.value?(d(),Y(Fl,{key:7,"message-ids":$e.value,"from-chat-id":k(a).activeChatId,onClose:Kn,onForwarded:Kn},null,8,["message-ids","from-chat-id"])):N("",!0),Ae.value?(d(),Y(Gl,{key:8,"message-count":Qe.value.length,"can-delete-for-everyone":sn.value,onClose:w[23]||(w[23]=L=>Ae.value=!1),onConfirm:ra},null,8,["message-count","can-delete-for-everyone"])):N("",!0),_.value?(d(),Y(Tc,{key:9,"chat-id":String(k(a).activeChatId),onClose:w[24]||(w[24]=L=>_.value=!1)},null,8,["chat-id"])):N("",!0)])):(d(),h("div",{key:0,class:"empty-chat",onContextmenu:w[0]||(w[0]=ce(()=>{},["prevent"]))},[...w[25]||(w[25]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])],32))]))}}),Kc=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Saved Messages",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function Yc(e){return Kc.filter(s=>s.visible(e))}const Jc=["disabled"],Xc={class:"menu-item__label"},Qc={key:1,class:"menu-item__badge"},Zc=ae({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:s}){const n=s;return(i,a)=>(d(),h("button",{class:ue(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:a[0]||(a[0]=o=>n("click"))},[e.icon?(d(),Y(ze(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):N("",!0),t("span",Xc,x(e.label),1),e.badge?(d(),h("span",Qc,x(e.badge),1)):N("",!0),ys(i.$slots,"right",{},void 0),e.chevron?(d(),Y(ze(k(ii)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):N("",!0)],10,Jc))}}),ps=pe(Zc,[["__scopeId","data-v-682bc042"]]),eu={class:"drawer-header"},tu={class:"drawer-profile"},nu={class:"drawer-profile-bottom"},su={class:"drawer-profile-info"},au={class:"drawer-display-name"},iu={class:"drawer-username"},ou={class:"drawer-nav"},lu={key:0,class:"drawer-divider"},ru=["onClick"],cu={class:"menu-item__label"},uu=["aria-checked"],du=ae({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:s}){const n=s,i=bs(),a=Le(),o=gt(),l={user:As,users:tn,megaphone:En,bookmark:ai,settings:gi,moon:fi,download:oi,"log-out":Tn,star:ki},r=V(()=>({isAuthenticated:!!a.user,isDesktop:!0})),u=V(()=>Yc(r.value)),b={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const m=o.theme==="dark"?"light":"dark";o.applyTheme(m),o.saveSettings({theme:m})},openDownload:()=>n("openDownload"),logout:()=>{a.logout(),i.push("/login")}};function p(m){m&&b[m]&&b[m]()}return(m,f)=>(d(),h("div",{class:ue(["drawer",{open:e.open}])},[t("div",eu,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:f[0]||(f[0]=c=>n("close"))},[z(k(Be),{size:20,"stroke-width":2})]),f[2]||(f[2]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",tu,[z(_e,{name:k(a).user?.display_name||k(a).user?.username||"?",url:k(a).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",nu,[t("div",su,[t("div",au,x(k(a).user?.display_name||k(a).user?.username||"---"),1),t("div",iu,"@"+x(k(a).user?.username||"---"),1)]),t("button",{class:"icon-btn drawer-edit-btn","aria-label":"Edit profile",onClick:f[1]||(f[1]=c=>n("openProfile"))},[z(k(In),{size:18,"stroke-width":2})])])]),t("nav",ou,[(d(!0),h(oe,null,ye(u.value,c=>(d(),h(oe,{key:c.id},[c.separator?(d(),h("div",lu)):N("",!0),c.rightSlot==="toggle"?(d(),h("div",{key:1,class:"menu-item menu-item--toggle",onClick:v=>p(c.action)},[(d(),Y(ze(l[c.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",cu,x(c.label),1),t("span",{class:ue(["toggle-switch",{"toggle-switch--on":k(o).theme==="dark"}]),role:"switch","aria-checked":k(o).theme==="dark"},[...f[3]||(f[3]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,uu)],8,ru)):c.id==="logout"?(d(),Y(ps,{key:2,icon:l[c.icon],label:c.label,danger:"",onClick:v=>p(c.action)},null,8,["icon","label","onClick"])):(d(),Y(ps,{key:3,icon:l[c.icon],label:c.label,onClick:v=>p(c.action)},null,8,["icon","label","onClick"]))],64))),128))]),f[4]||(f[4]=t("div",{class:"drawer-footer"},"BeHappy v2",-1))],2))}}),vu=pe(du,[["__scopeId","data-v-db1ed91e"]]),mu={class:"modal"},fu={class:"modal-header"},pu={class:"modal-body"},hu={key:0,class:"chat-type-cards"},gu={class:"chat-type-icon"},yu={class:"chat-type-icon"},bu={class:"chat-type-icon"},ku={key:1,class:"new-chat-form"},wu={class:"user-pick-list"},_u={key:0,class:"empty-state-small"},Cu={key:1,class:"empty-state-small"},$u=["onClick"],Su={class:"user-pick-name"},Mu={class:"user-pick-handle"},xu={key:2,class:"new-chat-form"},Tu={class:"form-group"},Eu={class:"form-group"},Iu={class:"form-group"},Lu={class:"user-pick-list"},Au=["onClick"],Ru={class:"user-pick-name"},Du={class:"user-pick-handle"},Ou={class:"modal-actions"},Pu=["disabled"],Nu={key:3,class:"new-chat-form"},Uu={class:"form-group"},Fu={class:"form-group"},zu={class:"form-group"},Bu={class:"modal-actions"},Hu=["disabled"],ju=ae({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:s}){const n=e,i=s,a=Le(),{showToast:o}=Te(),l=y(n.initialStep),r=y(!1),u=y(""),b=y([]),p=y(!1);let m=null;const f=y(""),c=y(""),v=y(""),g=y([]),T=y(new Set);let C=null;const _=y(""),O=y(""),U=y("");Ce(()=>{F("")});async function F(j){p.value=!0;try{const I=await es(j);b.value=I.filter(W=>W.id!==a.user?.id)}catch{b.value=[]}finally{p.value=!1}}function P(){m&&clearTimeout(m),m=setTimeout(()=>F(u.value),300)}async function Z(j){try{g.value=await es(j)}catch{g.value=[]}}function re(){C&&clearTimeout(C),C=setTimeout(()=>Z(v.value),300)}function E(j){T.value.has(j)?T.value.delete(j):T.value.add(j)}async function S(j){r.value=!0;try{const I=await rt({type:"direct",member_ids:[j]});i("chatCreated",I.id)}catch{o("Failed to start conversation")}finally{r.value=!1}}async function B(){if(!f.value.trim()){o("Group name is required");return}r.value=!0;try{const j=await rt({type:"group",title:f.value.trim(),description:c.value.trim(),member_ids:Array.from(T.value)});o("Group created!"),i("chatCreated",j.id)}catch{o("Failed to create group")}finally{r.value=!1}}async function Q(){if(!_.value.trim()){o("Channel name is required");return}r.value=!0;try{const j=await rt({type:"channel",title:_.value.trim(),description:U.value.trim(),public_name:O.value.trim()||void 0,member_ids:[]});o("Channel created!"),i("chatCreated",j.id)}catch{o("Failed to create channel")}finally{r.value=!1}}return(j,I)=>(d(),h("div",{class:"modal-backdrop",onClick:I[14]||(I[14]=ce(W=>i("close"),["self"]))},[t("div",mu,[t("div",fu,[I[15]||(I[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:I[0]||(I[0]=W=>i("close"))},[z(k(Be),{size:20})])]),t("div",pu,[l.value==="select"?(d(),h("div",hu,[t("button",{class:"chat-type-card",onClick:I[1]||(I[1]=W=>l.value="direct")},[t("span",gu,[z(k(As),{size:24})]),I[16]||(I[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:I[2]||(I[2]=W=>l.value="group")},[t("span",yu,[z(k(tn),{size:24})]),I[17]||(I[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:I[3]||(I[3]=W=>l.value="channel")},[t("span",bu,[z(k(En),{size:24})]),I[18]||(I[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):N("",!0),l.value==="direct"?(d(),h("div",ku,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:I[4]||(I[4]=W=>l.value="select")},[z(k(Fe),{size:16}),I[19]||(I[19]=ke(" Back ",-1))]),me(t("input",{"onUpdate:modelValue":I[5]||(I[5]=W=>u.value=W),class:"search-input",type:"search",placeholder:"Search users...",onInput:P},null,544),[[be,u.value]]),t("div",wu,[p.value?(d(),h("div",_u,"Loading users...")):b.value.length===0?(d(),h("div",Cu,"No users found.")):(d(!0),h(oe,{key:2},ye(b.value,W=>(d(),h("div",{key:W.id,class:"user-pick-item",onClick:ve=>S(W.id)},[z(_e,{name:W.display_name||W.username,url:W.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Su,x(W.display_name||W.username),1),t("div",Mu,"@"+x(W.username),1)])],8,$u))),128))])])):N("",!0),l.value==="group"?(d(),h("div",xu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:I[6]||(I[6]=W=>l.value="select")},[z(k(Fe),{size:16}),I[20]||(I[20]=ke(" Back ",-1))]),t("div",Tu,[I[21]||(I[21]=t("label",{class:"form-label"},"Group name",-1)),me(t("input",{"onUpdate:modelValue":I[7]||(I[7]=W=>f.value=W),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[be,f.value]])]),t("div",Eu,[I[22]||(I[22]=t("label",{class:"form-label"},"Description (optional)",-1)),me(t("textarea",{"onUpdate:modelValue":I[8]||(I[8]=W=>c.value=W),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[be,c.value]])]),t("div",Iu,[I[23]||(I[23]=t("label",{class:"form-label"},"Add members",-1)),me(t("input",{"onUpdate:modelValue":I[9]||(I[9]=W=>v.value=W),class:"search-input",type:"search",placeholder:"Search users...",onInput:re},null,544),[[be,v.value]]),t("div",Lu,[(d(!0),h(oe,null,ye(g.value,W=>(d(),h("div",{key:W.id,class:ue(["user-pick-item",{selected:T.value.has(W.id)}]),onClick:ve=>E(W.id)},[z(_e,{name:W.display_name||W.username,url:W.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Ru,[T.value.has(W.id)?(d(),Y(k(xs),{key:0,size:14,style:{"margin-right":"4px"}})):N("",!0),ke(x(W.display_name||W.username),1)]),t("div",Du,"@"+x(W.username),1)])],10,Au))),128))])]),t("div",Ou,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:B}," Create Group ",8,Pu)])])):N("",!0),l.value==="channel"?(d(),h("div",Nu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:I[10]||(I[10]=W=>l.value="select")},[z(k(Fe),{size:16}),I[24]||(I[24]=ke(" Back ",-1))]),t("div",Uu,[I[25]||(I[25]=t("label",{class:"form-label"},"Channel name",-1)),me(t("input",{"onUpdate:modelValue":I[11]||(I[11]=W=>_.value=W),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[be,_.value]])]),t("div",Fu,[I[26]||(I[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),me(t("input",{"onUpdate:modelValue":I[12]||(I[12]=W=>O.value=W),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[be,O.value]]),I[27]||(I[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",zu,[I[28]||(I[28]=t("label",{class:"form-label"},"Description (optional)",-1)),me(t("textarea",{"onUpdate:modelValue":I[13]||(I[13]=W=>U.value=W),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[be,U.value]])]),t("div",Bu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:Q}," Create Channel ",8,Hu)])])):N("",!0)])])]))}}),Vu={class:"profile-info-list"},Wu=["onClick"],qu={class:"profile-info-item__content"},Gu={class:"profile-info-item__value"},Ku={class:"profile-info-item__label"},Yu=ae({__name:"ProfileInfoList",props:{username:{},bio:{},userId:{}},setup(e){const s=e,n=y(null),i=V(()=>{const o=[];return s.username&&o.push({icon:si,label:"Username",value:`@${s.username}`,copyable:!0}),s.bio&&o.push({icon:Es,label:"Bio",value:s.bio}),s.userId!=null&&o.push({icon:ri,label:"User ID",value:String(s.userId),copyable:!0}),o});async function a(o){try{await navigator.clipboard.writeText(o.replace(/^@/,""));const l=i.value.find(r=>r.value===o)?.label??null;n.value=l,setTimeout(()=>{n.value=null},1500)}catch{}}return(o,l)=>(d(),h("div",Vu,[(d(!0),h(oe,null,ye(i.value,r=>(d(),h("div",{key:r.label,class:ue(["profile-info-item",{"profile-info-item--copyable":r.copyable}]),onClick:u=>r.copyable?a(r.value):void 0},[(d(),Y(ze(r.icon),{class:"profile-info-item__icon",size:20,"stroke-width":1.8})),t("div",qu,[t("span",Gu,x(r.value),1),t("span",Ku,x(r.label),1)]),r.copyable?(d(),Y(ze(n.value===r.label?k(xs):k(Ts)),{key:0,class:"profile-info-item__copy",size:16,"stroke-width":1.8})):N("",!0)],10,Wu))),128))]))}}),Vs=pe(Yu,[["__scopeId","data-v-bc174e9a"]]),Ju={class:"profile-media-tabs"},Xu={class:"profile-media-tabs__header"},Qu=["onClick"],Zu={key:0,class:"profile-media-tabs__count"},ed={key:0,class:"profile-media-tabs__content"},td={class:"profile-media-tabs__empty"},nd={class:"profile-media-tabs__empty-text"},sd=ae({__name:"ProfileMediaTabs",setup(e){const s=[{key:"media",label:"Media",count:0,emptyIcon:Is},{key:"files",label:"Files",count:0,emptyIcon:Es},{key:"links",label:"Links",count:0,emptyIcon:ci},{key:"voice",label:"Voice",count:0,emptyIcon:mi}],n=y("media"),i=V(()=>s.findIndex(l=>l.key===n.value)),a=V(()=>s[i.value]??s[0]),o=V(()=>({width:`${100/s.length}%`,transform:`translateX(${i.value*100}%)`}));return(l,r)=>(d(),h("div",Ju,[t("div",Xu,[(d(),h(oe,null,ye(s,u=>t("button",{key:u.key,class:ue(["profile-media-tabs__tab",{"profile-media-tabs__tab--active":n.value===u.key}]),onClick:b=>n.value=u.key},[ke(x(u.label)+" ",1),u.count!==void 0?(d(),h("span",Zu,x(u.count),1)):N("",!0)],10,Qu)),64)),t("div",{class:"profile-media-tabs__indicator",style:nt(o.value)},null,4)]),a.value?(d(),h("div",ed,[t("div",td,[(d(),Y(ze(a.value.emptyIcon),{size:40,"stroke-width":1.2,class:"profile-media-tabs__empty-icon"})),t("span",nd," No "+x(a.value.label.toLowerCase())+" yet ",1)])])):N("",!0)]))}}),ad=pe(sd,[["__scopeId","data-v-bb3b131e"]]),id={class:"modal profile-modal profile-modal--self"},od={key:"view"},ld={class:"profile-header"},rd={class:"profile-header__content"},cd={class:"profile-header__info"},ud={class:"profile-name"},dd={class:"profile-modal-body"},vd={key:"edit"},md={class:"profile-edit-header"},fd={class:"profile-modal-body profile-modal-body--scrollable"},pd={class:"profile-avatar-section profile-avatar-upload-section"},hd={class:"profile-avatar-overlay"},gd={class:"profile-info-list"},yd={class:"form-group"},bd={class:"form-group"},kd={key:0,class:"form-hint form-error"},wd={class:"form-group"},_d=ae({__name:"ProfileModal",emits:["close"],setup(e,{emit:s}){const n=s,i=Le(),a=xe(),{showToast:o}=Te(),l=y("view"),r=y("profile-slide-left"),u=y(""),b=y(""),p=y(""),m=y(""),f=y(null),c=V(()=>i.user?a.isUserOnline(i.user.id):!1),v=V(()=>{if(c.value)return"online";if(!i.user)return"offline";const U=a.getUserPresence(i.user.id);return U?.lastSeenAt?An(U.lastSeenAt):U?.lastSeenBucket?`last seen ${U.lastSeenBucket}`:"offline"});function g(){i.user&&(u.value=i.user.display_name||"",b.value=i.user.username,p.value=i.user.bio||""),m.value=""}function T(){g(),r.value="profile-slide-left",l.value="edit"}function C(){r.value="profile-slide-right",l.value="view"}async function _(){const U=f.value?.files?.[0];if(U){try{const F=await Ln(U),P=await Ja(F.id);i.updateUser({avatar_url:P.avatar_url}),o("Avatar updated!")}catch{o("Upload failed")}f.value&&(f.value.value="")}}async function O(){if(m.value="",!i.user)return;const U={display_name:u.value.trim(),bio:p.value.trim()};b.value.trim()&&b.value.trim()!==i.user.username&&(U.username=b.value.trim());try{const F=await Ya(i.user.id,U);i.updateUser({display_name:F.display_name,username:F.username}),o("Profile saved!"),n("close")}catch(F){F.response?.status===409?m.value="Username already taken":o("Save failed")}}return(U,F)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:F[5]||(F[5]=ce(P=>n("close"),["self"]))},[t("div",id,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:F[0]||(F[0]=P=>n("close"))},[z(k(Be),{size:20,"stroke-width":2})]),l.value==="view"?(d(),h("button",{key:0,class:"icon-btn profile-edit-btn","aria-label":"Edit profile",onClick:T},[z(k(In),{size:18,"stroke-width":2})])):N("",!0),z(xn,{name:r.value,mode:"out-in"},{default:en(()=>[l.value==="view"?(d(),h("div",od,[t("div",ld,[F[6]||(F[6]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",rd,[z(_e,{name:k(i).user?.display_name||k(i).user?.username||"?",url:k(i).user?.avatar_url,online:c.value,size:"xxl"},null,8,["name","url","online"]),t("div",cd,[t("div",ud,[ke(x(k(i).user?.display_name||k(i).user?.username||"?")+" ",1),k(i).user?.is_admin?(d(),Y(zn,{key:0})):N("",!0)]),t("div",{class:ue(["profile-status",{"profile-status--online":c.value}])},x(v.value),3)])])]),t("div",dd,[z(Vs,{username:k(i).user?.username,bio:k(i).user?.bio,"user-id":k(i).user?.id},null,8,["username","bio","user-id"]),z(ad)])])):(d(),h("div",vd,[t("div",md,[t("button",{class:"icon-btn","aria-label":"Back",onClick:C},[z(k(Fe),{size:20,"stroke-width":2})]),F[7]||(F[7]=t("span",{class:"profile-edit-header__title"},"Edit Profile",-1))]),t("div",fd,[t("div",pd,[t("div",{class:"profile-avatar-upload-wrap",onClick:F[1]||(F[1]=P=>f.value?.click())},[z(_e,{name:u.value||k(i).user?.username||"?",url:k(i).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",hd,[z(k(Ms),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",class:"hidden",onChange:_},null,544)]),t("div",gd,[t("div",yd,[F[8]||(F[8]=t("label",{class:"form-label"},"Display name",-1)),me(t("input",{"onUpdate:modelValue":F[2]||(F[2]=P=>u.value=P),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[be,u.value]])]),t("div",bd,[F[9]||(F[9]=t("label",{class:"form-label"},"Username",-1)),me(t("input",{"onUpdate:modelValue":F[3]||(F[3]=P=>b.value=P),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[be,b.value]]),m.value?(d(),h("small",kd,x(m.value),1)):N("",!0)]),t("div",wd,[F[10]||(F[10]=t("label",{class:"form-label"},"Bio",-1)),me(t("textarea",{"onUpdate:modelValue":F[4]||(F[4]=P=>p.value=P),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[be,p.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:O},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:C},"Cancel")])])]))]),_:1},8,["name"])])]))}}),Cd=pe(_d,[["__scopeId","data-v-59263597"]]),$d={class:"profile-actions"},Sd=["disabled","onClick"],Md={class:"profile-action-btn__circle"},xd={class:"profile-action-btn__label"},Td=ae({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:s}){const n=e,i=s,a=V(()=>{const o=[{icon:vi,label:"Message",event:"message"}];return n.showMute!==!1&&o.push({icon:Ss,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&o.push({icon:li,label:"More",event:"more"}),o});return(o,l)=>(d(),h("div",$d,[(d(!0),h(oe,null,ye(a.value,r=>(d(),h("button",{key:r.label,class:ue(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:u=>i(r.event)},[t("span",Md,[(d(),Y(ze(r.icon),{size:22,"stroke-width":1.8}))]),t("span",xd,x(r.label),1)],10,Sd))),128))]))}}),Ed=pe(Td,[["__scopeId","data-v-a16c1098"]]),Id={class:"modal profile-modal"},Ld={key:0,class:"profile-modal-body"},Ad={class:"profile-header"},Rd={class:"profile-header__content"},Dd={class:"profile-header__info"},Od={class:"profile-name"},Pd={class:"profile-modal-body"},Nd={class:"profile-media-tabs"},Ud=["onClick"],Fd={class:"profile-media-empty"},zd={key:2,class:"profile-modal-body"},Bd=ae({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:s}){const n=e,i=s,a=xe(),{showToast:o}=Te(),l=y(null),r=y(!0),u=y(!1),b=["Media","Files","Links"],p=y("Media"),m=V(()=>l.value?a.isUserOnline(l.value.id):!1),f=V(()=>{if(m.value)return"online";if(!l.value)return"offline";const v=a.getUserPresence(l.value.id);return v?.lastSeenAt?An(v.lastSeenAt):v?.lastSeenBucket?`last seen ${v.lastSeenBucket}`:"offline"});Ce(async()=>{try{l.value=await $s(n.username)}catch{l.value=null}finally{r.value=!1}});function c(){u.value=!u.value,o(u.value?"User muted":"User unmuted")}return(v,g)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:g[2]||(g[2]=ce(T=>i("close"),["self"]))},[t("div",Id,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:g[0]||(g[0]=T=>i("close"))},[z(k(Be),{size:20,"stroke-width":2})]),r.value?(d(),h("div",Ld,[...g[3]||(g[3]=[t("div",{class:"profile-loading"},[t("p",null,"Loading...")],-1)])])):l.value?(d(),h(oe,{key:1},[t("div",Ad,[g[4]||(g[4]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",Rd,[z(_e,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:m.value,size:"xxl"},null,8,["name","url","online"]),t("div",Dd,[t("div",Od,[ke(x(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(d(),Y(zn,{key:0})):N("",!0)]),t("div",{class:ue(["profile-status",{"profile-status--online":m.value}])},x(f.value),3)])])]),t("div",Pd,[z(Ed,{muted:u.value,"show-more":!1,onMessage:g[1]||(g[1]=T=>i("message",l.value.username)),onMute:c},null,8,["muted"]),g[5]||(g[5]=t("div",{class:"profile-divider"},null,-1)),z(Vs,{username:l.value.username,bio:l.value.bio,"user-id":l.value.id},null,8,["username","bio","user-id"]),t("div",Nd,[(d(),h(oe,null,ye(b,T=>t("button",{key:T,class:ue(["profile-media-tab",{"profile-media-tab--active":p.value===T}]),onClick:C=>p.value=T},x(T),11,Ud)),64))]),t("div",Fd,[z(k(Is),{size:32,"stroke-width":1.5}),t("span",null,"No "+x(p.value.toLowerCase())+" yet",1)])])],64)):(d(),h("div",zd,[...g[6]||(g[6]=[t("div",{class:"profile-loading"},[t("p",null,"User not found")],-1)])]))])]))}}),Hd=pe(Bd,[["__scopeId","data-v-1e27c432"]]),jd={class:"modal",style:{"max-width":"420px"}},Vd={class:"modal-header"},Wd={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},qd=ae({__name:"DownloadModal",emits:["close"],setup(e,{emit:s}){const n=s,i=navigator.userAgent.toLowerCase(),a=i.includes("win"),o=i.includes("mac")&&!i.includes("iphone")&&!i.includes("ipad"),l=V(()=>a?"Windows":o?"macOS":null);function r(){a?window.location.href="/downloads/windows/BeHappySetup.exe":o&&(window.location.href="/downloads/macos/BeHappy.dmg")}return(u,b)=>(d(),h("div",{class:"modal-backdrop",onClick:b[1]||(b[1]=ce(p=>n("close"),["self"]))},[t("div",jd,[t("div",Vd,[b[2]||(b[2]=t("h2",{class:"modal-title"},"Download BeHappy",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:b[0]||(b[0]=p=>n("close"))},[z(k(Be),{size:20})])]),t("div",Wd,[l.value?(d(),h("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+x(l.value),1)):N("",!0),b[3]||(b[3]=fa('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/BeHappySetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/BeHappy.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),Gd={class:"modal",style:{"max-width":"400px"}},Kd={class:"modal-header"},Yd={class:"modal-body",style:{"text-align":"center"}},Jd={key:0},Xd={style:{"font-size":"1.25rem","font-weight":"700"}},Qd={style:{color:"var(--text-muted)","margin-top":".5rem"}},Zd={class:"profile-avatar-section"},ev={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},tv={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},nv={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},sv={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},av=["disabled"],iv=ae({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:s}){const n=e,i=s,{showToast:a}=Te(),o=y(null),l=y(!0),r=y(!1),u=y(""),b=y("");Ce(async()=>{if(!n.token){u.value="Invalid Link",b.value="No invite token provided.",l.value=!1;return}try{o.value=await ka(n.token)}catch(m){m.response?.status===410?(u.value="Invite Revoked",b.value="This invite link has been revoked."):(u.value="Invite Not Found",b.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function p(){r.value=!0;try{const m=await wa(n.token);a(m.already_member?"You are already a member":"Joined successfully!"),i("joined",m.chat_id)}catch(m){a(m.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(m,f)=>(d(),h("div",{class:"modal-backdrop",onClick:f[2]||(f[2]=ce(c=>i("close"),["self"]))},[t("div",Gd,[t("div",Kd,[f[3]||(f[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:f[0]||(f[0]=c=>i("close"))},"âœ•")]),t("div",Yd,[l.value?(d(),h("p",Jd,"Loading invite preview...")):b.value?(d(),h(oe,{key:1},[t("h2",Xd,x(u.value),1),t("p",Qd,x(b.value),1)],64)):o.value?(d(),h(oe,{key:2},[t("div",Zd,[z(_e,{name:o.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",ev,x(o.value.title||o.value.type||"Chat"),1),o.value.description?(d(),h("p",tv,x(o.value.description),1)):N("",!0),o.value.member_count?(d(),h("p",nv,x(o.value.member_count)+" members ",1)):N("",!0),t("div",sv,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:p},x(r.value?"Joining...":"Join"),9,av),t("button",{class:"btn btn-ghost",onClick:f[1]||(f[1]=c=>i("close"))},"Cancel")])],64)):N("",!0)])])]))}}),ov={class:"modal modal-wide settings-modal"},lv={class:"modal-header"},rv={class:"modal-body"},cv={class:"settings-profile-header"},uv={class:"settings-profile-info"},dv={class:"settings-display-name"},vv={class:"settings-username"},mv={class:"settings-group"},fv={class:"settings-section-title"},pv={class:"menu-item menu-item--setting"},hv={class:"settings-group"},gv={class:"settings-section-title"},yv=["aria-checked"],bv={class:"settings-group"},kv={class:"settings-section-title"},wv={class:"menu-item menu-item--setting"},_v={class:"settings-group"},Cv={class:"settings-section-title"},$v={class:"menu-item menu-item--setting"},Sv=["aria-checked"],Mv={class:"settings-actions"},xv=ae({__name:"SettingsView",emits:["close"],setup(e,{emit:s}){const n=s,i=Le(),a=gt(),{showToast:o}=Te(),l=y("light"),r=y(!0),u=y("en"),b=y("everyone"),p=y(!0);Oe(r,async f=>{f&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(r.value=!1,o("Notifications blocked by browser"))}),Ce(()=>{l.value=a.theme,r.value=a.notificationsEnabled,u.value=a.language,b.value=a.lastSeenVisibility,p.value=a.readReceiptsEnabled});async function m(){try{await a.saveSettings({theme:l.value,notifications_enabled:r.value,language:u.value,last_seen_visibility:b.value,read_receipts_enabled:p.value}),o("Settings saved"),n("close")}catch{o("Failed to save settings")}}return(f,c)=>(d(),h("div",{class:"modal-backdrop",onClick:c[8]||(c[8]=ce(v=>n("close"),["self"]))},[t("div",ov,[t("div",lv,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=v=>n("close"))},[z(k(Fe),{size:20,"stroke-width":2})]),c[9]||(c[9]=t("span",{class:"modal-title"},"Settings",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[1]||(c[1]=v=>n("close"))},[z(k(Be),{size:20,"stroke-width":2})])]),t("div",rv,[t("div",cv,[z(_e,{name:k(i).user?.display_name||k(i).user?.username||"?",url:k(i).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",uv,[t("div",dv,x(k(i).user?.display_name||k(i).user?.username||"---"),1),t("div",vv,"@"+x(k(i).user?.username||"---"),1)])]),c[24]||(c[24]=t("div",{class:"settings-divider"},null,-1)),t("div",mv,[t("div",fv,[z(k(os),{size:18,"stroke-width":1.8}),c[10]||(c[10]=t("span",null,"Appearance",-1))]),t("div",pv,[z(k(os),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[12]||(c[12]=t("span",{class:"menu-item__label"},"Theme",-1)),me(t("select",{"onUpdate:modelValue":c[2]||(c[2]=v=>l.value=v),class:"form-input form-select settings-select"},[...c[11]||(c[11]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[rn,l.value]])])]),c[25]||(c[25]=t("div",{class:"settings-divider"},null,-1)),t("div",hv,[t("div",gv,[z(k(ss),{size:18,"stroke-width":1.8}),c[13]||(c[13]=t("span",null,"Notifications",-1))]),t("div",{class:"menu-item menu-item--toggle",onClick:c[3]||(c[3]=v=>r.value=!r.value)},[z(k(ss),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[15]||(c[15]=t("span",{class:"menu-item__label"},"Notifications",-1)),t("span",{class:ue(["toggle-status",{"toggle-status--on":r.value}])},x(r.value?"Enabled":"Disabled"),3),t("span",{class:ue(["toggle-switch",{"toggle-switch--on":r.value}]),role:"switch","aria-checked":r.value},[...c[14]||(c[14]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,yv)])]),c[26]||(c[26]=t("div",{class:"settings-divider"},null,-1)),t("div",bv,[t("div",kv,[z(k(is),{size:18,"stroke-width":1.8}),c[16]||(c[16]=t("span",null,"Language",-1))]),t("div",wv,[z(k(is),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[18]||(c[18]=t("span",{class:"menu-item__label"},"Language",-1)),me(t("select",{"onUpdate:modelValue":c[4]||(c[4]=v=>u.value=v),class:"form-input form-select settings-select"},[...c[17]||(c[17]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[rn,u.value]])])]),c[27]||(c[27]=t("div",{class:"settings-divider"},null,-1)),t("div",_v,[t("div",Cv,[z(k(cn),{size:18,"stroke-width":1.8}),c[19]||(c[19]=t("span",null,"Privacy",-1))]),t("div",$v,[(d(),Y(ze(b.value==="nobody"?k(as):k(cn)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[21]||(c[21]=t("span",{class:"menu-item__label"},"Last Seen & Online",-1)),me(t("select",{"onUpdate:modelValue":c[5]||(c[5]=v=>b.value=v),class:"form-input form-select settings-select"},[...c[20]||(c[20]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[rn,b.value]])]),t("div",{class:"menu-item menu-item--toggle",onClick:c[6]||(c[6]=v=>p.value=!p.value)},[(d(),Y(ze(p.value?k(cn):k(as)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[23]||(c[23]=t("span",{class:"menu-item__label"},"Read Receipts",-1)),t("span",{class:ue(["toggle-status",{"toggle-status--on":p.value}])},x(p.value?"Enabled":"Disabled"),3),t("span",{class:ue(["toggle-switch",{"toggle-switch--on":p.value}]),role:"switch","aria-checked":p.value},[...c[22]||(c[22]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Sv)])]),c[28]||(c[28]=t("div",{class:"settings-divider"},null,-1)),t("div",Mv,[t("button",{class:"btn btn-primary",onClick:m},"Save Settings"),t("button",{class:"btn btn-ghost",onClick:c[7]||(c[7]=v=>n("close"))},"Cancel")])])])]))}}),Tv=pe(xv,[["__scopeId","data-v-3b2634a6"]]),Ev=ae({__name:"ContextMenu",setup(e){const s=xe(),{showToast:n}=Te(),{showConfirm:i}=pa(),a=y(!1),o=y(0),l=y(0),r=y(null),u=V(()=>r.value?s.chats.find(g=>g.id===r.value)??null:null);function b(g){r.value=g.detail.chatId,o.value=g.detail.x,l.value=g.detail.y,a.value=!0}function p(){a.value&&(a.value=!1,r.value=null)}Ce(()=>{window.addEventListener("show-context-menu",b),document.addEventListener("click",p)}),Ge(()=>{window.removeEventListener("show-context-menu",b),document.removeEventListener("click",p)});async function m(){if(r.value){a.value=!1;try{await s.toggleFavorite(r.value)}catch{n("Failed to update favorite")}}}async function f(){if(r.value){a.value=!1;try{await s.toggleMute(r.value)}catch{n("Failed to update mute")}}}async function c(){if(!(!r.value||(a.value=!1,!await i({title:"Leave Chat",message:"Leave this chat?",confirmLabel:"Leave",danger:!0}))))try{await s.leave(r.value),n("Left chat")}catch{n("Failed to leave chat")}}async function v(){if(!(!r.value||(a.value=!1,!await i({title:"Delete Chat",message:"Delete this chat? All messages will be permanently removed.",confirmLabel:"Delete",danger:!0}))))try{await s.deleteChat(r.value),n("Chat deleted")}catch{n("Failed to delete chat")}}return(g,T)=>a.value?(d(),h("div",{key:0,class:"context-menu",style:nt({left:o.value+"px",top:l.value+"px"})},[t("button",{class:"ctx-item",onClick:m},x(u.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:f},x(u.value?.is_muted?"Unmute":"Mute"),1),u.value&&u.value.type!=="direct"?(d(),h("button",{key:0,class:"ctx-item ctx-leave",onClick:c}," Leave chat ")):N("",!0),t("button",{class:"ctx-item ctx-delete",onClick:v}," Delete chat ")],4)):N("",!0)}}),hs=240,Iv=.5,Rv=ae({__name:"MessengerView",setup(e){const s=ha(),n=bs(),i=Le(),a=xe(),o=gt(),l=Xe(),{showToast:r}=Te(),{connect:u,disconnect:b,sendTyping:p}=Ka();lt("sendTyping",p);const m=y(!1),f=y(!1),c=y("select"),v=y(!1),g=y(!1),T=y(!1),C=y(null),_=y(null),O=y([]),U=y(null);lt("stickers",O),lt("pendingScrollMessageId",U);let F=null;Ce(async()=>{await o.loadSettings();try{O.value=await Xa()}catch{}await a.loadChats(),u(),F=setInterval(()=>a.loadChats(),5e3),P()}),Ge(()=>{b(),F&&(clearInterval(F),F=null)}),Oe(()=>s.path,()=>{P()}),Oe(()=>a.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function P(){const K=s.path;if(K.startsWith("/@")){const $=s.params.username;$&&(C.value=$)}else if(K.startsWith("/u/")){const $=s.params.id;if($)try{const G=await Cs(parseInt($));C.value=G.username}catch{r("User not found")}}else if(K.startsWith("/dm/")){const $=s.params.id;$&&await Z($)}else if(K.startsWith("/c/")){const $=s.params.chatIdOrName||s.params.name,G=s.params.messageId?parseInt(s.params.messageId):null;if($)if(/^\d+$/.test($)){const le=parseInt($);G?await E(le,G):a.setActiveChat(le)}else await re($)}}async function Z(K){try{let $;if(K.startsWith("@")){const ee=K.substring(1);$=(await $s(ee)).id}else $=parseInt(K);const G=await rt({type:"direct",member_ids:[$]});await a.loadChats(),a.setActiveChat(G.id)}catch{r("Failed to open conversation")}}async function re(K){try{const $=await Ca(K);a.chats.find(ee=>ee.id===$.id)?a.setActiveChat($.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function E(K,$){if(!a.chats.find(ee=>ee.id===K)){r("Chat not found");return}a.setActiveChat(K),await Se(),U.value=$}const S=parseInt(localStorage.getItem("sidebar-width")||"360",10);S>=hs&&document.documentElement.style.setProperty("--sidebar-width",S+"px");function B(K){K.preventDefault();const $=K.currentTarget;$.setPointerCapture(K.pointerId);const G=le=>{const $e=window.innerWidth*Iv,Ae=Math.min($e,Math.max(hs,le.clientX));document.documentElement.style.setProperty("--sidebar-width",Ae+"px")},ee=()=>{$.removeEventListener("pointermove",G),$.removeEventListener("pointerup",ee);const le=getComputedStyle(document.documentElement).getPropertyValue("--sidebar-width").trim();localStorage.setItem("sidebar-width",parseInt(le,10).toString())};$.addEventListener("pointermove",G),$.addEventListener("pointerup",ee)}function Q(K){a.setActiveChat(K),n.replace("/app")}function j(){a.setActiveChat(null)}function I(){m.value=!1,v.value=!0}function W(){m.value=!1,g.value=!0}function ve(){m.value=!1,c.value="group",f.value=!0}function fe(){m.value=!1,c.value="channel",f.value=!0}async function M(){if(m.value=!1,!!i.user)try{const K=await rt({type:"direct",member_ids:[i.user.id]});await a.loadChats(),a.setActiveChat(K.id)}catch{r("Failed to open Saved Messages")}}function D(K){C.value=K}async function q(K){C.value=null,await Z("@"+K)}async function H(K){f.value=!1,await a.loadChats(),a.setActiveChat(K)}async function se(K){_.value=null,await a.loadChats(),a.setActiveChat(K)}function ie(K){const $=K.target?.closest("a");if(!$)return;const G=$.getAttribute("href");if(!G)return;let ee;try{ee=new URL(G,window.location.origin)}catch{return}if(ee.origin!==window.location.origin){K.preventDefault(),K.stopPropagation(),window.open(ee.href,"_blank");return}K.preventDefault(),K.stopPropagation();const le=ee.pathname,$e=le.match(/^\/join\/([^/]+)$/);if($e){_.value=$e[1]??null;return}if(le.startsWith("/@")||le.startsWith("/u/")||le.startsWith("/dm/")||le.startsWith("/c/")){n.push(le);return}n.push(le)}function de(K){if(K.key==="Escape"){if(_.value){_.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if(C.value){C.value=null;return}if(f.value){f.value=!1;return}if(v.value){v.value=!1;return}if(g.value){g.value=!1;return}if(T.value){T.value=!1;return}if(m.value){m.value=!1;return}if(a.activeChatId!==null){j();return}}}return Ce(()=>{document.addEventListener("keydown",de),document.addEventListener("click",ie,!0)}),Ge(()=>{document.removeEventListener("keydown",de),document.removeEventListener("click",ie,!0)}),(K,$)=>(d(),h("div",{class:ue(["layout",{"chat-open":!!k(a).activeChatId}])},[z(vu,{open:m.value,onClose:$[0]||($[0]=G=>m.value=!1),onOpenProfile:I,onOpenSettings:W,onOpenNewGroup:ve,onOpenNewChannel:fe,onOpenFavorites:M,onOpenDownload:$[1]||($[1]=G=>T.value=!0)},null,8,["open"]),t("div",{class:ue(["drawer-overlay",{visible:m.value}]),onClick:$[2]||($[2]=G=>m.value=!1)},null,2),z(Fi,{onOpenDrawer:$[3]||($[3]=G=>m.value=!0),onOpenNewChat:$[4]||($[4]=G=>{c.value="select",f.value=!0}),onSelectChat:Q}),t("div",{class:"resize-handle",onPointerdown:B},null,32),z(Gc,{onBack:j,onOpenUserProfile:D}),f.value?(d(),Y(ju,{key:0,"initial-step":c.value,onClose:$[5]||($[5]=G=>f.value=!1),onChatCreated:H},null,8,["initial-step"])):N("",!0),v.value?(d(),Y(Cd,{key:1,onClose:$[6]||($[6]=G=>v.value=!1)})):N("",!0),g.value?(d(),Y(Tv,{key:2,onClose:$[7]||($[7]=G=>g.value=!1)})):N("",!0),C.value?(d(),Y(Hd,{key:3,username:C.value,onClose:$[8]||($[8]=G=>C.value=null),onMessage:q},null,8,["username"])):N("",!0),T.value?(d(),Y(qd,{key:4,onClose:$[9]||($[9]=G=>T.value=!1)})):N("",!0),_.value?(d(),Y(iv,{key:5,token:_.value,onClose:$[10]||($[10]=G=>_.value=null),onJoined:se},null,8,["token"])):N("",!0),z(Ev)],2))}});export{Rv as default};
