import{k as Y,l as Qe,r as b,m as j,n as Zs,p as Ve,u as xe,q as cn,d as ee,o as d,c as y,a as t,t as I,w as ae,s as vt,x as ve,g as F,y as w,z as G,b as N,f as ye,e as oe,v as fe,F as se,A as me,B as nt,C as Ae,D as Je,E as ea,G as he,H as un,I as ke,T as as,J as _e,h as bn,K as os,L as is,M as ta,N as Un,O as Fn,P as Ge,j as ls,Q as na,R as en,S as sa,U as aa}from"./index-C5DnjDEN.js";import{_ as ge,l as oa,c as ia,r as la,p as ra,j as ca}from"./invites-DsFGeWpC.js";async function ua(){const{data:e}=await Y.get("/chats");return e}async function rs(e){const{data:s}=await Y.get(`/chats/${e}`);return s}async function da(e){const{data:s}=await Y.get(`/chats/by-name/${encodeURIComponent(e)}`);return s}async function st(e){const{data:s}=await Y.post("/chats",e);return s}async function va(e){await Y.post(`/chats/${e}/favorite`)}async function ma(e){await Y.delete(`/chats/${e}/favorite`)}async function fa(e,s){await Y.post(`/chats/${e}/mute`,{})}async function pa(e){await Y.delete(`/chats/${e}/mute`)}async function ha(e){await Y.delete(`/chats/${e}/leave`)}async function ga(e){await Y.post(`/chats/${e}/read`)}async function ya(e){await Y.post(`/chats/${e}/pin`)}async function ba(e){await Y.delete(`/chats/${e}/pin`)}async function ka(e){await Y.post(`/chats/${e}/archive`)}async function wa(e){await Y.delete(`/chats/${e}/archive`)}async function _a(e){const{data:s}=await Y.get(`/chats/${e}`);return s.members??[]}async function cs(e){await Y.delete(`/chats/${e}`)}async function Ca(e,s){const{data:n}=await Y.patch(`/chats/${e}`,s);return n}const Me=Qe("chats",()=>{const e=b([]),s=b(null),n=b({}),o=b(new Set),a=b({}),i=j(()=>e.value.find(E=>E.id===s.value)??null),l=j(()=>[...e.value].sort((E,x)=>{if(E.is_pinned&&!x.is_pinned)return-1;if(!E.is_pinned&&x.is_pinned)return 1;if(E.is_favorite&&!x.is_favorite)return-1;if(!E.is_favorite&&x.is_favorite)return 1;const T=E.last_at||E.updated_at||"";return(x.last_at||x.updated_at||"").localeCompare(T)}));async function r(){try{e.value=await ua()}catch(E){console.error("Failed to load chats",E)}}function m(E){if(s.value=E,E!==null){const x=e.value.find(T=>T.id===E);x&&x.unread_count>0&&(x.unread_count=0,ga(E).catch(()=>{}))}}async function k(E){const x=e.value.find(T=>T.id===E);if(x)try{x.is_favorite?await ma(E):await va(E),x.is_favorite=!x.is_favorite}catch(T){throw console.error("Failed to toggle favorite",T),T}}async function p(E){const x=e.value.find(T=>T.id===E);if(x)try{x.is_muted?await pa(E):await fa(E),x.is_muted=!x.is_muted}catch(T){throw console.error("Failed to toggle mute",T),T}}async function f(E){const x=e.value.find(T=>T.id===E);if(x)try{x.is_pinned?await ba(E):await ya(E),x.is_pinned=!x.is_pinned}catch(T){throw console.error("Failed to toggle pin",T),T}}async function c(E){const x=e.value.find(T=>T.id===E);if(x)try{x.is_archived?await wa(E):await ka(E),x.is_archived=!x.is_archived}catch(T){throw console.error("Failed to toggle archive",T),T}}async function v(E){await ha(E),e.value=e.value.filter(x=>x.id!==E),s.value===E&&(s.value=null)}async function u(E){await cs(E),e.value=e.value.filter(x=>x.id!==E),s.value===E&&(s.value=null)}function g(E,x,T){const W=e.value.find(_=>_.id===E);W&&(W.last_message=x,W.last_at=T)}function L(E){const x=e.value.find(T=>T.id===E);x&&(x.unread_count=(x.unread_count||0)+1)}function M(E,x,T){n.value[E]||(n.value[E]={});const W=n.value[E][x];W&&clearTimeout(W.timer);const _=setTimeout(()=>{$(E,x)},3e3);n.value[E][x]={username:T,timer:_}}function $(E,x){if(n.value[E]){const T=n.value[E][x];T&&(clearTimeout(T.timer),delete n.value[E][x])}}function D(E){const x=n.value[E];return x?Object.values(x).map(T=>T.username):[]}function V(E){o.value=new Set([...o.value,E]),a.value={...a.value,[E]:{isOnline:!0}}}function q(E,x,T){const W=new Set(o.value);W.delete(E),o.value=W,a.value={...a.value,[E]:{isOnline:!1,lastSeenAt:x,lastSeenBucket:T}}}function z(E,x){if(x.isOnline)o.value=new Set([...o.value,E]);else{const T=new Set(o.value);T.delete(E),o.value=T}a.value={...a.value,[E]:x}}function J(E){return a.value[E]}function te(E){return o.value.has(E)}return{chats:e,activeChatId:s,activeChat:i,sortedChats:l,typingUsers:n,loadChats:r,setActiveChat:m,toggleFavorite:k,toggleMute:p,togglePin:f,toggleArchive:c,leave:v,deleteChat:u,updateChatLastMessage:g,incrementUnread:L,setTyping:M,clearTyping:$,getTypingUsernames:D,onlineUsers:o,userPresenceDetails:a,setUserOnline:V,setUserOffline:q,setUserPresence:z,getUserPresence:J,isUserOnline:te}});async function $a(){const{data:e}=await Y.get("/settings");return e}async function Sa(e){await Y.put("/settings",e)}const Kt=Qe("settings",()=>{const e=b(localStorage.getItem("theme")||"light"),s=b(!0),n=b("en"),o=b("everyone");function a(r){e.value=r,document.body.setAttribute("data-theme",r),localStorage.setItem("theme",r)}async function i(){try{const r=await $a();a(r.theme||"light"),s.value=r.notifications_enabled,n.value=r.language||"en",o.value=r.last_seen_visibility||"everyone"}catch(r){console.error("Failed to load settings",r)}}async function l(r){await Sa(r),r.theme&&a(r.theme),r.notifications_enabled!==void 0&&(s.value=r.notifications_enabled),r.language&&(n.value=r.language),r.last_seen_visibility&&(o.value=r.last_seen_visibility)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:s,language:n,lastSeenVisibility:o,applyTheme:a,loadSettings:i,saveSettings:l}}),Jt=Qe("selection",()=>{const e=b(new Set),s=b(!1),n=b(null),o=j(()=>e.value.size);function a(k,p){s.value=!0,n.value=k,e.value=new Set(p!=null?[p]:[])}function i(){s.value=!1,n.value=null,e.value=new Set}function l(k){const p=new Set(e.value);p.has(k)?p.delete(k):p.add(k),e.value=p,p.size===0&&i()}function r(){e.value=new Set}function m(k){return e.value.has(k)}return{selectedMessageIds:e,selectionMode:s,currentChatId:n,selectedCount:o,enterSelectionMode:a,exitSelectionMode:i,toggleMessage:l,clearSelection:r,isSelected:m}});async function bt(e,s){const{data:n}=await Y.get(`/chats/${e}/messages`,{params:s});return n}async function Ma(e,s){const{data:n}=await Y.post(`/chats/${e}/messages`,s);return n}async function xa(e,s){await Y.delete(`/chats/${e}/messages/${s}`)}async function Ta(e,s,n){const{data:o}=await Y.put(`/chats/${e}/messages/${s}`,{content:n});return o}async function Ea(e,s){const{data:n}=await Y.post(`/chats/${e}/messages/forward`,s);return n}async function Ia(e,s){const{data:n}=await Y.post(`/chats/${e}/messages/${s}/pin`);return n}async function La(e,s){await Y.delete(`/chats/${e}/messages/${s}/pin`)}async function Aa(e){const{data:s}=await Y.get(`/chats/${e}/pinned-message`);return s}async function zn(e,s,n){const{data:o}=await Y.get(`/chats/${e}/messages/search`,{params:{q:s,...n}});return o}async function Da(e,s,n){const{data:o}=await Y.post(`/chats/${e}/messages/${s}/reactions`,{emoji:n});return o}async function Ra(e,s){if(!s.length)return{};const{data:n}=await Y.get(`/chats/${e}/reactions`,{params:{message_ids:s.join(",")}});return n}const mt=Qe("messages",()=>{const e=b({}),s=b({}),n=b(null),o=b({}),a=b(new Set),i=Zs(new Set);function l(_){return i.add(_),new Promise(h=>setTimeout(h,300))}function r(_){return i.has(_)}async function m(_){const h=e.value[_];if(!h||h.length===0)return;const S=h.map(H=>H.id);try{const H=await Ra(_,S);for(const K of h)K.reactions=H[String(K.id)]||void 0}catch(H){console.error("Failed to load reactions",H)}}async function k(_){n.value=_;try{const h=await bt(_,{limit:50});e.value[_]=h,h.length>0&&(s.value[_]=Math.max(...h.map(S=>S.id))),await m(_)}catch(h){throw console.error("Failed to load messages",h),h}finally{n.value=null}}async function p(_){const h=s.value[_]||0;if(h===0)return[];try{const S=await bt(_,{after_id:h,limit:50});if(S.length>0){e.value[_]||(e.value[_]=[]);const H=new Set(e.value[_].map(ie=>ie.id)),K=S.filter(ie=>!H.has(ie.id));e.value[_].push(...K),s.value[_]=Math.max(...S.map(ie=>ie.id)),await m(_)}return S}catch(S){return console.error("Failed to load newer messages",S),[]}}async function f(_){const h=e.value[_];if(!h||h.length===0)return[];const S=h[0];if(!S)return[];try{const H=await bt(_,{before:S.created_at,limit:50});if(H.length>0){const K=new Set(h.map(re=>re.id)),ie=H.filter(re=>!K.has(re.id));e.value[_]=[...ie,...h],await m(_)}return H}catch(H){return console.error("Failed to load older messages",H),[]}}async function c(_,h,S){try{const H=await Da(_,h,S);v(_,h,H.action,S,!0)}catch(H){console.error("Failed to toggle reaction",H)}}function v(_,h,S,H,K){const ie=e.value[_];if(!ie)return;const re=ie.find(Ce=>Ce.id===h);if(!re)return;re.reactions||(re.reactions=[]);const be=re.reactions.find(Ce=>Ce.emoji===H);S==="added"?be?(be.count++,K&&(be.me=!0)):re.reactions.push({emoji:H,count:1,me:K}):be&&(be.count--,K&&(be.me=!1),be.count<=0&&(re.reactions=re.reactions.filter(Ce=>Ce.emoji!==H))),re.reactions.length===0&&(re.reactions=void 0)}async function u(_,h,S="text",H){const K=await Ma(_,{content:h,type:S,...H});e.value[_]||(e.value[_]=[]),g(_,K);const ie=e.value[_].findIndex(re=>re.id===K.id);return ie!==-1?e.value[_][ie]=K:e.value[_].push(K),s.value[_]=Math.max(s.value[_]||0,K.id),K}function g(_,h){if(!h.reply_to_message_id||h.reply_to_sender_username||h.reply_to_sender_name)return;const S=e.value[_];if(!S)return;const H=S.find(K=>K.id===h.reply_to_message_id);H&&(h.reply_to_sender_username=H.sender_username,h.reply_to_sender_name=H.sender_display_name||H.sender_username,!h.reply_to_content&&H.content&&(h.reply_to_content=H.content),!h.reply_to_type&&H.message_type&&(h.reply_to_type=H.message_type))}function L(_,h){e.value[_]||(e.value[_]=[]),e.value[_].find(H=>H.id===h.id)||(g(_,h),e.value[_].push(h),s.value[_]=Math.max(s.value[_]||0,h.id))}async function M(_,h){try{await l(h),await xa(_,h),$(_,h)}catch(S){throw console.error("Failed to delete message",S),S}finally{i.delete(h)}}function $(_,h){const S=e.value[_];S&&(e.value[_]=S.filter(H=>H.id!==h))}async function D(_,h,S){try{const H=await Ta(_,h,S);V(_,h,H.content,H.updated_at)}catch(H){throw console.error("Failed to edit message",H),H}}function V(_,h,S,H){const K=e.value[_];if(!K)return;const ie=K.find(re=>re.id===h);ie&&(ie.content=S,ie.is_edited=!0,H&&(ie.updated_at=H))}async function q(_,h,S){try{const H=await Ea(_,{from_chat_id:h,message_ids:S});for(const K of H)L(_,K);return H}catch(H){throw console.error("Failed to forward messages",H),H}}async function z(_){try{const h=await Aa(_);h&&h.message?o.value[_]={message:h.message,pinnedAt:h.pinned_at,pinnedBy:h.pinned_by}:o.value[_]=null}catch(h){console.error("Failed to load pinned message",h),o.value[_]=null}}async function J(_,h){try{const S=await Ia(_,h);o.value[_]={message:S.message,pinnedAt:S.pinned_at,pinnedBy:S.pinned_by},a.value.delete(_)}catch(S){throw console.error("Failed to pin message",S),S}}async function te(_,h){try{await La(_,h),o.value[_]=null}catch(S){throw console.error("Failed to unpin message",S),S}}function E(_,h,S,H){o.value[_]={message:H,pinnedAt:new Date().toISOString(),pinnedBy:S},a.value.delete(_)}function x(_){o.value[_]=null}function T(_){a.value.add(_)}function W(_){return e.value[_]||[]}return{messagesByChat:e,lastMsgId:s,loadingChat:n,loadMessages:k,loadNewer:p,loadOlder:f,sendMessage:u,pushMessage:L,getMessages:W,toggleReaction:c,applyReactionUpdate:v,deleteMessage:M,removeMessage:$,editMessage:D,applyMessageUpdate:V,forwardMessages:q,pinnedByChat:o,pinnedDismissed:a,loadPinnedMessage:z,pinMsg:J,unpinMsg:te,applyMessagePinned:E,applyMessageUnpinned:x,dismissPin:T,deletingMessages:i,markForDeletion:l,isDeleting:r}});function Oa(e,s,n){if(!document.hidden||e.sender_id===n.user?.id||!Kt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||s.chats.find(m=>m.id===e.chat_id)?.is_muted)return;const i=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(i,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),s.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function Pa(){const e=b(!1);let s=null,n=null,o=null,a=1e3,i=!1,l=null,r=!document.hidden&&document.hasFocus(),m=!1;function k(z){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"presence_update",status:z}))}function p(){const z=!document.hidden&&document.hasFocus();z&&!r?(l&&(clearTimeout(l),l=null),r=!0,k("active")):!z&&r&&(l||(l=setTimeout(()=>{l=null,r=!1,k("away")},3e3)))}function f(){m||(m=!0,document.addEventListener("visibilitychange",p),window.addEventListener("focus",p),window.addEventListener("blur",p))}function c(){m&&(m=!1,document.removeEventListener("visibilitychange",p),window.removeEventListener("focus",p),window.removeEventListener("blur",p),l&&(clearTimeout(l),l=null))}function v(){const z=localStorage.getItem("access_token");return z?`wss://ws.behappy.rest/ws?token=${encodeURIComponent(z)}`:null}function u(){if(s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING))return;const z=v();z&&(i=!1,s=new WebSocket(z),s.onopen=()=>{e.value=!0,a=1e3,r=!document.hidden&&document.hasFocus();const J=localStorage.getItem("access_token");J&&s.send(JSON.stringify({type:"auth",token:J,active:r}));const te=Me();for(const E of te.chats)s.send(JSON.stringify({type:"subscribe",chat_id:E.id}));L(),f()},s.onmessage=J=>{try{const te=JSON.parse(J.data);g(te)}catch{}},s.onclose=()=>{e.value=!1,M(),i||$()},s.onerror=()=>{})}function g(z){const J=mt(),te=Me(),E=xe();switch(z.type){case"message":{const x=z;J.pushMessage(x.chat_id,x),te.updateChatLastMessage(x.chat_id,x.content||(x.message_type==="sticker"?"Sticker":"Attachment"),x.created_at),x.chat_id!==te.activeChatId&&x.sender_id!==E.user?.id&&te.incrementUnread(x.chat_id),te.clearTyping(x.chat_id,x.sender_id),Oa(x,te,E);break}case"typing":{const x=z.chat_id,T=z.user_id;if(T!==E.user?.id){const W=z.username||"Someone";te.setTyping(x,T,W)}break}case"pong":break;case"presence":{const x=z.user_id,T=z.status,W=z.last_seen_at,_=z.last_seen_bucket;if(T==="online")te.setUserOnline(x);else if(T==="offline"){const h=W||new Date().toISOString();te.setUserOffline(x,h,_)}break}case"message_deleted":{const x=z.chat_id,T=z.message_id;J.removeMessage(x,T);break}case"message_updated":{const x=z.chat_id,T=z.message_id,W=z.content,_=z.updated_at;J.applyMessageUpdate(x,T,W,_);break}case"message_pinned":{const x=z.chat_id,T=z.message_id,W=z.pinned_by,_=z.message;J.applyMessagePinned(x,T,W,_);break}case"message_unpinned":{const x=z.chat_id;J.applyMessageUnpinned(x);break}case"reaction":{const x=z.chat_id,T=z.message_id,W=z.user_id,_=z.emoji,h=z.action;J.applyReactionUpdate(x,T,h,_,W===E.user?.id);break}}}function L(){M(),o=setInterval(()=>{s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},25e3)}function M(){o&&(clearInterval(o),o=null)}function $(){n||(n=setTimeout(()=>{n=null,u(),a=Math.min(a*2,3e4)},a))}function D(z){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"subscribe",chat_id:z}))}function V(z){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"typing",chat_id:z}))}function q(){i=!0,M(),c(),n&&(clearTimeout(n),n=null),s&&(s.close(),s=null),e.value=!1}return Ve(()=>{q()}),{connected:e,connect:u,disconnect:q,subscribeToChat:D,sendTyping:V}}async function us(e){const{data:s}=await Y.get(`/users/${e}`);return s}async function ds(e){const{data:s}=await Y.get(`/users/by-username/${encodeURIComponent(e)}`);return s}async function Hn(e){const{data:s}=await Y.get("/users/search",{params:{q:e}});return s}async function Na(e,s){const{data:n}=await Y.put(`/users/${e}`,s);return n}async function Ua(e){const{data:s}=await Y.put("/users/me/avatar",{file_id:e});return s}async function Fa(){const{data:e}=await Y.get("/stickers");return e}const za=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};const jn=e=>e==="";const Ha=(...e)=>e.filter((s,n,o)=>!!s&&s.trim()!==""&&o.indexOf(s)===n).join(" ").trim();const Bn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const ja=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,n,o)=>o?o.toUpperCase():n.toLowerCase());const Ba=e=>{const s=ja(e);return s.charAt(0).toUpperCase()+s.slice(1)};var Ze={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Va=({name:e,iconNode:s,absoluteStrokeWidth:n,"absolute-stroke-width":o,strokeWidth:a,"stroke-width":i,size:l=Ze.width,color:r=Ze.stroke,...m},{slots:k})=>cn("svg",{...Ze,...m,width:l,height:l,stroke:r,"stroke-width":jn(n)||jn(o)||n===!0||o===!0?Number(a||i||Ze["stroke-width"])*24/Number(l):a||i||Ze["stroke-width"],class:Ha("lucide",m.class,...e?[`lucide-${Bn(Ba(e))}-icon`,`lucide-${Bn(e)}`]:["lucide-icon"]),...!k.default&&!za(m)&&{"aria-hidden":"true"}},[...s.map(p=>cn(...p)),...k.default?[k.default()]:[]]);const Z=(e,s)=>(n,{slots:o,attrs:a})=>cn(Va,{...a,...n,iconNode:s,name:e},o);const Be=Z("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Wa=Z("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);const vs=Z("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const Vn=Z("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);const qa=Z("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const ms=Z("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const fs=Z("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const Ga=Z("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const ps=Z("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Ka=Z("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const Ja=Z("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const Qa=Z("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const Wn=Z("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Ya=Z("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const qn=Z("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const Xa=Z("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);const Za=Z("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const eo=Z("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const kn=Z("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const wn=Z("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const to=Z("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const no=Z("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const so=Z("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const Gn=Z("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);const hs=Z("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const ao=Z("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);const oo=Z("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);const io=Z("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const lo=Z("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const ro=Z("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const co=Z("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const gs=Z("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const ys=Z("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const Qt=Z("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const Ne=Z("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),uo={class:"swipe-actions swipe-actions-left"},vo={class:"chat-item-info"},mo={class:"chat-item-top"},fo={class:"chat-item-name"},po={class:"chat-item-time"},ho={class:"chat-item-bottom"},go={class:"chat-item-preview"},yo=["title"],bo={class:"swipe-actions swipe-actions-right"},Kn=70,ko=ee({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:s}){const n=e,o=Me(),a=xe(),i=j(()=>n.chat.type==="direct"&&!n.chat.other_user_id),l=j(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:o.isUserOnline(n.chat.other_user_id)||null),r=j(()=>(n.chat.unread_count??0)>0),m=s,k=j(()=>{const M=n.chat;return i.value?"Saved Messages":M.type==="channel"||M.type==="group"?M.title||M.name||"Untitled":M.other_display_name||M.other_username||M.title||M.name||"Chat"});function p(M){if(!M)return"";const $=new Date(M.endsWith("Z")?M:M+"Z"),D=new Date;return $.toDateString()===D.toDateString()?$.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):$.toLocaleDateString([],{month:"short",day:"numeric"})}const f=b(0);let c=0,v=!1;function u(M){c=M.touches[0].clientX,v=!0}function g(M){if(!v)return;const $=M.touches[0].clientX-c;f.value=Math.max(-Kn,Math.min(Kn,$))}function L(){v=!1,f.value=0}return(M,$)=>(d(),y("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:u,onTouchmove:g,onTouchend:L},[t("div",uo,[t("button",{class:"swipe-action swipe-pin",onClick:$[0]||($[0]=D=>m("togglePin"))},I(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:ve(["chat-item",{active:e.active,"chat-item-unread":r.value}]),style:vt({transform:`translateX(${f.value}px)`}),onClick:$[2]||($[2]=D=>m("select")),onContextmenu:$[3]||($[3]=ae(D=>m("contextmenu",D),["prevent"]))},[F(ge,{name:k.value,url:i.value?w(a).user?.avatar_url||null:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"md",online:l.value},null,8,["name","url","online"]),t("div",vo,[t("div",mo,[t("span",fo,[e.chat.type==="channel"?(d(),G(w(wn),{key:0,class:"chat-type-icon",size:14,"stroke-width":2})):e.chat.type==="group"?(d(),G(w(Qt),{key:1,class:"chat-type-icon",size:14,"stroke-width":2})):N("",!0),ye(" "+I(k.value)+" ",1),e.chat.is_pinned?(d(),G(w(ao),{key:2,class:"status-icon",size:14,"stroke-width":1.8,title:"Pinned"})):N("",!0),e.chat.is_muted?(d(),G(w(vs),{key:3,class:"status-icon status-icon-muted",size:14,"stroke-width":1.8,title:"Muted"})):N("",!0)]),t("span",po,I(p(e.chat.last_at||e.chat.updated_at)),1)]),t("div",ho,[t("span",go,I(e.chat.last_message||""),1),e.chat.unread_count>0?(d(),y("span",{key:0,class:ve(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},I(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):N("",!0)])]),t("button",{class:ve(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:$[1]||($[1]=ae(D=>m("toggleFavorite"),["stop"]))},"â˜…",10,yo)],38),t("div",bo,[t("button",{class:"swipe-action swipe-mute",onClick:$[4]||($[4]=D=>m("toggleMute"))},I(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),ue=(e,s)=>{const n=e.__vccOpts||e;for(const[o,a]of s)n[o]=a;return n},tn=ue(ko,[["__scopeId","data-v-e3cb05e4"]]),wo={class:"sidebar"},_o={class:"sidebar-header"},Co={class:"search-wrap"},$o={class:"chat-list"},So={key:0,class:"empty-state-small"},Mo={key:0,class:"chat-section-label"},xo={key:1,class:"chat-section-label"},To={key:2,class:"chat-section-label"},Eo=ee({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:s}){const n=s,o=Me(),a=b(""),i=j(()=>{const c=a.value.toLowerCase(),v=o.sortedChats.filter(u=>!u.is_archived);return c?v.filter(u=>{const g=k(u).toLowerCase(),L=(u.other_username||"").toLowerCase();return g.includes(c)||L.includes(c)}):v}),l=j(()=>i.value.filter(c=>c.is_pinned&&!c.is_favorite)),r=j(()=>i.value.filter(c=>c.is_favorite&&!c.is_pinned)),m=j(()=>i.value.filter(c=>!c.is_favorite&&!c.is_pinned));function k(c){return c.type==="channel"||c.type==="group"?c.title||c.name||"Untitled":c.type==="direct"&&!c.other_user_id?"Saved Messages":c.other_display_name||c.other_username||c.title||c.name||"Chat"}const p=b(null);nt("contextChatId",p);function f(c,v){c.preventDefault(),p.value=v,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:c.clientX,y:c.clientY,chatId:v}}))}return(c,v)=>(d(),y("aside",wo,[t("header",_o,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:v[0]||(v[0]=u=>n("openDrawer"))},[F(w(to),{size:20})]),t("div",Co,[F(w(oo),{size:16,class:"search-icon"}),oe(t("input",{"onUpdate:modelValue":v[1]||(v[1]=u=>a.value=u),class:"search-input",type:"search",placeholder:"Search"},null,512),[[fe,a.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:v[2]||(v[2]=u=>n("openNewChat"))},[F(w(ro),{size:20})])]),t("div",$o,[i.value.length===0?(d(),y("div",So,[...v[3]||(v[3]=[ye(" No conversations yet.",-1),t("br",null,null,-1),ye("Click the pencil icon to start one. ",-1)])])):(d(),y(se,{key:1},[l.value.length>0?(d(),y("div",Mo,"Pinned")):N("",!0),(d(!0),y(se,null,me(l.value,u=>(d(),G(tn,{key:u.id,chat:u,active:u.id===w(o).activeChatId,onSelect:g=>n("selectChat",u.id),onToggleFavorite:g=>w(o).toggleFavorite(u.id),onTogglePin:g=>w(o).togglePin(u.id),onToggleMute:g=>w(o).toggleMute(u.id),onToggleArchive:g=>w(o).toggleArchive(u.id),onContextmenu:g=>f(g,u.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(d(),y("div",xo,"Starred")):N("",!0),(d(!0),y(se,null,me(r.value,u=>(d(),G(tn,{key:u.id,chat:u,active:u.id===w(o).activeChatId,onSelect:g=>n("selectChat",u.id),onToggleFavorite:g=>w(o).toggleFavorite(u.id),onTogglePin:g=>w(o).togglePin(u.id),onToggleMute:g=>w(o).toggleMute(u.id),onToggleArchive:g=>w(o).toggleArchive(u.id),onContextmenu:g=>f(g,u.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&m.value.length>0?(d(),y("div",To," All chats ")):N("",!0),(d(!0),y(se,null,me(m.value,u=>(d(),G(tn,{key:u.id,chat:u,active:u.id===w(o).activeChatId,onSelect:g=>n("selectChat",u.id),onToggleFavorite:g=>w(o).toggleFavorite(u.id),onTogglePin:g=>w(o).togglePin(u.id),onToggleMute:g=>w(o).toggleMute(u.id),onToggleArchive:g=>w(o).toggleArchive(u.id),onContextmenu:g=>f(g,u.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function Io(){const e=b(!1),s=b(0);let n=null,o=[],a=null;async function i(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const p=await navigator.mediaDevices.getUserMedia({audio:!0});o=[],s.value=0,n=new MediaRecorder(p),n.ondataavailable=f=>{f.data.size&&o.push(f.data)},n.start(),e.value=!0,a=setInterval(()=>{s.value++},1e3)}function l(){return new Promise((p,f)=>{if(!n||n.state!=="recording"){f(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(L=>L.stop()),m(),e.value=!1;const c=n?.mimeType||"audio/webm",v=c.includes("ogg")?"ogg":"webm",u=new Blob(o,{type:c}),g=new File([u],`voice.${v}`,{type:c});p(g)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(p=>p.stop())},n.stop()),m(),e.value=!1,s.value=0}function m(){a&&(clearInterval(a),a=null)}function k(p){const f=Math.floor(p/60),c=p%60;return`${f}:${String(c).padStart(2,"0")}`}return{isRecording:e,seconds:s,startRecording:i,stopRecording:l,cancelRecording:r,formatTime:k}}async function _n(e){const s=new FormData;s.append("file",e);const{data:n}=await Y.post("/files",s);return n}const Lo={class:"pin-bar-content"},Ao={class:"pin-bar-sender"},Do={class:"pin-bar-text"},Ro=ee({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const s=e,n=j(()=>s.message.sender_display_name||s.message.sender_username||"Unknown"),o=j(()=>{const a=s.message;switch(a.message_type){case"sticker":return a.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return a.content||""}});return(a,i)=>(d(),y("div",{class:"pin-bar",onClick:i[1]||(i[1]=l=>a.$emit("click"))},[i[2]||(i[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",Lo,[t("span",Ao,I(n.value),1),t("span",Do,I(o.value),1)]),t("button",{class:"pin-bar-close",onClick:i[0]||(i[0]=ae(l=>a.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}});function bs(e){const s=new Date(e),o=new Date().getTime()-s.getTime(),a=Math.floor(o/1e3),i=Math.floor(a/60),l=Math.floor(i/60),r=Math.floor(l/24);if(i<1)return"last seen just now";if(i<60)return`last seen ${i} minute${i!==1?"s":""} ago`;if(l<24)return`last seen ${l} hour${l!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const m=s.toLocaleString("en",{month:"short"}),k=s.getDate();return`last seen ${m} ${k}`}const Oo={class:"chat-header"},Po={class:"chat-header-name"},No={key:0,class:"typing-dots"},Uo=ee({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:s}){const n=s,o=Me(),a=xe(),i=j(()=>o.activeChat),l=j(()=>{const u=i.value;return u?.type==="direct"&&!u.other_user_id}),r=j(()=>{const u=i.value;return u?l.value?"Saved Messages":u.type==="channel"||u.type==="group"?u.title||u.name||"Untitled":u.other_display_name||u.other_username||u.title||u.name||"Chat":"---"}),m=j(()=>{const u=i.value;if(u)return l.value?a.user?.avatar_url:u.type==="direct"?u.other_avatar_url:u.avatar_url}),k=j(()=>i.value?o.getTypingUsernames(i.value.id):[]),p=j(()=>k.value.length>0),f=j(()=>{const u=i.value;return!u||u.type!=="direct"||!u.other_user_id?!1:o.isUserOnline(u.other_user_id)}),c=j(()=>{if(k.value.length===1)return`${k.value[0]} is typing`;if(k.value.length>1)return`${k.value.length} people typing`;const u=i.value;if(!u)return"";if(l.value)return"personal storage";if(u.type==="channel"){const g=u.member_count??0;return`${g} subscriber${g!==1?"s":""}`}if(u.type==="group"){const g=u.member_count??0;return`${g} member${g!==1?"s":""}`}if(f.value)return"online";if(u.type==="direct"&&u.other_user_id){const g=o.getUserPresence(u.other_user_id);if(g){if(g.lastSeenAt)return bs(g.lastSeenAt);if(g.lastSeenBucket)return`last seen ${g.lastSeenBucket}`}}return u.other_username?"@"+u.other_username:""});Ae(()=>i.value?.id,()=>{const u=i.value;if(!u||u.type!=="direct"||!u.other_user_id)return;const g=u.other_user_id;o.getUserPresence(g)||us(g).then(L=>{L.last_activity&&o.setUserPresence(g,{isOnline:o.isUserOnline(g),lastSeenAt:L.last_activity})}).catch(()=>{})},{immediate:!0});function v(){const u=i.value;u&&(u.type==="channel"||u.type==="group"?n("openChannelInfo"):u.type==="direct"&&u.other_username&&n("openUserProfile",u.other_username))}return(u,g)=>(d(),y("header",Oo,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:g[0]||(g[0]=L=>n("back"))},"â†"),F(ge,{class:"chat-header-avatar",name:r.value,url:m.value,online:f.value,size:"sm",onClick:v},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:v},[t("div",Po,I(r.value),1),c.value?(d(),y("div",{key:0,class:ve(["chat-header-sub",{"typing-text":p.value,"online-text":f.value&&!p.value}])},[ye(I(c.value),1),p.value?(d(),y("span",No,[...g[2]||(g[2]=[t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1),t("span",{class:"typing-dot"},null,-1)])])):N("",!0)],2)):N("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:g[1]||(g[1]=L=>n("openSearch"))},"ğŸ”")]))}}),Fo=ue(Uo,[["__scopeId","data-v-16a49ec4"]]),zo="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Ho="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",dn="numeric",vn="ascii",mn="alpha",at="asciinumeric",tt="alphanumeric",fn="domain",ks="emoji",jo="scheme",Bo="slashscheme",nn="whitespace";function Vo(e,s){return e in s||(s[e]=[]),s[e]}function qe(e,s,n){s[dn]&&(s[at]=!0,s[tt]=!0),s[vn]&&(s[at]=!0,s[mn]=!0),s[at]&&(s[tt]=!0),s[mn]&&(s[tt]=!0),s[tt]&&(s[fn]=!0),s[ks]&&(s[fn]=!0);for(const o in s){const a=Vo(o,n);a.indexOf(e)<0&&a.push(e)}}function Wo(e,s){const n={};for(const o in s)s[o].indexOf(e)>=0&&(n[o]=!0);return n}function we(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}we.groups={};we.prototype={accepts(){return!!this.t},go(e){const s=this,n=s.j[e];if(n)return n;for(let o=0;o<s.jr.length;o++){const a=s.jr[o][0],i=s.jr[o][1];if(i&&a.test(e))return i}return s.jd},has(e,s=!1){return s?e in this.j:!!this.go(e)},ta(e,s,n,o){for(let a=0;a<e.length;a++)this.tt(e[a],s,n,o)},tr(e,s,n,o){o=o||we.groups;let a;return s&&s.j?a=s:(a=new we(s),n&&o&&qe(s,n,o)),this.jr.push([e,a]),a},ts(e,s,n,o){let a=this;const i=e.length;if(!i)return a;for(let l=0;l<i-1;l++)a=a.tt(e[l]);return a.tt(e[i-1],s,n,o)},tt(e,s,n,o){o=o||we.groups;const a=this;if(s&&s.j)return a.j[e]=s,s;const i=s;let l,r=a.go(e);if(r?(l=new we,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new we,i){if(o)if(l.t&&typeof l.t=="string"){const m=Object.assign(Wo(l.t,o),n);qe(i,m,o)}else n&&qe(i,n,o);l.t=i}return a.j[e]=l,l}};const Q=(e,s,n,o,a)=>e.ta(s,n,o,a),ce=(e,s,n,o,a)=>e.tr(s,n,o,a),Jn=(e,s,n,o,a)=>e.ts(s,n,o,a),A=(e,s,n,o,a)=>e.tt(s,n,o,a),Pe="WORD",pn="UWORD",ws="ASCIINUMERICAL",_s="ALPHANUMERICAL",ut="LOCALHOST",hn="TLD",gn="UTLD",kt="SCHEME",Ke="SLASH_SCHEME",Cn="NUM",yn="WS",$n="NL",ot="OPENBRACE",it="CLOSEBRACE",wt="OPENBRACKET",_t="CLOSEBRACKET",Ct="OPENPAREN",$t="CLOSEPAREN",St="OPENANGLEBRACKET",Mt="CLOSEANGLEBRACKET",xt="FULLWIDTHLEFTPAREN",Tt="FULLWIDTHRIGHTPAREN",Et="LEFTCORNERBRACKET",It="RIGHTCORNERBRACKET",Lt="LEFTWHITECORNERBRACKET",At="RIGHTWHITECORNERBRACKET",Dt="FULLWIDTHLESSTHAN",Rt="FULLWIDTHGREATERTHAN",Ot="AMPERSAND",Pt="APOSTROPHE",Nt="ASTERISK",He="AT",Ut="BACKSLASH",Ft="BACKTICK",zt="CARET",je="COLON",Sn="COMMA",Ht="DOLLAR",Ie="DOT",jt="EQUALS",Mn="EXCLAMATION",Se="HYPHEN",lt="PERCENT",Bt="PIPE",Vt="PLUS",Wt="POUND",rt="QUERY",xn="QUOTE",Cs="FULLWIDTHMIDDLEDOT",Tn="SEMI",Le="SLASH",ct="TILDE",qt="UNDERSCORE",$s="EMOJI",Gt="SYM";var Ss=Object.freeze({__proto__:null,ALPHANUMERICAL:_s,AMPERSAND:Ot,APOSTROPHE:Pt,ASCIINUMERICAL:ws,ASTERISK:Nt,AT:He,BACKSLASH:Ut,BACKTICK:Ft,CARET:zt,CLOSEANGLEBRACKET:Mt,CLOSEBRACE:it,CLOSEBRACKET:_t,CLOSEPAREN:$t,COLON:je,COMMA:Sn,DOLLAR:Ht,DOT:Ie,EMOJI:$s,EQUALS:jt,EXCLAMATION:Mn,FULLWIDTHGREATERTHAN:Rt,FULLWIDTHLEFTPAREN:xt,FULLWIDTHLESSTHAN:Dt,FULLWIDTHMIDDLEDOT:Cs,FULLWIDTHRIGHTPAREN:Tt,HYPHEN:Se,LEFTCORNERBRACKET:Et,LEFTWHITECORNERBRACKET:Lt,LOCALHOST:ut,NL:$n,NUM:Cn,OPENANGLEBRACKET:St,OPENBRACE:ot,OPENBRACKET:wt,OPENPAREN:Ct,PERCENT:lt,PIPE:Bt,PLUS:Vt,POUND:Wt,QUERY:rt,QUOTE:xn,RIGHTCORNERBRACKET:It,RIGHTWHITECORNERBRACKET:At,SCHEME:kt,SEMI:Tn,SLASH:Le,SLASH_SCHEME:Ke,SYM:Gt,TILDE:ct,TLD:hn,UNDERSCORE:qt,UTLD:gn,UWORD:pn,WORD:Pe,WS:yn});const Re=/[a-z]/,et=new RegExp("\\p{L}","u"),sn=new RegExp("\\p{Emoji}","u"),Oe=/\d/,an=/\s/,Qn="\r",on=`
`,qo="ï¸",Go="â€",ln="ï¿¼";let ht=null,gt=null;function Ko(e=[]){const s={};we.groups=s;const n=new we;ht==null&&(ht=Yn(zo)),gt==null&&(gt=Yn(Ho)),A(n,"'",Pt),A(n,"{",ot),A(n,"}",it),A(n,"[",wt),A(n,"]",_t),A(n,"(",Ct),A(n,")",$t),A(n,"<",St),A(n,">",Mt),A(n,"ï¼ˆ",xt),A(n,"ï¼‰",Tt),A(n,"ã€Œ",Et),A(n,"ã€",It),A(n,"ã€",Lt),A(n,"ã€",At),A(n,"ï¼œ",Dt),A(n,"ï¼",Rt),A(n,"&",Ot),A(n,"*",Nt),A(n,"@",He),A(n,"`",Ft),A(n,"^",zt),A(n,":",je),A(n,",",Sn),A(n,"$",Ht),A(n,".",Ie),A(n,"=",jt),A(n,"!",Mn),A(n,"-",Se),A(n,"%",lt),A(n,"|",Bt),A(n,"+",Vt),A(n,"#",Wt),A(n,"?",rt),A(n,'"',xn),A(n,"/",Le),A(n,";",Tn),A(n,"~",ct),A(n,"_",qt),A(n,"\\",Ut),A(n,"ãƒ»",Cs);const o=ce(n,Oe,Cn,{[dn]:!0});ce(o,Oe,o);const a=ce(o,Re,ws,{[at]:!0}),i=ce(o,et,_s,{[tt]:!0}),l=ce(n,Re,Pe,{[vn]:!0});ce(l,Oe,a),ce(l,Re,l),ce(a,Oe,a),ce(a,Re,a);const r=ce(n,et,pn,{[mn]:!0});ce(r,Re),ce(r,Oe,i),ce(r,et,r),ce(i,Oe,i),ce(i,Re),ce(i,et,i);const m=A(n,on,$n,{[nn]:!0}),k=A(n,Qn,yn,{[nn]:!0}),p=ce(n,an,yn,{[nn]:!0});A(n,ln,p),A(k,on,m),A(k,ln,p),ce(k,an,p),A(p,Qn),A(p,on),ce(p,an,p),A(p,ln,p);const f=ce(n,sn,$s,{[ks]:!0});A(f,"#"),ce(f,sn,f),A(f,qo,f);const c=A(f,Go);A(c,"#"),ce(c,sn,f);const v=[[Re,l],[Oe,a]],u=[[Re,null],[et,r],[Oe,i]];for(let g=0;g<ht.length;g++)ze(n,ht[g],hn,Pe,v);for(let g=0;g<gt.length;g++)ze(n,gt[g],gn,pn,u);qe(hn,{tld:!0,ascii:!0},s),qe(gn,{utld:!0,alpha:!0},s),ze(n,"file",kt,Pe,v),ze(n,"mailto",kt,Pe,v),ze(n,"http",Ke,Pe,v),ze(n,"https",Ke,Pe,v),ze(n,"ftp",Ke,Pe,v),ze(n,"ftps",Ke,Pe,v),qe(kt,{scheme:!0,ascii:!0},s),qe(Ke,{slashscheme:!0,ascii:!0},s),e=e.sort((g,L)=>g[0]>L[0]?1:-1);for(let g=0;g<e.length;g++){const L=e[g][0],$=e[g][1]?{[jo]:!0}:{[Bo]:!0};L.indexOf("-")>=0?$[fn]=!0:Re.test(L)?Oe.test(L)?$[at]=!0:$[vn]=!0:$[dn]=!0,Jn(n,L,L,$)}return Jn(n,"localhost",ut,{ascii:!0}),n.jd=new we(Gt),{start:n,tokens:Object.assign({groups:s},Ss)}}function Ms(e,s){const n=Jo(s.replace(/[A-Z]/g,r=>r.toLowerCase())),o=n.length,a=[];let i=0,l=0;for(;l<o;){let r=e,m=null,k=0,p=null,f=-1,c=-1;for(;l<o&&(m=r.go(n[l]));)r=m,r.accepts()?(f=0,c=0,p=r):f>=0&&(f+=n[l].length,c++),k+=n[l].length,i+=n[l].length,l++;i-=f,l-=c,k-=f,a.push({t:p.t,v:s.slice(i-k,i),s:i-k,e:i})}return a}function Jo(e){const s=[],n=e.length;let o=0;for(;o<n;){let a=e.charCodeAt(o),i,l=a<55296||a>56319||o+1===n||(i=e.charCodeAt(o+1))<56320||i>57343?e[o]:e.slice(o,o+2);s.push(l),o+=l.length}return s}function ze(e,s,n,o,a){let i;const l=s.length;for(let r=0;r<l-1;r++){const m=s[r];e.j[m]?i=e.j[m]:(i=new we(o),i.jr=a.slice(),e.j[m]=i),e=i}return i=new we(n),i.jr=a.slice(),e.j[s[l-1]]=i,i}function Yn(e){const s=[],n=[];let o=0,a="0123456789";for(;o<e.length;){let i=0;for(;a.indexOf(e[o+i])>=0;)i++;if(i>0){s.push(n.join(""));for(let l=parseInt(e.substring(o,o+i),10);l>0;l--)n.pop();o+=i}else n.push(e[o]),o++}return s}const dt={defaultProtocol:"http",events:null,format:Xn,formatHref:Xn,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function En(e,s=null){let n=Object.assign({},dt);e&&(n=Object.assign(n,e instanceof En?e.o:e));const o=n.ignoreTags,a=[];for(let i=0;i<o.length;i++)a.push(o[i].toUpperCase());this.o=n,s&&(this.defaultRender=s),this.ignoreTags=a}En.prototype={o:dt,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,s,n){const o=s!=null;let a=this.o[e];return a&&(typeof a=="object"?(a=n.t in a?a[n.t]:dt[e],typeof a=="function"&&o&&(a=a(s,n))):typeof a=="function"&&o&&(a=a(s,n.t,n)),a)},getObj(e,s,n){let o=this.o[e];return typeof o=="function"&&s!=null&&(o=o(s,n.t,n)),o},render(e){const s=e.render(this);return(this.get("render",null,e)||this.defaultRender)(s,e.t,e)}};function Xn(e){return e}function xs(e,s){this.t="token",this.v=e,this.tk=s}xs.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const s=this.toString(),n=e.get("truncate",s,this),o=e.get("format",s,this);return n&&o.length>n?o.substring(0,n)+"â€¦":o},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=dt.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const s=this,n=this.toHref(e.get("defaultProtocol")),o=e.get("formatHref",n,this),a=e.get("tagName",n,s),i=this.toFormattedString(e),l={},r=e.get("className",n,s),m=e.get("target",n,s),k=e.get("rel",n,s),p=e.getObj("attributes",n,s),f=e.getObj("events",n,s);return l.href=o,r&&(l.class=r),m&&(l.target=m),k&&(l.rel=k),p&&Object.assign(l,p),{tagName:a,attributes:l,content:i,eventListeners:f}}};function Yt(e,s){class n extends xs{constructor(a,i){super(a,i),this.t=e}}for(const o in s)n.prototype[o]=s[o];return n.t=e,n}const Zn=Yt("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),es=Yt("text"),Qo=Yt("nl"),yt=Yt("url",{isLink:!0,toHref(e=dt.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==ut&&e[1].t===je}}),$e=e=>new we(e);function Yo({groups:e}){const s=e.domain.concat([Ot,Nt,He,Ut,Ft,zt,Ht,jt,Se,Cn,lt,Bt,Vt,Wt,Le,Gt,ct,qt]),n=[Pt,je,Sn,Ie,Mn,lt,rt,xn,Tn,St,Mt,ot,it,_t,wt,Ct,$t,xt,Tt,Et,It,Lt,At,Dt,Rt],o=[Ot,Pt,Nt,Ut,Ft,zt,Ht,jt,Se,ot,it,lt,Bt,Vt,Wt,rt,Le,Gt,ct,qt],a=$e(),i=A(a,ct);Q(i,o,i),Q(i,e.domain,i);const l=$e(),r=$e(),m=$e();Q(a,e.domain,l),Q(a,e.scheme,r),Q(a,e.slashscheme,m),Q(l,o,i),Q(l,e.domain,l);const k=A(l,He);A(i,He,k),A(r,He,k),A(m,He,k);const p=A(i,Ie);Q(p,o,i),Q(p,e.domain,i);const f=$e();Q(k,e.domain,f),Q(f,e.domain,f);const c=A(f,Ie);Q(c,e.domain,f);const v=$e(Zn);Q(c,e.tld,v),Q(c,e.utld,v),A(k,ut,v);const u=A(f,Se);A(u,Se,u),Q(u,e.domain,f),Q(v,e.domain,f),A(v,Ie,c),A(v,Se,u);const g=A(v,je);Q(g,e.numeric,Zn);const L=A(l,Se),M=A(l,Ie);A(L,Se,L),Q(L,e.domain,l),Q(M,o,i),Q(M,e.domain,l);const $=$e(yt);Q(M,e.tld,$),Q(M,e.utld,$),Q($,e.domain,l),Q($,o,i),A($,Ie,M),A($,Se,L),A($,He,k);const D=A($,je),V=$e(yt);Q(D,e.numeric,V);const q=$e(yt),z=$e();Q(q,s,q),Q(q,n,z),Q(z,s,q),Q(z,n,z),A($,Le,q),A(V,Le,q);const J=A(r,je),te=A(m,je),E=A(te,Le),x=A(E,Le);Q(r,e.domain,l),A(r,Ie,M),A(r,Se,L),Q(m,e.domain,l),A(m,Ie,M),A(m,Se,L),Q(J,e.domain,q),A(J,Le,q),A(J,rt,q),Q(x,e.domain,q),Q(x,s,q),A(x,Le,q);const T=[[ot,it],[wt,_t],[Ct,$t],[St,Mt],[xt,Tt],[Et,It],[Lt,At],[Dt,Rt]];for(let W=0;W<T.length;W++){const[_,h]=T[W],S=A(q,_);A(z,_,S),A(S,h,q);const H=$e(yt);Q(S,s,H);const K=$e();Q(S,n),Q(H,s,H),Q(H,n,K),Q(K,s,H),Q(K,n,K),A(H,h,q),A(K,h,q)}return A(a,ut,$),A(a,$n,Qo),{start:a,tokens:Ss}}function Xo(e,s,n){let o=n.length,a=0,i=[],l=[];for(;a<o;){let r=e,m=null,k=null,p=0,f=null,c=-1;for(;a<o&&!(m=r.go(n[a].t));)l.push(n[a++]);for(;a<o&&(k=m||r.go(n[a].t));)m=null,r=k,r.accepts()?(c=0,f=r):c>=0&&c++,a++,p++;if(c<0)a-=p,a<o&&(l.push(n[a]),a++);else{l.length>0&&(i.push(rn(es,s,l)),l=[]),a-=c,p-=c;const v=f.t,u=n.slice(a-p,a);i.push(rn(v,s,u))}}return l.length>0&&i.push(rn(es,s,l)),i}function rn(e,s,n){const o=n[0].s,a=n[n.length-1].e,i=s.slice(o,a);return new e(i,n)}const pe={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Zo(){pe.scanner=Ko(pe.customSchemes);for(let e=0;e<pe.tokenQueue.length;e++)pe.tokenQueue[e][1]({scanner:pe.scanner});pe.parser=Yo(pe.scanner.tokens);for(let e=0;e<pe.pluginQueue.length;e++)pe.pluginQueue[e][1]({scanner:pe.scanner,parser:pe.parser});return pe.initialized=!0,pe}function Ts(e){return pe.initialized||Zo(),Xo(pe.parser.start,e,Ms(pe.scanner.start,e))}Ts.scan=Ms;function Es(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function ei(e){return e.replace(/"/g,"&quot;")}function ti(e){const s=[];for(const n in e){let o=e[n]+"";s.push(`${n}="${ei(o)}"`)}return s.join(" ")}function ni({tagName:e,attributes:s,content:n}){return`<${e} ${ti(s)}>${Es(n)}</${e}>`}function Is(e,s={}){s=new En(s,ni);const n=Ts(e),o=[];for(let a=0;a<n.length;a++){const i=n[a];i.t==="nl"&&s.get("nl2br")?o.push(`<br>
`):!i.isLink||!s.check(i)?o.push(Es(i.toString())):o.push(s.render(i))}return o.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(s){return Is(this,s)}});const si={},ai={class:"admin-badge",title:"Admin"};function oi(e,s){return d(),y("span",ai,"âœ“")}const Ls=ue(si,[["render",oi]]);function ii(e){const{delay:s=500,scrollThreshold:n=5,onLongPress:o,onCancel:a}=e,i=b(!1);let l=null,r=0,m=0,k=!1;function p(){l&&(clearTimeout(l),l=null)}function f(g){r=g.clientX,m=g.clientY,k=!1,i.value=!0,p(),l=setTimeout(()=>{k=!0,o(g)},s)}function c(g){if(!l)return;const L=g.clientX-r,M=g.clientY-m;(Math.abs(L)>n||Math.abs(M)>n)&&u()}function v(){p(),i.value=!1}function u(){p(),i.value=!1,k||a?.()}return{isPressed:i,onPointerDown:f,onPointerUp:v,onPointerMove:c}}const li=["data-message-id"],ri={key:0,class:"selection-checkbox"},ci=["checked"],ui={key:1,class:"msg-sender-name"},di={class:"msg-content-wrap"},vi={key:0,class:"msg-forwarded-label"},mi={class:"msg-reply-quote-name"},fi={class:"msg-reply-quote-text"},pi={key:2,class:"msg-bubble sticker-bubble"},hi=["src","alt"],gi={key:3,class:"msg-bubble"},yi={class:"voice-player"},bi={class:"voice-dur"},ki=["innerHTML"],wi={key:5,class:"reaction-chips"},_i=["onClick"],Ci={class:"reaction-emoji"},$i={class:"reaction-count"},Si={class:"msg-time"},Mi={key:0,class:"msg-edited-label"},xi=ee({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:s}){const n=e,o=s,a=Jt(),i=Me(),l=mt(),r=j(()=>a.isSelected(n.message.id)),m=j(()=>l.deletingMessages.has(n.message.id)),k=Je("lastSentMessageId",b(null)),p=j(()=>n.isMine&&n.message.id===k.value),{onPointerDown:f,onPointerUp:c,onPointerMove:v}=ii({delay:500,onLongPress(B){L(B.clientX,B.clientY)}}),u={onPointerdown:f,onPointerup:c,onPointermove:v};function g(B){if(a.selectionMode){a.toggleMessage(n.message.id);return}L(B.clientX,B.clientY)}function L(B,U){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:i.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:B,y:U}}))}function M(){a.selectionMode&&a.toggleMessage(n.message.id)}const $=xe(),D=j(()=>{if(!n.message.forwarded_from_chat_id)return null;const B=n.message.forwarded_from_user_id;if(B&&B===$.user?.id)return null;const U=n.message.forwarded_from_display_name;return U?`Forwarded from ${U}`:"Forwarded"}),V=Je("stickers",b([])),q=j(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const B=V.value.find(U=>U.id===n.message.sticker_id);if(B)return B.url}return""}),z=j(()=>n.message.attachment_url||""),J=b(!1),te=b(0),E=b(0),x=b(n.message.duration_seconds||0);let T=null,W=null;function _(){return T||(T=new Audio(z.value),T.addEventListener("loadedmetadata",()=>{T&&isFinite(T.duration)&&(x.value=T.duration)}),T.addEventListener("ended",()=>{J.value=!1,te.value=0,E.value=0,S()})),T}function h(){if(T&&J.value){E.value=T.currentTime;const B=T.duration;te.value=B&&isFinite(B)?T.currentTime/B*100:0,W=requestAnimationFrame(h)}}function S(){W!==null&&(cancelAnimationFrame(W),W=null)}function H(){const B=_();J.value?(B.pause(),J.value=!1,S()):(B.play(),J.value=!0,W=requestAnimationFrame(h))}function K(B){const U=_(),X=B.currentTarget.getBoundingClientRect(),de=Math.max(0,Math.min(1,(B.clientX-X.left)/X.width)),le=U.duration;le&&isFinite(le)&&(U.currentTime=de*le,E.value=U.currentTime,te.value=de*100)}const ie=j(()=>{const B=x.value;return J.value||E.value>0?De(Math.floor(E.value))+" / "+De(Math.floor(B)):De(Math.floor(B))});Ae(z,()=>{T&&(T.pause(),J.value=!1,S(),T=null,te.value=0,E.value=0)}),Ve(()=>{T&&(T.pause(),T=null),S()});const re=j(()=>{const B=n.message.reply_to_type;if(B==="sticker")return"ğŸ¨ Sticker";if(B==="voice")return"ğŸ¤ Voice message";if(B==="file")return"ğŸ“ File";const U=n.message.reply_to_content||"";return U.length>80?U.slice(0,80)+"...":U}),be=j(()=>Is(n.message.content||"",{defaultProtocol:"https",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(U,P,X)=>P||`<span class="mention" data-u="${X}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${X}'}))">@${X}</span>`));function Ce(B){if(!B)return"";const U=new Date(B.endsWith("Z")?B:B+"Z"),P=new Date;return U.toDateString()===P.toDateString()?U.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):U.toLocaleDateString([],{month:"short",day:"numeric"})}function De(B){const U=Math.floor(B/60),P=B%60;return`${U}:${String(P).padStart(2,"0")}`}function Te(B){const U=B.target.getBoundingClientRect();o("openEmojiPicker",n.message.id,U.left,U.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(B=>{o("mentionClick",B.detail)})),(B,U)=>(d(),y("div",ea({class:["msg-row",[e.isMine?"mine":"theirs",{selected:r.value,"msg-deleting":m.value,"msg-new":p.value}]],"data-message-id":e.message.id,onContextmenu:ae(g,["prevent"])},u,{onClick:M}),[w(a).selectionMode?(d(),y("div",ri,[t("input",{type:"checkbox",checked:r.value,tabindex:"-1"},null,8,ci)])):N("",!0),!e.isMine&&e.message.message_type!=="sticker"?(d(),y("div",ui,[ye(I(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(d(),G(Ls,{key:0})):N("",!0)])):N("",!0),t("div",di,[D.value?(d(),y("div",vi,I(D.value),1)):N("",!0),e.message.reply_to_message_id?(d(),y("div",{key:1,class:"msg-reply-quote",onClick:U[0]||(U[0]=ae(P=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[U[1]||(U[1]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",mi,I(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",fi,I(re.value),1)])])):N("",!0),e.message.message_type==="sticker"?(d(),y("div",pi,[t("img",{class:"sticker-img",src:q.value,alt:e.message.sticker_label||"sticker"},null,8,hi)])):e.message.message_type==="voice"?(d(),y("div",gi,[t("div",yi,[t("button",{class:"voice-play-btn",onClick:ae(H,["stop"])},I(J.value?"â¸":"â–¶"),1),t("div",{class:"voice-track",onClick:ae(K,["stop"])},[t("div",{class:"voice-progress",style:vt({width:te.value+"%"})},null,4)]),t("span",bi,I(ie.value),1)])])):(d(),y("div",{key:4,class:"msg-bubble",innerHTML:be.value},null,8,ki)),t("button",{class:"reaction-add-btn",onClick:ae(Te,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(d(),y("div",wi,[(d(!0),y(se,null,me(e.message.reactions,P=>(d(),y("button",{key:P.emoji,class:ve(["reaction-chip",{"reaction-mine":P.me}]),onClick:ae(X=>o("toggleReaction",e.message.id,P.emoji),["stop"])},[t("span",Ci,I(P.emoji),1),t("span",$i,I(P.count),1)],10,_i))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:ae(Te,["stop"])},"+")])):N("",!0)]),t("div",Si,[e.message.is_edited?(d(),y("span",Mi,"(edited)")):N("",!0),ye(" "+I(Ce(e.message.created_at)),1)])],16,li))}}),Ti={class:"composer-wrapper"},Ei={key:0,class:"reply-preview"},Ii={class:"reply-preview-content"},Li={class:"reply-preview-sender"},Ai={class:"reply-preview-text"},Di={key:1,class:"reply-preview edit-preview"},Ri={class:"reply-preview-content"},Oi={class:"reply-preview-text"},Pi={class:"composer"},Ni=["onKeydown"],Ui=ee({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(e,{expose:s,emit:n}){const o=e,a=n,i=b(""),l=b(null),r=b(null),m=b(null);let k=0;function p(){const $=i.value.trim();$&&(m.value?(a("editMessage",m.value.messageId,$),m.value=null):r.value?(a("send",$,{...r.value}),r.value=null):a("send",$),i.value="",M())}function f(){r.value=null,l.value?.focus()}function c(){m.value=null,i.value="",M(),l.value?.focus()}function v(){r.value?f():m.value&&c()}function u($){const D=$.detail;D&&(m.value=null,r.value={messageId:D.messageId,senderName:D.senderName||"Unknown",snippet:(D.text||"").slice(0,100)},ke(()=>l.value?.focus()))}function g($){const D=$.detail;D&&(r.value=null,m.value={messageId:D.messageId,snippet:(D.text||"").slice(0,100),fullText:D.text||""},i.value=m.value.fullText,ke(()=>{M(),l.value?.focus()}))}function L(){M();const $=Date.now();$-k>2e3&&i.value.trim().length>0&&(k=$,a("typing"))}function M(){const $=l.value;$&&($.style.height="auto",$.style.height=Math.min($.scrollHeight,120)+"px")}return he(()=>{l.value?.focus(),window.addEventListener("reply-to-message",u),window.addEventListener("edit-message",g)}),Ve(()=>{window.removeEventListener("reply-to-message",u),window.removeEventListener("edit-message",g)}),Ae(()=>o.replyTo,$=>{$&&l.value?.focus()}),s({focus:()=>l.value?.focus()}),($,D)=>(d(),y("div",Ti,[r.value?(d(),y("div",Ei,[D[3]||(D[3]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",Ii,[t("span",Li,I(r.value.senderName),1),t("span",Ai,I(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:f},"âœ•")])):N("",!0),m.value?(d(),y("div",Di,[D[5]||(D[5]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",Ri,[D[4]||(D[4]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",Oi,I(m.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:c},"âœ•")])):N("",!0),t("div",Pi,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:D[0]||(D[0]=V=>a("toggleStickers"))},"ğŸŒ"),oe(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":D[1]||(D[1]=V=>i.value=V),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[un(ae(p,["exact","prevent"]),["enter"]),un(v,["escape"])],onInput:L},null,40,Ni),[[fe,i.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:D[2]||(D[2]=V=>a("startRecording"))},"ğŸ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:p},"â¤")])]))}}),Fi=ue(Ui,[["__scopeId","data-v-df4ad9ba"]]),zi={class:"sticker-grid"},Hi=["title","onClick"],ji=["src","alt"],Bi={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Vi=ee({__name:"StickerPicker",emits:["select"],setup(e,{emit:s}){const n=s,o=Je("stickers",b([])),a=j(()=>o.value);return(i,l)=>(d(),y("div",zi,[(d(!0),y(se,null,me(a.value,r=>(d(),y("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:m=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,ji)],8,Hi))),128)),a.value.length===0?(d(),y("div",Bi," No stickers available ")):N("",!0)]))}}),Wi={},qi={class:"msgs-loading"};function Gi(e,s){return d(),y("div",qi,"Loading...")}const ts=ue(Wi,[["render",Gi]]),Ki=["onClick"],Ji=ee({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:s}){const n=s,o=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(a,i)=>e.visible?(d(),y("div",{key:0,class:"emoji-picker",style:vt({left:e.x+"px",top:e.y+"px"}),onClick:i[0]||(i[0]=ae(()=>{},["stop"]))},[(d(),y(se,null,me(o,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},I(l),9,Ki)),64))],4)):N("",!0)}}),Qi=ee({__name:"MessageContextMenu",setup(e){const{showToast:s}=_e(),n=xe(),o=mt(),a=b(!1),i=b(0),l=b(0),r=b(null),m=b(null),k=b(""),p=b(""),f=b(""),c=b(null),v=j(()=>!c.value||!n.user?!1:c.value===n.user.id),u=j(()=>!m.value||!r.value?null:`${window.location.origin}/c/${m.value}/${r.value}`),g=j(()=>!m.value||!r.value?!1:o.pinnedByChat[m.value]?.message?.id===r.value);function L(T){r.value=T.detail.messageId,m.value=T.detail.chatId,k.value=T.detail.text||"",p.value=T.detail.messageType||"text",f.value=T.detail.senderName||"",c.value=T.detail.senderId??null,i.value=T.detail.x,l.value=T.detail.y,a.value=!0,requestAnimationFrame(()=>{const W=document.querySelector(".msg-context-menu");if(!W)return;const _=W.getBoundingClientRect();_.right>window.innerWidth&&(i.value=window.innerWidth-_.width-8),_.bottom>window.innerHeight&&(l.value=window.innerHeight-_.height-8)})}function M(){a.value&&(a.value=!1,r.value=null,m.value=null,k.value="",p.value="",f.value="",c.value=null)}he(()=>{window.addEventListener("show-message-context-menu",L),document.addEventListener("click",M)}),Ve(()=>{window.removeEventListener("show-message-context-menu",L),document.removeEventListener("click",M)});function $(){a.value=!1}function D(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:r.value,chatId:m.value,senderName:f.value,text:k.value}}))}function V(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:r.value,chatId:m.value,text:k.value}}))}async function q(){$();try{await navigator.clipboard.writeText(k.value),s("Copied to clipboard")}catch{s("Failed to copy text")}}async function z(){if($(),!!u.value)try{await navigator.clipboard.writeText(u.value),s("Link copied")}catch{s("Failed to copy link")}}function J(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[r.value],chatId:m.value}}))}function te(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:r.value,chatId:m.value}}))}function E(){if($(),!r.value||!m.value)return;const T=g.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(T,{detail:{messageId:r.value,chatId:m.value}}))}function x(){$(),!(!r.value||!m.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:r.value,chatId:m.value}}))}return(T,W)=>(d(),G(as,{to:"body"},[a.value?(d(),y("div",{key:0,class:"msg-context-menu",style:vt({left:i.value+"px",top:l.value+"px"}),onClick:W[0]||(W[0]=ae(()=>{},["stop"])),onContextmenu:W[1]||(W[1]=ae(()=>{},["prevent"]))},[t("button",{class:"ctx-item",onClick:D}," Reply "),v.value&&p.value==="text"?(d(),y("button",{key:0,class:"ctx-item",onClick:V}," Edit ")):N("",!0),t("button",{class:"ctx-item",onClick:E},I(g.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:q}," Copy text "),u.value?(d(),y("button",{key:1,class:"ctx-item",onClick:z}," Copy link ")):N("",!0),t("button",{class:"ctx-item",onClick:J}," Forward "),t("button",{class:"ctx-item",onClick:te}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:x}," Delete ")],36)):N("",!0)]))}}),Yi=ue(Qi,[["__scopeId","data-v-9e4a9a9d"]]),Xi={key:0,class:"selection-bar"},Zi={class:"selection-bar-count"},el={class:"selection-bar-actions"},tl=["disabled"],nl=["disabled"],sl=ee({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:s}){const n=s,o=Jt();return(a,i)=>(d(),G(os,{name:"slide-down"},{default:bn(()=>[w(o).selectionMode?(d(),y("div",Xi,[t("button",{class:"selection-bar-btn cancel-btn",onClick:i[0]||(i[0]=l=>w(o).exitSelectionMode())}," Cancel "),t("span",Zi,I(w(o).selectedCount)+" selected",1),t("div",el,[t("button",{class:"selection-bar-btn forward-btn",disabled:w(o).selectedCount===0,onClick:i[1]||(i[1]=l=>n("forward"))}," Forward ("+I(w(o).selectedCount)+") ",9,tl),t("button",{class:"selection-bar-btn delete-btn",disabled:w(o).selectedCount===0,onClick:i[2]||(i[2]=l=>n("delete"))}," Delete ("+I(w(o).selectedCount)+") ",9,nl)])])):N("",!0)]),_:1}))}}),al=ue(sl,[["__scopeId","data-v-9ba988f2"]]),ol=ee({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const n=s;function o(){n("close")}return(a,i)=>(d(),G(as,{to:"body"},[F(os,{name:"bottom-sheet"},{default:bn(()=>[e.visible?(d(),y("div",{key:0,class:"bottom-sheet-backdrop",onClick:ae(o,["self"])},[t("div",{class:"bottom-sheet",onClick:i[0]||(i[0]=ae(()=>{},["stop"]))},[i[1]||(i[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),is(a.$slots,"default",{},void 0,!0)])])):N("",!0)]),_:3})]))}}),il=ue(ol,[["__scopeId","data-v-9712ffdf"]]),ll={class:"modal"},rl={class:"modal-header"},cl={class:"modal-body"},ul={class:"forward-chat-list"},dl={key:0,class:"empty-state-small"},vl=["onClick"],ml={class:"forward-chat-info"},fl={class:"forward-chat-name"},pl={class:"forward-chat-type"},hl={key:0,class:"forward-check"},gl={class:"modal-actions"},yl=["disabled"],bl=ee({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:s}){const n=e,o=s,a=Me(),i=mt(),{showToast:l}=_e(),r=b(""),m=b(null),k=b(!1),p=j(()=>{const g=r.value.toLowerCase().trim(),L=a.sortedChats;return g?L.filter(M=>f(M).toLowerCase().includes(g)):L});function f(g){return g.type==="direct"?g.other_user_id?g.other_display_name||g.other_username||g.title||"Direct Chat":"Saved Messages":g.title||g.name||"Unnamed Chat"}function c(g){if(g.type==="direct")return g.other_avatar_url??void 0}function v(){}async function u(){if(m.value!==null){k.value=!0;try{await i.forwardMessages(m.value,n.fromChatId,n.messageIds),l("Message forwarded!"),o("forwarded",m.value)}catch{l("Failed to forward message")}finally{k.value=!1}}}return(g,L)=>(d(),y("div",{class:"modal-backdrop",onClick:L[2]||(L[2]=ae(M=>o("close"),["self"]))},[t("div",ll,[t("div",rl,[L[3]||(L[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:L[0]||(L[0]=M=>o("close"))},"âœ•")]),t("div",cl,[oe(t("input",{"onUpdate:modelValue":L[1]||(L[1]=M=>r.value=M),class:"search-input",type:"search",placeholder:"Search chats...",onInput:v},null,544),[[fe,r.value]]),t("div",ul,[p.value.length===0?(d(),y("div",dl,"No chats found.")):N("",!0),(d(!0),y(se,null,me(p.value,M=>(d(),y("div",{key:M.id,class:ve(["forward-chat-item",{selected:m.value===M.id}]),onClick:$=>m.value=M.id},[F(ge,{name:f(M),url:c(M),size:"sm"},null,8,["name","url"]),t("div",ml,[t("div",fl,I(f(M)),1),t("div",pl,I(M.type),1)]),m.value===M.id?(d(),y("span",hl,"âœ“")):N("",!0)],10,vl))),128))]),t("div",gl,[t("button",{class:"btn btn-primary",disabled:m.value===null||k.value,onClick:u},I(k.value?"Forwarding...":"Forward"),9,yl)])])])]))}}),kl=ue(bl,[["__scopeId","data-v-4e477e89"]]),wl={class:"modal modal-sm"},_l={class:"modal-header"},Cl={class:"modal-body"},$l={class:"delete-confirm-text"},Sl={key:0,class:"delete-checkbox-label"},Ml={class:"modal-actions"},xl=ee({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:s}){const n=s,o=b(!1);function a(){n("confirm",o.value)}return(i,l)=>(d(),y("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=ae(r=>n("close"),["self"]))},[t("div",wl,[t("div",_l,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",Cl,[t("p",$l," Are you sure you want to delete "+I(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(d(),y("label",Sl,[oe(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>o.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[ta,o.value]]),l[5]||(l[5]=ye(" Delete for everyone ",-1))])):N("",!0)]),t("div",Ml,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:a},"Delete")])])]))}}),Tl=ue(xl,[["__scopeId","data-v-388dbae2"]]),ft=Qe("channel",()=>{const e=b(null),s=b([]),n=b(!1),o=j(()=>s.value.length),a=j(()=>s.value.filter(f=>f.role==="admin"||f.role==="owner").length),i=j(()=>{const f=xe();return f.user?s.value.find(v=>v.id===f.user.id)?.role??null:null}),l=j(()=>i.value==="owner"),r=j(()=>i.value==="admin"||i.value==="owner");async function m(f){n.value=!0;try{e.value=await rs(f)}catch(c){console.error("Failed to load channel detail",c)}finally{n.value=!1}}async function k(f){try{s.value=await _a(f)}catch(c){console.error("Failed to load channel members",c)}}async function p(f,c){try{e.value=await Ca(f,c)}catch(v){throw console.error("Failed to update channel",v),v}}return{detail:e,members:s,loading:n,memberCount:o,adminCount:a,myRole:i,isOwner:l,isAdmin:r,loadDetail:m,loadMembers:k,updateChannel:p}}),El=Qe("invites",()=>{const e=b([]),s=b(!1);async function n(i){s.value=!0;try{e.value=await oa(i)}catch(l){console.error("Failed to load invites",l)}finally{s.value=!1}}async function o(i){try{const l=await ia(i);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function a(i){const l=[...e.value];e.value=e.value.filter(r=>r.token!==i);try{await la(i)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:s,loadInvites:n,createInvite:o,revokeInvite:a}}),Il={class:"invite-links-view"},Ll={class:"view-header"},Al={style:{padding:"0 1rem .5rem"}},Dl=["disabled"],Rl={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},Ol={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},Pl={key:2,class:"invite-list",style:{padding:"0 1rem"}},Nl={class:"invite-item-info"},Ul={class:"invite-token"},Fl={class:"invite-date"},zl={class:"invite-item-actions"},Hl=["onClick"],jl=["onClick"],Bl=ee({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,o=s,a=El(),{showToast:i}=_e(),l=b(!1);function r(f){return new Date(f).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function m(f){const c=`${window.location.origin}/join/${f}`;navigator.clipboard&&navigator.clipboard.writeText(c).then(()=>i("Link copied!"))}async function k(){l.value=!0;try{await a.createInvite(n.chatId),i("Invite link created")}catch{i("Failed to create invite")}finally{l.value=!1}}async function p(f){try{await a.revokeInvite(f),i("Invite revoked")}catch{i("Failed to revoke invite")}}return he(()=>a.loadInvites(n.chatId)),(f,c)=>(d(),y("div",Il,[t("div",Ll,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=v=>o("back"))},[F(w(Be),{size:20,"stroke-width":2})]),c[1]||(c[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",Al,[t("button",{class:"btn btn-sm btn-outline",onClick:k,disabled:l.value},I(l.value?"Creating...":"Create Invite Link"),9,Dl)]),w(a).loading?(d(),y("div",Rl," Loading... ")):w(a).invites.length===0?(d(),y("div",Ol," No active invite links ")):(d(),y("div",Pl,[(d(!0),y(se,null,me(w(a).invites,v=>(d(),y("div",{key:v.id,class:"invite-item"},[t("div",Nl,[t("code",Ul,I(v.token),1),t("span",Fl,I(r(v.created_at)),1)]),t("div",zl,[t("button",{class:"icon-btn",title:"Copy link",onClick:u=>m(v.token)},[F(w(ps),{size:16,"stroke-width":2})],8,Hl),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:u=>p(v.token)}," Revoke ",8,jl)])]))),128))]))]))}}),Vl=ue(Bl,[["__scopeId","data-v-97b82dd0"]]);async function Wl(e,s){await Y.post(`/chats/${e}/avatar`,{file_id:s})}async function ql(e,s){return(await Y.post(`/chats/${e}/members/${s}/promote`)).data}async function Gl(e,s){return(await Y.post(`/chats/${e}/members/${s}/demote`)).data}const Kl={class:"admins-view"},Jl={class:"view-header"},Ql={class:"search-bar"},Yl={key:0,class:"member-empty"},Xl={key:1,class:"member-list"},Zl=["onClick"],er={class:"member-info"},tr={class:"member-name"},nr={class:"role-badge"},sr={class:"view-footer"},ar={key:0,class:"member-empty"},or={key:1,class:"member-list"},ir={class:"member-info"},lr={class:"member-name"},rr=["onClick"],cr={key:2,class:"view-footer"},ur=ee({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,o=s,a=ft(),i=b(!1),l=b(""),r=j(()=>a.members.filter(c=>c.role==="admin"||c.role==="owner")),m=j(()=>a.members.filter(c=>c.role==="member")),k=j(()=>{const c=l.value.toLowerCase().trim();return c?m.value.filter(v=>v.username.toLowerCase().includes(c)||v.display_name&&v.display_name.toLowerCase().includes(c)):m.value});async function p(c){try{await ql(n.chatId,c);const v=a.members.find(u=>u.id===c);v&&(v.role="admin"),i.value=!1,l.value=""}catch{}}async function f(c){try{await Gl(n.chatId,c);const v=a.members.find(u=>u.id===c);v&&(v.role="member")}catch{}}return(c,v)=>(d(),y("div",Kl,[t("div",Jl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:v[0]||(v[0]=u=>o("back"))},[F(w(Be),{size:20,"stroke-width":2})]),v[4]||(v[4]=t("span",{class:"view-title"},"Administrators",-1))]),i.value?(d(),y(se,{key:0},[t("div",Ql,[oe(t("input",{"onUpdate:modelValue":v[1]||(v[1]=u=>l.value=u),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[fe,l.value]])]),k.value.length===0?(d(),y("div",Yl,I(l.value?"No members found":"No members to promote"),1)):(d(),y("div",Xl,[(d(!0),y(se,null,me(k.value,u=>(d(),y("div",{key:u.id,class:"member-item member-item--selectable",onClick:g=>p(u.id)},[F(ge,{name:u.display_name||u.username,url:u.avatar_url,size:"md"},null,8,["name","url"]),t("div",er,[t("span",tr,I(u.display_name||u.username),1),t("span",nr,I(u.role),1)])],8,Zl))),128))])),t("div",sr,[t("button",{class:"btn btn--secondary",onClick:v[2]||(v[2]=u=>i.value=!1)},"Cancel")])],64)):(d(),y(se,{key:1},[r.value.length===0?(d(),y("div",ar," No administrators found ")):(d(),y("div",or,[(d(!0),y(se,null,me(r.value,u=>(d(),y("div",{key:u.id,class:"member-item"},[F(ge,{name:u.display_name||u.username,url:u.avatar_url,size:"md"},null,8,["name","url"]),t("div",ir,[t("span",lr,I(u.display_name||u.username),1),t("span",{class:ve(["role-badge",`role-badge--${u.role}`])},I(u.role),3)]),w(a).isOwner&&u.role==="admin"?(d(),y("button",{key:0,class:"btn btn--small btn--danger",onClick:g=>f(u.id)}," Demote ",8,rr)):N("",!0)]))),128))])),w(a).isOwner?(d(),y("div",cr,[t("button",{class:"btn btn--primary",onClick:v[3]||(v[3]=u=>i.value=!0)},"Add Admin")])):N("",!0)],64))]))}}),dr=ue(ur,[["__scopeId","data-v-2bd7c861"]]),vr={class:"subscribers-view"},mr={class:"view-header"},fr={class:"search-bar"},pr={key:0,class:"member-empty"},hr={key:1,class:"member-list"},gr={class:"member-info"},yr={class:"member-name"},br=ee({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=s,o=ft(),a=b(""),i=j(()=>{const l=a.value.toLowerCase().trim();return l?o.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):o.members});return(l,r)=>(d(),y("div",vr,[t("div",mr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=m=>n("back"))},[F(w(Be),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",fr,[oe(t("input",{"onUpdate:modelValue":r[1]||(r[1]=m=>a.value=m),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[fe,a.value]])]),i.value.length===0?(d(),y("div",pr,I(a.value?"No members found":"No subscribers"),1)):(d(),y("div",hr,[(d(!0),y(se,null,me(i.value,m=>(d(),y("div",{key:m.id,class:"member-item"},[F(ge,{name:m.display_name||m.username,url:m.avatar_url,size:"md"},null,8,["name","url"]),t("div",gr,[t("span",yr,I(m.display_name||m.username),1),t("span",{class:ve(["role-badge",`role-badge--${m.role}`])},I(m.role),3)])]))),128))]))]))}}),kr=ue(br,[["__scopeId","data-v-f99a8a5f"]]),wr={class:"modal profile-modal"},_r={class:"profile-modal-body profile-modal-body--scrollable"},Cr={class:"profile-avatar-section profile-avatar-upload-section"},$r={class:"profile-avatar-overlay"},Sr={class:"profile-info-list"},Mr={class:"form-group"},xr={class:"form-label"},Tr=["placeholder"],Er={class:"form-group"},Ir=["placeholder"],Lr={key:0,class:"form-group"},Ar={class:"form-label"},Dr={class:"type-selector"},Rr={class:"type-option"},Or={class:"type-option"},Pr={class:"profile-edit-actions"},Nr=["disabled"],Ur=ee({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:s}){const n=e,o=s,a=ft(),{showToast:i}=_e(),l=b(""),r=b(""),m=b(void 0),k=b("public"),p=b(!1),f=b(null),c=j(()=>a.detail?.type==="group"),v=j(()=>c.value?"Group":"Channel");he(()=>{a.detail&&(l.value=a.detail.title||"",r.value=a.detail.description||"",m.value=a.detail.avatar_url??void 0,k.value=a.detail.public_name?"public":"private")});async function u(){const L=f.value?.files?.[0];if(L){try{const M=await _n(L);await Wl(n.chatId,M.id),m.value=URL.createObjectURL(L),i("Avatar updated!")}catch{i("Avatar upload failed")}f.value&&(f.value.value="")}}async function g(){if(!l.value.trim()){i(`${v.value} name is required`);return}p.value=!0;try{await a.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),i(`${v.value} updated!`),o("saved"),o("close")}catch{i(`Failed to update ${v.value.toLowerCase()}`)}finally{p.value=!1}}return(L,M)=>(d(),y("div",{class:"modal-backdrop profile-backdrop",onClick:M[7]||(M[7]=ae($=>o("close"),["self"]))},[t("div",wr,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:M[0]||(M[0]=$=>o("close"))},[F(w(Ne),{size:20,"stroke-width":2})]),t("div",_r,[t("div",Cr,[t("div",{class:"profile-avatar-upload-wrap",onClick:M[1]||(M[1]=$=>f.value?.click())},[F(ge,{name:l.value||v.value,url:m.value,size:"xxl"},null,8,["name","url"]),t("div",$r,[F(w(ms),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",class:"hidden",onChange:u},null,544)]),t("div",Sr,[t("div",Mr,[t("label",xr,I(v.value)+" name",1),oe(t("input",{"onUpdate:modelValue":M[2]||(M[2]=$=>l.value=$),class:"form-input",type:"text",maxlength:"128",placeholder:`${v.value} name`},null,8,Tr),[[fe,l.value]])]),t("div",Er,[M[8]||(M[8]=t("label",{class:"form-label"},"Description",-1)),oe(t("textarea",{"onUpdate:modelValue":M[3]||(M[3]=$=>r.value=$),class:"form-input",maxlength:"500",rows:"4",placeholder:`${v.value} description...`},null,8,Ir),[[fe,r.value]])]),w(a).isOwner?(d(),y("div",Lr,[t("label",Ar,I(v.value)+" type",1),t("div",Dr,[t("label",Rr,[oe(t("input",{"onUpdate:modelValue":M[4]||(M[4]=$=>k.value=$),type:"radio",value:"public",name:"chatType"},null,512),[[Un,k.value]]),M[9]||(M[9]=t("span",{class:"type-option-label"},"Public",-1)),M[10]||(M[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",Or,[oe(t("input",{"onUpdate:modelValue":M[5]||(M[5]=$=>k.value=$),type:"radio",value:"private",name:"chatType"},null,512),[[Un,k.value]]),M[11]||(M[11]=t("span",{class:"type-option-label"},"Private",-1)),M[12]||(M[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):N("",!0)]),t("div",Pr,[t("button",{class:"btn btn-primary",disabled:p.value,onClick:g},I(p.value?"Saving...":"Save"),9,Nr),t("button",{class:"btn btn-ghost",onClick:M[6]||(M[6]=$=>o("close"))},"Cancel")])])])]))}}),Fr=ue(Ur,[["__scopeId","data-v-6ec12915"]]),zr={class:"danger-zone"},Hr={class:"view-header"},jr={class:"danger-zone-body"},Br={class:"modal modal-sm"},Vr={class:"modal-header"},Wr={class:"modal-actions"},qr=["disabled"],Gr=ee({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:s}){const n=e,o=s,a=Me(),i=ft(),{showToast:l}=_e(),r=b(!1),m=b(!1);async function k(){try{await a.leave(n.chatId),o("left")}catch{l("Failed to leave channel")}}async function p(){m.value=!0;try{await cs(n.chatId),a.chats=a.chats.filter(f=>f.id!==n.chatId),a.activeChatId===n.chatId&&a.setActiveChat(null),r.value=!1,o("deleted")}catch{l("Failed to delete channel")}finally{m.value=!1}}return(f,c)=>(d(),y("div",zr,[t("div",Hr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=v=>o("back"))},[F(w(Be),{size:20,"stroke-width":2})]),c[5]||(c[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",jr,[t("button",{class:"btn btn-danger-outline",onClick:k},[F(w(kn),{size:18,"stroke-width":1.8}),c[6]||(c[6]=ye(" Leave Channel ",-1))]),w(i).isOwner?(d(),y("button",{key:0,class:"btn btn-danger",onClick:c[1]||(c[1]=v=>r.value=!0)},[F(w(gs),{size:18,"stroke-width":1.8}),c[7]||(c[7]=ye(" Delete Channel ",-1))])):N("",!0)]),r.value?(d(),y("div",{key:0,class:"modal-backdrop",onClick:c[4]||(c[4]=ae(v=>r.value=!1,["self"]))},[t("div",Br,[t("div",Vr,[c[8]||(c[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[2]||(c[2]=v=>r.value=!1)},[F(w(Ne),{size:20,"stroke-width":2})])]),c[9]||(c[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",Wr,[t("button",{class:"btn btn-ghost",onClick:c[3]||(c[3]=v=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:m.value,onClick:p},I(m.value?"Deleting...":"Delete"),9,qr)])])])):N("",!0)]))}}),Kr=ue(Gr,[["__scopeId","data-v-997b5e56"]]),Jr={class:"modal profile-modal"},Qr={class:"profile-modal-body"},Yr={key:5,class:"profile-loading"},Xr={class:"profile-avatar-section"},Zr={class:"profile-name"},ec={class:"profile-status"},tc={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},nc={class:"profile-info-item"},sc={class:"profile-info-value"},ac={class:"channel-info-menu"},oc={class:"channel-info-menu-count"},ic={class:"channel-info-menu-count"},lc={key:7,class:"profile-loading"},rc=ee({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:s}){const n=e,o=s,a=ft(),i=b("main"),l=j(()=>Number(n.chatId)),r=j(()=>a.detail?.type==="group");function m(){i.value="main",a.loadDetail(l.value)}return he(async()=>{await Promise.all([a.loadDetail(l.value),a.loadMembers(l.value)])}),(k,p)=>(d(),y("div",{class:"modal-backdrop profile-backdrop",onClick:p[14]||(p[14]=ae(f=>o("close"),["self"]))},[t("div",Jr,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:p[0]||(p[0]=f=>o("close"))},[F(w(Ne),{size:20,"stroke-width":2})]),t("div",Qr,[i.value==="invites"?(d(),G(Vl,{key:0,"chat-id":l.value,onBack:p[1]||(p[1]=f=>i.value="main")},null,8,["chat-id"])):i.value==="admins"?(d(),G(dr,{key:1,"chat-id":l.value,onBack:p[2]||(p[2]=f=>i.value="main")},null,8,["chat-id"])):i.value==="subscribers"?(d(),G(kr,{key:2,"chat-id":l.value,onBack:p[3]||(p[3]=f=>i.value="main")},null,8,["chat-id"])):i.value==="edit"?(d(),G(Fr,{key:3,"chat-id":l.value,onClose:p[4]||(p[4]=f=>i.value="main"),onSaved:m},null,8,["chat-id"])):i.value==="danger"?(d(),G(Kr,{key:4,"chat-id":l.value,onBack:p[5]||(p[5]=f=>i.value="main"),onLeft:p[6]||(p[6]=f=>o("close")),onDeleted:p[7]||(p[7]=f=>o("close"))},null,8,["chat-id"])):w(a).loading?(d(),y("div",Yr,[...p[15]||(p[15]=[t("p",null,"Loading...",-1)])])):w(a).detail?(d(),y(se,{key:6},[t("div",Xr,[F(ge,{name:w(a).detail.title||"Channel",url:w(a).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",Zr,I(w(a).detail.title),1),t("div",ec,I(w(a).memberCount)+" "+I(r.value?w(a).memberCount===1?"member":"members":w(a).memberCount===1?"subscriber":"subscribers"),1),w(a).detail.description?(d(),y("div",tc,[t("div",nc,[p[16]||(p[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",sc,I(w(a).detail.description),1)])])):N("",!0),p[19]||(p[19]=t("div",{class:"profile-divider"},null,-1)),t("div",ac,[t("button",{class:"channel-info-menu-item",onClick:p[8]||(p[8]=f=>i.value="invites")},[F(w(eo),{size:20,"stroke-width":1.8}),p[17]||(p[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:p[9]||(p[9]=f=>i.value="admins")},[F(w(lo),{size:20,"stroke-width":1.8}),p[18]||(p[18]=t("span",null,"Administrators",-1)),t("span",oc,I(w(a).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:p[10]||(p[10]=f=>i.value="subscribers")},[F(w(Qt),{size:20,"stroke-width":1.8}),t("span",null,I(r.value?"Members":"Subscribers"),1),t("span",ic,I(w(a).memberCount),1)]),w(a).isOwner||w(a).isAdmin?(d(),y("button",{key:0,class:"channel-info-menu-item",onClick:p[11]||(p[11]=f=>i.value="edit")},[F(w(hs),{size:20,"stroke-width":1.8}),t("span",null,I(r.value?"Edit Group":"Edit Channel"),1)])):N("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[12]||(p[12]=f=>i.value="danger")},[F(w(kn),{size:20,"stroke-width":1.8}),t("span",null,I(r.value?"Leave Group":"Leave Channel"),1)]),w(a).isOwner?(d(),y("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[13]||(p[13]=f=>i.value="danger")},[F(w(gs),{size:20,"stroke-width":1.8}),t("span",null,I(r.value?"Delete Group":"Delete Channel"),1)])):N("",!0)])],64)):(d(),y("div",lc,[...p[20]||(p[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),cc=ue(rc,[["__scopeId","data-v-d1526322"]]),uc={class:"search-bar"},dc={class:"search-bar-header"},vc={key:0,class:"search-loading"},mc={key:1,class:"search-empty"},fc=["onClick"],pc={class:"search-result-sender"},hc=["innerHTML"],gc={class:"search-result-date"},yc={key:0,class:"search-loading"},bc=ee({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:s}){const n=e,o=s,a=b(null),i=b(null),l=b(""),r=b([]),m=b(!1),k=b(!1),p=b(!0);let f=null;he(()=>{ke(()=>a.value?.focus())}),Ae(l,$=>{if(f&&clearTimeout(f),!$.trim()){r.value=[],k.value=!1,p.value=!0;return}f=setTimeout(()=>c($.trim()),300)});async function c($){m.value=!0,k.value=!0,p.value=!0;try{const D=await zn(n.chatId,$,{limit:20});r.value=D,D.length<20&&(p.value=!1)}catch{r.value=[]}finally{m.value=!1}}async function v(){if(m.value||!p.value||r.value.length===0)return;const $=Math.min(...r.value.map(D=>D.id));m.value=!0;try{const D=await zn(n.chatId,l.value.trim(),{limit:20,before_id:$});D.length<20&&(p.value=!1),r.value=[...r.value,...D]}catch{}finally{m.value=!1}}function u(){if(!i.value)return;const $=i.value;$.scrollTop+$.clientHeight>=$.scrollHeight-40&&v()}function g($,D){if(!D)return L($);const V=L($),q=L(D),z=new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return V.replace(z,"<mark>$&</mark>")}function L($){return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function M($){if(!$)return"";const D=new Date($.endsWith("Z")?$:$+"Z"),V=new Date;return D.toDateString()===V.toDateString()?D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):D.toLocaleDateString([],{month:"short",day:"numeric"})+" "+D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return($,D)=>(d(),y("div",uc,[t("div",dc,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:D[0]||(D[0]=V=>o("close"))},"â†"),oe(t("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":D[1]||(D[1]=V=>l.value=V),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:D[2]||(D[2]=un(V=>o("close"),["escape"]))},null,544),[[fe,l.value]]),l.value?(d(),y("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:D[3]||(D[3]=V=>l.value="")},"âœ•")):N("",!0)]),m.value&&r.value.length===0?(d(),y("div",vc,"Searching...")):k.value&&r.value.length===0&&!m.value?(d(),y("div",mc,"No messages found")):r.value.length>0?(d(),y("div",{key:2,ref_key:"resultsRef",ref:i,class:"search-results",onScroll:u},[(d(!0),y(se,null,me(r.value,V=>(d(),y("div",{key:V.id,class:"search-result-item",onClick:q=>o("jumpToMessage",V.id)},[t("div",pc,I(V.sender_display_name||V.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:g(V.content||"",l.value)},null,8,hc),t("div",gc,I(M(V.created_at)),1)],8,fc))),128)),m.value?(d(),y("div",yc,"Loading more...")):N("",!0)],544)):N("",!0)]))}}),kc={class:"chat-panel"},wc={key:0,class:"empty-chat"},_c={key:1,class:"chat-view"},Cc={key:2,class:"channel-readonly-bar"},$c={key:0,class:"date-sep"},Sc={key:4,class:"sticker-picker"},Mc={key:6,class:"recording-bar"},xc={class:"rec-time"},Tc=ee({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:s}){const n=s,o=xe(),a=Me(),i=mt(),{showToast:l}=_e(),r=Io(),m=Je("stickers",b([])),k=Je("sendTyping",()=>{}),p=Je("pendingScrollMessageId",b(null)),f=b(null),c=b(null),v=b(!1);let u=null;const g=b(!1),L=b(!1),M=b("member"),$=b(!1),D=b(!1),V=b(null);nt("lastSentMessageId",V);const q=b(!0),z=b(0);let J=null;function te(){if(!f.value)return!0;const O=f.value;return O.scrollTop+O.clientHeight>=O.scrollHeight-100}function E(){J||(J=setTimeout(()=>{J=null,q.value=te(),q.value&&(z.value=0)},100))}function x(){Ye(),z.value=0,q.value=!0}const T=b(!1),W=b(0),_=b(0),h=b(null),S=Jt(),H=b(!1),K=b(null),ie=b(""),re=j(()=>!K.value||!o.user?!1:Ue.value.find(C=>C.id===K.value)?.sender_id===o.user.id),be=j(()=>re.value?Ue.value.find(C=>C.id===K.value)?.message_type==="text":!1),Ce=j(()=>!K.value||!a.activeChatId?!1:i.pinnedByChat[a.activeChatId]?.message?.id===K.value),De=j(()=>!a.activeChatId||i.pinnedDismissed.has(a.activeChatId)?null:i.pinnedByChat[a.activeChatId]||null),Te=b(!1),B=b([]),U=b(!1),P=b([]),X=b(!1),de=b(null);let le=null;const We=j(()=>a.activeChat?.type==="channel"&&M.value==="member"),Ue=j(()=>a.activeChatId?i.getMessages(a.activeChatId):[]),As=j(()=>{const O=[];let C="";for(const R of Ue.value){const ne=Ds(R.created_at);ne!==C&&(O.push({type:"date",label:ne}),C=ne),O.push({type:"msg",msg:R})}return O});function Ds(O){if(!O)return"";const C=new Date(O.endsWith("Z")?O:O+"Z"),R=new Date;if(C.toDateString()===R.toDateString())return"Today";const ne=new Date(R);return ne.setDate(R.getDate()-1),C.toDateString()===ne.toDateString()?"Yesterday":C.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Rs(){Xt(),!(!c.value||!f.value)&&(u=new IntersectionObserver(async O=>{if(!O[0]?.isIntersecting)return;const R=a.activeChatId;if(!R||v.value||i.loadingChat===R)return;v.value=!0;const ne=f.value,Ee=ne?ne.scrollHeight:0;try{if((await i.loadOlder(R)).length>0&&ne){await ke();const Xe=ne.scrollHeight;ne.scrollTop+=Xe-Ee}}finally{v.value=!1}},{root:f.value,threshold:0}),u.observe(c.value))}function Xt(){u&&(u.disconnect(),u=null)}Ae(()=>a.activeChatId,async O=>{if(g.value=!1,M.value="member",z.value=0,q.value=!0,Xt(),le&&(clearInterval(le),le=null),!O)return;await Promise.all([i.loadMessages(O),i.loadPinnedMessage(O)]),await ke(),Ye(),await ke(),Rs();const C=a.activeChat;if(C&&(C.type==="channel"||C.type==="group"))try{const R=await rs(O);M.value=R.my_role||"member"}catch{}le=setInterval(()=>{a.activeChatId===O&&i.loadNewer(O).then(R=>{R.length>0&&Os(R.length)})},2500)});function Ye(){f.value&&(f.value.scrollTop=f.value.scrollHeight)}function Os(O=1){if(!f.value)return;const C=f.value;C.scrollHeight-C.scrollTop-C.clientHeight<100?ke(()=>{C.scrollTop=C.scrollHeight}):z.value+=O}function Ps(){a.activeChatId&&k(a.activeChatId)}async function Ns(O,C){if(!(!a.activeChatId||!O.trim())){de.value=null;try{const R=C?{reply_to_message_id:C.messageId}:void 0,ne=await i.sendMessage(a.activeChatId,O.trim(),"text",R);o.user&&(ne.sender_id=o.user.id,ne.sender_username=o.user.username,ne.sender_display_name=o.user.display_name),V.value=ne.id,setTimeout(()=>{V.value===ne.id&&(V.value=null)},500),await ke(),Ye(),a.loadChats()}catch{l("Failed to send message")}}}async function Us(O,C){if(!(!a.activeChatId||!C.trim()))try{await i.editMessage(a.activeChatId,O,C.trim())}catch{l("Failed to edit message")}}async function Fs(O){if(a.activeChatId){g.value=!1;try{const C=await i.sendMessage(a.activeChatId,"","sticker",{sticker_id:O}),R=m.value.find(ne=>ne.id===O);R&&(C.sticker_url=R.url,C.sticker_label=R.label),V.value=C.id,setTimeout(()=>{V.value===C.id&&(V.value=null)},500),await ke(),Ye(),a.loadChats()}catch{l("Failed to send sticker")}}}function zs(O,C,R){h.value=O,W.value=C,_.value=R,T.value=!0}function Hs(O){h.value&&a.activeChatId&&i.toggleReaction(a.activeChatId,h.value,O),T.value=!1,h.value=null}function js(O,C){a.activeChatId&&i.toggleReaction(a.activeChatId,O,C)}function Bs(){T.value=!1,h.value=null}async function Vs(){try{await r.startRecording(),L.value=!0}catch{L.value=!1,l("Microphone access denied")}}async function Ws(){try{const O=await r.stopRecording();L.value=!1,await Ys(O)}catch{L.value=!1}}function qs(){r.cancelRecording(),L.value=!1}function In(O){const{messageIds:C}=O.detail;B.value=C,Te.value=!0}function Ln(O){const{messageId:C,chatId:R}=O.detail;R&&S.enterSelectionMode(R,C)}async function An(O,C){try{await i.pinMsg(O,C)}catch{l("Failed to pin message")}}async function Dn(O,C){try{await i.unpinMsg(O,C)}catch{l("Failed to unpin message")}}function Rn(O){const{messageId:C,chatId:R}=O.detail;C&&R&&An(R,C)}function On(O){const{messageId:C,chatId:R}=O.detail;C&&R&&Dn(R,C)}function Zt(O){const{messageId:C,chatId:R}=O.detail;if(!C||!R)return;P.value=[C];const ne=Ue.value.find(Ee=>Ee.id===C);X.value=!!(ne&&ne.sender_id===o.user?.id),U.value=!0}function Gs(){B.value=[...S.selectedMessageIds],Te.value=!0}function Ks(){P.value=[...S.selectedMessageIds],X.value=P.value.every(O=>{const C=Ue.value.find(R=>R.id===O);return C&&C.sender_id===o.user?.id}),U.value=!0}function Pn(){Te.value=!1,B.value=[],S.exitSelectionMode()}async function Js(O){U.value=!1;const C=a.activeChatId;if(C){for(const R of P.value)try{await i.deleteMessage(C,R)}catch{l("Failed to delete message")}P.value=[],S.exitSelectionMode()}}function Fe(O){H.value=!1;const C=K.value,R=a.activeChatId;if(!(!C||!R))switch(O){case"reply":{const ne=Ue.value.find(Ee=>Ee.id===C);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:C,senderName:ne?.sender_display_name||ne?.sender_username||"Unknown",text:ne?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:C,chatId:R,text:ie.value}}));break}case"copy":navigator.clipboard.writeText(ie.value).then(()=>l("Copied to clipboard"),()=>l("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${R}/${C}`).then(()=>l("Link copied"),()=>l("Failed to copy link"));break;case"forward":B.value=[C],Te.value=!0;break;case"select":S.enterSelectionMode(R,C);break;case"delete":Zt(new CustomEvent("",{detail:{messageId:C,chatId:R}}));break;case"pin":An(R,C);break;case"unpin":Dn(R,C);break}}async function pt(O){if(!f.value)return;const C=a.activeChatId;if(!C)return;let R=f.value.querySelector(`[data-message-id="${O}"]`);if(!R)try{const ne=Math.max(0,O-25),Ee=await bt(C,{after_id:ne,limit:50});if(!Ee.find(Xe=>Xe.id===O)){l("Message not found");return}i.messagesByChat[C]=Ee,Ee.length>0&&(i.lastMsgId[C]=Math.max(...Ee.map(Xe=>Xe.id))),await ke(),R=f.value?.querySelector(`[data-message-id="${O}"]`)}catch{l("Message not found");return}R&&(R.scrollIntoView({behavior:"smooth",block:"center"}),R.classList.add("highlight-message"),setTimeout(()=>R.classList.remove("highlight-message"),2e3))}function Qs(O){D.value=!1,pt(O)}function Nn(O){if(O.key==="Escape"){if(D.value){D.value=!1,O.stopPropagation();return}$.value&&($.value=!1,O.stopPropagation())}}he(()=>{window.addEventListener("forward-messages",In),window.addEventListener("select-message",Ln),window.addEventListener("delete-message",Zt),window.addEventListener("pin-message",Rn),window.addEventListener("unpin-message",On),document.addEventListener("keydown",Nn)}),Ve(()=>{Xt(),window.removeEventListener("forward-messages",In),window.removeEventListener("select-message",Ln),window.removeEventListener("delete-message",Zt),window.removeEventListener("pin-message",Rn),window.removeEventListener("unpin-message",On),document.removeEventListener("keydown",Nn)}),Ae(()=>p.value,async O=>{O&&(await ke(),setTimeout(()=>{pt(O),p.value=null},300))}),Ae(()=>a.activeChatId,()=>{S.exitSelectionMode(),de.value=null,D.value=!1});async function Ys(O){if(a.activeChatId)try{const C=await _n(O);await i.sendMessage(a.activeChatId,"","voice",{file_id:C.id,duration_seconds:r.seconds.value}),await i.loadMessages(a.activeChatId),await ke(),Ye(),a.loadChats()}catch{l("Failed to upload voice message")}}return(O,C)=>(d(),y("main",kc,[w(a).activeChatId?(d(),y("div",_c,[F(al,{onForward:Gs,onDelete:Ks}),D.value&&w(a).activeChatId?(d(),G(bc,{key:0,"chat-id":w(a).activeChatId,onClose:C[0]||(C[0]=R=>D.value=!1),onJumpToMessage:Qs},null,8,["chat-id"])):N("",!0),oe(F(Fo,{onBack:C[1]||(C[1]=R=>n("back")),onOpenUserProfile:C[2]||(C[2]=R=>n("openUserProfile",R)),onOpenChannelInfo:C[3]||(C[3]=R=>$.value=!0),onOpenSearch:C[4]||(C[4]=R=>D.value=!0)},null,512),[[Fn,!w(S).selectionMode&&!D.value]]),De.value&&!w(S).selectionMode?(d(),G(Ro,{key:1,message:De.value.message,onClick:C[5]||(C[5]=R=>pt(De.value.message.id)),onDismiss:C[6]||(C[6]=R=>w(i).dismissPin(w(a).activeChatId))},null,8,["message"])):N("",!0),We.value?(d(),y("div",Cc,[...C[22]||(C[22]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):N("",!0),z.value>0?(d(),y("button",{key:3,class:"new-messages-pill",onClick:x},I(z.value)+" new message"+I(z.value>1?"s":"")+" â†“ ",1)):N("",!0),t("div",{ref_key:"msgListRef",ref:f,class:"msg-list",onClick:Bs,onScroll:E},[w(i).loadingChat===w(a).activeChatId?(d(),G(ts,{key:0})):(d(),y(se,{key:1},[t("div",{ref_key:"olderSentinelRef",ref:c,class:"older-sentinel"},[v.value?(d(),G(ts,{key:0})):N("",!0)],512),(d(!0),y(se,null,me(As.value,R=>(d(),y(se,{key:R.type==="date"?"date-"+R.label:"msg-"+R.msg.id},[R.type==="date"?(d(),y("div",$c,[t("span",null,I(R.label),1)])):(d(),G(xi,{key:1,message:R.msg,"is-mine":R.msg.sender_id===w(o).user?.id,onMentionClick:C[7]||(C[7]=ne=>n("openUserProfile",ne)),onOpenEmojiPicker:zs,onToggleReaction:js,onReplyClick:pt},null,8,["message","is-mine"]))],64))),128))],64))],544),F(Ji,{visible:T.value,x:W.value,y:_.value,onSelect:Hs,onClose:C[8]||(C[8]=R=>T.value=!1)},null,8,["visible","x","y"]),g.value?(d(),y("div",Sc,[F(Vi,{onSelect:Fs})])):N("",!0),We.value?N("",!0):oe((d(),G(Fi,{key:5,"sticker-picker-open":g.value,"reply-to":de.value,onSend:Ns,onEditMessage:Us,onToggleStickers:C[9]||(C[9]=R=>g.value=!g.value),onStartRecording:Vs,onTyping:Ps},null,8,["sticker-picker-open","reply-to"])),[[Fn,!L.value]]),L.value?(d(),y("div",Mc,[C[23]||(C[23]=t("span",{class:"rec-dot"},null,-1)),t("span",xc,I(w(r).formatTime(w(r).seconds.value)),1),C[24]||(C[24]=t("span",{class:"rec-label"},"Recording...",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:qs},"âœ•"),t("button",{class:"icon-btn rec-send",title:"Send",onClick:Ws},"â¤")])):N("",!0),F(Yi),F(il,{visible:H.value,onClose:C[18]||(C[18]=R=>H.value=!1)},{default:bn(()=>[t("button",{class:"ctx-item",onClick:C[10]||(C[10]=R=>Fe("reply"))},"Reply"),be.value?(d(),y("button",{key:0,class:"ctx-item",onClick:C[11]||(C[11]=R=>Fe("edit"))},"Edit")):N("",!0),t("button",{class:"ctx-item",onClick:C[12]||(C[12]=R=>Fe(Ce.value?"unpin":"pin"))},I(Ce.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:C[13]||(C[13]=R=>Fe("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:C[14]||(C[14]=R=>Fe("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:C[15]||(C[15]=R=>Fe("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:C[16]||(C[16]=R=>Fe("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:C[17]||(C[17]=R=>Fe("delete"))},"Delete")]),_:1},8,["visible"]),Te.value?(d(),G(kl,{key:7,"message-ids":B.value,"from-chat-id":w(a).activeChatId,onClose:Pn,onForwarded:Pn},null,8,["message-ids","from-chat-id"])):N("",!0),U.value?(d(),G(Tl,{key:8,"message-count":P.value.length,"can-delete-for-everyone":X.value,onClose:C[19]||(C[19]=R=>U.value=!1),onConfirm:Js},null,8,["message-count","can-delete-for-everyone"])):N("",!0),$.value?(d(),G(cc,{key:9,"chat-id":String(w(a).activeChatId),onClose:C[20]||(C[20]=R=>$.value=!1)},null,8,["chat-id"])):N("",!0)])):(d(),y("div",wc,[...C[21]||(C[21]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),Ec=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Saved Messages",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function Ic(e){return Ec.filter(s=>s.visible(e))}const Lc=["disabled"],Ac={class:"menu-item__label"},Dc={key:1,class:"menu-item__badge"},Rc=ee({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:s}){const n=s;return(o,a)=>(d(),y("button",{class:ve(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:a[0]||(a[0]=i=>n("click"))},[e.icon?(d(),G(Ge(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):N("",!0),t("span",Ac,I(e.label),1),e.badge?(d(),y("span",Dc,I(e.badge),1)):N("",!0),is(o.$slots,"right",{},void 0),e.chevron?(d(),G(Ge(w(Ga)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):N("",!0)],10,Lc))}}),ns=ue(Rc,[["__scopeId","data-v-682bc042"]]),Oc={class:"drawer-header"},Pc={class:"drawer-profile"},Nc={class:"drawer-profile-bottom"},Uc={class:"drawer-profile-info"},Fc={class:"drawer-display-name"},zc={class:"drawer-username"},Hc={class:"drawer-nav"},jc={key:0,class:"drawer-divider"},Bc=["onClick"],Vc={class:"menu-item__label"},Wc=["aria-checked"],qc=ee({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:s}){const n=s,o=ls(),a=xe(),i=Kt(),l={user:ys,users:Qt,megaphone:wn,bookmark:qa,settings:io,moon:so,download:Ka,"log-out":kn,star:co},r=j(()=>({isAuthenticated:!!a.user,isDesktop:!0})),m=j(()=>Ic(r.value)),k={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const f=i.theme==="dark"?"light":"dark";i.applyTheme(f),i.saveSettings({theme:f})},openDownload:()=>n("openDownload"),logout:()=>{a.logout(),o.push("/login")}};function p(f){f&&k[f]&&k[f]()}return(f,c)=>(d(),y("div",{class:ve(["drawer",{open:e.open}])},[t("div",Oc,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:c[0]||(c[0]=v=>n("close"))},[F(w(Ne),{size:20,"stroke-width":2})]),c[2]||(c[2]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",Pc,[F(ge,{name:w(a).user?.display_name||w(a).user?.username||"?",url:w(a).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",Nc,[t("div",Uc,[t("div",Fc,I(w(a).user?.display_name||w(a).user?.username||"---"),1),t("div",zc,"@"+I(w(a).user?.username||"---"),1)]),t("button",{class:"icon-btn drawer-edit-btn","aria-label":"Edit profile",onClick:c[1]||(c[1]=v=>n("openProfile"))},[F(w(hs),{size:18,"stroke-width":2})])])]),t("nav",Hc,[(d(!0),y(se,null,me(m.value,v=>(d(),y(se,{key:v.id},[v.separator?(d(),y("div",jc)):N("",!0),v.rightSlot==="toggle"?(d(),y("div",{key:1,class:"menu-item menu-item--toggle",onClick:u=>p(v.action)},[(d(),G(Ge(l[v.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",Vc,I(v.label),1),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":w(i).theme==="dark"}]),role:"switch","aria-checked":w(i).theme==="dark"},[...c[3]||(c[3]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Wc)],8,Bc)):v.id==="logout"?(d(),G(ns,{key:2,icon:l[v.icon],label:v.label,danger:"",onClick:u=>p(v.action)},null,8,["icon","label","onClick"])):(d(),G(ns,{key:3,icon:l[v.icon],label:v.label,onClick:u=>p(v.action)},null,8,["icon","label","onClick"]))],64))),128))]),c[4]||(c[4]=t("div",{class:"drawer-footer"},"Simple Messenger v2",-1))],2))}}),Gc=ue(qc,[["__scopeId","data-v-bcd4ccca"]]),Kc={class:"modal"},Jc={class:"modal-header"},Qc={class:"modal-body"},Yc={key:0,class:"chat-type-cards"},Xc={class:"chat-type-icon"},Zc={class:"chat-type-icon"},eu={class:"chat-type-icon"},tu={key:1,class:"new-chat-form"},nu={class:"user-pick-list"},su={key:0,class:"empty-state-small"},au={key:1,class:"empty-state-small"},ou=["onClick"],iu={class:"user-pick-name"},lu={class:"user-pick-handle"},ru={key:2,class:"new-chat-form"},cu={class:"form-group"},uu={class:"form-group"},du={class:"form-group"},vu={class:"user-pick-list"},mu=["onClick"],fu={class:"user-pick-name"},pu={class:"user-pick-handle"},hu={class:"modal-actions"},gu=["disabled"],yu={key:3,class:"new-chat-form"},bu={class:"form-group"},ku={class:"form-group"},wu={class:"form-group"},_u={class:"modal-actions"},Cu=["disabled"],$u=ee({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:s}){const n=e,o=s,a=xe(),{showToast:i}=_e(),l=b(n.initialStep),r=b(!1),m=b(""),k=b([]),p=b(!1);let f=null;const c=b(""),v=b(""),u=b(""),g=b([]),L=b(new Set);let M=null;const $=b(""),D=b(""),V=b("");he(()=>{q("")});async function q(_){p.value=!0;try{const h=await Hn(_);k.value=h.filter(S=>S.id!==a.user?.id)}catch{k.value=[]}finally{p.value=!1}}function z(){f&&clearTimeout(f),f=setTimeout(()=>q(m.value),300)}async function J(_){try{g.value=await Hn(_)}catch{g.value=[]}}function te(){M&&clearTimeout(M),M=setTimeout(()=>J(u.value),300)}function E(_){L.value.has(_)?L.value.delete(_):L.value.add(_)}async function x(_){r.value=!0;try{const h=await st({type:"direct",member_ids:[_]});o("chatCreated",h.id)}catch{i("Failed to start conversation")}finally{r.value=!1}}async function T(){if(!c.value.trim()){i("Group name is required");return}r.value=!0;try{const _=await st({type:"group",title:c.value.trim(),description:v.value.trim(),member_ids:Array.from(L.value)});i("Group created!"),o("chatCreated",_.id)}catch{i("Failed to create group")}finally{r.value=!1}}async function W(){if(!$.value.trim()){i("Channel name is required");return}r.value=!0;try{const _=await st({type:"channel",title:$.value.trim(),description:V.value.trim(),public_name:D.value.trim()||void 0,member_ids:[]});i("Channel created!"),o("chatCreated",_.id)}catch{i("Failed to create channel")}finally{r.value=!1}}return(_,h)=>(d(),y("div",{class:"modal-backdrop",onClick:h[14]||(h[14]=ae(S=>o("close"),["self"]))},[t("div",Kc,[t("div",Jc,[h[15]||(h[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:h[0]||(h[0]=S=>o("close"))},[F(w(Ne),{size:20})])]),t("div",Qc,[l.value==="select"?(d(),y("div",Yc,[t("button",{class:"chat-type-card",onClick:h[1]||(h[1]=S=>l.value="direct")},[t("span",Xc,[F(w(ys),{size:24})]),h[16]||(h[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:h[2]||(h[2]=S=>l.value="group")},[t("span",Zc,[F(w(Qt),{size:24})]),h[17]||(h[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:h[3]||(h[3]=S=>l.value="channel")},[t("span",eu,[F(w(wn),{size:24})]),h[18]||(h[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):N("",!0),l.value==="direct"?(d(),y("div",tu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:h[4]||(h[4]=S=>l.value="select")},[F(w(Be),{size:16}),h[19]||(h[19]=ye(" Back ",-1))]),oe(t("input",{"onUpdate:modelValue":h[5]||(h[5]=S=>m.value=S),class:"search-input",type:"search",placeholder:"Search users...",onInput:z},null,544),[[fe,m.value]]),t("div",nu,[p.value?(d(),y("div",su,"Loading users...")):k.value.length===0?(d(),y("div",au,"No users found.")):(d(!0),y(se,{key:2},me(k.value,S=>(d(),y("div",{key:S.id,class:"user-pick-item",onClick:H=>x(S.id)},[F(ge,{name:S.display_name||S.username,url:S.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",iu,I(S.display_name||S.username),1),t("div",lu,"@"+I(S.username),1)])],8,ou))),128))])])):N("",!0),l.value==="group"?(d(),y("div",ru,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:h[6]||(h[6]=S=>l.value="select")},[F(w(Be),{size:16}),h[20]||(h[20]=ye(" Back ",-1))]),t("div",cu,[h[21]||(h[21]=t("label",{class:"form-label"},"Group name",-1)),oe(t("input",{"onUpdate:modelValue":h[7]||(h[7]=S=>c.value=S),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[fe,c.value]])]),t("div",uu,[h[22]||(h[22]=t("label",{class:"form-label"},"Description (optional)",-1)),oe(t("textarea",{"onUpdate:modelValue":h[8]||(h[8]=S=>v.value=S),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[fe,v.value]])]),t("div",du,[h[23]||(h[23]=t("label",{class:"form-label"},"Add members",-1)),oe(t("input",{"onUpdate:modelValue":h[9]||(h[9]=S=>u.value=S),class:"search-input",type:"search",placeholder:"Search users...",onInput:te},null,544),[[fe,u.value]]),t("div",vu,[(d(!0),y(se,null,me(g.value,S=>(d(),y("div",{key:S.id,class:ve(["user-pick-item",{selected:L.value.has(S.id)}]),onClick:H=>E(S.id)},[F(ge,{name:S.display_name||S.username,url:S.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",fu,[L.value.has(S.id)?(d(),G(w(fs),{key:0,size:14,style:{"margin-right":"4px"}})):N("",!0),ye(I(S.display_name||S.username),1)]),t("div",pu,"@"+I(S.username),1)])],10,mu))),128))])]),t("div",hu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:T}," Create Group ",8,gu)])])):N("",!0),l.value==="channel"?(d(),y("div",yu,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:h[10]||(h[10]=S=>l.value="select")},[F(w(Be),{size:16}),h[24]||(h[24]=ye(" Back ",-1))]),t("div",bu,[h[25]||(h[25]=t("label",{class:"form-label"},"Channel name",-1)),oe(t("input",{"onUpdate:modelValue":h[11]||(h[11]=S=>$.value=S),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[fe,$.value]])]),t("div",ku,[h[26]||(h[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),oe(t("input",{"onUpdate:modelValue":h[12]||(h[12]=S=>D.value=S),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[fe,D.value]]),h[27]||(h[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",wu,[h[28]||(h[28]=t("label",{class:"form-label"},"Description (optional)",-1)),oe(t("textarea",{"onUpdate:modelValue":h[13]||(h[13]=S=>V.value=S),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[fe,V.value]])]),t("div",_u,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:W}," Create Channel ",8,Cu)])])):N("",!0)])])]))}}),Su={class:"modal profile-modal profile-modal--self"},Mu={class:"profile-modal-body profile-modal-body--scrollable"},xu={class:"profile-avatar-section profile-avatar-upload-section"},Tu={class:"profile-avatar-overlay"},Eu={class:"profile-name"},Iu={key:0,class:"profile-status profile-status--online"},Lu={class:"profile-info-list"},Au={class:"form-group"},Du={class:"form-group"},Ru={key:0,class:"form-hint form-error"},Ou={class:"form-group"},Pu={class:"profile-info-item"},Nu={class:"profile-info-value"},Uu={class:"profile-edit-actions"},Fu=ee({__name:"ProfileModal",emits:["close"],setup(e,{emit:s}){const n=s,o=xe(),{showToast:a}=_e(),i=b(""),l=b(""),r=b(""),m=b(""),k=b(null);he(async()=>{o.user&&(i.value=o.user.display_name||"",l.value=o.user.username,r.value=o.user.bio||"")});async function p(){const c=k.value?.files?.[0];if(c){try{const v=await _n(c),u=await Ua(v.id);o.updateUser({avatar_url:u.avatar_url}),a("Avatar updated!")}catch{a("Upload failed")}k.value&&(k.value.value="")}}async function f(){if(m.value="",!o.user)return;const c={display_name:i.value.trim(),bio:r.value.trim()};l.value.trim()&&l.value.trim()!==o.user.username&&(c.username=l.value.trim());try{const v=await Na(o.user.id,c);o.updateUser({display_name:v.display_name,username:v.username}),a("Profile saved!"),n("close")}catch(v){v.response?.status===409?m.value="Username already taken":a("Save failed")}}return(c,v)=>(d(),y("div",{class:"modal-backdrop profile-backdrop",onClick:v[6]||(v[6]=ae(u=>n("close"),["self"]))},[t("div",Su,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:v[0]||(v[0]=u=>n("close"))},[F(w(Ne),{size:20,"stroke-width":2})]),t("div",Mu,[t("div",xu,[t("div",{class:"profile-avatar-upload-wrap",onClick:v[1]||(v[1]=u=>k.value?.click())},[F(ge,{name:i.value||w(o).user?.username||"?",url:w(o).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",Tu,[F(w(ms),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:k,type:"file",accept:"image/*",class:"hidden",onChange:p},null,544)]),t("div",Eu,I(i.value||w(o).user?.username||"?"),1),w(o).user?(d(),y("div",Iu," online ")):N("",!0),v[11]||(v[11]=t("div",{class:"profile-divider"},null,-1)),t("div",Lu,[t("div",Au,[v[7]||(v[7]=t("label",{class:"form-label"},"Display name",-1)),oe(t("input",{"onUpdate:modelValue":v[2]||(v[2]=u=>i.value=u),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[fe,i.value]])]),t("div",Du,[v[8]||(v[8]=t("label",{class:"form-label"},"Username",-1)),oe(t("input",{"onUpdate:modelValue":v[3]||(v[3]=u=>l.value=u),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[fe,l.value]]),m.value?(d(),y("small",Ru,I(m.value),1)):N("",!0)]),t("div",Ou,[v[9]||(v[9]=t("label",{class:"form-label"},"Bio",-1)),oe(t("textarea",{"onUpdate:modelValue":v[4]||(v[4]=u=>r.value=u),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[fe,r.value]])]),t("div",Pu,[v[10]||(v[10]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Nu,I(w(o).user?.id),1)])]),t("div",Uu,[t("button",{class:"btn btn-primary",onClick:f},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:v[5]||(v[5]=u=>n("close"))},"Cancel")])])])]))}}),zu={class:"profile-actions"},Hu=["disabled","onClick"],ju={class:"profile-action-btn__circle"},Bu={class:"profile-action-btn__label"},Vu=ee({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:s}){const n=e,o=s,a=j(()=>{const i=[{icon:no,label:"Message",event:"message"}];return n.showMute!==!1&&i.push({icon:vs,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&i.push({icon:Ja,label:"More",event:"more"}),i});return(i,l)=>(d(),y("div",zu,[(d(!0),y(se,null,me(a.value,r=>(d(),y("button",{key:r.label,class:ve(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:m=>o(r.event)},[t("span",ju,[(d(),G(Ge(r.icon),{size:22,"stroke-width":1.8}))]),t("span",Bu,I(r.label),1)],10,Hu))),128))]))}}),Wu=ue(Vu,[["__scopeId","data-v-a16c1098"]]),qu={class:"profile-info-list"},Gu=["onClick"],Ku={class:"profile-info-item__content"},Ju={class:"profile-info-item__value"},Qu={class:"profile-info-item__label"},Yu=ee({__name:"ProfileInfoList",props:{username:{},bio:{},userId:{}},setup(e){const s=e,n=b(null),o=j(()=>{const i=[];return s.username&&i.push({icon:Wa,label:"Username",value:`@${s.username}`,copyable:!0}),s.bio&&i.push({icon:Ya,label:"Bio",value:s.bio}),s.userId!=null&&i.push({icon:Xa,label:"User ID",value:String(s.userId),copyable:!0}),i});async function a(i){try{await navigator.clipboard.writeText(i.replace(/^@/,""));const l=o.value.find(r=>r.value===i)?.label??null;n.value=l,setTimeout(()=>{n.value=null},1500)}catch{}}return(i,l)=>(d(),y("div",qu,[(d(!0),y(se,null,me(o.value,r=>(d(),y("div",{key:r.label,class:ve(["profile-info-item",{"profile-info-item--copyable":r.copyable}]),onClick:m=>r.copyable?a(r.value):void 0},[(d(),G(Ge(r.icon),{class:"profile-info-item__icon",size:20,"stroke-width":1.8})),t("div",Ku,[t("span",Ju,I(r.value),1),t("span",Qu,I(r.label),1)]),r.copyable?(d(),G(Ge(n.value===r.label?w(fs):w(ps)),{key:0,class:"profile-info-item__copy",size:16,"stroke-width":1.8})):N("",!0)],10,Gu))),128))]))}}),Xu=ue(Yu,[["__scopeId","data-v-bc174e9a"]]),Zu={class:"modal profile-modal"},ed={key:0,class:"profile-modal-body"},td={class:"profile-header"},nd={class:"profile-header__content"},sd={class:"profile-header__info"},ad={class:"profile-name"},od={class:"profile-modal-body"},id={class:"profile-media-tabs"},ld=["onClick"],rd={class:"profile-media-empty"},cd={key:2,class:"profile-modal-body"},ud=ee({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:s}){const n=e,o=s,a=Me(),{showToast:i}=_e(),l=b(null),r=b(!0),m=b(!1),k=["Media","Files","Links"],p=b("Media"),f=j(()=>l.value?a.isUserOnline(l.value.id):!1),c=j(()=>{if(f.value)return"online";if(!l.value)return"offline";const u=a.getUserPresence(l.value.id);return u?.lastSeenAt?bs(u.lastSeenAt):u?.lastSeenBucket?`last seen ${u.lastSeenBucket}`:"offline"});he(async()=>{try{l.value=await ds(n.username)}catch{l.value=null}finally{r.value=!1}});function v(){m.value=!m.value,i(m.value?"User muted":"User unmuted")}return(u,g)=>(d(),y("div",{class:"modal-backdrop profile-backdrop",onClick:g[2]||(g[2]=ae(L=>o("close"),["self"]))},[t("div",Zu,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:g[0]||(g[0]=L=>o("close"))},[F(w(Ne),{size:20,"stroke-width":2})]),r.value?(d(),y("div",ed,[...g[3]||(g[3]=[t("div",{class:"profile-loading"},[t("p",null,"Loading...")],-1)])])):l.value?(d(),y(se,{key:1},[t("div",td,[g[4]||(g[4]=t("div",{class:"profile-header__gradient"},null,-1)),t("div",nd,[F(ge,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:f.value,size:"xxl"},null,8,["name","url","online"]),t("div",sd,[t("div",ad,[ye(I(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(d(),G(Ls,{key:0})):N("",!0)]),t("div",{class:ve(["profile-status",{"profile-status--online":f.value}])},I(c.value),3)])])]),t("div",od,[F(Wu,{muted:m.value,"show-more":!1,onMessage:g[1]||(g[1]=L=>o("message",l.value.username)),onMute:v},null,8,["muted"]),g[5]||(g[5]=t("div",{class:"profile-divider"},null,-1)),F(Xu,{username:l.value.username,bio:l.value.bio,"user-id":l.value.id},null,8,["username","bio","user-id"]),t("div",id,[(d(),y(se,null,me(k,L=>t("button",{key:L,class:ve(["profile-media-tab",{"profile-media-tab--active":p.value===L}]),onClick:M=>p.value=L},I(L),11,ld)),64))]),t("div",rd,[F(w(Za),{size:32,"stroke-width":1.5}),t("span",null,"No "+I(p.value.toLowerCase())+" yet",1)])])],64)):(d(),y("div",cd,[...g[6]||(g[6]=[t("div",{class:"profile-loading"},[t("p",null,"User not found")],-1)])]))])]))}}),dd=ue(ud,[["__scopeId","data-v-1e27c432"]]),vd={class:"modal",style:{"max-width":"420px"}},md={class:"modal-header"},fd={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},pd=ee({__name:"DownloadModal",emits:["close"],setup(e,{emit:s}){const n=s,o=navigator.userAgent.toLowerCase(),a=o.includes("win"),i=o.includes("mac")&&!o.includes("iphone")&&!o.includes("ipad"),l=j(()=>a?"Windows":i?"macOS":null);function r(){a?window.location.href="/downloads/windows/MessengerSetup.exe":i&&(window.location.href="/downloads/macos/Messenger.dmg")}return(m,k)=>(d(),y("div",{class:"modal-backdrop",onClick:k[1]||(k[1]=ae(p=>n("close"),["self"]))},[t("div",vd,[t("div",md,[k[2]||(k[2]=t("h2",{class:"modal-title"},"Download Simple Messenger",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:k[0]||(k[0]=p=>n("close"))},[F(w(Ne),{size:20})])]),t("div",fd,[l.value?(d(),y("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+I(l.value),1)):N("",!0),k[3]||(k[3]=na('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/MessengerSetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/Messenger.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),hd={class:"modal",style:{"max-width":"400px"}},gd={class:"modal-header"},yd={class:"modal-body",style:{"text-align":"center"}},bd={key:0},kd={style:{"font-size":"1.25rem","font-weight":"700"}},wd={style:{color:"var(--text-muted)","margin-top":".5rem"}},_d={class:"profile-avatar-section"},Cd={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},$d={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},Sd={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},Md={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},xd=["disabled"],Td=ee({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:s}){const n=e,o=s,{showToast:a}=_e(),i=b(null),l=b(!0),r=b(!1),m=b(""),k=b("");he(async()=>{if(!n.token){m.value="Invalid Link",k.value="No invite token provided.",l.value=!1;return}try{i.value=await ra(n.token)}catch(f){f.response?.status===410?(m.value="Invite Revoked",k.value="This invite link has been revoked."):(m.value="Invite Not Found",k.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function p(){r.value=!0;try{const f=await ca(n.token);a(f.already_member?"You are already a member":"Joined successfully!"),o("joined",f.chat_id)}catch(f){a(f.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(f,c)=>(d(),y("div",{class:"modal-backdrop",onClick:c[2]||(c[2]=ae(v=>o("close"),["self"]))},[t("div",hd,[t("div",gd,[c[3]||(c[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:c[0]||(c[0]=v=>o("close"))},"âœ•")]),t("div",yd,[l.value?(d(),y("p",bd,"Loading invite preview...")):k.value?(d(),y(se,{key:1},[t("h2",kd,I(m.value),1),t("p",wd,I(k.value),1)],64)):i.value?(d(),y(se,{key:2},[t("div",_d,[F(ge,{name:i.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",Cd,I(i.value.title||i.value.type||"Chat"),1),i.value.description?(d(),y("p",$d,I(i.value.description),1)):N("",!0),i.value.member_count?(d(),y("p",Sd,I(i.value.member_count)+" members ",1)):N("",!0),t("div",Md,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:p},I(r.value?"Joining...":"Join"),9,xd),t("button",{class:"btn btn-ghost",onClick:c[1]||(c[1]=v=>o("close"))},"Cancel")])],64)):N("",!0)])])]))}}),Ed={class:"modal modal-wide settings-modal"},Id={class:"modal-header"},Ld={class:"modal-body"},Ad={class:"settings-profile-header"},Dd={class:"settings-profile-info"},Rd={class:"settings-display-name"},Od={class:"settings-username"},Pd={class:"settings-group"},Nd={class:"settings-section-title"},Ud={class:"menu-item menu-item--setting"},Fd={class:"settings-group"},zd={class:"settings-section-title"},Hd=["aria-checked"],jd={class:"settings-group"},Bd={class:"settings-section-title"},Vd={class:"menu-item menu-item--setting"},Wd={class:"settings-group"},qd={class:"settings-section-title"},Gd={class:"menu-item menu-item--setting"},Kd={class:"settings-actions"},Jd=ee({__name:"SettingsView",emits:["close"],setup(e,{emit:s}){const n=s,o=xe(),a=Kt(),{showToast:i}=_e(),l=b("light"),r=b(!0),m=b("en"),k=b("everyone");Ae(r,async f=>{f&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(r.value=!1,i("Notifications blocked by browser"))}),he(()=>{l.value=a.theme,r.value=a.notificationsEnabled,m.value=a.language,k.value=a.lastSeenVisibility});async function p(){try{await a.saveSettings({theme:l.value,notifications_enabled:r.value,language:m.value,last_seen_visibility:k.value}),i("Settings saved"),n("close")}catch{i("Failed to save settings")}}return(f,c)=>(d(),y("div",{class:"modal-backdrop",onClick:c[7]||(c[7]=ae(v=>n("close"),["self"]))},[t("div",Ed,[t("div",Id,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=v=>n("close"))},[F(w(Be),{size:20,"stroke-width":2})]),c[8]||(c[8]=t("span",{class:"modal-title"},"Settings",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[1]||(c[1]=v=>n("close"))},[F(w(Ne),{size:20,"stroke-width":2})])]),t("div",Ld,[t("div",Ad,[F(ge,{name:w(o).user?.display_name||w(o).user?.username||"?",url:w(o).user?.avatar_url,size:"xl"},null,8,["name","url"]),t("div",Dd,[t("div",Rd,I(w(o).user?.display_name||w(o).user?.username||"---"),1),t("div",Od,"@"+I(w(o).user?.username||"---"),1)])]),c[21]||(c[21]=t("div",{class:"settings-divider"},null,-1)),t("div",Pd,[t("div",Nd,[F(w(Gn),{size:18,"stroke-width":1.8}),c[9]||(c[9]=t("span",null,"Appearance",-1))]),t("div",Ud,[F(w(Gn),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[11]||(c[11]=t("span",{class:"menu-item__label"},"Theme",-1)),oe(t("select",{"onUpdate:modelValue":c[2]||(c[2]=v=>l.value=v),class:"form-input form-select settings-select"},[...c[10]||(c[10]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[en,l.value]])])]),c[22]||(c[22]=t("div",{class:"settings-divider"},null,-1)),t("div",Fd,[t("div",zd,[F(w(Vn),{size:18,"stroke-width":1.8}),c[12]||(c[12]=t("span",null,"Notifications",-1))]),t("div",{class:"menu-item menu-item--toggle",onClick:c[3]||(c[3]=v=>r.value=!r.value)},[F(w(Vn),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[14]||(c[14]=t("span",{class:"menu-item__label"},"Notifications",-1)),t("span",{class:ve(["toggle-status",{"toggle-status--on":r.value}])},I(r.value?"Enabled":"Disabled"),3),t("span",{class:ve(["toggle-switch",{"toggle-switch--on":r.value}]),role:"switch","aria-checked":r.value},[...c[13]||(c[13]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Hd)])]),c[23]||(c[23]=t("div",{class:"settings-divider"},null,-1)),t("div",jd,[t("div",Bd,[F(w(qn),{size:18,"stroke-width":1.8}),c[15]||(c[15]=t("span",null,"Language",-1))]),t("div",Vd,[F(w(qn),{class:"menu-item__icon",size:24,"stroke-width":1.8}),c[17]||(c[17]=t("span",{class:"menu-item__label"},"Language",-1)),oe(t("select",{"onUpdate:modelValue":c[4]||(c[4]=v=>m.value=v),class:"form-input form-select settings-select"},[...c[16]||(c[16]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[en,m.value]])])]),c[24]||(c[24]=t("div",{class:"settings-divider"},null,-1)),t("div",Wd,[t("div",qd,[F(w(Wn),{size:18,"stroke-width":1.8}),c[18]||(c[18]=t("span",null,"Privacy",-1))]),t("div",Gd,[(d(),G(Ge(k.value==="nobody"?w(Qa):w(Wn)),{class:"menu-item__icon",size:24,"stroke-width":1.8})),c[20]||(c[20]=t("span",{class:"menu-item__label"},"Last Seen & Online",-1)),oe(t("select",{"onUpdate:modelValue":c[5]||(c[5]=v=>k.value=v),class:"form-input form-select settings-select"},[...c[19]||(c[19]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[en,k.value]])])]),c[25]||(c[25]=t("div",{class:"settings-divider"},null,-1)),t("div",Kd,[t("button",{class:"btn btn-primary",onClick:p},"Save Settings"),t("button",{class:"btn btn-ghost",onClick:c[6]||(c[6]=v=>n("close"))},"Cancel")])])])]))}}),Qd=ue(Jd,[["__scopeId","data-v-960466b8"]]),Yd=ee({__name:"ContextMenu",setup(e){const s=Me(),{showToast:n}=_e(),{showConfirm:o}=sa(),a=b(!1),i=b(0),l=b(0),r=b(null),m=j(()=>r.value?s.chats.find(g=>g.id===r.value)??null:null);function k(g){r.value=g.detail.chatId,i.value=g.detail.x,l.value=g.detail.y,a.value=!0}function p(){a.value&&(a.value=!1,r.value=null)}he(()=>{window.addEventListener("show-context-menu",k),document.addEventListener("click",p)}),Ve(()=>{window.removeEventListener("show-context-menu",k),document.removeEventListener("click",p)});async function f(){if(r.value){a.value=!1;try{await s.toggleFavorite(r.value)}catch{n("Failed to update favorite")}}}async function c(){if(r.value){a.value=!1;try{await s.toggleMute(r.value)}catch{n("Failed to update mute")}}}async function v(){if(!(!r.value||(a.value=!1,!await o({title:"Leave Chat",message:"Leave this chat?",confirmLabel:"Leave",danger:!0}))))try{await s.leave(r.value),n("Left chat")}catch{n("Failed to leave chat")}}async function u(){if(!(!r.value||(a.value=!1,!await o({title:"Delete Chat",message:"Delete this chat? All messages will be permanently removed.",confirmLabel:"Delete",danger:!0}))))try{await s.deleteChat(r.value),n("Chat deleted")}catch{n("Failed to delete chat")}}return(g,L)=>a.value?(d(),y("div",{key:0,class:"context-menu",style:vt({left:i.value+"px",top:l.value+"px"})},[t("button",{class:"ctx-item",onClick:f},I(m.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:c},I(m.value?.is_muted?"Unmute":"Mute"),1),m.value&&m.value.type!=="direct"?(d(),y("button",{key:0,class:"ctx-item ctx-leave",onClick:v}," Leave chat ")):N("",!0),t("button",{class:"ctx-item ctx-delete",onClick:u}," Delete chat ")],4)):N("",!0)}}),ss=240,Xd=.5,tv=ee({__name:"MessengerView",setup(e){const s=aa(),n=ls(),o=xe(),a=Me(),i=Kt(),l=Jt(),{showToast:r}=_e(),{connect:m,disconnect:k,sendTyping:p}=Pa();nt("sendTyping",p);const f=b(!1),c=b(!1),v=b("select"),u=b(!1),g=b(!1),L=b(!1),M=b(null),$=b(null),D=b([]),V=b(null);nt("stickers",D),nt("pendingScrollMessageId",V);let q=null;he(async()=>{await i.loadSettings();try{D.value=await Fa()}catch{}await a.loadChats(),m(),q=setInterval(()=>a.loadChats(),5e3),z()}),Ve(()=>{k(),q&&(clearInterval(q),q=null)}),Ae(()=>s.path,()=>{z()}),Ae(()=>a.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function z(){const U=s.path;if(U.startsWith("/@")){const P=s.params.username;P&&(M.value=P)}else if(U.startsWith("/u/")){const P=s.params.id;if(P)try{const X=await us(parseInt(P));M.value=X.username}catch{r("User not found")}}else if(U.startsWith("/dm/")){const P=s.params.id;P&&await J(P)}else if(U.startsWith("/c/")){const P=s.params.chatIdOrName||s.params.name,X=s.params.messageId?parseInt(s.params.messageId):null;if(P)if(/^\d+$/.test(P)){const le=parseInt(P);X?await E(le,X):a.setActiveChat(le)}else await te(P)}}async function J(U){try{let P;if(U.startsWith("@")){const de=U.substring(1);P=(await ds(de)).id}else P=parseInt(U);const X=await st({type:"direct",member_ids:[P]});await a.loadChats(),a.setActiveChat(X.id)}catch{r("Failed to open conversation")}}async function te(U){try{const P=await da(U);a.chats.find(de=>de.id===P.id)?a.setActiveChat(P.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function E(U,P){if(!a.chats.find(de=>de.id===U)){r("Chat not found");return}a.setActiveChat(U),await ke(),V.value=P}const x=parseInt(localStorage.getItem("sidebar-width")||"360",10);x>=ss&&document.documentElement.style.setProperty("--sidebar-width",x+"px");function T(U){U.preventDefault();const P=U.currentTarget;P.setPointerCapture(U.pointerId);const X=le=>{const We=window.innerWidth*Xd,Ue=Math.min(We,Math.max(ss,le.clientX));document.documentElement.style.setProperty("--sidebar-width",Ue+"px")},de=()=>{P.removeEventListener("pointermove",X),P.removeEventListener("pointerup",de);const le=getComputedStyle(document.documentElement).getPropertyValue("--sidebar-width").trim();localStorage.setItem("sidebar-width",parseInt(le,10).toString())};P.addEventListener("pointermove",X),P.addEventListener("pointerup",de)}function W(U){a.setActiveChat(U),n.replace("/app")}function _(){a.setActiveChat(null)}function h(){f.value=!1,u.value=!0}function S(){f.value=!1,g.value=!0}function H(){f.value=!1,v.value="group",c.value=!0}function K(){f.value=!1,v.value="channel",c.value=!0}async function ie(){if(f.value=!1,!!o.user)try{const U=await st({type:"direct",member_ids:[o.user.id]});await a.loadChats(),a.setActiveChat(U.id)}catch{r("Failed to open Saved Messages")}}function re(U){M.value=U}async function be(U){M.value=null,await J("@"+U)}async function Ce(U){c.value=!1,await a.loadChats(),a.setActiveChat(U)}async function De(U){$.value=null,await a.loadChats(),a.setActiveChat(U)}function Te(U){const P=U.target?.closest("a");if(!P)return;const X=P.getAttribute("href");if(!X)return;let de;try{de=new URL(X,window.location.origin)}catch{return}if(de.origin!==window.location.origin){U.preventDefault(),U.stopPropagation(),window.open(de.href,"_blank");return}U.preventDefault(),U.stopPropagation();const le=de.pathname,We=le.match(/^\/join\/([^/]+)$/);if(We){$.value=We[1]??null;return}if(le.startsWith("/@")||le.startsWith("/u/")||le.startsWith("/dm/")||le.startsWith("/c/")){n.push(le);return}n.push(le)}function B(U){if(U.key==="Escape"){if($.value){$.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if(M.value){M.value=null;return}if(c.value){c.value=!1;return}if(u.value){u.value=!1;return}if(g.value){g.value=!1;return}if(L.value){L.value=!1;return}if(f.value){f.value=!1;return}if(a.activeChatId!==null){_();return}}}return he(()=>{document.addEventListener("keydown",B),document.addEventListener("click",Te,!0)}),Ve(()=>{document.removeEventListener("keydown",B),document.removeEventListener("click",Te,!0)}),(U,P)=>(d(),y("div",{class:ve(["layout",{"chat-open":!!w(a).activeChatId}])},[F(Gc,{open:f.value,onClose:P[0]||(P[0]=X=>f.value=!1),onOpenProfile:h,onOpenSettings:S,onOpenNewGroup:H,onOpenNewChannel:K,onOpenFavorites:ie,onOpenDownload:P[1]||(P[1]=X=>L.value=!0)},null,8,["open"]),t("div",{class:ve(["drawer-overlay",{visible:f.value}]),onClick:P[2]||(P[2]=X=>f.value=!1)},null,2),F(Eo,{onOpenDrawer:P[3]||(P[3]=X=>f.value=!0),onOpenNewChat:P[4]||(P[4]=X=>{v.value="select",c.value=!0}),onSelectChat:W}),t("div",{class:"resize-handle",onPointerdown:T},null,32),F(Tc,{onBack:_,onOpenUserProfile:re}),c.value?(d(),G($u,{key:0,"initial-step":v.value,onClose:P[5]||(P[5]=X=>c.value=!1),onChatCreated:Ce},null,8,["initial-step"])):N("",!0),u.value?(d(),G(Fu,{key:1,onClose:P[6]||(P[6]=X=>u.value=!1)})):N("",!0),g.value?(d(),G(Qd,{key:2,onClose:P[7]||(P[7]=X=>g.value=!1)})):N("",!0),M.value?(d(),G(dd,{key:3,username:M.value,onClose:P[8]||(P[8]=X=>M.value=null),onMessage:be},null,8,["username"])):N("",!0),L.value?(d(),G(pd,{key:4,onClose:P[9]||(P[9]=X=>L.value=!1)})):N("",!0),$.value?(d(),G(Td,{key:5,token:$.value,onClose:P[10]||(P[10]=X=>$.value=null),onJoined:De},null,8,["token"])):N("",!0),F(Yd)],2))}});export{tv as default};
