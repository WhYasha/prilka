import{k as K,l as We,r as b,m as H,n as Ue,u as Se,p as ln,d as ee,o as v,c as y,a as t,t as D,w as ae,q as lt,s as ue,g as j,x,b as F,f as ke,e as ne,v as ce,F as se,y as ve,z as Y,A as ft,B as Le,C as Ye,D as Vs,E as pe,G as rn,H as ye,T as Yn,I as $e,h as gn,J as Xn,K as Zn,L as es,M as Nn,N as gt,O as yt,j as ts,P as Xt,Q as Ws,R as qs}from"./index-CvJYvlpD.js";import{_ as he,l as Gs,c as Ks,r as Js,p as Qs,j as Ys}from"./invites-KSQld61K.js";async function Xs(){const{data:e}=await K.get("/chats");return e}async function ns(e){const{data:s}=await K.get(`/chats/${e}`);return s}async function Zs(e){const{data:s}=await K.get(`/chats/by-name/${encodeURIComponent(e)}`);return s}async function Xe(e){const{data:s}=await K.post("/chats",e);return s}async function ea(e){await K.post(`/chats/${e}/favorite`)}async function ta(e){await K.delete(`/chats/${e}/favorite`)}async function na(e,s){await K.post(`/chats/${e}/mute`,{})}async function sa(e){await K.delete(`/chats/${e}/mute`)}async function aa(e){await K.delete(`/chats/${e}/leave`)}async function oa(e){await K.post(`/chats/${e}/read`)}async function ia(e){await K.post(`/chats/${e}/pin`)}async function la(e){await K.delete(`/chats/${e}/pin`)}async function ra(e){await K.post(`/chats/${e}/archive`)}async function ca(e){await K.delete(`/chats/${e}/archive`)}async function ua(e){const{data:s}=await K.get(`/chats/${e}`);return s.members??[]}async function ss(e){await K.delete(`/chats/${e}`)}async function da(e,s){const{data:n}=await K.patch(`/chats/${e}`,s);return n}const Ce=We("chats",()=>{const e=b([]),s=b(null),n=b({}),o=b(new Set),a=b({}),i=H(()=>e.value.find(I=>I.id===s.value)??null),l=H(()=>[...e.value].sort((I,d)=>{if(I.is_pinned&&!d.is_pinned)return-1;if(!I.is_pinned&&d.is_pinned)return 1;if(I.is_favorite&&!d.is_favorite)return-1;if(!I.is_favorite&&d.is_favorite)return 1;const g=I.last_at||I.updated_at||"";return(d.last_at||d.updated_at||"").localeCompare(g)}));async function r(){try{e.value=await Xs()}catch(I){console.error("Failed to load chats",I)}}function f(I){if(s.value=I,I!==null){const d=e.value.find(g=>g.id===I);d&&d.unread_count>0&&(d.unread_count=0,oa(I).catch(()=>{}))}}async function k(I){const d=e.value.find(g=>g.id===I);if(d)try{d.is_favorite?await ta(I):await ea(I),d.is_favorite=!d.is_favorite}catch(g){throw console.error("Failed to toggle favorite",g),g}}async function p(I){const d=e.value.find(g=>g.id===I);if(d)try{d.is_muted?await sa(I):await na(I),d.is_muted=!d.is_muted}catch(g){throw console.error("Failed to toggle mute",g),g}}async function m(I){const d=e.value.find(g=>g.id===I);if(d)try{d.is_pinned?await la(I):await ia(I),d.is_pinned=!d.is_pinned}catch(g){throw console.error("Failed to toggle pin",g),g}}async function u(I){const d=e.value.find(g=>g.id===I);if(d)try{d.is_archived?await ca(I):await ra(I),d.is_archived=!d.is_archived}catch(g){throw console.error("Failed to toggle archive",g),g}}async function h(I){await aa(I),e.value=e.value.filter(d=>d.id!==I),s.value===I&&(s.value=null)}async function c(I){await ss(I),e.value=e.value.filter(d=>d.id!==I),s.value===I&&(s.value=null)}function w(I,d,g){const A=e.value.find(T=>T.id===I);A&&(A.last_message=d,A.last_at=g)}function O(I){const d=e.value.find(g=>g.id===I);d&&(d.unread_count=(d.unread_count||0)+1)}function S(I,d,g){n.value[I]||(n.value[I]={});const A=n.value[I][d];A&&clearTimeout(A.timer);const T=setTimeout(()=>{_(I,d)},3e3);n.value[I][d]={username:g,timer:T}}function _(I,d){if(n.value[I]){const g=n.value[I][d];g&&(clearTimeout(g.timer),delete n.value[I][d])}}function L(I){const d=n.value[I];return d?Object.values(d).map(g=>g.username):[]}function B(I){o.value=new Set([...o.value,I]),a.value={...a.value,[I]:{isOnline:!0}}}function $(I,d,g){const A=new Set(o.value);A.delete(I),o.value=A,a.value={...a.value,[I]:{isOnline:!1,lastSeenAt:d,lastSeenBucket:g}}}function R(I,d){if(d.isOnline)o.value=new Set([...o.value,I]);else{const g=new Set(o.value);g.delete(I),o.value=g}a.value={...a.value,[I]:d}}function W(I){return a.value[I]}function Z(I){return o.value.has(I)}return{chats:e,activeChatId:s,activeChat:i,sortedChats:l,typingUsers:n,loadChats:r,setActiveChat:f,toggleFavorite:k,toggleMute:p,togglePin:m,toggleArchive:u,leave:h,deleteChat:c,updateChatLastMessage:w,incrementUnread:O,setTyping:S,clearTyping:_,getTypingUsernames:L,onlineUsers:o,userPresenceDetails:a,setUserOnline:B,setUserOffline:$,setUserPresence:R,getUserPresence:W,isUserOnline:Z}});async function va(){const{data:e}=await K.get("/settings");return e}async function ma(e){await K.put("/settings",e)}const qt=We("settings",()=>{const e=b(localStorage.getItem("theme")||"light"),s=b(!0),n=b("en"),o=b("everyone");function a(r){e.value=r,document.body.setAttribute("data-theme",r),localStorage.setItem("theme",r)}async function i(){try{const r=await va();a(r.theme||"light"),s.value=r.notifications_enabled,n.value=r.language||"en",o.value=r.last_seen_visibility||"everyone"}catch(r){console.error("Failed to load settings",r)}}async function l(r){await ma(r),r.theme&&a(r.theme),r.notifications_enabled!==void 0&&(s.value=r.notifications_enabled),r.language&&(n.value=r.language),r.last_seen_visibility&&(o.value=r.last_seen_visibility)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:s,language:n,lastSeenVisibility:o,applyTheme:a,loadSettings:i,saveSettings:l}}),Gt=We("selection",()=>{const e=b(new Set),s=b(!1),n=b(null),o=H(()=>e.value.size);function a(k,p){s.value=!0,n.value=k,e.value=new Set(p!=null?[p]:[])}function i(){s.value=!1,n.value=null,e.value=new Set}function l(k){const p=new Set(e.value);p.has(k)?p.delete(k):p.add(k),e.value=p,p.size===0&&i()}function r(){e.value=new Set}function f(k){return e.value.has(k)}return{selectedMessageIds:e,selectionMode:s,currentChatId:n,selectedCount:o,enterSelectionMode:a,exitSelectionMode:i,toggleMessage:l,clearSelection:r,isSelected:f}});async function pt(e,s){const{data:n}=await K.get(`/chats/${e}/messages`,{params:s});return n}async function fa(e,s){const{data:n}=await K.post(`/chats/${e}/messages`,s);return n}async function pa(e,s){await K.delete(`/chats/${e}/messages/${s}`)}async function ha(e,s,n){const{data:o}=await K.put(`/chats/${e}/messages/${s}`,{content:n});return o}async function ga(e,s){const{data:n}=await K.post(`/chats/${e}/messages/forward`,s);return n}async function ya(e,s){const{data:n}=await K.post(`/chats/${e}/messages/${s}/pin`);return n}async function ba(e,s){await K.delete(`/chats/${e}/messages/${s}/pin`)}async function ka(e){const{data:s}=await K.get(`/chats/${e}/pinned-message`);return s}async function Un(e,s,n){const{data:o}=await K.get(`/chats/${e}/messages/search`,{params:{q:s,...n}});return o}async function wa(e,s,n){const{data:o}=await K.post(`/chats/${e}/messages/${s}/reactions`,{emoji:n});return o}async function _a(e,s){if(!s.length)return{};const{data:n}=await K.get(`/chats/${e}/reactions`,{params:{message_ids:s.join(",")}});return n}const Kt=We("messages",()=>{const e=b({}),s=b({}),n=b(null),o=b({}),a=b(new Set);async function i(d){const g=e.value[d];if(!g||g.length===0)return;const A=g.map(T=>T.id);try{const T=await _a(d,A);for(const M of g)M.reactions=T[String(M.id)]||void 0}catch(T){console.error("Failed to load reactions",T)}}async function l(d){n.value=d;try{const g=await pt(d,{limit:50});e.value[d]=g,g.length>0&&(s.value[d]=Math.max(...g.map(A=>A.id))),await i(d)}catch(g){throw console.error("Failed to load messages",g),g}finally{n.value=null}}async function r(d){const g=s.value[d]||0;if(g===0)return[];try{const A=await pt(d,{after_id:g,limit:50});if(A.length>0){e.value[d]||(e.value[d]=[]);const T=new Set(e.value[d].map(U=>U.id)),M=A.filter(U=>!T.has(U.id));e.value[d].push(...M),s.value[d]=Math.max(...A.map(U=>U.id)),await i(d)}return A}catch(A){return console.error("Failed to load newer messages",A),[]}}async function f(d){const g=e.value[d];if(!g||g.length===0)return[];const A=g[0];if(!A)return[];try{const T=await pt(d,{before:A.created_at,limit:50});if(T.length>0){const M=new Set(g.map(J=>J.id)),U=T.filter(J=>!M.has(J.id));e.value[d]=[...U,...g],await i(d)}return T}catch(T){return console.error("Failed to load older messages",T),[]}}async function k(d,g,A){try{const T=await wa(d,g,A);p(d,g,T.action,A,!0)}catch(T){console.error("Failed to toggle reaction",T)}}function p(d,g,A,T,M){const U=e.value[d];if(!U)return;const J=U.find(ge=>ge.id===g);if(!J)return;J.reactions||(J.reactions=[]);const re=J.reactions.find(ge=>ge.emoji===T);A==="added"?re?(re.count++,M&&(re.me=!0)):J.reactions.push({emoji:T,count:1,me:M}):re&&(re.count--,M&&(re.me=!1),re.count<=0&&(J.reactions=J.reactions.filter(ge=>ge.emoji!==T))),J.reactions.length===0&&(J.reactions=void 0)}async function m(d,g,A="text",T){const M=await fa(d,{content:g,type:A,...T});e.value[d]||(e.value[d]=[]),u(d,M);const U=e.value[d].findIndex(J=>J.id===M.id);return U!==-1?e.value[d][U]=M:e.value[d].push(M),s.value[d]=Math.max(s.value[d]||0,M.id),M}function u(d,g){if(!g.reply_to_message_id||g.reply_to_sender_username||g.reply_to_sender_name)return;const A=e.value[d];if(!A)return;const T=A.find(M=>M.id===g.reply_to_message_id);T&&(g.reply_to_sender_username=T.sender_username,g.reply_to_sender_name=T.sender_display_name||T.sender_username,!g.reply_to_content&&T.content&&(g.reply_to_content=T.content),!g.reply_to_type&&T.message_type&&(g.reply_to_type=T.message_type))}function h(d,g){e.value[d]||(e.value[d]=[]),e.value[d].find(T=>T.id===g.id)||(u(d,g),e.value[d].push(g),s.value[d]=Math.max(s.value[d]||0,g.id))}async function c(d,g){try{await pa(d,g),w(d,g)}catch(A){throw console.error("Failed to delete message",A),A}}function w(d,g){const A=e.value[d];A&&(e.value[d]=A.filter(T=>T.id!==g))}async function O(d,g,A){try{const T=await ha(d,g,A);S(d,g,T.content,T.updated_at)}catch(T){throw console.error("Failed to edit message",T),T}}function S(d,g,A,T){const M=e.value[d];if(!M)return;const U=M.find(J=>J.id===g);U&&(U.content=A,U.is_edited=!0,T&&(U.updated_at=T))}async function _(d,g,A){try{const T=await ga(d,{from_chat_id:g,message_ids:A});for(const M of T)h(d,M);return T}catch(T){throw console.error("Failed to forward messages",T),T}}async function L(d){try{const g=await ka(d);g&&g.message?o.value[d]={message:g.message,pinnedAt:g.pinned_at,pinnedBy:g.pinned_by}:o.value[d]=null}catch(g){console.error("Failed to load pinned message",g),o.value[d]=null}}async function B(d,g){try{const A=await ya(d,g);o.value[d]={message:A.message,pinnedAt:A.pinned_at,pinnedBy:A.pinned_by},a.value.delete(d)}catch(A){throw console.error("Failed to pin message",A),A}}async function $(d,g){try{await ba(d,g),o.value[d]=null}catch(A){throw console.error("Failed to unpin message",A),A}}function R(d,g,A,T){o.value[d]={message:T,pinnedAt:new Date().toISOString(),pinnedBy:A},a.value.delete(d)}function W(d){o.value[d]=null}function Z(d){a.value.add(d)}function I(d){return e.value[d]||[]}return{messagesByChat:e,lastMsgId:s,loadingChat:n,loadMessages:l,loadNewer:r,loadOlder:f,sendMessage:m,pushMessage:h,getMessages:I,toggleReaction:k,applyReactionUpdate:p,deleteMessage:c,removeMessage:w,editMessage:O,applyMessageUpdate:S,forwardMessages:_,pinnedByChat:o,pinnedDismissed:a,loadPinnedMessage:L,pinMsg:B,unpinMsg:$,applyMessagePinned:R,applyMessageUnpinned:W,dismissPin:Z}});function Ca(e,s,n){if(!document.hidden||e.sender_id===n.user?.id||!qt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||s.chats.find(f=>f.id===e.chat_id)?.is_muted)return;const i=e.sender_display_name||e.sender_username||"Someone",l=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(i,{body:l,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),s.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function $a(){const e=b(!1);let s=null,n=null,o=null,a=1e3,i=!1,l=null,r=!document.hidden&&document.hasFocus(),f=!1;function k(R){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"presence_update",status:R}))}function p(){const R=!document.hidden&&document.hasFocus();R&&!r?(l&&(clearTimeout(l),l=null),r=!0,k("active")):!R&&r&&(l||(l=setTimeout(()=>{l=null,r=!1,k("away")},3e3)))}function m(){f||(f=!0,document.addEventListener("visibilitychange",p),window.addEventListener("focus",p),window.addEventListener("blur",p))}function u(){f&&(f=!1,document.removeEventListener("visibilitychange",p),window.removeEventListener("focus",p),window.removeEventListener("blur",p),l&&(clearTimeout(l),l=null))}function h(){const R=localStorage.getItem("access_token");return R?`wss://ws.behappy.rest/ws?token=${encodeURIComponent(R)}`:null}function c(){if(s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING))return;const R=h();R&&(i=!1,s=new WebSocket(R),s.onopen=()=>{e.value=!0,a=1e3,r=!document.hidden&&document.hasFocus();const W=localStorage.getItem("access_token");W&&s.send(JSON.stringify({type:"auth",token:W,active:r}));const Z=Ce();for(const I of Z.chats)s.send(JSON.stringify({type:"subscribe",chat_id:I.id}));O(),m()},s.onmessage=W=>{try{const Z=JSON.parse(W.data);w(Z)}catch{}},s.onclose=()=>{e.value=!1,S(),i||_()},s.onerror=()=>{})}function w(R){const W=Kt(),Z=Ce(),I=Se();switch(R.type){case"message":{const d=R;W.pushMessage(d.chat_id,d),Z.updateChatLastMessage(d.chat_id,d.content||(d.message_type==="sticker"?"Sticker":"Attachment"),d.created_at),d.chat_id!==Z.activeChatId&&d.sender_id!==I.user?.id&&Z.incrementUnread(d.chat_id),Z.clearTyping(d.chat_id,d.sender_id),Ca(d,Z,I);break}case"typing":{const d=R.chat_id,g=R.user_id;if(g!==I.user?.id){const A=R.username||"Someone";Z.setTyping(d,g,A)}break}case"pong":break;case"presence":{const d=R.user_id,g=R.status,A=R.last_seen_at,T=R.last_seen_bucket;if(g==="online")Z.setUserOnline(d);else if(g==="offline"){const M=A||new Date().toISOString();Z.setUserOffline(d,M,T)}break}case"message_deleted":{const d=R.chat_id,g=R.message_id;W.removeMessage(d,g);break}case"message_updated":{const d=R.chat_id,g=R.message_id,A=R.content,T=R.updated_at;W.applyMessageUpdate(d,g,A,T);break}case"message_pinned":{const d=R.chat_id,g=R.message_id,A=R.pinned_by,T=R.message;W.applyMessagePinned(d,g,A,T);break}case"message_unpinned":{const d=R.chat_id;W.applyMessageUnpinned(d);break}case"reaction":{const d=R.chat_id,g=R.message_id,A=R.user_id,T=R.emoji,M=R.action;W.applyReactionUpdate(d,g,M,T,A===I.user?.id);break}}}function O(){S(),o=setInterval(()=>{s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},25e3)}function S(){o&&(clearInterval(o),o=null)}function _(){n||(n=setTimeout(()=>{n=null,c(),a=Math.min(a*2,3e4)},a))}function L(R){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"subscribe",chat_id:R}))}function B(R){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"typing",chat_id:R}))}function $(){i=!0,S(),u(),n&&(clearTimeout(n),n=null),s&&(s.close(),s=null),e.value=!1}return Ue(()=>{$()}),{connected:e,connect:c,disconnect:$,subscribeToChat:L,sendTyping:B}}async function as(e){const{data:s}=await K.get(`/users/${e}`);return s}async function os(e){const{data:s}=await K.get(`/users/by-username/${encodeURIComponent(e)}`);return s}async function Fn(e){const{data:s}=await K.get("/users/search",{params:{q:e}});return s}async function Sa(e,s){const{data:n}=await K.put(`/users/${e}`,s);return n}async function Ma(e){const{data:s}=await K.put("/users/me/avatar",{file_id:e});return s}async function xa(){const{data:e}=await K.get("/stickers");return e}const Ta=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};const Hn=e=>e==="";const Ea=(...e)=>e.filter((s,n,o)=>!!s&&s.trim()!==""&&o.indexOf(s)===n).join(" ").trim();const Bn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const La=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,n,o)=>o?o.toUpperCase():n.toLowerCase());const Ia=e=>{const s=La(e);return s.charAt(0).toUpperCase()+s.slice(1)};var Ke={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Aa=({name:e,iconNode:s,absoluteStrokeWidth:n,"absolute-stroke-width":o,strokeWidth:a,"stroke-width":i,size:l=Ke.width,color:r=Ke.stroke,...f},{slots:k})=>ln("svg",{...Ke,...f,width:l,height:l,stroke:r,"stroke-width":Hn(n)||Hn(o)||n===!0||o===!0?Number(a||i||Ke["stroke-width"])*24/Number(l):a||i||Ke["stroke-width"],class:Ea("lucide",f.class,...e?[`lucide-${Bn(Ia(e))}-icon`,`lucide-${Bn(e)}`]:["lucide-icon"]),...!k.default&&!Ta(f)&&{"aria-hidden":"true"}},[...s.map(p=>ln(...p)),...k.default?[k.default()]:[]]);const oe=(e,s)=>(n,{slots:o,attrs:a})=>ln(Aa,{...a,...n,iconNode:s,name:e},o);const Be=oe("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Da=oe("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const Ra=oe("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const is=oe("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Oa=oe("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const Pa=oe("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Na=oe("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Ua=oe("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const Fa=oe("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const Ha=oe("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const yn=oe("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const ls=oe("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const Ba=oe("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const ja=oe("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const za=oe("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const Va=oe("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Wa=oe("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const qa=oe("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Ga=oe("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const Ka=oe("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const rs=oe("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const cs=oe("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const bn=oe("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const Fe=oe("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ja={class:"swipe-actions swipe-actions-left"},Qa={class:"chat-item-info"},Ya={class:"chat-item-top"},Xa={class:"chat-item-name"},Za={key:0,class:"pin-icon",title:"Pinned"},eo={key:1,class:"ci-channel"},to={key:2,class:"ci-group"},no={key:3,class:"mute-icon",title:"Muted"},so={class:"chat-item-time"},ao={class:"chat-item-bottom"},oo={class:"chat-item-preview"},io=["title"],lo={class:"swipe-actions swipe-actions-right"},jn=70,ro=ee({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:s}){const n=e,o=Ce(),a=Se(),i=H(()=>n.chat.type==="direct"&&!n.chat.other_user_id),l=H(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:o.isUserOnline(n.chat.other_user_id)||null),r=H(()=>(n.chat.unread_count??0)>0),f=s,k=H(()=>{const S=n.chat;return i.value?"Saved Messages":S.type==="channel"||S.type==="group"?S.title||S.name||"Untitled":S.other_display_name||S.other_username||S.title||S.name||"Chat"});function p(S){if(!S)return"";const _=new Date(S.endsWith("Z")?S:S+"Z"),L=new Date;return _.toDateString()===L.toDateString()?_.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):_.toLocaleDateString([],{month:"short",day:"numeric"})}const m=b(0);let u=0,h=!1;function c(S){u=S.touches[0].clientX,h=!0}function w(S){if(!h)return;const _=S.touches[0].clientX-u;m.value=Math.max(-jn,Math.min(jn,_))}function O(){h=!1,m.value=0}return(S,_)=>(v(),y("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:c,onTouchmove:w,onTouchend:O},[t("div",Ja,[t("button",{class:"swipe-action swipe-pin",onClick:_[0]||(_[0]=L=>f("togglePin"))},D(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:ue(["chat-item",{active:e.active,"chat-item-unread":r.value}]),style:lt({transform:`translateX(${m.value}px)`}),onClick:_[2]||(_[2]=L=>f("select")),onContextmenu:_[3]||(_[3]=ae(L=>f("contextmenu",L),["prevent"]))},[j(he,{name:k.value,url:i.value?x(a).user?.avatar_url||null:e.chat.type==="direct"?e.chat.other_avatar_url:e.chat.avatar_url,size:"sm",online:l.value},null,8,["name","url","online"]),t("div",Qa,[t("div",Ya,[t("span",Xa,[e.chat.is_pinned?(v(),y("span",Za,"ğŸ“Œ")):F("",!0),e.chat.type==="channel"?(v(),y("span",eo)):e.chat.type==="group"?(v(),y("span",to)):F("",!0),ke(" "+D(k.value)+" ",1),e.chat.is_muted?(v(),y("span",no,"ğŸ””")):F("",!0)]),t("span",so,D(p(e.chat.last_at||e.chat.updated_at)),1)]),t("div",ao,[t("span",oo,D(e.chat.last_message||""),1),e.chat.unread_count>0?(v(),y("span",{key:0,class:ue(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},D(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):F("",!0)])]),t("button",{class:ue(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:_[1]||(_[1]=ae(L=>f("toggleFavorite"),["stop"]))},"â˜…",10,io)],38),t("div",lo,[t("button",{class:"swipe-action swipe-mute",onClick:_[4]||(_[4]=L=>f("toggleMute"))},D(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),de=(e,s)=>{const n=e.__vccOpts||e;for(const[o,a]of s)n[o]=a;return n},Zt=de(ro,[["__scopeId","data-v-c5aa49d4"]]),co={class:"sidebar"},uo={class:"sidebar-header"},vo={class:"search-wrap"},mo={class:"chat-list"},fo={key:0,class:"empty-state-small"},po={key:0,class:"chat-section-label"},ho={key:1,class:"chat-section-label"},go={key:2,class:"chat-section-label"},yo=ee({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:s}){const n=s,o=Ce(),a=b(""),i=H(()=>{const u=a.value.toLowerCase(),h=o.sortedChats.filter(c=>!c.is_archived);return u?h.filter(c=>{const w=k(c).toLowerCase(),O=(c.other_username||"").toLowerCase();return w.includes(u)||O.includes(u)}):h}),l=H(()=>i.value.filter(u=>u.is_pinned&&!u.is_favorite)),r=H(()=>i.value.filter(u=>u.is_favorite&&!u.is_pinned)),f=H(()=>i.value.filter(u=>!u.is_favorite&&!u.is_pinned));function k(u){return u.type==="channel"||u.type==="group"?u.title||u.name||"Untitled":u.type==="direct"&&!u.other_user_id?"Saved Messages":u.other_display_name||u.other_username||u.title||u.name||"Chat"}const p=b(null);ft("contextChatId",p);function m(u,h){u.preventDefault(),p.value=h,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:u.clientX,y:u.clientY,chatId:h}}))}return(u,h)=>(v(),y("aside",co,[t("header",uo,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:h[0]||(h[0]=c=>n("openDrawer"))},[j(x(Ba),{size:20})]),t("div",vo,[ne(t("input",{"onUpdate:modelValue":h[1]||(h[1]=c=>a.value=c),class:"search-input",type:"search",placeholder:"Search chats..."},null,512),[[ce,a.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:h[2]||(h[2]=c=>n("openNewChat"))},[j(x(Ga),{size:20})])]),t("div",mo,[i.value.length===0?(v(),y("div",fo,[...h[3]||(h[3]=[ke(" No conversations yet.",-1),t("br",null,null,-1),ke("Click the pencil icon to start one. ",-1)])])):(v(),y(se,{key:1},[l.value.length>0?(v(),y("div",po,"Pinned")):F("",!0),(v(!0),y(se,null,ve(l.value,c=>(v(),Y(Zt,{key:c.id,chat:c,active:c.id===x(o).activeChatId,onSelect:w=>n("selectChat",c.id),onToggleFavorite:w=>x(o).toggleFavorite(c.id),onTogglePin:w=>x(o).togglePin(c.id),onToggleMute:w=>x(o).toggleMute(c.id),onToggleArchive:w=>x(o).toggleArchive(c.id),onContextmenu:w=>m(w,c.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(v(),y("div",ho,"Starred")):F("",!0),(v(!0),y(se,null,ve(r.value,c=>(v(),Y(Zt,{key:c.id,chat:c,active:c.id===x(o).activeChatId,onSelect:w=>n("selectChat",c.id),onToggleFavorite:w=>x(o).toggleFavorite(c.id),onTogglePin:w=>x(o).togglePin(c.id),onToggleMute:w=>x(o).toggleMute(c.id),onToggleArchive:w=>x(o).toggleArchive(c.id),onContextmenu:w=>m(w,c.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(l.value.length>0||r.value.length>0)&&f.value.length>0?(v(),y("div",go," All chats ")):F("",!0),(v(!0),y(se,null,ve(f.value,c=>(v(),Y(Zt,{key:c.id,chat:c,active:c.id===x(o).activeChatId,onSelect:w=>n("selectChat",c.id),onToggleFavorite:w=>x(o).toggleFavorite(c.id),onTogglePin:w=>x(o).togglePin(c.id),onToggleMute:w=>x(o).toggleMute(c.id),onToggleArchive:w=>x(o).toggleArchive(c.id),onContextmenu:w=>m(w,c.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function bo(){const e=b(!1),s=b(0);let n=null,o=[],a=null;async function i(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const p=await navigator.mediaDevices.getUserMedia({audio:!0});o=[],s.value=0,n=new MediaRecorder(p),n.ondataavailable=m=>{m.data.size&&o.push(m.data)},n.start(),e.value=!0,a=setInterval(()=>{s.value++},1e3)}function l(){return new Promise((p,m)=>{if(!n||n.state!=="recording"){m(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(O=>O.stop()),f(),e.value=!1;const u=n?.mimeType||"audio/webm",h=u.includes("ogg")?"ogg":"webm",c=new Blob(o,{type:u}),w=new File([c],`voice.${h}`,{type:u});p(w)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(p=>p.stop())},n.stop()),f(),e.value=!1,s.value=0}function f(){a&&(clearInterval(a),a=null)}function k(p){const m=Math.floor(p/60),u=p%60;return`${m}:${String(u).padStart(2,"0")}`}return{isRecording:e,seconds:s,startRecording:i,stopRecording:l,cancelRecording:r,formatTime:k}}async function kn(e){const s=new FormData;s.append("file",e);const{data:n}=await K.post("/files",s);return n}const ko={class:"pin-bar-content"},wo={class:"pin-bar-sender"},_o={class:"pin-bar-text"},Co=ee({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const s=e,n=H(()=>s.message.sender_display_name||s.message.sender_username||"Unknown"),o=H(()=>{const a=s.message;switch(a.message_type){case"sticker":return a.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return a.content||""}});return(a,i)=>(v(),y("div",{class:"pin-bar",onClick:i[1]||(i[1]=l=>a.$emit("click"))},[i[2]||(i[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",ko,[t("span",wo,D(n.value),1),t("span",_o,D(o.value),1)]),t("button",{class:"pin-bar-close",onClick:i[0]||(i[0]=ae(l=>a.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}});function us(e){const s=new Date(e),o=new Date().getTime()-s.getTime(),a=Math.floor(o/1e3),i=Math.floor(a/60),l=Math.floor(i/60),r=Math.floor(l/24);if(i<1)return"last seen just now";if(i<60)return`last seen ${i} minute${i!==1?"s":""} ago`;if(l<24)return`last seen ${l} hour${l!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const f=s.toLocaleString("en",{month:"short"}),k=s.getDate();return`last seen ${f} ${k}`}const $o={class:"chat-header"},So={class:"chat-header-name"},Mo=ee({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:s}){const n=s,o=Ce(),a=Se(),i=H(()=>o.activeChat),l=H(()=>{const c=i.value;return c?.type==="direct"&&!c.other_user_id}),r=H(()=>{const c=i.value;return c?l.value?"Saved Messages":c.type==="channel"||c.type==="group"?c.title||c.name||"Untitled":c.other_display_name||c.other_username||c.title||c.name||"Chat":"---"}),f=H(()=>{const c=i.value;if(c)return l.value?a.user?.avatar_url:c.type==="direct"?c.other_avatar_url:c.avatar_url}),k=H(()=>i.value?o.getTypingUsernames(i.value.id):[]),p=H(()=>k.value.length>0),m=H(()=>{const c=i.value;return!c||c.type!=="direct"||!c.other_user_id?!1:o.isUserOnline(c.other_user_id)}),u=H(()=>{if(k.value.length===1)return`${k.value[0]} is typing...`;if(k.value.length>1)return`${k.value.length} people typing...`;const c=i.value;if(!c)return"";if(l.value)return"personal storage";if(c.type==="channel"){const w=c.member_count??0;return`${w} subscriber${w!==1?"s":""}`}if(c.type==="group"){const w=c.member_count??0;return`${w} member${w!==1?"s":""}`}if(m.value)return"online";if(c.type==="direct"&&c.other_user_id){const w=o.getUserPresence(c.other_user_id);if(w){if(w.lastSeenAt)return us(w.lastSeenAt);if(w.lastSeenBucket)return`last seen ${w.lastSeenBucket}`}}return c.other_username?"@"+c.other_username:""});Le(()=>i.value?.id,()=>{const c=i.value;if(!c||c.type!=="direct"||!c.other_user_id)return;const w=c.other_user_id;o.getUserPresence(w)||as(w).then(O=>{O.last_activity&&o.setUserPresence(w,{isOnline:o.isUserOnline(w),lastSeenAt:O.last_activity})}).catch(()=>{})},{immediate:!0});function h(){const c=i.value;c&&(c.type==="channel"||c.type==="group"?n("openChannelInfo"):c.type==="direct"&&c.other_username&&n("openUserProfile",c.other_username))}return(c,w)=>(v(),y("header",$o,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:w[0]||(w[0]=O=>n("back"))},"â†"),j(he,{class:"chat-header-avatar",name:r.value,url:f.value,online:m.value,size:"sm",onClick:h},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:h},[t("div",So,D(r.value),1),u.value?(v(),y("div",{key:0,class:ue(["chat-header-sub",{"typing-text":p.value,"online-text":m.value&&!p.value}])},D(u.value),3)):F("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:w[1]||(w[1]=O=>n("openSearch"))},"ğŸ”")]))}}),xo="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",To="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",cn="numeric",un="ascii",dn="alpha",Ze="asciinumeric",Qe="alphanumeric",vn="domain",ds="emoji",Eo="scheme",Lo="slashscheme",en="whitespace";function Io(e,s){return e in s||(s[e]=[]),s[e]}function He(e,s,n){s[cn]&&(s[Ze]=!0,s[Qe]=!0),s[un]&&(s[Ze]=!0,s[dn]=!0),s[Ze]&&(s[Qe]=!0),s[dn]&&(s[Qe]=!0),s[Qe]&&(s[vn]=!0),s[ds]&&(s[vn]=!0);for(const o in s){const a=Io(o,n);a.indexOf(e)<0&&a.push(e)}}function Ao(e,s){const n={};for(const o in s)s[o].indexOf(e)>=0&&(n[o]=!0);return n}function be(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}be.groups={};be.prototype={accepts(){return!!this.t},go(e){const s=this,n=s.j[e];if(n)return n;for(let o=0;o<s.jr.length;o++){const a=s.jr[o][0],i=s.jr[o][1];if(i&&a.test(e))return i}return s.jd},has(e,s=!1){return s?e in this.j:!!this.go(e)},ta(e,s,n,o){for(let a=0;a<e.length;a++)this.tt(e[a],s,n,o)},tr(e,s,n,o){o=o||be.groups;let a;return s&&s.j?a=s:(a=new be(s),n&&o&&He(s,n,o)),this.jr.push([e,a]),a},ts(e,s,n,o){let a=this;const i=e.length;if(!i)return a;for(let l=0;l<i-1;l++)a=a.tt(e[l]);return a.tt(e[i-1],s,n,o)},tt(e,s,n,o){o=o||be.groups;const a=this;if(s&&s.j)return a.j[e]=s,s;const i=s;let l,r=a.go(e);if(r?(l=new be,Object.assign(l.j,r.j),l.jr.push.apply(l.jr,r.jr),l.jd=r.jd,l.t=r.t):l=new be,i){if(o)if(l.t&&typeof l.t=="string"){const f=Object.assign(Ao(l.t,o),n);He(i,f,o)}else n&&He(i,n,o);l.t=i}return a.j[e]=l,l}};const G=(e,s,n,o,a)=>e.ta(s,n,o,a),le=(e,s,n,o,a)=>e.tr(s,n,o,a),zn=(e,s,n,o,a)=>e.ts(s,n,o,a),E=(e,s,n,o,a)=>e.tt(s,n,o,a),De="WORD",mn="UWORD",vs="ASCIINUMERICAL",ms="ALPHANUMERICAL",ot="LOCALHOST",fn="TLD",pn="UTLD",ht="SCHEME",Ve="SLASH_SCHEME",wn="NUM",hn="WS",_n="NL",et="OPENBRACE",tt="CLOSEBRACE",bt="OPENBRACKET",kt="CLOSEBRACKET",wt="OPENPAREN",_t="CLOSEPAREN",Ct="OPENANGLEBRACKET",$t="CLOSEANGLEBRACKET",St="FULLWIDTHLEFTPAREN",Mt="FULLWIDTHRIGHTPAREN",xt="LEFTCORNERBRACKET",Tt="RIGHTCORNERBRACKET",Et="LEFTWHITECORNERBRACKET",Lt="RIGHTWHITECORNERBRACKET",It="FULLWIDTHLESSTHAN",At="FULLWIDTHGREATERTHAN",Dt="AMPERSAND",Rt="APOSTROPHE",Ot="ASTERISK",Pe="AT",Pt="BACKSLASH",Nt="BACKTICK",Ut="CARET",Ne="COLON",Cn="COMMA",Ft="DOLLAR",Te="DOT",Ht="EQUALS",$n="EXCLAMATION",_e="HYPHEN",nt="PERCENT",Bt="PIPE",jt="PLUS",zt="POUND",st="QUERY",Sn="QUOTE",fs="FULLWIDTHMIDDLEDOT",Mn="SEMI",Ee="SLASH",at="TILDE",Vt="UNDERSCORE",ps="EMOJI",Wt="SYM";var hs=Object.freeze({__proto__:null,ALPHANUMERICAL:ms,AMPERSAND:Dt,APOSTROPHE:Rt,ASCIINUMERICAL:vs,ASTERISK:Ot,AT:Pe,BACKSLASH:Pt,BACKTICK:Nt,CARET:Ut,CLOSEANGLEBRACKET:$t,CLOSEBRACE:tt,CLOSEBRACKET:kt,CLOSEPAREN:_t,COLON:Ne,COMMA:Cn,DOLLAR:Ft,DOT:Te,EMOJI:ps,EQUALS:Ht,EXCLAMATION:$n,FULLWIDTHGREATERTHAN:At,FULLWIDTHLEFTPAREN:St,FULLWIDTHLESSTHAN:It,FULLWIDTHMIDDLEDOT:fs,FULLWIDTHRIGHTPAREN:Mt,HYPHEN:_e,LEFTCORNERBRACKET:xt,LEFTWHITECORNERBRACKET:Et,LOCALHOST:ot,NL:_n,NUM:wn,OPENANGLEBRACKET:Ct,OPENBRACE:et,OPENBRACKET:bt,OPENPAREN:wt,PERCENT:nt,PIPE:Bt,PLUS:jt,POUND:zt,QUERY:st,QUOTE:Sn,RIGHTCORNERBRACKET:Tt,RIGHTWHITECORNERBRACKET:Lt,SCHEME:ht,SEMI:Mn,SLASH:Ee,SLASH_SCHEME:Ve,SYM:Wt,TILDE:at,TLD:fn,UNDERSCORE:Vt,UTLD:pn,UWORD:mn,WORD:De,WS:hn});const Ie=/[a-z]/,Je=new RegExp("\\p{L}","u"),tn=new RegExp("\\p{Emoji}","u"),Ae=/\d/,nn=/\s/,Vn="\r",sn=`
`,Do="ï¸",Ro="â€",an="ï¿¼";let dt=null,vt=null;function Oo(e=[]){const s={};be.groups=s;const n=new be;dt==null&&(dt=Wn(xo)),vt==null&&(vt=Wn(To)),E(n,"'",Rt),E(n,"{",et),E(n,"}",tt),E(n,"[",bt),E(n,"]",kt),E(n,"(",wt),E(n,")",_t),E(n,"<",Ct),E(n,">",$t),E(n,"ï¼ˆ",St),E(n,"ï¼‰",Mt),E(n,"ã€Œ",xt),E(n,"ã€",Tt),E(n,"ã€",Et),E(n,"ã€",Lt),E(n,"ï¼œ",It),E(n,"ï¼",At),E(n,"&",Dt),E(n,"*",Ot),E(n,"@",Pe),E(n,"`",Nt),E(n,"^",Ut),E(n,":",Ne),E(n,",",Cn),E(n,"$",Ft),E(n,".",Te),E(n,"=",Ht),E(n,"!",$n),E(n,"-",_e),E(n,"%",nt),E(n,"|",Bt),E(n,"+",jt),E(n,"#",zt),E(n,"?",st),E(n,'"',Sn),E(n,"/",Ee),E(n,";",Mn),E(n,"~",at),E(n,"_",Vt),E(n,"\\",Pt),E(n,"ãƒ»",fs);const o=le(n,Ae,wn,{[cn]:!0});le(o,Ae,o);const a=le(o,Ie,vs,{[Ze]:!0}),i=le(o,Je,ms,{[Qe]:!0}),l=le(n,Ie,De,{[un]:!0});le(l,Ae,a),le(l,Ie,l),le(a,Ae,a),le(a,Ie,a);const r=le(n,Je,mn,{[dn]:!0});le(r,Ie),le(r,Ae,i),le(r,Je,r),le(i,Ae,i),le(i,Ie),le(i,Je,i);const f=E(n,sn,_n,{[en]:!0}),k=E(n,Vn,hn,{[en]:!0}),p=le(n,nn,hn,{[en]:!0});E(n,an,p),E(k,sn,f),E(k,an,p),le(k,nn,p),E(p,Vn),E(p,sn),le(p,nn,p),E(p,an,p);const m=le(n,tn,ps,{[ds]:!0});E(m,"#"),le(m,tn,m),E(m,Do,m);const u=E(m,Ro);E(u,"#"),le(u,tn,m);const h=[[Ie,l],[Ae,a]],c=[[Ie,null],[Je,r],[Ae,i]];for(let w=0;w<dt.length;w++)Oe(n,dt[w],fn,De,h);for(let w=0;w<vt.length;w++)Oe(n,vt[w],pn,mn,c);He(fn,{tld:!0,ascii:!0},s),He(pn,{utld:!0,alpha:!0},s),Oe(n,"file",ht,De,h),Oe(n,"mailto",ht,De,h),Oe(n,"http",Ve,De,h),Oe(n,"https",Ve,De,h),Oe(n,"ftp",Ve,De,h),Oe(n,"ftps",Ve,De,h),He(ht,{scheme:!0,ascii:!0},s),He(Ve,{slashscheme:!0,ascii:!0},s),e=e.sort((w,O)=>w[0]>O[0]?1:-1);for(let w=0;w<e.length;w++){const O=e[w][0],_=e[w][1]?{[Eo]:!0}:{[Lo]:!0};O.indexOf("-")>=0?_[vn]=!0:Ie.test(O)?Ae.test(O)?_[Ze]=!0:_[un]=!0:_[cn]=!0,zn(n,O,O,_)}return zn(n,"localhost",ot,{ascii:!0}),n.jd=new be(Wt),{start:n,tokens:Object.assign({groups:s},hs)}}function gs(e,s){const n=Po(s.replace(/[A-Z]/g,r=>r.toLowerCase())),o=n.length,a=[];let i=0,l=0;for(;l<o;){let r=e,f=null,k=0,p=null,m=-1,u=-1;for(;l<o&&(f=r.go(n[l]));)r=f,r.accepts()?(m=0,u=0,p=r):m>=0&&(m+=n[l].length,u++),k+=n[l].length,i+=n[l].length,l++;i-=m,l-=u,k-=m,a.push({t:p.t,v:s.slice(i-k,i),s:i-k,e:i})}return a}function Po(e){const s=[],n=e.length;let o=0;for(;o<n;){let a=e.charCodeAt(o),i,l=a<55296||a>56319||o+1===n||(i=e.charCodeAt(o+1))<56320||i>57343?e[o]:e.slice(o,o+2);s.push(l),o+=l.length}return s}function Oe(e,s,n,o,a){let i;const l=s.length;for(let r=0;r<l-1;r++){const f=s[r];e.j[f]?i=e.j[f]:(i=new be(o),i.jr=a.slice(),e.j[f]=i),e=i}return i=new be(n),i.jr=a.slice(),e.j[s[l-1]]=i,i}function Wn(e){const s=[],n=[];let o=0,a="0123456789";for(;o<e.length;){let i=0;for(;a.indexOf(e[o+i])>=0;)i++;if(i>0){s.push(n.join(""));for(let l=parseInt(e.substring(o,o+i),10);l>0;l--)n.pop();o+=i}else n.push(e[o]),o++}return s}const it={defaultProtocol:"http",events:null,format:qn,formatHref:qn,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function xn(e,s=null){let n=Object.assign({},it);e&&(n=Object.assign(n,e instanceof xn?e.o:e));const o=n.ignoreTags,a=[];for(let i=0;i<o.length;i++)a.push(o[i].toUpperCase());this.o=n,s&&(this.defaultRender=s),this.ignoreTags=a}xn.prototype={o:it,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,s,n){const o=s!=null;let a=this.o[e];return a&&(typeof a=="object"?(a=n.t in a?a[n.t]:it[e],typeof a=="function"&&o&&(a=a(s,n))):typeof a=="function"&&o&&(a=a(s,n.t,n)),a)},getObj(e,s,n){let o=this.o[e];return typeof o=="function"&&s!=null&&(o=o(s,n.t,n)),o},render(e){const s=e.render(this);return(this.get("render",null,e)||this.defaultRender)(s,e.t,e)}};function qn(e){return e}function ys(e,s){this.t="token",this.v=e,this.tk=s}ys.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const s=this.toString(),n=e.get("truncate",s,this),o=e.get("format",s,this);return n&&o.length>n?o.substring(0,n)+"â€¦":o},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=it.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const s=this,n=this.toHref(e.get("defaultProtocol")),o=e.get("formatHref",n,this),a=e.get("tagName",n,s),i=this.toFormattedString(e),l={},r=e.get("className",n,s),f=e.get("target",n,s),k=e.get("rel",n,s),p=e.getObj("attributes",n,s),m=e.getObj("events",n,s);return l.href=o,r&&(l.class=r),f&&(l.target=f),k&&(l.rel=k),p&&Object.assign(l,p),{tagName:a,attributes:l,content:i,eventListeners:m}}};function Jt(e,s){class n extends ys{constructor(a,i){super(a,i),this.t=e}}for(const o in s)n.prototype[o]=s[o];return n.t=e,n}const Gn=Jt("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Kn=Jt("text"),No=Jt("nl"),mt=Jt("url",{isLink:!0,toHref(e=it.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==ot&&e[1].t===Ne}}),we=e=>new be(e);function Uo({groups:e}){const s=e.domain.concat([Dt,Ot,Pe,Pt,Nt,Ut,Ft,Ht,_e,wn,nt,Bt,jt,zt,Ee,Wt,at,Vt]),n=[Rt,Ne,Cn,Te,$n,nt,st,Sn,Mn,Ct,$t,et,tt,kt,bt,wt,_t,St,Mt,xt,Tt,Et,Lt,It,At],o=[Dt,Rt,Ot,Pt,Nt,Ut,Ft,Ht,_e,et,tt,nt,Bt,jt,zt,st,Ee,Wt,at,Vt],a=we(),i=E(a,at);G(i,o,i),G(i,e.domain,i);const l=we(),r=we(),f=we();G(a,e.domain,l),G(a,e.scheme,r),G(a,e.slashscheme,f),G(l,o,i),G(l,e.domain,l);const k=E(l,Pe);E(i,Pe,k),E(r,Pe,k),E(f,Pe,k);const p=E(i,Te);G(p,o,i),G(p,e.domain,i);const m=we();G(k,e.domain,m),G(m,e.domain,m);const u=E(m,Te);G(u,e.domain,m);const h=we(Gn);G(u,e.tld,h),G(u,e.utld,h),E(k,ot,h);const c=E(m,_e);E(c,_e,c),G(c,e.domain,m),G(h,e.domain,m),E(h,Te,u),E(h,_e,c);const w=E(h,Ne);G(w,e.numeric,Gn);const O=E(l,_e),S=E(l,Te);E(O,_e,O),G(O,e.domain,l),G(S,o,i),G(S,e.domain,l);const _=we(mt);G(S,e.tld,_),G(S,e.utld,_),G(_,e.domain,l),G(_,o,i),E(_,Te,S),E(_,_e,O),E(_,Pe,k);const L=E(_,Ne),B=we(mt);G(L,e.numeric,B);const $=we(mt),R=we();G($,s,$),G($,n,R),G(R,s,$),G(R,n,R),E(_,Ee,$),E(B,Ee,$);const W=E(r,Ne),Z=E(f,Ne),I=E(Z,Ee),d=E(I,Ee);G(r,e.domain,l),E(r,Te,S),E(r,_e,O),G(f,e.domain,l),E(f,Te,S),E(f,_e,O),G(W,e.domain,$),E(W,Ee,$),E(W,st,$),G(d,e.domain,$),G(d,s,$),E(d,Ee,$);const g=[[et,tt],[bt,kt],[wt,_t],[Ct,$t],[St,Mt],[xt,Tt],[Et,Lt],[It,At]];for(let A=0;A<g.length;A++){const[T,M]=g[A],U=E($,T);E(R,T,U),E(U,M,$);const J=we(mt);G(U,s,J);const re=we();G(U,n),G(J,s,J),G(J,n,re),G(re,s,J),G(re,n,re),E(J,M,$),E(re,M,$)}return E(a,ot,_),E(a,_n,No),{start:a,tokens:hs}}function Fo(e,s,n){let o=n.length,a=0,i=[],l=[];for(;a<o;){let r=e,f=null,k=null,p=0,m=null,u=-1;for(;a<o&&!(f=r.go(n[a].t));)l.push(n[a++]);for(;a<o&&(k=f||r.go(n[a].t));)f=null,r=k,r.accepts()?(u=0,m=r):u>=0&&u++,a++,p++;if(u<0)a-=p,a<o&&(l.push(n[a]),a++);else{l.length>0&&(i.push(on(Kn,s,l)),l=[]),a-=u,p-=u;const h=m.t,c=n.slice(a-p,a);i.push(on(h,s,c))}}return l.length>0&&i.push(on(Kn,s,l)),i}function on(e,s,n){const o=n[0].s,a=n[n.length-1].e,i=s.slice(o,a);return new e(i,n)}const me={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Ho(){me.scanner=Oo(me.customSchemes);for(let e=0;e<me.tokenQueue.length;e++)me.tokenQueue[e][1]({scanner:me.scanner});me.parser=Uo(me.scanner.tokens);for(let e=0;e<me.pluginQueue.length;e++)me.pluginQueue[e][1]({scanner:me.scanner,parser:me.parser});return me.initialized=!0,me}function bs(e){return me.initialized||Ho(),Fo(me.parser.start,e,gs(me.scanner.start,e))}bs.scan=gs;function ks(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Bo(e){return e.replace(/"/g,"&quot;")}function jo(e){const s=[];for(const n in e){let o=e[n]+"";s.push(`${n}="${Bo(o)}"`)}return s.join(" ")}function zo({tagName:e,attributes:s,content:n}){return`<${e} ${jo(s)}>${ks(n)}</${e}>`}function ws(e,s={}){s=new xn(s,zo);const n=bs(e),o=[];for(let a=0;a<n.length;a++){const i=n[a];i.t==="nl"&&s.get("nl2br")?o.push(`<br>
`):!i.isLink||!s.check(i)?o.push(ks(i.toString())):o.push(s.render(i))}return o.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(s){return ws(this,s)}});const Vo={},Wo={class:"admin-badge",title:"Admin"};function qo(e,s){return v(),y("span",Wo,"âœ“")}const _s=de(Vo,[["render",qo]]);function Go(e){const{delay:s=500,scrollThreshold:n=5,onLongPress:o,onCancel:a}=e,i=b(!1);let l=null,r=0,f=0,k=!1;function p(){l&&(clearTimeout(l),l=null)}function m(w){r=w.clientX,f=w.clientY,k=!1,i.value=!0,p(),l=setTimeout(()=>{k=!0,o(w)},s)}function u(w){if(!l)return;const O=w.clientX-r,S=w.clientY-f;(Math.abs(O)>n||Math.abs(S)>n)&&c()}function h(){p(),i.value=!1}function c(){p(),i.value=!1,k||a?.()}return{isPressed:i,onPointerDown:m,onPointerUp:h,onPointerMove:u}}const Ko=["data-message-id"],Jo={key:0,class:"selection-checkbox"},Qo=["checked"],Yo={key:1,class:"msg-sender-name"},Xo={class:"msg-content-wrap"},Zo={key:0,class:"msg-forwarded-label"},ei={class:"msg-reply-quote-name"},ti={class:"msg-reply-quote-text"},ni={key:2,class:"msg-bubble sticker-bubble"},si=["src","alt"],ai={key:3,class:"msg-bubble"},oi={class:"voice-player"},ii={class:"voice-dur"},li=["innerHTML"],ri={key:5,class:"reaction-chips"},ci=["onClick"],ui={class:"reaction-emoji"},di={class:"reaction-count"},vi={class:"msg-time"},mi={key:0,class:"msg-edited-label"},fi=ee({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:s}){const n=e,o=s,a=Gt(),i=Ce(),l=H(()=>a.isSelected(n.message.id)),{onPointerDown:r,onPointerUp:f,onPointerMove:k}=Go({delay:500,onLongPress(V){u(V.clientX,V.clientY)}}),p={onPointerdown:r,onPointerup:f,onPointermove:k};function m(V){if(a.selectionMode){a.toggleMessage(n.message.id);return}u(V.clientX,V.clientY)}function u(V,Q){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:i.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:V,y:Q}}))}function h(){a.selectionMode&&a.toggleMessage(n.message.id)}const c=Se(),w=H(()=>{if(!n.message.forwarded_from_chat_id)return null;const V=n.message.forwarded_from_user_id;if(V&&V===c.user?.id)return null;const Q=n.message.forwarded_from_display_name;return Q?`Forwarded from ${Q}`:"Forwarded"}),O=Ye("stickers",b([])),S=H(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const V=O.value.find(Q=>Q.id===n.message.sticker_id);if(V)return V.url}return""}),_=H(()=>n.message.attachment_url||""),L=b(!1),B=b(0),$=b(0),R=b(n.message.duration_seconds||0);let W=null,Z=null;function I(){return W||(W=new Audio(_.value),W.addEventListener("loadedmetadata",()=>{W&&isFinite(W.duration)&&(R.value=W.duration)}),W.addEventListener("ended",()=>{L.value=!1,B.value=0,$.value=0,g()})),W}function d(){if(W&&L.value){$.value=W.currentTime;const V=W.duration;B.value=V&&isFinite(V)?W.currentTime/V*100:0,Z=requestAnimationFrame(d)}}function g(){Z!==null&&(cancelAnimationFrame(Z),Z=null)}function A(){const V=I();L.value?(V.pause(),L.value=!1,g()):(V.play(),L.value=!0,Z=requestAnimationFrame(d))}function T(V){const Q=I(),q=V.currentTarget.getBoundingClientRect(),z=Math.max(0,Math.min(1,(V.clientX-q.left)/q.width)),X=Q.duration;X&&isFinite(X)&&(Q.currentTime=z*X,$.value=Q.currentTime,B.value=z*100)}const M=H(()=>{const V=R.value;return L.value||$.value>0?ge(Math.floor($.value))+" / "+ge(Math.floor(V)):ge(Math.floor(V))});Le(_,()=>{W&&(W.pause(),L.value=!1,g(),W=null,B.value=0,$.value=0)}),Ue(()=>{W&&(W.pause(),W=null),g()});const U=H(()=>{const V=n.message.reply_to_type;if(V==="sticker")return"ğŸ¨ Sticker";if(V==="voice")return"ğŸ¤ Voice message";if(V==="file")return"ğŸ“ File";const Q=n.message.reply_to_content||"";return Q.length>80?Q.slice(0,80)+"...":Q}),J=H(()=>ws(n.message.content||"",{defaultProtocol:"https",target:"_blank",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(Q,ie,q)=>ie||`<span class="mention" data-u="${q}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${q}'}))">@${q}</span>`));function re(V){if(!V)return"";const Q=new Date(V.endsWith("Z")?V:V+"Z"),ie=new Date;return Q.toDateString()===ie.toDateString()?Q.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):Q.toLocaleDateString([],{month:"short",day:"numeric"})}function ge(V){const Q=Math.floor(V/60),ie=V%60;return`${Q}:${String(ie).padStart(2,"0")}`}function je(V){const Q=V.target.getBoundingClientRect();o("openEmojiPicker",n.message.id,Q.left,Q.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(V=>{o("mentionClick",V.detail)})),(V,Q)=>(v(),y("div",Vs({class:["msg-row",[e.isMine?"mine":"theirs",{selected:l.value}]],"data-message-id":e.message.id,onContextmenu:ae(m,["prevent"])},p,{onClick:h}),[x(a).selectionMode?(v(),y("div",Jo,[t("input",{type:"checkbox",checked:l.value,tabindex:"-1"},null,8,Qo)])):F("",!0),!e.isMine&&e.message.message_type!=="sticker"?(v(),y("div",Yo,[ke(D(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(v(),Y(_s,{key:0})):F("",!0)])):F("",!0),t("div",Xo,[w.value?(v(),y("div",Zo,D(w.value),1)):F("",!0),e.message.reply_to_message_id?(v(),y("div",{key:1,class:"msg-reply-quote",onClick:Q[0]||(Q[0]=ae(ie=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[Q[1]||(Q[1]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",ei,D(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",ti,D(U.value),1)])])):F("",!0),e.message.message_type==="sticker"?(v(),y("div",ni,[t("img",{class:"sticker-img",src:S.value,alt:e.message.sticker_label||"sticker"},null,8,si)])):e.message.message_type==="voice"?(v(),y("div",ai,[t("div",oi,[t("button",{class:"voice-play-btn",onClick:ae(A,["stop"])},D(L.value?"â¸":"â–¶"),1),t("div",{class:"voice-track",onClick:ae(T,["stop"])},[t("div",{class:"voice-progress",style:lt({width:B.value+"%"})},null,4)]),t("span",ii,D(M.value),1)])])):(v(),y("div",{key:4,class:"msg-bubble",innerHTML:J.value},null,8,li)),t("button",{class:"reaction-add-btn",onClick:ae(je,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(v(),y("div",ri,[(v(!0),y(se,null,ve(e.message.reactions,ie=>(v(),y("button",{key:ie.emoji,class:ue(["reaction-chip",{"reaction-mine":ie.me}]),onClick:ae(q=>o("toggleReaction",e.message.id,ie.emoji),["stop"])},[t("span",ui,D(ie.emoji),1),t("span",di,D(ie.count),1)],10,ci))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:ae(je,["stop"])},"+")])):F("",!0)]),t("div",vi,[e.message.is_edited?(v(),y("span",mi,"(edited)")):F("",!0),ke(" "+D(re(e.message.created_at)),1)])],16,Ko))}}),pi={class:"composer-wrapper"},hi={key:0,class:"reply-preview"},gi={class:"reply-preview-content"},yi={class:"reply-preview-sender"},bi={class:"reply-preview-text"},ki={key:1,class:"reply-preview edit-preview"},wi={class:"reply-preview-content"},_i={class:"reply-preview-text"},Ci={class:"composer"},$i=["onKeydown"],Si=ee({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(e,{expose:s,emit:n}){const o=e,a=n,i=b(""),l=b(null),r=b(null),f=b(null);let k=0;function p(){const _=i.value.trim();_&&(f.value?(a("editMessage",f.value.messageId,_),f.value=null):r.value?(a("send",_,{...r.value}),r.value=null):a("send",_),i.value="",S())}function m(){r.value=null,l.value?.focus()}function u(){f.value=null,i.value="",S(),l.value?.focus()}function h(){r.value?m():f.value&&u()}function c(_){const L=_.detail;L&&(f.value=null,r.value={messageId:L.messageId,senderName:L.senderName||"Unknown",snippet:(L.text||"").slice(0,100)},ye(()=>l.value?.focus()))}function w(_){const L=_.detail;L&&(r.value=null,f.value={messageId:L.messageId,snippet:(L.text||"").slice(0,100),fullText:L.text||""},i.value=f.value.fullText,ye(()=>{S(),l.value?.focus()}))}function O(){S();const _=Date.now();_-k>2e3&&i.value.trim().length>0&&(k=_,a("typing"))}function S(){const _=l.value;_&&(_.style.height="auto",_.style.height=Math.min(_.scrollHeight,120)+"px")}return pe(()=>{l.value?.focus(),window.addEventListener("reply-to-message",c),window.addEventListener("edit-message",w)}),Ue(()=>{window.removeEventListener("reply-to-message",c),window.removeEventListener("edit-message",w)}),Le(()=>o.replyTo,_=>{_&&l.value?.focus()}),s({focus:()=>l.value?.focus()}),(_,L)=>(v(),y("div",pi,[r.value?(v(),y("div",hi,[L[3]||(L[3]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",gi,[t("span",yi,D(r.value.senderName),1),t("span",bi,D(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:m},"âœ•")])):F("",!0),f.value?(v(),y("div",ki,[L[5]||(L[5]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",wi,[L[4]||(L[4]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",_i,D(f.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:u},"âœ•")])):F("",!0),t("div",Ci,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:L[0]||(L[0]=B=>a("toggleStickers"))},"ğŸŒ"),ne(t("textarea",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":L[1]||(L[1]=B=>i.value=B),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[rn(ae(p,["exact","prevent"]),["enter"]),rn(h,["escape"])],onInput:O},null,40,$i),[[ce,i.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:L[2]||(L[2]=B=>a("startRecording"))},"ğŸ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:p},"â¤")])]))}}),Mi=de(Si,[["__scopeId","data-v-df4ad9ba"]]),xi={class:"sticker-grid"},Ti=["title","onClick"],Ei=["src","alt"],Li={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Ii=ee({__name:"StickerPicker",emits:["select"],setup(e,{emit:s}){const n=s,o=Ye("stickers",b([])),a=H(()=>o.value);return(i,l)=>(v(),y("div",xi,[(v(!0),y(se,null,ve(a.value,r=>(v(),y("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:f=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,Ei)],8,Ti))),128)),a.value.length===0?(v(),y("div",Li," No stickers available ")):F("",!0)]))}}),Ai={},Di={class:"msgs-loading"};function Ri(e,s){return v(),y("div",Di,"Loading...")}const Jn=de(Ai,[["render",Ri]]),Oi=["onClick"],Pi=ee({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:s}){const n=s,o=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(a,i)=>e.visible?(v(),y("div",{key:0,class:"emoji-picker",style:lt({left:e.x+"px",top:e.y+"px"}),onClick:i[0]||(i[0]=ae(()=>{},["stop"]))},[(v(),y(se,null,ve(o,l=>t("button",{key:l,class:"emoji-pick-btn",onClick:r=>n("select",l)},D(l),9,Oi)),64))],4)):F("",!0)}}),Ni=ee({__name:"MessageContextMenu",setup(e){const{showToast:s}=$e(),n=Se(),o=Kt(),a=b(!1),i=b(0),l=b(0),r=b(null),f=b(null),k=b(""),p=b(""),m=b(""),u=b(null),h=H(()=>!u.value||!n.user?!1:u.value===n.user.id),c=H(()=>!f.value||!r.value?null:`${window.location.origin}/c/${f.value}/${r.value}`),w=H(()=>!f.value||!r.value?!1:o.pinnedByChat[f.value]?.message?.id===r.value);function O(g){r.value=g.detail.messageId,f.value=g.detail.chatId,k.value=g.detail.text||"",p.value=g.detail.messageType||"text",m.value=g.detail.senderName||"",u.value=g.detail.senderId??null,i.value=g.detail.x,l.value=g.detail.y,a.value=!0,requestAnimationFrame(()=>{const A=document.querySelector(".msg-context-menu");if(!A)return;const T=A.getBoundingClientRect();T.right>window.innerWidth&&(i.value=window.innerWidth-T.width-8),T.bottom>window.innerHeight&&(l.value=window.innerHeight-T.height-8)})}function S(){a.value&&(a.value=!1,r.value=null,f.value=null,k.value="",p.value="",m.value="",u.value=null)}pe(()=>{window.addEventListener("show-message-context-menu",O),document.addEventListener("click",S)}),Ue(()=>{window.removeEventListener("show-message-context-menu",O),document.removeEventListener("click",S)});function _(){a.value=!1}function L(){_(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:r.value,chatId:f.value,senderName:m.value,text:k.value}}))}function B(){_(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:r.value,chatId:f.value,text:k.value}}))}async function $(){_();try{await navigator.clipboard.writeText(k.value),s("Copied to clipboard")}catch{s("Failed to copy text")}}async function R(){if(_(),!!c.value)try{await navigator.clipboard.writeText(c.value),s("Link copied")}catch{s("Failed to copy link")}}function W(){_(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[r.value],chatId:f.value}}))}function Z(){_(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:r.value,chatId:f.value}}))}function I(){if(_(),!r.value||!f.value)return;const g=w.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(g,{detail:{messageId:r.value,chatId:f.value}}))}function d(){_(),!(!r.value||!f.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:r.value,chatId:f.value}}))}return(g,A)=>(v(),Y(Yn,{to:"body"},[a.value?(v(),y("div",{key:0,class:"msg-context-menu",style:lt({left:i.value+"px",top:l.value+"px"}),onClick:A[0]||(A[0]=ae(()=>{},["stop"])),onContextmenu:A[1]||(A[1]=ae(()=>{},["prevent"]))},[t("button",{class:"ctx-item",onClick:L}," Reply "),h.value&&p.value==="text"?(v(),y("button",{key:0,class:"ctx-item",onClick:B}," Edit ")):F("",!0),t("button",{class:"ctx-item",onClick:I},D(w.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:$}," Copy text "),c.value?(v(),y("button",{key:1,class:"ctx-item",onClick:R}," Copy link ")):F("",!0),t("button",{class:"ctx-item",onClick:W}," Forward "),t("button",{class:"ctx-item",onClick:Z}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:d}," Delete ")],36)):F("",!0)]))}}),Ui=de(Ni,[["__scopeId","data-v-d52d68d5"]]),Fi={key:0,class:"selection-bar"},Hi={class:"selection-bar-count"},Bi={class:"selection-bar-actions"},ji=["disabled"],zi=["disabled"],Vi=ee({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:s}){const n=s,o=Gt();return(a,i)=>(v(),Y(Xn,{name:"slide-down"},{default:gn(()=>[x(o).selectionMode?(v(),y("div",Fi,[t("button",{class:"selection-bar-btn cancel-btn",onClick:i[0]||(i[0]=l=>x(o).exitSelectionMode())}," Cancel "),t("span",Hi,D(x(o).selectedCount)+" selected",1),t("div",Bi,[t("button",{class:"selection-bar-btn forward-btn",disabled:x(o).selectedCount===0,onClick:i[1]||(i[1]=l=>n("forward"))}," Forward ("+D(x(o).selectedCount)+") ",9,ji),t("button",{class:"selection-bar-btn delete-btn",disabled:x(o).selectedCount===0,onClick:i[2]||(i[2]=l=>n("delete"))}," Delete ("+D(x(o).selectedCount)+") ",9,zi)])])):F("",!0)]),_:1}))}}),Wi=de(Vi,[["__scopeId","data-v-9ba988f2"]]),qi=ee({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const n=s;function o(){n("close")}return(a,i)=>(v(),Y(Yn,{to:"body"},[j(Xn,{name:"bottom-sheet"},{default:gn(()=>[e.visible?(v(),y("div",{key:0,class:"bottom-sheet-backdrop",onClick:ae(o,["self"])},[t("div",{class:"bottom-sheet",onClick:i[0]||(i[0]=ae(()=>{},["stop"]))},[i[1]||(i[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),Zn(a.$slots,"default",{},void 0,!0)])])):F("",!0)]),_:3})]))}}),Gi=de(qi,[["__scopeId","data-v-2c2a0a15"]]),Ki={class:"modal"},Ji={class:"modal-header"},Qi={class:"modal-body"},Yi={class:"forward-chat-list"},Xi={key:0,class:"empty-state-small"},Zi=["onClick"],el={class:"forward-chat-info"},tl={class:"forward-chat-name"},nl={class:"forward-chat-type"},sl={key:0,class:"forward-check"},al={class:"modal-actions"},ol=["disabled"],il=ee({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:s}){const n=e,o=s,a=Ce(),i=Kt(),{showToast:l}=$e(),r=b(""),f=b(null),k=b(!1),p=H(()=>{const w=r.value.toLowerCase().trim(),O=a.sortedChats;return w?O.filter(S=>m(S).toLowerCase().includes(w)):O});function m(w){return w.type==="direct"?w.other_user_id?w.other_display_name||w.other_username||w.title||"Direct Chat":"Saved Messages":w.title||w.name||"Unnamed Chat"}function u(w){if(w.type==="direct")return w.other_avatar_url??void 0}function h(){}async function c(){if(f.value!==null){k.value=!0;try{await i.forwardMessages(f.value,n.fromChatId,n.messageIds),l("Message forwarded!"),o("forwarded",f.value)}catch{l("Failed to forward message")}finally{k.value=!1}}}return(w,O)=>(v(),y("div",{class:"modal-backdrop",onClick:O[2]||(O[2]=ae(S=>o("close"),["self"]))},[t("div",Ki,[t("div",Ji,[O[3]||(O[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:O[0]||(O[0]=S=>o("close"))},"âœ•")]),t("div",Qi,[ne(t("input",{"onUpdate:modelValue":O[1]||(O[1]=S=>r.value=S),class:"search-input",type:"search",placeholder:"Search chats...",onInput:h},null,544),[[ce,r.value]]),t("div",Yi,[p.value.length===0?(v(),y("div",Xi,"No chats found.")):F("",!0),(v(!0),y(se,null,ve(p.value,S=>(v(),y("div",{key:S.id,class:ue(["forward-chat-item",{selected:f.value===S.id}]),onClick:_=>f.value=S.id},[j(he,{name:m(S),url:u(S),size:"sm"},null,8,["name","url"]),t("div",el,[t("div",tl,D(m(S)),1),t("div",nl,D(S.type),1)]),f.value===S.id?(v(),y("span",sl,"âœ“")):F("",!0)],10,Zi))),128))]),t("div",al,[t("button",{class:"btn btn-primary",disabled:f.value===null||k.value,onClick:c},D(k.value?"Forwarding...":"Forward"),9,ol)])])])]))}}),ll=de(il,[["__scopeId","data-v-4e477e89"]]),rl={class:"modal modal-sm"},cl={class:"modal-header"},ul={class:"modal-body"},dl={class:"delete-confirm-text"},vl={key:0,class:"delete-checkbox-label"},ml={class:"modal-actions"},fl=ee({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:s}){const n=s,o=b(!1);function a(){n("confirm",o.value)}return(i,l)=>(v(),y("div",{class:"modal-backdrop",onClick:l[3]||(l[3]=ae(r=>n("close"),["self"]))},[t("div",rl,[t("div",cl,[l[4]||(l[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:l[0]||(l[0]=r=>n("close"))},"âœ•")]),t("div",ul,[t("p",dl," Are you sure you want to delete "+D(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(v(),y("label",vl,[ne(t("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>o.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[es,o.value]]),l[5]||(l[5]=ke(" Delete for everyone ",-1))])):F("",!0)]),t("div",ml,[t("button",{class:"btn btn-ghost",onClick:l[2]||(l[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:a},"Delete")])])]))}}),pl=de(fl,[["__scopeId","data-v-388dbae2"]]),rt=We("channel",()=>{const e=b(null),s=b([]),n=b(!1),o=H(()=>s.value.length),a=H(()=>s.value.filter(m=>m.role==="admin"||m.role==="owner").length),i=H(()=>{const m=Se();return m.user?s.value.find(h=>h.id===m.user.id)?.role??null:null}),l=H(()=>i.value==="owner"),r=H(()=>i.value==="admin"||i.value==="owner");async function f(m){n.value=!0;try{e.value=await ns(m)}catch(u){console.error("Failed to load channel detail",u)}finally{n.value=!1}}async function k(m){try{s.value=await ua(m)}catch(u){console.error("Failed to load channel members",u)}}async function p(m,u){try{e.value=await da(m,u)}catch(h){throw console.error("Failed to update channel",h),h}}return{detail:e,members:s,loading:n,memberCount:o,adminCount:a,myRole:i,isOwner:l,isAdmin:r,loadDetail:f,loadMembers:k,updateChannel:p}}),hl=We("invites",()=>{const e=b([]),s=b(!1);async function n(i){s.value=!0;try{e.value=await Gs(i)}catch(l){console.error("Failed to load invites",l)}finally{s.value=!1}}async function o(i){try{const l=await Ks(i);return e.value.push(l),l}catch(l){throw console.error("Failed to create invite",l),l}}async function a(i){const l=[...e.value];e.value=e.value.filter(r=>r.token!==i);try{await Js(i)}catch(r){throw console.error("Failed to revoke invite",r),e.value=l,r}}return{invites:e,loading:s,loadInvites:n,createInvite:o,revokeInvite:a}}),gl={class:"invite-links-view"},yl={class:"view-header"},bl={style:{padding:"0 1rem .5rem"}},kl=["disabled"],wl={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},_l={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},Cl={key:2,class:"invite-list",style:{padding:"0 1rem"}},$l={class:"invite-item-info"},Sl={class:"invite-token"},Ml={class:"invite-date"},xl={class:"invite-item-actions"},Tl=["onClick"],El=["onClick"],Ll=ee({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,o=s,a=hl(),{showToast:i}=$e(),l=b(!1);function r(m){return new Date(m).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function f(m){const u=`${window.location.origin}/join/${m}`;navigator.clipboard&&navigator.clipboard.writeText(u).then(()=>i("Link copied!"))}async function k(){l.value=!0;try{await a.createInvite(n.chatId),i("Invite link created")}catch{i("Failed to create invite")}finally{l.value=!1}}async function p(m){try{await a.revokeInvite(m),i("Invite revoked")}catch{i("Failed to revoke invite")}}return pe(()=>a.loadInvites(n.chatId)),(m,u)=>(v(),y("div",gl,[t("div",yl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:u[0]||(u[0]=h=>o("back"))},[j(x(Be),{size:20,"stroke-width":2})]),u[1]||(u[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",bl,[t("button",{class:"btn btn-sm btn-outline",onClick:k,disabled:l.value},D(l.value?"Creating...":"Create Invite Link"),9,kl)]),x(a).loading?(v(),y("div",wl," Loading... ")):x(a).invites.length===0?(v(),y("div",_l," No active invite links ")):(v(),y("div",Cl,[(v(!0),y(se,null,ve(x(a).invites,h=>(v(),y("div",{key:h.id,class:"invite-item"},[t("div",$l,[t("code",Sl,D(h.token),1),t("span",Ml,D(r(h.created_at)),1)]),t("div",xl,[t("button",{class:"icon-btn",title:"Copy link",onClick:c=>f(h.token)},[j(x(Na),{size:16,"stroke-width":2})],8,Tl),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:c=>p(h.token)}," Revoke ",8,El)])]))),128))]))]))}}),Il=de(Ll,[["__scopeId","data-v-97b82dd0"]]);async function Al(e,s){await K.post(`/chats/${e}/avatar`,{file_id:s})}async function Dl(e,s){return(await K.post(`/chats/${e}/members/${s}/promote`)).data}async function Rl(e,s){return(await K.post(`/chats/${e}/members/${s}/demote`)).data}const Ol={class:"admins-view"},Pl={class:"view-header"},Nl={class:"search-bar"},Ul={key:0,class:"member-empty"},Fl={key:1,class:"member-list"},Hl=["onClick"],Bl={class:"member-info"},jl={class:"member-name"},zl={class:"role-badge"},Vl={class:"view-footer"},Wl={key:0,class:"member-empty"},ql={key:1,class:"member-list"},Gl={class:"member-info"},Kl={class:"member-name"},Jl=["onClick"],Ql={key:2,class:"view-footer"},Yl=ee({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=e,o=s,a=rt(),i=b(!1),l=b(""),r=H(()=>a.members.filter(u=>u.role==="admin"||u.role==="owner")),f=H(()=>a.members.filter(u=>u.role==="member")),k=H(()=>{const u=l.value.toLowerCase().trim();return u?f.value.filter(h=>h.username.toLowerCase().includes(u)||h.display_name&&h.display_name.toLowerCase().includes(u)):f.value});async function p(u){try{await Dl(n.chatId,u);const h=a.members.find(c=>c.id===u);h&&(h.role="admin"),i.value=!1,l.value=""}catch{}}async function m(u){try{await Rl(n.chatId,u);const h=a.members.find(c=>c.id===u);h&&(h.role="member")}catch{}}return(u,h)=>(v(),y("div",Ol,[t("div",Pl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:h[0]||(h[0]=c=>o("back"))},[j(x(Be),{size:20,"stroke-width":2})]),h[4]||(h[4]=t("span",{class:"view-title"},"Administrators",-1))]),i.value?(v(),y(se,{key:0},[t("div",Nl,[ne(t("input",{"onUpdate:modelValue":h[1]||(h[1]=c=>l.value=c),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ce,l.value]])]),k.value.length===0?(v(),y("div",Ul,D(l.value?"No members found":"No members to promote"),1)):(v(),y("div",Fl,[(v(!0),y(se,null,ve(k.value,c=>(v(),y("div",{key:c.id,class:"member-item member-item--selectable",onClick:w=>p(c.id)},[j(he,{name:c.display_name||c.username,url:c.avatar_url,size:"md"},null,8,["name","url"]),t("div",Bl,[t("span",jl,D(c.display_name||c.username),1),t("span",zl,D(c.role),1)])],8,Hl))),128))])),t("div",Vl,[t("button",{class:"btn btn--secondary",onClick:h[2]||(h[2]=c=>i.value=!1)},"Cancel")])],64)):(v(),y(se,{key:1},[r.value.length===0?(v(),y("div",Wl," No administrators found ")):(v(),y("div",ql,[(v(!0),y(se,null,ve(r.value,c=>(v(),y("div",{key:c.id,class:"member-item"},[j(he,{name:c.display_name||c.username,url:c.avatar_url,size:"md"},null,8,["name","url"]),t("div",Gl,[t("span",Kl,D(c.display_name||c.username),1),t("span",{class:ue(["role-badge",`role-badge--${c.role}`])},D(c.role),3)]),x(a).isOwner&&c.role==="admin"?(v(),y("button",{key:0,class:"btn btn--small btn--danger",onClick:w=>m(c.id)}," Demote ",8,Jl)):F("",!0)]))),128))])),x(a).isOwner?(v(),y("div",Ql,[t("button",{class:"btn btn--primary",onClick:h[3]||(h[3]=c=>i.value=!0)},"Add Admin")])):F("",!0)],64))]))}}),Xl=de(Yl,[["__scopeId","data-v-2bd7c861"]]),Zl={class:"subscribers-view"},er={class:"view-header"},tr={class:"search-bar"},nr={key:0,class:"member-empty"},sr={key:1,class:"member-list"},ar={class:"member-info"},or={class:"member-name"},ir=ee({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:s}){const n=s,o=rt(),a=b(""),i=H(()=>{const l=a.value.toLowerCase().trim();return l?o.members.filter(r=>r.username.toLowerCase().includes(l)||r.display_name&&r.display_name.toLowerCase().includes(l)):o.members});return(l,r)=>(v(),y("div",Zl,[t("div",er,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=f=>n("back"))},[j(x(Be),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",tr,[ne(t("input",{"onUpdate:modelValue":r[1]||(r[1]=f=>a.value=f),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ce,a.value]])]),i.value.length===0?(v(),y("div",nr,D(a.value?"No members found":"No subscribers"),1)):(v(),y("div",sr,[(v(!0),y(se,null,ve(i.value,f=>(v(),y("div",{key:f.id,class:"member-item"},[j(he,{name:f.display_name||f.username,url:f.avatar_url,size:"md"},null,8,["name","url"]),t("div",ar,[t("span",or,D(f.display_name||f.username),1),t("span",{class:ue(["role-badge",`role-badge--${f.role}`])},D(f.role),3)])]))),128))]))]))}}),lr=de(ir,[["__scopeId","data-v-f99a8a5f"]]),rr={class:"modal profile-modal"},cr={class:"profile-modal-body profile-modal-body--scrollable"},ur={class:"profile-avatar-section profile-avatar-upload-section"},dr={class:"profile-avatar-overlay"},vr={class:"profile-info-list"},mr={class:"form-group"},fr={class:"form-label"},pr=["placeholder"],hr={class:"form-group"},gr=["placeholder"],yr={key:0,class:"form-group"},br={class:"form-label"},kr={class:"type-selector"},wr={class:"type-option"},_r={class:"type-option"},Cr={class:"profile-edit-actions"},$r=["disabled"],Sr=ee({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:s}){const n=e,o=s,a=rt(),{showToast:i}=$e(),l=b(""),r=b(""),f=b(void 0),k=b("public"),p=b(!1),m=b(null),u=H(()=>a.detail?.type==="group"),h=H(()=>u.value?"Group":"Channel");pe(()=>{a.detail&&(l.value=a.detail.title||"",r.value=a.detail.description||"",f.value=a.detail.avatar_url??void 0,k.value=a.detail.public_name?"public":"private")});async function c(){const O=m.value?.files?.[0];if(O){try{const S=await kn(O);await Al(n.chatId,S.id),f.value=URL.createObjectURL(O),i("Avatar updated!")}catch{i("Avatar upload failed")}m.value&&(m.value.value="")}}async function w(){if(!l.value.trim()){i(`${h.value} name is required`);return}p.value=!0;try{await a.updateChannel(n.chatId,{title:l.value.trim(),description:r.value.trim()}),i(`${h.value} updated!`),o("saved"),o("close")}catch{i(`Failed to update ${h.value.toLowerCase()}`)}finally{p.value=!1}}return(O,S)=>(v(),y("div",{class:"modal-backdrop profile-backdrop",onClick:S[7]||(S[7]=ae(_=>o("close"),["self"]))},[t("div",rr,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:S[0]||(S[0]=_=>o("close"))},[j(x(Fe),{size:20,"stroke-width":2})]),t("div",cr,[t("div",ur,[t("div",{class:"profile-avatar-upload-wrap",onClick:S[1]||(S[1]=_=>m.value?.click())},[j(he,{name:l.value||h.value,url:f.value,size:"xxl"},null,8,["name","url"]),t("div",dr,[j(x(is),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:m,type:"file",accept:"image/*",class:"hidden",onChange:c},null,544)]),t("div",vr,[t("div",mr,[t("label",fr,D(h.value)+" name",1),ne(t("input",{"onUpdate:modelValue":S[2]||(S[2]=_=>l.value=_),class:"form-input",type:"text",maxlength:"128",placeholder:`${h.value} name`},null,8,pr),[[ce,l.value]])]),t("div",hr,[S[8]||(S[8]=t("label",{class:"form-label"},"Description",-1)),ne(t("textarea",{"onUpdate:modelValue":S[3]||(S[3]=_=>r.value=_),class:"form-input",maxlength:"500",rows:"4",placeholder:`${h.value} description...`},null,8,gr),[[ce,r.value]])]),x(a).isOwner?(v(),y("div",yr,[t("label",br,D(h.value)+" type",1),t("div",kr,[t("label",wr,[ne(t("input",{"onUpdate:modelValue":S[4]||(S[4]=_=>k.value=_),type:"radio",value:"public",name:"chatType"},null,512),[[Nn,k.value]]),S[9]||(S[9]=t("span",{class:"type-option-label"},"Public",-1)),S[10]||(S[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",_r,[ne(t("input",{"onUpdate:modelValue":S[5]||(S[5]=_=>k.value=_),type:"radio",value:"private",name:"chatType"},null,512),[[Nn,k.value]]),S[11]||(S[11]=t("span",{class:"type-option-label"},"Private",-1)),S[12]||(S[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):F("",!0)]),t("div",Cr,[t("button",{class:"btn btn-primary",disabled:p.value,onClick:w},D(p.value?"Saving...":"Save"),9,$r),t("button",{class:"btn btn-ghost",onClick:S[6]||(S[6]=_=>o("close"))},"Cancel")])])])]))}}),Mr=de(Sr,[["__scopeId","data-v-6ec12915"]]),xr={class:"danger-zone"},Tr={class:"view-header"},Er={class:"danger-zone-body"},Lr={class:"modal modal-sm"},Ir={class:"modal-header"},Ar={class:"modal-actions"},Dr=["disabled"],Rr=ee({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:s}){const n=e,o=s,a=Ce(),i=rt(),{showToast:l}=$e(),r=b(!1),f=b(!1);async function k(){try{await a.leave(n.chatId),o("left")}catch{l("Failed to leave channel")}}async function p(){f.value=!0;try{await ss(n.chatId),a.chats=a.chats.filter(m=>m.id!==n.chatId),a.activeChatId===n.chatId&&a.setActiveChat(null),r.value=!1,o("deleted")}catch{l("Failed to delete channel")}finally{f.value=!1}}return(m,u)=>(v(),y("div",xr,[t("div",Tr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:u[0]||(u[0]=h=>o("back"))},[j(x(Be),{size:20,"stroke-width":2})]),u[5]||(u[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",Er,[t("button",{class:"btn btn-danger-outline",onClick:k},[j(x(yn),{size:18,"stroke-width":1.8}),u[6]||(u[6]=ke(" Leave Channel ",-1))]),x(i).isOwner?(v(),y("button",{key:0,class:"btn btn-danger",onClick:u[1]||(u[1]=h=>r.value=!0)},[j(x(rs),{size:18,"stroke-width":1.8}),u[7]||(u[7]=ke(" Delete Channel ",-1))])):F("",!0)]),r.value?(v(),y("div",{key:0,class:"modal-backdrop",onClick:u[4]||(u[4]=ae(h=>r.value=!1,["self"]))},[t("div",Lr,[t("div",Ir,[u[8]||(u[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:u[2]||(u[2]=h=>r.value=!1)},[j(x(Fe),{size:20,"stroke-width":2})])]),u[9]||(u[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",Ar,[t("button",{class:"btn btn-ghost",onClick:u[3]||(u[3]=h=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:f.value,onClick:p},D(f.value?"Deleting...":"Delete"),9,Dr)])])])):F("",!0)]))}}),Or=de(Rr,[["__scopeId","data-v-997b5e56"]]),Pr={class:"modal profile-modal"},Nr={class:"profile-modal-body"},Ur={key:5,class:"profile-loading"},Fr={class:"profile-avatar-section"},Hr={class:"profile-name"},Br={class:"profile-status"},jr={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},zr={class:"profile-info-item"},Vr={class:"profile-info-value"},Wr={class:"channel-info-menu"},qr={class:"channel-info-menu-count"},Gr={class:"channel-info-menu-count"},Kr={key:7,class:"profile-loading"},Jr=ee({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:s}){const n=e,o=s,a=rt(),i=b("main"),l=H(()=>Number(n.chatId)),r=H(()=>a.detail?.type==="group");function f(){i.value="main",a.loadDetail(l.value)}return pe(async()=>{await Promise.all([a.loadDetail(l.value),a.loadMembers(l.value)])}),(k,p)=>(v(),y("div",{class:"modal-backdrop profile-backdrop",onClick:p[14]||(p[14]=ae(m=>o("close"),["self"]))},[t("div",Pr,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:p[0]||(p[0]=m=>o("close"))},[j(x(Fe),{size:20,"stroke-width":2})]),t("div",Nr,[i.value==="invites"?(v(),Y(Il,{key:0,"chat-id":l.value,onBack:p[1]||(p[1]=m=>i.value="main")},null,8,["chat-id"])):i.value==="admins"?(v(),Y(Xl,{key:1,"chat-id":l.value,onBack:p[2]||(p[2]=m=>i.value="main")},null,8,["chat-id"])):i.value==="subscribers"?(v(),Y(lr,{key:2,"chat-id":l.value,onBack:p[3]||(p[3]=m=>i.value="main")},null,8,["chat-id"])):i.value==="edit"?(v(),Y(Mr,{key:3,"chat-id":l.value,onClose:p[4]||(p[4]=m=>i.value="main"),onSaved:f},null,8,["chat-id"])):i.value==="danger"?(v(),Y(Or,{key:4,"chat-id":l.value,onBack:p[5]||(p[5]=m=>i.value="main"),onLeft:p[6]||(p[6]=m=>o("close")),onDeleted:p[7]||(p[7]=m=>o("close"))},null,8,["chat-id"])):x(a).loading?(v(),y("div",Ur,[...p[15]||(p[15]=[t("p",null,"Loading...",-1)])])):x(a).detail?(v(),y(se,{key:6},[t("div",Fr,[j(he,{name:x(a).detail.title||"Channel",url:x(a).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",Hr,D(x(a).detail.title),1),t("div",Br,D(x(a).memberCount)+" "+D(r.value?x(a).memberCount===1?"member":"members":x(a).memberCount===1?"subscriber":"subscribers"),1),x(a).detail.description?(v(),y("div",jr,[t("div",zr,[p[16]||(p[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",Vr,D(x(a).detail.description),1)])])):F("",!0),p[19]||(p[19]=t("div",{class:"profile-divider"},null,-1)),t("div",Wr,[t("button",{class:"channel-info-menu-item",onClick:p[8]||(p[8]=m=>i.value="invites")},[j(x(Ha),{size:20,"stroke-width":1.8}),p[17]||(p[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:p[9]||(p[9]=m=>i.value="admins")},[j(x(qa),{size:20,"stroke-width":1.8}),p[18]||(p[18]=t("span",null,"Administrators",-1)),t("span",qr,D(x(a).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:p[10]||(p[10]=m=>i.value="subscribers")},[j(x(bn),{size:20,"stroke-width":1.8}),t("span",null,D(r.value?"Members":"Subscribers"),1),t("span",Gr,D(x(a).memberCount),1)]),x(a).isOwner||x(a).isAdmin?(v(),y("button",{key:0,class:"channel-info-menu-item",onClick:p[11]||(p[11]=m=>i.value="edit")},[j(x(Va),{size:20,"stroke-width":1.8}),t("span",null,D(r.value?"Edit Group":"Edit Channel"),1)])):F("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[12]||(p[12]=m=>i.value="danger")},[j(x(yn),{size:20,"stroke-width":1.8}),t("span",null,D(r.value?"Leave Group":"Leave Channel"),1)]),x(a).isOwner?(v(),y("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:p[13]||(p[13]=m=>i.value="danger")},[j(x(rs),{size:20,"stroke-width":1.8}),t("span",null,D(r.value?"Delete Group":"Delete Channel"),1)])):F("",!0)])],64)):(v(),y("div",Kr,[...p[20]||(p[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),Qr=de(Jr,[["__scopeId","data-v-d1526322"]]),Yr={class:"search-bar"},Xr={class:"search-bar-header"},Zr={key:0,class:"search-loading"},ec={key:1,class:"search-empty"},tc=["onClick"],nc={class:"search-result-sender"},sc=["innerHTML"],ac={class:"search-result-date"},oc={key:0,class:"search-loading"},ic=ee({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:s}){const n=e,o=s,a=b(null),i=b(null),l=b(""),r=b([]),f=b(!1),k=b(!1),p=b(!0);let m=null;pe(()=>{ye(()=>a.value?.focus())}),Le(l,_=>{if(m&&clearTimeout(m),!_.trim()){r.value=[],k.value=!1,p.value=!0;return}m=setTimeout(()=>u(_.trim()),300)});async function u(_){f.value=!0,k.value=!0,p.value=!0;try{const L=await Un(n.chatId,_,{limit:20});r.value=L,L.length<20&&(p.value=!1)}catch{r.value=[]}finally{f.value=!1}}async function h(){if(f.value||!p.value||r.value.length===0)return;const _=Math.min(...r.value.map(L=>L.id));f.value=!0;try{const L=await Un(n.chatId,l.value.trim(),{limit:20,before_id:_});L.length<20&&(p.value=!1),r.value=[...r.value,...L]}catch{}finally{f.value=!1}}function c(){if(!i.value)return;const _=i.value;_.scrollTop+_.clientHeight>=_.scrollHeight-40&&h()}function w(_,L){if(!L)return O(_);const B=O(_),$=O(L),R=new RegExp($.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return B.replace(R,"<mark>$&</mark>")}function O(_){return _.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function S(_){if(!_)return"";const L=new Date(_.endsWith("Z")?_:_+"Z"),B=new Date;return L.toDateString()===B.toDateString()?L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):L.toLocaleDateString([],{month:"short",day:"numeric"})+" "+L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return(_,L)=>(v(),y("div",Yr,[t("div",Xr,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:L[0]||(L[0]=B=>o("close"))},"â†"),ne(t("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":L[1]||(L[1]=B=>l.value=B),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:L[2]||(L[2]=rn(B=>o("close"),["escape"]))},null,544),[[ce,l.value]]),l.value?(v(),y("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:L[3]||(L[3]=B=>l.value="")},"âœ•")):F("",!0)]),f.value&&r.value.length===0?(v(),y("div",Zr,"Searching...")):k.value&&r.value.length===0&&!f.value?(v(),y("div",ec,"No messages found")):r.value.length>0?(v(),y("div",{key:2,ref_key:"resultsRef",ref:i,class:"search-results",onScroll:c},[(v(!0),y(se,null,ve(r.value,B=>(v(),y("div",{key:B.id,class:"search-result-item",onClick:$=>o("jumpToMessage",B.id)},[t("div",nc,D(B.sender_display_name||B.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:w(B.content||"",l.value)},null,8,sc),t("div",ac,D(S(B.created_at)),1)],8,tc))),128)),f.value?(v(),y("div",oc,"Loading more...")):F("",!0)],544)):F("",!0)]))}}),lc={class:"chat-panel"},rc={key:0,class:"empty-chat"},cc={key:1,class:"chat-view"},uc={key:2,class:"channel-readonly-bar"},dc={key:0,class:"date-sep"},vc={key:4,class:"sticker-picker"},mc={key:6,class:"recording-bar"},fc={class:"rec-time"},pc=ee({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:s}){const n=s,o=Se(),a=Ce(),i=Kt(),{showToast:l}=$e(),r=bo(),f=Ye("stickers",b([])),k=Ye("sendTyping",()=>{}),p=Ye("pendingScrollMessageId",b(null)),m=b(null),u=b(null),h=b(!1);let c=null;const w=b(!1),O=b(!1),S=b("member"),_=b(!1),L=b(!1),B=b(!0),$=b(0);let R=null;function W(){if(!m.value)return!0;const N=m.value;return N.scrollTop+N.clientHeight>=N.scrollHeight-100}function Z(){R||(R=setTimeout(()=>{R=null,B.value=W(),B.value&&($.value=0)},100))}function I(){qe(),$.value=0,B.value=!0}const d=b(!1),g=b(0),A=b(0),T=b(null),M=Gt(),U=b(!1),J=b(null),re=b(""),ge=H(()=>!J.value||!o.user?!1:ze.value.find(C=>C.id===J.value)?.sender_id===o.user.id),je=H(()=>ge.value?ze.value.find(C=>C.id===J.value)?.message_type==="text":!1),V=H(()=>!J.value||!a.activeChatId?!1:i.pinnedByChat[a.activeChatId]?.message?.id===J.value),Q=H(()=>!a.activeChatId||i.pinnedDismissed.has(a.activeChatId)?null:i.pinnedByChat[a.activeChatId]||null),ie=b(!1),q=b([]),z=b(!1),X=b([]),fe=b(!1),Me=b(null);let ct=null;const Tn=H(()=>a.activeChat?.type==="channel"&&S.value==="member"),ze=H(()=>a.activeChatId?i.getMessages(a.activeChatId):[]),Cs=H(()=>{const N=[];let C="";for(const P of ze.value){const te=$s(P.created_at);te!==C&&(N.push({type:"date",label:te}),C=te),N.push({type:"msg",msg:P})}return N});function $s(N){if(!N)return"";const C=new Date(N.endsWith("Z")?N:N+"Z"),P=new Date;if(C.toDateString()===P.toDateString())return"Today";const te=new Date(P);return te.setDate(P.getDate()-1),C.toDateString()===te.toDateString()?"Yesterday":C.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Ss(){Qt(),!(!u.value||!m.value)&&(c=new IntersectionObserver(async N=>{if(!N[0]?.isIntersecting)return;const P=a.activeChatId;if(!P||h.value||i.loadingChat===P)return;h.value=!0;const te=m.value,xe=te?te.scrollHeight:0;try{if((await i.loadOlder(P)).length>0&&te){await ye();const Ge=te.scrollHeight;te.scrollTop+=Ge-xe}}finally{h.value=!1}},{root:m.value,threshold:0}),c.observe(u.value))}function Qt(){c&&(c.disconnect(),c=null)}Le(()=>a.activeChatId,async N=>{if(w.value=!1,S.value="member",$.value=0,B.value=!0,Qt(),ct&&(clearInterval(ct),ct=null),!N)return;await Promise.all([i.loadMessages(N),i.loadPinnedMessage(N)]),await ye(),qe(),await ye(),Ss();const C=a.activeChat;if(C&&(C.type==="channel"||C.type==="group"))try{const P=await ns(N);S.value=P.my_role||"member"}catch{}ct=setInterval(()=>{a.activeChatId===N&&i.loadNewer(N).then(P=>{P.length>0&&Ms(P.length)})},2500)});function qe(){m.value&&(m.value.scrollTop=m.value.scrollHeight)}function Ms(N=1){if(!m.value)return;const C=m.value;C.scrollHeight-C.scrollTop-C.clientHeight<100?ye(()=>{C.scrollTop=C.scrollHeight}):$.value+=N}function xs(){a.activeChatId&&k(a.activeChatId)}async function Ts(N,C){if(!(!a.activeChatId||!N.trim())){Me.value=null;try{const P=C?{reply_to_message_id:C.messageId}:void 0,te=await i.sendMessage(a.activeChatId,N.trim(),"text",P);o.user&&(te.sender_id=o.user.id,te.sender_username=o.user.username,te.sender_display_name=o.user.display_name),await ye(),qe(),a.loadChats()}catch{l("Failed to send message")}}}async function Es(N,C){if(!(!a.activeChatId||!C.trim()))try{await i.editMessage(a.activeChatId,N,C.trim())}catch{l("Failed to edit message")}}async function Ls(N){if(a.activeChatId){w.value=!1;try{const C=await i.sendMessage(a.activeChatId,"","sticker",{sticker_id:N}),P=f.value.find(te=>te.id===N);P&&(C.sticker_url=P.url,C.sticker_label=P.label),await ye(),qe(),a.loadChats()}catch{l("Failed to send sticker")}}}function Is(N,C,P){T.value=N,g.value=C,A.value=P,d.value=!0}function As(N){T.value&&a.activeChatId&&i.toggleReaction(a.activeChatId,T.value,N),d.value=!1,T.value=null}function Ds(N,C){a.activeChatId&&i.toggleReaction(a.activeChatId,N,C)}function Rs(){d.value=!1,T.value=null}async function Os(){try{await r.startRecording(),O.value=!0}catch{O.value=!1,l("Microphone access denied")}}async function Ps(){try{const N=await r.stopRecording();O.value=!1,await js(N)}catch{O.value=!1}}function Ns(){r.cancelRecording(),O.value=!1}function En(N){const{messageIds:C}=N.detail;q.value=C,ie.value=!0}function Ln(N){const{messageId:C,chatId:P}=N.detail;P&&M.enterSelectionMode(P,C)}async function In(N,C){try{await i.pinMsg(N,C)}catch{l("Failed to pin message")}}async function An(N,C){try{await i.unpinMsg(N,C)}catch{l("Failed to unpin message")}}function Dn(N){const{messageId:C,chatId:P}=N.detail;C&&P&&In(P,C)}function Rn(N){const{messageId:C,chatId:P}=N.detail;C&&P&&An(P,C)}function Yt(N){const{messageId:C,chatId:P}=N.detail;if(!C||!P)return;X.value=[C];const te=ze.value.find(xe=>xe.id===C);fe.value=!!(te&&te.sender_id===o.user?.id),z.value=!0}function Us(){q.value=[...M.selectedMessageIds],ie.value=!0}function Fs(){X.value=[...M.selectedMessageIds],fe.value=X.value.every(N=>{const C=ze.value.find(P=>P.id===N);return C&&C.sender_id===o.user?.id}),z.value=!0}function On(){ie.value=!1,q.value=[],M.exitSelectionMode()}async function Hs(N){z.value=!1;const C=a.activeChatId;if(C){for(const P of X.value)try{await i.deleteMessage(C,P)}catch{l("Failed to delete message")}X.value=[],M.exitSelectionMode()}}function Re(N){U.value=!1;const C=J.value,P=a.activeChatId;if(!(!C||!P))switch(N){case"reply":{const te=ze.value.find(xe=>xe.id===C);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:C,senderName:te?.sender_display_name||te?.sender_username||"Unknown",text:te?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:C,chatId:P,text:re.value}}));break}case"copy":navigator.clipboard.writeText(re.value).then(()=>l("Copied to clipboard"),()=>l("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${P}/${C}`).then(()=>l("Link copied"),()=>l("Failed to copy link"));break;case"forward":q.value=[C],ie.value=!0;break;case"select":M.enterSelectionMode(P,C);break;case"delete":Yt(new CustomEvent("",{detail:{messageId:C,chatId:P}}));break;case"pin":In(P,C);break;case"unpin":An(P,C);break}}async function ut(N){if(!m.value)return;const C=a.activeChatId;if(!C)return;let P=m.value.querySelector(`[data-message-id="${N}"]`);if(!P)try{const te=Math.max(0,N-25),xe=await pt(C,{after_id:te,limit:50});if(!xe.find(Ge=>Ge.id===N)){l("Message not found");return}i.messagesByChat[C]=xe,xe.length>0&&(i.lastMsgId[C]=Math.max(...xe.map(Ge=>Ge.id))),await ye(),P=m.value?.querySelector(`[data-message-id="${N}"]`)}catch{l("Message not found");return}P&&(P.scrollIntoView({behavior:"smooth",block:"center"}),P.classList.add("highlight-message"),setTimeout(()=>P.classList.remove("highlight-message"),2e3))}function Bs(N){L.value=!1,ut(N)}function Pn(N){if(N.key==="Escape"){if(L.value){L.value=!1,N.stopPropagation();return}_.value&&(_.value=!1,N.stopPropagation())}}pe(()=>{window.addEventListener("forward-messages",En),window.addEventListener("select-message",Ln),window.addEventListener("delete-message",Yt),window.addEventListener("pin-message",Dn),window.addEventListener("unpin-message",Rn),document.addEventListener("keydown",Pn)}),Ue(()=>{Qt(),window.removeEventListener("forward-messages",En),window.removeEventListener("select-message",Ln),window.removeEventListener("delete-message",Yt),window.removeEventListener("pin-message",Dn),window.removeEventListener("unpin-message",Rn),document.removeEventListener("keydown",Pn)}),Le(()=>p.value,async N=>{N&&(await ye(),setTimeout(()=>{ut(N),p.value=null},300))}),Le(()=>a.activeChatId,()=>{M.exitSelectionMode(),Me.value=null,L.value=!1});async function js(N){if(a.activeChatId)try{const C=await kn(N);await i.sendMessage(a.activeChatId,"","voice",{file_id:C.id,duration_seconds:r.seconds.value}),await i.loadMessages(a.activeChatId),await ye(),qe(),a.loadChats()}catch{l("Failed to upload voice message")}}return(N,C)=>(v(),y("main",lc,[x(a).activeChatId?(v(),y("div",cc,[j(Wi,{onForward:Us,onDelete:Fs}),L.value&&x(a).activeChatId?(v(),Y(ic,{key:0,"chat-id":x(a).activeChatId,onClose:C[0]||(C[0]=P=>L.value=!1),onJumpToMessage:Bs},null,8,["chat-id"])):F("",!0),ne(j(Mo,{onBack:C[1]||(C[1]=P=>n("back")),onOpenUserProfile:C[2]||(C[2]=P=>n("openUserProfile",P)),onOpenChannelInfo:C[3]||(C[3]=P=>_.value=!0),onOpenSearch:C[4]||(C[4]=P=>L.value=!0)},null,512),[[gt,!x(M).selectionMode&&!L.value]]),Q.value&&!x(M).selectionMode?(v(),Y(Co,{key:1,message:Q.value.message,onClick:C[5]||(C[5]=P=>ut(Q.value.message.id)),onDismiss:C[6]||(C[6]=P=>x(i).dismissPin(x(a).activeChatId))},null,8,["message"])):F("",!0),Tn.value?(v(),y("div",uc,[...C[22]||(C[22]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):F("",!0),$.value>0?(v(),y("button",{key:3,class:"new-messages-pill",onClick:I},D($.value)+" new message"+D($.value>1?"s":"")+" â†“ ",1)):F("",!0),t("div",{ref_key:"msgListRef",ref:m,class:"msg-list",onClick:Rs,onScroll:Z},[x(i).loadingChat===x(a).activeChatId?(v(),Y(Jn,{key:0})):(v(),y(se,{key:1},[t("div",{ref_key:"olderSentinelRef",ref:u,class:"older-sentinel"},[h.value?(v(),Y(Jn,{key:0})):F("",!0)],512),(v(!0),y(se,null,ve(Cs.value,P=>(v(),y(se,{key:P.type==="date"?"date-"+P.label:"msg-"+P.msg.id},[P.type==="date"?(v(),y("div",dc,[t("span",null,D(P.label),1)])):(v(),Y(fi,{key:1,message:P.msg,"is-mine":P.msg.sender_id===x(o).user?.id,onMentionClick:C[7]||(C[7]=te=>n("openUserProfile",te)),onOpenEmojiPicker:Is,onToggleReaction:Ds,onReplyClick:ut},null,8,["message","is-mine"]))],64))),128))],64))],544),j(Pi,{visible:d.value,x:g.value,y:A.value,onSelect:As,onClose:C[8]||(C[8]=P=>d.value=!1)},null,8,["visible","x","y"]),w.value?(v(),y("div",vc,[j(Ii,{onSelect:Ls})])):F("",!0),Tn.value?F("",!0):ne((v(),Y(Mi,{key:5,"sticker-picker-open":w.value,"reply-to":Me.value,onSend:Ts,onEditMessage:Es,onToggleStickers:C[9]||(C[9]=P=>w.value=!w.value),onStartRecording:Os,onTyping:xs},null,8,["sticker-picker-open","reply-to"])),[[gt,!O.value]]),O.value?(v(),y("div",mc,[C[23]||(C[23]=t("span",{class:"rec-dot"},null,-1)),t("span",fc,D(x(r).formatTime(x(r).seconds.value)),1),C[24]||(C[24]=t("span",{class:"rec-label"},"Recording...",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:Ns},"âœ•"),t("button",{class:"icon-btn rec-send",title:"Send",onClick:Ps},"â¤")])):F("",!0),j(Ui),j(Gi,{visible:U.value,onClose:C[18]||(C[18]=P=>U.value=!1)},{default:gn(()=>[t("button",{class:"ctx-item",onClick:C[10]||(C[10]=P=>Re("reply"))},"Reply"),je.value?(v(),y("button",{key:0,class:"ctx-item",onClick:C[11]||(C[11]=P=>Re("edit"))},"Edit")):F("",!0),t("button",{class:"ctx-item",onClick:C[12]||(C[12]=P=>Re(V.value?"unpin":"pin"))},D(V.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:C[13]||(C[13]=P=>Re("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:C[14]||(C[14]=P=>Re("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:C[15]||(C[15]=P=>Re("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:C[16]||(C[16]=P=>Re("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:C[17]||(C[17]=P=>Re("delete"))},"Delete")]),_:1},8,["visible"]),ie.value?(v(),Y(ll,{key:7,"message-ids":q.value,"from-chat-id":x(a).activeChatId,onClose:On,onForwarded:On},null,8,["message-ids","from-chat-id"])):F("",!0),z.value?(v(),Y(pl,{key:8,"message-count":X.value.length,"can-delete-for-everyone":fe.value,onClose:C[19]||(C[19]=P=>z.value=!1),onConfirm:Hs},null,8,["message-count","can-delete-for-everyone"])):F("",!0),_.value?(v(),Y(Qr,{key:9,"chat-id":String(x(a).activeChatId),onClose:C[20]||(C[20]=P=>_.value=!1)},null,8,["chat-id"])):F("",!0)])):(v(),y("div",rc,[...C[21]||(C[21]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),hc=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Favorites",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function gc(e){return hc.filter(s=>s.visible(e))}const yc=["disabled"],bc={class:"menu-item__label"},kc={key:1,class:"menu-item__badge"},wc=ee({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:s}){const n=s;return(o,a)=>(v(),y("button",{class:ue(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:a[0]||(a[0]=i=>n("click"))},[e.icon?(v(),Y(yt(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):F("",!0),t("span",bc,D(e.label),1),e.badge?(v(),y("span",kc,D(e.badge),1)):F("",!0),Zn(o.$slots,"right",{},void 0),e.chevron?(v(),Y(yt(x(Pa)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):F("",!0)],10,yc))}}),Qn=de(wc,[["__scopeId","data-v-682bc042"]]),_c={class:"drawer-header"},Cc={class:"drawer-avatar-wrap"},$c={class:"drawer-user-info"},Sc={class:"drawer-display-name"},Mc={class:"drawer-username"},xc={class:"drawer-nav"},Tc={key:0,class:"drawer-divider"},Ec=["onClick"],Lc={class:"menu-item__label"},Ic=["aria-checked"],Ac=ee({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:s}){const n=s,o=ts(),a=Se(),i=qt(),l={user:cs,users:bn,megaphone:ls,bookmark:Ra,settings:Wa,moon:za,download:Ua,"log-out":yn,star:Ka},r=H(()=>({isAuthenticated:!!a.user,isDesktop:!0})),f=H(()=>gc(r.value)),k={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const m=i.theme==="dark"?"light":"dark";i.applyTheme(m),i.saveSettings({theme:m})},openDownload:()=>n("openDownload"),logout:()=>{a.logout(),o.push("/login")}};function p(m){m&&k[m]&&k[m]()}return(m,u)=>(v(),y("div",{class:ue(["drawer",{open:e.open}])},[t("div",_c,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:u[0]||(u[0]=h=>n("close"))},[j(x(Fe),{size:20,"stroke-width":2})]),u[1]||(u[1]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",Cc,[j(he,{name:x(a).user?.display_name||x(a).user?.username||"?",url:x(a).user?.avatar_url,size:"lg"},null,8,["name","url"]),t("div",$c,[t("div",Sc,D(x(a).user?.display_name||x(a).user?.username||"---"),1),t("div",Mc,"@"+D(x(a).user?.username||"---"),1)])]),t("nav",xc,[(v(!0),y(se,null,ve(f.value,h=>(v(),y(se,{key:h.id},[h.separator?(v(),y("div",Tc)):F("",!0),h.rightSlot==="toggle"?(v(),y("div",{key:1,class:"menu-item menu-item--toggle",onClick:c=>p(h.action)},[(v(),Y(yt(l[h.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",Lc,D(h.label),1),t("span",{class:ue(["toggle-switch",{"toggle-switch--on":x(i).theme==="dark"}]),role:"switch","aria-checked":x(i).theme==="dark"},[...u[2]||(u[2]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Ic)],8,Ec)):h.id==="logout"?(v(),Y(Qn,{key:2,icon:l[h.icon],label:h.label,danger:"",onClick:c=>p(h.action)},null,8,["icon","label","onClick"])):(v(),Y(Qn,{key:3,icon:l[h.icon],label:h.label,onClick:c=>p(h.action)},null,8,["icon","label","onClick"]))],64))),128))]),u[3]||(u[3]=t("div",{class:"drawer-footer"},"Simple Messenger v2",-1))],2))}}),Dc=de(Ac,[["__scopeId","data-v-de7cf394"]]),Rc={class:"modal"},Oc={class:"modal-header"},Pc={class:"modal-body"},Nc={key:0,class:"chat-type-cards"},Uc={class:"chat-type-icon"},Fc={class:"chat-type-icon"},Hc={class:"chat-type-icon"},Bc={key:1,class:"new-chat-form"},jc={class:"user-pick-list"},zc={key:0,class:"empty-state-small"},Vc={key:1,class:"empty-state-small"},Wc=["onClick"],qc={class:"user-pick-name"},Gc={class:"user-pick-handle"},Kc={key:2,class:"new-chat-form"},Jc={class:"form-group"},Qc={class:"form-group"},Yc={class:"form-group"},Xc={class:"user-pick-list"},Zc=["onClick"],eu={class:"user-pick-name"},tu={class:"user-pick-handle"},nu={class:"modal-actions"},su=["disabled"],au={key:3,class:"new-chat-form"},ou={class:"form-group"},iu={class:"form-group"},lu={class:"form-group"},ru={class:"modal-actions"},cu=["disabled"],uu=ee({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:s}){const n=e,o=s,a=Se(),{showToast:i}=$e(),l=b(n.initialStep),r=b(!1),f=b(""),k=b([]),p=b(!1);let m=null;const u=b(""),h=b(""),c=b(""),w=b([]),O=b(new Set);let S=null;const _=b(""),L=b(""),B=b("");pe(()=>{$("")});async function $(T){p.value=!0;try{const M=await Fn(T);k.value=M.filter(U=>U.id!==a.user?.id)}catch{k.value=[]}finally{p.value=!1}}function R(){m&&clearTimeout(m),m=setTimeout(()=>$(f.value),300)}async function W(T){try{w.value=await Fn(T)}catch{w.value=[]}}function Z(){S&&clearTimeout(S),S=setTimeout(()=>W(c.value),300)}function I(T){O.value.has(T)?O.value.delete(T):O.value.add(T)}async function d(T){r.value=!0;try{const M=await Xe({type:"direct",member_ids:[T]});o("chatCreated",M.id)}catch{i("Failed to start conversation")}finally{r.value=!1}}async function g(){if(!u.value.trim()){i("Group name is required");return}r.value=!0;try{const T=await Xe({type:"group",title:u.value.trim(),description:h.value.trim(),member_ids:Array.from(O.value)});i("Group created!"),o("chatCreated",T.id)}catch{i("Failed to create group")}finally{r.value=!1}}async function A(){if(!_.value.trim()){i("Channel name is required");return}r.value=!0;try{const T=await Xe({type:"channel",title:_.value.trim(),description:B.value.trim(),public_name:L.value.trim()||void 0,member_ids:[]});i("Channel created!"),o("chatCreated",T.id)}catch{i("Failed to create channel")}finally{r.value=!1}}return(T,M)=>(v(),y("div",{class:"modal-backdrop",onClick:M[14]||(M[14]=ae(U=>o("close"),["self"]))},[t("div",Rc,[t("div",Oc,[M[15]||(M[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:M[0]||(M[0]=U=>o("close"))},[j(x(Fe),{size:20})])]),t("div",Pc,[l.value==="select"?(v(),y("div",Nc,[t("button",{class:"chat-type-card",onClick:M[1]||(M[1]=U=>l.value="direct")},[t("span",Uc,[j(x(cs),{size:24})]),M[16]||(M[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:M[2]||(M[2]=U=>l.value="group")},[t("span",Fc,[j(x(bn),{size:24})]),M[17]||(M[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:M[3]||(M[3]=U=>l.value="channel")},[t("span",Hc,[j(x(ls),{size:24})]),M[18]||(M[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):F("",!0),l.value==="direct"?(v(),y("div",Bc,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[4]||(M[4]=U=>l.value="select")},[j(x(Be),{size:16}),M[19]||(M[19]=ke(" Back ",-1))]),ne(t("input",{"onUpdate:modelValue":M[5]||(M[5]=U=>f.value=U),class:"search-input",type:"search",placeholder:"Search users...",onInput:R},null,544),[[ce,f.value]]),t("div",jc,[p.value?(v(),y("div",zc,"Loading users...")):k.value.length===0?(v(),y("div",Vc,"No users found.")):(v(!0),y(se,{key:2},ve(k.value,U=>(v(),y("div",{key:U.id,class:"user-pick-item",onClick:J=>d(U.id)},[j(he,{name:U.display_name||U.username,url:U.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",qc,D(U.display_name||U.username),1),t("div",Gc,"@"+D(U.username),1)])],8,Wc))),128))])])):F("",!0),l.value==="group"?(v(),y("div",Kc,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[6]||(M[6]=U=>l.value="select")},[j(x(Be),{size:16}),M[20]||(M[20]=ke(" Back ",-1))]),t("div",Jc,[M[21]||(M[21]=t("label",{class:"form-label"},"Group name",-1)),ne(t("input",{"onUpdate:modelValue":M[7]||(M[7]=U=>u.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[ce,u.value]])]),t("div",Qc,[M[22]||(M[22]=t("label",{class:"form-label"},"Description (optional)",-1)),ne(t("textarea",{"onUpdate:modelValue":M[8]||(M[8]=U=>h.value=U),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[ce,h.value]])]),t("div",Yc,[M[23]||(M[23]=t("label",{class:"form-label"},"Add members",-1)),ne(t("input",{"onUpdate:modelValue":M[9]||(M[9]=U=>c.value=U),class:"search-input",type:"search",placeholder:"Search users...",onInput:Z},null,544),[[ce,c.value]]),t("div",Xc,[(v(!0),y(se,null,ve(w.value,U=>(v(),y("div",{key:U.id,class:ue(["user-pick-item",{selected:O.value.has(U.id)}]),onClick:J=>I(U.id)},[j(he,{name:U.display_name||U.username,url:U.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",eu,[O.value.has(U.id)?(v(),Y(x(Oa),{key:0,size:14,style:{"margin-right":"4px"}})):F("",!0),ke(D(U.display_name||U.username),1)]),t("div",tu,"@"+D(U.username),1)])],10,Zc))),128))])]),t("div",nu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:g}," Create Group ",8,su)])])):F("",!0),l.value==="channel"?(v(),y("div",au,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:M[10]||(M[10]=U=>l.value="select")},[j(x(Be),{size:16}),M[24]||(M[24]=ke(" Back ",-1))]),t("div",ou,[M[25]||(M[25]=t("label",{class:"form-label"},"Channel name",-1)),ne(t("input",{"onUpdate:modelValue":M[11]||(M[11]=U=>_.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[ce,_.value]])]),t("div",iu,[M[26]||(M[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),ne(t("input",{"onUpdate:modelValue":M[12]||(M[12]=U=>L.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[ce,L.value]]),M[27]||(M[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",lu,[M[28]||(M[28]=t("label",{class:"form-label"},"Description (optional)",-1)),ne(t("textarea",{"onUpdate:modelValue":M[13]||(M[13]=U=>B.value=U),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[ce,B.value]])]),t("div",ru,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:A}," Create Channel ",8,cu)])])):F("",!0)])])]))}}),du={class:"modal profile-modal profile-modal--self"},vu={class:"profile-tabs"},mu={class:"profile-modal-body profile-modal-body--scrollable"},fu={class:"profile-avatar-section profile-avatar-upload-section"},pu={class:"profile-avatar-overlay"},hu={class:"profile-name"},gu={key:0,class:"profile-status profile-status--online"},yu={class:"profile-info-list"},bu={class:"form-group"},ku={class:"form-group"},wu={key:0,class:"form-hint form-error"},_u={class:"form-group"},Cu={class:"profile-info-item"},$u={class:"profile-info-value"},Su={class:"profile-edit-actions"},Mu={class:"profile-info-list"},xu={class:"form-group form-inline"},Tu={class:"form-group form-inline"},Eu={class:"toggle"},Lu={class:"form-group form-inline"},Iu={class:"form-group form-inline"},Au=ee({__name:"ProfileModal",props:{initialTab:{default:"profile"}},emits:["close"],setup(e,{emit:s}){const n=e,o=s,a=Se(),i=qt(),{showToast:l}=$e(),r=b(n.initialTab),f=b(""),k=b(""),p=b(""),m=b(""),u=b(null),h=b("light"),c=b(!0),w=b("en"),O=b("everyone");Le(c,async B=>{B&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(c.value=!1,l("Notifications blocked by browser"))}),pe(async()=>{a.user&&(f.value=a.user.display_name||"",k.value=a.user.username,p.value=a.user.bio||""),h.value=i.theme,c.value=i.notificationsEnabled,w.value=i.language,O.value=i.lastSeenVisibility});async function S(){const B=u.value?.files?.[0];if(B){try{const $=await kn(B),R=await Ma($.id);a.updateUser({avatar_url:R.avatar_url}),l("Avatar updated!")}catch{l("Upload failed")}u.value&&(u.value.value="")}}async function _(){if(m.value="",!a.user)return;const B={display_name:f.value.trim(),bio:p.value.trim()};k.value.trim()&&k.value.trim()!==a.user.username&&(B.username=k.value.trim());try{const $=await Sa(a.user.id,B);a.updateUser({display_name:$.display_name,username:$.username}),l("Profile saved!"),o("close")}catch($){$.response?.status===409?m.value="Username already taken":l("Save failed")}}async function L(){try{await i.saveSettings({theme:h.value,notifications_enabled:c.value,language:w.value,last_seen_visibility:O.value}),l("Settings saved!"),o("close")}catch{l("Settings save failed")}}return(B,$)=>(v(),y("div",{class:"modal-backdrop profile-backdrop",onClick:$[12]||($[12]=ae(R=>o("close"),["self"]))},[t("div",du,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:$[0]||($[0]=R=>o("close"))},[j(x(Fe),{size:20,"stroke-width":2})]),t("div",vu,[t("button",{class:ue(["profile-tab",{active:r.value==="profile"}]),onClick:$[1]||($[1]=R=>r.value="profile")},"Profile",2),t("button",{class:ue(["profile-tab",{active:r.value==="settings"}]),onClick:$[2]||($[2]=R=>r.value="settings")},"Settings",2)]),t("div",mu,[ne(t("div",null,[t("div",fu,[t("div",{class:"profile-avatar-upload-wrap",onClick:$[3]||($[3]=R=>u.value?.click())},[j(he,{name:f.value||x(a).user?.username||"?",url:x(a).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",pu,[j(x(is),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:u,type:"file",accept:"image/*",class:"hidden",onChange:S},null,544)]),t("div",hu,D(f.value||x(a).user?.username||"?"),1),x(a).user?(v(),y("div",gu," online ")):F("",!0),$[17]||($[17]=t("div",{class:"profile-divider"},null,-1)),t("div",yu,[t("div",bu,[$[13]||($[13]=t("label",{class:"form-label"},"Display name",-1)),ne(t("input",{"onUpdate:modelValue":$[4]||($[4]=R=>f.value=R),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[ce,f.value]])]),t("div",ku,[$[14]||($[14]=t("label",{class:"form-label"},"Username",-1)),ne(t("input",{"onUpdate:modelValue":$[5]||($[5]=R=>k.value=R),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[ce,k.value]]),m.value?(v(),y("small",wu,D(m.value),1)):F("",!0)]),t("div",_u,[$[15]||($[15]=t("label",{class:"form-label"},"Bio",-1)),ne(t("textarea",{"onUpdate:modelValue":$[6]||($[6]=R=>p.value=R),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[ce,p.value]])]),t("div",Cu,[$[16]||($[16]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",$u,D(x(a).user?.id),1)])]),t("div",Su,[t("button",{class:"btn btn-primary",onClick:_},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:$[7]||($[7]=R=>o("close"))},"Cancel")])],512),[[gt,r.value==="profile"]]),ne(t("div",null,[t("div",Mu,[t("div",xu,[$[19]||($[19]=t("label",{class:"form-label"},"Theme",-1)),ne(t("select",{"onUpdate:modelValue":$[8]||($[8]=R=>h.value=R),class:"form-input form-select"},[...$[18]||($[18]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[Xt,h.value]])]),t("div",Tu,[$[21]||($[21]=t("label",{class:"form-label"},"Notifications",-1)),t("label",Eu,[ne(t("input",{"onUpdate:modelValue":$[9]||($[9]=R=>c.value=R),type:"checkbox"},null,512),[[es,c.value]]),$[20]||($[20]=t("span",{class:"toggle-slider"},null,-1))])]),t("div",Lu,[$[23]||($[23]=t("label",{class:"form-label"},"Language",-1)),ne(t("select",{"onUpdate:modelValue":$[10]||($[10]=R=>w.value=R),class:"form-input form-select"},[...$[22]||($[22]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[Xt,w.value]])]),$[26]||($[26]=t("div",{class:"profile-divider"},null,-1)),$[27]||($[27]=t("h4",{class:"form-section-heading"},"Privacy",-1)),t("div",Iu,[$[25]||($[25]=t("label",{class:"form-label"},"Last seen & online",-1)),ne(t("select",{"onUpdate:modelValue":$[11]||($[11]=R=>O.value=R),class:"form-input form-select"},[...$[24]||($[24]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[Xt,O.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:L},"Save Settings")])],512),[[gt,r.value==="settings"]])])])]))}}),Du={class:"profile-actions"},Ru=["disabled","onClick"],Ou={class:"profile-action-btn__circle"},Pu={class:"profile-action-btn__label"},Nu=ee({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:s}){const n=e,o=s,a=H(()=>{const i=[{icon:ja,label:"Message",event:"message"}];return n.showMute!==!1&&i.push({icon:Da,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&i.push({icon:Fa,label:"More",event:"more"}),i});return(i,l)=>(v(),y("div",Du,[(v(!0),y(se,null,ve(a.value,r=>(v(),y("button",{key:r.label,class:ue(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:f=>o(r.event)},[t("span",Ou,[(v(),Y(yt(r.icon),{size:22,"stroke-width":1.8}))]),t("span",Pu,D(r.label),1)],10,Ru))),128))]))}}),Uu=de(Nu,[["__scopeId","data-v-b5376905"]]),Fu={class:"modal profile-modal"},Hu={class:"profile-modal-body"},Bu={key:0,class:"profile-loading"},ju={class:"profile-avatar-section"},zu={class:"profile-name"},Vu={class:"profile-info-list"},Wu={class:"profile-info-item"},qu={class:"profile-info-value"},Gu={key:0,class:"profile-info-item"},Ku={class:"profile-info-value"},Ju={class:"profile-info-item"},Qu={class:"profile-info-value"},Yu={key:2,class:"profile-loading"},Xu=ee({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:s}){const n=e,o=s,a=Ce(),{showToast:i}=$e(),l=b(null),r=b(!0),f=b(!1),k=H(()=>l.value?a.isUserOnline(l.value.id):!1),p=H(()=>{if(k.value)return"online";if(!l.value)return"offline";const u=a.getUserPresence(l.value.id);return u?.lastSeenAt?us(u.lastSeenAt):u?.lastSeenBucket?`last seen ${u.lastSeenBucket}`:"offline"});pe(async()=>{try{l.value=await os(n.username)}catch{l.value=null}finally{r.value=!1}});function m(){f.value=!f.value,i(f.value?"User muted":"User unmuted")}return(u,h)=>(v(),y("div",{class:"modal-backdrop profile-backdrop",onClick:h[2]||(h[2]=ae(c=>o("close"),["self"]))},[t("div",Fu,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:h[0]||(h[0]=c=>o("close"))},[j(x(Fe),{size:20,"stroke-width":2})]),t("div",Hu,[r.value?(v(),y("div",Bu,[...h[3]||(h[3]=[t("p",null,"Loading...",-1)])])):l.value?(v(),y(se,{key:1},[t("div",ju,[j(he,{name:l.value.display_name||l.value.username,url:l.value.avatar_url,online:k.value,size:"xxl"},null,8,["name","url","online"])]),t("div",zu,[ke(D(l.value.display_name||l.value.username)+" ",1),l.value.is_admin?(v(),Y(_s,{key:0})):F("",!0)]),t("div",{class:ue(["profile-status",{"profile-status--online":k.value}])},D(p.value),3),j(Uu,{muted:f.value,"show-more":!1,onMessage:h[1]||(h[1]=c=>o("message",l.value.username)),onMute:m},null,8,["muted"]),h[7]||(h[7]=t("div",{class:"profile-divider"},null,-1)),t("div",Vu,[t("div",Wu,[h[4]||(h[4]=t("div",{class:"profile-info-label"},"Username",-1)),t("div",qu,"@"+D(l.value.username),1)]),l.value.bio?(v(),y("div",Gu,[h[5]||(h[5]=t("div",{class:"profile-info-label"},"Bio",-1)),t("div",Ku,D(l.value.bio),1)])):F("",!0),t("div",Ju,[h[6]||(h[6]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Qu,D(l.value.id),1)])])],64)):(v(),y("div",Yu,[...h[8]||(h[8]=[t("p",null,"User not found",-1)])]))])])]))}}),Zu={class:"modal",style:{"max-width":"420px"}},ed={class:"modal-header"},td={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},nd=ee({__name:"DownloadModal",emits:["close"],setup(e,{emit:s}){const n=s,o=navigator.userAgent.toLowerCase(),a=o.includes("win"),i=o.includes("mac")&&!o.includes("iphone")&&!o.includes("ipad"),l=H(()=>a?"Windows":i?"macOS":null);function r(){a?window.location.href="/downloads/windows/MessengerSetup.exe":i&&(window.location.href="/downloads/macos/Messenger.dmg")}return(f,k)=>(v(),y("div",{class:"modal-backdrop",onClick:k[1]||(k[1]=ae(p=>n("close"),["self"]))},[t("div",Zu,[t("div",ed,[k[2]||(k[2]=t("h2",{class:"modal-title"},"Download Simple Messenger",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:k[0]||(k[0]=p=>n("close"))},[j(x(Fe),{size:20})])]),t("div",td,[l.value?(v(),y("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+D(l.value),1)):F("",!0),k[3]||(k[3]=Ws('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/MessengerSetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/Messenger.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),sd={class:"modal",style:{"max-width":"400px"}},ad={class:"modal-header"},od={class:"modal-body",style:{"text-align":"center"}},id={key:0},ld={style:{"font-size":"1.25rem","font-weight":"700"}},rd={style:{color:"var(--text-muted)","margin-top":".5rem"}},cd={class:"profile-avatar-section"},ud={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},dd={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},vd={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},md={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},fd=["disabled"],pd=ee({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:s}){const n=e,o=s,{showToast:a}=$e(),i=b(null),l=b(!0),r=b(!1),f=b(""),k=b("");pe(async()=>{if(!n.token){f.value="Invalid Link",k.value="No invite token provided.",l.value=!1;return}try{i.value=await Qs(n.token)}catch(m){m.response?.status===410?(f.value="Invite Revoked",k.value="This invite link has been revoked."):(f.value="Invite Not Found",k.value="This invite link is invalid or has expired.")}finally{l.value=!1}});async function p(){r.value=!0;try{const m=await Ys(n.token);a(m.already_member?"You are already a member":"Joined successfully!"),o("joined",m.chat_id)}catch(m){a(m.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(m,u)=>(v(),y("div",{class:"modal-backdrop",onClick:u[2]||(u[2]=ae(h=>o("close"),["self"]))},[t("div",sd,[t("div",ad,[u[3]||(u[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:u[0]||(u[0]=h=>o("close"))},"âœ•")]),t("div",od,[l.value?(v(),y("p",id,"Loading invite preview...")):k.value?(v(),y(se,{key:1},[t("h2",ld,D(f.value),1),t("p",rd,D(k.value),1)],64)):i.value?(v(),y(se,{key:2},[t("div",cd,[j(he,{name:i.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",ud,D(i.value.title||i.value.type||"Chat"),1),i.value.description?(v(),y("p",dd,D(i.value.description),1)):F("",!0),i.value.member_count?(v(),y("p",vd,D(i.value.member_count)+" members ",1)):F("",!0),t("div",md,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:p},D(r.value?"Joining...":"Join"),9,fd),t("button",{class:"btn btn-ghost",onClick:u[1]||(u[1]=h=>o("close"))},"Cancel")])],64)):F("",!0)])])]))}}),hd=ee({__name:"ContextMenu",setup(e){const s=Ce(),{showToast:n}=$e(),o=b(!1),a=b(0),i=b(0),l=b(null),r=H(()=>l.value?s.chats.find(c=>c.id===l.value)??null:null);function f(c){l.value=c.detail.chatId,a.value=c.detail.x,i.value=c.detail.y,o.value=!0}function k(){o.value&&(o.value=!1,l.value=null)}pe(()=>{window.addEventListener("show-context-menu",f),document.addEventListener("click",k)}),Ue(()=>{window.removeEventListener("show-context-menu",f),document.removeEventListener("click",k)});async function p(){if(l.value){o.value=!1;try{await s.toggleFavorite(l.value)}catch{n("Failed to update favorite")}}}async function m(){if(l.value){o.value=!1;try{await s.toggleMute(l.value)}catch{n("Failed to update mute")}}}async function u(){if(l.value&&(o.value=!1,!!confirm("Leave this chat?")))try{await s.leave(l.value),n("Left chat")}catch{n("Failed to leave chat")}}async function h(){if(l.value&&(o.value=!1,!!confirm("Delete this chat? All messages will be permanently removed.")))try{await s.deleteChat(l.value),n("Chat deleted")}catch{n("Failed to delete chat")}}return(c,w)=>o.value?(v(),y("div",{key:0,class:"context-menu",style:lt({left:a.value+"px",top:i.value+"px"})},[t("button",{class:"ctx-item",onClick:p},D(r.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:m},D(r.value?.is_muted?"Unmute":"Mute"),1),r.value&&r.value.type!=="direct"?(v(),y("button",{key:0,class:"ctx-item ctx-leave",onClick:u}," Leave chat ")):F("",!0),t("button",{class:"ctx-item ctx-delete",onClick:h}," Delete chat ")],4)):F("",!0)}}),bd=ee({__name:"MessengerView",setup(e){const s=qs(),n=ts(),o=Se(),a=Ce(),i=qt(),l=Gt(),{showToast:r}=$e(),{connect:f,disconnect:k,sendTyping:p}=$a();ft("sendTyping",p);const m=b(!1),u=b(!1),h=b("select"),c=b(!1),w=b("profile"),O=b(!1),S=b(null),_=b(null),L=b([]),B=b(null);ft("stickers",L),ft("pendingScrollMessageId",B);let $=null;pe(async()=>{await i.loadSettings();try{L.value=await xa()}catch{}await a.loadChats(),f(),$=setInterval(()=>a.loadChats(),5e3),R()}),Ue(()=>{k(),$&&(clearInterval($),$=null)}),Le(()=>s.path,()=>{R()}),Le(()=>a.activeChatId,()=>{l.selectionMode&&l.exitSelectionMode()});async function R(){const q=s.path;if(q.startsWith("/@")){const z=s.params.username;z&&(S.value=z)}else if(q.startsWith("/u/")){const z=s.params.id;if(z)try{const X=await as(parseInt(z));S.value=X.username}catch{r("User not found")}}else if(q.startsWith("/dm/")){const z=s.params.id;z&&await W(z)}else if(q.startsWith("/c/")){const z=s.params.chatIdOrName||s.params.name,X=s.params.messageId?parseInt(s.params.messageId):null;if(z)if(/^\d+$/.test(z)){const Me=parseInt(z);X?await I(Me,X):a.setActiveChat(Me)}else await Z(z)}}async function W(q){try{let z;if(q.startsWith("@")){const fe=q.substring(1);z=(await os(fe)).id}else z=parseInt(q);const X=await Xe({type:"direct",member_ids:[z]});await a.loadChats(),a.setActiveChat(X.id)}catch{r("Failed to open conversation")}}async function Z(q){try{const z=await Zs(q);a.chats.find(fe=>fe.id===z.id)?a.setActiveChat(z.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function I(q,z){if(!a.chats.find(fe=>fe.id===q)){r("Chat not found");return}a.setActiveChat(q),await ye(),B.value=z}function d(q){a.setActiveChat(q),n.replace("/app")}function g(){a.setActiveChat(null)}function A(){m.value=!1,w.value="profile",c.value=!0}function T(){m.value=!1,w.value="settings",c.value=!0}function M(){m.value=!1,h.value="group",u.value=!0}function U(){m.value=!1,h.value="channel",u.value=!0}async function J(){if(m.value=!1,!!o.user)try{const q=await Xe({type:"direct",member_ids:[o.user.id]});await a.loadChats(),a.setActiveChat(q.id)}catch{r("Failed to open Saved Messages")}}function re(q){S.value=q}async function ge(q){S.value=null,await W("@"+q)}async function je(q){u.value=!1,await a.loadChats(),a.setActiveChat(q)}async function V(q){_.value=null,await a.loadChats(),a.setActiveChat(q)}function Q(q){const z=q.target?.closest("a");if(!z)return;const X=z.getAttribute("href");if(!X)return;let fe=null;try{const Me=new URL(X,window.location.origin);Me.origin===window.location.origin&&(fe=Me.pathname.match(/^\/join\/([^/]+)$/))}catch{fe=X.match(/^\/join\/([^/]+)$/)}fe&&(q.preventDefault(),q.stopPropagation(),_.value=fe[1]??null)}function ie(q){if(q.key==="Escape"){if(_.value){_.value=null;return}if(l.selectionMode){l.exitSelectionMode();return}if(S.value){S.value=null;return}if(u.value){u.value=!1;return}if(c.value){c.value=!1;return}if(O.value){O.value=!1;return}if(m.value){m.value=!1;return}if(a.activeChatId!==null){g();return}}}return pe(()=>{document.addEventListener("keydown",ie),document.addEventListener("click",Q,!0)}),Ue(()=>{document.removeEventListener("keydown",ie),document.removeEventListener("click",Q,!0)}),(q,z)=>(v(),y("div",{class:ue(["layout",{"chat-open":!!x(a).activeChatId}])},[j(Dc,{open:m.value,onClose:z[0]||(z[0]=X=>m.value=!1),onOpenProfile:A,onOpenSettings:T,onOpenNewGroup:M,onOpenNewChannel:U,onOpenFavorites:J,onOpenDownload:z[1]||(z[1]=X=>O.value=!0)},null,8,["open"]),t("div",{class:ue(["drawer-overlay",{visible:m.value}]),onClick:z[2]||(z[2]=X=>m.value=!1)},null,2),j(yo,{onOpenDrawer:z[3]||(z[3]=X=>m.value=!0),onOpenNewChat:z[4]||(z[4]=X=>{h.value="select",u.value=!0}),onSelectChat:d}),j(pc,{onBack:g,onOpenUserProfile:re}),u.value?(v(),Y(uu,{key:0,"initial-step":h.value,onClose:z[5]||(z[5]=X=>u.value=!1),onChatCreated:je},null,8,["initial-step"])):F("",!0),c.value?(v(),Y(Au,{key:1,"initial-tab":w.value,onClose:z[6]||(z[6]=X=>c.value=!1)},null,8,["initial-tab"])):F("",!0),S.value?(v(),Y(Xu,{key:2,username:S.value,onClose:z[7]||(z[7]=X=>S.value=null),onMessage:ge},null,8,["username"])):F("",!0),O.value?(v(),Y(nd,{key:3,onClose:z[8]||(z[8]=X=>O.value=!1)})):F("",!0),_.value?(v(),Y(pd,{key:4,token:_.value,onClose:z[9]||(z[9]=X=>_.value=null),onJoined:V},null,8,["token"])):F("",!0),j(hd)],2))}});export{bd as default};
