import{k as G,l as ze,r as g,m as z,n as Fe,u as Oe,p as ln,d as Y,o as d,c as h,a as t,t as A,w as ne,q as Vt,s as le,g as B,b as P,f as he,x as M,e as ee,v as ie,F as te,y as ue,z as Q,A as dt,B as Ee,C as Je,D as js,E as ve,G as rn,H as fe,T as Yn,I as ke,h as gn,J as Xn,K as Zn,L as es,M as Pn,N as pt,O as ht,j as ts,P as Xt,Q as Bs,R as zs}from"./index-K3rxxOgd.js";import{_ as me,l as Vs,c as Ws,r as qs,p as Gs,j as Ks}from"./invites-iW0DilVs.js";async function Js(){const{data:e}=await G.get("/chats");return e}async function ns(e){const{data:a}=await G.get(`/chats/${e}`);return a}async function Qs(e){const{data:a}=await G.get(`/chats/by-name/${encodeURIComponent(e)}`);return a}async function vt(e){const{data:a}=await G.post("/chats",e);return a}async function Ys(e){await G.post(`/chats/${e}/favorite`)}async function Xs(e){await G.delete(`/chats/${e}/favorite`)}async function Zs(e,a){await G.post(`/chats/${e}/mute`,{})}async function ea(e){await G.delete(`/chats/${e}/mute`)}async function ta(e){await G.delete(`/chats/${e}/leave`)}async function na(e){await G.post(`/chats/${e}/read`)}async function sa(e){await G.post(`/chats/${e}/pin`)}async function aa(e){await G.delete(`/chats/${e}/pin`)}async function oa(e){await G.post(`/chats/${e}/archive`)}async function ia(e){await G.delete(`/chats/${e}/archive`)}async function la(e){const{data:a}=await G.get(`/chats/${e}`);return a.members??[]}async function ra(e){await G.delete(`/chats/${e}`)}async function ca(e,a){const{data:n}=await G.patch(`/chats/${e}`,a);return n}const be=ze("chats",()=>{const e=g([]),a=g(null),n=g({}),o=g(new Set),s=g({}),l=z(()=>e.value.find(L=>L.id===a.value)??null),i=z(()=>[...e.value].sort((L,H)=>{if(L.is_pinned&&!H.is_pinned)return-1;if(!L.is_pinned&&H.is_pinned)return 1;if(L.is_favorite&&!H.is_favorite)return-1;if(!L.is_favorite&&H.is_favorite)return 1;const y=L.last_at||L.updated_at||"";return(H.last_at||H.updated_at||"").localeCompare(y)}));async function r(){try{e.value=await Js()}catch(L){console.error("Failed to load chats",L)}}function v(L){if(a.value=L,L!==null){const H=e.value.find(y=>y.id===L);H&&H.unread_count>0&&(H.unread_count=0,na(L).catch(()=>{}))}}async function k(L){const H=e.value.find(y=>y.id===L);if(H)try{H.is_favorite?await Xs(L):await Ys(L),H.is_favorite=!H.is_favorite}catch(y){throw console.error("Failed to toggle favorite",y),y}}async function m(L){const H=e.value.find(y=>y.id===L);if(H)try{H.is_muted?await ea(L):await Zs(L),H.is_muted=!H.is_muted}catch(y){throw console.error("Failed to toggle mute",y),y}}async function u(L){const H=e.value.find(y=>y.id===L);if(H)try{H.is_pinned?await aa(L):await sa(L),H.is_pinned=!H.is_pinned}catch(y){throw console.error("Failed to toggle pin",y),y}}async function c(L){const H=e.value.find(y=>y.id===L);if(H)try{H.is_archived?await ia(L):await oa(L),H.is_archived=!H.is_archived}catch(y){throw console.error("Failed to toggle archive",y),y}}async function p(L){await ta(L),e.value=e.value.filter(H=>H.id!==L),a.value===L&&(a.value=null)}function b(L,H,y){const T=e.value.find(F=>F.id===L);T&&(T.last_message=H,T.last_at=y)}function f(L){const H=e.value.find(y=>y.id===L);H&&(H.unread_count=(H.unread_count||0)+1)}function S(L,H,y){n.value[L]||(n.value[L]={});const T=n.value[L][H];T&&clearTimeout(T.timer);const F=setTimeout(()=>{C(L,H)},3e3);n.value[L][H]={username:y,timer:F}}function C(L,H){if(n.value[L]){const y=n.value[L][H];y&&(clearTimeout(y.timer),delete n.value[L][H])}}function $(L){const H=n.value[L];return H?Object.values(H).map(y=>y.username):[]}function x(L){o.value=new Set([...o.value,L]),s.value={...s.value,[L]:{isOnline:!0}}}function j(L,H,y){const T=new Set(o.value);T.delete(L),o.value=T,s.value={...s.value,[L]:{isOnline:!1,lastSeenAt:H,lastSeenBucket:y}}}function _(L,H){if(H.isOnline)o.value=new Set([...o.value,L]);else{const y=new Set(o.value);y.delete(L),o.value=y}s.value={...s.value,[L]:H}}function O(L){return s.value[L]}function W(L){return o.value.has(L)}return{chats:e,activeChatId:a,activeChat:l,sortedChats:i,typingUsers:n,loadChats:r,setActiveChat:v,toggleFavorite:k,toggleMute:m,togglePin:u,toggleArchive:c,leave:p,updateChatLastMessage:b,incrementUnread:f,setTyping:S,clearTyping:C,getTypingUsernames:$,onlineUsers:o,userPresenceDetails:s,setUserOnline:x,setUserOffline:j,setUserPresence:_,getUserPresence:O,isUserOnline:W}});async function ua(){const{data:e}=await G.get("/settings");return e}async function da(e){await G.put("/settings",e)}const Wt=ze("settings",()=>{const e=g(localStorage.getItem("theme")||"light"),a=g(!0),n=g("en"),o=g("everyone");function s(r){e.value=r,document.body.setAttribute("data-theme",r),localStorage.setItem("theme",r)}async function l(){try{const r=await ua();s(r.theme||"light"),a.value=r.notifications_enabled,n.value=r.language||"en",o.value=r.last_seen_visibility||"everyone"}catch(r){console.error("Failed to load settings",r)}}async function i(r){await da(r),r.theme&&s(r.theme),r.notifications_enabled!==void 0&&(a.value=r.notifications_enabled),r.language&&(n.value=r.language),r.last_seen_visibility&&(o.value=r.last_seen_visibility)}return document.body.setAttribute("data-theme",e.value),{theme:e,notificationsEnabled:a,language:n,lastSeenVisibility:o,applyTheme:s,loadSettings:l,saveSettings:i}}),qt=ze("selection",()=>{const e=g(new Set),a=g(!1),n=g(null),o=z(()=>e.value.size);function s(k,m){a.value=!0,n.value=k,e.value=new Set(m!=null?[m]:[])}function l(){a.value=!1,n.value=null,e.value=new Set}function i(k){const m=new Set(e.value);m.has(k)?m.delete(k):m.add(k),e.value=m,m.size===0&&l()}function r(){e.value=new Set}function v(k){return e.value.has(k)}return{selectedMessageIds:e,selectionMode:a,currentChatId:n,selectedCount:o,enterSelectionMode:s,exitSelectionMode:l,toggleMessage:i,clearSelection:r,isSelected:v}});async function mt(e,a){const{data:n}=await G.get(`/chats/${e}/messages`,{params:a});return n}async function va(e,a){const{data:n}=await G.post(`/chats/${e}/messages`,a);return n}async function ma(e,a){await G.delete(`/chats/${e}/messages/${a}`)}async function fa(e,a,n){const{data:o}=await G.put(`/chats/${e}/messages/${a}`,{content:n});return o}async function pa(e,a){const{data:n}=await G.post(`/chats/${e}/messages/forward`,a);return n}async function ha(e,a){const{data:n}=await G.post(`/chats/${e}/messages/${a}/pin`);return n}async function ga(e,a){await G.delete(`/chats/${e}/messages/${a}/pin`)}async function ya(e){const{data:a}=await G.get(`/chats/${e}/pinned-message`);return a}async function Un(e,a,n){const{data:o}=await G.get(`/chats/${e}/messages/search`,{params:{q:a,...n}});return o}async function ba(e,a,n){const{data:o}=await G.post(`/chats/${e}/messages/${a}/reactions`,{emoji:n});return o}async function ka(e,a){if(!a.length)return{};const{data:n}=await G.get(`/chats/${e}/reactions`,{params:{message_ids:a.join(",")}});return n}const Gt=ze("messages",()=>{const e=g({}),a=g({}),n=g(null),o=g({}),s=g(new Set);async function l(y){const T=e.value[y];if(!T||T.length===0)return;const F=T.map(D=>D.id);try{const D=await ka(y,F);for(const E of T)E.reactions=D[String(E.id)]||void 0}catch(D){console.error("Failed to load reactions",D)}}async function i(y){n.value=y;try{const T=await mt(y,{limit:50});e.value[y]=T,T.length>0&&(a.value[y]=Math.max(...T.map(F=>F.id))),await l(y)}catch(T){throw console.error("Failed to load messages",T),T}finally{n.value=null}}async function r(y){const T=a.value[y]||0;if(T===0)return[];try{const F=await mt(y,{after_id:T,limit:50});if(F.length>0){e.value[y]||(e.value[y]=[]);const D=new Set(e.value[y].map(U=>U.id)),E=F.filter(U=>!D.has(U.id));e.value[y].push(...E),a.value[y]=Math.max(...F.map(U=>U.id)),await l(y)}return F}catch(F){return console.error("Failed to load newer messages",F),[]}}async function v(y){const T=e.value[y];if(!T||T.length===0)return[];const F=T[0];if(!F)return[];try{const D=await mt(y,{before:F.created_at,limit:50});if(D.length>0){const E=new Set(T.map(J=>J.id)),U=D.filter(J=>!E.has(J.id));e.value[y]=[...U,...T],await l(y)}return D}catch(D){return console.error("Failed to load older messages",D),[]}}async function k(y,T,F){try{const D=await ba(y,T,F);m(y,T,D.action,F,!0)}catch(D){console.error("Failed to toggle reaction",D)}}function m(y,T,F,D,E){const U=e.value[y];if(!U)return;const J=U.find(Se=>Se.id===T);if(!J)return;J.reactions||(J.reactions=[]);const oe=J.reactions.find(Se=>Se.emoji===D);F==="added"?oe?(oe.count++,E&&(oe.me=!0)):J.reactions.push({emoji:D,count:1,me:E}):oe&&(oe.count--,E&&(oe.me=!1),oe.count<=0&&(J.reactions=J.reactions.filter(Se=>Se.emoji!==D))),J.reactions.length===0&&(J.reactions=void 0)}async function u(y,T,F="text",D){const E=await va(y,{content:T,type:F,...D});e.value[y]||(e.value[y]=[]);const U=e.value[y].findIndex(J=>J.id===E.id);return U!==-1?e.value[y][U]=E:e.value[y].push(E),a.value[y]=Math.max(a.value[y]||0,E.id),E}function c(y,T){if(!T.reply_to_message_id||T.reply_to_sender_username||T.reply_to_sender_name)return;const F=e.value[y];if(!F)return;const D=F.find(E=>E.id===T.reply_to_message_id);D&&(T.reply_to_sender_username=D.sender_username,T.reply_to_sender_name=D.sender_display_name||D.sender_username,!T.reply_to_content&&D.content&&(T.reply_to_content=D.content),!T.reply_to_type&&D.message_type&&(T.reply_to_type=D.message_type))}function p(y,T){e.value[y]||(e.value[y]=[]),e.value[y].find(D=>D.id===T.id)||(c(y,T),e.value[y].push(T),a.value[y]=Math.max(a.value[y]||0,T.id))}async function b(y,T){try{await ma(y,T),f(y,T)}catch(F){throw console.error("Failed to delete message",F),F}}function f(y,T){const F=e.value[y];F&&(e.value[y]=F.filter(D=>D.id!==T))}async function S(y,T,F){try{const D=await fa(y,T,F);C(y,T,D.content,D.updated_at)}catch(D){throw console.error("Failed to edit message",D),D}}function C(y,T,F,D){const E=e.value[y];if(!E)return;const U=E.find(J=>J.id===T);U&&(U.content=F,U.is_edited=!0,D&&(U.updated_at=D))}async function $(y,T,F){try{const D=await pa(y,{from_chat_id:T,message_ids:F});for(const E of D)p(y,E);return D}catch(D){throw console.error("Failed to forward messages",D),D}}async function x(y){try{const T=await ya(y);T&&T.message?o.value[y]={message:T.message,pinnedAt:T.pinned_at,pinnedBy:T.pinned_by}:o.value[y]=null}catch(T){console.error("Failed to load pinned message",T),o.value[y]=null}}async function j(y,T){try{const F=await ha(y,T);o.value[y]={message:F.message,pinnedAt:F.pinned_at,pinnedBy:F.pinned_by},s.value.delete(y)}catch(F){throw console.error("Failed to pin message",F),F}}async function _(y,T){try{await ga(y,T),o.value[y]=null}catch(F){throw console.error("Failed to unpin message",F),F}}function O(y,T,F,D){o.value[y]={message:D,pinnedAt:new Date().toISOString(),pinnedBy:F},s.value.delete(y)}function W(y){o.value[y]=null}function L(y){s.value.add(y)}function H(y){return e.value[y]||[]}return{messagesByChat:e,lastMsgId:a,loadingChat:n,loadMessages:i,loadNewer:r,loadOlder:v,sendMessage:u,pushMessage:p,getMessages:H,toggleReaction:k,applyReactionUpdate:m,deleteMessage:b,removeMessage:f,editMessage:S,applyMessageUpdate:C,forwardMessages:$,pinnedByChat:o,pinnedDismissed:s,loadPinnedMessage:x,pinMsg:j,unpinMsg:_,applyMessagePinned:O,applyMessageUnpinned:W,dismissPin:L}});function wa(e,a,n){if(!document.hidden||e.sender_id===n.user?.id||!Wt().notificationsEnabled||!("Notification"in window)||Notification.permission!=="granted"||a.chats.find(v=>v.id===e.chat_id)?.is_muted)return;const l=e.sender_display_name||e.sender_username||"Someone",i=e.message_type==="text"?e.content?.length>100?e.content.substring(0,100)+"...":e.content:`sent a ${e.message_type==="sticker"?"sticker":e.message_type==="voice"?"voice message":"file"}`,r=new Notification(l,{body:i,tag:`chat-${e.chat_id}`,silent:!1});r.onclick=()=>{window.focus(),a.setActiveChat(e.chat_id),r.close()},setTimeout(()=>r.close(),5e3)}function _a(){const e=g(!1);let a=null,n=null,o=null,s=1e3,l=!1;function i(){const f=localStorage.getItem("access_token");return f?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws?token=${encodeURIComponent(f)}`:null}function r(){if(a&&(a.readyState===WebSocket.OPEN||a.readyState===WebSocket.CONNECTING))return;const f=i();f&&(l=!1,a=new WebSocket(f),a.onopen=()=>{e.value=!0,s=1e3;const S=localStorage.getItem("access_token");S&&a.send(JSON.stringify({type:"auth",token:S}));const C=be();for(const $ of C.chats)a.send(JSON.stringify({type:"subscribe",chat_id:$.id}));k()},a.onmessage=S=>{try{const C=JSON.parse(S.data);v(C)}catch{}},a.onclose=()=>{e.value=!1,m(),l||u()},a.onerror=()=>{})}function v(f){const S=Gt(),C=be(),$=Oe();switch(f.type){case"message":{const x=f;S.pushMessage(x.chat_id,x),C.updateChatLastMessage(x.chat_id,x.content||(x.message_type==="sticker"?"Sticker":"Attachment"),x.created_at),x.chat_id!==C.activeChatId&&x.sender_id!==$.user?.id&&C.incrementUnread(x.chat_id),C.clearTyping(x.chat_id,x.sender_id),wa(x,C,$);break}case"typing":{const x=f.chat_id,j=f.user_id;if(j!==$.user?.id){const _=f.username||"Someone";C.setTyping(x,j,_)}break}case"pong":break;case"presence":{const x=f.user_id,j=f.status,_=f.last_seen_at,O=f.last_seen_bucket;j==="online"?C.setUserOnline(x):j==="offline"&&C.setUserOffline(x,_,O);break}case"message_deleted":{const x=f.chat_id,j=f.message_id;S.removeMessage(x,j);break}case"message_updated":{const x=f.chat_id,j=f.message_id,_=f.content,O=f.updated_at;S.applyMessageUpdate(x,j,_,O);break}case"message_pinned":{const x=f.chat_id,j=f.message_id,_=f.pinned_by,O=f.message;S.applyMessagePinned(x,j,_,O);break}case"message_unpinned":{const x=f.chat_id;S.applyMessageUnpinned(x);break}case"reaction":{const x=f.chat_id,j=f.message_id,_=f.user_id,O=f.emoji,W=f.action;S.applyReactionUpdate(x,j,W,O,_===$.user?.id);break}}}function k(){m(),o=setInterval(()=>{a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"ping"}))},25e3)}function m(){o&&(clearInterval(o),o=null)}function u(){n||(n=setTimeout(()=>{n=null,r(),s=Math.min(s*2,3e4)},s))}function c(f){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"subscribe",chat_id:f}))}function p(f){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"typing",chat_id:f}))}function b(){l=!0,m(),n&&(clearTimeout(n),n=null),a&&(a.close(),a=null),e.value=!1}return Fe(()=>{b()}),{connected:e,connect:r,disconnect:b,subscribeToChat:c,sendTyping:p}}async function ss(e){const{data:a}=await G.get(`/users/${e}`);return a}async function as(e){const{data:a}=await G.get(`/users/by-username/${encodeURIComponent(e)}`);return a}async function Fn(e){const{data:a}=await G.get("/users/search",{params:{q:e}});return a}async function Ca(e,a){const{data:n}=await G.put(`/users/${e}`,a);return n}async function $a(e){const{data:a}=await G.put("/users/me/avatar",{file_id:e});return a}async function Sa(){const{data:e}=await G.get("/stickers");return e}const Ma=e=>{for(const a in e)if(a.startsWith("aria-")||a==="role"||a==="title")return!0;return!1};const Hn=e=>e==="";const xa=(...e)=>e.filter((a,n,o)=>!!a&&a.trim()!==""&&o.indexOf(a)===n).join(" ").trim();const jn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const Ta=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,n,o)=>o?o.toUpperCase():n.toLowerCase());const Ea=e=>{const a=Ta(e);return a.charAt(0).toUpperCase()+a.slice(1)};var qe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Ia=({name:e,iconNode:a,absoluteStrokeWidth:n,"absolute-stroke-width":o,strokeWidth:s,"stroke-width":l,size:i=qe.width,color:r=qe.stroke,...v},{slots:k})=>ln("svg",{...qe,...v,width:i,height:i,stroke:r,"stroke-width":Hn(n)||Hn(o)||n===!0||o===!0?Number(s||l||qe["stroke-width"])*24/Number(i):s||l||qe["stroke-width"],class:xa("lucide",v.class,...e?[`lucide-${jn(Ea(e))}-icon`,`lucide-${jn(e)}`]:["lucide-icon"]),...!k.default&&!Ma(v)&&{"aria-hidden":"true"}},[...a.map(m=>ln(...m)),...k.default?[k.default()]:[]]);const se=(e,a)=>(n,{slots:o,attrs:s})=>ln(Ia,{...s,...n,iconNode:a,name:e},o);const Ue=se("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const La=se("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]);const Aa=se("bookmark",[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]]);const os=se("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Da=se("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const Ra=se("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Oa=se("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Na=se("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const Pa=se("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const Ua=se("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const yn=se("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const is=se("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]);const Fa=se("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const Ha=se("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const ja=se("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const Ba=se("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const za=se("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Va=se("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Wa=se("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const qa=se("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const ls=se("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const rs=se("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const bn=se("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);const Ne=se("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ga={class:"swipe-actions swipe-actions-left"},Ka={class:"chat-item-info"},Ja={class:"chat-item-top"},Qa={class:"chat-item-name"},Ya={key:0,class:"pin-icon",title:"Pinned"},Xa={key:1,class:"ci-channel"},Za={key:2,class:"ci-group"},eo={key:3,class:"mute-icon",title:"Muted"},to={class:"chat-item-time"},no={class:"chat-item-bottom"},so={class:"chat-item-preview"},ao=["title"],oo={class:"swipe-actions swipe-actions-right"},Bn=70,io=Y({__name:"ChatListItem",props:{chat:{},active:{type:Boolean}},emits:["select","toggleFavorite","togglePin","toggleMute","contextmenu"],setup(e,{emit:a}){const n=e,o=be(),s=z(()=>n.chat.type!=="direct"||!n.chat.other_user_id?null:o.isUserOnline(n.chat.other_user_id)||null),l=z(()=>(n.chat.unread_count??0)>0),i=a,r=z(()=>{const f=n.chat;return f.type==="channel"||f.type==="group"?f.title||f.name||"Untitled":f.other_display_name||f.other_username||f.title||f.name||"Chat"});function v(f){if(!f)return"";const S=new Date(f.endsWith("Z")?f:f+"Z"),C=new Date;return S.toDateString()===C.toDateString()?S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):S.toLocaleDateString([],{month:"short",day:"numeric"})}const k=g(0);let m=0,u=!1;function c(f){m=f.touches[0].clientX,u=!0}function p(f){if(!u)return;const S=f.touches[0].clientX-m;k.value=Math.max(-Bn,Math.min(Bn,S))}function b(){u=!1,k.value=0}return(f,S)=>(d(),h("div",{ref:"swipeRef",class:"chat-item-swipe-wrapper",onTouchstart:c,onTouchmove:p,onTouchend:b},[t("div",Ga,[t("button",{class:"swipe-action swipe-pin",onClick:S[0]||(S[0]=C=>i("togglePin"))},A(e.chat.is_pinned?"Unpin":"Pin"),1)]),t("div",{class:le(["chat-item",{active:e.active,"chat-item-unread":l.value}]),style:Vt({transform:`translateX(${k.value}px)`}),onClick:S[2]||(S[2]=C=>i("select")),onContextmenu:S[3]||(S[3]=ne(C=>i("contextmenu",C),["prevent"]))},[B(me,{name:r.value,url:e.chat.other_avatar_url,size:"sm",online:s.value},null,8,["name","url","online"]),t("div",Ka,[t("div",Ja,[t("span",Qa,[e.chat.is_pinned?(d(),h("span",Ya,"ğŸ“Œ")):P("",!0),e.chat.type==="channel"?(d(),h("span",Xa)):e.chat.type==="group"?(d(),h("span",Za)):P("",!0),he(" "+A(r.value)+" ",1),e.chat.is_muted?(d(),h("span",eo,"ğŸ””")):P("",!0)]),t("span",to,A(v(e.chat.last_at||e.chat.updated_at)),1)]),t("div",no,[t("span",so,A(e.chat.last_message||""),1),e.chat.unread_count>0?(d(),h("span",{key:0,class:le(["unread-badge",{"unread-badge-muted":e.chat.is_muted}])},A(e.chat.unread_count>99?"99+":e.chat.unread_count),3)):P("",!0)])]),t("button",{class:le(["star-btn",{"star-active":e.chat.is_favorite}]),title:e.chat.is_favorite?"Unstar":"Star",onClick:S[1]||(S[1]=ne(C=>i("toggleFavorite"),["stop"]))},"â˜…",10,ao)],38),t("div",oo,[t("button",{class:"swipe-action swipe-mute",onClick:S[4]||(S[4]=C=>i("toggleMute"))},A(e.chat.is_muted?"Unmute":"Mute"),1)])],544))}}),re=(e,a)=>{const n=e.__vccOpts||e;for(const[o,s]of a)n[o]=s;return n},Zt=re(io,[["__scopeId","data-v-455ebfed"]]),lo={class:"sidebar"},ro={class:"sidebar-header"},co={class:"search-wrap"},uo={class:"chat-list"},vo={key:0,class:"empty-state-small"},mo={key:0,class:"chat-section-label"},fo={key:1,class:"chat-section-label"},po={key:2,class:"chat-section-label"},ho=Y({__name:"Sidebar",emits:["openDrawer","openNewChat","selectChat"],setup(e,{emit:a}){const n=a,o=be(),s=g(""),l=z(()=>{const c=s.value.toLowerCase(),p=o.sortedChats.filter(b=>!b.is_archived);return c?p.filter(b=>{const f=k(b).toLowerCase(),S=(b.other_username||"").toLowerCase();return f.includes(c)||S.includes(c)}):p}),i=z(()=>l.value.filter(c=>c.is_pinned&&!c.is_favorite)),r=z(()=>l.value.filter(c=>c.is_favorite&&!c.is_pinned)),v=z(()=>l.value.filter(c=>!c.is_favorite&&!c.is_pinned));function k(c){return c.type==="channel"||c.type==="group"?c.title||c.name||"Untitled":c.other_display_name||c.other_username||c.title||c.name||"Chat"}const m=g(null);dt("contextChatId",m);function u(c,p){c.preventDefault(),m.value=p,window.dispatchEvent(new CustomEvent("show-context-menu",{detail:{x:c.clientX,y:c.clientY,chatId:p}}))}return(c,p)=>(d(),h("aside",lo,[t("header",ro,[t("button",{class:"icon-btn","aria-label":"Menu",onClick:p[0]||(p[0]=b=>n("openDrawer"))},[B(M(Fa),{size:20})]),t("div",co,[ee(t("input",{"onUpdate:modelValue":p[1]||(p[1]=b=>s.value=b),class:"search-input",type:"search",placeholder:"Search chats..."},null,512),[[ie,s.value]])]),t("button",{class:"icon-btn","aria-label":"New chat",title:"New chat",onClick:p[2]||(p[2]=b=>n("openNewChat"))},[B(M(Wa),{size:20})])]),t("div",uo,[l.value.length===0?(d(),h("div",vo,[...p[3]||(p[3]=[he(" No conversations yet.",-1),t("br",null,null,-1),he("Click the pencil icon to start one. ",-1)])])):(d(),h(te,{key:1},[i.value.length>0?(d(),h("div",mo,"Pinned")):P("",!0),(d(!0),h(te,null,ue(i.value,b=>(d(),Q(Zt,{key:b.id,chat:b,active:b.id===M(o).activeChatId,onSelect:f=>n("selectChat",b.id),onToggleFavorite:f=>M(o).toggleFavorite(b.id),onTogglePin:f=>M(o).togglePin(b.id),onToggleMute:f=>M(o).toggleMute(b.id),onToggleArchive:f=>M(o).toggleArchive(b.id),onContextmenu:f=>u(f,b.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),r.value.length>0?(d(),h("div",fo,"Starred")):P("",!0),(d(!0),h(te,null,ue(r.value,b=>(d(),Q(Zt,{key:b.id,chat:b,active:b.id===M(o).activeChatId,onSelect:f=>n("selectChat",b.id),onToggleFavorite:f=>M(o).toggleFavorite(b.id),onTogglePin:f=>M(o).togglePin(b.id),onToggleMute:f=>M(o).toggleMute(b.id),onToggleArchive:f=>M(o).toggleArchive(b.id),onContextmenu:f=>u(f,b.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128)),(i.value.length>0||r.value.length>0)&&v.value.length>0?(d(),h("div",po," All chats ")):P("",!0),(d(!0),h(te,null,ue(v.value,b=>(d(),Q(Zt,{key:b.id,chat:b,active:b.id===M(o).activeChatId,onSelect:f=>n("selectChat",b.id),onToggleFavorite:f=>M(o).toggleFavorite(b.id),onTogglePin:f=>M(o).togglePin(b.id),onToggleMute:f=>M(o).toggleMute(b.id),onToggleArchive:f=>M(o).toggleArchive(b.id),onContextmenu:f=>u(f,b.id)},null,8,["chat","active","onSelect","onToggleFavorite","onTogglePin","onToggleMute","onToggleArchive","onContextmenu"]))),128))],64))])]))}});function go(){const e=g(!1),a=g(0);let n=null,o=[],s=null;async function l(){if(!navigator.mediaDevices?.getUserMedia)throw new Error("MediaDevices not supported");const m=await navigator.mediaDevices.getUserMedia({audio:!0});o=[],a.value=0,n=new MediaRecorder(m),n.ondataavailable=u=>{u.data.size&&o.push(u.data)},n.start(),e.value=!0,s=setInterval(()=>{a.value++},1e3)}function i(){return new Promise((m,u)=>{if(!n||n.state!=="recording"){u(new Error("Not recording"));return}n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(S=>S.stop()),v(),e.value=!1;const c=n?.mimeType||"audio/webm",p=c.includes("ogg")?"ogg":"webm",b=new Blob(o,{type:c}),f=new File([b],`voice.${p}`,{type:c});m(f)},n.stop()})}function r(){n&&n.state==="recording"&&(n.onstop=()=>{n?.stream&&n.stream.getTracks().forEach(m=>m.stop())},n.stop()),v(),e.value=!1,a.value=0}function v(){s&&(clearInterval(s),s=null)}function k(m){const u=Math.floor(m/60),c=m%60;return`${u}:${String(c).padStart(2,"0")}`}return{isRecording:e,seconds:a,startRecording:l,stopRecording:i,cancelRecording:r,formatTime:k}}async function kn(e){const a=new FormData;a.append("file",e);const{data:n}=await G.post("/files",a);return n}const yo={class:"pin-bar-content"},bo={class:"pin-bar-sender"},ko={class:"pin-bar-text"},wo=Y({__name:"PinBar",props:{message:{}},emits:["click","dismiss"],setup(e){const a=e,n=z(()=>a.message.sender_display_name||a.message.sender_username||"Unknown"),o=z(()=>{const s=a.message;switch(s.message_type){case"sticker":return s.sticker_label||"Sticker";case"voice":return"Voice message";case"file":return"File";default:return s.content||""}});return(s,l)=>(d(),h("div",{class:"pin-bar",onClick:l[1]||(l[1]=i=>s.$emit("click"))},[l[2]||(l[2]=t("span",{class:"pin-bar-icon"},"ğŸ“Œ",-1)),t("div",yo,[t("span",bo,A(n.value),1),t("span",ko,A(o.value),1)]),t("button",{class:"pin-bar-close",onClick:l[0]||(l[0]=ne(i=>s.$emit("dismiss"),["stop"])),title:"Dismiss"},"Ã—")]))}});function _o(e){const a=new Date(e),o=new Date().getTime()-a.getTime(),s=Math.floor(o/1e3),l=Math.floor(s/60),i=Math.floor(l/60),r=Math.floor(i/24);if(l<1)return"last seen just now";if(l<60)return`last seen ${l} minute${l!==1?"s":""} ago`;if(i<24)return`last seen ${i} hour${i!==1?"s":""} ago`;if(r===1)return"last seen yesterday";if(r<7)return`last seen ${r} days ago`;const v=a.toLocaleString("en",{month:"short"}),k=a.getDate();return`last seen ${v} ${k}`}const Co={class:"chat-header"},$o={class:"chat-header-name"},So=Y({__name:"ChatHeader",emits:["back","openUserProfile","openChannelInfo","openSearch"],setup(e,{emit:a}){const n=a,o=be(),s=z(()=>o.activeChat),l=z(()=>{const u=s.value;return u?u.type==="channel"||u.type==="group"?u.title||u.name||"Untitled":u.other_display_name||u.other_username||u.title||u.name||"Chat":"---"}),i=z(()=>s.value?o.getTypingUsernames(s.value.id):[]),r=z(()=>i.value.length>0),v=z(()=>{const u=s.value;return!u||u.type!=="direct"||!u.other_user_id?!1:o.isUserOnline(u.other_user_id)}),k=z(()=>{if(i.value.length===1)return`${i.value[0]} is typing...`;if(i.value.length>1)return`${i.value.length} people typing...`;const u=s.value;if(!u)return"";if(u.type==="channel"){const c=u.member_count??0;return`${c} subscriber${c!==1?"s":""}`}if(u.type==="group"){const c=u.member_count??0;return`${c} member${c!==1?"s":""}`}if(v.value)return"online";if(u.type==="direct"&&u.other_user_id){const c=o.getUserPresence(u.other_user_id);if(c){if(c.lastSeenAt)return _o(c.lastSeenAt);if(c.lastSeenBucket)return`last seen ${c.lastSeenBucket}`}}return u.other_username?"@"+u.other_username:""});Ee(()=>s.value?.id,()=>{const u=s.value;if(!u||u.type!=="direct"||!u.other_user_id)return;const c=u.other_user_id;o.getUserPresence(c)||ss(c).then(p=>{p.last_activity&&o.setUserPresence(c,{isOnline:o.isUserOnline(c),lastSeenAt:p.last_activity})}).catch(()=>{})},{immediate:!0});function m(){const u=s.value;u&&(u.type==="channel"||u.type==="group"?n("openChannelInfo"):u.type==="direct"&&u.other_username&&n("openUserProfile",u.other_username))}return(u,c)=>(d(),h("header",Co,[t("button",{class:"icon-btn back-btn","aria-label":"Back",onClick:c[0]||(c[0]=p=>n("back"))},"â†"),B(me,{class:"chat-header-avatar",name:l.value,url:s.value?.other_avatar_url,online:v.value,size:"sm",onClick:m},null,8,["name","url","online"]),t("div",{class:"chat-header-info",onClick:m},[t("div",$o,A(l.value),1),k.value?(d(),h("div",{key:0,class:le(["chat-header-sub",{"typing-text":r.value,"online-text":v.value&&!r.value}])},A(k.value),3)):P("",!0)]),t("button",{class:"icon-btn search-btn","aria-label":"Search messages",onClick:c[1]||(c[1]=p=>n("openSearch"))},"ğŸ”")]))}}),Mo="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",xo="ÎµÎ»1Ï…2Ğ±Ğ³1ĞµĞ»3Ğ´ĞµÑ‚Ğ¸4ĞµÑ2ĞºĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº6Ğ¾Ğ¼3Ğ¼ĞºĞ´2Ğ¾Ğ½1ÑĞºĞ²Ğ°6Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½5Ñ€Ğ³3Ñ€ÑƒÑ2Ñ„2ÑĞ°Ğ¹Ñ‚3Ñ€Ğ±3ÑƒĞºÑ€3Ò›Ğ°Ğ·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæ„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæ„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£åˆ©æµ¦3é£Ÿå“2é¤å…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2",cn="numeric",un="ascii",dn="alpha",Qe="asciinumeric",Ke="alphanumeric",vn="domain",cs="emoji",To="scheme",Eo="slashscheme",en="whitespace";function Io(e,a){return e in a||(a[e]=[]),a[e]}function Pe(e,a,n){a[cn]&&(a[Qe]=!0,a[Ke]=!0),a[un]&&(a[Qe]=!0,a[dn]=!0),a[Qe]&&(a[Ke]=!0),a[dn]&&(a[Ke]=!0),a[Ke]&&(a[vn]=!0),a[cs]&&(a[vn]=!0);for(const o in a){const s=Io(o,n);s.indexOf(e)<0&&s.push(e)}}function Lo(e,a){const n={};for(const o in a)a[o].indexOf(e)>=0&&(n[o]=!0);return n}function pe(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}pe.groups={};pe.prototype={accepts(){return!!this.t},go(e){const a=this,n=a.j[e];if(n)return n;for(let o=0;o<a.jr.length;o++){const s=a.jr[o][0],l=a.jr[o][1];if(l&&s.test(e))return l}return a.jd},has(e,a=!1){return a?e in this.j:!!this.go(e)},ta(e,a,n,o){for(let s=0;s<e.length;s++)this.tt(e[s],a,n,o)},tr(e,a,n,o){o=o||pe.groups;let s;return a&&a.j?s=a:(s=new pe(a),n&&o&&Pe(a,n,o)),this.jr.push([e,s]),s},ts(e,a,n,o){let s=this;const l=e.length;if(!l)return s;for(let i=0;i<l-1;i++)s=s.tt(e[i]);return s.tt(e[l-1],a,n,o)},tt(e,a,n,o){o=o||pe.groups;const s=this;if(a&&a.j)return s.j[e]=a,a;const l=a;let i,r=s.go(e);if(r?(i=new pe,Object.assign(i.j,r.j),i.jr.push.apply(i.jr,r.jr),i.jd=r.jd,i.t=r.t):i=new pe,l){if(o)if(i.t&&typeof i.t=="string"){const v=Object.assign(Lo(i.t,o),n);Pe(l,v,o)}else n&&Pe(l,n,o);i.t=l}return s.j[e]=i,i}};const q=(e,a,n,o,s)=>e.ta(a,n,o,s),ae=(e,a,n,o,s)=>e.tr(a,n,o,s),zn=(e,a,n,o,s)=>e.ts(a,n,o,s),I=(e,a,n,o,s)=>e.tt(a,n,o,s),Te="WORD",mn="UWORD",us="ASCIINUMERICAL",ds="ALPHANUMERICAL",nt="LOCALHOST",fn="TLD",pn="UTLD",ft="SCHEME",Be="SLASH_SCHEME",wn="NUM",hn="WS",_n="NL",Ye="OPENBRACE",Xe="CLOSEBRACE",gt="OPENBRACKET",yt="CLOSEBRACKET",bt="OPENPAREN",kt="CLOSEPAREN",wt="OPENANGLEBRACKET",_t="CLOSEANGLEBRACKET",Ct="FULLWIDTHLEFTPAREN",$t="FULLWIDTHRIGHTPAREN",St="LEFTCORNERBRACKET",Mt="RIGHTCORNERBRACKET",xt="LEFTWHITECORNERBRACKET",Tt="RIGHTWHITECORNERBRACKET",Et="FULLWIDTHLESSTHAN",It="FULLWIDTHGREATERTHAN",Lt="AMPERSAND",At="APOSTROPHE",Dt="ASTERISK",De="AT",Rt="BACKSLASH",Ot="BACKTICK",Nt="CARET",Re="COLON",Cn="COMMA",Pt="DOLLAR",Ce="DOT",Ut="EQUALS",$n="EXCLAMATION",ye="HYPHEN",Ze="PERCENT",Ft="PIPE",Ht="PLUS",jt="POUND",et="QUERY",Sn="QUOTE",vs="FULLWIDTHMIDDLEDOT",Mn="SEMI",$e="SLASH",tt="TILDE",Bt="UNDERSCORE",ms="EMOJI",zt="SYM";var fs=Object.freeze({__proto__:null,ALPHANUMERICAL:ds,AMPERSAND:Lt,APOSTROPHE:At,ASCIINUMERICAL:us,ASTERISK:Dt,AT:De,BACKSLASH:Rt,BACKTICK:Ot,CARET:Nt,CLOSEANGLEBRACKET:_t,CLOSEBRACE:Xe,CLOSEBRACKET:yt,CLOSEPAREN:kt,COLON:Re,COMMA:Cn,DOLLAR:Pt,DOT:Ce,EMOJI:ms,EQUALS:Ut,EXCLAMATION:$n,FULLWIDTHGREATERTHAN:It,FULLWIDTHLEFTPAREN:Ct,FULLWIDTHLESSTHAN:Et,FULLWIDTHMIDDLEDOT:vs,FULLWIDTHRIGHTPAREN:$t,HYPHEN:ye,LEFTCORNERBRACKET:St,LEFTWHITECORNERBRACKET:xt,LOCALHOST:nt,NL:_n,NUM:wn,OPENANGLEBRACKET:wt,OPENBRACE:Ye,OPENBRACKET:gt,OPENPAREN:bt,PERCENT:Ze,PIPE:Ft,PLUS:Ht,POUND:jt,QUERY:et,QUOTE:Sn,RIGHTCORNERBRACKET:Mt,RIGHTWHITECORNERBRACKET:Tt,SCHEME:ft,SEMI:Mn,SLASH:$e,SLASH_SCHEME:Be,SYM:zt,TILDE:tt,TLD:fn,UNDERSCORE:Bt,UTLD:pn,UWORD:mn,WORD:Te,WS:hn});const Me=/[a-z]/,Ge=new RegExp("\\p{L}","u"),tn=new RegExp("\\p{Emoji}","u"),xe=/\d/,nn=/\s/,Vn="\r",sn=`
`,Ao="ï¸",Do="â€",an="ï¿¼";let rt=null,ct=null;function Ro(e=[]){const a={};pe.groups=a;const n=new pe;rt==null&&(rt=Wn(Mo)),ct==null&&(ct=Wn(xo)),I(n,"'",At),I(n,"{",Ye),I(n,"}",Xe),I(n,"[",gt),I(n,"]",yt),I(n,"(",bt),I(n,")",kt),I(n,"<",wt),I(n,">",_t),I(n,"ï¼ˆ",Ct),I(n,"ï¼‰",$t),I(n,"ã€Œ",St),I(n,"ã€",Mt),I(n,"ã€",xt),I(n,"ã€",Tt),I(n,"ï¼œ",Et),I(n,"ï¼",It),I(n,"&",Lt),I(n,"*",Dt),I(n,"@",De),I(n,"`",Ot),I(n,"^",Nt),I(n,":",Re),I(n,",",Cn),I(n,"$",Pt),I(n,".",Ce),I(n,"=",Ut),I(n,"!",$n),I(n,"-",ye),I(n,"%",Ze),I(n,"|",Ft),I(n,"+",Ht),I(n,"#",jt),I(n,"?",et),I(n,'"',Sn),I(n,"/",$e),I(n,";",Mn),I(n,"~",tt),I(n,"_",Bt),I(n,"\\",Rt),I(n,"ãƒ»",vs);const o=ae(n,xe,wn,{[cn]:!0});ae(o,xe,o);const s=ae(o,Me,us,{[Qe]:!0}),l=ae(o,Ge,ds,{[Ke]:!0}),i=ae(n,Me,Te,{[un]:!0});ae(i,xe,s),ae(i,Me,i),ae(s,xe,s),ae(s,Me,s);const r=ae(n,Ge,mn,{[dn]:!0});ae(r,Me),ae(r,xe,l),ae(r,Ge,r),ae(l,xe,l),ae(l,Me),ae(l,Ge,l);const v=I(n,sn,_n,{[en]:!0}),k=I(n,Vn,hn,{[en]:!0}),m=ae(n,nn,hn,{[en]:!0});I(n,an,m),I(k,sn,v),I(k,an,m),ae(k,nn,m),I(m,Vn),I(m,sn),ae(m,nn,m),I(m,an,m);const u=ae(n,tn,ms,{[cs]:!0});I(u,"#"),ae(u,tn,u),I(u,Ao,u);const c=I(u,Do);I(c,"#"),ae(c,tn,u);const p=[[Me,i],[xe,s]],b=[[Me,null],[Ge,r],[xe,l]];for(let f=0;f<rt.length;f++)Ae(n,rt[f],fn,Te,p);for(let f=0;f<ct.length;f++)Ae(n,ct[f],pn,mn,b);Pe(fn,{tld:!0,ascii:!0},a),Pe(pn,{utld:!0,alpha:!0},a),Ae(n,"file",ft,Te,p),Ae(n,"mailto",ft,Te,p),Ae(n,"http",Be,Te,p),Ae(n,"https",Be,Te,p),Ae(n,"ftp",Be,Te,p),Ae(n,"ftps",Be,Te,p),Pe(ft,{scheme:!0,ascii:!0},a),Pe(Be,{slashscheme:!0,ascii:!0},a),e=e.sort((f,S)=>f[0]>S[0]?1:-1);for(let f=0;f<e.length;f++){const S=e[f][0],$=e[f][1]?{[To]:!0}:{[Eo]:!0};S.indexOf("-")>=0?$[vn]=!0:Me.test(S)?xe.test(S)?$[Qe]=!0:$[un]=!0:$[cn]=!0,zn(n,S,S,$)}return zn(n,"localhost",nt,{ascii:!0}),n.jd=new pe(zt),{start:n,tokens:Object.assign({groups:a},fs)}}function ps(e,a){const n=Oo(a.replace(/[A-Z]/g,r=>r.toLowerCase())),o=n.length,s=[];let l=0,i=0;for(;i<o;){let r=e,v=null,k=0,m=null,u=-1,c=-1;for(;i<o&&(v=r.go(n[i]));)r=v,r.accepts()?(u=0,c=0,m=r):u>=0&&(u+=n[i].length,c++),k+=n[i].length,l+=n[i].length,i++;l-=u,i-=c,k-=u,s.push({t:m.t,v:a.slice(l-k,l),s:l-k,e:l})}return s}function Oo(e){const a=[],n=e.length;let o=0;for(;o<n;){let s=e.charCodeAt(o),l,i=s<55296||s>56319||o+1===n||(l=e.charCodeAt(o+1))<56320||l>57343?e[o]:e.slice(o,o+2);a.push(i),o+=i.length}return a}function Ae(e,a,n,o,s){let l;const i=a.length;for(let r=0;r<i-1;r++){const v=a[r];e.j[v]?l=e.j[v]:(l=new pe(o),l.jr=s.slice(),e.j[v]=l),e=l}return l=new pe(n),l.jr=s.slice(),e.j[a[i-1]]=l,l}function Wn(e){const a=[],n=[];let o=0,s="0123456789";for(;o<e.length;){let l=0;for(;s.indexOf(e[o+l])>=0;)l++;if(l>0){a.push(n.join(""));for(let i=parseInt(e.substring(o,o+l),10);i>0;i--)n.pop();o+=l}else n.push(e[o]),o++}return a}const st={defaultProtocol:"http",events:null,format:qn,formatHref:qn,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function xn(e,a=null){let n=Object.assign({},st);e&&(n=Object.assign(n,e instanceof xn?e.o:e));const o=n.ignoreTags,s=[];for(let l=0;l<o.length;l++)s.push(o[l].toUpperCase());this.o=n,a&&(this.defaultRender=a),this.ignoreTags=s}xn.prototype={o:st,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,a,n){const o=a!=null;let s=this.o[e];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:st[e],typeof s=="function"&&o&&(s=s(a,n))):typeof s=="function"&&o&&(s=s(a,n.t,n)),s)},getObj(e,a,n){let o=this.o[e];return typeof o=="function"&&a!=null&&(o=o(a,n.t,n)),o},render(e){const a=e.render(this);return(this.get("render",null,e)||this.defaultRender)(a,e.t,e)}};function qn(e){return e}function hs(e,a){this.t="token",this.v=e,this.tk=a}hs.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const a=this.toString(),n=e.get("truncate",a,this),o=e.get("format",a,this);return n&&o.length>n?o.substring(0,n)+"â€¦":o},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=st.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const a=this,n=this.toHref(e.get("defaultProtocol")),o=e.get("formatHref",n,this),s=e.get("tagName",n,a),l=this.toFormattedString(e),i={},r=e.get("className",n,a),v=e.get("target",n,a),k=e.get("rel",n,a),m=e.getObj("attributes",n,a),u=e.getObj("events",n,a);return i.href=o,r&&(i.class=r),v&&(i.target=v),k&&(i.rel=k),m&&Object.assign(i,m),{tagName:s,attributes:i,content:l,eventListeners:u}}};function Kt(e,a){class n extends hs{constructor(s,l){super(s,l),this.t=e}}for(const o in a)n.prototype[o]=a[o];return n.t=e,n}const Gn=Kt("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Kn=Kt("text"),No=Kt("nl"),ut=Kt("url",{isLink:!0,toHref(e=st.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==nt&&e[1].t===Re}}),ge=e=>new pe(e);function Po({groups:e}){const a=e.domain.concat([Lt,Dt,De,Rt,Ot,Nt,Pt,Ut,ye,wn,Ze,Ft,Ht,jt,$e,zt,tt,Bt]),n=[At,Re,Cn,Ce,$n,Ze,et,Sn,Mn,wt,_t,Ye,Xe,yt,gt,bt,kt,Ct,$t,St,Mt,xt,Tt,Et,It],o=[Lt,At,Dt,Rt,Ot,Nt,Pt,Ut,ye,Ye,Xe,Ze,Ft,Ht,jt,et,$e,zt,tt,Bt],s=ge(),l=I(s,tt);q(l,o,l),q(l,e.domain,l);const i=ge(),r=ge(),v=ge();q(s,e.domain,i),q(s,e.scheme,r),q(s,e.slashscheme,v),q(i,o,l),q(i,e.domain,i);const k=I(i,De);I(l,De,k),I(r,De,k),I(v,De,k);const m=I(l,Ce);q(m,o,l),q(m,e.domain,l);const u=ge();q(k,e.domain,u),q(u,e.domain,u);const c=I(u,Ce);q(c,e.domain,u);const p=ge(Gn);q(c,e.tld,p),q(c,e.utld,p),I(k,nt,p);const b=I(u,ye);I(b,ye,b),q(b,e.domain,u),q(p,e.domain,u),I(p,Ce,c),I(p,ye,b);const f=I(p,Re);q(f,e.numeric,Gn);const S=I(i,ye),C=I(i,Ce);I(S,ye,S),q(S,e.domain,i),q(C,o,l),q(C,e.domain,i);const $=ge(ut);q(C,e.tld,$),q(C,e.utld,$),q($,e.domain,i),q($,o,l),I($,Ce,C),I($,ye,S),I($,De,k);const x=I($,Re),j=ge(ut);q(x,e.numeric,j);const _=ge(ut),O=ge();q(_,a,_),q(_,n,O),q(O,a,_),q(O,n,O),I($,$e,_),I(j,$e,_);const W=I(r,Re),L=I(v,Re),H=I(L,$e),y=I(H,$e);q(r,e.domain,i),I(r,Ce,C),I(r,ye,S),q(v,e.domain,i),I(v,Ce,C),I(v,ye,S),q(W,e.domain,_),I(W,$e,_),I(W,et,_),q(y,e.domain,_),q(y,a,_),I(y,$e,_);const T=[[Ye,Xe],[gt,yt],[bt,kt],[wt,_t],[Ct,$t],[St,Mt],[xt,Tt],[Et,It]];for(let F=0;F<T.length;F++){const[D,E]=T[F],U=I(_,D);I(O,D,U),I(U,E,_);const J=ge(ut);q(U,a,J);const oe=ge();q(U,n),q(J,a,J),q(J,n,oe),q(oe,a,J),q(oe,n,oe),I(J,E,_),I(oe,E,_)}return I(s,nt,$),I(s,_n,No),{start:s,tokens:fs}}function Uo(e,a,n){let o=n.length,s=0,l=[],i=[];for(;s<o;){let r=e,v=null,k=null,m=0,u=null,c=-1;for(;s<o&&!(v=r.go(n[s].t));)i.push(n[s++]);for(;s<o&&(k=v||r.go(n[s].t));)v=null,r=k,r.accepts()?(c=0,u=r):c>=0&&c++,s++,m++;if(c<0)s-=m,s<o&&(i.push(n[s]),s++);else{i.length>0&&(l.push(on(Kn,a,i)),i=[]),s-=c,m-=c;const p=u.t,b=n.slice(s-m,s);l.push(on(p,a,b))}}return i.length>0&&l.push(on(Kn,a,i)),l}function on(e,a,n){const o=n[0].s,s=n[n.length-1].e,l=a.slice(o,s);return new e(l,n)}const de={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Fo(){de.scanner=Ro(de.customSchemes);for(let e=0;e<de.tokenQueue.length;e++)de.tokenQueue[e][1]({scanner:de.scanner});de.parser=Po(de.scanner.tokens);for(let e=0;e<de.pluginQueue.length;e++)de.pluginQueue[e][1]({scanner:de.scanner,parser:de.parser});return de.initialized=!0,de}function gs(e){return de.initialized||Fo(),Uo(de.parser.start,e,ps(de.scanner.start,e))}gs.scan=ps;function ys(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Ho(e){return e.replace(/"/g,"&quot;")}function jo(e){const a=[];for(const n in e){let o=e[n]+"";a.push(`${n}="${Ho(o)}"`)}return a.join(" ")}function Bo({tagName:e,attributes:a,content:n}){return`<${e} ${jo(a)}>${ys(n)}</${e}>`}function bs(e,a={}){a=new xn(a,Bo);const n=gs(e),o=[];for(let s=0;s<n.length;s++){const l=n[s];l.t==="nl"&&a.get("nl2br")?o.push(`<br>
`):!l.isLink||!a.check(l)?o.push(ys(l.toString())):o.push(a.render(l))}return o.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(a){return bs(this,a)}});const zo={},Vo={class:"admin-badge",title:"Admin"};function Wo(e,a){return d(),h("span",Vo,"âœ“")}const ks=re(zo,[["render",Wo]]);function qo(e){const{delay:a=500,scrollThreshold:n=5,onLongPress:o,onCancel:s}=e,l=g(!1);let i=null,r=0,v=0,k=!1;function m(){i&&(clearTimeout(i),i=null)}function u(f){r=f.clientX,v=f.clientY,k=!1,l.value=!0,m(),i=setTimeout(()=>{k=!0,o(f)},a)}function c(f){if(!i)return;const S=f.clientX-r,C=f.clientY-v;(Math.abs(S)>n||Math.abs(C)>n)&&b()}function p(){m(),l.value=!1}function b(){m(),l.value=!1,k||s?.()}return{isPressed:l,onPointerDown:u,onPointerUp:p,onPointerMove:c}}const Go=["data-message-id"],Ko={key:0,class:"selection-checkbox"},Jo=["checked"],Qo={key:1,class:"msg-sender-name"},Yo={class:"msg-content-wrap"},Xo={class:"msg-reply-quote-name"},Zo={class:"msg-reply-quote-text"},ei={key:1,class:"msg-bubble sticker-bubble"},ti=["src","alt"],ni={key:2,class:"msg-bubble"},si={class:"voice-player"},ai=["src"],oi={key:0,class:"voice-dur"},ii=["innerHTML"],li={key:4,class:"reaction-chips"},ri=["onClick"],ci={class:"reaction-emoji"},ui={class:"reaction-count"},di={class:"msg-time"},vi={key:0,class:"msg-edited-label"},mi=Y({__name:"MessageBubble",props:{message:{},isMine:{type:Boolean}},emits:["mentionClick","openEmojiPicker","toggleReaction","replyClick"],setup(e,{emit:a}){const n=e,o=a,s=qt(),l=be(),i=z(()=>s.isSelected(n.message.id)),{onPointerDown:r,onPointerUp:v,onPointerMove:k}=qo({delay:500,onLongPress(O){c(O.clientX,O.clientY)}}),m={onPointerdown:r,onPointerup:v,onPointermove:k};function u(O){if(s.selectionMode){s.toggleMessage(n.message.id);return}c(O.clientX,O.clientY)}function c(O,W){window.dispatchEvent(new CustomEvent("show-message-context-menu",{detail:{messageId:n.message.id,chatId:l.activeChatId,text:n.message.content||"",messageType:n.message.message_type,senderId:n.message.sender_id,senderName:n.message.sender_display_name||n.message.sender_username||"",x:O,y:W}}))}function p(){s.selectionMode&&s.toggleMessage(n.message.id)}const b=Je("stickers",g([])),f=z(()=>{if(n.message.sticker_url)return n.message.sticker_url;if(n.message.sticker_id){const O=b.value.find(W=>W.id===n.message.sticker_id);if(O)return O.url}return""}),S=z(()=>n.message.attachment_url||""),C=z(()=>{const O=n.message.reply_to_type;if(O==="sticker")return"ğŸ¨ Sticker";if(O==="voice")return"ğŸ¤ Voice message";if(O==="file")return"ğŸ“ File";const W=n.message.reply_to_content||"";return W.length>80?W.slice(0,80)+"...":W}),$=z(()=>bs(n.message.content||"",{defaultProtocol:"https",target:"_blank",rel:"noopener noreferrer"}).replace(/(<a\s[^>]*>.*?<\/a>)|@(\w{1,30})/g,(W,L,H)=>L||`<span class="mention" data-u="${H}" onclick="window.dispatchEvent(new CustomEvent('mention-click', {detail:'${H}'}))">@${H}</span>`));function x(O){if(!O)return"";const W=new Date(O.endsWith("Z")?O:O+"Z"),L=new Date;return W.toDateString()===L.toDateString()?W.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):W.toLocaleDateString([],{month:"short",day:"numeric"})}function j(O){const W=Math.floor(O/60),L=O%60;return`${W}:${String(L).padStart(2,"0")}`}function _(O){const W=O.target.getBoundingClientRect();o("openEmojiPicker",n.message.id,W.left,W.bottom+4)}return typeof window<"u"&&window.addEventListener("mention-click",(O=>{o("mentionClick",O.detail)})),(O,W)=>(d(),h("div",js({class:["msg-row",[e.isMine?"mine":"theirs",{selected:i.value}]],"data-message-id":e.message.id,onContextmenu:ne(u,["prevent"])},m,{onClick:p}),[M(s).selectionMode?(d(),h("div",Ko,[t("input",{type:"checkbox",checked:i.value,tabindex:"-1"},null,8,Jo)])):P("",!0),!e.isMine&&e.message.message_type!=="sticker"?(d(),h("div",Qo,[he(A(e.message.sender_display_name||e.message.sender_username)+" ",1),e.message.sender_is_admin?(d(),Q(ks,{key:0})):P("",!0)])):P("",!0),t("div",Yo,[e.message.reply_to_message_id?(d(),h("div",{key:0,class:"msg-reply-quote",onClick:W[0]||(W[0]=ne(L=>o("replyClick",e.message.reply_to_message_id),["stop"]))},[W[1]||(W[1]=t("div",{class:"msg-reply-quote-bar"},null,-1)),t("div",null,[t("div",Xo,A(e.message.reply_to_sender_name||e.message.reply_to_sender_username||"Unknown"),1),t("div",Zo,A(C.value),1)])])):P("",!0),e.message.message_type==="sticker"?(d(),h("div",ei,[t("img",{class:"sticker-img",src:f.value,alt:e.message.sticker_label||"sticker"},null,8,ti)])):e.message.message_type==="voice"?(d(),h("div",ni,[t("div",si,[t("audio",{controls:"",src:S.value},null,8,ai),e.message.duration_seconds?(d(),h("span",oi,A(j(e.message.duration_seconds)),1)):P("",!0)])])):(d(),h("div",{key:3,class:"msg-bubble",innerHTML:$.value},null,8,ii)),t("button",{class:"reaction-add-btn",onClick:ne(_,["stop"])},"â˜º"),e.message.reactions&&e.message.reactions.length?(d(),h("div",li,[(d(!0),h(te,null,ue(e.message.reactions,L=>(d(),h("button",{key:L.emoji,class:le(["reaction-chip",{"reaction-mine":L.me}]),onClick:ne(H=>o("toggleReaction",e.message.id,L.emoji),["stop"])},[t("span",ci,A(L.emoji),1),t("span",ui,A(L.count),1)],10,ri))),128)),t("button",{class:"reaction-chip reaction-add-chip",onClick:ne(_,["stop"])},"+")])):P("",!0)]),t("div",di,[e.message.is_edited?(d(),h("span",vi,"(edited)")):P("",!0),he(" "+A(x(e.message.created_at)),1)])],16,Go))}}),fi={class:"composer-wrapper"},pi={key:0,class:"reply-preview"},hi={class:"reply-preview-content"},gi={class:"reply-preview-sender"},yi={class:"reply-preview-text"},bi={key:1,class:"reply-preview edit-preview"},ki={class:"reply-preview-content"},wi={class:"reply-preview-text"},_i={class:"composer"},Ci=["onKeydown"],$i=Y({__name:"Composer",props:{stickerPickerOpen:{type:Boolean},replyTo:{}},emits:["send","toggleStickers","startRecording","typing","editMessage"],setup(e,{expose:a,emit:n}){const o=e,s=n,l=g(""),i=g(null),r=g(null),v=g(null);let k=0;function m(){const $=l.value.trim();$&&(v.value?(s("editMessage",v.value.messageId,$),v.value=null):r.value?(s("send",$,{...r.value}),r.value=null):s("send",$),l.value="",C())}function u(){r.value=null,i.value?.focus()}function c(){v.value=null,l.value="",C(),i.value?.focus()}function p(){r.value?u():v.value&&c()}function b($){const x=$.detail;x&&(v.value=null,r.value={messageId:x.messageId,senderName:x.senderName||"Unknown",snippet:(x.text||"").slice(0,100)},fe(()=>i.value?.focus()))}function f($){const x=$.detail;x&&(r.value=null,v.value={messageId:x.messageId,snippet:(x.text||"").slice(0,100),fullText:x.text||""},l.value=v.value.fullText,fe(()=>{C(),i.value?.focus()}))}function S(){C();const $=Date.now();$-k>2e3&&l.value.trim().length>0&&(k=$,s("typing"))}function C(){const $=i.value;$&&($.style.height="auto",$.style.height=Math.min($.scrollHeight,120)+"px")}return ve(()=>{i.value?.focus(),window.addEventListener("reply-to-message",b),window.addEventListener("edit-message",f)}),Fe(()=>{window.removeEventListener("reply-to-message",b),window.removeEventListener("edit-message",f)}),Ee(()=>o.replyTo,$=>{$&&i.value?.focus()}),a({focus:()=>i.value?.focus()}),($,x)=>(d(),h("div",fi,[r.value?(d(),h("div",pi,[x[3]||(x[3]=t("div",{class:"reply-preview-bar"},null,-1)),t("div",hi,[t("span",gi,A(r.value.senderName),1),t("span",yi,A(r.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel reply",onClick:u},"âœ•")])):P("",!0),v.value?(d(),h("div",bi,[x[5]||(x[5]=t("div",{class:"reply-preview-bar edit-bar"},null,-1)),t("div",ki,[x[4]||(x[4]=t("span",{class:"reply-preview-sender"},"Editing message",-1)),t("span",wi,A(v.value.snippet),1)]),t("button",{class:"icon-btn reply-close-btn",title:"Cancel edit",onClick:c},"âœ•")])):P("",!0),t("div",_i,[t("button",{class:"icon-btn composer-btn","aria-label":"Stickers",title:"Stickers",onClick:x[0]||(x[0]=j=>s("toggleStickers"))},"ğŸŒ"),ee(t("textarea",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":x[1]||(x[1]=j=>l.value=j),class:"composer-input",placeholder:"Message...",rows:"1",maxlength:"4000",onKeydown:[rn(ne(m,["exact","prevent"]),["enter"]),rn(p,["escape"])],onInput:S},null,40,Ci),[[ie,l.value]]),t("button",{class:"icon-btn composer-btn record-btn","aria-label":"Voice message",title:"Record voice",onClick:x[2]||(x[2]=j=>s("startRecording"))},"ğŸ¤"),t("button",{class:"icon-btn composer-btn send-btn","aria-label":"Send",title:"Send",onClick:m},"â¤")])]))}}),Si=re($i,[["__scopeId","data-v-df4ad9ba"]]),Mi={class:"sticker-grid"},xi=["title","onClick"],Ti=["src","alt"],Ei={key:0,class:"empty-state-small",style:{color:"var(--text-muted)"}},Ii=Y({__name:"StickerPicker",emits:["select"],setup(e,{emit:a}){const n=a,o=Je("stickers",g([])),s=z(()=>o.value);return(l,i)=>(d(),h("div",Mi,[(d(!0),h(te,null,ue(s.value,r=>(d(),h("button",{key:r.id,class:"sticker-btn",title:r.label,onClick:v=>n("select",r.id)},[t("img",{src:r.url,alt:r.label},null,8,Ti)],8,xi))),128)),s.value.length===0?(d(),h("div",Ei," No stickers available ")):P("",!0)]))}}),Li={},Ai={class:"msgs-loading"};function Di(e,a){return d(),h("div",Ai,"Loading...")}const Jn=re(Li,[["render",Di]]),Ri=["onClick"],Oi=Y({__name:"EmojiPicker",props:{visible:{type:Boolean},x:{},y:{}},emits:["select","close"],setup(e,{emit:a}){const n=a,o=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ˜®","ğŸ˜¢","ğŸ™","ğŸ”¥","ğŸ‰","ğŸ‘","ğŸ¤”","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘€","ğŸš€","âœ…","âŒ","ğŸ’¯","ğŸŒŸ","ğŸ˜Š","ğŸ¤¯","ğŸ¥³","ğŸ¥²","ğŸ¤—"];return(s,l)=>e.visible?(d(),h("div",{key:0,class:"emoji-picker",style:Vt({left:e.x+"px",top:e.y+"px"}),onClick:l[0]||(l[0]=ne(()=>{},["stop"]))},[(d(),h(te,null,ue(o,i=>t("button",{key:i,class:"emoji-pick-btn",onClick:r=>n("select",i)},A(i),9,Ri)),64))],4)):P("",!0)}}),Ni=Y({__name:"MessageContextMenu",setup(e){const{showToast:a}=ke(),n=Oe(),o=Gt(),s=g(!1),l=g(0),i=g(0),r=g(null),v=g(null),k=g(""),m=g(""),u=g(""),c=g(null),p=z(()=>!c.value||!n.user?!1:c.value===n.user.id),b=z(()=>!v.value||!r.value?null:`${window.location.origin}/c/${v.value}/${r.value}`),f=z(()=>!v.value||!r.value?!1:o.pinnedByChat[v.value]?.message?.id===r.value);function S(T){r.value=T.detail.messageId,v.value=T.detail.chatId,k.value=T.detail.text||"",m.value=T.detail.messageType||"text",u.value=T.detail.senderName||"",c.value=T.detail.senderId??null,l.value=T.detail.x,i.value=T.detail.y,s.value=!0,requestAnimationFrame(()=>{const F=document.querySelector(".msg-context-menu");if(!F)return;const D=F.getBoundingClientRect();D.right>window.innerWidth&&(l.value=window.innerWidth-D.width-8),D.bottom>window.innerHeight&&(i.value=window.innerHeight-D.height-8)})}function C(){s.value&&(s.value=!1,r.value=null,v.value=null,k.value="",m.value="",u.value="",c.value=null)}ve(()=>{window.addEventListener("show-message-context-menu",S),document.addEventListener("click",C)}),Fe(()=>{window.removeEventListener("show-message-context-menu",S),document.removeEventListener("click",C)});function $(){s.value=!1}function x(){$(),!(!r.value||!v.value)&&window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:r.value,chatId:v.value,senderName:u.value,text:k.value}}))}function j(){$(),!(!r.value||!v.value)&&window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:r.value,chatId:v.value,text:k.value}}))}async function _(){$();try{await navigator.clipboard.writeText(k.value),a("Copied to clipboard")}catch{a("Failed to copy text")}}async function O(){if($(),!!b.value)try{await navigator.clipboard.writeText(b.value),a("Link copied")}catch{a("Failed to copy link")}}function W(){$(),!(!r.value||!v.value)&&window.dispatchEvent(new CustomEvent("forward-messages",{detail:{messageIds:[r.value],chatId:v.value}}))}function L(){$(),!(!r.value||!v.value)&&window.dispatchEvent(new CustomEvent("select-message",{detail:{messageId:r.value,chatId:v.value}}))}function H(){if($(),!r.value||!v.value)return;const T=f.value?"unpin-message":"pin-message";window.dispatchEvent(new CustomEvent(T,{detail:{messageId:r.value,chatId:v.value}}))}function y(){$(),!(!r.value||!v.value)&&window.dispatchEvent(new CustomEvent("delete-message",{detail:{messageId:r.value,chatId:v.value}}))}return(T,F)=>(d(),Q(Yn,{to:"body"},[s.value?(d(),h("div",{key:0,class:"msg-context-menu",style:Vt({left:l.value+"px",top:i.value+"px"}),onClick:F[0]||(F[0]=ne(()=>{},["stop"])),onContextmenu:F[1]||(F[1]=ne(()=>{},["prevent"]))},[t("button",{class:"ctx-item",onClick:x}," Reply "),p.value&&m.value==="text"?(d(),h("button",{key:0,class:"ctx-item",onClick:j}," Edit ")):P("",!0),t("button",{class:"ctx-item",onClick:H},A(f.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:_}," Copy text "),b.value?(d(),h("button",{key:1,class:"ctx-item",onClick:O}," Copy link ")):P("",!0),t("button",{class:"ctx-item",onClick:W}," Forward "),t("button",{class:"ctx-item",onClick:L}," Select "),t("button",{class:"ctx-item ctx-delete",onClick:y}," Delete ")],36)):P("",!0)]))}}),Pi=re(Ni,[["__scopeId","data-v-d52d68d5"]]),Ui={key:0,class:"selection-bar"},Fi={class:"selection-bar-count"},Hi={class:"selection-bar-actions"},ji=["disabled"],Bi=["disabled"],zi=Y({__name:"SelectionBar",emits:["forward","delete"],setup(e,{emit:a}){const n=a,o=qt();return(s,l)=>(d(),Q(Xn,{name:"slide-down"},{default:gn(()=>[M(o).selectionMode?(d(),h("div",Ui,[t("button",{class:"selection-bar-btn cancel-btn",onClick:l[0]||(l[0]=i=>M(o).exitSelectionMode())}," Cancel "),t("span",Fi,A(M(o).selectedCount)+" selected",1),t("div",Hi,[t("button",{class:"selection-bar-btn forward-btn",disabled:M(o).selectedCount===0,onClick:l[1]||(l[1]=i=>n("forward"))}," Forward ("+A(M(o).selectedCount)+") ",9,ji),t("button",{class:"selection-bar-btn delete-btn",disabled:M(o).selectedCount===0,onClick:l[2]||(l[2]=i=>n("delete"))}," Delete ("+A(M(o).selectedCount)+") ",9,Bi)])])):P("",!0)]),_:1}))}}),Vi=re(zi,[["__scopeId","data-v-9ba988f2"]]),Wi=Y({__name:"BottomSheet",props:{visible:{type:Boolean}},emits:["close"],setup(e,{emit:a}){const n=a;function o(){n("close")}return(s,l)=>(d(),Q(Yn,{to:"body"},[B(Xn,{name:"bottom-sheet"},{default:gn(()=>[e.visible?(d(),h("div",{key:0,class:"bottom-sheet-backdrop",onClick:ne(o,["self"])},[t("div",{class:"bottom-sheet",onClick:l[0]||(l[0]=ne(()=>{},["stop"]))},[l[1]||(l[1]=t("div",{class:"bottom-sheet-handle"},null,-1)),Zn(s.$slots,"default",{},void 0,!0)])])):P("",!0)]),_:3})]))}}),qi=re(Wi,[["__scopeId","data-v-2c2a0a15"]]),Gi={class:"modal"},Ki={class:"modal-header"},Ji={class:"modal-body"},Qi={class:"forward-chat-list"},Yi={key:0,class:"empty-state-small"},Xi=["onClick"],Zi={class:"forward-chat-info"},el={class:"forward-chat-name"},tl={class:"forward-chat-type"},nl={key:0,class:"forward-check"},sl={class:"modal-actions"},al=["disabled"],ol=Y({__name:"ForwardDialog",props:{messageIds:{},fromChatId:{}},emits:["close","forwarded"],setup(e,{emit:a}){const n=e,o=a,s=be(),l=Gt(),{showToast:i}=ke(),r=g(""),v=g(null),k=g(!1),m=z(()=>{const f=r.value.toLowerCase().trim(),S=s.sortedChats;return f?S.filter(C=>u(C).toLowerCase().includes(f)):S});function u(f){return f.type==="direct"?f.other_display_name||f.other_username||f.title||"Direct Chat":f.title||f.name||"Unnamed Chat"}function c(f){if(f.type==="direct")return f.other_avatar_url??void 0}function p(){}async function b(){if(v.value!==null){k.value=!0;try{await l.forwardMessages(v.value,n.fromChatId,n.messageIds),i("Message forwarded!"),o("forwarded",v.value)}catch{i("Failed to forward message")}finally{k.value=!1}}}return(f,S)=>(d(),h("div",{class:"modal-backdrop",onClick:S[2]||(S[2]=ne(C=>o("close"),["self"]))},[t("div",Gi,[t("div",Ki,[S[3]||(S[3]=t("h2",{class:"modal-title"},"Forward Message",-1)),t("button",{class:"icon-btn",onClick:S[0]||(S[0]=C=>o("close"))},"âœ•")]),t("div",Ji,[ee(t("input",{"onUpdate:modelValue":S[1]||(S[1]=C=>r.value=C),class:"search-input",type:"search",placeholder:"Search chats...",onInput:p},null,544),[[ie,r.value]]),t("div",Qi,[m.value.length===0?(d(),h("div",Yi,"No chats found.")):P("",!0),(d(!0),h(te,null,ue(m.value,C=>(d(),h("div",{key:C.id,class:le(["forward-chat-item",{selected:v.value===C.id}]),onClick:$=>v.value=C.id},[B(me,{name:u(C),url:c(C),size:"sm"},null,8,["name","url"]),t("div",Zi,[t("div",el,A(u(C)),1),t("div",tl,A(C.type),1)]),v.value===C.id?(d(),h("span",nl,"âœ“")):P("",!0)],10,Xi))),128))]),t("div",sl,[t("button",{class:"btn btn-primary",disabled:v.value===null||k.value,onClick:b},A(k.value?"Forwarding...":"Forward"),9,al)])])])]))}}),il=re(ol,[["__scopeId","data-v-ce3f4600"]]),ll={class:"modal modal-sm"},rl={class:"modal-header"},cl={class:"modal-body"},ul={class:"delete-confirm-text"},dl={key:0,class:"delete-checkbox-label"},vl={class:"modal-actions"},ml=Y({__name:"DeleteConfirmModal",props:{messageCount:{default:1},canDeleteForEveryone:{type:Boolean,default:!1}},emits:["close","confirm"],setup(e,{emit:a}){const n=a,o=g(!1);function s(){n("confirm",o.value)}return(l,i)=>(d(),h("div",{class:"modal-backdrop",onClick:i[3]||(i[3]=ne(r=>n("close"),["self"]))},[t("div",ll,[t("div",rl,[i[4]||(i[4]=t("h2",{class:"modal-title"},"Delete Message",-1)),t("button",{class:"icon-btn",onClick:i[0]||(i[0]=r=>n("close"))},"âœ•")]),t("div",cl,[t("p",ul," Are you sure you want to delete "+A(e.messageCount>1?`these ${e.messageCount} messages`:"this message")+"? ",1),e.canDeleteForEveryone?(d(),h("label",dl,[ee(t("input",{"onUpdate:modelValue":i[1]||(i[1]=r=>o.value=r),type:"checkbox",class:"delete-checkbox"},null,512),[[es,o.value]]),i[5]||(i[5]=he(" Delete for everyone ",-1))])):P("",!0)]),t("div",vl,[t("button",{class:"btn btn-ghost",onClick:i[2]||(i[2]=r=>n("close"))},"Cancel"),t("button",{class:"btn btn-danger",onClick:s},"Delete")])])]))}}),fl=re(ml,[["__scopeId","data-v-388dbae2"]]),at=ze("channel",()=>{const e=g(null),a=g([]),n=g(!1),o=z(()=>a.value.length),s=z(()=>a.value.filter(u=>u.role==="admin"||u.role==="owner").length),l=z(()=>{const u=Oe();return u.user?a.value.find(p=>p.id===u.user.id)?.role??null:null}),i=z(()=>l.value==="owner"),r=z(()=>l.value==="admin"||l.value==="owner");async function v(u){n.value=!0;try{e.value=await ns(u)}catch(c){console.error("Failed to load channel detail",c)}finally{n.value=!1}}async function k(u){try{a.value=await la(u)}catch(c){console.error("Failed to load channel members",c)}}async function m(u,c){try{e.value=await ca(u,c)}catch(p){throw console.error("Failed to update channel",p),p}}return{detail:e,members:a,loading:n,memberCount:o,adminCount:s,myRole:l,isOwner:i,isAdmin:r,loadDetail:v,loadMembers:k,updateChannel:m}}),pl=ze("invites",()=>{const e=g([]),a=g(!1);async function n(l){a.value=!0;try{e.value=await Vs(l)}catch(i){console.error("Failed to load invites",i)}finally{a.value=!1}}async function o(l){try{const i=await Ws(l);return e.value.push(i),i}catch(i){throw console.error("Failed to create invite",i),i}}async function s(l){const i=[...e.value];e.value=e.value.filter(r=>r.token!==l);try{await qs(l)}catch(r){throw console.error("Failed to revoke invite",r),e.value=i,r}}return{invites:e,loading:a,loadInvites:n,createInvite:o,revokeInvite:s}}),hl={class:"invite-links-view"},gl={class:"view-header"},yl={style:{padding:"0 1rem .5rem"}},bl=["disabled"],kl={key:0,class:"invite-loading",style:{padding:"1rem","text-align":"center"}},wl={key:1,style:{padding:"1rem","text-align":"center",color:"var(--text-muted)"}},_l={key:2,class:"invite-list",style:{padding:"0 1rem"}},Cl={class:"invite-item-info"},$l={class:"invite-token"},Sl={class:"invite-date"},Ml={class:"invite-item-actions"},xl=["onClick"],Tl=["onClick"],El=Y({__name:"InviteLinksView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=e,o=a,s=pl(),{showToast:l}=ke(),i=g(!1);function r(u){return new Date(u).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function v(u){const c=`${window.location.origin}/join/${u}`;navigator.clipboard&&navigator.clipboard.writeText(c).then(()=>l("Link copied!"))}async function k(){i.value=!0;try{await s.createInvite(n.chatId),l("Invite link created")}catch{l("Failed to create invite")}finally{i.value=!1}}async function m(u){try{await s.revokeInvite(u),l("Invite revoked")}catch{l("Failed to revoke invite")}}return ve(()=>s.loadInvites(n.chatId)),(u,c)=>(d(),h("div",hl,[t("div",gl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=p=>o("back"))},[B(M(Ue),{size:20,"stroke-width":2})]),c[1]||(c[1]=t("span",{class:"view-title"},"Invite Links",-1))]),t("div",yl,[t("button",{class:"btn btn-sm btn-outline",onClick:k,disabled:i.value},A(i.value?"Creating...":"Create Invite Link"),9,bl)]),M(s).loading?(d(),h("div",kl," Loading... ")):M(s).invites.length===0?(d(),h("div",wl," No active invite links ")):(d(),h("div",_l,[(d(!0),h(te,null,ue(M(s).invites,p=>(d(),h("div",{key:p.id,class:"invite-item"},[t("div",Cl,[t("code",$l,A(p.token),1),t("span",Sl,A(r(p.created_at)),1)]),t("div",Ml,[t("button",{class:"icon-btn",title:"Copy link",onClick:b=>v(p.token)},[B(M(Oa),{size:16,"stroke-width":2})],8,xl),t("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:b=>m(p.token)}," Revoke ",8,Tl)])]))),128))]))]))}}),Il=re(El,[["__scopeId","data-v-97b82dd0"]]);async function Ll(e,a){await G.post(`/chats/${e}/avatar`,{file_id:a})}async function Al(e,a){return(await G.post(`/chats/${e}/members/${a}/promote`)).data}async function Dl(e,a){return(await G.post(`/chats/${e}/members/${a}/demote`)).data}const Rl={class:"admins-view"},Ol={class:"view-header"},Nl={class:"search-bar"},Pl={key:0,class:"member-empty"},Ul={key:1,class:"member-list"},Fl=["onClick"],Hl={class:"member-info"},jl={class:"member-name"},Bl={class:"role-badge"},zl={class:"view-footer"},Vl={key:0,class:"member-empty"},Wl={key:1,class:"member-list"},ql={class:"member-info"},Gl={class:"member-name"},Kl=["onClick"],Jl={key:2,class:"view-footer"},Ql=Y({__name:"AdminsView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=e,o=a,s=at(),l=g(!1),i=g(""),r=z(()=>s.members.filter(c=>c.role==="admin"||c.role==="owner")),v=z(()=>s.members.filter(c=>c.role==="member")),k=z(()=>{const c=i.value.toLowerCase().trim();return c?v.value.filter(p=>p.username.toLowerCase().includes(c)||p.display_name&&p.display_name.toLowerCase().includes(c)):v.value});async function m(c){try{await Al(n.chatId,c);const p=s.members.find(b=>b.id===c);p&&(p.role="admin"),l.value=!1,i.value=""}catch{}}async function u(c){try{await Dl(n.chatId,c);const p=s.members.find(b=>b.id===c);p&&(p.role="member")}catch{}}return(c,p)=>(d(),h("div",Rl,[t("div",Ol,[t("button",{class:"icon-btn","aria-label":"Back",onClick:p[0]||(p[0]=b=>o("back"))},[B(M(Ue),{size:20,"stroke-width":2})]),p[4]||(p[4]=t("span",{class:"view-title"},"Administrators",-1))]),l.value?(d(),h(te,{key:0},[t("div",Nl,[ee(t("input",{"onUpdate:modelValue":p[1]||(p[1]=b=>i.value=b),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ie,i.value]])]),k.value.length===0?(d(),h("div",Pl,A(i.value?"No members found":"No members to promote"),1)):(d(),h("div",Ul,[(d(!0),h(te,null,ue(k.value,b=>(d(),h("div",{key:b.id,class:"member-item member-item--selectable",onClick:f=>m(b.id)},[B(me,{name:b.display_name||b.username,url:b.avatar_url,size:"md"},null,8,["name","url"]),t("div",Hl,[t("span",jl,A(b.display_name||b.username),1),t("span",Bl,A(b.role),1)])],8,Fl))),128))])),t("div",zl,[t("button",{class:"btn btn--secondary",onClick:p[2]||(p[2]=b=>l.value=!1)},"Cancel")])],64)):(d(),h(te,{key:1},[r.value.length===0?(d(),h("div",Vl," No administrators found ")):(d(),h("div",Wl,[(d(!0),h(te,null,ue(r.value,b=>(d(),h("div",{key:b.id,class:"member-item"},[B(me,{name:b.display_name||b.username,url:b.avatar_url,size:"md"},null,8,["name","url"]),t("div",ql,[t("span",Gl,A(b.display_name||b.username),1),t("span",{class:le(["role-badge",`role-badge--${b.role}`])},A(b.role),3)]),M(s).isOwner&&b.role==="admin"?(d(),h("button",{key:0,class:"btn btn--small btn--danger",onClick:f=>u(b.id)}," Demote ",8,Kl)):P("",!0)]))),128))])),M(s).isOwner?(d(),h("div",Jl,[t("button",{class:"btn btn--primary",onClick:p[3]||(p[3]=b=>l.value=!0)},"Add Admin")])):P("",!0)],64))]))}}),Yl=re(Ql,[["__scopeId","data-v-2bd7c861"]]),Xl={class:"subscribers-view"},Zl={class:"view-header"},er={class:"search-bar"},tr={key:0,class:"member-empty"},nr={key:1,class:"member-list"},sr={class:"member-info"},ar={class:"member-name"},or=Y({__name:"SubscribersView",props:{chatId:{}},emits:["back"],setup(e,{emit:a}){const n=a,o=at(),s=g(""),l=z(()=>{const i=s.value.toLowerCase().trim();return i?o.members.filter(r=>r.username.toLowerCase().includes(i)||r.display_name&&r.display_name.toLowerCase().includes(i)):o.members});return(i,r)=>(d(),h("div",Xl,[t("div",Zl,[t("button",{class:"icon-btn","aria-label":"Back",onClick:r[0]||(r[0]=v=>n("back"))},[B(M(Ue),{size:20,"stroke-width":2})]),r[2]||(r[2]=t("span",{class:"view-title"},"Subscribers",-1))]),t("div",er,[ee(t("input",{"onUpdate:modelValue":r[1]||(r[1]=v=>s.value=v),type:"text",class:"form-input",placeholder:"Search members..."},null,512),[[ie,s.value]])]),l.value.length===0?(d(),h("div",tr,A(s.value?"No members found":"No subscribers"),1)):(d(),h("div",nr,[(d(!0),h(te,null,ue(l.value,v=>(d(),h("div",{key:v.id,class:"member-item"},[B(me,{name:v.display_name||v.username,url:v.avatar_url,size:"md"},null,8,["name","url"]),t("div",sr,[t("span",ar,A(v.display_name||v.username),1),t("span",{class:le(["role-badge",`role-badge--${v.role}`])},A(v.role),3)])]))),128))]))]))}}),ir=re(or,[["__scopeId","data-v-f99a8a5f"]]),lr={class:"modal profile-modal"},rr={class:"profile-modal-body profile-modal-body--scrollable"},cr={class:"profile-avatar-section profile-avatar-upload-section"},ur={class:"profile-avatar-overlay"},dr={class:"profile-info-list"},vr={class:"form-group"},mr={class:"form-label"},fr=["placeholder"],pr={class:"form-group"},hr=["placeholder"],gr={key:0,class:"form-group"},yr={class:"form-label"},br={class:"type-selector"},kr={class:"type-option"},wr={class:"type-option"},_r={class:"profile-edit-actions"},Cr=["disabled"],$r=Y({__name:"EditChannelModal",props:{chatId:{}},emits:["close","saved"],setup(e,{emit:a}){const n=e,o=a,s=at(),{showToast:l}=ke(),i=g(""),r=g(""),v=g(void 0),k=g("public"),m=g(!1),u=g(null),c=z(()=>s.detail?.type==="group"),p=z(()=>c.value?"Group":"Channel");ve(()=>{s.detail&&(i.value=s.detail.title||"",r.value=s.detail.description||"",v.value=s.detail.avatar_url??void 0,k.value=s.detail.public_name?"public":"private")});async function b(){const S=u.value?.files?.[0];if(S){try{const C=await kn(S);await Ll(n.chatId,C.id),v.value=URL.createObjectURL(S),l("Avatar updated!")}catch{l("Avatar upload failed")}u.value&&(u.value.value="")}}async function f(){if(!i.value.trim()){l(`${p.value} name is required`);return}m.value=!0;try{await s.updateChannel(n.chatId,{title:i.value.trim(),description:r.value.trim()}),l(`${p.value} updated!`),o("saved"),o("close")}catch{l(`Failed to update ${p.value.toLowerCase()}`)}finally{m.value=!1}}return(S,C)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:C[7]||(C[7]=ne($=>o("close"),["self"]))},[t("div",lr,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:C[0]||(C[0]=$=>o("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),t("div",rr,[t("div",cr,[t("div",{class:"profile-avatar-upload-wrap",onClick:C[1]||(C[1]=$=>u.value?.click())},[B(me,{name:i.value||p.value,url:v.value,size:"xxl"},null,8,["name","url"]),t("div",ur,[B(M(os),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:u,type:"file",accept:"image/*",class:"hidden",onChange:b},null,544)]),t("div",dr,[t("div",vr,[t("label",mr,A(p.value)+" name",1),ee(t("input",{"onUpdate:modelValue":C[2]||(C[2]=$=>i.value=$),class:"form-input",type:"text",maxlength:"128",placeholder:`${p.value} name`},null,8,fr),[[ie,i.value]])]),t("div",pr,[C[8]||(C[8]=t("label",{class:"form-label"},"Description",-1)),ee(t("textarea",{"onUpdate:modelValue":C[3]||(C[3]=$=>r.value=$),class:"form-input",maxlength:"500",rows:"4",placeholder:`${p.value} description...`},null,8,hr),[[ie,r.value]])]),M(s).isOwner?(d(),h("div",gr,[t("label",yr,A(p.value)+" type",1),t("div",br,[t("label",kr,[ee(t("input",{"onUpdate:modelValue":C[4]||(C[4]=$=>k.value=$),type:"radio",value:"public",name:"chatType"},null,512),[[Pn,k.value]]),C[9]||(C[9]=t("span",{class:"type-option-label"},"Public",-1)),C[10]||(C[10]=t("span",{class:"type-option-desc"},"Anyone can find and join",-1))]),t("label",wr,[ee(t("input",{"onUpdate:modelValue":C[5]||(C[5]=$=>k.value=$),type:"radio",value:"private",name:"chatType"},null,512),[[Pn,k.value]]),C[11]||(C[11]=t("span",{class:"type-option-label"},"Private",-1)),C[12]||(C[12]=t("span",{class:"type-option-desc"},"Only invited users can join",-1))])])])):P("",!0)]),t("div",_r,[t("button",{class:"btn btn-primary",disabled:m.value,onClick:f},A(m.value?"Saving...":"Save"),9,Cr),t("button",{class:"btn btn-ghost",onClick:C[6]||(C[6]=$=>o("close"))},"Cancel")])])])]))}}),Sr=re($r,[["__scopeId","data-v-6ec12915"]]),Mr={class:"danger-zone"},xr={class:"view-header"},Tr={class:"danger-zone-body"},Er={class:"modal modal-sm"},Ir={class:"modal-header"},Lr={class:"modal-actions"},Ar=["disabled"],Dr=Y({__name:"DangerZone",props:{chatId:{}},emits:["back","left","deleted"],setup(e,{emit:a}){const n=e,o=a,s=be(),l=at(),{showToast:i}=ke(),r=g(!1),v=g(!1);async function k(){try{await s.leave(n.chatId),o("left")}catch{i("Failed to leave channel")}}async function m(){v.value=!0;try{await ra(n.chatId),s.chats=s.chats.filter(u=>u.id!==n.chatId),s.activeChatId===n.chatId&&s.setActiveChat(null),r.value=!1,o("deleted")}catch{i("Failed to delete channel")}finally{v.value=!1}}return(u,c)=>(d(),h("div",Mr,[t("div",xr,[t("button",{class:"icon-btn","aria-label":"Back",onClick:c[0]||(c[0]=p=>o("back"))},[B(M(Ue),{size:20,"stroke-width":2})]),c[5]||(c[5]=t("span",{class:"view-title"},"Danger Zone",-1))]),t("div",Tr,[t("button",{class:"btn btn-danger-outline",onClick:k},[B(M(yn),{size:18,"stroke-width":1.8}),c[6]||(c[6]=he(" Leave Channel ",-1))]),M(l).isOwner?(d(),h("button",{key:0,class:"btn btn-danger",onClick:c[1]||(c[1]=p=>r.value=!0)},[B(M(ls),{size:18,"stroke-width":1.8}),c[7]||(c[7]=he(" Delete Channel ",-1))])):P("",!0)]),r.value?(d(),h("div",{key:0,class:"modal-backdrop",onClick:c[4]||(c[4]=ne(p=>r.value=!1,["self"]))},[t("div",Er,[t("div",Ir,[c[8]||(c[8]=t("h2",{class:"modal-title"},"Delete Channel",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:c[2]||(c[2]=p=>r.value=!1)},[B(M(Ne),{size:20,"stroke-width":2})])]),c[9]||(c[9]=t("div",{class:"modal-body"},[t("p",{class:"delete-confirm-text"}," Are you sure you want to delete this channel? This action cannot be undone. All messages and members will be removed. ")],-1)),t("div",Lr,[t("button",{class:"btn btn-ghost",onClick:c[3]||(c[3]=p=>r.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",disabled:v.value,onClick:m},A(v.value?"Deleting...":"Delete"),9,Ar)])])])):P("",!0)]))}}),Rr=re(Dr,[["__scopeId","data-v-997b5e56"]]),Or={class:"modal profile-modal"},Nr={class:"profile-modal-body"},Pr={key:5,class:"profile-loading"},Ur={class:"profile-avatar-section"},Fr={class:"profile-name"},Hr={class:"profile-status"},jr={key:0,class:"profile-info-list",style:{"margin-top":"8px"}},Br={class:"profile-info-item"},zr={class:"profile-info-value"},Vr={class:"channel-info-menu"},Wr={class:"channel-info-menu-count"},qr={class:"channel-info-menu-count"},Gr={key:7,class:"profile-loading"},Kr=Y({__name:"ChannelInfoModal",props:{chatId:{}},emits:["close"],setup(e,{emit:a}){const n=e,o=a,s=at(),l=g("main"),i=z(()=>Number(n.chatId)),r=z(()=>s.detail?.type==="group");function v(){l.value="main",s.loadDetail(i.value)}return ve(async()=>{await Promise.all([s.loadDetail(i.value),s.loadMembers(i.value)])}),(k,m)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:m[14]||(m[14]=ne(u=>o("close"),["self"]))},[t("div",Or,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:m[0]||(m[0]=u=>o("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),t("div",Nr,[l.value==="invites"?(d(),Q(Il,{key:0,"chat-id":i.value,onBack:m[1]||(m[1]=u=>l.value="main")},null,8,["chat-id"])):l.value==="admins"?(d(),Q(Yl,{key:1,"chat-id":i.value,onBack:m[2]||(m[2]=u=>l.value="main")},null,8,["chat-id"])):l.value==="subscribers"?(d(),Q(ir,{key:2,"chat-id":i.value,onBack:m[3]||(m[3]=u=>l.value="main")},null,8,["chat-id"])):l.value==="edit"?(d(),Q(Sr,{key:3,"chat-id":i.value,onClose:m[4]||(m[4]=u=>l.value="main"),onSaved:v},null,8,["chat-id"])):l.value==="danger"?(d(),Q(Rr,{key:4,"chat-id":i.value,onBack:m[5]||(m[5]=u=>l.value="main"),onLeft:m[6]||(m[6]=u=>o("close")),onDeleted:m[7]||(m[7]=u=>o("close"))},null,8,["chat-id"])):M(s).loading?(d(),h("div",Pr,[...m[15]||(m[15]=[t("p",null,"Loading...",-1)])])):M(s).detail?(d(),h(te,{key:6},[t("div",Ur,[B(me,{name:M(s).detail.title||"Channel",url:M(s).detail.avatar_url??void 0,size:"xxl"},null,8,["name","url"])]),t("div",Fr,A(M(s).detail.title),1),t("div",Hr,A(M(s).memberCount)+" "+A(r.value?M(s).memberCount===1?"member":"members":M(s).memberCount===1?"subscriber":"subscribers"),1),M(s).detail.description?(d(),h("div",jr,[t("div",Br,[m[16]||(m[16]=t("div",{class:"profile-info-label"},"Description",-1)),t("div",zr,A(M(s).detail.description),1)])])):P("",!0),m[19]||(m[19]=t("div",{class:"profile-divider"},null,-1)),t("div",Vr,[t("button",{class:"channel-info-menu-item",onClick:m[8]||(m[8]=u=>l.value="invites")},[B(M(Ua),{size:20,"stroke-width":1.8}),m[17]||(m[17]=t("span",null,"Invite Links",-1))]),t("button",{class:"channel-info-menu-item",onClick:m[9]||(m[9]=u=>l.value="admins")},[B(M(Va),{size:20,"stroke-width":1.8}),m[18]||(m[18]=t("span",null,"Administrators",-1)),t("span",Wr,A(M(s).adminCount),1)]),t("button",{class:"channel-info-menu-item",onClick:m[10]||(m[10]=u=>l.value="subscribers")},[B(M(bn),{size:20,"stroke-width":1.8}),t("span",null,A(r.value?"Members":"Subscribers"),1),t("span",qr,A(M(s).memberCount),1)]),M(s).isOwner||M(s).isAdmin?(d(),h("button",{key:0,class:"channel-info-menu-item",onClick:m[11]||(m[11]=u=>l.value="edit")},[B(M(Ba),{size:20,"stroke-width":1.8}),t("span",null,A(r.value?"Edit Group":"Edit Channel"),1)])):P("",!0),t("button",{class:"channel-info-menu-item channel-info-menu-item--danger",onClick:m[12]||(m[12]=u=>l.value="danger")},[B(M(yn),{size:20,"stroke-width":1.8}),t("span",null,A(r.value?"Leave Group":"Leave Channel"),1)]),M(s).isOwner?(d(),h("button",{key:1,class:"channel-info-menu-item channel-info-menu-item--danger",onClick:m[13]||(m[13]=u=>l.value="danger")},[B(M(ls),{size:20,"stroke-width":1.8}),t("span",null,A(r.value?"Delete Group":"Delete Channel"),1)])):P("",!0)])],64)):(d(),h("div",Gr,[...m[20]||(m[20]=[t("p",null,"Channel not found",-1)])]))])])]))}}),Jr=re(Kr,[["__scopeId","data-v-d1526322"]]),Qr={class:"search-bar"},Yr={class:"search-bar-header"},Xr={key:0,class:"search-loading"},Zr={key:1,class:"search-empty"},ec=["onClick"],tc={class:"search-result-sender"},nc=["innerHTML"],sc={class:"search-result-date"},ac={key:0,class:"search-loading"},oc=Y({__name:"SearchBar",props:{chatId:{}},emits:["close","jumpToMessage"],setup(e,{emit:a}){const n=e,o=a,s=g(null),l=g(null),i=g(""),r=g([]),v=g(!1),k=g(!1),m=g(!0);let u=null;ve(()=>{fe(()=>s.value?.focus())}),Ee(i,$=>{if(u&&clearTimeout(u),!$.trim()){r.value=[],k.value=!1,m.value=!0;return}u=setTimeout(()=>c($.trim()),300)});async function c($){v.value=!0,k.value=!0,m.value=!0;try{const x=await Un(n.chatId,$,{limit:20});r.value=x,x.length<20&&(m.value=!1)}catch{r.value=[]}finally{v.value=!1}}async function p(){if(v.value||!m.value||r.value.length===0)return;const $=Math.min(...r.value.map(x=>x.id));v.value=!0;try{const x=await Un(n.chatId,i.value.trim(),{limit:20,before_id:$});x.length<20&&(m.value=!1),r.value=[...r.value,...x]}catch{}finally{v.value=!1}}function b(){if(!l.value)return;const $=l.value;$.scrollTop+$.clientHeight>=$.scrollHeight-40&&p()}function f($,x){if(!x)return S($);const j=S($),_=S(x),O=new RegExp(_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return j.replace(O,"<mark>$&</mark>")}function S($){return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function C($){if(!$)return"";const x=new Date($.endsWith("Z")?$:$+"Z"),j=new Date;return x.toDateString()===j.toDateString()?x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):x.toLocaleDateString([],{month:"short",day:"numeric"})+" "+x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return($,x)=>(d(),h("div",Qr,[t("div",Yr,[t("button",{class:"icon-btn","aria-label":"Close search",onClick:x[0]||(x[0]=j=>o("close"))},"â†"),ee(t("input",{ref_key:"inputRef",ref:s,"onUpdate:modelValue":x[1]||(x[1]=j=>i.value=j),class:"search-bar-input",type:"text",placeholder:"Search messages...",onKeydown:x[2]||(x[2]=rn(j=>o("close"),["escape"]))},null,544),[[ie,i.value]]),i.value?(d(),h("button",{key:0,class:"icon-btn","aria-label":"Clear",onClick:x[3]||(x[3]=j=>i.value="")},"âœ•")):P("",!0)]),v.value&&r.value.length===0?(d(),h("div",Xr,"Searching...")):k.value&&r.value.length===0&&!v.value?(d(),h("div",Zr,"No messages found")):r.value.length>0?(d(),h("div",{key:2,ref_key:"resultsRef",ref:l,class:"search-results",onScroll:b},[(d(!0),h(te,null,ue(r.value,j=>(d(),h("div",{key:j.id,class:"search-result-item",onClick:_=>o("jumpToMessage",j.id)},[t("div",tc,A(j.sender_display_name||j.sender_username||"Unknown"),1),t("div",{class:"search-result-snippet",innerHTML:f(j.content||"",i.value)},null,8,nc),t("div",sc,A(C(j.created_at)),1)],8,ec))),128)),v.value?(d(),h("div",ac,"Loading more...")):P("",!0)],544)):P("",!0)]))}}),ic={class:"chat-panel"},lc={key:0,class:"empty-chat"},rc={key:1,class:"chat-view"},cc={key:2,class:"channel-readonly-bar"},uc={key:0,class:"date-sep"},dc={key:4,class:"sticker-picker"},vc={key:6,class:"recording-bar"},mc={class:"rec-time"},fc=Y({__name:"ChatPanel",emits:["back","openUserProfile"],setup(e,{emit:a}){const n=a,o=Oe(),s=be(),l=Gt(),{showToast:i}=ke(),r=go(),v=Je("stickers",g([])),k=Je("sendTyping",()=>{}),m=Je("pendingScrollMessageId",g(null)),u=g(null),c=g(null),p=g(!1);let b=null;const f=g(!1),S=g(!1),C=g("member"),$=g(!1),x=g(!1),j=g(!0),_=g(0);let O=null;function W(){if(!u.value)return!0;const N=u.value;return N.scrollTop+N.clientHeight>=N.scrollHeight-100}function L(){O||(O=setTimeout(()=>{O=null,j.value=W(),j.value&&(_.value=0)},100))}function H(){Ve(),_.value=0,j.value=!0}const y=g(!1),T=g(0),F=g(0),D=g(null),E=qt(),U=g(!1),J=g(null),oe=g(""),Se=z(()=>!J.value||!o.user?!1:je.value.find(w=>w.id===J.value)?.sender_id===o.user.id),Jt=z(()=>Se.value?je.value.find(w=>w.id===J.value)?.message_type==="text":!1),ot=z(()=>!J.value||!s.activeChatId?!1:l.pinnedByChat[s.activeChatId]?.message?.id===J.value),He=z(()=>!s.activeChatId||l.pinnedDismissed.has(s.activeChatId)?null:l.pinnedByChat[s.activeChatId]||null),Ie=g(!1),K=g([]),V=g(!1),X=g([]),ce=g(!1),we=g(null);let it=null;const Tn=z(()=>s.activeChat?.type==="channel"&&C.value==="member"),je=z(()=>s.activeChatId?l.getMessages(s.activeChatId):[]),ws=z(()=>{const N=[];let w="";for(const R of je.value){const Z=_s(R.created_at);Z!==w&&(N.push({type:"date",label:Z}),w=Z),N.push({type:"msg",msg:R})}return N});function _s(N){if(!N)return"";const w=new Date(N.endsWith("Z")?N:N+"Z"),R=new Date;if(w.toDateString()===R.toDateString())return"Today";const Z=new Date(R);return Z.setDate(R.getDate()-1),w.toDateString()===Z.toDateString()?"Yesterday":w.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}function Cs(){Qt(),!(!c.value||!u.value)&&(b=new IntersectionObserver(async N=>{if(!N[0]?.isIntersecting)return;const R=s.activeChatId;if(!R||p.value||l.loadingChat===R)return;p.value=!0;const Z=u.value,_e=Z?Z.scrollHeight:0;try{if((await l.loadOlder(R)).length>0&&Z){await fe();const We=Z.scrollHeight;Z.scrollTop+=We-_e}}finally{p.value=!1}},{root:u.value,threshold:0}),b.observe(c.value))}function Qt(){b&&(b.disconnect(),b=null)}Ee(()=>s.activeChatId,async N=>{if(f.value=!1,C.value="member",_.value=0,j.value=!0,Qt(),it&&(clearInterval(it),it=null),!N)return;await Promise.all([l.loadMessages(N),l.loadPinnedMessage(N)]),await fe(),Ve(),await fe(),Cs();const w=s.activeChat;if(w&&(w.type==="channel"||w.type==="group"))try{const R=await ns(N);C.value=R.my_role||"member"}catch{}it=setInterval(()=>{s.activeChatId===N&&l.loadNewer(N).then(R=>{R.length>0&&$s(R.length)})},2500)});function Ve(){u.value&&(u.value.scrollTop=u.value.scrollHeight)}function $s(N=1){if(!u.value)return;const w=u.value;w.scrollHeight-w.scrollTop-w.clientHeight<100?fe(()=>{w.scrollTop=w.scrollHeight}):_.value+=N}function Ss(){s.activeChatId&&k(s.activeChatId)}async function Ms(N,w){if(!(!s.activeChatId||!N.trim())){we.value=null;try{const R=w?{reply_to_message_id:w.messageId}:void 0,Z=await l.sendMessage(s.activeChatId,N.trim(),"text",R);o.user&&(Z.sender_id=o.user.id,Z.sender_username=o.user.username,Z.sender_display_name=o.user.display_name),await fe(),Ve(),s.loadChats()}catch{i("Failed to send message")}}}async function xs(N,w){if(!(!s.activeChatId||!w.trim()))try{await l.editMessage(s.activeChatId,N,w.trim())}catch{i("Failed to edit message")}}async function Ts(N){if(s.activeChatId){f.value=!1;try{const w=await l.sendMessage(s.activeChatId,"","sticker",{sticker_id:N}),R=v.value.find(Z=>Z.id===N);R&&(w.sticker_url=R.url,w.sticker_label=R.label),await fe(),Ve(),s.loadChats()}catch{i("Failed to send sticker")}}}function Es(N,w,R){D.value=N,T.value=w,F.value=R,y.value=!0}function Is(N){D.value&&s.activeChatId&&l.toggleReaction(s.activeChatId,D.value,N),y.value=!1,D.value=null}function Ls(N,w){s.activeChatId&&l.toggleReaction(s.activeChatId,N,w)}function As(){y.value=!1,D.value=null}async function Ds(){try{await r.startRecording(),S.value=!0;const N=await r.stopRecording();S.value=!1,await Fs(N)}catch{S.value=!1,i("Microphone access denied")}}function Rs(){r.cancelRecording(),S.value=!1}function En(N){const{messageIds:w}=N.detail;K.value=w,Ie.value=!0}function In(N){const{messageId:w,chatId:R}=N.detail;R&&E.enterSelectionMode(R,w)}async function Ln(N,w){try{await l.pinMsg(N,w)}catch{i("Failed to pin message")}}async function An(N,w){try{await l.unpinMsg(N,w)}catch{i("Failed to unpin message")}}function Dn(N){const{messageId:w,chatId:R}=N.detail;w&&R&&Ln(R,w)}function Rn(N){const{messageId:w,chatId:R}=N.detail;w&&R&&An(R,w)}function Yt(N){const{messageId:w,chatId:R}=N.detail;if(!w||!R)return;X.value=[w];const Z=je.value.find(_e=>_e.id===w);ce.value=!!(Z&&Z.sender_id===o.user?.id),V.value=!0}function Os(){K.value=[...E.selectedMessageIds],Ie.value=!0}function Ns(){X.value=[...E.selectedMessageIds],ce.value=X.value.every(N=>{const w=je.value.find(R=>R.id===N);return w&&w.sender_id===o.user?.id}),V.value=!0}function On(){Ie.value=!1,K.value=[],E.exitSelectionMode()}async function Ps(N){V.value=!1;const w=s.activeChatId;if(w){for(const R of X.value)try{await l.deleteMessage(w,R)}catch{i("Failed to delete message")}X.value=[],E.exitSelectionMode()}}function Le(N){U.value=!1;const w=J.value,R=s.activeChatId;if(!(!w||!R))switch(N){case"reply":{const Z=je.value.find(_e=>_e.id===w);window.dispatchEvent(new CustomEvent("reply-to-message",{detail:{messageId:w,senderName:Z?.sender_display_name||Z?.sender_username||"Unknown",text:Z?.content||""}}));break}case"edit":{window.dispatchEvent(new CustomEvent("edit-message",{detail:{messageId:w,chatId:R,text:oe.value}}));break}case"copy":navigator.clipboard.writeText(oe.value).then(()=>i("Copied to clipboard"),()=>i("Failed to copy text"));break;case"copyLink":navigator.clipboard.writeText(`${window.location.origin}/c/${R}/${w}`).then(()=>i("Link copied"),()=>i("Failed to copy link"));break;case"forward":K.value=[w],Ie.value=!0;break;case"select":E.enterSelectionMode(R,w);break;case"delete":Yt(new CustomEvent("",{detail:{messageId:w,chatId:R}}));break;case"pin":Ln(R,w);break;case"unpin":An(R,w);break}}async function lt(N){if(!u.value)return;const w=s.activeChatId;if(!w)return;let R=u.value.querySelector(`[data-message-id="${N}"]`);if(!R)try{const Z=Math.max(0,N-25),_e=await mt(w,{after_id:Z,limit:50});if(!_e.find(We=>We.id===N)){i("Message not found");return}l.messagesByChat[w]=_e,_e.length>0&&(l.lastMsgId[w]=Math.max(..._e.map(We=>We.id))),await fe(),R=u.value?.querySelector(`[data-message-id="${N}"]`)}catch{i("Message not found");return}R&&(R.scrollIntoView({behavior:"smooth",block:"center"}),R.classList.add("highlight-message"),setTimeout(()=>R.classList.remove("highlight-message"),2e3))}function Us(N){x.value=!1,lt(N)}function Nn(N){if(N.key==="Escape"){if(x.value){x.value=!1,N.stopPropagation();return}$.value&&($.value=!1,N.stopPropagation())}}ve(()=>{window.addEventListener("forward-messages",En),window.addEventListener("select-message",In),window.addEventListener("delete-message",Yt),window.addEventListener("pin-message",Dn),window.addEventListener("unpin-message",Rn),document.addEventListener("keydown",Nn)}),Fe(()=>{Qt(),window.removeEventListener("forward-messages",En),window.removeEventListener("select-message",In),window.removeEventListener("delete-message",Yt),window.removeEventListener("pin-message",Dn),window.removeEventListener("unpin-message",Rn),document.removeEventListener("keydown",Nn)}),Ee(()=>m.value,async N=>{N&&(await fe(),setTimeout(()=>{lt(N),m.value=null},300))}),Ee(()=>s.activeChatId,()=>{E.exitSelectionMode(),we.value=null,x.value=!1});async function Fs(N){if(s.activeChatId)try{const w=await kn(N);await l.sendMessage(s.activeChatId,"","voice",{file_id:w.id,duration_seconds:r.seconds.value}),await l.loadMessages(s.activeChatId),await fe(),Ve(),s.loadChats()}catch{i("Failed to upload voice message")}}return(N,w)=>(d(),h("main",ic,[M(s).activeChatId?(d(),h("div",rc,[B(Vi,{onForward:Os,onDelete:Ns}),x.value&&M(s).activeChatId?(d(),Q(oc,{key:0,"chat-id":M(s).activeChatId,onClose:w[0]||(w[0]=R=>x.value=!1),onJumpToMessage:Us},null,8,["chat-id"])):P("",!0),ee(B(So,{onBack:w[1]||(w[1]=R=>n("back")),onOpenUserProfile:w[2]||(w[2]=R=>n("openUserProfile",R)),onOpenChannelInfo:w[3]||(w[3]=R=>$.value=!0),onOpenSearch:w[4]||(w[4]=R=>x.value=!0)},null,512),[[pt,!M(E).selectionMode&&!x.value]]),He.value&&!M(E).selectionMode?(d(),Q(wo,{key:1,message:He.value.message,onClick:w[5]||(w[5]=R=>lt(He.value.message.id)),onDismiss:w[6]||(w[6]=R=>M(l).dismissPin(M(s).activeChatId))},null,8,["message"])):P("",!0),Tn.value?(d(),h("div",cc,[...w[22]||(w[22]=[t("span",{class:"readonly-icon"},"ğŸ”’",-1),t("span",{class:"readonly-text"},"Only admins can send messages in this channel.",-1)])])):P("",!0),_.value>0?(d(),h("button",{key:3,class:"new-messages-pill",onClick:H},A(_.value)+" new message"+A(_.value>1?"s":"")+" â†“ ",1)):P("",!0),t("div",{ref_key:"msgListRef",ref:u,class:"msg-list",onClick:As,onScroll:L},[M(l).loadingChat===M(s).activeChatId?(d(),Q(Jn,{key:0})):(d(),h(te,{key:1},[t("div",{ref_key:"olderSentinelRef",ref:c,class:"older-sentinel"},[p.value?(d(),Q(Jn,{key:0})):P("",!0)],512),(d(!0),h(te,null,ue(ws.value,R=>(d(),h(te,{key:R.type==="date"?"date-"+R.label:"msg-"+R.msg.id},[R.type==="date"?(d(),h("div",uc,[t("span",null,A(R.label),1)])):(d(),Q(mi,{key:1,message:R.msg,"is-mine":R.msg.sender_id===M(o).user?.id,onMentionClick:w[7]||(w[7]=Z=>n("openUserProfile",Z)),onOpenEmojiPicker:Es,onToggleReaction:Ls,onReplyClick:lt},null,8,["message","is-mine"]))],64))),128))],64))],544),B(Oi,{visible:y.value,x:T.value,y:F.value,onSelect:Is,onClose:w[8]||(w[8]=R=>y.value=!1)},null,8,["visible","x","y"]),f.value?(d(),h("div",dc,[B(Ii,{onSelect:Ts})])):P("",!0),Tn.value?P("",!0):ee((d(),Q(Si,{key:5,"sticker-picker-open":f.value,"reply-to":we.value,onSend:Ms,onEditMessage:xs,onToggleStickers:w[9]||(w[9]=R=>f.value=!f.value),onStartRecording:Ds,onTyping:Ss},null,8,["sticker-picker-open","reply-to"])),[[pt,!S.value]]),S.value?(d(),h("div",vc,[w[23]||(w[23]=t("span",{class:"rec-dot"},null,-1)),t("span",mc,A(M(r).formatTime(M(r).seconds.value)),1),w[24]||(w[24]=t("span",{class:"rec-label"},"Recording... tap mic to stop",-1)),t("button",{class:"icon-btn rec-cancel",title:"Cancel",onClick:Rs},"âœ•")])):P("",!0),B(Pi),B(qi,{visible:U.value,onClose:w[18]||(w[18]=R=>U.value=!1)},{default:gn(()=>[t("button",{class:"ctx-item",onClick:w[10]||(w[10]=R=>Le("reply"))},"Reply"),Jt.value?(d(),h("button",{key:0,class:"ctx-item",onClick:w[11]||(w[11]=R=>Le("edit"))},"Edit")):P("",!0),t("button",{class:"ctx-item",onClick:w[12]||(w[12]=R=>Le(ot.value?"unpin":"pin"))},A(ot.value?"Unpin":"Pin"),1),t("button",{class:"ctx-item",onClick:w[13]||(w[13]=R=>Le("copy"))},"Copy text"),t("button",{class:"ctx-item",onClick:w[14]||(w[14]=R=>Le("copyLink"))},"Copy link"),t("button",{class:"ctx-item",onClick:w[15]||(w[15]=R=>Le("forward"))},"Forward"),t("button",{class:"ctx-item",onClick:w[16]||(w[16]=R=>Le("select"))},"Select"),t("button",{class:"ctx-item ctx-delete",onClick:w[17]||(w[17]=R=>Le("delete"))},"Delete")]),_:1},8,["visible"]),Ie.value?(d(),Q(il,{key:7,"message-ids":K.value,"from-chat-id":M(s).activeChatId,onClose:On,onForwarded:On},null,8,["message-ids","from-chat-id"])):P("",!0),V.value?(d(),Q(fl,{key:8,"message-count":X.value.length,"can-delete-for-everyone":ce.value,onClose:w[19]||(w[19]=R=>V.value=!1),onConfirm:Ps},null,8,["message-count","can-delete-for-everyone"])):P("",!0),$.value?(d(),Q(Jr,{key:9,"chat-id":String(M(s).activeChatId),onClose:w[20]||(w[20]=R=>$.value=!1)},null,8,["chat-id"])):P("",!0)])):(d(),h("div",lc,[...w[21]||(w[21]=[t("div",{class:"empty-chat-icon"},"ğŸ’¬",-1),t("div",{class:"empty-chat-text"},"Select a chat to start messaging",-1)])]))]))}}),pc=[{id:"my-profile",label:"My Profile",icon:"user",action:"openProfile",visible:()=>!0,rightSlot:"none"},{id:"create-group",label:"Create Group",icon:"users",action:"createGroup",visible:()=>!0,rightSlot:"none"},{id:"create-channel",label:"Create Channel",icon:"megaphone",action:"createChannel",visible:()=>!0,rightSlot:"none"},{id:"favorites",label:"Favorites",icon:"bookmark",action:"openFavorites",visible:()=>!0,rightSlot:"none"},{id:"settings",label:"Settings",icon:"settings",action:"openSettings",visible:()=>!0,rightSlot:"none",separator:!0},{id:"night-mode",label:"Night Mode",icon:"moon",action:"toggleNightMode",visible:()=>!0,rightSlot:"toggle"},{id:"download-app",label:"Download App",icon:"download",action:"openDownload",visible:e=>e.isDesktop,rightSlot:"none"},{id:"logout",label:"Log Out",icon:"log-out",action:"logout",visible:e=>e.isAuthenticated,rightSlot:"none",separator:!0}];function hc(e){return pc.filter(a=>a.visible(e))}const gc=["disabled"],yc={class:"menu-item__label"},bc={key:1,class:"menu-item__badge"},kc=Y({__name:"MenuItem",props:{icon:{},label:{},badge:{},chevron:{type:Boolean},danger:{type:Boolean},disabled:{type:Boolean}},emits:["click"],setup(e,{emit:a}){const n=a;return(o,s)=>(d(),h("button",{class:le(["menu-item",{"menu-item--danger":e.danger,"menu-item--disabled":e.disabled}]),disabled:e.disabled,onClick:s[0]||(s[0]=l=>n("click"))},[e.icon?(d(),Q(ht(e.icon),{key:0,class:"menu-item__icon",size:24,"stroke-width":1.8})):P("",!0),t("span",yc,A(e.label),1),e.badge?(d(),h("span",bc,A(e.badge),1)):P("",!0),Zn(o.$slots,"right",{},void 0),e.chevron?(d(),Q(ht(M(Ra)),{key:2,class:"menu-item__chevron",size:18,"stroke-width":1.8})):P("",!0)],10,gc))}}),Qn=re(kc,[["__scopeId","data-v-682bc042"]]),wc={class:"drawer-header"},_c={class:"drawer-avatar-wrap"},Cc={class:"drawer-user-info"},$c={class:"drawer-display-name"},Sc={class:"drawer-username"},Mc={class:"drawer-nav"},xc={key:0,class:"drawer-divider"},Tc=["onClick"],Ec={class:"menu-item__label"},Ic=["aria-checked"],Lc=Y({__name:"Drawer",props:{open:{type:Boolean}},emits:["close","openProfile","openSettings","openNewGroup","openNewChannel","openFavorites","openDownload"],setup(e,{emit:a}){const n=a,o=ts(),s=Oe(),l=Wt(),i={user:rs,users:bn,megaphone:is,bookmark:Aa,settings:za,moon:ja,download:Na,"log-out":yn,star:qa},r=z(()=>({isAuthenticated:!!s.user,isDesktop:!0})),v=z(()=>hc(r.value)),k={openProfile:()=>n("openProfile"),createGroup:()=>n("openNewGroup"),createChannel:()=>n("openNewChannel"),openFavorites:()=>n("openFavorites"),openSettings:()=>n("openSettings"),toggleNightMode:()=>{const u=l.theme==="dark"?"light":"dark";l.applyTheme(u),l.saveSettings({theme:u})},openDownload:()=>n("openDownload"),logout:()=>{s.logout(),o.push("/login")}};function m(u){u&&k[u]&&k[u]()}return(u,c)=>(d(),h("div",{class:le(["drawer",{open:e.open}])},[t("div",wc,[t("button",{class:"icon-btn","aria-label":"Close menu",onClick:c[0]||(c[0]=p=>n("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),c[1]||(c[1]=t("span",{class:"drawer-title"},"Menu",-1))]),t("div",_c,[B(me,{name:M(s).user?.display_name||M(s).user?.username||"?",url:M(s).user?.avatar_url,size:"lg"},null,8,["name","url"]),t("div",Cc,[t("div",$c,A(M(s).user?.display_name||M(s).user?.username||"---"),1),t("div",Sc,"@"+A(M(s).user?.username||"---"),1)])]),t("nav",Mc,[(d(!0),h(te,null,ue(v.value,p=>(d(),h(te,{key:p.id},[p.separator?(d(),h("div",xc)):P("",!0),p.rightSlot==="toggle"?(d(),h("div",{key:1,class:"menu-item menu-item--toggle",onClick:b=>m(p.action)},[(d(),Q(ht(i[p.icon]),{class:"menu-item__icon",size:24,"stroke-width":1.8})),t("span",Ec,A(p.label),1),t("span",{class:le(["toggle-switch",{"toggle-switch--on":M(l).theme==="dark"}]),role:"switch","aria-checked":M(l).theme==="dark"},[...c[2]||(c[2]=[t("span",{class:"toggle-switch__thumb"},null,-1)])],10,Ic)],8,Tc)):p.id==="logout"?(d(),Q(Qn,{key:2,icon:i[p.icon],label:p.label,danger:"",onClick:b=>m(p.action)},null,8,["icon","label","onClick"])):(d(),Q(Qn,{key:3,icon:i[p.icon],label:p.label,onClick:b=>m(p.action)},null,8,["icon","label","onClick"]))],64))),128))]),c[3]||(c[3]=t("div",{class:"drawer-footer"},"Simple Messenger v2",-1))],2))}}),Ac=re(Lc,[["__scopeId","data-v-de7cf394"]]),Dc={class:"modal"},Rc={class:"modal-header"},Oc={class:"modal-body"},Nc={key:0,class:"chat-type-cards"},Pc={class:"chat-type-icon"},Uc={class:"chat-type-icon"},Fc={class:"chat-type-icon"},Hc={key:1,class:"new-chat-form"},jc={class:"user-pick-list"},Bc={key:0,class:"empty-state-small"},zc={key:1,class:"empty-state-small"},Vc=["onClick"],Wc={class:"user-pick-name"},qc={class:"user-pick-handle"},Gc={key:2,class:"new-chat-form"},Kc={class:"form-group"},Jc={class:"form-group"},Qc={class:"form-group"},Yc={class:"user-pick-list"},Xc=["onClick"],Zc={class:"user-pick-name"},eu={class:"user-pick-handle"},tu={class:"modal-actions"},nu=["disabled"],su={key:3,class:"new-chat-form"},au={class:"form-group"},ou={class:"form-group"},iu={class:"form-group"},lu={class:"modal-actions"},ru=["disabled"],cu=Y({__name:"NewChatModal",props:{initialStep:{default:"select"}},emits:["close","chatCreated"],setup(e,{emit:a}){const n=e,o=a,s=Oe(),{showToast:l}=ke(),i=g(n.initialStep),r=g(!1),v=g(""),k=g([]),m=g(!1);let u=null;const c=g(""),p=g(""),b=g(""),f=g([]),S=g(new Set);let C=null;const $=g(""),x=g(""),j=g("");ve(()=>{_("")});async function _(D){m.value=!0;try{const E=await Fn(D);k.value=E.filter(U=>U.id!==s.user?.id)}catch{k.value=[]}finally{m.value=!1}}function O(){u&&clearTimeout(u),u=setTimeout(()=>_(v.value),300)}async function W(D){try{f.value=await Fn(D)}catch{f.value=[]}}function L(){C&&clearTimeout(C),C=setTimeout(()=>W(b.value),300)}function H(D){S.value.has(D)?S.value.delete(D):S.value.add(D)}async function y(D){r.value=!0;try{const E=await vt({type:"direct",member_ids:[D]});o("chatCreated",E.id)}catch{l("Failed to start conversation")}finally{r.value=!1}}async function T(){if(!c.value.trim()){l("Group name is required");return}r.value=!0;try{const D=await vt({type:"group",title:c.value.trim(),description:p.value.trim(),member_ids:Array.from(S.value)});l("Group created!"),o("chatCreated",D.id)}catch{l("Failed to create group")}finally{r.value=!1}}async function F(){if(!$.value.trim()){l("Channel name is required");return}r.value=!0;try{const D=await vt({type:"channel",title:$.value.trim(),description:j.value.trim(),public_name:x.value.trim()||void 0,member_ids:[]});l("Channel created!"),o("chatCreated",D.id)}catch{l("Failed to create channel")}finally{r.value=!1}}return(D,E)=>(d(),h("div",{class:"modal-backdrop",onClick:E[14]||(E[14]=ne(U=>o("close"),["self"]))},[t("div",Dc,[t("div",Rc,[E[15]||(E[15]=t("h2",{class:"modal-title"},"New Conversation",-1)),t("button",{class:"icon-btn",onClick:E[0]||(E[0]=U=>o("close"))},[B(M(Ne),{size:20})])]),t("div",Oc,[i.value==="select"?(d(),h("div",Nc,[t("button",{class:"chat-type-card",onClick:E[1]||(E[1]=U=>i.value="direct")},[t("span",Pc,[B(M(rs),{size:24})]),E[16]||(E[16]=t("div",null,[t("div",{class:"chat-type-label"},"Direct Chat"),t("div",{class:"chat-type-desc"},"Private 1-on-1 conversation")],-1))]),t("button",{class:"chat-type-card",onClick:E[2]||(E[2]=U=>i.value="group")},[t("span",Uc,[B(M(bn),{size:24})]),E[17]||(E[17]=t("div",null,[t("div",{class:"chat-type-label"},"Group Chat"),t("div",{class:"chat-type-desc"},"Chat with multiple people")],-1))]),t("button",{class:"chat-type-card",onClick:E[3]||(E[3]=U=>i.value="channel")},[t("span",Fc,[B(M(is),{size:24})]),E[18]||(E[18]=t("div",null,[t("div",{class:"chat-type-label"},"Channel"),t("div",{class:"chat-type-desc"},"Broadcast to subscribers")],-1))])])):P("",!0),i.value==="direct"?(d(),h("div",Hc,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:E[4]||(E[4]=U=>i.value="select")},[B(M(Ue),{size:16}),E[19]||(E[19]=he(" Back ",-1))]),ee(t("input",{"onUpdate:modelValue":E[5]||(E[5]=U=>v.value=U),class:"search-input",type:"search",placeholder:"Search users...",onInput:O},null,544),[[ie,v.value]]),t("div",jc,[m.value?(d(),h("div",Bc,"Loading users...")):k.value.length===0?(d(),h("div",zc,"No users found.")):(d(!0),h(te,{key:2},ue(k.value,U=>(d(),h("div",{key:U.id,class:"user-pick-item",onClick:J=>y(U.id)},[B(me,{name:U.display_name||U.username,url:U.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Wc,A(U.display_name||U.username),1),t("div",qc,"@"+A(U.username),1)])],8,Vc))),128))])])):P("",!0),i.value==="group"?(d(),h("div",Gc,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:E[6]||(E[6]=U=>i.value="select")},[B(M(Ue),{size:16}),E[20]||(E[20]=he(" Back ",-1))]),t("div",Kc,[E[21]||(E[21]=t("label",{class:"form-label"},"Group name",-1)),ee(t("input",{"onUpdate:modelValue":E[7]||(E[7]=U=>c.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"My Group"},null,512),[[ie,c.value]])]),t("div",Jc,[E[22]||(E[22]=t("label",{class:"form-label"},"Description (optional)",-1)),ee(t("textarea",{"onUpdate:modelValue":E[8]||(E[8]=U=>p.value=U),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this group about?"},null,512),[[ie,p.value]])]),t("div",Qc,[E[23]||(E[23]=t("label",{class:"form-label"},"Add members",-1)),ee(t("input",{"onUpdate:modelValue":E[9]||(E[9]=U=>b.value=U),class:"search-input",type:"search",placeholder:"Search users...",onInput:L},null,544),[[ie,b.value]]),t("div",Yc,[(d(!0),h(te,null,ue(f.value,U=>(d(),h("div",{key:U.id,class:le(["user-pick-item",{selected:S.value.has(U.id)}]),onClick:J=>H(U.id)},[B(me,{name:U.display_name||U.username,url:U.avatar_url,size:"sm"},null,8,["name","url"]),t("div",null,[t("div",Zc,[S.value.has(U.id)?(d(),Q(M(Da),{key:0,size:14,style:{"margin-right":"4px"}})):P("",!0),he(A(U.display_name||U.username),1)]),t("div",eu,"@"+A(U.username),1)])],10,Xc))),128))])]),t("div",tu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:T}," Create Group ",8,nu)])])):P("",!0),i.value==="channel"?(d(),h("div",su,[t("button",{class:"btn btn-ghost btn-sm new-chat-back-btn",onClick:E[10]||(E[10]=U=>i.value="select")},[B(M(Ue),{size:16}),E[24]||(E[24]=he(" Back ",-1))]),t("div",au,[E[25]||(E[25]=t("label",{class:"form-label"},"Channel name",-1)),ee(t("input",{"onUpdate:modelValue":E[11]||(E[11]=U=>$.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"My Channel"},null,512),[[ie,$.value]])]),t("div",ou,[E[26]||(E[26]=t("label",{class:"form-label"},"Public link name (optional)",-1)),ee(t("input",{"onUpdate:modelValue":E[12]||(E[12]=U=>x.value=U),class:"form-input",type:"text",maxlength:"64",placeholder:"my-channel"},null,512),[[ie,x.value]]),E[27]||(E[27]=t("small",{class:"form-hint"},"Letters, numbers, hyphens, underscores. Used for /c/your-name links.",-1))]),t("div",iu,[E[28]||(E[28]=t("label",{class:"form-label"},"Description (optional)",-1)),ee(t("textarea",{"onUpdate:modelValue":E[13]||(E[13]=U=>j.value=U),class:"form-input",maxlength:"200",rows:"2",placeholder:"What is this channel about?"},null,512),[[ie,j.value]])]),t("div",lu,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:F}," Create Channel ",8,ru)])])):P("",!0)])])]))}}),uu={class:"modal profile-modal profile-modal--self"},du={class:"profile-tabs"},vu={class:"profile-modal-body profile-modal-body--scrollable"},mu={class:"profile-avatar-section profile-avatar-upload-section"},fu={class:"profile-avatar-overlay"},pu={class:"profile-name"},hu={key:0,class:"profile-status profile-status--online"},gu={class:"profile-info-list"},yu={class:"form-group"},bu={class:"form-group"},ku={key:0,class:"form-hint form-error"},wu={class:"form-group"},_u={class:"profile-info-item"},Cu={class:"profile-info-value"},$u={class:"profile-edit-actions"},Su={class:"profile-info-list"},Mu={class:"form-group form-inline"},xu={class:"form-group form-inline"},Tu={class:"toggle"},Eu={class:"form-group form-inline"},Iu={class:"form-group form-inline"},Lu=Y({__name:"ProfileModal",props:{initialTab:{default:"profile"}},emits:["close"],setup(e,{emit:a}){const n=e,o=a,s=Oe(),l=Wt(),{showToast:i}=ke(),r=g(n.initialTab),v=g(""),k=g(""),m=g(""),u=g(""),c=g(null),p=g("light"),b=g(!0),f=g("en"),S=g("everyone");Ee(b,async j=>{j&&"Notification"in window&&await Notification.requestPermission()==="denied"&&(b.value=!1,i("Notifications blocked by browser"))}),ve(async()=>{s.user&&(v.value=s.user.display_name||"",k.value=s.user.username,m.value=s.user.bio||""),p.value=l.theme,b.value=l.notificationsEnabled,f.value=l.language,S.value=l.lastSeenVisibility});async function C(){const j=c.value?.files?.[0];if(j){try{const _=await kn(j),O=await $a(_.id);s.updateUser({avatar_url:O.avatar_url}),i("Avatar updated!")}catch{i("Upload failed")}c.value&&(c.value.value="")}}async function $(){if(u.value="",!s.user)return;const j={display_name:v.value.trim(),bio:m.value.trim()};k.value.trim()&&k.value.trim()!==s.user.username&&(j.username=k.value.trim());try{const _=await Ca(s.user.id,j);s.updateUser({display_name:_.display_name,username:_.username}),i("Profile saved!"),o("close")}catch(_){_.response?.status===409?u.value="Username already taken":i("Save failed")}}async function x(){try{await l.saveSettings({theme:p.value,notifications_enabled:b.value,language:f.value,last_seen_visibility:S.value}),i("Settings saved!"),o("close")}catch{i("Settings save failed")}}return(j,_)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:_[12]||(_[12]=ne(O=>o("close"),["self"]))},[t("div",uu,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:_[0]||(_[0]=O=>o("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),t("div",du,[t("button",{class:le(["profile-tab",{active:r.value==="profile"}]),onClick:_[1]||(_[1]=O=>r.value="profile")},"Profile",2),t("button",{class:le(["profile-tab",{active:r.value==="settings"}]),onClick:_[2]||(_[2]=O=>r.value="settings")},"Settings",2)]),t("div",vu,[ee(t("div",null,[t("div",mu,[t("div",{class:"profile-avatar-upload-wrap",onClick:_[3]||(_[3]=O=>c.value?.click())},[B(me,{name:v.value||M(s).user?.username||"?",url:M(s).user?.avatar_url,size:"xxl"},null,8,["name","url"]),t("div",fu,[B(M(os),{size:24,"stroke-width":1.8,class:"profile-avatar-overlay-icon"})])]),t("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",class:"hidden",onChange:C},null,544)]),t("div",pu,A(v.value||M(s).user?.username||"?"),1),M(s).user?(d(),h("div",hu," online ")):P("",!0),_[17]||(_[17]=t("div",{class:"profile-divider"},null,-1)),t("div",gu,[t("div",yu,[_[13]||(_[13]=t("label",{class:"form-label"},"Display name",-1)),ee(t("input",{"onUpdate:modelValue":_[4]||(_[4]=O=>v.value=O),class:"form-input",type:"text",maxlength:"64",placeholder:"Your name"},null,512),[[ie,v.value]])]),t("div",bu,[_[14]||(_[14]=t("label",{class:"form-label"},"Username",-1)),ee(t("input",{"onUpdate:modelValue":_[5]||(_[5]=O=>k.value=O),class:"form-input",type:"text",maxlength:"20",placeholder:"username"},null,512),[[ie,k.value]]),u.value?(d(),h("small",ku,A(u.value),1)):P("",!0)]),t("div",wu,[_[15]||(_[15]=t("label",{class:"form-label"},"Bio",-1)),ee(t("textarea",{"onUpdate:modelValue":_[6]||(_[6]=O=>m.value=O),class:"form-input",maxlength:"200",rows:"3",placeholder:"About you..."},null,512),[[ie,m.value]])]),t("div",_u,[_[16]||(_[16]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Cu,A(M(s).user?.id),1)])]),t("div",$u,[t("button",{class:"btn btn-primary",onClick:$},"Save Profile"),t("button",{class:"btn btn-ghost",onClick:_[7]||(_[7]=O=>o("close"))},"Cancel")])],512),[[pt,r.value==="profile"]]),ee(t("div",null,[t("div",Su,[t("div",Mu,[_[19]||(_[19]=t("label",{class:"form-label"},"Theme",-1)),ee(t("select",{"onUpdate:modelValue":_[8]||(_[8]=O=>p.value=O),class:"form-input form-select"},[..._[18]||(_[18]=[t("option",{value:"light"},"Light",-1),t("option",{value:"dark"},"Dark",-1)])],512),[[Xt,p.value]])]),t("div",xu,[_[21]||(_[21]=t("label",{class:"form-label"},"Notifications",-1)),t("label",Tu,[ee(t("input",{"onUpdate:modelValue":_[9]||(_[9]=O=>b.value=O),type:"checkbox"},null,512),[[es,b.value]]),_[20]||(_[20]=t("span",{class:"toggle-slider"},null,-1))])]),t("div",Eu,[_[23]||(_[23]=t("label",{class:"form-label"},"Language",-1)),ee(t("select",{"onUpdate:modelValue":_[10]||(_[10]=O=>f.value=O),class:"form-input form-select"},[..._[22]||(_[22]=[t("option",{value:"en"},"English",-1),t("option",{value:"ru"},"Ğ ÑƒÑÑĞºĞ¸Ğ¹",-1),t("option",{value:"de"},"Deutsch",-1)])],512),[[Xt,f.value]])]),_[26]||(_[26]=t("div",{class:"profile-divider"},null,-1)),_[27]||(_[27]=t("h4",{class:"form-section-heading"},"Privacy",-1)),t("div",Iu,[_[25]||(_[25]=t("label",{class:"form-label"},"Last seen & online",-1)),ee(t("select",{"onUpdate:modelValue":_[11]||(_[11]=O=>S.value=O),class:"form-input form-select"},[..._[24]||(_[24]=[t("option",{value:"everyone"},"Everyone",-1),t("option",{value:"approx_only"},"Approximate only",-1),t("option",{value:"nobody"},"Nobody",-1)])],512),[[Xt,S.value]])])]),t("div",{class:"profile-edit-actions"},[t("button",{class:"btn btn-primary",onClick:x},"Save Settings")])],512),[[pt,r.value==="settings"]])])])]))}}),Au={class:"profile-actions"},Du=["disabled","onClick"],Ru={class:"profile-action-btn__circle"},Ou={class:"profile-action-btn__label"},Nu=Y({__name:"ProfileActionButtons",props:{showMute:{type:Boolean},showMore:{type:Boolean},muted:{type:Boolean}},emits:["message","mute","more"],setup(e,{emit:a}){const n=e,o=a,s=z(()=>{const l=[{icon:Ha,label:"Message",event:"message"}];return n.showMute!==!1&&l.push({icon:La,label:n.muted?"Unmute":"Mute",event:"mute"}),n.showMore!==!1&&l.push({icon:Pa,label:"More",event:"more"}),l});return(l,i)=>(d(),h("div",Au,[(d(!0),h(te,null,ue(s.value,r=>(d(),h("button",{key:r.label,class:le(["profile-action-btn",{"profile-action-btn--danger":r.danger}]),disabled:r.disabled,onClick:v=>o(r.event)},[t("span",Ru,[(d(),Q(ht(r.icon),{size:22,"stroke-width":1.8}))]),t("span",Ou,A(r.label),1)],10,Du))),128))]))}}),Pu=re(Nu,[["__scopeId","data-v-b5376905"]]),Uu={class:"modal profile-modal"},Fu={class:"profile-modal-body"},Hu={key:0,class:"profile-loading"},ju={class:"profile-avatar-section"},Bu={class:"profile-name"},zu={class:"profile-info-list"},Vu={class:"profile-info-item"},Wu={class:"profile-info-value"},qu={key:0,class:"profile-info-item"},Gu={class:"profile-info-value"},Ku={class:"profile-info-item"},Ju={class:"profile-info-value"},Qu={key:2,class:"profile-loading"},Yu=Y({__name:"UserProfileModal",props:{username:{}},emits:["close","message"],setup(e,{emit:a}){const n=e,o=a,s=be(),{showToast:l}=ke(),i=g(null),r=g(!0),v=g(!1),k=z(()=>i.value?s.isUserOnline(i.value.id):!1);ve(async()=>{try{i.value=await as(n.username)}catch{i.value=null}finally{r.value=!1}});function m(){v.value=!v.value,l(v.value?"User muted":"User unmuted")}return(u,c)=>(d(),h("div",{class:"modal-backdrop profile-backdrop",onClick:c[2]||(c[2]=ne(p=>o("close"),["self"]))},[t("div",Uu,[t("button",{class:"icon-btn profile-close-btn","aria-label":"Close",onClick:c[0]||(c[0]=p=>o("close"))},[B(M(Ne),{size:20,"stroke-width":2})]),t("div",Fu,[r.value?(d(),h("div",Hu,[...c[3]||(c[3]=[t("p",null,"Loading...",-1)])])):i.value?(d(),h(te,{key:1},[t("div",ju,[B(me,{name:i.value.display_name||i.value.username,url:i.value.avatar_url,online:k.value,size:"xxl"},null,8,["name","url","online"])]),t("div",Bu,[he(A(i.value.display_name||i.value.username)+" ",1),i.value.is_admin?(d(),Q(ks,{key:0})):P("",!0)]),t("div",{class:le(["profile-status",{"profile-status--online":k.value}])},A(k.value?"online":"offline"),3),B(Pu,{muted:v.value,"show-more":!1,onMessage:c[1]||(c[1]=p=>o("message",i.value.username)),onMute:m},null,8,["muted"]),c[7]||(c[7]=t("div",{class:"profile-divider"},null,-1)),t("div",zu,[t("div",Vu,[c[4]||(c[4]=t("div",{class:"profile-info-label"},"Username",-1)),t("div",Wu,"@"+A(i.value.username),1)]),i.value.bio?(d(),h("div",qu,[c[5]||(c[5]=t("div",{class:"profile-info-label"},"Bio",-1)),t("div",Gu,A(i.value.bio),1)])):P("",!0),t("div",Ku,[c[6]||(c[6]=t("div",{class:"profile-info-label"},"User ID",-1)),t("div",Ju,A(i.value.id),1)])])],64)):(d(),h("div",Qu,[...c[8]||(c[8]=[t("p",null,"User not found",-1)])]))])])]))}}),Xu={class:"modal",style:{"max-width":"420px"}},Zu={class:"modal-header"},ed={class:"modal-body",style:{display:"flex","flex-direction":"column",gap:"12px"}},td=Y({__name:"DownloadModal",emits:["close"],setup(e,{emit:a}){const n=a,o=navigator.userAgent.toLowerCase(),s=o.includes("win"),l=o.includes("mac")&&!o.includes("iphone")&&!o.includes("ipad"),i=z(()=>s?"Windows":l?"macOS":null);function r(){s?window.location.href="/downloads/windows/MessengerSetup.exe":l&&(window.location.href="/downloads/macos/Messenger.dmg")}return(v,k)=>(d(),h("div",{class:"modal-backdrop",onClick:k[1]||(k[1]=ne(m=>n("close"),["self"]))},[t("div",Xu,[t("div",Zu,[k[2]||(k[2]=t("h2",{class:"modal-title"},"Download Simple Messenger",-1)),t("button",{class:"icon-btn","aria-label":"Close",onClick:k[0]||(k[0]=m=>n("close"))},[B(M(Ne),{size:20})])]),t("div",ed,[i.value?(d(),h("button",{key:0,class:"btn btn-primary btn-full",onClick:r}," Download for "+A(i.value),1)):P("",!0),k[3]||(k[3]=Bs('<details><summary style="cursor:pointer;color:var(--accent);">Other platforms</summary><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"><a href="/downloads/windows/MessengerSetup.exe" class="btn btn-ghost btn-full" download>Windows installer (.exe)</a><a href="/downloads/macos/Messenger.dmg" class="btn btn-ghost btn-full" download>macOS installer (.dmg)</a></div></details><p style="font-size:0.8rem;color:var(--text-muted);margin:0;"> Files not available yet? Check back soon. </p>',2))])])]))}}),nd={class:"modal",style:{"max-width":"400px"}},sd={class:"modal-header"},ad={class:"modal-body",style:{"text-align":"center"}},od={key:0},id={style:{"font-size":"1.25rem","font-weight":"700"}},ld={style:{color:"var(--text-muted)","margin-top":".5rem"}},rd={class:"profile-avatar-section"},cd={style:{"font-size":"1.25rem","font-weight":"700","margin-top":".5rem"}},ud={key:0,style:{color:"var(--text-muted)","margin-top":".5rem","line-height":"1.5"}},dd={key:1,style:{color:"var(--text-muted)","font-size":".85rem","margin-top":".25rem"}},vd={class:"modal-actions",style:{"margin-top":"1.25rem","justify-content":"center"}},md=["disabled"],fd=Y({__name:"InvitePreviewModal",props:{token:{}},emits:["close","joined"],setup(e,{emit:a}){const n=e,o=a,{showToast:s}=ke(),l=g(null),i=g(!0),r=g(!1),v=g(""),k=g("");ve(async()=>{if(!n.token){v.value="Invalid Link",k.value="No invite token provided.",i.value=!1;return}try{l.value=await Gs(n.token)}catch(u){u.response?.status===410?(v.value="Invite Revoked",k.value="This invite link has been revoked."):(v.value="Invite Not Found",k.value="This invite link is invalid or has expired.")}finally{i.value=!1}});async function m(){r.value=!0;try{const u=await Ks(n.token);s(u.already_member?"You are already a member":"Joined successfully!"),o("joined",u.chat_id)}catch(u){s(u.response?.data?.error||"Failed to join")}finally{r.value=!1}}return(u,c)=>(d(),h("div",{class:"modal-backdrop",onClick:c[2]||(c[2]=ne(p=>o("close"),["self"]))},[t("div",nd,[t("div",sd,[c[3]||(c[3]=t("h2",{class:"modal-title"},"Invite Preview",-1)),t("button",{class:"icon-btn",onClick:c[0]||(c[0]=p=>o("close"))},"âœ•")]),t("div",ad,[i.value?(d(),h("p",od,"Loading invite preview...")):k.value?(d(),h(te,{key:1},[t("h2",id,A(v.value),1),t("p",ld,A(k.value),1)],64)):l.value?(d(),h(te,{key:2},[t("div",rd,[B(me,{name:l.value.title||"Chat",size:"xl"},null,8,["name"])]),t("h2",cd,A(l.value.title||l.value.type||"Chat"),1),l.value.description?(d(),h("p",ud,A(l.value.description),1)):P("",!0),l.value.member_count?(d(),h("p",dd,A(l.value.member_count)+" members ",1)):P("",!0),t("div",vd,[t("button",{class:"btn btn-primary",disabled:r.value,onClick:m},A(r.value?"Joining...":"Join"),9,md),t("button",{class:"btn btn-ghost",onClick:c[1]||(c[1]=p=>o("close"))},"Cancel")])],64)):P("",!0)])])]))}}),pd=Y({__name:"ContextMenu",setup(e){const a=be(),{showToast:n}=ke(),o=g(!1),s=g(0),l=g(0),i=g(null),r=z(()=>i.value?a.chats.find(p=>p.id===i.value)??null:null);function v(p){i.value=p.detail.chatId,s.value=p.detail.x,l.value=p.detail.y,o.value=!0}function k(){o.value&&(o.value=!1,i.value=null)}ve(()=>{window.addEventListener("show-context-menu",v),document.addEventListener("click",k)}),Fe(()=>{window.removeEventListener("show-context-menu",v),document.removeEventListener("click",k)});async function m(){if(i.value){o.value=!1;try{await a.toggleFavorite(i.value)}catch{n("Failed to update favorite")}}}async function u(){if(i.value){o.value=!1;try{await a.toggleMute(i.value)}catch{n("Failed to update mute")}}}async function c(){if(i.value&&(o.value=!1,!!confirm("Leave this chat?")))try{await a.leave(i.value),n("Left chat")}catch{n("Failed to leave chat")}}return(p,b)=>o.value?(d(),h("div",{key:0,class:"context-menu",style:Vt({left:s.value+"px",top:l.value+"px"})},[t("button",{class:"ctx-item",onClick:m},A(r.value?.is_favorite?"â˜… Unstar":"â˜† Star"),1),t("button",{class:"ctx-item",onClick:u},A(r.value?.is_muted?"Unmute":"Mute"),1),r.value&&r.value.type!=="direct"?(d(),h("button",{key:0,class:"ctx-item ctx-leave",onClick:c}," Leave chat ")):P("",!0)],4)):P("",!0)}}),yd=Y({__name:"MessengerView",setup(e){const a=zs(),n=ts(),o=Oe(),s=be(),l=Wt(),i=qt(),{showToast:r}=ke(),{connect:v,disconnect:k,sendTyping:m}=_a();dt("sendTyping",m);const u=g(!1),c=g(!1),p=g("select"),b=g(!1),f=g("profile"),S=g(!1),C=g(null),$=g(null),x=g([]),j=g(null);dt("stickers",x),dt("pendingScrollMessageId",j);let _=null;ve(async()=>{await l.loadSettings();try{x.value=await Sa()}catch{}await s.loadChats(),v(),_=setInterval(()=>s.loadChats(),5e3),O()}),Fe(()=>{k(),_&&(clearInterval(_),_=null)}),Ee(()=>a.path,()=>{O()}),Ee(()=>s.activeChatId,()=>{i.selectionMode&&i.exitSelectionMode()});async function O(){const K=a.path;if(K.startsWith("/@")){const V=a.params.username;V&&(C.value=V)}else if(K.startsWith("/u/")){const V=a.params.id;if(V)try{const X=await ss(parseInt(V));C.value=X.username}catch{r("User not found")}}else if(K.startsWith("/dm/")){const V=a.params.id;V&&await W(V)}else if(K.startsWith("/c/")){const V=a.params.chatIdOrName||a.params.name,X=a.params.messageId?parseInt(a.params.messageId):null;if(V)if(/^\d+$/.test(V)){const we=parseInt(V);X?await H(we,X):s.setActiveChat(we)}else await L(V)}}async function W(K){try{let V;if(K.startsWith("@")){const ce=K.substring(1);if(o.user?.username===ce){C.value=ce;return}V=(await as(ce)).id}else if(V=parseInt(K),o.user?.id===V){r("Cannot open DM with yourself");return}const X=await vt({type:"direct",member_ids:[V]});await s.loadChats(),s.setActiveChat(X.id)}catch{r("Failed to open conversation")}}async function L(K){try{const V=await Qs(K);s.chats.find(ce=>ce.id===V.id)?s.setActiveChat(V.id):r("You are not a member of this channel")}catch{r("Channel not found")}}async function H(K,V){if(!s.chats.find(ce=>ce.id===K)){r("Chat not found");return}s.setActiveChat(K),await fe(),j.value=V}function y(K){s.setActiveChat(K),n.replace("/app")}function T(){s.setActiveChat(null)}function F(){u.value=!1,f.value="profile",b.value=!0}function D(){u.value=!1,f.value="settings",b.value=!0}function E(){u.value=!1,p.value="group",c.value=!0}function U(){u.value=!1,p.value="channel",c.value=!0}function J(){u.value=!1}function oe(K){C.value=K}async function Se(K){C.value=null,await W("@"+K)}async function Jt(K){c.value=!1,await s.loadChats(),s.setActiveChat(K)}async function ot(K){$.value=null,await s.loadChats(),s.setActiveChat(K)}function He(K){const V=K.target?.closest("a");if(!V)return;const X=V.getAttribute("href");if(!X)return;let ce=null;try{const we=new URL(X,window.location.origin);we.origin===window.location.origin&&(ce=we.pathname.match(/^\/join\/([^/]+)$/))}catch{ce=X.match(/^\/join\/([^/]+)$/)}ce&&(K.preventDefault(),K.stopPropagation(),$.value=ce[1]??null)}function Ie(K){if(K.key==="Escape"){if($.value){$.value=null;return}if(i.selectionMode){i.exitSelectionMode();return}if(C.value){C.value=null;return}if(c.value){c.value=!1;return}if(b.value){b.value=!1;return}if(S.value){S.value=!1;return}if(u.value){u.value=!1;return}if(s.activeChatId!==null){T();return}}}return ve(()=>{document.addEventListener("keydown",Ie),document.addEventListener("click",He,!0)}),Fe(()=>{document.removeEventListener("keydown",Ie),document.removeEventListener("click",He,!0)}),(K,V)=>(d(),h("div",{class:le(["layout",{"chat-open":!!M(s).activeChatId}])},[B(Ac,{open:u.value,onClose:V[0]||(V[0]=X=>u.value=!1),onOpenProfile:F,onOpenSettings:D,onOpenNewGroup:E,onOpenNewChannel:U,onOpenFavorites:J,onOpenDownload:V[1]||(V[1]=X=>S.value=!0)},null,8,["open"]),t("div",{class:le(["drawer-overlay",{visible:u.value}]),onClick:V[2]||(V[2]=X=>u.value=!1)},null,2),B(ho,{onOpenDrawer:V[3]||(V[3]=X=>u.value=!0),onOpenNewChat:V[4]||(V[4]=X=>{p.value="select",c.value=!0}),onSelectChat:y}),B(fc,{onBack:T,onOpenUserProfile:oe}),c.value?(d(),Q(cu,{key:0,"initial-step":p.value,onClose:V[5]||(V[5]=X=>c.value=!1),onChatCreated:Jt},null,8,["initial-step"])):P("",!0),b.value?(d(),Q(Lu,{key:1,"initial-tab":f.value,onClose:V[6]||(V[6]=X=>b.value=!1)},null,8,["initial-tab"])):P("",!0),C.value?(d(),Q(Yu,{key:2,username:C.value,onClose:V[7]||(V[7]=X=>C.value=null),onMessage:Se},null,8,["username"])):P("",!0),S.value?(d(),Q(td,{key:3,onClose:V[8]||(V[8]=X=>S.value=!1)})):P("",!0),$.value?(d(),Q(fd,{key:4,token:$.value,onClose:V[9]||(V[9]=X=>$.value=null),onJoined:ot},null,8,["token"])):P("",!0),B(pd)],2))}});export{yd as default};
