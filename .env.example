# ============================================================
# Messenger – Environment Variables
# Copy this file to .env and fill in your values.
# NEVER commit .env to version control.
# ============================================================

# ----- PostgreSQL -----
POSTGRES_DB=messenger
POSTGRES_USER=messenger
POSTGRES_PASSWORD=changeme_postgres

# ----- Redis -----
REDIS_PASSWORD=changeme_redis

# ----- MinIO (S3-compatible object storage) -----
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=changeme_minio
# Internal endpoint used by the backends to reach MinIO (Docker service name)
MINIO_ENDPOINT=minio:9000
# Per-purpose bucket names
MINIO_AVATARS_BUCKET=bh-avatars
MINIO_UPLOADS_BUCKET=bh-uploads
MINIO_STICKERS_BUCKET=bh-stickers
MINIO_TESTS_BUCKET=bh-test-artifacts
# Presigned URL TTL in seconds (15 minutes)
MINIO_PRESIGN_TTL=900
# Public-facing base URL for presigned GET URLs handed to browsers.
# Dev (port 9000 exposed):  MINIO_PUBLIC_URL=http://localhost:9000
# Prod (nginx /minio/ proxy): MINIO_PUBLIC_URL=https://behappy.rest/minio
MINIO_PUBLIC_URL=http://localhost:9000

# ----- JWT -----
# MUST be changed in production — at least 32 random bytes (hex or base64)
JWT_SECRET=change-me-in-production-use-openssl-rand-hex-32
# Token TTLs in seconds
JWT_ACCESS_TTL=3600      # 1 hour
JWT_REFRESH_TTL=604800   # 7 days

# ----- File upload limits -----
MAX_FILE_SIZE_MB=50
ALLOWED_MIME_TYPES=image/jpeg,image/png,image/gif,image/webp,audio/ogg,audio/webm,video/mp4,application/pdf

# ----- Grafana -----
GRAFANA_USER=admin
GRAFANA_PASSWORD=admin

# ----- API server -----
# Number of IO threads (0 = auto = number of CPU cores)
API_THREADS=0
API_PORT=8080

# ----- HashiCorp Vault -----
# In production, this entire .env file is AUTO-GENERATED by Vault Agent.
# Manual editing is only needed for development or initial bootstrap.
#
# Vault setup:
#   1. docker compose up -d vault
#   2. bash infra/vault/init.sh        # One-time initialization
#   3. Save credentials to /opt/messenger/vault/  (role-id, secret-id, unseal-keys.json)
#   4. Populate real secrets: vault kv put secret/messenger/db password=<real>
#   5. Deploy: bash infra/scripts/02-deploy.sh  (auto-renders .env from Vault)
#
# Vault Agent config: infra/vault/agent-init.hcl
# Template: infra/vault/compose-env.tpl → /opt/messenger/env/.env
