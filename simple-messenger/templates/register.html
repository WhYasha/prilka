{% extends "base.html" %}
{% block title %}Register â€“ Simple Messenger{% endblock %}

{% block body %}
<div class="auth-page">
  <div class="auth-card">
    <div class="auth-logo">ðŸ’¬</div>
    <h1 class="auth-title">Simple Messenger</h1>
    <p class="auth-subtitle">Create a new account</p>

    <div id="error-msg" class="alert alert-error hidden"></div>

    <form id="register-form" novalidate>
      <div class="form-group">
        <label for="username">Username</label>
        <input id="username" name="username" type="text"
               autocomplete="username" placeholder="choose_a_username"
               minlength="3" maxlength="32" required />
        <span class="form-hint">3â€“32 chars, letters/digits/- _</span>
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input id="password" name="password" type="password"
               autocomplete="new-password" placeholder="at least 6 characters"
               minlength="6" maxlength="128" required />
      </div>
      <button type="submit" class="btn btn-primary btn-full" id="submit-btn">
        Create account
      </button>
    </form>

    <p class="auth-footer">
      Already have an account? <a href="/login">Sign in</a>
    </p>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const form = document.getElementById("register-form");
  const errorEl = document.getElementById("error-msg");
  const submitBtn = document.getElementById("submit-btn");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorEl.classList.add("hidden");
    submitBtn.disabled = true;
    submitBtn.textContent = "Creatingâ€¦";

    const body = {
      username: document.getElementById("username").value.trim(),
      password: document.getElementById("password").value,
    };

    try {
      const res = await fetch("/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      const data = await res.json();

      if (res.ok) {
        window.location.href = "/app";
      } else {
        errorEl.textContent = data.error || "Registration failed.";
        errorEl.classList.remove("hidden");
      }
    } catch {
      errorEl.textContent = "Network error. Please try again.";
      errorEl.classList.remove("hidden");
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = "Create account";
    }
  });
</script>
{% endblock %}
